/*
  (c) 2011 - 2013 Stefan Gabos
  @license    http://www.gnu.org/licenses/lgpl-3.0.txt GNU LESSER GENERAL PUBLIC LICENSE
  @package    Zebra_DatePicker
: Copyright (c) 2006-2008, Coolite Inc. (http://www.coolite.com/). All rights reserved.
 @license: Licensed under The MIT License. See license.txt and http://www.datejs.com/license/. 
 @website: http://www.datejs.com/
 jQuery v3.2.1 | (c) JS Foundation and other contributors | jquery.org/license  jQuery UI - v1.12.1 - 2017-08-28
 http://jqueryui.com
 Includes: position.js, scroll-parent.js, effect.js, effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js, effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js, effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js, effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js, effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js
 Copyright jQuery Foundation and other contributors; Licensed MIT  jQuery Color Animations v@VERSION
 https://github.com/jquery/jquery-color

 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license

 Date: @DATE
 jQuery Autosize v1.16.7
 (c) 2013 Jack Moore - jacklmoore.com
 updated: 2013-03-20
 license: http://www.opensource.org/licenses/mit-license.php
 jQuery Form Plugin
 version: 3.45.0-2013.10.17
 Requires jQuery v1.5 or later
 Copyright (c) 2013 M. Alsup
 Examples and documentation at: http://malsup.com/jquery/form/
 Project repository: https://github.com/malsup/form
 Dual licensed under the MIT and GPL licenses.
 https://github.com/malsup/form#copyright-and-license
 Chosen, a Select Box Enhancer for jQuery and Prototype
 by Patrick Filler for Harvest, http://getharvest.com

 Version 1.1.0
 Full source at https://github.com/harvesthq/chosen
 Copyright (c) 2011 Harvest http://getharvest.com

 MIT License, https://github.com/harvesthq/chosen/blob/master/LICENSE.md
 This file is generated by `grunt build`, do not edit it by hand.
 jQuery Mousewheel 3.1.13

 Copyright 2015 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 Chart.js
 http://chartjs.org/
 Version: 1.0.1-beta.4

 Copyright 2014 Nick Downie
 Released under the MIT license
 https://github.com/nnnick/Chart.js/blob/master/LICENSE.md
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(d){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var d=$jscomp.setPrototypeOf;d(a,b)}else for(d in b)if("prototype"!=d)if(Object.defineProperties){var c=Object.getOwnPropertyDescriptor(b,d);c&&Object.defineProperty(a,d,c)}else a[d]=b[d];a.superClass_=b.prototype};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var b,d=[];!(b=a.next()).done;)d.push(b.value);return d};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.findInternal=function(a,b,d){a instanceof String&&(a=String(a));for(var c=a.length,f=0;f<c;f++){var g=a[f];if(b.call(d,g,f,a))return{i:f,v:g}}return{i:-1,v:void 0}};
$jscomp.polyfill=function(a,b,d,c){if(b){d=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var f=a[c];f in d||(d[f]={});d=d[f]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
$jscomp.checkStringArgs=function(a,b,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,d){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var f=b.length,g=a.length;d=Math.max(0,Math.min(d|0,b.length));for(var m=0;m<g&&d<f;)if(b[d++]!=a[m++])return!1;return m>=g}},"es6","es3");
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,c={next:function(){if(d<a.length){var f=d++;return{value:b(f,a[f]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,d){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===d&&(d=b.length);d=Math.max(0,Math.min(d|0,b.length));for(var f=a.length;0<f&&0<d;)if(b[--d]!=a[--f])return!1;return 0>=f}},"es6","es3");$jscomp.polyfill("Array.prototype.entries",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,d){return[a,d]})}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function d(a){return a instanceof f?a:new f(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var c=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){c(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(q){this.asyncThrow_(q)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var f=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(n){b.reject(n)}};f.prototype.createResolveAndReject_=
function(){function a(a){return function(e){c||(c=!0,a.call(b,e))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};f.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof f)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};f.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(n){this.reject_(n);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};f.prototype.reject_=function(a){this.settle_(2,a)};f.prototype.fulfill_=function(a){this.settle_(1,a)};f.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var g=new b;f.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};f.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(q){c.reject(q)}};f.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(A){e(A)}}:b}var d,e,p=new f(function(a,
b){d=a;e=b});this.callWhenSettled_(c(a,d),c(b,e));return p};f.prototype.catch=function(a){return this.then(void 0,a)};f.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?g.asyncExecute(c):this.onSettledCallbacks_.push(function(){g.asyncExecute(c)})};f.resolve=d;f.reject=function(a){return new f(function(b,c){c(a)})};f.race=function(a){return new f(function(b,
c){for(var f=$jscomp.makeIterator(a),e=f.next();!e.done;e=f.next())d(e.value).callWhenSettled_(b,c)})};f.all=function(a){var b=$jscomp.makeIterator(a),c=b.next();return c.done?d([]):new f(function(a,e){function f(e){return function(b){l[e]=b;g--;0==g&&a(l)}}var l=[],g=0;do l.push(void 0),g++,d(c.value).callWhenSettled_(f(l.length-1),e),c=b.next();while(!c.done)})};return f},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,d,c){var b=this.length||0;0>d&&(d=Math.max(0,b+d));if(null==c||c>b)c=b;c=Number(c);0>c&&(c=Math.max(0,b+c));for(d=Number(d||0);d<c;d++)this[d]=a;return this}},"es6","es3");var CONSTANTS={LICENSES:{API:"api",ACL:"allow_acl_feature",PAGE:"page_limit",PRODUCT:"product_limit",OPERATOR:"operator_limit"}};
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){function d(e,a){a=a||ca;var b=a.createElement("script");b.text=e;a.head.appendChild(b).parentNode.removeChild(b)}function c(e){var a=!!e&&"length"in e&&e.length,b=u.type(e);return"function"!==b&&!u.isWindow(e)&&("array"===b||0===a||"number"==
typeof a&&0<a&&a-1 in e)}function f(e,a){return e.nodeName&&e.nodeName.toLowerCase()===a.toLowerCase()}function g(e,a,b){return u.isFunction(a)?u.grep(e,function(e,c){return!!a.call(e,c,e)!==b}):a.nodeType?u.grep(e,function(e){return e===a!==b}):"string"!=typeof a?u.grep(e,function(e){return-1<Ga.call(a,e)!==b}):qb.test(a)?u.filter(a,e,b):(a=u.filter(a,e),u.grep(e,function(e){return-1<Ga.call(a,e)!==b&&1===e.nodeType}))}function m(e,a){for(;(e=e[a])&&1!==e.nodeType;);return e}function l(e){var a=
{};return u.each(e.match(Wa)||[],function(e,b){a[b]=!0}),a}function n(e){return e}function q(e){throw e;}function e(e,a,b,c){var d;try{e&&u.isFunction(d=e.promise)?d.call(e).done(a).fail(b):e&&u.isFunction(d=e.then)?d.call(e,a,b):a.apply(void 0,[e].slice(c))}catch(xc){b.apply(void 0,[xc])}}function p(){ca.removeEventListener("DOMContentLoaded",p);a.removeEventListener("load",p);u.ready()}function t(){this.expando=u.expando+t.uid++}function w(e,a,b){var c;if(void 0===b&&1===e.nodeType)if(c="data-"+
a.replace(ib,"-$&").toLowerCase(),b=e.getAttribute(c),"string"==typeof b){try{c=b,b="true"===c||"false"!==c&&("null"===c?null:c===+c+""?+c:gc.test(c)?JSON.parse(c):c)}catch(Vd){}Qa.set(e,a,b)}else b=void 0;return b}function y(e,a,b,c){var d,f=1,p=20,l=c?function(){return c.cur()}:function(){return u.css(e,a,"")},g=l(),m=b&&b[3]||(u.cssNumber[a]?"":"px"),n=(u.cssNumber[a]||"px"!==m&&+g)&&$a.exec(u.css(e,a));if(n&&n[3]!==m){m=m||n[3];b=b||[];n=+g||1;do f=f||".5",n/=f,u.style(e,a,n+m);while(f!==(f=l()/
g)&&1!==f&&--p)}return b&&(n=+n||+g||0,d=b[1]?n+(b[1]+1)*b[2]:+b[2],c&&(c.unit=m,c.start=n,c.end=d)),d}function A(e,a){for(var b,c,d=[],f=0,p=e.length;f<p;f++)if(c=e[f],c.style)if(b=c.style.display,a){if("none"===b&&(d[f]=la.get(c,"display")||null,d[f]||(c.style.display="")),""===c.style.display&&Ta(c)){b=f;var l=void 0;var g=c.ownerDocument;var m=c.nodeName;g=(c=Na[m])?c:(l=g.body.appendChild(g.createElement(m)),c=u.css(l,"display"),l.parentNode.removeChild(l),"none"===c&&(c="block"),Na[m]=c,c);
d[b]=g}}else"none"!==b&&(d[f]="none",la.set(c,"display",b));for(f=0;f<p;f++)null!=d[f]&&(e[f].style.display=d[f]);return e}function x(e,a){var b;return b="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(a||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(a||"*"):[],void 0===a||a&&f(e,a)?u.merge([e],b):b}function z(e,a){for(var b=0,c=e.length;b<c;b++)la.set(e[b],"globalEval",!a||la.get(a[b],"globalEval"))}function D(e,a,b,c,d){for(var f,p,l,g,m=a.createDocumentFragment(),
n=[],t=0,q=e.length;t<q;t++)if(f=e[t],f||0===f)if("object"===u.type(f))u.merge(n,f.nodeType?[f]:f);else if(Xa.test(f)){p=p||m.appendChild(a.createElement("div"));l=(rb.exec(f)||["",""])[1].toLowerCase();l=Ia[l]||Ia._default;p.innerHTML=l[1]+u.htmlPrefilter(f)+l[2];for(l=l[0];l--;)p=p.lastChild;u.merge(n,p.childNodes);p=m.firstChild;p.textContent=""}else n.push(a.createTextNode(f));m.textContent="";for(t=0;f=n[t++];)if(c&&-1<u.inArray(f,c))d&&d.push(f);else if(g=u.contains(f.ownerDocument,f),p=x(m.appendChild(f),
"script"),g&&z(p),b)for(l=0;f=p[l++];)kb.test(f.type||"")&&b.push(f);return m}function B(){return!0}function G(){return!1}function L(){try{return ca.activeElement}catch(pb){}}function J(e,a,b,c,d,f){var p,l;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(l in a)J(e,l,b,c,a[l],f);return e}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),!1===d)d=G;else if(!d)return e;return 1===f&&(p=d,d=function(e){return u().off(e),p.apply(this,
arguments)},d.guid=p.guid||(p.guid=u.guid++)),e.each(function(){u.event.add(this,a,d,c,b)})}function P(e,a){return f(e,"table")&&f(11!==a.nodeType?a:a.firstChild,"tr")?u(">tbody",e)[0]||e:e}function fa(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function da(e){var a=wb.exec(e.type);return a?e.type=a[1]:e.removeAttribute("type"),e}function M(e,a){var b,c,d,f,p,l;if(1===a.nodeType){if(la.hasData(e)&&(b=la.access(e),c=la.set(a,b),l=b.events))for(d in delete c.handle,c.events={},l)for(b=
0,c=l[d].length;b<c;b++)u.event.add(a,d,l[d][b]);Qa.hasData(e)&&(f=Qa.access(e),p=u.extend({},f),Qa.set(a,p))}}function V(e,a,b,c){a=Ua.apply([],a);var f,p,l,g=0,m=e.length,n=m-1,t=a[0],q=u.isFunction(t);if(q||1<m&&"string"==typeof t&&!oa.checkClone&&Oc.test(t))return e.each(function(d){var f=e.eq(d);q&&(a[0]=t.call(this,d,f.html()));V(f,a,b,c)});if(m&&(f=D(a,e[0].ownerDocument,!1,e,c),p=f.firstChild,1===f.childNodes.length&&(f=p),p||c)){p=u.map(x(f,"script"),fa);for(l=p.length;g<m;g++){var w=f;g!==
n&&(w=u.clone(w,!0,!0),l&&u.merge(p,x(w,"script")));b.call(e[g],w,g)}if(l)for(f=p[p.length-1].ownerDocument,u.map(p,da),g=0;g<l;g++)w=p[g],kb.test(w.type||"")&&!la.access(w,"globalEval")&&u.contains(f,w)&&(w.src?u._evalUrl&&u._evalUrl(w.src):d(w.textContent.replace(lb,""),f))}return e}function ea(e,a,b){for(var c=a?u.filter(a,e):e,d=0;null!=(a=c[d]);d++)b||1!==a.nodeType||u.cleanData(x(a)),a.parentNode&&(b&&u.contains(a.ownerDocument,a)&&z(x(a,"script")),a.parentNode.removeChild(a));return e}function Y(e,
a,b){var c,d,f,p,l=e.style;return b=b||Ac(e),b&&(p=b.getPropertyValue(a)||b[a],""!==p||u.contains(e.ownerDocument,e)||(p=u.style(e,a)),!oa.pixelMarginRight()&&Sb.test(p)&&Bc.test(a)&&(c=l.width,d=l.minWidth,f=l.maxWidth,l.minWidth=l.maxWidth=l.width=p,p=b.width,l.width=c,l.minWidth=d,l.maxWidth=f)),void 0!==p?p+"":p}function pa(e,a){return{get:function(){return e()?void delete this.get:(this.get=a).apply(this,arguments)}}}function N(e){var a=u.cssProps[e];if(!a){a=u.cssProps;a:{var b=e;if(!(b in qd)){for(var c=
b[0].toUpperCase()+b.slice(1),d=rd.length;d--;)if(b=rd[d]+c,b in qd)break a;b=void 0}}a=a[e]=b||e}return a}function Z(e,a,b){return(e=$a.exec(a))?Math.max(0,e[2]-(b||0))+(e[3]||"px"):a}function S(e,a,b,c,d){var f=0;for(a=b===(c?"border":"content")?4:"width"===a?1:0;4>a;a+=2)"margin"===b&&(f+=u.css(e,b+Ya[a],!0,d)),c?("content"===b&&(f-=u.css(e,"padding"+Ya[a],!0,d)),"margin"!==b&&(f-=u.css(e,"border"+Ya[a]+"Width",!0,d))):(f+=u.css(e,"padding"+Ya[a],!0,d),"padding"!==b&&(f+=u.css(e,"border"+Ya[a]+
"Width",!0,d)));return f}function K(e,a,b){var c,d=Ac(e),f=Y(e,a,d),p="border-box"===u.css(e,"boxSizing",!1,d);return Sb.test(f)?f:(c=p&&(oa.boxSizingReliable()||f===e.style[a]),"auto"===f&&(f=e["offset"+a[0].toUpperCase()+a.slice(1)]),f=parseFloat(f)||0,f+S(e,a,b||(p?"border":"content"),c,d)+"px")}function H(e,a,b,c,d){return new H.prototype.init(e,a,b,c,d)}function E(){Tb&&(!1===ca.hidden&&a.requestAnimationFrame?a.requestAnimationFrame(E):a.setTimeout(E,u.fx.interval),u.fx.tick())}function ra(){return a.setTimeout(function(){Ub=
void 0}),Ub=u.now()}function X(e,a){var b=0,c={height:e};for(a=a?1:0;4>b;b+=2-a){var d=Ya[b];c["margin"+d]=c["padding"+d]=e}return a&&(c.opacity=c.width=e),c}function I(e,a,b){for(var c,d=(ma.tweeners[a]||[]).concat(ma.tweeners["*"]),f=0,p=d.length;f<p;f++)if(c=d[f].call(b,a,e))return c}function sa(e,a){var b,c,d,f,p;for(b in e)if(c=u.camelCase(b),d=a[c],f=e[b],Array.isArray(f)&&(d=f[1],f=e[b]=f[0]),b!==c&&(e[c]=f,delete e[b]),p=u.cssHooks[c],p&&"expand"in p)for(b in f=p.expand(f),delete e[c],f)b in
e||(e[b]=f[b],a[b]=d);else a[c]=d}function ma(e,a,b){var c,d=0,f=ma.prefilters.length,p=u.Deferred().always(function(){delete l.elem}),l=function(){if(c)return!1;var a=Ub||ra();a=Math.max(0,g.startTime+g.duration-a);for(var b=1-(a/g.duration||0),d=0,f=g.tweens.length;d<f;d++)g.tweens[d].run(b);return p.notifyWith(e,[g,b,a]),1>b&&f?a:(f||p.notifyWith(e,[g,1,0]),p.resolveWith(e,[g]),!1)},g=p.promise({elem:e,props:u.extend({},a),opts:u.extend(!0,{specialEasing:{},easing:u.easing._default},b),originalProperties:a,
originalOptions:b,startTime:Ub||ra(),duration:b.duration,tweens:[],createTween:function(a,b){a=u.Tween(e,g.opts,a,b,g.opts.specialEasing[a]||g.opts.easing);return g.tweens.push(a),a},stop:function(a){var b=0,d=a?g.tweens.length:0;if(c)return this;for(c=!0;b<d;b++)g.tweens[b].run(1);return a?(p.notifyWith(e,[g,1,0]),p.resolveWith(e,[g,a])):p.rejectWith(e,[g,a]),this}});b=g.props;for(sa(b,g.opts.specialEasing);d<f;d++)if(a=ma.prefilters[d].call(g,e,b,g.opts))return u.isFunction(a.stop)&&(u._queueHooks(g.elem,
g.opts.queue).stop=u.proxy(a.stop,a)),a;return u.map(b,I,g),u.isFunction(g.opts.start)&&g.opts.start.call(e,g),g.progress(g.opts.progress).done(g.opts.done,g.opts.complete).fail(g.opts.fail).always(g.opts.always),u.fx.timer(u.extend(l,{elem:e,anim:g,queue:g.opts.queue})),g}function Q(e){return(e.match(Wa)||[]).join(" ")}function R(e){return e.getAttribute&&e.getAttribute("class")||""}function ua(e,a,b,c){var d;if(Array.isArray(a))u.each(a,function(a,d){b||sd.test(e)?c(e,d):ua(e+"["+("object"==typeof d&&
null!=d?a:"")+"]",d,b,c)});else if(b||"object"!==u.type(a))c(e,a);else for(d in a)ua(e+"["+d+"]",a[d],b,c)}function C(e){return function(a,b){"string"!=typeof a&&(b=a,a="*");var c=0,d=a.toLowerCase().match(Wa)||[];if(u.isFunction(b))for(;a=d[c++];)"+"===a[0]?(a=a.slice(1)||"*",(e[a]=e[a]||[]).unshift(b)):(e[a]=e[a]||[]).push(b)}}function W(e,a,b,c){function d(l){var g;return f[l]=!0,u.each(e[l]||[],function(e,l){e=l(a,b,c);return"string"!=typeof e||p||f[e]?p?!(g=e):void 0:(a.dataTypes.unshift(e),
d(e),!1)}),g}var f={},p=e===Vb;return d(a.dataTypes[0])||!f["*"]&&d("*")}function O(e,a){var b,c,d=u.ajaxSettings.flatOptions||{};for(b in a)void 0!==a[b]&&((d[b]?e:c||(c={}))[b]=a[b]);return c&&u.extend(!0,e,c),e}var Ba=[],ca=a.document,Ja=Object.getPrototypeOf,qa=Ba.slice,Ua=Ba.concat,Ca=Ba.push,Ga=Ba.indexOf,Da={},Ma=Da.toString,ia=Da.hasOwnProperty,Ka=ia.toString,ab=Ka.call(Object),oa={},u=function(e,a){return new u.fn.init(e,a)},ya=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,mb=/^-ms-/,Ea=/-([a-z])/g,
eb=function(e,a){return a.toUpperCase()};$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();u.fn=u.prototype={jquery:"3.2.1",constructor:u,length:0,toArray:function(){return qa.call(this)},get:function(e){return null==e?qa.call(this):0>e?this[e+this.length]:this[e]},pushStack:function(e){e=u.merge(this.constructor(),e);return e.prevObject=this,e},each:function(e){return u.each(this,e)},map:function(e){return this.pushStack(u.map(this,
function(a,b){return e.call(a,b,a)}))},slice:function(){return this.pushStack(qa.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var a=this.length;e=+e+(0>e?a:0);return this.pushStack(0<=e&&e<a?[this[e]]:[])},end:function(){return this.prevObject||this.constructor()},push:Ca,sort:Ba.sort,splice:Ba.splice};u.extend=u.fn.extend=function(){var e,a,b,c,d=arguments[0]||{},f=1,p=arguments.length,l=!1;"boolean"==typeof d&&(l=d,d=arguments[f]||
{},f++);"object"==typeof d||u.isFunction(d)||(d={});for(f===p&&(d=this,f--);f<p;f++)if(null!=(e=arguments[f]))for(a in e){var g=d[a];var m=e[a];d!==m&&(l&&m&&(u.isPlainObject(m)||(b=Array.isArray(m)))?(b?(b=!1,c=g&&Array.isArray(g)?g:[]):c=g&&u.isPlainObject(g)?g:{},d[a]=u.extend(l,c,m)):void 0!==m&&(d[a]=m))}return d};u.extend({expando:"jQuery"+("3.2.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw Error(e);},noop:function(){},isFunction:function(e){return"function"===u.type(e)},
isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var a=u.type(e);return("number"===a||"string"===a)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var a,b;return!(!e||"[object Object]"!==Ma.call(e))&&(!(a=Ja(e))||(b=ia.call(a,"constructor")&&a.constructor,"function"==typeof b&&Ka.call(b)===ab))},isEmptyObject:function(e){for(var a in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?Da[Ma.call(e)]||"object":typeof e},globalEval:function(e){d(e)},
camelCase:function(e){return e.replace(mb,"ms-").replace(Ea,eb)},each:function(e,a){var b,d=0;if(c(e))for(b=e.length;d<b&&!1!==a.call(e[d],d,e[d]);d++);else for(d in e)if(!1===a.call(e[d],d,e[d]))break;return e},trim:function(e){return null==e?"":(e+"").replace(ya,"")},makeArray:function(e,a){a=a||[];return null!=e&&(c(Object(e))?u.merge(a,"string"==typeof e?[e]:e):Ca.call(a,e)),a},inArray:function(e,a,b){return null==a?-1:Ga.call(a,e,b)},merge:function(e,a){for(var b=+a.length,c=0,d=e.length;c<b;c++)e[d++]=
a[c];return e.length=d,e},grep:function(e,a,b){for(var c=[],d=0,f=e.length,p=!b;d<f;d++)b=!a(e[d],d),b!==p&&c.push(e[d]);return c},map:function(e,a,b){var d,f=0,p=[];if(c(e))for(d=e.length;f<d;f++){var l=a(e[f],f,b);null!=l&&p.push(l)}else for(f in e)l=a(e[f],f,b),null!=l&&p.push(l);return Ua.apply([],p)},guid:1,proxy:function(e,a){var b,c,d;if("string"==typeof a&&(b=e[a],a=e,e=b),u.isFunction(e))return c=qa.call(arguments,2),d=function(){return e.apply(a||this,c.concat(qa.call(arguments)))},d.guid=
e.guid=e.guid||u.guid++,d},now:Date.now,support:oa});"function"==typeof Symbol&&(u.fn[Symbol.iterator]=Ba[Symbol.iterator]);u.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,a){Da["[object "+a+"]"]=a.toLowerCase()});var ka=function(e){function a(e,a,b,c){var d,f,p,l,g=a&&a.ownerDocument,m=a?a.nodeType:9;if(b=b||[],"string"!=typeof e||!e||1!==m&&9!==m&&11!==m)return b;if(!c&&((a?a.ownerDocument||a:qa)!==I&&Ha(a),a=a||I,H)){if(11!==m&&(l=O.exec(e)))if(d=
l[1])if(9===m){if(!(f=a.getElementById(d)))return b;if(f.id===d)return b.push(f),b}else{if(g&&(f=g.getElementById(d))&&P(a,f)&&f.id===d)return b.push(f),b}else{if(l[2])return N.apply(b,a.getElementsByTagName(e)),b;if((d=l[3])&&za.getElementsByClassName&&a.getElementsByClassName)return N.apply(b,a.getElementsByClassName(d)),b}if(!(!za.qsa||Q[e+" "]||J&&J.test(e))){if(1!==m){g=a;var n=e}else if("object"!==a.nodeName.toLowerCase()){(p=a.getAttribute("id"))?p=p.replace(aa,W):a.setAttribute("id",p=ba);
f=Ka(e);for(d=f.length;d--;)f[d]="#"+p+" "+w(f[d]);n=f.join(",");g=ua.test(e)&&t(a.parentNode)||a}if(n)try{return N.apply(b,g.querySelectorAll(n)),b}catch(zb){}finally{p===ba&&a.removeAttribute("id")}}}return G(e.replace(Sa,"$1"),a,b,c)}function b(){function e(b,c){return a.push(b+" ")>ia.cacheLength&&delete e[a.shift()],e[b+" "]=c}var a=[];return e}function c(e){return e[ba]=!0,e}function d(e){var a=I.createElement("fieldset");try{return!!e(a)}catch(hc){return!1}finally{a.parentNode&&a.parentNode.removeChild(a)}}
function f(e,a){e=e.split("|");for(var b=e.length;b--;)ia.attrHandle[e[b]]=a}function p(e,a){var b=a&&e,c=b&&1===e.nodeType&&1===a.nodeType&&e.sourceIndex-a.sourceIndex;if(c)return c;if(b)for(;b=b.nextSibling;)if(b===a)return-1;return e?1:-1}function l(e){return function(a){return"input"===a.nodeName.toLowerCase()&&a.type===e}}function g(e){return function(a){var b=a.nodeName.toLowerCase();return("input"===b||"button"===b)&&a.type===e}}function m(e){return function(a){return"form"in a?a.parentNode&&
!1===a.disabled?"label"in a?"label"in a.parentNode?a.parentNode.disabled===e:a.disabled===e:a.isDisabled===e||a.isDisabled!==!e&&Ma(a)===e:a.disabled===e:"label"in a&&a.disabled===e}}function n(e){return c(function(a){return a=+a,c(function(b,c){for(var d,f=e([],b.length,a),p=f.length;p--;)b[d=f[p]]&&(b[d]=!(c[d]=b[d]))})})}function t(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function q(){}function w(e){for(var a=0,b=e.length,c="";a<b;a++)c+=e[a].value;return c}function y(e,a,b){var c=
a.dir,d=a.next,f=d||c,p=b&&"parentNode"===f,l=fa++;return a.first?function(a,b,d){for(;a=a[c];)if(1===a.nodeType||p)return e(a,b,d);return!1}:function(a,b,g){var m,n,t,q=[sa,l];if(g)for(;a=a[c];){if((1===a.nodeType||p)&&e(a,b,g))return!0}else for(;a=a[c];)if(1===a.nodeType||p)if(t=a[ba]||(a[ba]={}),n=t[a.uniqueID]||(t[a.uniqueID]={}),d&&d===a.nodeName.toLowerCase())a=a[c]||a;else{if((m=n[f])&&m[0]===sa&&m[1]===l)return q[2]=m[2];if(n[f]=q,q[2]=e(a,b,g))return!0}return!1}}function x(e){return 1<e.length?
function(a,b,c){for(var d=e.length;d--;)if(!e[d](a,b,c))return!1;return!0}:e[0]}function A(e,a,b,c,d){for(var f,p=[],l=0,g=e.length,m=null!=a;l<g;l++)(f=e[l])&&(b&&!b(f,c,d)||(p.push(f),m&&a.push(l)));return p}function z(e,b,d,f,p,l){return f&&!f[ba]&&(f=z(f)),p&&!p[ba]&&(p=z(p,l)),c(function(c,l,g,m){var n,t=[],q=[],w=l.length,y;if(!(y=c)){y=b||"*";for(var x=g.nodeType?[g]:g,z=[],D=0,pb=x.length;D<pb;D++)a(y,x[D],z);y=z}y=!e||!c&&b?y:A(y,t,e,g,m);x=d?p||(c?e:w||f)?[]:l:y;if(d&&d(y,x,g,m),f){var B=
A(x,q);f(B,[],g,m);for(g=B.length;g--;)(n=B[g])&&(x[q[g]]=!(y[q[g]]=n))}if(c){if(p||e){if(p){B=[];for(g=x.length;g--;)(n=x[g])&&B.push(y[g]=n);p(null,x=[],B,m)}for(g=x.length;g--;)(n=x[g])&&-1<(B=p?ea(c,n):t[g])&&(c[B]=!(l[B]=n))}}else x=A(x===l?x.splice(w,x.length):x),p?p(null,l,x,m):N.apply(l,x)})}function D(e){var a,b,c=e.length,d=ia.relative[e[0].type];var f=d||ia.relative[" "];for(var p=d?1:0,l=y(function(e){return e===a},f,!0),g=y(function(e){return-1<ea(a,e)},f,!0),m=[function(e,b,c){e=!d&&
(c||b!==u)||((a=b).nodeType?l(e,b,c):g(e,b,c));return a=null,e}];p<c;p++)if(f=ia.relative[e[p].type])m=[y(x(m),f)];else{if(f=ia.filter[e[p].type].apply(null,e[p].matches),f[ba]){for(b=++p;b<c&&!ia.relative[e[b].type];b++);return z(1<p&&x(m),1<p&&w(e.slice(0,p-1).concat({value:" "===e[p-2].type?"*":""})).replace(Sa,"$1"),f,p<b&&D(e.slice(p,b)),b<c&&D(e=e.slice(b)),b<c&&w(e))}m.push(f)}return x(m)}function pb(e,b){var d=0<b.length,f=0<e.length,p=function(c,p,l,g,m){var n,t,q=0,w="0",y=c&&[],x=[],z=
u,D=c||f&&ia.find.TAG("*",m),pb=sa+=null==z?1:Math.random()||.1,B=D.length;for(m&&(u=p===I||p||m);w!==B&&null!=(n=D[w]);w++){if(f&&n){var K=0;for(p||n.ownerDocument===I||(Ha(n),l=!H);t=e[K++];)if(t(n,p||I,l)){g.push(n);break}m&&(sa=pb)}d&&((n=!t&&n)&&q--,c&&y.push(n))}if(q+=w,d&&w!==q){for(K=0;t=b[K++];)t(y,x,p,l);if(c){if(0<q)for(;w--;)y[w]||x[w]||(x[w]=la.call(g));x=A(x)}N.apply(g,x);m&&!c&&0<x.length&&1<q+b.length&&a.uniqueSort(g)}return m&&(sa=pb,u=z),y};return d?c(p):p}var B,K,G,u,E,X,I,L,H,
J,ma,ra,P,ba="sizzle"+1*new Date,qa=e.document,sa=0,fa=0,C=b(),V=b(),Q=b(),da=function(e,a){return e===a&&(X=!0),0},R={}.hasOwnProperty,M=[],la=M.pop,Ua=M.push,N=M.push,Y=M.slice,ea=function(e,a){for(var b=0,c=e.length;b<c;b++)if(e[b]===a)return b;return-1},Ca=/[\x20\t\r\n\f]+/g,Sa=/^[\x20\t\r\n\f]+|((?:^|[^\\])(?:\\.)*)[\x20\t\r\n\f]+$/g,S=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,Z=/^[\x20\t\r\n\f]*([>+~]|[\x20\t\r\n\f])[\x20\t\r\n\f]*/,Qa=/=[\x20\t\r\n\f]*([^\]'"]*?)[\x20\t\r\n\f]*\]/g,Ga=/:((?:\\.|[\w-]|[^\x00-\xa0])+)(?:\((('((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)")|((?:\\.|[^\\()[\]]|\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\x00-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\x00-\xa0])+))|)[\x20\t\r\n\f]*\])*)|.*)\)|)/,
wa=/^(?:\\.|[\w-]|[^\x00-\xa0])+$/,cb={ID:/^#((?:\\.|[\w-]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[\w-]|[^\x00-\xa0])+)/,TAG:/^((?:\\.|[\w-]|[^\x00-\xa0])+|[*])/,ATTR:/^\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\x00-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\x00-\xa0])+))|)[\x20\t\r\n\f]*\]/,PSEUDO:/^:((?:\\.|[\w-]|[^\x00-\xa0])+)(?:\((('((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)")|((?:\\.|[^\\()[\]]|\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\x00-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\x00-\xa0])+))|)[\x20\t\r\n\f]*\])*)|.*)\)|)/,
CHILD:/^:(only|first|last|nth|nth-last)-(child|of-type)(?:\([\x20\t\r\n\f]*(even|odd|(([+-]|)(\d*)n|)[\x20\t\r\n\f]*(?:([+-]|)[\x20\t\r\n\f]*(\d+)|))[\x20\t\r\n\f]*\)|)/i,bool:/^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$/i,needsContext:/^[\x20\t\r\n\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\([\x20\t\r\n\f]*((?:-\d)?\d*)[\x20\t\r\n\f]*\)|)(?=[^-]|$)/i},pa=/^(?:input|select|textarea|button)$/i,Da=/^h\d$/i,Ba=
/^[^{]+\{\s*\[native \w/,O=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ua=/[+~]/,ca=/\\([\da-f]{1,6}[\x20\t\r\n\f]?|([\x20\t\r\n\f])|.)/ig,Xa=function(e,a,b){e="0x"+a-65536;return e!==e||b?a:0>e?String.fromCharCode(e+65536):String.fromCharCode(e>>10|55296,1023&e|56320)},aa=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,W=function(e,a){return a?"\x00"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},jb=function(){Ha()},Ma=y(function(e){return!0===e.disabled&&("form"in
e||"label"in e)},{dir:"parentNode",next:"legend"});try{N.apply(M=Y.call(qa.childNodes),qa.childNodes),M[qa.childNodes.length].nodeType}catch(Xd){N={apply:M.length?function(e,a){Ua.apply(e,Y.call(a))}:function(e,a){for(var b=e.length,c=0;e[b++]=a[c++];);e.length=b-1}}}var za=a.support={};var gb=a.isXML=function(e){e=e&&(e.ownerDocument||e).documentElement;return!!e&&"HTML"!==e.nodeName};var Ha=a.setDocument=function(e){var a,b;e=e?e.ownerDocument||e:qa;return e!==I&&9===e.nodeType&&e.documentElement?
(I=e,L=I.documentElement,H=!gb(I),qa!==I&&(b=I.defaultView)&&b.top!==b&&(b.addEventListener?b.addEventListener("unload",jb,!1):b.attachEvent&&b.attachEvent("onunload",jb)),za.attributes=d(function(e){return e.className="i",!e.getAttribute("className")}),za.getElementsByTagName=d(function(e){return e.appendChild(I.createComment("")),!e.getElementsByTagName("*").length}),za.getElementsByClassName=Ba.test(I.getElementsByClassName),za.getById=d(function(e){return L.appendChild(e).id=ba,!I.getElementsByName||
!I.getElementsByName(ba).length}),za.getById?(ia.filter.ID=function(e){var a=e.replace(ca,Xa);return function(e){return e.getAttribute("id")===a}},ia.find.ID=function(e,a){if("undefined"!=typeof a.getElementById&&H)return(e=a.getElementById(e))?[e]:[]}):(ia.filter.ID=function(e){var a=e.replace(ca,Xa);return function(e){return(e="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id"))&&e.value===a}},ia.find.ID=function(e,a){if("undefined"!=typeof a.getElementById&&H){var b,c=a.getElementById(e);
if(c){if(b=c.getAttributeNode("id"),b&&b.value===e)return[c];var d=a.getElementsByName(e);for(a=0;c=d[a++];)if(b=c.getAttributeNode("id"),b&&b.value===e)return[c]}return[]}}),ia.find.TAG=za.getElementsByTagName?function(e,a){return"undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(e):za.qsa?a.querySelectorAll(e):void 0}:function(e,a){var b=[],c=0;a=a.getElementsByTagName(e);if("*"===e){for(;e=a[c++];)1===e.nodeType&&b.push(e);return b}return a},ia.find.CLASS=za.getElementsByClassName&&
function(e,a){if("undefined"!=typeof a.getElementsByClassName&&H)return a.getElementsByClassName(e)},ma=[],J=[],(za.qsa=Ba.test(I.querySelectorAll))&&(d(function(e){L.appendChild(e).innerHTML="<a id='"+ba+"'></a><select id='"+ba+"-\r\\' msallowcapture=''><option selected=''></option></select>";e.querySelectorAll("[msallowcapture^='']").length&&J.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")");e.querySelectorAll("[selected]").length||J.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)");
e.querySelectorAll("[id~="+ba+"-]").length||J.push("~=");e.querySelectorAll(":checked").length||J.push(":checked");e.querySelectorAll("a#"+ba+"+*").length||J.push(".#.+[+~]")}),d(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var a=I.createElement("input");a.setAttribute("type","hidden");e.appendChild(a).setAttribute("name","D");e.querySelectorAll("[name=d]").length&&J.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?=");2!==e.querySelectorAll(":enabled").length&&
J.push(":enabled",":disabled");L.appendChild(e).disabled=!0;2!==e.querySelectorAll(":disabled").length&&J.push(":enabled",":disabled");e.querySelectorAll("*,:x");J.push(",.*:")})),(za.matchesSelector=Ba.test(ra=L.matches||L.webkitMatchesSelector||L.mozMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&d(function(e){za.disconnectedMatch=ra.call(e,"*");ra.call(e,"[s!='']:x");ma.push("!=",":((?:\\\\.|[\\w-]|[^\x00-\\xa0])+)(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[\\w-]|[^\x00-\\xa0])+)(?:[\\x20\\t\\r\\n\\f]*([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|((?:\\\\.|[\\w-]|[^\x00-\\xa0])+))|)[\\x20\\t\\r\\n\\f]*\\])*)|.*)\\)|)")}),
J=J.length&&new RegExp(J.join("|")),ma=ma.length&&new RegExp(ma.join("|")),a=Ba.test(L.compareDocumentPosition),P=a||Ba.test(L.contains)?function(e,a){var b=9===e.nodeType?e.documentElement:e;a=a&&a.parentNode;return e===a||!(!a||1!==a.nodeType||!(b.contains?b.contains(a):e.compareDocumentPosition&&16&e.compareDocumentPosition(a)))}:function(e,a){if(a)for(;a=a.parentNode;)if(a===e)return!0;return!1},da=a?function(e,a){if(e===a)return X=!0,0;var b=!e.compareDocumentPosition-!a.compareDocumentPosition;
return b?b:(b=(e.ownerDocument||e)===(a.ownerDocument||a)?e.compareDocumentPosition(a):1,1&b||!za.sortDetached&&a.compareDocumentPosition(e)===b?e===I||e.ownerDocument===qa&&P(qa,e)?-1:a===I||a.ownerDocument===qa&&P(qa,a)?1:E?ea(E,e)-ea(E,a):0:4&b?-1:1)}:function(e,a){if(e===a)return X=!0,0;var b=0,c=e.parentNode,d=a.parentNode,f=[e],l=[a];if(!c||!d)return e===I?-1:a===I?1:c?-1:d?1:E?ea(E,e)-ea(E,a):0;if(c===d)return p(e,a);for(;e=e.parentNode;)f.unshift(e);for(e=a;e=e.parentNode;)l.unshift(e);for(;f[b]===
l[b];)b++;return b?p(f[b],l[b]):f[b]===qa?-1:l[b]===qa?1:0},I):I};a.matches=function(e,b){return a(e,null,null,b)};a.matchesSelector=function(e,b){if((e.ownerDocument||e)!==I&&Ha(e),b=b.replace(Qa,"='$1']"),!(!za.matchesSelector||!H||Q[b+" "]||ma&&ma.test(b)||J&&J.test(b)))try{var c=ra.call(e,b);if(c||za.disconnectedMatch||e.document&&11!==e.document.nodeType)return c}catch(td){}return 0<a(b,I,null,[e]).length};a.contains=function(e,a){return(e.ownerDocument||e)!==I&&Ha(e),P(e,a)};a.attr=function(e,
a){(e.ownerDocument||e)!==I&&Ha(e);var b=ia.attrHandle[a.toLowerCase()];b=b&&R.call(ia.attrHandle,a.toLowerCase())?b(e,a,!H):void 0;return void 0!==b?b:za.attributes||!H?e.getAttribute(a):(b=e.getAttributeNode(a))&&b.specified?b.value:null};a.escape=function(e){return(e+"").replace(aa,W)};a.error=function(e){throw Error("Syntax error, unrecognized expression: "+e);};a.uniqueSort=function(e){var a,b=[],c=0,d=0;if(X=!za.detectDuplicates,E=!za.sortStable&&e.slice(0),e.sort(da),X){for(;a=e[d++];)a===
e[d]&&(c=b.push(d));for(;c--;)e.splice(b[c],1)}return E=null,e};var Bb=a.getText=function(e){var a,b="",c=0;if(a=e.nodeType)if(1===a||9===a||11===a){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)b+=Bb(e)}else{if(3===a||4===a)return e.nodeValue}else for(;a=e[c++];)b+=Bb(a);return b};var ia=a.selectors={cacheLength:50,createPseudo:c,match:cb,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",
first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(ca,Xa),e[3]=(e[3]||e[4]||e[5]||"").replace(ca,Xa),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||a.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&a.error(e[0]),e},PSEUDO:function(e){var a,b=!e[6]&&e[2];return cb.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":b&&Ga.test(b)&&
(a=Ka(b,!0))&&(a=b.indexOf(")",b.length-a)-b.length)&&(e[0]=e[0].slice(0,a),e[2]=b.slice(0,a)),e.slice(0,3))}},filter:{TAG:function(e){var a=e.replace(ca,Xa).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===a}},CLASS:function(e){var a=C[e+" "];return a||(a=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+e+"([\\x20\\t\\r\\n\\f]|$)"),C(e,function(e){return a.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||
"")}))},ATTR:function(e,b,c){return function(d){d=a.attr(d,e);return null==d?"!="===b:!b||(d+="","="===b?d===c:"!="===b?d!==c:"^="===b?c&&0===d.indexOf(c):"*="===b?c&&-1<d.indexOf(c):"$="===b?c&&d.slice(-c.length)===c:"~="===b?-1<(" "+d.replace(Ca," ")+" ").indexOf(c):"|="===b&&(d===c||d.slice(0,c.length+1)===c+"-"))}},CHILD:function(e,a,b,c,d){var f="nth"!==e.slice(0,3),p="last"!==e.slice(-4),l="of-type"===a;return 1===c&&0===d?function(e){return!!e.parentNode}:function(a,b,g){var m,n;b=f!==p?"nextSibling":
"previousSibling";var t=a.parentNode,q=l&&a.nodeName.toLowerCase();g=!g&&!l;var w=!1;if(t){if(f){for(;b;){for(m=a;m=m[b];)if(l?m.nodeName.toLowerCase()===q:1===m.nodeType)return!1;var y=b="only"===e&&!y&&"nextSibling"}return!0}if(y=[p?t.firstChild:t.lastChild],p&&g){m=t;var x=m[ba]||(m[ba]={});var A=x[m.uniqueID]||(x[m.uniqueID]={});var z=A[e]||[];w=(n=z[0]===sa&&z[1])&&z[2];for(m=n&&t.childNodes[n];m=++n&&m&&m[b]||(w=n=0)||y.pop();)if(1===m.nodeType&&++w&&m===a){A[e]=[sa,n,w];break}}else if(g&&(m=
a,x=m[ba]||(m[ba]={}),A=x[m.uniqueID]||(x[m.uniqueID]={}),z=A[e]||[],n=z[0]===sa&&z[1],w=n),!1===w)for(;(m=++n&&m&&m[b]||(w=n=0)||y.pop())&&((l?m.nodeName.toLowerCase()!==q:1!==m.nodeType)||!++w||(g&&(x=m[ba]||(m[ba]={}),A=x[m.uniqueID]||(x[m.uniqueID]={}),A[e]=[sa,w]),m!==a)););return w-=d,w===c||0===w%c&&0<=w/c}}},PSEUDO:function(e,b){var d,f=ia.pseudos[e]||ia.setFilters[e.toLowerCase()]||a.error("unsupported pseudo: "+e);return f[ba]?f(b):1<f.length?(d=[e,e,"",b],ia.setFilters.hasOwnProperty(e.toLowerCase())?
c(function(e,a){for(var c,d=f(e,b),p=d.length;p--;)c=ea(e,d[p]),e[c]=!(a[c]=d[p])}):function(e){return f(e,0,d)}):f}},pseudos:{not:c(function(e){var a=[],b=[],d=K(e.replace(Sa,"$1"));return d[ba]?c(function(e,a,b,c){var f;b=d(e,null,c,[]);for(c=e.length;c--;)(f=b[c])&&(e[c]=!(a[c]=f))}):function(e,c,f){return a[0]=e,d(a,null,f,b),a[0]=null,!b.pop()}}),has:c(function(e){return function(b){return 0<a(e,b).length}}),contains:c(function(e){return e=e.replace(ca,Xa),function(a){return-1<(a.textContent||
a.innerText||Bb(a)).indexOf(e)}}),lang:c(function(e){return wa.test(e||"")||a.error("unsupported lang: "+e),e=e.replace(ca,Xa).toLowerCase(),function(a){var b;do if(b=H?a.lang:a.getAttribute("xml:lang")||a.getAttribute("lang"))return b=b.toLowerCase(),b===e||0===b.indexOf(e+"-");while((a=a.parentNode)&&1===a.nodeType);return!1}}),target:function(a){var b=e.location&&e.location.hash;return b&&b.slice(1)===a.id},root:function(e){return e===L},focus:function(e){return e===I.activeElement&&(!I.hasFocus||
I.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:m(!1),disabled:m(!0),checked:function(e){var a=e.nodeName.toLowerCase();return"input"===a&&!!e.checked||"option"===a&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(6>e.nodeType)return!1;return!0},parent:function(e){return!ia.pseudos.empty(e)},header:function(e){return Da.test(e.nodeName)},input:function(e){return pa.test(e.nodeName)},
button:function(e){var a=e.nodeName.toLowerCase();return"input"===a&&"button"===e.type||"button"===a},text:function(e){var a;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(a=e.getAttribute("type"))||"text"===a.toLowerCase())},first:n(function(){return[0]}),last:n(function(e,a){return[a-1]}),eq:n(function(e,a,b){return[0>b?b+a:b]}),even:n(function(e,a){for(var b=0;b<a;b+=2)e.push(b);return e}),odd:n(function(e,a){for(var b=1;b<a;b+=2)e.push(b);return e}),lt:n(function(e,a,b){for(a=
0>b?b+a:b;0<=--a;)e.push(a);return e}),gt:n(function(e,a,b){for(b=0>b?b+a:b;++b<a;)e.push(b);return e})}};ia.pseudos.nth=ia.pseudos.eq;for(B in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})ia.pseudos[B]=l(B);for(B in{submit:!0,reset:!0})ia.pseudos[B]=g(B);q.prototype=ia.filters=ia.pseudos;ia.setFilters=new q;var Ka=a.tokenize=function(e,b){var c,d,f,p,l;if(p=V[e+" "])return b?0:p.slice(0);p=e;var g=[];for(l=ia.preFilter;p;){m&&!(c=S.exec(p))||(c&&(p=p.slice(c[0].length)||p),g.push(d=[]));var m=
!1;(c=Z.exec(p))&&(m=c.shift(),d.push({value:m,type:c[0].replace(Sa," ")}),p=p.slice(m.length));for(f in ia.filter)!(c=cb[f].exec(p))||l[f]&&!(c=l[f](c))||(m=c.shift(),d.push({value:m,type:f,matches:c}),p=p.slice(m.length));if(!m)break}return b?p.length:p?a.error(e):V(e,g).slice(0)};return K=a.compile=function(e,a){var b,c=[],d=[],f=Q[e+" "];if(!f){a||(a=Ka(e));for(b=a.length;b--;)f=D(a[b]),f[ba]?c.push(f):d.push(f);f=Q(e,pb(d,c));f.selector=e}return f},G=a.select=function(e,a,b,c){var d,f,p,l,g,
m="function"==typeof e&&e,n=!c&&Ka(e=m.selector||e);if(b=b||[],1===n.length){if(f=n[0]=n[0].slice(0),2<f.length&&"ID"===(p=f[0]).type&&9===a.nodeType&&H&&ia.relative[f[1].type]){if(a=(ia.find.ID(p.matches[0].replace(ca,Xa),a)||[])[0],!a)return b;m&&(a=a.parentNode);e=e.slice(f.shift().value.length)}for(d=cb.needsContext.test(e)?0:f.length;d--&&(p=f[d],!ia.relative[l=p.type]);)if((g=ia.find[l])&&(c=g(p.matches[0].replace(ca,Xa),ua.test(f[0].type)&&t(a.parentNode)||a))){if(f.splice(d,1),e=c.length&&
w(f),!e)return N.apply(b,c),b;break}}return(m||K(e,n))(c,a,!H,b,!a||ua.test(e)&&t(a.parentNode)||a),b},za.sortStable=ba.split("").sort(da).join("")===ba,za.detectDuplicates=!!X,Ha(),za.sortDetached=d(function(e){return 1&e.compareDocumentPosition(I.createElement("fieldset"))}),d(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||f("type|href|height|width",function(e,a,b){if(!b)return e.getAttribute(a,"type"===a.toLowerCase()?1:2)}),za.attributes&&d(function(e){return e.innerHTML=
"<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||f("value",function(e,a,b){if(!b&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),d(function(e){return null==e.getAttribute("disabled")})||f("checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",function(e,a,b){var c;if(!b)return!0===e[a]?a.toLowerCase():(c=e.getAttributeNode(a))&&c.specified?c.value:null}),a}(a);u.find=ka;u.expr=
ka.selectors;u.expr[":"]=u.expr.pseudos;u.uniqueSort=u.unique=ka.uniqueSort;u.text=ka.getText;u.isXMLDoc=ka.isXML;u.contains=ka.contains;u.escapeSelector=ka.escape;var La=function(e,a,b){for(var c=[],d=void 0!==b;(e=e[a])&&9!==e.nodeType;)if(1===e.nodeType){if(d&&u(e).is(b))break;c.push(e)}return c},wa=function(e,a){for(var b=[];e;e=e.nextSibling)1===e.nodeType&&e!==a&&b.push(e);return b},cb=u.expr.match.needsContext,jb=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,qb=/^.[^:#\[\.,]*$/;
u.filter=function(e,a,b){var c=a[0];return b&&(e=":not("+e+")"),1===a.length&&1===c.nodeType?u.find.matchesSelector(c,e)?[c]:[]:u.find.matches(e,u.grep(a,function(e){return 1===e.nodeType}))};u.fn.extend({find:function(e){var a,b=this.length,c=this;if("string"!=typeof e)return this.pushStack(u(e).filter(function(){for(a=0;a<b;a++)if(u.contains(c[a],this))return!0}));var d=this.pushStack([]);for(a=0;a<b;a++)u.find(e,c[a],d);return 1<b?u.uniqueSort(d):d},filter:function(e){return this.pushStack(g(this,
e||[],!1))},not:function(e){return this.pushStack(g(this,e||[],!0))},is:function(e){return!!g(this,"string"==typeof e&&cb.test(e)?u(e):e||[],!1).length}});var nb=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(u.fn.init=function(e,a,b){var c,d;if(!e)return this;if(b=b||Ob,"string"==typeof e){if(c="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:nb.exec(e),!c||!c[1]&&a)return!a||a.jquery?(a||b).find(e):this.constructor(a).find(e);if(c[1]){if(a=a instanceof u?a[0]:a,u.merge(this,u.parseHTML(c[1],a&&
a.nodeType?a.ownerDocument||a:ca,!0)),jb.test(c[1])&&u.isPlainObject(a))for(c in a)u.isFunction(this[c])?this[c](a[c]):this.attr(c,a[c]);return this}return d=ca.getElementById(c[2]),d&&(this[0]=d,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):u.isFunction(e)?void 0!==b.ready?b.ready(e):e(u):u.makeArray(e,this)}).prototype=u.fn;var Ob=u(ca);var gb=/^(?:parents|prev(?:Until|All))/,Ha={children:!0,contents:!0,next:!0,prev:!0};u.fn.extend({has:function(e){var a=u(e,this),b=a.length;
return this.filter(function(){for(var e=0;e<b;e++)if(u.contains(this,a[e]))return!0})},closest:function(e,a){var b,c=0,d=this.length,f=[],p="string"!=typeof e&&u(e);if(!cb.test(e))for(;c<d;c++)for(b=this[c];b&&b!==a;b=b.parentNode)if(11>b.nodeType&&(p?-1<p.index(b):1===b.nodeType&&u.find.matchesSelector(b,e))){f.push(b);break}return this.pushStack(1<f.length?u.uniqueSort(f):f)},index:function(e){return e?"string"==typeof e?Ga.call(u(e),this[0]):Ga.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?
this.first().prevAll().length:-1},add:function(e,a){return this.pushStack(u.uniqueSort(u.merge(this.get(),u(e,a))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}});u.each({parent:function(e){return(e=e.parentNode)&&11!==e.nodeType?e:null},parents:function(e){return La(e,"parentNode")},parentsUntil:function(e,a,b){return La(e,"parentNode",b)},next:function(e){return m(e,"nextSibling")},prev:function(e){return m(e,"previousSibling")},nextAll:function(e){return La(e,
"nextSibling")},prevAll:function(e){return La(e,"previousSibling")},nextUntil:function(e,a,b){return La(e,"nextSibling",b)},prevUntil:function(e,a,b){return La(e,"previousSibling",b)},siblings:function(e){return wa((e.parentNode||{}).firstChild,e)},children:function(e){return wa(e.firstChild)},contents:function(e){return f(e,"iframe")?e.contentDocument:(f(e,"template")&&(e=e.content||e),u.merge([],e.childNodes))}},function(e,a){u.fn[e]=function(b,c){var d=u.map(this,a,b);return"Until"!==e.slice(-5)&&
(c=b),c&&"string"==typeof c&&(d=u.filter(c,d)),1<this.length&&(Ha[e]||u.uniqueSort(d),gb.test(e)&&d.reverse()),this.pushStack(d)}});var Wa=/[^\x20\t\r\n\f]+/g;u.Callbacks=function(e){e="string"==typeof e?l(e):u.extend({},e);var a,b,c,d,f=[],p=[],g=-1,m=function(){d=d||e.once;for(c=a=!0;p.length;g=-1)for(b=p.shift();++g<f.length;)!1===f[g].apply(b[0],b[1])&&e.stopOnFalse&&(g=f.length,b=!1);e.memory||(b=!1);a=!1;d&&(f=b?[]:"")},n={add:function(){return f&&(b&&!a&&(g=f.length-1,p.push(b)),function zc(a){u.each(a,
function(a,b){u.isFunction(b)?e.unique&&n.has(b)||f.push(b):b&&b.length&&"string"!==u.type(b)&&zc(b)})}(arguments),b&&!a&&m()),this},remove:function(){return u.each(arguments,function(e,a){for(var b;-1<(b=u.inArray(a,f,b));)f.splice(b,1),b<=g&&g--}),this},has:function(e){return e?-1<u.inArray(e,f):0<f.length},empty:function(){return f&&(f=[]),this},disable:function(){return d=p=[],f=b="",this},disabled:function(){return!f},lock:function(){return d=p=[],b||a||(f=b=""),this},locked:function(){return!!d},
fireWith:function(e,b){return d||(b=b||[],b=[e,b.slice?b.slice():b],p.push(b),a||m()),this},fire:function(){return n.fireWith(this,arguments),this},fired:function(){return!!c}};return n};u.extend({Deferred:function(e){var b=[["notify","progress",u.Callbacks("memory"),u.Callbacks("memory"),2],["resolve","done",u.Callbacks("once memory"),u.Callbacks("once memory"),0,"resolved"],["reject","fail",u.Callbacks("once memory"),u.Callbacks("once memory"),1,"rejected"]],c="pending",d={state:function(){return c},
always:function(){return f.done(arguments).fail(arguments),this},"catch":function(e){return d.then(null,e)},pipe:function(){var e=arguments;return u.Deferred(function(a){u.each(b,function(b,c){var d=u.isFunction(e[c[4]])&&e[c[4]];f[c[1]](function(){var e=d&&d.apply(this,arguments);e&&u.isFunction(e.promise)?e.promise().progress(a.notify).done(a.resolve).fail(a.reject):a[c[0]+"With"](this,d?[e]:arguments)})});e=null}).promise()},then:function(e,c,d){function f(e,b,c,d){return function(){var l=this,
g=arguments,m=function(){var a;if(!(e<p)){if(a=c.apply(l,g),a===b.promise())throw new TypeError("Thenable self-resolution");var m=a&&("object"==typeof a||"function"==typeof a)&&a.then;u.isFunction(m)?d?m.call(a,f(p,b,n,d),f(p,b,q,d)):(p++,m.call(a,f(p,b,n,d),f(p,b,q,d),f(p,b,n,b.notifyWith))):(c!==n&&(l=void 0,g=[a]),(d||b.resolveWith)(l,g))}},t=d?m:function(){try{m()}catch(Vc){u.Deferred.exceptionHook&&u.Deferred.exceptionHook(Vc,t.stackTrace),e+1>=p&&(c!==q&&(l=void 0,g=[Vc]),b.rejectWith(l,g))}};
e?t():(u.Deferred.getStackHook&&(t.stackTrace=u.Deferred.getStackHook()),a.setTimeout(t))}}var p=0;return u.Deferred(function(a){b[0][3].add(f(0,a,u.isFunction(d)?d:n,a.notifyWith));b[1][3].add(f(0,a,u.isFunction(e)?e:n));b[2][3].add(f(0,a,u.isFunction(c)?c:q))}).promise()},promise:function(e){return null!=e?u.extend(e,d):d}},f={};return u.each(b,function(e,a){var p=a[2],l=a[5];d[a[1]]=p.add;l&&p.add(function(){c=l},b[3-e][2].disable,b[0][2].lock);p.add(a[3].fire);f[a[0]]=function(){return f[a[0]+
"With"](this===f?void 0:this,arguments),this};f[a[0]+"With"]=p.fireWith}),d.promise(f),e&&e.call(f,f),f},when:function(a){var b=arguments.length,c=b,d=Array(c),f=qa.call(arguments),p=u.Deferred(),l=function(e){return function(a){d[e]=this;f[e]=1<arguments.length?qa.call(arguments):a;--b||p.resolveWith(d,f)}};if(1>=b&&(e(a,p.done(l(c)).resolve,p.reject,!b),"pending"===p.state()||u.isFunction(f[c]&&f[c].then)))return p.then();for(;c--;)e(f[c],l(c),p.reject);return p.promise()}});var aa=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;
u.Deferred.exceptionHook=function(e,b){a.console&&a.console.warn&&e&&aa.test(e.name)&&a.console.warn("jQuery.Deferred exception: "+e.message,e.stack,b)};u.readyException=function(e){a.setTimeout(function(){throw e;})};var ub=u.Deferred();u.fn.ready=function(e){return ub.then(e)["catch"](function(e){u.readyException(e)}),this};u.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--u.readyWait:u.isReady)||(u.isReady=!0,!0!==e&&0<--u.readyWait||ub.resolveWith(ca,[u]))}});u.ready.then=ub.then;"complete"===
ca.readyState||"loading"!==ca.readyState&&!ca.documentElement.doScroll?a.setTimeout(u.ready):(ca.addEventListener("DOMContentLoaded",p),a.addEventListener("load",p));var ba=function(e,a,b,c,d,f,p){var l=0,g=e.length,m=null==b;if("object"===u.type(b))for(l in d=!0,b)ba(e,a,l,b[l],!0,f,p);else if(void 0!==c&&(d=!0,u.isFunction(c)||(p=!0),m&&(p?(a.call(e,c),a=null):(m=a,a=function(e,a,b){return m.call(u(e),b)})),a))for(;l<g;l++)a(e[l],b,p?c:c.call(e[l],l,a(e[l],b)));return d?e:m?a.call(e):g?a(e[0],b):
f},Sa=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};t.uid=1;t.prototype={cache:function(e){var a=e[this.expando];return a||(a={},Sa(e)&&(e.nodeType?e[this.expando]=a:Object.defineProperty(e,this.expando,{value:a,configurable:!0}))),a},set:function(e,a,b){var c;e=this.cache(e);if("string"==typeof a)e[u.camelCase(a)]=b;else for(c in a)e[u.camelCase(c)]=a[c];return e},get:function(e,a){return void 0===a?this.cache(e):e[this.expando]&&e[this.expando][u.camelCase(a)]},access:function(e,
a,b){return void 0===a||a&&"string"==typeof a&&void 0===b?this.get(e,a):(this.set(e,a,b),void 0!==b?b:a)},remove:function(e,a){var b,c=e[this.expando];if(void 0!==c){if(void 0!==a)for(Array.isArray(a)?a=a.map(u.camelCase):(a=u.camelCase(a),a=a in c?[a]:a.match(Wa)||[]),b=a.length;b--;)delete c[a[b]];(void 0===a||u.isEmptyObject(c))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){e=e[this.expando];return void 0!==e&&!u.isEmptyObject(e)}};var la=window.$_priv_data=
new t,Qa=window.$_pub_data=new t,gc=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ib=/[A-Z]/g;u.extend({hasData:function(e){return Qa.hasData(e)||la.hasData(e)},data:function(e,a,b){return Qa.access(e,a,b)},removeData:function(e,a){Qa.remove(e,a)},_data:function(e,a,b){return la.access(e,a,b)},_removeData:function(e,a){la.remove(e,a)}});u.fn.extend({data:function(e,a){var b,c,d,f=this[0],p=f&&f.attributes;if(void 0===e){if(this.length&&(d=Qa.get(f),1===f.nodeType&&!la.get(f,"hasDataAttrs"))){for(b=p.length;b--;)p[b]&&
(c=p[b].name,0===c.indexOf("data-")&&(c=u.camelCase(c.slice(5)),w(f,c,d[c])));la.set(f,"hasDataAttrs",!0)}return d}return"object"==typeof e?this.each(function(){Qa.set(this,e)}):ba(this,function(a){var b;if(f&&void 0===a){if((b=Qa.get(f,e),void 0!==b)||(b=w(f,e),void 0!==b))return b}else this.each(function(){Qa.set(this,e,a)})},null,a,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Qa.remove(this,e)})}});u.extend({queue:function(e,a,b){var c;if(e)return a=(a||"fx")+
"queue",c=la.get(e,a),b&&(!c||Array.isArray(b)?c=la.access(e,a,u.makeArray(b)):c.push(b)),c||[]},dequeue:function(e,a){a=a||"fx";var b=u.queue(e,a),c=b.length,d=b.shift(),f=u._queueHooks(e,a),p=function(){u.dequeue(e,a)};"inprogress"===d&&(d=b.shift(),c--);d&&("fx"===a&&b.unshift("inprogress"),delete f.stop,d.call(e,p,f));!c&&f&&f.empty.fire()},_queueHooks:function(e,a){var b=a+"queueHooks";return la.get(e,b)||la.access(e,b,{empty:u.Callbacks("once memory").add(function(){la.remove(e,[a+"queue",b])})})}});
u.fn.extend({queue:function(e,a){var b=2;return"string"!=typeof e&&(a=e,e="fx",b--),arguments.length<b?u.queue(this[0],e):void 0===a?this:this.each(function(){var b=u.queue(this,e,a);u._queueHooks(this,e);"fx"===e&&"inprogress"!==b[0]&&u.dequeue(this,e)})},dequeue:function(e){return this.each(function(){u.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,a){var b,c=1,d=u.Deferred(),f=this,p=this.length,l=function(){--c||d.resolveWith(f,[f])};"string"!=typeof e&&
(a=e,e=void 0);for(e=e||"fx";p--;)(b=la.get(f[p],e+"queueHooks"))&&b.empty&&(c++,b.empty.add(l));return l(),d.promise(a)}});var sb=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,$a=new RegExp("^(?:([+-])=|)("+sb+")([a-z%]*)$","i"),Ya=["Top","Right","Bottom","Left"],Ta=function(e,a){return e=a||e,"none"===e.style.display||""===e.style.display&&u.contains(e.ownerDocument,e)&&"none"===u.css(e,"display")},Ra=function(e,a,b,c){var d,f={};for(d in a)f[d]=e.style[d],e.style[d]=a[d];b=b.apply(e,c||[]);for(d in a)e.style[d]=
f[d];return b},Na={};u.fn.extend({show:function(){return A(this,!0)},hide:function(){return A(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Ta(this)?u(this).show():u(this).hide()})}});var Za=/^(?:checkbox|radio)$/i,rb=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,kb=/^$|\/(?:java|ecma)script/i,Ia={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],
td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ia.optgroup=Ia.option;Ia.tbody=Ia.tfoot=Ia.colgroup=Ia.caption=Ia.thead;Ia.th=Ia.td;var Xa=/<|&#?\w+;/;!function(){var e=ca.createDocumentFragment().appendChild(ca.createElement("div")),a=ca.createElement("input");a.setAttribute("type","radio");a.setAttribute("checked","checked");a.setAttribute("name","t");e.appendChild(a);oa.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked;e.innerHTML="<textarea>x</textarea>";oa.noCloneChecked=
!!e.cloneNode(!0).lastChild.defaultValue}();var za=ca.documentElement,Bb=/^key/,Ec=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Yc=/^([^.]*)(?:\.(.+)|)/;u.event={global:{},add:function(e,a,b,c,d){var f,p,l,g,m,n,t,q;if(g=la.get(e))for(b.handler&&(f=b,b=f.handler,d=f.selector),d&&u.find.matchesSelector(za,d),b.guid||(b.guid=u.guid++),(l=g.events)||(l=g.events={}),(p=g.handle)||(p=g.handle=function(a){return"undefined"!=typeof u&&u.event.triggered!==a.type?u.event.dispatch.apply(e,arguments):void 0}),
a=(a||"").match(Wa)||[""],g=a.length;g--;){var w=Yc.exec(a[g])||[];var y=q=w[1];w=(w[2]||"").split(".").sort();y&&(n=u.event.special[y]||{},y=(d?n.delegateType:n.bindType)||y,n=u.event.special[y]||{},m=u.extend({type:y,origType:q,data:c,handler:b,guid:b.guid,selector:d,needsContext:d&&u.expr.match.needsContext.test(d),namespace:w.join(".")},f),(t=l[y])||(t=l[y]=[],t.delegateCount=0,n.setup&&!1!==n.setup.call(e,c,w,p)||e.addEventListener&&e.addEventListener(y,p)),n.add&&(n.add.call(e,m),m.handler.guid||
(m.handler.guid=b.guid)),d?t.splice(t.delegateCount++,0,m):t.push(m),u.event.global[y]=!0)}},remove:function(e,a,b,c,d){var f,p,l,g,m,n,t,q,w=la.hasData(e)&&la.get(e);if(w&&(g=w.events)){a=(a||"").match(Wa)||[""];for(m=a.length;m--;)if(l=Yc.exec(a[m])||[],n=q=l[1],t=(l[2]||"").split(".").sort(),n){var y=u.event.special[n]||{};n=(c?y.delegateType:y.bindType)||n;var x=g[n]||[];l=l[2]&&new RegExp("(^|\\.)"+t.join("\\.(?:.*\\.|)")+"(\\.|$)");for(p=f=x.length;f--;){var A=x[f];!d&&q!==A.origType||b&&b.guid!==
A.guid||l&&!l.test(A.namespace)||c&&c!==A.selector&&("**"!==c||!A.selector)||(x.splice(f,1),A.selector&&x.delegateCount--,y.remove&&y.remove.call(e,A))}p&&!x.length&&(y.teardown&&!1!==y.teardown.call(e,t,w.handle)||u.removeEvent(e,n,w.handle),delete g[n])}else for(n in g)u.event.remove(e,n+a[m],b,c,!0);u.isEmptyObject(g)&&la.remove(e,"handle events")}},dispatch:function(e){var a=u.event.fix(e),b,c,d,f,p=Array(arguments.length);var l=(la.get(this,"events")||{})[a.type]||[];var g=u.event.special[a.type]||
{};p[0]=a;for(b=1;b<arguments.length;b++)p[b]=arguments[b];if(a.delegateTarget=this,!g.preDispatch||!1!==g.preDispatch.call(this,a)){var m=u.event.handlers.call(this,a,l);for(b=0;(d=m[b++])&&!a.isPropagationStopped();)for(a.currentTarget=d.elem,l=0;(f=d.handlers[l++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!a.rnamespace.test(f.namespace)||(a.handleObj=f,a.data=f.data,c=((u.event.special[f.origType]||{}).handle||f.handler).apply(d.elem,p),void 0!==c&&!1===(a.result=c)&&(a.preventDefault(),
a.stopPropagation()));return g.postDispatch&&g.postDispatch.call(this,a),a.result}},handlers:function(e,a){var b,c=[],d=a.delegateCount,f=e.target;if(d&&f.nodeType&&!("click"===e.type&&1<=e.button))for(;f!==this;f=f.parentNode||this)if(1===f.nodeType&&("click"!==e.type||!0!==f.disabled)){var p=[];var l={};for(b=0;b<d;b++){var g=a[b];var m=g.selector+" ";void 0===l[m]&&(l[m]=g.needsContext?-1<u(m,this).index(f):u.find(m,this,null,[f]).length);l[m]&&p.push(g)}p.length&&c.push({elem:f,handlers:p})}return f=
this,d<a.length&&c.push({elem:f,handlers:a.slice(d)}),c},addProp:function(e,a){Object.defineProperty(u.Event.prototype,e,{enumerable:!0,configurable:!0,get:u.isFunction(a)?function(){if(this.originalEvent)return a(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(a){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:a})}})},fix:function(e){return e[u.expando]?e:new u.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==
L()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===L()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&f(this,"input"))return this.click(),!1},_default:function(e){return f(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}};u.removeEvent=function(e,a,b){e.removeEventListener&&e.removeEventListener(a,
b)};u.Event=function(e,a){return this instanceof u.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?B:G,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,a&&u.extend(this,a),this.timeStamp=e&&e.timeStamp||u.now(),void(this[u.expando]=!0)):new u.Event(e,a)};u.Event.prototype={constructor:u.Event,
isDefaultPrevented:G,isPropagationStopped:G,isImmediatePropagationStopped:G,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=B;e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=B;e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=B;e&&!this.isSimulated&&e.stopImmediatePropagation();this.stopPropagation()}};
u.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var a=e.button;return null==e.which&&Bb.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==a&&Ec.test(e.type)?1&a?1:2&a?3:4&
a?2:0:e.which}},u.event.addProp);u.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,a){u.event.special[e]={delegateType:a,bindType:a,handle:function(e){var b,c=e.relatedTarget,d=e.handleObj;return c&&(c===this||u.contains(this,c))||(e.type=d.origType,b=d.handler.apply(this,arguments),e.type=a),b}}});u.fn.extend({on:function(e,a,b,c){return J(this,e,a,b,c)},one:function(e,a,b,c){return J(this,e,a,b,c,1)},off:function(e,a,b){var c,d;
if(e&&e.preventDefault&&e.handleObj)return c=e.handleObj,u(e.delegateTarget).off(c.namespace?c.origType+"."+c.namespace:c.origType,c.selector,c.handler),this;if("object"==typeof e){for(d in e)this.off(d,a,e[d]);return this}return!1!==a&&"function"!=typeof a||(b=a,a=void 0),!1===b&&(b=G),this.each(function(){u.event.remove(this,e,b,a)})}});var Fc=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,nc=/<script|<style|<link/i,Oc=/checked\s*(?:[^=]|=\s*.checked.)/i,
wb=/^true\/(.*)/,lb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;u.extend({htmlPrefilter:function(e){return e.replace(Fc,"<$1></$2>")},clone:function(e,a,b){var c,d=e.cloneNode(!0),f=u.contains(e.ownerDocument,e);if(!(oa.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||u.isXMLDoc(e))){var p=x(d);var l=x(e);var g=0;for(c=l.length;g<c;g++){var m=l[g],n=p[g],t=n.nodeName.toLowerCase();"input"===t&&Za.test(m.type)?n.checked=m.checked:"input"!==t&&"textarea"!==t||(n.defaultValue=m.defaultValue)}}if(a)if(b)for(l=
l||x(e),p=p||x(d),g=0,c=l.length;g<c;g++)M(l[g],p[g]);else M(e,d);return p=x(d,"script"),0<p.length&&z(p,!f&&x(e,"script")),d},cleanData:function(e){for(var a,b,c,d=u.event.special,f=0;void 0!==(b=e[f]);f++)if(Sa(b)){if(a=b[la.expando]){if(a.events)for(c in a.events)d[c]?u.event.remove(b,c):u.removeEvent(b,c,a.handle);b[la.expando]=void 0}b[Qa.expando]&&(b[Qa.expando]=void 0)}}});u.fn.extend({detach:function(e){return ea(this,e,!0)},remove:function(e){return ea(this,e)},text:function(e){return ba(this,
function(e){return void 0===e?u.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return V(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||P(this,e).appendChild(e)})},prepend:function(){return V(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var a=P(this,e);a.insertBefore(e,a.firstChild)}})},before:function(){return V(this,
arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return V(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,a=0;null!=(e=this[a]);a++)1===e.nodeType&&(u.cleanData(x(e,!1)),e.textContent="");return this},clone:function(e,a){return e=null!=e&&e,a=null==a?e:a,this.map(function(){return u.clone(this,e,a)})},html:function(e){return ba(this,function(e){var a=this[0]||{},b=0,c=this.length;
if(void 0===e&&1===a.nodeType)return a.innerHTML;if("string"==typeof e&&!nc.test(e)&&!Ia[(rb.exec(e)||["",""])[1].toLowerCase()]){e=u.htmlPrefilter(e);try{for(;b<c;b++)a=this[b]||{},1===a.nodeType&&(u.cleanData(x(a,!1)),a.innerHTML=e);a=0}catch(xc){}}a&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return V(this,arguments,function(a){var b=this.parentNode;0>u.inArray(this,e)&&(u.cleanData(x(this)),b&&b.replaceChild(a,this))},e)}});u.each({appendTo:"append",prependTo:"prepend",
insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){u.fn[e]=function(e){for(var b=[],c=u(e),d=c.length-1,f=0;f<=d;f++)e=f===d?this:this.clone(!0),u(c[f])[a](e),Ca.apply(b,e.get());return this.pushStack(b)}});var Bc=/^margin/,Sb=new RegExp("^("+sb+")(?!px)[a-z%]+$","i"),Ac=function(e){var b=e.ownerDocument.defaultView;return b&&b.opener||(b=a),b.getComputedStyle(e)};!function(){function e(){if(l){l.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%";
l.innerHTML="";za.appendChild(p);var e=a.getComputedStyle(l);b="1%"!==e.top;f="2px"===e.marginLeft;c="4px"===e.width;l.style.marginRight="50%";d="4px"===e.marginRight;za.removeChild(p);l=null}}var b,c,d,f,p=ca.createElement("div"),l=ca.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",oa.clearCloneStyle="content-box"===l.style.backgroundClip,p.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",
p.appendChild(l),u.extend(oa,{pixelPosition:function(){return e(),b},boxSizingReliable:function(){return e(),c},pixelMarginRight:function(){return e(),d},reliableMarginLeft:function(){return e(),f}}))}();var ge=/^(none|table(?!-c[ea]).+)/,Mb=/^--/,Xb={position:"absolute",visibility:"hidden",display:"block"},Zc={letterSpacing:"0",fontWeight:"400"},rd=["Webkit","Moz","ms"],qd=ca.createElement("div").style;u.extend({cssHooks:{opacity:{get:function(e,a){if(a)return e=Y(e,"opacity"),""===e?"1":e}}},cssNumber:{animationIterationCount:!0,
columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,a,b,c){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var d,f,p,l=u.camelCase(a),g=Mb.test(a),m=e.style;return g||(a=N(l)),p=u.cssHooks[a]||u.cssHooks[l],void 0===b?p&&"get"in p&&void 0!==(d=p.get(e,!1,c))?d:m[a]:(f=typeof b,"string"===f&&(d=$a.exec(b))&&d[1]&&(b=y(e,a,d),f="number"),null!=b&&b===b&&("number"===
f&&(b+=d&&d[3]||(u.cssNumber[l]?"":"px")),oa.clearCloneStyle||""!==b||0!==a.indexOf("background")||(m[a]="inherit"),p&&"set"in p&&void 0===(b=p.set(e,b,c))||(g?m.setProperty(a,b):m[a]=b)),void 0)}},css:function(e,a,b,c){var d,f,p,l=u.camelCase(a);return Mb.test(a)||(a=N(l)),p=u.cssHooks[a]||u.cssHooks[l],p&&"get"in p&&(d=p.get(e,!0,b)),void 0===d&&(d=Y(e,a,c)),"normal"===d&&a in Zc&&(d=Zc[a]),""===b||b?(f=parseFloat(d),!0===b||isFinite(f)?f||0:d):d}});u.each(["height","width"],function(e,a){u.cssHooks[a]=
{get:function(e,b,c){if(b)return!ge.test(u.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?K(e,a,c):Ra(e,Xb,function(){return K(e,a,c)})},set:function(e,b,c){var d,f=c&&Ac(e);c=c&&S(e,a,c,"border-box"===u.css(e,"boxSizing",!1,f),f);return c&&(d=$a.exec(b))&&"px"!==(d[3]||"px")&&(e.style[a]=b,b=u.css(e,a)),Z(e,b,c)}}});u.cssHooks.marginLeft=pa(oa.reliableMarginLeft,function(e,a){if(a)return(parseFloat(Y(e,"marginLeft"))||e.getBoundingClientRect().left-Ra(e,{marginLeft:0},
function(){return e.getBoundingClientRect().left}))+"px"});u.each({margin:"",padding:"",border:"Width"},function(e,a){u.cssHooks[e+a]={expand:function(b){var c=0,d={};for(b="string"==typeof b?b.split(" "):[b];4>c;c++)d[e+Ya[c]+a]=b[c]||b[c-2]||b[0];return d}};Bc.test(e)||(u.cssHooks[e+a].set=Z)});u.fn.extend({css:function(e,a){return ba(this,function(e,a,b){var c,d={},f=0;if(Array.isArray(a)){b=Ac(e);for(c=a.length;f<c;f++)d[a[f]]=u.css(e,a[f],!1,b);return d}return void 0!==b?u.style(e,a,b):u.css(e,
a)},e,a,1<arguments.length)}});u.Tween=H;H.prototype={constructor:H,init:function(e,a,b,c,d,f){this.elem=e;this.prop=b;this.easing=d||u.easing._default;this.options=a;this.start=this.now=this.cur();this.end=c;this.unit=f||(u.cssNumber[b]?"":"px")},cur:function(){var e=H.propHooks[this.prop];return e&&e.get?e.get(this):H.propHooks._default.get(this)},run:function(e){var a,b=H.propHooks[this.prop];return this.options.duration?this.pos=a=u.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):
this.pos=a=e,this.now=(this.end-this.start)*a+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),b&&b.set?b.set(this):H.propHooks._default.set(this),this}};H.prototype.init.prototype=H.prototype;H.propHooks={_default:{get:function(e){var a;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(a=u.css(e.elem,e.prop,""),a&&"auto"!==a?a:0)},set:function(e){u.fx.step[e.prop]?u.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[u.cssProps[e.prop]]&&
!u.cssHooks[e.prop]?e.elem[e.prop]=e.now:u.style(e.elem,e.prop,e.now+e.unit)}}};H.propHooks.scrollTop=H.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}};u.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"};u.fx=H.prototype.init;u.fx.step={};var Ub,Tb,he=/^(?:toggle|show|hide)$/,oc=/queueHooks$/;u.Animation=u.extend(ma,{tweeners:{"*":[function(e,a){var b=this.createTween(e,a);return y(b.elem,e,$a.exec(a),
b),b}]},tweener:function(e,a){u.isFunction(e)?(a=e,e=["*"]):e=e.match(Wa);for(var b,c=0,d=e.length;c<d;c++)b=e[c],ma.tweeners[b]=ma.tweeners[b]||[],ma.tweeners[b].unshift(a)},prefilters:[function(e,a,b){var c,d,f,p,l,g,m,n,t="width"in a||"height"in a,q=this,w={},y=e.style,x=e.nodeType&&Ta(e),z=la.get(e,"fxshow");b.queue||(p=u._queueHooks(e,"fx"),null==p.unqueued&&(p.unqueued=0,l=p.empty.fire,p.empty.fire=function(){p.unqueued||l()}),p.unqueued++,q.always(function(){q.always(function(){p.unqueued--;
u.queue(e,"fx").length||p.empty.fire()})}));for(c in a)if(d=a[c],he.test(d)){if(delete a[c],f=f||"toggle"===d,d===(x?"hide":"show")){if("show"!==d||!z||void 0===z[c])continue;x=!0}w[c]=z&&z[c]||u.style(e,c)}if(g=!u.isEmptyObject(a),g||!u.isEmptyObject(w))for(c in t&&1===e.nodeType&&(b.overflow=[y.overflow,y.overflowX,y.overflowY],m=z&&z.display,null==m&&(m=la.get(e,"display")),n=u.css(e,"display"),"none"===n&&(m?n=m:(A([e],!0),m=e.style.display||m,n=u.css(e,"display"),A([e]))),("inline"===n||"inline-block"===
n&&null!=m)&&"none"===u.css(e,"float")&&(g||(q.done(function(){y.display=m}),null==m&&(n=y.display,m="none"===n?"":n)),y.display="inline-block")),b.overflow&&(y.overflow="hidden",q.always(function(){y.overflow=b.overflow[0];y.overflowX=b.overflow[1];y.overflowY=b.overflow[2]})),g=!1,w)g||(z?"hidden"in z&&(x=z.hidden):z=la.access(e,"fxshow",{display:m}),f&&(z.hidden=!x),x&&A([e],!0),q.done(function(){x||A([e]);la.remove(e,"fxshow");for(c in w)u.style(e,c,w[c])})),g=I(x?z[c]:0,c,q),c in z||(z[c]=g.start,
x&&(g.end=g.start,g.start=0))}],prefilter:function(e,a){a?ma.prefilters.unshift(e):ma.prefilters.push(e)}});u.speed=function(e,a,b){var c=e&&"object"==typeof e?u.extend({},e):{complete:b||!b&&a||u.isFunction(e)&&e,duration:e,easing:b&&a||a&&!u.isFunction(a)&&a};return u.fx.off?c.duration=0:"number"!=typeof c.duration&&(c.duration in u.fx.speeds?c.duration=u.fx.speeds[c.duration]:c.duration=u.fx.speeds._default),null!=c.queue&&!0!==c.queue||(c.queue="fx"),c.old=c.complete,c.complete=function(){u.isFunction(c.old)&&
c.old.call(this);c.queue&&u.dequeue(this,c.queue)},c};u.fn.extend({fadeTo:function(e,a,b,c){return this.filter(Ta).css("opacity",0).show().end().animate({opacity:a},e,b,c)},animate:function(e,a,b,c){var d=u.isEmptyObject(e),f=u.speed(a,b,c);a=function(){var a=ma(this,u.extend({},e),f);(d||la.get(this,"finish"))&&a.stop(!0)};return a.finish=a,d||!1===f.queue?this.each(a):this.queue(f.queue,a)},stop:function(e,a,b){var c=function(e){var a=e.stop;delete e.stop;a(b)};return"string"!=typeof e&&(b=a,a=
e,e=void 0),a&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var a=!0,d=null!=e&&e+"queueHooks",f=u.timers,p=la.get(this);if(d)p[d]&&p[d].stop&&c(p[d]);else for(d in p)p[d]&&p[d].stop&&oc.test(d)&&c(p[d]);for(d=f.length;d--;)f[d].elem!==this||null!=e&&f[d].queue!==e||(f[d].anim.stop(b),a=!1,f.splice(d,1));!a&&b||u.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var a=la.get(this),b=a[e+"queue"];var c=a[e+"queueHooks"];var d=u.timers,f=b?b.length:0;a.finish=
!0;u.queue(this,e,[]);c&&c.stop&&c.stop.call(this,!0);for(c=d.length;c--;)d[c].elem===this&&d[c].queue===e&&(d[c].anim.stop(!0),d.splice(c,1));for(c=0;c<f;c++)b[c]&&b[c].finish&&b[c].finish.call(this);delete a.finish})}});u.each(["toggle","show","hide"],function(e,a){var b=u.fn[a];u.fn[a]=function(e,c,d){return null==e||"boolean"==typeof e?b.apply(this,arguments):this.animate(X(a,!0),e,c,d)}});u.each({slideDown:X("show"),slideUp:X("hide"),slideToggle:X("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},
fadeToggle:{opacity:"toggle"}},function(e,a){u.fn[e]=function(e,b,c){return this.animate(a,e,b,c)}});u.timers=[];u.fx.tick=function(){var e=0,a=u.timers;for(Ub=u.now();e<a.length;e++){var b=a[e];b()||a[e]!==b||a.splice(e--,1)}a.length||u.fx.stop();Ub=void 0};u.fx.timer=function(e){u.timers.push(e);u.fx.start()};u.fx.interval=13;u.fx.start=function(){Tb||(Tb=!0,E())};u.fx.stop=function(){Tb=null};u.fx.speeds={slow:600,fast:200,_default:400};u.fn.delay=function(e,b){return e=u.fx?u.fx.speeds[e]||e:
e,b=b||"fx",this.queue(b,function(b,c){var d=a.setTimeout(b,e);c.stop=function(){a.clearTimeout(d)}})};(function(){var e=ca.createElement("input"),a=ca.createElement("select").appendChild(ca.createElement("option"));e.type="checkbox";oa.checkOn=""!==e.value;oa.optSelected=a.selected;e=ca.createElement("input");e.value="t";e.type="radio";oa.radioValue="t"===e.value})();var xb=u.expr.attrHandle;u.fn.extend({attr:function(e,a){return ba(this,u.attr,e,a,1<arguments.length)},removeAttr:function(e){return this.each(function(){u.removeAttr(this,
e)})}});u.extend({attr:function(e,a,b){var c,d,f=e.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof e.getAttribute?u.prop(e,a,b):(1===f&&u.isXMLDoc(e)||(d=u.attrHooks[a.toLowerCase()]||(u.expr.match.bool.test(a)?zd:void 0)),void 0!==b?null===b?void u.removeAttr(e,a):d&&"set"in d&&void 0!==(c=d.set(e,b,a))?c:(e.setAttribute(a,b+""),b):d&&"get"in d&&null!==(c=d.get(e,a))?c:(c=u.find.attr(e,a),null==c?void 0:c))},attrHooks:{type:{set:function(e,a){if(!oa.radioValue&&"radio"===a&&f(e,"input")){var b=
e.value;return e.setAttribute("type",a),b&&(e.value=b),a}}}},removeAttr:function(e,a){var b=0,c=a&&a.match(Wa);if(c&&1===e.nodeType)for(;a=c[b++];)e.removeAttribute(a)}});var zd={set:function(e,a,b){return!1===a?u.removeAttr(e,b):e.setAttribute(b,b),b}};u.each(u.expr.match.bool.source.match(/\w+/g),function(e,a){var b=xb[a]||u.find.attr;xb[a]=function(e,a,c){var d,f,p=a.toLowerCase();return c||(f=xb[p],xb[p]=d,d=null!=b(e,a,c)?p:null,xb[p]=f),d}});var Gc=/^(?:input|select|textarea|button)$/i,Ad=/^(?:a|area)$/i;
u.fn.extend({prop:function(e,a){return ba(this,u.prop,e,a,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[u.propFix[e]||e]})}});u.extend({prop:function(e,a,b){var c,d,f=e.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&u.isXMLDoc(e)||(a=u.propFix[a]||a,d=u.propHooks[a]),void 0!==b?d&&"set"in d&&void 0!==(c=d.set(e,b,a))?c:e[a]=b:d&&"get"in d&&null!==(c=d.get(e,a))?c:e[a]},propHooks:{tabIndex:{get:function(e){var a=u.find.attr(e,"tabindex");return a?parseInt(a,10):
Gc.test(e.nodeName)||Ad.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}});oa.optSelected||(u.propHooks.selected={get:function(e){e=e.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(e){e=e.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}});u.each("tabIndex readOnly maxLength cellSpacing cellPadding rowSpan colSpan useMap frameBorder contentEditable".split(" "),function(){u.propFix[this.toLowerCase()]=this});u.fn.extend({addClass:function(e){var a,
b,c,d,f,p,l=0;if(u.isFunction(e))return this.each(function(a){u(this).addClass(e.call(this,a,R(this)))});if("string"==typeof e&&e)for(a=e.match(Wa)||[];b=this[l++];)if(d=R(b),c=1===b.nodeType&&" "+Q(d)+" "){for(p=0;f=a[p++];)0>c.indexOf(" "+f+" ")&&(c+=f+" ");c=Q(c);d!==c&&b.setAttribute("class",c)}return this},removeClass:function(e){var a,b,c,d,f,p,l=0;if(u.isFunction(e))return this.each(function(a){u(this).removeClass(e.call(this,a,R(this)))});if(!arguments.length)return this.attr("class","");
if("string"==typeof e&&e)for(a=e.match(Wa)||[];b=this[l++];)if(d=R(b),c=1===b.nodeType&&" "+Q(d)+" "){for(p=0;f=a[p++];)for(;-1<c.indexOf(" "+f+" ");)c=c.replace(" "+f+" "," ");c=Q(c);d!==c&&b.setAttribute("class",c)}return this},toggleClass:function(e,a){var b=typeof e;return"boolean"==typeof a&&"string"===b?a?this.addClass(e):this.removeClass(e):u.isFunction(e)?this.each(function(b){u(this).toggleClass(e.call(this,b,R(this),a),a)}):this.each(function(){var a,c;if("string"===b){var d=0;var f=u(this);
for(c=e.match(Wa)||[];a=c[d++];)f.hasClass(a)?f.removeClass(a):f.addClass(a)}else void 0!==e&&"boolean"!==b||(a=R(this),a&&la.set(this,"__className__",a),this.setAttribute&&this.setAttribute("class",a||!1===e?"":la.get(this,"__className__")||""))})},hasClass:function(e){var a,b=0;for(e=" "+e+" ";a=this[b++];)if(1===a.nodeType&&-1<(" "+Q(R(a))+" ").indexOf(e))return!0;return!1}});var Bd=/\r/g;u.fn.extend({val:function(e){var a,b,c,d=this[0];if(arguments.length)return c=u.isFunction(e),this.each(function(b){var d;
1===this.nodeType&&(d=c?e.call(this,b,u(this).val()):e,null==d?d="":"number"==typeof d?d+="":Array.isArray(d)&&(d=u.map(d,function(e){return null==e?"":e+""})),a=u.valHooks[this.type]||u.valHooks[this.nodeName.toLowerCase()],a&&"set"in a&&void 0!==a.set(this,d,"value")||(this.value=d))});if(d)return a=u.valHooks[d.type]||u.valHooks[d.nodeName.toLowerCase()],a&&"get"in a&&void 0!==(b=a.get(d,"value"))?b:(b=d.value,"string"==typeof b?b.replace(Bd,""):null==b?"":b)}});u.extend({valHooks:{option:{get:function(e){var a=
u.find.attr(e,"value");return null!=a?a:Q(u.text(e))}},select:{get:function(e){var a,b,c=e.options,d=e.selectedIndex,p="select-one"===e.type,l=p?null:[],g=p?d+1:c.length;for(b=0>d?g:p?d:0;b<g;b++)if(a=c[b],!(!a.selected&&b!==d||a.disabled||a.parentNode.disabled&&f(a.parentNode,"optgroup"))){if(e=u(a).val(),p)return e;l.push(e)}return l},set:function(e,a){for(var b,c=e.options,d=u.makeArray(a),f=c.length;f--;)a=c[f],(a.selected=-1<u.inArray(u.valHooks.option.get(a),d))&&(b=!0);return b||(e.selectedIndex=
-1),d}}}});u.each(["radio","checkbox"],function(){u.valHooks[this]={set:function(e,a){if(Array.isArray(a))return e.checked=-1<u.inArray(u(e).val(),a)}};oa.checkOn||(u.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Cd=/^(?:focusinfocus|focusoutblur)$/;u.extend(u.event,{trigger:function(e,b,c,d){var f,p,l,g,m,n=[c||ca],t=ia.call(e,"type")?e.type:e;var q=ia.call(e,"namespace")?e.namespace.split("."):[];if(f=p=c=c||ca,3!==c.nodeType&&8!==c.nodeType&&!Cd.test(t+
u.event.triggered)&&(-1<t.indexOf(".")&&(q=t.split("."),t=q.shift(),q.sort()),l=0>t.indexOf(":")&&"on"+t,e=e[u.expando]?e:new u.Event(t,"object"==typeof e&&e),e.isTrigger=d?2:3,e.namespace=q.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=c),b=null==b?[e]:u.makeArray(b,[e]),m=u.event.special[t]||{},d||!m.trigger||!1!==m.trigger.apply(c,b))){if(!d&&!m.noBubble&&!u.isWindow(c)){var w=m.delegateType||t;for(Cd.test(w+
t)||(f=f.parentNode);f;f=f.parentNode)n.push(f),p=f;p===(c.ownerDocument||ca)&&n.push(p.defaultView||p.parentWindow||a)}for(q=0;(f=n[q++])&&!e.isPropagationStopped();)e.type=1<q?w:m.bindType||t,(g=(la.get(f,"events")||{})[e.type]&&la.get(f,"handle"))&&g.apply(f,b),(g=l&&f[l])&&g.apply&&Sa(f)&&(e.result=g.apply(f,b),!1===e.result&&e.preventDefault());return e.type=t,d||e.isDefaultPrevented()||m._default&&!1!==m._default.apply(n.pop(),b)||!Sa(c)||l&&u.isFunction(c[t])&&!u.isWindow(c)&&(p=c[l],p&&(c[l]=
null),u.event.triggered=t,c[t](),u.event.triggered=void 0,p&&(c[l]=p)),e.result}},simulate:function(e,a,b){e=u.extend(new u.Event,b,{type:e,isSimulated:!0});u.event.trigger(e,null,a)}});u.fn.extend({trigger:function(e,a){return this.each(function(){u.event.trigger(e,a,this)})},triggerHandler:function(e,a){var b=this[0];if(b)return u.event.trigger(e,a,b,!0)}});u.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),
function(e,a){u.fn[a]=function(e,b){return 0<arguments.length?this.on(a,null,e,b):this.trigger(a)}});u.fn.extend({hover:function(e,a){return this.mouseenter(e).mouseleave(a||e)}});oa.focusin="onfocusin"in a;oa.focusin||u.each({focus:"focusin",blur:"focusout"},function(e,a){var b=function(e){u.event.simulate(a,e.target,u.event.fix(e))};u.event.special[a]={setup:function(){var c=this.ownerDocument||this,d=la.access(c,a);d||c.addEventListener(e,b,!0);la.access(c,a,(d||0)+1)},teardown:function(){var c=
this.ownerDocument||this,d=la.access(c,a)-1;d?la.access(c,a,d):(c.removeEventListener(e,b,!0),la.remove(c,a))}}});var Yb=a.location,Dd=u.now(),Hc=/\?/;u.parseXML=function(e){if(!e||"string"!=typeof e)return null;try{var b=(new a.DOMParser).parseFromString(e,"text/xml")}catch(fc){b=void 0}return b&&!b.getElementsByTagName("parsererror").length||u.error("Invalid XML: "+e),b};var sd=/\[\]$/,Ic=/\r?\n/g,Jc=/^(?:submit|button|image|reset|file)$/i,Ed=/^(?:input|select|textarea|keygen)/i;u.param=function(e,
a){var b,c=[],d=function(e,a){a=u.isFunction(a)?a():a;c[c.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==a?"":a)};if(Array.isArray(e)||e.jquery&&!u.isPlainObject(e))u.each(e,function(){d(this.name,this.value)});else for(b in e)ua(b,e[b],a,d);return c.join("&")};u.fn.extend({serialize:function(){return u.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=u.prop(this,"elements");return e?u.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&
!u(this).is(":disabled")&&Ed.test(this.nodeName)&&!Jc.test(e)&&(this.checked||!Za.test(e))}).map(function(e,a){e=u(this).val();return null==e?null:Array.isArray(e)?u.map(e,function(e){return{name:a.name,value:e.replace(Ic,"\r\n")}}):{name:a.name,value:e.replace(Ic,"\r\n")}}).get()}});var ie=/%20/g,Fd=/#.*$/,$c=/([?&])_=[^&]*/,Gd=/^(.*?):[ \t]*([^\r\n]*)$/gm,Hd=/^(?:GET|HEAD)$/,Zb=/^\/\//,ad={},Vb={},bd="*/".concat("*"),Pb=ca.createElement("a");Pb.href=Yb.href;u.extend({active:0,lastModified:{},etag:{},
ajaxSettings:{url:Yb.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Yb.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":bd,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,
"text html":!0,"text json":JSON.parse,"text xml":u.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,a){return a?O(O(e,u.ajaxSettings),a):O(u.ajaxSettings,e)},ajaxPrefilter:C(ad),ajaxTransport:C(Vb),ajax:function(e,b){function c(e,b,c,p){var m,n,z,D=b;if(!E){E=!0;l&&a.clearTimeout(l);d=void 0;f=p||"";K.readyState=0<e?4:0;p=200<=e&&300>e||304===e;if(c){var B=t;for(var I=K,X,L,H,J,ma=B.contents,ba=B.dataTypes;"*"===ba[0];)ba.shift(),void 0===X&&(X=B.mimeType||I.getResponseHeader("Content-Type"));
if(X)for(L in ma)if(ma[L]&&ma[L].test(X)){ba.unshift(L);break}if(ba[0]in c)H=ba[0];else{for(L in c){if(!ba[0]||B.converters[L+" "+ba[0]]){H=L;break}J||(J=L)}H=H||J}c=H?(H!==ba[0]&&ba.unshift(H),c[H]):void 0;B=c}a:{c=t;X=B;L=K;H=p;var P,ra,qa;B={};I=c.dataTypes.slice();if(I[1])for(P in c.converters)B[P.toLowerCase()]=c.converters[P];for(J=I.shift();J;)if(c.responseFields[J]&&(L[c.responseFields[J]]=X),!qa&&H&&c.dataFilter&&(X=c.dataFilter(X,c.dataType)),qa=J,J=I.shift())if("*"===J)J=qa;else if("*"!==
qa&&qa!==J){if(P=B[qa+" "+J]||B["* "+J],!P)for(sa in B)if(ra=sa.split(" "),ra[1]===J&&(P=B[qa+" "+ra[0]]||B["* "+ra[0]])){!0===P?P=B[sa]:!0!==B[sa]&&(J=ra[0],I.unshift(ra[1]));break}if(!0!==P)if(P&&c["throws"])X=P(X);else try{X=P(X)}catch(wd){var sa={state:"parsererror",error:P?wd:"No conversion from "+qa+" to "+J};break a}}sa={state:"success",data:X}}B=sa;p?(t.ifModified&&(z=K.getResponseHeader("Last-Modified"),z&&(u.lastModified[G]=z),z=K.getResponseHeader("etag"),z&&(u.etag[G]=z)),204===e||"HEAD"===
t.type?D="nocontent":304===e?D="notmodified":(D=B.state,m=B.data,n=B.error,p=!n)):(n=D,!e&&D||(D="error",0>e&&(e=0)));K.status=e;K.statusText=(b||D)+"";p?y.resolveWith(q,[m,D,K]):y.rejectWith(q,[K,D,n]);K.statusCode(A);A=void 0;g&&w.trigger(p?"ajaxSuccess":"ajaxError",[K,t,p?m:n]);x.fireWith(q,[K,D]);g&&(w.trigger("ajaxComplete",[K,t]),--u.active||u.event.trigger("ajaxStop"))}}"object"==typeof e&&(b=e,e=void 0);b=b||{};var d,f,p,l,g,m,n,t=u.ajaxSetup({},b),q=t.context||t,w=t.context&&(q.nodeType||
q.jquery)?u(q):u.event,y=u.Deferred(),x=u.Callbacks("once memory"),A=t.statusCode||{},z={},D={},B="canceled",K={readyState:0,getResponseHeader:function(e){var a;if(E){if(!p)for(p={};a=Gd.exec(f);)p[a[1].toLowerCase()]=a[2];a=p[e.toLowerCase()]}return null==a?null:a},getAllResponseHeaders:function(){return E?f:null},setRequestHeader:function(e,a){return null==E&&(e=D[e.toLowerCase()]=D[e.toLowerCase()]||e,z[e]=a),this},overrideMimeType:function(e){return null==E&&(t.mimeType=e),this},statusCode:function(e){var a;
if(e)if(E)K.always(e[K.status]);else for(a in e)A[a]=[A[a],e[a]];return this},abort:function(e){e=e||B;return d&&d.abort(e),c(0,e),this}};if(y.promise(K),t.url=((e||t.url||Yb.href)+"").replace(Zb,Yb.protocol+"//"),t.type=b.method||b.type||t.method||t.type,t.dataTypes=(t.dataType||"*").toLowerCase().match(Wa)||[""],null==t.crossDomain){e=ca.createElement("a");try{e.href=t.url,e.href=e.href,t.crossDomain=Pb.protocol+"//"+Pb.host!=e.protocol+"//"+e.host}catch(Dc){t.crossDomain=!0}}if(t.data&&t.processData&&
"string"!=typeof t.data&&(t.data=u.param(t.data,t.traditional)),W(ad,t,b,K),E)return K;(g=u.event&&t.global)&&0===u.active++&&u.event.trigger("ajaxStart");t.type=t.type.toUpperCase();t.hasContent=!Hd.test(t.type);var G=t.url.replace(Fd,"");t.hasContent?t.data&&t.processData&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&(t.data=t.data.replace(ie,"+")):(n=t.url.slice(G.length),t.data&&(G+=(Hc.test(G)?"&":"?")+t.data,delete t.data),!1===t.cache&&(G=G.replace($c,"$1"),n=(Hc.test(G)?
"&":"?")+"_="+Dd++ +n),t.url=G+n);t.ifModified&&(u.lastModified[G]&&K.setRequestHeader("If-Modified-Since",u.lastModified[G]),u.etag[G]&&K.setRequestHeader("If-None-Match",u.etag[G]));(t.data&&t.hasContent&&!1!==t.contentType||b.contentType)&&K.setRequestHeader("Content-Type",t.contentType);K.setRequestHeader("Accept",t.dataTypes[0]&&t.accepts[t.dataTypes[0]]?t.accepts[t.dataTypes[0]]+("*"!==t.dataTypes[0]?", "+bd+"; q=0.01":""):t.accepts["*"]);for(m in t.headers)K.setRequestHeader(m,t.headers[m]);
if(t.beforeSend&&(!1===t.beforeSend.call(q,K,t)||E))return K.abort();if(B="abort",x.add(t.complete),K.done(t.success),K.fail(t.error),d=W(Vb,t,b,K)){if(K.readyState=1,g&&w.trigger("ajaxSend",[K,t]),E)return K;t.async&&0<t.timeout&&(l=a.setTimeout(function(){K.abort("timeout")},t.timeout));try{var E=!1;d.send(z,c)}catch(Dc){if(E)throw Dc;c(-1,Dc)}}else c(-1,"No Transport");return K},getJSON:function(e,a,b){return u.get(e,a,b,"json")},getScript:function(e,a){return u.get(e,void 0,a,"script")}});u.each(["get",
"post"],function(e,a){u[a]=function(e,b,c,d){return u.isFunction(b)&&(d=d||c,c=b,b=void 0),u.ajax(u.extend({url:e,type:a,dataType:d,data:b,success:c},u.isPlainObject(e)&&e))}});u._evalUrl=function(e){return u.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})};u.fn.extend({wrapAll:function(e){var a;return this[0]&&(u.isFunction(e)&&(e=e.call(this[0])),a=u(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&a.insertBefore(this[0]),a.map(function(){for(var e=
this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return u.isFunction(e)?this.each(function(a){u(this).wrapInner(e.call(this,a))}):this.each(function(){var a=u(this),b=a.contents();b.length?b.wrapAll(e):a.append(e)})},wrap:function(e){var a=u.isFunction(e);return this.each(function(b){u(this).wrapAll(a?e.call(this,b):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){u(this).replaceWith(this.childNodes)}),this}});u.expr.pseudos.hidden=
function(e){return!u.expr.pseudos.visible(e)};u.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)};u.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(pb){}};var je={0:200,1223:204},Nb=u.ajaxSettings.xhr();oa.cors=!!Nb&&"withCredentials"in Nb;oa.ajax=Nb=!!Nb;u.ajaxTransport(function(e){var b,c;if(oa.cors||Nb&&!e.crossDomain)return{send:function(d,f){var p,l=e.xhr();if(l.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(p in e.xhrFields)l[p]=
e.xhrFields[p];e.mimeType&&l.overrideMimeType&&l.overrideMimeType(e.mimeType);e.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(p in d)l.setRequestHeader(p,d[p]);b=function(e){return function(){b&&(b=c=l.onload=l.onerror=l.onabort=l.onreadystatechange=null,"abort"===e?l.abort():"error"===e?"number"!=typeof l.status?f(0,"error"):f(l.status,l.statusText):f(je[l.status]||l.status,l.statusText,"text"!==(l.responseType||"text")||"string"!=typeof l.responseText?{binary:l.response}:
{text:l.responseText},l.getAllResponseHeaders()))}};l.onload=b();c=l.onerror=b("error");void 0!==l.onabort?l.onabort=c:l.onreadystatechange=function(){4===l.readyState&&a.setTimeout(function(){b&&c()})};b=b("abort");try{l.send(e.hasContent&&e.data||null)}catch(Nc){if(b)throw Nc;}},abort:function(){b&&b()}}});u.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)});u.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},
converters:{"text script":function(e){return u.globalEval(e),e}}});u.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1);e.crossDomain&&(e.type="GET")});u.ajaxTransport("script",function(e){if(e.crossDomain){var a,b;return{send:function(c,d){a=u("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",b=function(e){a.remove();b=null;e&&d("error"===e.type?404:200,e.type)});ca.head.appendChild(a[0])},abort:function(){b&&b()}}}});var pc=[],$b=/(=)\?(?=&|$)|\?\?/;u.ajaxSetup({jsonp:"callback",
jsonpCallback:function(){var e=pc.pop()||u.expando+"_"+Dd++;return this[e]=!0,e}});u.ajaxPrefilter("json jsonp",function(e,b,c){var d,f,p,l=!1!==e.jsonp&&($b.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&$b.test(e.data)&&"data");if(l||"jsonp"===e.dataTypes[0])return d=e.jsonpCallback=u.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,l?e[l]=e[l].replace($b,"$1"+d):!1!==e.jsonp&&(e.url+=(Hc.test(e.url)?"&":"?")+e.jsonp+
"="+d),e.converters["script json"]=function(){return p||u.error(d+" was not called"),p[0]},e.dataTypes[0]="json",f=a[d],a[d]=function(){p=arguments},c.always(function(){void 0===f?u(a).removeProp(d):a[d]=f;e[d]&&(e.jsonpCallback=b.jsonpCallback,pc.push(d));p&&u.isFunction(f)&&f(p[0]);p=f=void 0}),"script"});oa.createHTMLDocument=function(){var e=ca.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}();u.parseHTML=function(e,a,b){if("string"!=
typeof e)return[];"boolean"==typeof a&&(b=a,a=!1);var c,d,f;return a||(oa.createHTMLDocument?(a=ca.implementation.createHTMLDocument(""),c=a.createElement("base"),c.href=ca.location.href,a.head.appendChild(c)):a=ca),d=jb.exec(e),f=!b&&[],d?[a.createElement(d[1])]:(d=D([e],a,f),f&&f.length&&u(f).remove(),u.merge([],d.childNodes))};u.fn.load=function(e,a,b){var c,d,f,p=this,l=e.indexOf(" ");return-1<l&&(c=Q(e.slice(l)),e=e.slice(0,l)),u.isFunction(a)?(b=a,a=void 0):a&&"object"==typeof a&&(d="POST"),
0<p.length&&u.ajax({url:e,type:d||"GET",dataType:"html",data:a}).done(function(e){f=arguments;p.html(c?u("<div>").append(u.parseHTML(e)).find(c):e)}).always(b&&function(e,a){p.each(function(){b.apply(this,f||[e.responseText,a,e])})}),this};u.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,a){u.fn[a]=function(e){return this.on(a,e)}});u.expr.pseudos.animated=function(e){return u.grep(u.timers,function(a){return e===a.elem}).length};u.offset={setOffset:function(e,
a,b){var c,d,f,p=u.css(e,"position"),l=u(e),g={};"static"===p&&(e.style.position="relative");var m=l.offset();var n=u.css(e,"top");var t=u.css(e,"left");("absolute"===p||"fixed"===p)&&-1<(n+t).indexOf("auto")?(c=l.position(),f=c.top,d=c.left):(f=parseFloat(n)||0,d=parseFloat(t)||0);u.isFunction(a)&&(a=a.call(e,b,u.extend({},m)));null!=a.top&&(g.top=a.top-m.top+f);null!=a.left&&(g.left=a.left-m.left+d);"using"in a?a.using.call(e,g):l.css(g)}};u.fn.extend({offset:function(e){if(arguments.length)return void 0===
e?this:this.each(function(a){u.offset.setOffset(this,e,a)});var a,b,c,d,f=this[0];if(f)return f.getClientRects().length?(c=f.getBoundingClientRect(),a=f.ownerDocument,b=a.documentElement,d=a.defaultView,{top:c.top+d.pageYOffset-b.clientTop,left:c.left+d.pageXOffset-b.clientLeft}):{top:0,left:0}},position:function(){if(this[0]){var e,a,b=this[0],c={top:0,left:0};return"fixed"===u.css(b,"position")?a=b.getBoundingClientRect():(e=this.offsetParent(),a=this.offset(),f(e[0],"html")||(c=e.offset()),c={top:c.top+
u.css(e[0],"borderTopWidth",!0),left:c.left+u.css(e[0],"borderLeftWidth",!0)}),{top:a.top-c.top-u.css(b,"marginTop",!0),left:a.left-c.left-u.css(b,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===u.css(e,"position");)e=e.offsetParent;return e||za})}});u.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,a){var b="pageYOffset"===a;u.fn[e]=function(c){return ba(this,function(e,c,d){var f;return u.isWindow(e)?f=e:9===e.nodeType&&
(f=e.defaultView),void 0===d?f?f[a]:e[c]:void(f?f.scrollTo(b?f.pageXOffset:d,b?d:f.pageYOffset):e[c]=d)},e,c,arguments.length)}});u.each(["top","left"],function(e,a){u.cssHooks[a]=pa(oa.pixelPosition,function(e,b){if(b)return b=Y(e,a),Sb.test(b)?u(e).position()[a]+"px":b})});u.each({Height:"height",Width:"width"},function(e,a){u.each({padding:"inner"+e,content:a,"":"outer"+e},function(b,c){u.fn[c]=function(d,f){var p=arguments.length&&(b||"boolean"!=typeof d),l=b||(!0===d||!0===f?"margin":"border");
return ba(this,function(a,b,d){var f;return u.isWindow(a)?0===c.indexOf("outer")?a["inner"+e]:a.document.documentElement["client"+e]:9===a.nodeType?(f=a.documentElement,Math.max(a.body["scroll"+e],f["scroll"+e],a.body["offset"+e],f["offset"+e],f["client"+e])):void 0===d?u.css(a,b,l):u.style(a,b,d,l)},a,p?d:void 0,p)}})});u.fn.extend({bind:function(e,a,b){return this.on(e,null,a,b)},unbind:function(e,a){return this.off(e,null,a)},delegate:function(e,a,b,c){return this.on(a,e,b,c)},undelegate:function(e,
a,b){return 1===arguments.length?this.off(e,"**"):this.off(a,e||"**",b)}});u.holdReady=function(e){e?u.readyWait++:u.ready(!0)};u.isArray=Array.isArray;u.parseJSON=JSON.parse;u.nodeName=f;"function"==typeof define&&define.amd&&define("jquery",[],function(){return u});var ac=a.jQuery,Kc=a.$;return u.noConflict=function(e){return a.$===u&&(a.$=Kc),e&&a.jQuery===u&&(a.jQuery=ac),u},b||(a.jQuery=a.$=u),u});
(function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){a.ui=a.ui||{};a.ui.version="1.12.1";(function(){function b(a,b,c){return[parseFloat(a[0])*(e.test(a[0])?b/100:1),parseFloat(a[1])*(e.test(a[1])?c/100:1)]}function d(e){var b=e[0];return 9===b.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:a.isWindow(b)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:b.preventDefault?{width:0,height:0,offset:{top:b.pageY,
left:b.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}var c,f=Math.max,g=Math.abs,m=/left|center|right/,l=/top|center|bottom/,n=/[\+\-]\d+(\.[\d]+)?%?/,q=/^\w+/,e=/%$/,p=a.fn.position;a.position={scrollbarWidth:function(){if(void 0!==c)return c;var e,b,d=a("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),f=d.children()[0];return a("body").append(d),e=f.offsetWidth,d.css("overflow","scroll"),
b=f.offsetWidth,e===b&&(b=d[0].clientWidth),d.remove(),c=e-b},getScrollInfo:function(e){var b=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),c=e.isWindow||e.isDocument?"":e.element.css("overflow-y");b="scroll"===b||"auto"===b&&e.width<e.element[0].scrollWidth;return{width:"scroll"===c||"auto"===c&&e.height<e.element[0].scrollHeight?a.position.scrollbarWidth():0,height:b?a.position.scrollbarWidth():0}},getWithinInfo:function(e){var b=a(e||window),c=a.isWindow(b[0]),d=!!b[0]&&9===b[0].nodeType;
return{element:b,isWindow:c,isDocument:d,offset:c||d?{left:0,top:0}:a(e).offset(),scrollLeft:b.scrollLeft(),scrollTop:b.scrollTop(),width:b.outerWidth(),height:b.outerHeight()}}};a.fn.position=function(e){if(!e||!e.of)return p.apply(this,arguments);e=a.extend({},e);var c,t,A,x,z,D,B=a(e.of),G=a.position.getWithinInfo(e.within),L=a.position.getScrollInfo(G),J=(e.collision||"flip").split(" "),P={};return D=d(B),B[0].preventDefault&&(e.at="left top"),t=D.width,A=D.height,x=D.offset,z=a.extend({},x),
a.each(["my","at"],function(){var a=(e[this]||"").split(" ");1===a.length&&(a=m.test(a[0])?a.concat(["center"]):l.test(a[0])?["center"].concat(a):["center","center"]);a[0]=m.test(a[0])?a[0]:"center";a[1]=l.test(a[1])?a[1]:"center";var b=n.exec(a[0]);var c=n.exec(a[1]);P[this]=[b?b[0]:0,c?c[0]:0];e[this]=[q.exec(a[0])[0],q.exec(a[1])[0]]}),1===J.length&&(J[1]=J[0]),"right"===e.at[0]?z.left+=t:"center"===e.at[0]&&(z.left+=t/2),"bottom"===e.at[1]?z.top+=A:"center"===e.at[1]&&(z.top+=A/2),c=b(P.at,t,
A),z.left+=c[0],z.top+=c[1],this.each(function(){var d,p=a(this),l=p.outerWidth(),m=p.outerHeight(),n=parseInt(a.css(this,"marginLeft"),10)||0,q=parseInt(a.css(this,"marginTop"),10)||0,w=l+n+(parseInt(a.css(this,"marginRight"),10)||0)+L.width,y=m+q+(parseInt(a.css(this,"marginBottom"),10)||0)+L.height,D=a.extend({},z),S=b(P.my,p.outerWidth(),p.outerHeight());"right"===e.my[0]?D.left-=l:"center"===e.my[0]&&(D.left-=l/2);"bottom"===e.my[1]?D.top-=m:"center"===e.my[1]&&(D.top-=m/2);D.left+=S[0];D.top+=
S[1];var K={marginLeft:n,marginTop:q};a.each(["left","top"],function(b,d){a.ui.position[J[b]]&&a.ui.position[J[b]][d](D,{targetWidth:t,targetHeight:A,elemWidth:l,elemHeight:m,collisionPosition:K,collisionWidth:w,collisionHeight:y,offset:[c[0]+S[0],c[1]+S[1]],my:e.my,at:e.at,within:G,elem:p})});e.using&&(d=function(a){var b=x.left-D.left,c=b+t-l,d=x.top-D.top,n=d+A-m,q={target:{element:B,left:x.left,top:x.top,width:t,height:A},element:{element:p,left:D.left,top:D.top,width:l,height:m},horizontal:0>
c?"left":0<b?"right":"center",vertical:0>n?"top":0<d?"bottom":"middle"};l>t&&t>g(b+c)&&(q.horizontal="center");m>A&&A>g(d+n)&&(q.vertical="middle");q.important=f(g(b),g(c))>f(g(d),g(n))?"horizontal":"vertical";e.using.call(this,a,q)});p.offset(a.extend(D,{using:d}))})};a.ui.position={fit:{left:function(e,a){var b,c=a.within,d=c.isWindow?c.scrollLeft:c.offset.left;c=c.width;var p=e.left-a.collisionPosition.marginLeft,l=d-p,g=p+a.collisionWidth-c-d;a.collisionWidth>c?0<l&&0>=g?(b=e.left+l+a.collisionWidth-
c-d,e.left+=l-b):e.left=0<g&&0>=l?d:l>g?d+c-a.collisionWidth:d:0<l?e.left+=l:0<g?e.left-=g:e.left=f(e.left-p,e.left)},top:function(e,a){var b,c=a.within;c=c.isWindow?c.scrollTop:c.offset.top;var d=a.within.height,p=e.top-a.collisionPosition.marginTop,l=c-p,g=p+a.collisionHeight-d-c;a.collisionHeight>d?0<l&&0>=g?(b=e.top+l+a.collisionHeight-d-c,e.top+=l-b):e.top=0<g&&0>=l?c:l>g?c+d-a.collisionHeight:c:0<l?e.top+=l:0<g?e.top-=g:e.top=f(e.top-p,e.top)}},flip:{left:function(e,a){var b,c,d=a.within,f=
d.offset.left+d.scrollLeft,p=d.width;d=d.isWindow?d.scrollLeft:d.offset.left;var l=e.left-a.collisionPosition.marginLeft,m=l-d;l=l+a.collisionWidth-p-d;var n="left"===a.my[0]?-a.elemWidth:"right"===a.my[0]?a.elemWidth:0,t="left"===a.at[0]?a.targetWidth:"right"===a.at[0]?-a.targetWidth:0,q=-2*a.offset[0];0>m?(b=e.left+n+t+q+a.collisionWidth-p-f,(0>b||g(m)>b)&&(e.left+=n+t+q)):0<l&&(c=e.left-a.collisionPosition.marginLeft+n+t+q-d,(0<c||l>g(c))&&(e.left+=n+t+q))},top:function(e,a){var b,c,d=a.within,
f=d.offset.top+d.scrollTop,p=d.height;d=d.isWindow?d.scrollTop:d.offset.top;var l=e.top-a.collisionPosition.marginTop,m=l-d;l=l+a.collisionHeight-p-d;var n="top"===a.my[1]?-a.elemHeight:"bottom"===a.my[1]?a.elemHeight:0,t="top"===a.at[1]?a.targetHeight:"bottom"===a.at[1]?-a.targetHeight:0,q=-2*a.offset[1];0>m?(c=e.top+n+t+q+a.collisionHeight-p-f,(0>c||g(m)>c)&&(e.top+=n+t+q)):0<l&&(b=e.top-a.collisionPosition.marginTop+n+t+q-d,(0<b||l>g(b))&&(e.top+=n+t+q))}},flipfit:{left:function(){a.ui.position.flip.left.apply(this,
arguments);a.ui.position.fit.left.apply(this,arguments)},top:function(){a.ui.position.flip.top.apply(this,arguments);a.ui.position.fit.top.apply(this,arguments)}}}})();a.ui.position;a.fn.scrollParent=function(b){var d=this.css("position"),c="absolute"===d,f=b?/(auto|scroll|hidden)/:/(auto|scroll)/;b=this.parents().filter(function(){var b=a(this);return c&&"static"===b.css("position")?!1:f.test(b.css("overflow")+b.css("overflow-y")+b.css("overflow-x"))}).eq(0);return"fixed"!==d&&b.length?b:a(this[0].ownerDocument||
document)};a.effects={effect:{}};(function(a,d){function b(a,b,c){var d=e[b.type]||{};return null==a?c||!b.def?null:b.def:(a=d.floor?~~a:parseFloat(a),isNaN(a)?b.def:d.mod?(a+d.mod)%d.mod:0>a?0:a>d.max?d.max:a)}function f(e){var b=n(),c=b._rgba=[];return e=e.toLowerCase(),w(l,function(a,f){var p;a=(a=f.re.exec(e))&&f.parse(a);f=f.space||"rgba";return a?(p=b[f](a),b[q[f].cache]=p[q[f].cache],c=b._rgba=p._rgba,!1):d}),c.length?("0,0,0,0"===c.join()&&a.extend(c,y.transparent),b):y[e]}function g(e,a,
b){return b=(b+1)%1,1>6*b?e+6*(a-e)*b:1>2*b?a:2>3*b?e+6*(a-e)*(2/3-b):e}var m=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],
16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],n=a.Color=function(e,b,c,d){return new a.Color.fn.parse(e,b,c,d)},q={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,
type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},e={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},p=n.support={},t=a("<p>")[0],w=a.each;t.style.cssText="background-color:rgba(1,1,1,.5)";p.rgba=-1<t.style.backgroundColor.indexOf("rgba");w(q,function(e,a){a.cache="_"+e;a.props.alpha={idx:3,type:"percent",def:1}});n.fn=a.extend(n.prototype,{parse:function(e,c,p,l){if(e===d)return this._rgba=[null,null,
null,null],this;(e.jquery||e.nodeType)&&(e=a(e).css(c),c=d);var g=this,m=a.type(e),t=this._rgba=[];return c!==d&&(e=[e,c,p,l],m="array"),"string"===m?this.parse(f(e)||y._default):"array"===m?(w(q.rgba.props,function(a,c){t[c.idx]=b(e[c.idx],c)}),this):"object"===m?(e instanceof n?w(q,function(a,b){e[b.cache]&&(g[b.cache]=e[b.cache].slice())}):w(q,function(c,d){var f=d.cache;w(d.props,function(a,c){if(!g[f]&&d.to){if("alpha"===a||null==e[a])return;g[f]=d.to(g._rgba)}g[f][c.idx]=b(e[a],c,!0)});g[f]&&
0>a.inArray(null,g[f].slice(0,3))&&(g[f][3]=1,d.from&&(g._rgba=d.from(g[f])))}),this):d},is:function(e){var a=n(e),b=!0,c=this;return w(q,function(e,f){var p,l=a[f.cache];return l&&(p=c[f.cache]||f.to&&f.to(c._rgba)||[],w(f.props,function(e,a){return null!=l[a.idx]?b=l[a.idx]===p[a.idx]:d})),b}),b},_space:function(){var e=[],a=this;return w(q,function(b,c){a[c.cache]&&e.push(b)}),e.pop()},transition:function(a,c){var d=n(a);a=d._space();var f=q[a],p=0===this.alpha()?n("transparent"):this,l=p[f.cache]||
f.to(p._rgba),g=l.slice();return d=d[f.cache],w(f.props,function(a,f){a=f.idx;var p=l[a],m=d[a],n=e[f.type]||{};null!==m&&(null===p?g[a]=m:(n.mod&&(m-p>n.mod/2?p+=n.mod:p-m>n.mod/2&&(p-=n.mod)),g[a]=b((m-p)*c+p,f)))}),this[a](g)},blend:function(e){if(1===this._rgba[3])return this;var b=this._rgba.slice(),c=b.pop(),d=n(e)._rgba;return n(a.map(b,function(e,a){return(1-c)*d[a]+c*e}))},toRgbaString:function(){var e="rgba(",b=a.map(this._rgba,function(e,a){return null==e?2<a?1:0:e});return 1===b[3]&&(b.pop(),
e="rgb("),e+b.join()+")"},toHslaString:function(){var e="hsla(",b=a.map(this.hsla(),function(e,a){return null==e&&(e=2<a?1:0),a&&3>a&&(e=Math.round(100*e)+"%"),e});return 1===b[3]&&(b.pop(),e="hsl("),e+b.join()+")"},toHexString:function(e){var b=this._rgba.slice(),c=b.pop();return e&&b.push(~~(255*c)),"#"+a.map(b,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}});n.fn.parse.prototype=n.fn;q.hsla.to=
function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var a,b,c=e[0]/255,d=e[1]/255,f=e[2]/255;e=e[3];var p=Math.max(c,d,f),l=Math.min(c,d,f),g=p-l,m=p+l,n=.5*m;return a=l===p?0:c===p?60*(d-f)/g+360:d===p?60*(f-c)/g+120:60*(c-d)/g+240,b=0===g?0:.5>=n?g/m:g/(2-m),[Math.round(a)%360,b,n,null==e?1:e]};q.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var a=e[0]/360,b=e[1],c=e[2];e=e[3];b=.5>=c?c*(1+b):c+b-c*b;c=2*c-b;return[Math.round(255*
g(c,b,a+1/3)),Math.round(255*g(c,b,a)),Math.round(255*g(c,b,a-1/3)),e]};w(q,function(e,c){var f=c.props,p=c.cache,l=c.to,g=c.from;n.fn[e]=function(e){if(l&&!this[p]&&(this[p]=l(this._rgba)),e===d)return this[p].slice();var c,m=a.type(e),t="array"===m||"object"===m?e:arguments,q=this[p].slice();return w(f,function(e,a){e=t["object"===m?e:a.idx];null==e&&(e=q[a.idx]);q[a.idx]=b(e,a)}),g?(c=n(g(q)),c[p]=q,c):n(q)};w(f,function(b,c){n.fn[b]||(n.fn[b]=function(d){var f,p=a.type(d),l="alpha"===b?this._hsla?
"hsla":"rgba":e,g=this[l](),n=g[c.idx];return"undefined"===p?n:("function"===p&&(d=d.call(this,n),p=a.type(d)),null==d&&c.empty?this:("string"===p&&(f=m.exec(d),f&&(d=n+parseFloat(f[2])*("+"===f[1]?1:-1))),g[c.idx]=d,this[l](g)))})})});n.hook=function(e){e=e.split(" ");w(e,function(e,b){a.cssHooks[b]={set:function(e,c){var d,l="";if("transparent"!==c&&("string"!==a.type(c)||(d=f(c)))){if(c=n(d||c),!p.rgba&&1!==c._rgba[3]){for(d="backgroundColor"===b?e.parentNode:e;(""===l||"transparent"===l)&&d&&
d.style;)try{l=a.css(d,"backgroundColor"),d=d.parentNode}catch(J){}c=c.blend(l&&"transparent"!==l?l:"_default")}c=c.toRgbaString()}try{e.style[b]=c}catch(J){}}};a.fx.step[b]=function(e){e.colorInit||(e.start=n(e.elem,b),e.end=n(e.end),e.colorInit=!0);a.cssHooks[b].set(e.elem,e.start.transition(e.end,e.pos))}})};n.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor");a.cssHooks.borderColor=
{expand:function(e){var a={};return w(["Top","Right","Bottom","Left"],function(b,c){a["border"+c+"Color"]=e}),a}};var y=a.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}})(a);(function(){function b(b){var c=b.ownerDocument.defaultView?
b.ownerDocument.defaultView.getComputedStyle(b,null):b.currentStyle,d={};if(c&&c.length&&c[0]&&c[c[0]])for(b=c.length;b--;){var f=c[b];"string"==typeof c[f]&&(d[a.camelCase(f)]=c[f])}else for(f in c)"string"==typeof c[f]&&(d[f]=c[f]);return d}var d=["add","remove","toggle"],c={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};a.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(b,c){a.fx.step[c]=function(b){("none"!==
b.end&&!b.setAttr||1===b.pos&&!b.setAttr)&&(a.style(b.elem,c,b.end),b.setAttr=!0)}});a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))});a.effects.animateClass=function(f,g,m,l){var n=a.speed(g,m,l);return this.queue(function(){var l=a(this),e=l.attr("class")||"",p=n.children?l.find("*").addBack():l;p=p.map(function(){return{el:a(this),start:b(this)}});var g=function(){a.each(d,function(e,a){f[a]&&l[a+"Class"](f[a])})};g();p=p.map(function(){this.end=
b(this.el[0]);var e=this.start,d=this.end,f,p={};for(f in d){var l=d[f];e[f]!==l&&(c[f]||(a.fx.step[f]||!isNaN(parseFloat(l)))&&(p[f]=l))}return this.diff=p,this});l.attr("class",e);p=p.map(function(){var e=this,b=a.Deferred(),c=a.extend({},n,{queue:!1,complete:function(){b.resolve(e)}});return this.el.animate(this.diff,c),b.promise()});a.when.apply(a,p.get()).done(function(){g();a.each(arguments,function(){var e=this.el;a.each(this.diff,function(a){e.css(a,"")})});n.complete.call(l[0])})})};a.fn.extend({addClass:function(b){return function(c,
d,f,n){return d?a.effects.animateClass.call(this,{add:c},d,f,n):b.apply(this,arguments)}}(a.fn.addClass),removeClass:function(b){return function(c,d,f,n){return 1<arguments.length?a.effects.animateClass.call(this,{remove:c},d,f,n):b.apply(this,arguments)}}(a.fn.removeClass),toggleClass:function(b){return function(c,d,f,n,q){return"boolean"==typeof d||void 0===d?f?a.effects.animateClass.call(this,d?{add:c}:{remove:c},f,n,q):b.apply(this,arguments):a.effects.animateClass.call(this,{toggle:c},d,f,n)}}(a.fn.toggleClass),
switchClass:function(b,c,d,l,n){return a.effects.animateClass.call(this,{add:c,remove:b},d,l,n)}})})();(function(){function b(b,c,d,l){return a.isPlainObject(b)&&(c=b,b=b.effect),b={effect:b},null==c&&(c={}),a.isFunction(c)&&(l=c,d=null,c={}),("number"==typeof c||a.fx.speeds[c])&&(l=d,d=c,c={}),a.isFunction(d)&&(l=d,d=null),c&&a.extend(b,c),d=d||c.duration,b.duration=a.fx.off?0:"number"==typeof d?d:d in a.fx.speeds?a.fx.speeds[d]:a.fx.speeds._default,b.complete=l||c.complete,b}function d(b){return!b||
"number"==typeof b||a.fx.speeds[b]?!0:"string"!=typeof b||a.effects.effect[b]?a.isFunction(b)?!0:"object"!=typeof b||b.effect?!1:!0:!0}function c(a,b){var c=b.outerWidth();b=b.outerHeight();a=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/.exec(a)||["",0,c,b,0];return{top:parseFloat(a[1])||0,right:"auto"===a[2]?c:parseFloat(a[2]),bottom:"auto"===a[3]?b:parseFloat(a[3]),left:parseFloat(a[4])||0}}a.expr&&a.expr.filters&&
a.expr.filters.animated&&(a.expr.filters.animated=function(b){return function(c){return!!a(c).data("ui-effects-animated")||b(c)}}(a.expr.filters.animated));!1!==a.uiBackCompat&&a.extend(a.effects,{save:function(a,b){for(var c=0,d=b.length;d>c;c++)null!==b[c]&&a.data("ui-effects-"+b[c],a[0].style[b[c]])},restore:function(a,b){for(var c,d=0,f=b.length;f>d;d++)null!==b[d]&&(c=a.data("ui-effects-"+b[d]),a.css(b[d],c))},setMode:function(a,b){return"toggle"===b&&(b=a.is(":hidden")?"show":"hide"),b},createWrapper:function(b){if(b.parent().is(".ui-effects-wrapper"))return b.parent();
var c={width:b.outerWidth(!0),height:b.outerHeight(!0),"float":b.css("float")},d=a("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),f={width:b.width(),height:b.height()},n=document.activeElement;try{n.id}catch(q){n=document.body}return b.wrap(d),(b[0]===n||a.contains(b[0],n))&&a(n).trigger("focus"),d=b.parent(),"static"===b.css("position")?(d.css({position:"relative"}),b.css({position:"relative"})):(a.extend(c,{position:b.css("position"),
zIndex:b.css("z-index")}),a.each(["top","left","bottom","right"],function(a,e){c[e]=b.css(e);isNaN(parseInt(c[e],10))&&(c[e]="auto")}),b.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),b.css(f),d.css(c).show()},removeWrapper:function(b){var c=document.activeElement;return b.parent().is(".ui-effects-wrapper")&&(b.parent().replaceWith(b),(b[0]===c||a.contains(b[0],c))&&a(c).trigger("focus")),b}});a.extend(a.effects,{version:"1.12.1",define:function(b,c,d){return d||(d=c,c="effect"),
a.effects.effect[b]=d,a.effects.effect[b].mode=c,d},scaledDimensions:function(a,b,c){if(0===b)return{height:0,width:0,outerHeight:0,outerWidth:0};var d="horizontal"!==c?(b||100)/100:1;b="vertical"!==c?(b||100)/100:1;return{height:a.height()*b,width:a.width()*d,outerHeight:a.outerHeight()*b,outerWidth:a.outerWidth()*d}},clipToBox:function(a){return{width:a.clip.right-a.clip.left,height:a.clip.bottom-a.clip.top,left:a.clip.left,top:a.clip.top}},unshift:function(a,b,c){var d=a.queue();1<b&&d.splice.apply(d,
[1,0].concat(d.splice(b,c)));a.dequeue()},saveStyle:function(a){a.data("ui-effects-style",a[0].style.cssText)},restoreStyle:function(a){a[0].style.cssText=a.data("ui-effects-style")||"";a.removeData("ui-effects-style")},mode:function(a,b){a=a.is(":hidden");return"toggle"===b&&(b=a?"show":"hide"),(a?"hide"===b:"show"===b)&&(b="none"),b},getBaseline:function(a,b){switch(a[0]){case "top":var c=0;break;case "middle":c=.5;break;case "bottom":c=1;break;default:c=a[0]/b.height}switch(a[1]){case "left":a=
0;break;case "center":a=.5;break;case "right":a=1;break;default:a=a[1]/b.width}return{x:a,y:c}},createPlaceholder:function(b){var c,d=b.css("position"),f=b.position();return b.css({marginTop:b.css("marginTop"),marginBottom:b.css("marginBottom"),marginLeft:b.css("marginLeft"),marginRight:b.css("marginRight")}).outerWidth(b.outerWidth()).outerHeight(b.outerHeight()),/^(static|relative)/.test(d)&&(d="absolute",c=a("<"+b[0].nodeName+">").insertAfter(b).css({display:/^(inline|ruby)/.test(b.css("display"))?
"inline-block":"block",visibility:"hidden",marginTop:b.css("marginTop"),marginBottom:b.css("marginBottom"),marginLeft:b.css("marginLeft"),marginRight:b.css("marginRight"),"float":b.css("float")}).outerWidth(b.outerWidth()).outerHeight(b.outerHeight()).addClass("ui-effects-placeholder"),b.data("ui-effects-placeholder",c)),b.css({position:d,left:f.left,top:f.top}),c},removePlaceholder:function(a){var b=a.data("ui-effects-placeholder");b&&(b.remove(),a.removeData("ui-effects-placeholder"))},cleanUp:function(b){a.effects.restoreStyle(b);
a.effects.removePlaceholder(b)},setTransition:function(b,c,d,l){return l=l||{},a.each(c,function(a,c){a=b.cssUnit(c);0<a[0]&&(l[c]=a[0]*d+a[1])}),l}});a.fn.extend({effect:function(){function c(b){function c(){g.removeData("ui-effects-animated");a.effects.cleanUp(g);"hide"===d.mode&&g.hide();f()}function f(){a.isFunction(e)&&e.call(g[0]);a.isFunction(b)&&b()}var g=a(this);d.mode=t.shift();!1===a.uiBackCompat||l?"none"===d.mode?(g[p](),f()):m.call(g[0],d,c):(g.is(":hidden")?"hide"===p:"show"===p)?(g[p](),
f()):m.call(g[0],d,f)}var d=b.apply(this,arguments),m=a.effects.effect[d.effect],l=m.mode,n=d.queue,q=n||"fx",e=d.complete,p=d.mode,t=[],w=function(e){var b=a(this),c=a.effects.mode(b,p)||l;b.data("ui-effects-animated",!0);t.push(c);l&&("show"===c||c===l&&"hide"===c)&&b.show();l&&"none"===c||a.effects.saveStyle(b);a.isFunction(e)&&e()};return a.fx.off||!m?p?this[p](d.duration,e):this.each(function(){e&&e.call(this)}):!1===n?this.each(w).each(c):this.queue(q,w).queue(q,c)},show:function(a){return function(c){if(d(c))return a.apply(this,
arguments);var f=b.apply(this,arguments);return f.mode="show",this.effect.call(this,f)}}(a.fn.show),hide:function(a){return function(c){if(d(c))return a.apply(this,arguments);var f=b.apply(this,arguments);return f.mode="hide",this.effect.call(this,f)}}(a.fn.hide),toggle:function(a){return function(c){if(d(c)||"boolean"==typeof c)return a.apply(this,arguments);var f=b.apply(this,arguments);return f.mode="toggle",this.effect.call(this,f)}}(a.fn.toggle),cssUnit:function(b){var c=this.css(b),d=[];return a.each(["em",
"px","%","pt"],function(a,b){0<c.indexOf(b)&&(d=[parseFloat(c),b])}),d},cssClip:function(a){return a?this.css("clip","rect("+a.top+"px "+a.right+"px "+a.bottom+"px "+a.left+"px)"):c(this.css("clip"),this)},transfer:function(b,c){var d=a(this),f=a(b.to),g="fixed"===f.css("position"),q=a("body"),e=g?q.scrollTop():0;q=g?q.scrollLeft():0;var p=f.offset();f={top:p.top-e,left:p.left-q,height:f.innerHeight(),width:f.innerWidth()};p=d.offset();var t=a("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(b.className).css({top:p.top-
e,left:p.left-q,height:d.innerHeight(),width:d.innerWidth(),position:g?"fixed":"absolute"}).animate(f,b.duration,b.easing,function(){t.remove();a.isFunction(c)&&c()})}});a.fx.step.clip=function(b){b.clipInit||(b.start=a(b.elem).cssClip(),"string"==typeof b.end&&(b.end=c(b.end,b.elem)),b.clipInit=!0);a(b.elem).cssClip({top:b.pos*(b.end.top-b.start.top)+b.start.top,right:b.pos*(b.end.right-b.start.right)+b.start.right,bottom:b.pos*(b.end.bottom-b.start.bottom)+b.start.bottom,left:b.pos*(b.end.left-
b.start.left)+b.start.left})}})();(function(){var b={};a.each(["Quad","Cubic","Quart","Quint","Expo"],function(a,c){b[c]=function(b){return Math.pow(b,a+2)}});a.extend(b,{Sine:function(a){return 1-Math.cos(a*Math.PI/2)},Circ:function(a){return 1-Math.sqrt(1-a*a)},Elastic:function(a){return 0===a||1===a?a:-Math.pow(2,8*(a-1))*Math.sin((80*(a-1)-7.5)*Math.PI/15)},Back:function(a){return a*a*(3*a-2)},Bounce:function(a){for(var b,d=4;((b=Math.pow(2,--d))-1)/11>a;);return 1/Math.pow(4,3-d)-7.5625*Math.pow((3*
b-2)/22-a,2)}});a.each(b,function(b,c){a.easing["easeIn"+b]=c;a.easing["easeOut"+b]=function(a){return 1-c(1-a)};a.easing["easeInOut"+b]=function(a){return.5>a?c(2*a)/2:1-c(-2*a+2)/2}})})();a.effects.define("blind","hide",function(b,d){var c={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},f=a(this),g=b.direction||"up",m=f.cssClip(),l={clip:a.extend({},m)},n=a.effects.createPlaceholder(f);l.clip[c[g][0]]=
l.clip[c[g][1]];"show"===b.mode&&(f.cssClip(l.clip),n&&n.css(a.effects.clipToBox(l)),l.clip=m);n&&n.animate(a.effects.clipToBox(l),b.duration,b.easing);f.animate(l,{queue:!1,duration:b.duration,easing:b.easing,complete:d})});a.effects.define("bounce",function(b,d){var c,f=a(this),g=b.mode,m="hide"===g;g="show"===g;var l=b.direction||"up";var n=b.distance,q=b.times||5,e=2*q+(g||m?1:0),p=b.duration/e;b=b.easing;var t="up"===l||"down"===l?"top":"left",w="up"===l||"left"===l,y=0,A=f.queue().length;a.effects.createPlaceholder(f);
l=f.css(t);n||(n=f["top"===t?"outerHeight":"outerWidth"]()/3);g&&(c={opacity:1},c[t]=l,f.css("opacity",0).css(t,w?2*-n:2*n).animate(c,p,b));m&&(n/=Math.pow(2,q-1));c={};for(c[t]=l;q>y;y++){var x={};x[t]=(w?"-=":"+=")+n;f.animate(x,p,b).animate(c,p,b);n=m?2*n:n/2}m&&(x={opacity:0},x[t]=(w?"-=":"+=")+n,f.animate(x,p,b));f.queue(d);a.effects.unshift(f,A,e+1)});a.effects.define("clip","hide",function(b,d){var c={},f=a(this);var g=b.direction||"vertical";var m="both"===g,l=m||"horizontal"===g;m=m||"vertical"===
g;g=f.cssClip();c.clip={top:m?(g.bottom-g.top)/2:g.top,right:l?(g.right-g.left)/2:g.right,bottom:m?(g.bottom-g.top)/2:g.bottom,left:l?(g.right-g.left)/2:g.left};a.effects.createPlaceholder(f);"show"===b.mode&&(f.cssClip(c.clip),c.clip=g);f.animate(c,{queue:!1,duration:b.duration,easing:b.easing,complete:d})});a.effects.define("drop","hide",function(b,d){var c=a(this),f="show"===b.mode;var g=b.direction||"left";var m="up"===g||"down"===g?"top":"left",l="up"===g||"left"===g?"-=":"+=",n="+="===l?"-=":
"+=",q={opacity:0};a.effects.createPlaceholder(c);g=b.distance||c["top"===m?"outerHeight":"outerWidth"](!0)/2;q[m]=l+g;f&&(c.css(q),q[m]=n+g,q.opacity=1);c.animate(q,{queue:!1,duration:b.duration,easing:b.easing,complete:d})});a.effects.define("explode","hide",function(b,d){function c(){w.push(this);w.length===m*l&&(n.css({visibility:"visible"}),a(w).remove(),d())}var f,g,m=b.pieces?Math.round(Math.sqrt(b.pieces)):3,l=m,n=a(this),q="show"===b.mode,e=n.show().css("visibility","hidden").offset(),p=
Math.ceil(n.outerWidth()/l),t=Math.ceil(n.outerHeight()/m),w=[];for(f=0;m>f;f++){var y=e.top+f*t;var A=f-(m-1)/2;for(g=0;l>g;g++){var x=e.left+g*p;var z=g-(l-1)/2;n.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-g*p,top:-f*t}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:p,height:t,left:x+(q?z*p:0),top:y+(q?A*t:0),opacity:q?0:1}).animate({left:x+(q?0:z*p),top:y+(q?0:A*t),opacity:q?1:0},b.duration||500,b.easing,
c)}}});a.effects.define("fade","toggle",function(b,d){var c="show"===b.mode;a(this).css("opacity",c?0:1).animate({opacity:c?1:0},{queue:!1,duration:b.duration,easing:b.easing,complete:d})});a.effects.define("fold","hide",function(b,d){var c=a(this),f=b.mode,g="show"===f;f="hide"===f;var m=b.size||15,l=/([0-9]+)%/.exec(m),n=b.horizFirst?["right","bottom"]:["bottom","right"],q=b.duration/2,e=a.effects.createPlaceholder(c),p=c.cssClip(),t={clip:a.extend({},p)},w={clip:a.extend({},p)},y=[p[n[0]],p[n[1]]],
A=c.queue().length;l&&(m=parseInt(l[1],10)/100*y[f?0:1]);t.clip[n[0]]=m;w.clip[n[0]]=m;w.clip[n[1]]=0;g&&(c.cssClip(w.clip),e&&e.css(a.effects.clipToBox(w)),w.clip=p);c.queue(function(c){e&&e.animate(a.effects.clipToBox(t),q,b.easing).animate(a.effects.clipToBox(w),q,b.easing);c()}).animate(t,q,b.easing).animate(w,q,b.easing).queue(d);a.effects.unshift(c,A,4)});a.effects.define("highlight","show",function(b,d){var c=a(this),f={backgroundColor:c.css("backgroundColor")};"hide"===b.mode&&(f.opacity=
0);a.effects.saveStyle(c);c.css({backgroundImage:"none",backgroundColor:b.color||"#ffff99"}).animate(f,{queue:!1,duration:b.duration,easing:b.easing,complete:d})});a.effects.define("size",function(b,d){var c,f,g=a(this),m=["fontSize"],l=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],n=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],q=b.mode,e="effect"!==q,p=b.scale||"both",t=b.origin||["middle","center"],w=g.css("position"),y=g.position(),A=a.effects.scaledDimensions(g),
x=b.from||A,z=b.to||a.effects.scaledDimensions(g,0);a.effects.createPlaceholder(g);"show"===q&&(f=x,x=z,z=f);var D=x.height/A.height;var B=x.width/A.width;var G=z.height/A.height;var L=z.width/A.width;("box"===p||"both"===p)&&(D!==G&&(x=a.effects.setTransition(g,l,D,x),z=a.effects.setTransition(g,l,G,z)),B!==L&&(x=a.effects.setTransition(g,n,B,x),z=a.effects.setTransition(g,n,L,z)));("content"===p||"both"===p)&&D!==G&&(x=a.effects.setTransition(g,m,D,x),z=a.effects.setTransition(g,m,G,z));t&&(c=a.effects.getBaseline(t,
A),x.top=(A.outerHeight-x.outerHeight)*c.y+y.top,x.left=(A.outerWidth-x.outerWidth)*c.x+y.left,z.top=(A.outerHeight-z.outerHeight)*c.y+y.top,z.left=(A.outerWidth-z.outerWidth)*c.x+y.left);g.css(x);"content"!==p&&"both"!==p||(l=l.concat(["marginTop","marginBottom"]).concat(m),n=n.concat(["marginLeft","marginRight"]),g.find("*[width]").each(function(){var c=a(this),d=a.effects.scaledDimensions(c),f={height:d.height*D,width:d.width*B,outerHeight:d.outerHeight*D,outerWidth:d.outerWidth*B};d={height:d.height*
G,width:d.width*L,outerHeight:d.height*G,outerWidth:d.width*L};D!==G&&(f=a.effects.setTransition(c,l,D,f),d=a.effects.setTransition(c,l,G,d));B!==L&&(f=a.effects.setTransition(c,n,B,f),d=a.effects.setTransition(c,n,L,d));e&&a.effects.saveStyle(c);c.css(f);c.animate(d,b.duration,b.easing,function(){e&&a.effects.restoreStyle(c)})}));g.animate(z,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){var b=g.offset();0===z.opacity&&g.css("opacity",x.opacity);e||(g.css("position","static"===
w?"relative":w).offset(b),a.effects.saveStyle(g));d()}})});a.effects.define("scale",function(b,d){var c=a(this),f=b.mode;f=parseInt(b.percent,10)||(0===parseInt(b.percent,10)?0:"effect"!==f?0:100);c=a.extend(!0,{from:a.effects.scaledDimensions(c),to:a.effects.scaledDimensions(c,f,b.direction||"both"),origin:b.origin||["middle","center"]},b);b.fade&&(c.from.opacity=1,c.to.opacity=0);a.effects.effect.size.call(this,c,d)});a.effects.define("puff","hide",function(b,d){b=a.extend(!0,{},b,{fade:!0,percent:parseInt(b.percent,
10)||150});a.effects.effect.scale.call(this,b,d)});a.effects.define("pulsate","show",function(b,d){var c=a(this),f=b.mode,g="show"===f;f=2*(b.times||5)+(g||"hide"===f?1:0);var m=b.duration/f,l=0,n=1,q=c.queue().length;for((g||!c.is(":visible"))&&(c.css("opacity",0).show(),l=1);f>n;n++)c.animate({opacity:l},m,b.easing),l=1-l;c.animate({opacity:l},m,b.easing);c.queue(d);a.effects.unshift(c,q,f+1)});a.effects.define("shake",function(b,d){var c=1,f=a(this),g=b.direction||"left",m=b.distance||20,l=b.times||
3,n=2*l+1,q=Math.round(b.duration/n),e="up"===g||"down"===g?"top":"left";g="up"===g||"left"===g;var p={},t={},w={},y=f.queue().length;a.effects.createPlaceholder(f);p[e]=(g?"-=":"+=")+m;t[e]=(g?"+=":"-=")+2*m;w[e]=(g?"-=":"+=")+2*m;for(f.animate(p,q,b.easing);l>c;c++)f.animate(t,q,b.easing).animate(w,q,b.easing);f.animate(t,q,b.easing).animate(p,q/2,b.easing).queue(d);a.effects.unshift(f,y,n+1)});a.effects.define("slide","show",function(b,d){var c=a(this),f={up:["bottom","top"],down:["top","bottom"],
left:["right","left"],right:["left","right"]},g=b.mode,m=b.direction||"left",l="up"===m||"down"===m?"top":"left",n="up"===m||"left"===m,q=b.distance||c["top"===l?"outerHeight":"outerWidth"](!0),e={};a.effects.createPlaceholder(c);var p=c.cssClip();var t=c.position()[l];e[l]=(n?-1:1)*q+t;e.clip=c.cssClip();e.clip[f[m][1]]=e.clip[f[m][0]];"show"===g&&(c.cssClip(e.clip),c.css(l,e[l]),e.clip=p,e[l]=t);c.animate(e,{queue:!1,duration:b.duration,easing:b.easing,complete:d})});!1!==a.uiBackCompat&&a.effects.define("transfer",
function(b,d){a(this).transfer(b,d)})});
(function(a){function b(a){a.async&&(a.filesLoaded+=1,a.filesLoaded===a.totalFiles&&a.callback&&a.callback())}function d(d,f){a.ajax({url:d,async:f.async,dataType:"text",success:function(a,e){c(a,f.mode);b(f)},error:function(a,e,c){console.log("Failed to download or parse "+d);b(f)}})}function c(b,c){var d="";b=b.split(/\n/);for(var e=/(\{\d+})/g,p=/\{(\d+)}/g,l=/(\\u.{4})/ig,m=0;m<b.length;m++)if(b[m]=b[m].replace(/^\s\s*/,"").replace(/\s\s*$/,""),0<b[m].length&&"#"!=b[m].match("^#")){var n=b[m].split("=");
if(0<n.length){for(var A=decodeURI(n[0]).replace(/^\s\s*/,"").replace(/\s\s*$/,""),x=1==n.length?"":n[1];"\\"==x.match(/\\$/);)x=x.substring(0,x.length-1),x+=b[++m].replace(/\s\s*$/,"");for(var z=2;z<n.length;z++)x+="="+n[z];x=x.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if("map"==c||"both"==c){if(n=x.match(l))for(z=0;z<n.length;z++)x=x.replace(n[z],g(n[z]));a.i18n.map[A]=x}if("vars"==c||"both"==c)if(x=x.replace(/"/g,'\\"'),f(A),e.test(x)){n=x.split(e);z=!0;for(var D="",B=[],G=0;G<n.length;G++)!e.test(n[G])||
0!=B.length&&-1!=B.indexOf(n[G])||(z||(D+=","),D+=n[G].replace(p,"v$1"),B.push(n[G]),z=!1);d+=A+"=function("+D+"){";A='"'+x.replace(p,'"+v$1+"')+'"';d+="return "+A+";};"}else d+=A+'="'+x+'";'}}eval(d)}function f(a){if(/\./.test(a)){var b="";a=a.split(/\./);for(var c=0;c<a.length;c++)0<c&&(b+="."),b+=a[c],eval("typeof "+b+' == "undefined"')&&eval(b+"={};")}}function g(a){var b=[];a=parseInt(a.substr(2),16);0<=a&&a<Math.pow(2,16)&&b.push(a);a="";for(var c=0;c<b.length;++c)a+=String.fromCharCode(b[c]);
return a}a.i18n={};a.i18n.map={};a.i18n.properties=function(b){b=a.extend({name:"Messages",language:"",path:"",mode:"vars",cache:!1,encoding:"UTF-8",async:!1,checkAvailableLanguages:!1,callback:null},b);b.language=this.normaliseLanguageCode(b.language);var c=function(c){b.totalFiles=0;b.filesLoaded=0;var e=(e=b.name)&&e.constructor==Array?e:[e];if(b.async)for(var f=0,l=e.length;f<l;f++){b.totalFiles+=1;var g=b.language.substring(0,2);if(0==c.length||-1!=a.inArray(g,c))b.totalFiles+=1;5<=b.language.length&&
(g=b.language.substring(0,5),0==c.length||-1!=a.inArray(g,c))&&(b.totalFiles+=1)}f=0;for(l=e.length;f<l;f++)d(b.path+e[f]+".properties",b),g=b.language.substring(0,2),0!=c.length&&-1==a.inArray(g,c)||d(b.path+e[f]+"_"+g+".properties",b),5<=b.language.length&&(g=b.language.substring(0,5),0!=c.length&&-1==a.inArray(g,c)||d(b.path+e[f]+"_"+g+".properties",b));b.callback&&!b.async&&b.callback()};b.checkAvailableLanguages?a.ajax({url:b.path+"languages.json",async:b.async,cache:!1,success:function(a,e,
b){c(a.languages||[])}}):c([])};a.i18n.prop=function(b){var c=a.i18n.map[b];if(null==c)return b;var d;2==arguments.length&&a.isArray(arguments[1])&&(d=arguments[1]);var e;if("string"==typeof c){for(e=0;-1!=(e=c.indexOf("\\",e));)c="t"==c.charAt(e+1)?c.substring(0,e)+"\t"+c.substring(e++ +2):"r"==c.charAt(e+1)?c.substring(0,e)+"\r"+c.substring(e++ +2):"n"==c.charAt(e+1)?c.substring(0,e)+"\n"+c.substring(e++ +2):"f"==c.charAt(e+1)?c.substring(0,e)+"\f"+c.substring(e++ +2):"\\"==c.charAt(e+1)?c.substring(0,
e)+"\\"+c.substring(e++ +2):c.substring(0,e)+c.substring(e+1);var f=[],l,g;for(e=0;e<c.length;)if("'"==c.charAt(e))if(e==c.length-1)c=c.substring(0,e);else if("'"==c.charAt(e+1))c=c.substring(0,e)+c.substring(++e);else{for(l=e+2;-1!=(l=c.indexOf("'",l));)if(l==c.length-1||"'"!=c.charAt(l+1)){c=c.substring(0,e)+c.substring(e+1,l)+c.substring(l+1);e=l-1;break}else c=c.substring(0,l)+c.substring(++l);-1==l&&(c=c.substring(0,e)+c.substring(e+1))}else"{"==c.charAt(e)?(l=c.indexOf("}",e+1),-1==l?e++:(g=
parseInt(c.substring(e+1,l)),!isNaN(g)&&0<=g?(e=c.substring(0,e),""!=e&&f.push(e),f.push(g),e=0,c=c.substring(l+1)):e=l+1)):e++;""!=c&&f.push(c);c=f;a.i18n.map[b]=f}if(0==c.length)return"";if(1==c.length&&"string"==typeof c[0])return c[0];f="";for(e=0;e<c.length;e++)f="string"==typeof c[e]?f+c[e]:d&&c[e]<d.length?f+d[c[e]]:!d&&c[e]+1<arguments.length?f+arguments[c[e]+1]:f+("{"+c[e]+"}");return f};a.i18n.normaliseLanguageCode=function(a){if(!a||2>a.length)a=navigator.languages?navigator.languages[0]:
navigator.language||navigator.userLanguage||"en";a=a.toLowerCase();a=a.replace(/-/,"_");3<a.length&&(a=a.substring(0,3)+a.substring(3).toUpperCase());return a};var m;m||(m=function(a,b,c){if("[object RegExp]"!==Object.prototype.toString.call(b))return"undefined"==typeof m._nativeSplit?a.split(b,c):m._nativeSplit.call(a,b,c);var e=[],d=0,f=(b.ignoreCase?"i":"")+(b.multiline?"m":"")+(b.sticky?"y":"");b=new RegExp(b.source,f+"g");var l,g,n;a+="";m._compliantExecNpcg||(l=new RegExp("^"+b.source+"$(?!\\s)",
f));if(void 0===c||0>+c)c=Infinity;else if(c=Math.floor(+c),!c)return[];for(;g=b.exec(a);){f=g.index+g[0].length;if(f>d&&(e.push(a.slice(d,g.index)),!m._compliantExecNpcg&&1<g.length&&g[0].replace(l,function(){for(var e=1;e<arguments.length-2;e++)void 0===arguments[e]&&(g[e]=void 0)}),1<g.length&&g.index<a.length&&Array.prototype.push.apply(e,g.slice(1)),n=g[0].length,d=f,e.length>=c))break;b.lastIndex===g.index&&b.lastIndex++}d===a.length?!n&&b.test("")||e.push(""):e.push(a.slice(d));return e.length>
c?e.slice(0,c):e},m._compliantExecNpcg=void 0===/()??/.exec("")[1],m._nativeSplit=String.prototype.split);String.prototype.split=function(a,b){return m(this,a,b)}})(jQuery);
(function(a,b){function d(e,a,b){var c=q[a.type]||{};if(null==e)return b||!a.def?null:a.def;e=c.floor?~~e:parseFloat(e);return isNaN(e)?a.def:c.mod?(e+c.mod)%c.mod:0>e?0:c.max<e?c.max:e}function c(e){var b=l(),c=b._rgba=[];e=e.toLowerCase();t(m,function(a,d){a=(a=d.re.exec(e))&&d.parse(a);d=d.space||"rgba";if(a)return a=b[d](a),b[n[d].cache]=a[n[d].cache],c=b._rgba=a._rgba,!1});return c.length?("0,0,0,0"===c.join()&&a.extend(c,w.transparent),b):w[e]}function f(e,a,b){b=(b+1)%1;return 1>6*b?e+(a-e)*
b*6:1>2*b?a:2>3*b?e+(a-e)*(2/3-b)*6:e}var g=/^([\-+])=\s*(\d+\.?\d*)/,m=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],
16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],l=a.Color=function(e,b,c,d){return new a.Color.fn.parse(e,b,c,d)},n={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,
type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},q={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},e=l.support={},p=a("<p>")[0],t=a.each;p.style.cssText="background-color:rgba(1,1,1,.5)";e.rgba=-1<p.style.backgroundColor.indexOf("rgba");t(n,function(e,a){a.cache="_"+e;a.props.alpha={idx:3,type:"percent",def:1}});l.fn=a.extend(l.prototype,{parse:function(e,f,p,g){if(e===b)return this._rgba=[null,null,null,null],this;if(e.jquery||e.nodeType)e=
a(e).css(f),f=b;var m=this,q=a.type(e),y=this._rgba=[];f!==b&&(e=[e,f,p,g],q="array");if("string"===q)return this.parse(c(e)||w._default);if("array"===q)return t(n.rgba.props,function(a,b){y[b.idx]=d(e[b.idx],b)}),this;if("object"===q)return e instanceof l?t(n,function(a,b){e[b.cache]&&(m[b.cache]=e[b.cache].slice())}):t(n,function(b,c){var f=c.cache;t(c.props,function(a,b){if(!m[f]&&c.to){if("alpha"===a||null==e[a])return;m[f]=c.to(m._rgba)}m[f][b.idx]=d(e[a],b,!0)});m[f]&&0>a.inArray(null,m[f].slice(0,
3))&&(m[f][3]=1,c.from&&(m._rgba=c.from(m[f])))}),this},is:function(e){var a=l(e),b=!0,c=this;t(n,function(e,d){var f=a[d.cache];if(f){var p=c[d.cache]||d.to&&d.to(c._rgba)||[];t(d.props,function(e,a){if(null!=f[a.idx])return b=f[a.idx]===p[a.idx]})}return b});return b},_space:function(){var e=[],a=this;t(n,function(b,c){a[c.cache]&&e.push(b)});return e.pop()},transition:function(e,a){var b=l(e);e=b._space();var c=n[e],f=0===this.alpha()?l("transparent"):this,p=f[c.cache]||c.to(f._rgba),g=p.slice();
b=b[c.cache];t(c.props,function(e,c){e=c.idx;var f=p[e],l=b[e],m=q[c.type]||{};null!==l&&(null===f?g[e]=l:(m.mod&&(l-f>m.mod/2?f+=m.mod:f-l>m.mod/2&&(f-=m.mod)),g[e]=d((l-f)*a+f,c)))});return this[e](g)},blend:function(e){if(1===this._rgba[3])return this;var b=this._rgba.slice(),c=b.pop(),d=l(e)._rgba;return l(a.map(b,function(e,a){return(1-c)*d[a]+c*e}))},toRgbaString:function(){var e="rgba(",b=a.map(this._rgba,function(e,a){return null==e?2<a?1:0:e});1===b[3]&&(b.pop(),e="rgb(");return e+b.join()+
")"},toHslaString:function(){var e="hsla(",b=a.map(this.hsla(),function(e,a){null==e&&(e=2<a?1:0);a&&3>a&&(e=Math.round(100*e)+"%");return e});1===b[3]&&(b.pop(),e="hsl(");return e+b.join()+")"},toHexString:function(e){var b=this._rgba.slice(),c=b.pop();e&&b.push(~~(255*c));return"#"+a.map(b,function(e){e=(e||0).toString(16);return 1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}});l.fn.parse.prototype=l.fn;n.hsla.to=function(e){if(null==
e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var a=e[0]/255,b=e[1]/255,c=e[2]/255;e=e[3];var d=Math.max(a,b,c),f=Math.min(a,b,c),p=d-f,l=d+f,g=.5*l;return[Math.round(f===d?0:a===d?60*(b-c)/p+360:b===d?60*(c-a)/p+120:60*(a-b)/p+240)%360,0===p?0:.5>=g?p/l:p/(2-l),g,null==e?1:e]};n.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var a=e[0]/360,b=e[1],c=e[2];e=e[3];b=.5>=c?c*(1+b):c+b-c*b;c=2*c-b;return[Math.round(255*f(c,b,a+1/3)),Math.round(255*f(c,
b,a)),Math.round(255*f(c,b,a-1/3)),e]};t(n,function(e,c){var f=c.props,p=c.cache,m=c.to,n=c.from;l.fn[e]=function(e){m&&!this[p]&&(this[p]=m(this._rgba));if(e===b)return this[p].slice();var c=a.type(e),g="array"===c||"object"===c?e:arguments,q=this[p].slice();t(f,function(e,a){e=g["object"===c?e:a.idx];null==e&&(e=q[a.idx]);q[a.idx]=d(e,a)});if(n){var w=l(n(q));w[p]=q;return w}return l(q)};t(f,function(b,c){l.fn[b]||(l.fn[b]=function(d){var f=a.type(d),p="alpha"===b?this._hsla?"hsla":"rgba":e,l=this[p](),
m=l[c.idx];if("undefined"===f)return m;"function"===f&&(d=d.call(this,m),f=a.type(d));if(null==d&&c.empty)return this;"string"===f&&(f=g.exec(d))&&(d=m+parseFloat(f[2])*("+"===f[1]?1:-1));l[c.idx]=d;return this[p](l)})})});l.hook=function(b){b=b.split(" ");t(b,function(b,d){a.cssHooks[d]={set:function(b,f){var p,g="";if("transparent"!==f&&("string"!==a.type(f)||(p=c(f)))){f=l(p||f);if(!e.rgba&&1!==f._rgba[3]){for(p="backgroundColor"===d?b.parentNode:b;(""===g||"transparent"===g)&&p&&p.style;)try{g=
a.css(p,"backgroundColor"),p=p.parentNode}catch(L){}f=f.blend(g&&"transparent"!==g?g:"_default")}f=f.toRgbaString()}try{b.style[d]=f}catch(L){}}};a.fx.step[d]=function(e){e.colorInit||(e.start=l(e.elem,d),e.end=l(e.end),e.colorInit=!0);a.cssHooks[d].set(e.elem,e.start.transition(e.end,e.pos))}})};l.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor");a.cssHooks.borderColor={expand:function(e){var a=
{};t(["Top","Right","Bottom","Left"],function(b,c){a["border"+c+"Color"]=e});return a}};var w=a.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}})(jQuery);
(function(){function a(a){var b=a.handler,c=(a.namespace||"").toLowerCase().split("."),f=[],g;$.each(c,function(){""!=this&&"autocomplete"!=this&&/^(key|alt|ctrl|meta|shift)_/.test(this)?f.push(/^key_/.test(this)?this.substring(4):this):g=g?g+("."+this):this});0!=f.length&&(a.namespace=g,a.handler=function(a){if(this===a.target||!/textarea|select/i.test(a.target.nodeName)&&"text"!==a.target.type&&"true"!=$(a.target).prop("contenteditable")){var c=$.hotkeys.specialKeys[a.which||a.keyCode],d=String.fromCharCode(a.which).toLowerCase(),
g="",e={};a.altKey&&"alt"!==c&&(g+="alt_");a.ctrlKey&&"ctrl"!==c&&(g+="ctrl_");a.metaKey&&!a.ctrlKey&&"meta"!==c&&(g+="meta_");a.shiftKey&&"shift"!==c&&(g+="shift_");c?e[g+c]=!0:(e[g+d]=!0,e[g+$.hotkeys.shiftNums[d]]=!0,"shift_"===g&&(e[$.hotkeys.shiftNums[d]]=!0));c=0;for(d=f.length;c<d;c++)if(e[f[c]])return b.apply(this,arguments)}})}$.hotkeys={version:"0.8+",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",
35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",188:",",190:".",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?",
"\\":"|"}};$.each(["keydown","keyup","keypress"],function(){$.event.special[this]={add:a}})})();
(function(a){var b,d,c={className:"autosizejs",append:"",callback:!1},f="fontFamily fontSize fontWeight fontStyle letterSpacing textTransform wordSpacing textIndent".split(" "),g=a('<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; width: 0; min-height:0 !important; overflow:hidden;"/>').data("autosize",!0)[0];g.style.lineHeight=
"99px";"99px"===a(g).css("lineHeight")&&f.push("lineHeight");g.style.lineHeight="";a.fn.autosize=function(m){return m=a.extend({},c,m||{}),g.parentNode!==document.body&&(a(document.body).append(g),g.value="\n\n\n",g.scrollTop=9E4,b=g.scrollHeight===g.scrollTop+g.clientHeight),this.each(function(){function c(){d=t;g.className=m.className;a.each(f,function(e,a){g.style[a]=w.css(a)})}function n(){var a,f;if(d!==t&&c(),!e){e=!0;g.value=t.value+m.append;g.style.overflowY=t.style.overflowY;var p=parseInt(t.style.height,
10);g.style.width=Math.max(w.width(),0)+"px";b?a=g.scrollHeight:(g.scrollTop=0,g.scrollTop=9E4,a=g.scrollTop);var l=parseInt(w.css("maxHeight"),10);l=l&&0<l?l:9E4;a>l?(a=l,f="scroll"):q>a&&(a=q);a+=y;t.style.overflowY=f||"hidden";p!==a&&(t.style.height=a+"px",A&&m.callback.call(t));setTimeout(function(){e=!1},1)}}var q,e,p,t=this,w=a(t),y=0,A=a.isFunction(m.callback);w.data("autosize")||(("border-box"===w.css("box-sizing")||"border-box"===w.css("-moz-box-sizing")||"border-box"===w.css("-webkit-box-sizing"))&&
(y=w.outerHeight()-w.height()),q=Math.max(parseInt(w.css("minHeight"),10)-y,w.height()),p="none"===w.css("resize")||"vertical"===w.css("resize")?"none":"horizontal",w.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word",resize:p}).data("autosize",!0),"onpropertychange"in t?"oninput"in t?t.oninput=t.onkeyup=n:t.onpropertychange=n:t.oninput=n,a(window).on("resize",function(){e=!1;n()}),w.on("autosize",function(){e=!1;n()}),n())})}})(window.jQuery||window.Zepto);
(function(a){function b(b){var c=b.data;b.isDefaultPrevented()||(b.preventDefault(),a(b.target).ajaxSubmit(c))}function d(b){var c=b.target,d=a(c);if(!d.is("[type=submit],[type=image]")){c=d.closest("[type=submit]");if(0===c.length)return;c=c[0]}var e=this;e.clk=c;"image"==c.type&&(void 0!==b.offsetX?(e.clk_x=b.offsetX,e.clk_y=b.offsetY):"function"==typeof a.fn.offset?(d=d.offset(),e.clk_x=b.pageX-d.left,e.clk_y=b.pageY-d.top):(e.clk_x=b.pageX-c.offsetLeft,e.clk_y=b.pageY-c.offsetTop));setTimeout(function(){e.clk=
e.clk_x=e.clk_y=null},100)}function c(){if(a.fn.ajaxSubmit.debug){var b="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(b):window.opera&&window.opera.postError&&window.opera.postError(b)}}var f=void 0!==a("<input type='file'/>").get(0).files;var g=void 0!==window.FormData;var m=!!a.fn.prop;a.fn.attr2=function(){if(!m)return this.attr.apply(this,arguments);var a=this.prop.apply(this,arguments);return a&&a.jquery||"string"===typeof a?a:
this.attr.apply(this,arguments)};a.fn.ajaxSubmit=function(b){function d(e){e=a.param(e,b.traditional).split("&");var c=e.length,d=[],f;for(f=0;f<c;f++){e[f]=e[f].replace(/\+/g," ");var p=e[f].split("=");d.push([decodeURIComponent(p[0]),decodeURIComponent(p[1])])}return d}function l(e){for(var c=new FormData,f=0;f<e.length;f++)c.append(e[f].name,e[f].value);if(b.extraData)for(e=d(b.extraData),f=0;f<e.length;f++)e[f]&&c.append(e[f][0],e[f][1]);b.data=null;f=a.extend(!0,{},a.ajaxSettings,b,{contentType:!1,
processData:!1,cache:!1,type:t||"POST"});b.uploadProgress&&(f.xhr=function(){var e=a.ajaxSettings.xhr();e.upload&&e.upload.addEventListener("progress",function(e){var a=0,c=e.loaded||e.position,d=e.total;e.lengthComputable&&(a=Math.ceil(c/d*100));b.uploadProgress(e,c,d,a)},!1);return e});f.data=null;var p=f.beforeSend;f.beforeSend=function(e,a){a.data=b.formData?b.formData:c;p&&p.call(this,e,a)};return f.ajax_caller(f)}function e(d,f,l){function g(e){var a=null;try{e.contentWindow&&(a=e.contentWindow.document)}catch(Ja){c("cannot get iframe.contentWindow document: "+
Ja)}if(a)return a;try{a=e.contentDocument?e.contentDocument:e.document}catch(Ja){c("cannot get iframe.contentDocument: "+Ja),a=e.document}return a}function n(){function e(){try{var a=g(I).readyState;c("state = "+a);a&&"uninitialized"==a.toLowerCase()&&setTimeout(e,50)}catch(Ga){c("Server abort: ",Ga," (",Ga.name,")"),q(2),D&&clearTimeout(D),D=void 0}}var b=p.attr2("target"),d=p.attr2("action");w.setAttribute("target",L);t&&!/post/i.test(t)||w.setAttribute("method","POST");d!=E.url&&w.setAttribute("action",
E.url);E.skipEncodingOverride||t&&!/post/i.test(t)||p.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});E.timeout&&(D=setTimeout(function(){z=!0;q(1)},E.timeout));var f=[];try{if(E.extraData)for(var l in E.extraData)E.extraData.hasOwnProperty(l)&&(a.isPlainObject(E.extraData[l])&&E.extraData[l].hasOwnProperty("name")&&E.extraData[l].hasOwnProperty("value")?f.push(a('<input type="hidden" name="'+E.extraData[l].name+'">').val(E.extraData[l].value).appendTo(w)[0]):f.push(a('<input type="hidden" name="'+
l+'">').val(E.extraData[l]).appendTo(w)[0]));"json"==(E.dataType||"html")&&f.push(a('<input type="hidden" name="jsonashtml">').val("true").appendTo(w)[0]);f.push(a('<input type="hidden" name="xhriniframe">').val("true").appendTo(w)[0]);E.iframeTarget||X.appendTo("body");I.attachEvent?I.attachEvent("onload",q):I.addEventListener("load",q,!1);setTimeout(e,15);try{w.submit()}catch(Ca){document.createElement("form").submit.apply(w)}}finally{w.setAttribute("action",d),b?w.setAttribute("target",b):p.removeAttr("target"),
a(f).remove()}}function q(e){if(!J.aborted&&!P)if(Q=g(I),Q||(c("cannot access response document"),e=2),1===e&&J)J.abort("timeout"),B.reject(J,"timeout");else if(2==e&&J)J.abort("server abort"),B.reject(J,"error","server abort");else if(Q&&Q.location.href!=E.iframeSrc||z){I.detachEvent?I.detachEvent("onload",q):I.removeEventListener("load",q,!1);e="success";var b;try{if(z)throw"timeout";var d="xml"==E.dataType||Q.XMLDocument||a.isXMLDoc(Q);c("isXml="+d);if(!d&&window.opera&&(null===Q.body||!Q.body.innerHTML)&&
--R){c("requeing onLoad callback, DOM not available");setTimeout(q,250);return}var f=Q.body?Q.body:Q.documentElement;J.responseText=f?f.innerHTML:null;J.responseXML=Q.XMLDocument?Q.XMLDocument:Q;d&&(E.dataType="xml");J.getResponseHeader=function(e){return{"content-type":E.dataType}[e.toLowerCase()]};f&&(J.status=Number(f.getAttribute("status"))||J.status,J.statusText=f.getAttribute("statusText")||J.statusText);var p=(E.dataType||"html").toLowerCase(),l=/(json|script|text)/.test(p);if(l||E.textarea){var m=
Q.getElementsByTagName("textarea")[0];if(m)J.responseText=m.value,J.status=Number(m.getAttribute("status"))||J.status,J.statusText=m.getAttribute("statusText")||J.statusText;else if(l){var n=Q.getElementsByTagName("pre")[0],t=Q.getElementsByTagName("body")[0];n?J.responseText=n.textContent?n.textContent:n.innerText:t&&(J.responseText=t.textContent?t.textContent:t.innerText)}}else"xml"==p&&!J.responseXML&&J.responseText&&(J.responseXML=C(J.responseText));try{ma=da(J,p,E)}catch(ia){e="parsererror",
J.error=b=ia||e}}catch(ia){c("error caught: ",ia),e="error",J.error=b=ia||e}J.aborted&&(c("upload aborted"),e=null);J.status&&(e=200<=J.status&&300>J.status||304===J.status?"success":"error");"success"===e?(E.success&&E.success.call(E.context,ma,"success",J),B.resolve(J.responseText,"success",J),x&&a.event.trigger("ajaxSuccess",[J,E])):e&&(void 0===b&&(b=J.statusText),E.error&&E.error.call(E.context,J,e,b),B.reject(J,"error",b),x&&a.event.trigger("ajaxError",[J,E,b]));x&&a.event.trigger("ajaxComplete",
[J,E]);x&&!--a.active&&a.event.trigger("ajaxStop");E.complete&&E.complete.call(E.context,J,e);P=!0;E.timeout&&clearTimeout(D);setTimeout(function(){E.iframeTarget?X.attr("src",E.iframeSrc):X.remove();J.responseXML=null},100)}}var w=p[0],y,x,z,D,B=a.Deferred();B.abort=function(e){J.abort(e)};if(d)for(y=0;y<A.length;y++){var G=a(A[y]);m?G.prop("disabled",!1):G.removeAttr("disabled")}if(f)var E=l;else b.on_login=function(){e(d,!0,E)},b=bm._modified_ajax_settings(b),E=a.extend(!0,{},a.ajaxSettings,b);
E.context=E.context||E;var L="jqFormIO"+(new Date).getTime();if(E.iframeTarget){var X=a(E.iframeTarget);(l=X.attr2("name"))?L=l:X.attr2("name",L)}else X=a('<iframe name="'+L+'" src="'+E.iframeSrc+'" />'),X.css({position:"absolute",top:"-1000px",left:"-1000px"});var I=X[0];var J={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(e){var b="timeout"===e?"timeout":"aborted";
c("aborting upload... "+b);this.aborted=1;try{I.contentWindow.document.execCommand&&I.contentWindow.document.execCommand("Stop")}catch(Ja){}X.attr("src",E.iframeSrc);J.error=b;E.error&&E.error.call(E.context,J,b,e);x&&a.event.trigger("ajaxError",[J,E,b]);E.complete&&E.complete.call(E.context,J,b)}};(x=E.global)&&0===a.active++&&a.event.trigger("ajaxStart");x&&a.event.trigger("ajaxSend",[J,E]);if(E.beforeSend&&!1===E.beforeSend.call(E.context,J,E))return E.global&&a.active--,B.reject(),B;if(J.aborted)return B.reject(),
B;(f=w.clk)&&(l=f.name)&&!f.disabled&&(E.extraData=E.extraData||{},E.extraData[l]=f.value,"image"==f.type&&(E.extraData[l+".x"]=w.clk_x,E.extraData[l+".y"]=w.clk_y));f=a("meta[name=csrf-token]").attr("content");(l=a("meta[name=csrf-param]").attr("content"))&&f&&(E.extraData=E.extraData||{},E.extraData[l]=f);E.forceSync?n():setTimeout(n,10);var ma,Q,R=50,P,C=a.parseXML||function(e,a){window.ActiveXObject?(a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(e)):a=(new DOMParser).parseFromString(e,
"text/xml");return a&&a.documentElement&&"parsererror"!=a.documentElement.nodeName?a:null},fa=a.parseJSON||function(e){return window.eval("("+e+")")},da=function(e,b,c){var d=e.getResponseHeader("content-type")||"",f="xml"===b||!b&&0<=d.indexOf("xml");e=f?e.responseXML:e.responseText;f&&"parsererror"===e.documentElement.nodeName&&a.error&&a.error("parsererror");c&&c.dataFilter&&(e=c.dataFilter(e,b));"string"===typeof e&&("json"===b||!b&&0<=d.indexOf("json")?e=fa(e):("script"===b||!b&&0<=d.indexOf("javascript"))&&
a.globalEval(e));return e};return B}if(!this.length)return c("ajaxSubmit: skipping submit process - no element selected"),this;var p=this;"function"==typeof b?b={success:b}:void 0===b&&(b={});var t=b.type||this.attr2("method");var w=b.url||this.attr2("action");(w=(w="string"===typeof w?a.trim(w):"")||window.location.href||"")&&(w=(w.match(/^([^#]+)/)||[])[1]);b=a.extend(!0,{url:w,success:a.ajaxSettings.success,type:t||a.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":
"about:blank",ajax_caller:bm.ajax},b);w={};this.trigger("form-pre-serialize",[this,b,w]);if(w.veto)return c("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(b.beforeSerialize&&!1===b.beforeSerialize(this,b))return c("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var y=b.traditional;void 0===y&&(y=a.ajaxSettings.traditional);var A=[],x=this.formToArray(b.semantic,A);if(b.data){b.extraData=b.data;var z=a.param(b.data,y)}if(b.beforeSubmit&&!1===b.beforeSubmit(x,this,
b))return c("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[x,this,b,w]);if(w.veto)return c("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;w=a.param(x,y);z&&(w=w?w+"&"+z:z);"GET"==b.type.toUpperCase()?(b.url+=(0<=b.url.indexOf("?")?"&":"?")+w,b.data=null):b.data=w;var D=[];b.resetForm&&D.push(function(){p.resetForm()});b.clearForm&&D.push(function(){p.clearForm(b.includeHidden)});if(!b.dataType&&b.target){var B=b.success||function(){};
D.push(function(e){var c=b.replaceTarget?"replaceWith":"html";a(b.target)[c](e).each(B,arguments)})}else b.success&&D.push(b.success);b.success=function(e,a,c){for(var d=b.context||this,f=0,l=D.length;f<l;f++)D[f].apply(d,[e,a,c||p,p])};if(b.error){var G=b.error;b.error=function(e,a,c){G.apply(b.context||this,[e,a,c,p])}}if(b.complete){var L=b.complete;b.complete=function(e,a){L.apply(b.context||this,[e,a,p])}}z=a("input[type=file]:enabled",this);z=z.filter(function(){return""!=this.value});z=0<z.length;
w="multipart/form-data"==p.attr("enctype")||"multipart/form-data"==p.attr("encoding");y=f&&g;c("fileAPI :"+y);var J;!1!==b.iframe&&(b.iframe||(z||w)&&!y)?b.closeKeepAlive?a.get(b.closeKeepAlive,function(){J=e(x)}):J=e(x):(z||w)&&y?((z=this.data("form-extra-data"))&&(a.isArray(z)?z.every(function(){x.push(this)}):x.push(z)),J=l(x)):J=b.ajax_caller(b);p.removeData("jqxhr").data("jqxhr",J);for(z=0;z<A.length;z++)A[z]=null;this.trigger("form-submit-notify",[this,b]);return this};a.fn.ajaxForm=function(f){f=
f||{};f.delegation=f.delegation&&a.isFunction(a.fn.on);f.ajax_caller=f.ajax_caller||a.ajax_caller||a.ajax;if(!f.delegation&&0===this.length){var l=this.selector,g=this.context;if(!a.isReady&&l)return c("DOM not ready, queuing ajaxForm"),a(function(){a(l,g).ajaxForm(f)}),this;c("terminating; zero elements found by selector"+(a.isReady?"":" (DOM not ready)"));return this}return f.delegation?(a(document).off("submit.form-plugin",this.selector,b).off("click.form-plugin",this.selector,d).on("submit.form-plugin",
this.selector,f,b).on("click.form-plugin",this.selector,f,d),this):this.ajaxFormUnbind().bind("submit.form-plugin",f,b).bind("click.form-plugin",f,d)};a.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};a.fn.formToArray=function(b,c){var d=[];if(0===this.length)return d;var e=this[0],p=b?e.getElementsByTagName("*"):e.elements;if(!p)return d;var l,g,m;var n=0;for(m=p.length;n<m;n++){var x=p[n];if((l=x.name)&&!x.disabled)if(b&&e.clk&&"image"==x.type)e.clk==x&&
(d.push({name:l,value:a(x).val(),type:x.type}),d.push({name:l+".x",value:e.clk_x},{name:l+".y",value:e.clk_y}));else if((g=a.fieldValue(x,!0))&&g.constructor==Array){c&&c.push(x);var z=0;for(x=g.length;z<x;z++)d.push({name:l,value:g[z]})}else if(f&&"file"==x.type)if(c&&c.push(x),g=x.files,g.length)for(z=0;z<g.length;z++)d.push({name:l,value:g[z],type:x.type});else d.push({name:l,value:"",type:x.type});else null!==g&&"undefined"!=typeof g&&(c&&c.push(x),d.push({name:l,value:g,type:x.type,required:x.required}))}!b&&
e.clk&&(b=a(e.clk),c=b[0],(l=c.name)&&!c.disabled&&"image"==c.type&&(d.push({name:l,value:b.val()}),d.push({name:l+".x",value:e.clk_x},{name:l+".y",value:e.clk_y})));return d};a.fn.formSerialize=function(b){return a.param(this.formToArray(b))};a.fn.fieldSerialize=function(b){var c=[];this.each(function(){var d=this.name;if(d){var e=a.fieldValue(this,b);if(e&&e.constructor==Array)for(var f=0,l=e.length;f<l;f++)c.push({name:d,value:e[f]});else null!==e&&"undefined"!=typeof e&&c.push({name:this.name,
value:e})}});return a.param(c)};a.fn.fieldValue=function(b){for(var c=[],d=0,e=this.length;d<e;d++){var f=a.fieldValue(this[d],b);null===f||"undefined"==typeof f||f.constructor==Array&&!f.length||(f.constructor==Array?a.merge(c,f):c.push(f))}return c};a.fieldValue=function(b,c){var d=b.name,e=b.type,f=b.tagName.toLowerCase();void 0===c&&(c=!0);if(c&&(!d||b.disabled||"reset"==e||"button"==e||("checkbox"==e||"radio"==e)&&!b.checked||("submit"==e||"image"==e)&&b.form&&b.form.clk!=b||"select"==f&&-1==
b.selectedIndex))return null;if("select"==f){f=b.selectedIndex;if(0>f)return null;c=[];b=b.options;d=(e="select-one"==e)?f+1:b.length;for(f=e?f:0;f<d;f++){var l=b[f];if(l.selected){var g=l.value;g||(g=l.attributes&&l.attributes.value&&!l.attributes.value.specified?l.text:l.value);if(e)return g;c.push(g)}}return c}return a(b).val()};a.fn.clearForm=function(b){return this.each(function(){a("input,select,textarea",this).clearFields(b)})};a.fn.clearFields=a.fn.clearInputs=function(b){var c=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;
return this.each(function(){var d=a(this),e=this.type,f=this.tagName.toLowerCase();c.test(e)||"textarea"==f?this.value="":"checkbox"==e||"radio"==e?d.prop("checked",!1):"select"==f?this.selectedIndex=-1:"file"==e?/MSIE/.test(navigator.userAgent)?a(this).replaceWith(a(this).clone(!0)):a(this).val(""):b&&(!0===b&&/hidden/.test(e)||"string"==typeof b&&a(this).is(b))&&(this.value="")})};a.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&
!this.reset.nodeType)&&this.reset()})};a.fn.enable=function(a){void 0===a&&(a=!0);return this.each(function(){this.disabled=!a})};a.fn.selected=function(b){void 0===b&&(b=!0);return this.each(function(){var c=this.type;"checkbox"==c||"radio"==c?this.checked=b:"option"==this.tagName.toLowerCase()&&(c=a(this).parent("select"),b&&c[0]&&"select-one"==c[0].type&&c.find("option").selected(!1),this.selected=b)})};a.fn.ajaxSubmit.debug=!1})(jQuery);
var browser={init:function(){this.id=this.searchString(this.dataBrowser)||"An unknown browser";this[this.id]=!0;this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS";this.lang=navigator.userLanguage||navigator.language||navigator.language||"en"},searchString:function(a){for(var b=0;b<a.length;b++){var d=a[b].string,c=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;
if(d){if(-1!=d.indexOf(a[b].subString))return a[b].identity}else if(c)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(-1!=b)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"ie",versionSearch:"Edge"},{string:navigator.userAgent,prop:window.opera,subString:"OPR",identity:"op",versionSearch:"OPR"},{string:navigator.userAgent,subString:"Chrome",versionSearch:"Chrome",identity:"gc"},
{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"ow"},{string:navigator.vendor,subString:"Apple",identity:"sf",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",versionSearch:"iCab",identity:"ic"},{string:navigator.vendor,subString:"KDE",versionSearch:"Konqueror",identity:"kq"},{string:navigator.userAgent,subString:"Firefox",versionSearch:"Firefox",identity:"ff"},{string:navigator.vendor,subString:"Camino",versionSearch:"Camino",identity:"cn"},{string:navigator.userAgent,
subString:"Netscape",versionSearch:"Netscape",identity:"ns"},{string:navigator.userAgent,subString:"MSIE",identity:"ie",versionSearch:"MSIE"},{string:navigator.userAgent,subString:".NET",identity:"ie",versionSearch:"rv"},{string:navigator.userAgent,subString:"Gecko",identity:"mz",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"mz",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",
identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};browser.init();
$(function(){$(document.body).addClass(browser.id);$(document.body).addClass(browser.id+browser.version);browser.key={isDigit:function(a){return 48<=a&&57>=a},BACKSPACE:8,TAB:9,DELETE:46,isArrows:function(a){return 37<=a&&40>=a||96<=a&&105>=a},is:function(a,b){return a.charCodeAt(0)==b},NUM_MINUS:109,MINUS:browser.ff?173:189,NUM_POINT:110,POINT:190,isReturn:function(a){return 10==a||13==a}};browser.event_capture=$("<div></div>")[0].setCapture});var bm={cache:{}};
window.console&&window.console.log||((window.console||(window.console={})).log=function(a){var b=$(".log-container");b.length||(b=$("<div class='log-container'></div>").appendTo(document.body));b.append($("<div class='log-entry'></div>").append(""+a))});window.log=function(){Function.prototype.apply.call(console.log,console,arguments)};console.dir||(console.dir=console.log);window.dir=function(){Function.prototype.apply.call(console.dir,console,arguments)};
function QueueManager(a,b,d){function c(){for(m=null;this.hasFreeSlot()&&g.length;){var a=this.pop();d?(l.inc(),setTimeout(function(){b(a);l.dec()},1)):b(a)}g.length&&(m=setTimeout($.proxy(c,this),1E3))}var f=0,g=[],m,l={push:function(a,b){b?g.unshift(a):g.push(a);this.hasFreeSlot()?d&&c():m||(m=setTimeout($.proxy(c,this),1E3))},pop:function(){return g.shift()},inc:function(){f++},dec:function(){f--},hasFreeSlot:function(){return f<a},index:function(a){var b=null;$.each(g,function(e){if(a.call(this,
e))return b=e,!1});return b},top:function(a){if(g.length>a&&0<=a){var b=g[a];g.splice(a,1);g.unshift(b)}},remove:function(a){$.each(g,function(b){if(a.call(this,b))return g.splice(b,1),!1})},clear:function(){m&&clearTimeout(m);g=[]}};if(this instanceof QueueManager)$.extend(this,l);else return l}bm.ajax_queue_manager=QueueManager(30,function(a){bm.ajax_queue_manager.inc();a=a.settings;var b=$.ajax(a);bm.chainDeffereds(b,a.deferred_interceptor)});function CacheManager(){this.cache={}}
CacheManager.prototype={get:function(a){var b=this.cache[a];if(b)if(b.duration&&Date.now().getTime()-b.time>b.duration)delete this.cache[a];else return b.entry},set:function(a,b,d){this.cache[a]={duration:b,entry:d,time:Date.now().getTime()}}};bm.ajax_cache_manager=new CacheManager;bm.show_response_status=!0;window.on_login_call_queue=[];
$.extend(bm,{_modified_ajax_settings:function(a){function b(){a.deferred_interceptor=$.Deferred();a.deferred_interceptor.done(function(b){if(!window.inline_login_displaying){var c=Array.prototype.slice.call(arguments);c.push(a);"json"==a.dataType&&"error"==b.status?a.consumer_deferred.reject.apply(a.consumer_deferred,c):a.consumer_deferred.resolve.apply(a.consumer_deferred,c)}}).fail(function(){if(!window.inline_login_displaying){var b=Array.prototype.slice.call(arguments),c=b[0].responseText;"json"==
a.dataType&&(c=404==b[0].status?{error:!0,message:$.i18n.prop("expected.resource.not.found"),code:"404"}:200==b[0].status?{error:!0,message:$.i18n.prop("server.response.unrecongnized"),code:"500"}:c?JSON.parse(c):{error:!0,message:$.i18n.prop("error.occurred.in.server"),code:"500"});b[2]=c;b.push(a);a.consumer_deferred.reject.apply(a.consumer_deferred,b)}}).progress(function(){var b=Array.prototype.slice.call(arguments);b.push(a);a.consumer_deferred.notify.apply(a.consumer_deferred,b)})}a=$.extend({traditional:!0,
show_response_status:bm.show_response_status,show_error_status:!0,show_success_status:!0,dataType:"json",type:a.type||(a.data?"post":"get")},a);a.fill&&(a.dataType="html");var d=a.error,c=a.success;a.error=function(c,g){function f(a){try{return JSON.parse(a)}catch(e){return{status:"error",message:a,code:c.status}}}if(310==c.status){if("json"==a.dataType){var l=f(c.responseText);window.location.href=l.url}else window.location.href=c.responseText;throw $.error("Redirect Action Processing");}403==c.status&&
("json"==a.dataType?(l=f(c.responseText),l=l.message):l=c.responseText,bm.notify(l,"error"));l=c.responseText;a.fill&&(!1!==a.loader&&a.fill.loader(!1),app.production||a.fill.html(l),delete a.fill.nat.filling_xhr);if(401==c.status){if("json"==a.dataType&&(l=JSON.parse(l).login_html),a.on_login&&window.on_login_call_queue.push(function(){b();a.on_login()}),!window.inline_login_displaying){g=window.inline_login_displaying=!0;var n={content:l};app.is_front_end&&(app.edit_mode?n={ajax_url:app.baseUrl+
"page/embeddedLogin",title:null}:(g=!1,bm.alert($.i18n.prop("your.session.timed.out"),"time-out",function(){location.href=app.baseUrl+"customer/login?referer="+location.href})));g&&($(l).find("input[name=email]").val(app.login_email).prop("disabled",!0),bm.embeddedLogin(n,function(){window.on_login_call_queue.every(function(){this.call(window)});window.on_login_call_queue=[];window.inline_login_displaying=!1}))}}else"json"==a.dataType?(200==c.status?(l=$.i18n.prop("server.response.unrecongnized"),
l={status:"error",code:"500",message:l}):l=l?f(l):{status:"error",code:"500"},a.response&&a.response.apply(this,["error",l,g,c]),a.show_response_status&&a.show_error_status&&l.message&&bm.notify(l.message,l.status)):a.response&&a.response.apply(this,["error",l,g,c]),d&&d.apply(this,[c,g,l])};a.success=function(b,g,m){a.response&&a.response.apply(this,["json"==a.dataType&&"error"==b.status?"error":"success",b,g,m]);"json"==a.dataType&&a.show_response_status&&b.message&&("error"==b.status&&a.show_error_status||
a.show_success_status)&&bm.notify(b.message,b.status);if("json"==a.dataType&&"error"==b.status)d&&d.apply(this,[m,g,b]);else{if(a.fill){!1!==a.loader&&a.fill.loader(!1);delete a.fill.nat.filling_xhr;a.fill.html(b).updateUi();if(a.processor)if(a.processor.isString){if(a.processor.contains(":")){var f=a.processor.split(":");var n=f[0];var q=f[1]}else q=n=a.processor;bm.onReady(app.processors,q,{ready:function(){app.processors[q](a.fill)},not:function(){bm.loadScript(app.base+"js/app/processors/"+(n||
q)+".js")}})}else $.isFunction(a.processor)&&a.processor(a.fill);bm.handleUrlNavigation(a.url||a.controller+"/"+a.action,a.fill)}c&&c.apply(this,[b,g,m])}};b();return a},addScript:function(a,b){var d=$("head"),c=document.createElement("script");c.setAttribute("type","text/javascript");a.startsWith("http")||a.startsWith("/")||(a=app.baseUrl+a);c.setAttribute("src",a);b&&c.setAttribute("async","");d[0].appendChild(c)},addStyle:function(a){var b=$("head"),d=document.createElement("link");d.setAttribute("rel",
"stylesheet");d.setAttribute("type","text/css");d.setAttribute("href",app.baseUrl+a);b[0].appendChild(d)},ajax:function(a){var b=a.response;a.response=function(){bm.ajax_queue_manager.dec();b&&b.apply(this,arguments)};a=bm._modified_ajax_settings(a);if(a.cache_flag||a.cache_duration){var d=a.cache_flag;d||(d=a.url,a.data&&(d+="?"+$.param(a.data)));if(d=bm.ajax_cache_manager.get(d)){var c=$.Deferred();d.done(function(d,f,e){a.response=b;a.success&&a.success.call(a,d,f);a.complete&&a.complete.call(a,
{status:e.status,responseText:e.responseText},f);c.resolve(d,f)});d.fail(function(d,f){a.response=b;d={status:d.status,responseText:d.responseText};a.error&&a.error.call(a,d,f);a.complete&&a.complete.call(a,d,f);c.reject(d,f)});return c}}if(a.cache_flag||a.cache_duration){var f=$.Deferred();var g=a.cache_duration;d=a.cache_flag;d||(d=a.url,a.data&&(d+="?"+$.param(a.data)));g||(g=400);-1==g&&(g=void 0);bm.ajax_cache_manager.set(d,g,f)}var m=bm.getUUID();bm.ajax_queue_manager.push({id:m,settings:a});
if(!bm.ajax_queue_manager.hasFreeSlot())return d=f||$.Deferred(),a.consumer_deferred=$.extend(d,{aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){bm.ajax_queue_manager.remove(function(){return this.id==m})}}),a.consumer_deferred;d=bm.ajax_queue_manager.pop();bm.ajax_queue_manager.inc();a=d.settings;(browser.ie||browser.ed)&&a.type.toLowerCase().equals("get",!1)&&(a.data?
a.data._=Date.now():a.data={_:Date.now()});a.on_login=function(){l=a.url?$.ajax(a):$.ajax(app.baseUrl+a.controller+"/"+(a.action||"index"),a);bm.chainDeffereds(l,a.deferred_interceptor)};a.consumer_deferred=$.Deferred();a.fill&&a.fill.isString&&(a.fill=$(a.fill));a.beforeAjax&&a.beforeAjax(a);var l=a.url?$.ajax(a):$.ajax(app.baseUrl+a.controller+"/"+(a.action||"index"),a);a.fill&&(a.fill.nat.filling_xhr&&a.fill.nat.filling_xhr.abort(),a.fill.nat.filling_xhr=l,a.fill.one("remove.xhr",function(){l.abort()}),
l.always(function(){a.fill.off("remove.xhr")}),!1!==a.loader&&a.fill.loader());bm.chainDeffereds(l,a.deferred_interceptor);f&&bm.chainDeffereds(a.consumer_deferred,f);l.success=function(b){a.consumer_deferred.done(b);return l};l.error=function(b){a.consumer_deferred.fail(b);return l};l.complete=function(b){a.consumer_deferred.always(b);return l};return $.extend({},l,a.consumer_deferred)},autoType:function(a){return"{}"==a?{}:"[]"==a?[]:/^\[("[^"]+"[^=:]|\d+)/.test(a)||/^({|\[{)"[^"]+":/.test(a)?JSON.parse(a):
/^\s*-?\d+(\.\d*)?\s*$/.test(a)?+a:/^\s*(true|yes|on)\s*$/.test(a)?!0:/^\s*(false|no|off)\s*$/.test(a)?!1:a},baseUrl:window.app&&app.baseUrl||"/",buildQuery:function(a){var b=!0,d="";$.each(a,function(a,f){b?b=!1:d+="&";d+=a+"="+encodeURIComponent(f)});return d},center:function(a,b,d){var c=$(window).height();a=$(window).width()/2-a/2;b=c/2-b/2;d||(d=$(window).scrollTop(),c=$(window).scrollLeft(),a+=c,b+=d);return{left:Math.max(20,a),top:Math.max(20,b)}},chainDeffereds:function(a,b){a.done(b.resolve).fail(b.reject).progress(b.notify)},
collect:function(a,b){var d=[];$.isFunction(b)?$.each(a,function(a,f){d.push(b.call(f,a,f))}):$.each(b,function(){d.push(a[this])});return d},convertMilliToHMS:function(a){var b=Math.floor(a/36E5);a-=36E5*b;var d=Math.floor(a/6E4);return b+"h "+d+"m "+(a-6E4*d)/1E3+"s"},creteCookie:function(a,b,d,c,f){a=a+"="+b+"";d&&(!d instanceof Date&&(d=new Date((new Date).getTime()+864E5*parseInt(d))),a+="expires="+d.gmtString()+"");c&&(a+="path="+c+"");f&&(a+="domain="+f+"");document.cookie=a},download:function(a){var b=
$.find("iframe#dynamic-download-iframe");0==b.length?(b=$('<iframe id="dynamic-download-iframe">'),b.appendTo("body"),b.css({position:"absolute",left:"-10000px",top:"-10000px"}),b.attr("src",a)):$(b).attr("src",a)},dumpInForm:function(a,b){for(var d in b){var c=a.find("[name='"+d+"']"),f=b[d]||[];f=f.isString?[f]:f.clone();var g=$();c.each(function(){var a=this.jqObject;if(a.is(":text")||a.is("textarea"))f.length?a.val(f.shift()):a.val("");else if(a.is("select[multiple]"))a.find("option:selected").prop("selected",
!1),a.find("option").each(function(){f.contains(this.value)&&(this.selected=!0,f.remove(this.value))}),a.select("refresh");else if(a.is("select"))if(f.length)a.select("val",f.shift());else{var b=a.find("option:first").val();a.select("val",b)}else a.is(":radio")?g&&(f.contains(this.value)?(a.prop("checked",!0),g=null,f.remove(this.value)):g=g.add(a)):a.is(":checkbox")&&(f.contains(this.value)?(a.prop("checked",!0),f.remove(this.value)):(a.prop("checked",!1),(a=a.attr("data-uncheck-value"))&&f.contains(a)&&
f.remove(a)))});g&&g.filter("[checked]").prop("checked",!0);f.every(function(){a.append("<input type='hidden'>".jqObject.attr("name",d).val(this))})}},dumpInMemory:function(a){return a.serializeObject()},encodePath:function(a){return a.replace(/%/g,"%25").replace(/ /g,"%20").replace(/#/g,"%23")},embeddedLogin:function(a,b){return new POPUP($.extend({clazz:"login-popup",title:$.i18n.prop("session.timed.out"),show_close:!1,close_on_escape:!1,is_always_up:!0,events:{content_loaded:function(a){var c=
this.find("form");app.login_email&&(c.find("input[name=email]").prop("disabled",!0).val(app.login_email),c.append('<input type="hidden" name="email" value="'+app.login_email+'">'),c.find(".not-admin").html($.i18n.prop("not.x.operator",["<span class='user'>"+app.login_email+"</span>"])));c.form({ajax:{success:function(c){"error"==c.status?bm.notify($.i18n.prop("invalid.email.password"),"alert"):(a.close(),b(c))},error:function(){bm.notify($.i18n.prop("invalid.email.password"),"alert")}}})}}},a))},
equal:function(a,b){var d=function(a,b){var c=!0;$.each(a,function(a,d){c=bm.equal(d,b[a]);if(!c)return!1});return c};return a?$.isFunction(a.equals)?a.equals(b):$.isArray(a)||a instanceof $?$.isArray(b)||b instanceof $?a.length==b.length?d(a,b):!1:!1:$.isPlainObject(a)?$.isPlainObject(b)?d(a,b):!1:a==b:b?!1:!0},fileExtension:function(a){var b=a.lastIndexOf(".");return 0<b?a.substring(b+1):""},filter:function(a,b){var d={};$.each(a,function(a,f){b(a,f)&&(d[a]=f)});return d},filterOwnProperties:function(a){var b=
{};for(key in a)a.hasOwnProperty(key)&&(b[key]=a[key]);return b},getAbsoluteURL:function(a){var b=location.port;return location.host+bm.baseUrl+(b?":"+b:"")+a},getBaseURLProtocol:function(){return location.protocol},getCookie:function(a){a=(new RegExp("(?:^"+a+"|s*"+a+")=(.*?)(?:|$)","g")).exec(document.cookie);return null===a?null:a[1]},getUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16).toUpperCase()})},
handleUrlNavigation:function(a,b){var d;a.startsWith(app.base)&&(a=a.substring(app.base.length));Object.keys(app.routes||{}).revery(function(){if(d=a.match(new RegExp(this)))return c=app.routes[this],!1});if(c)if(c.isString){if(d.shift(),d.every(function(a,b){c=c.replace("{"+a+"}",b)}),app.processors&&$.isFunction(app.processors[c]))app.processors[c](b)}else if($.isFunction(c))c(b);else{d.shift();var c=$.extend({},c);$.each(c,function(a,b){d.every(function(a,c){b=b.replace("{"+(a+1)+"}",c)});c[a]=
b});if(c.controller&&c.action){var f=c.controller.capitalize()+"Controller";if(app.controllers[f]&&app.controllers[f].prototype[c.action])(new app.controllers[f])[c.action](b,c)}}},hash:function(a){var b=function(a){var b=0;$.each(a,function(a,c){b+=bm.hash(a);b+=bm.hash(c)});return b};return!a||$.isFunction(a)?0:$.isFunction(a.hash)?a.hash():$.isArray(a)||$.isPlainObject(a)?b(a):(""+a).hash()},htmlEncode:function(a){return(""+a).htmlEncode()},i18n:function(a,b){return $.i18n.prop(a,b)},intersect:function(a,
b){var d=a.right-a.left+b.right-b.left-(a.right>b.right?a.right:b.right)+(a.left<b.left?a.left:b.left);if(0>=d)return 0;d=d/(b.right-b.left)*100;a=a.bottom-a.top+b.bottom-b.top-(a.bottom>b.bottom?a.bottom:b.bottom)+(a.top<b.top?a.top:b.top);if(0>=a)return 0;a=a/(b.bottom-b.top)*100;return d<a?d:a},isOverAxis:function(a,b,d){return a>=b&&a<=b+d},isString:function(a){return a instanceof String||"string"==typeof a},iterate:function(a,b){var d=[];$.each(a,function(a){d.push(a)});d.iterate(function(c){b.call(a[this],
c,this)})},jquerify:function(a,b,d){d||(d={});var c=a.camelCase(!1);window.jquery_conflict_prefix&&(c=window.jquery_conflict_prefix+c);var f=b.prototype.destroy,g=function(){this.elm.tag("bmui-"+a+"-obj",void 0);this.elm.trigger(a+"-uninitialized")};f=f?f.blend(g):g;b.prototype.destroy=f;$.prototype[c]=function(c){if(!this.length)return"inst"==c?null:"isInitialized"==c?!1:this;if(c&&c.isString){var f=void 0,g=function(){var e=this.tag("bmui-"+a+"-obj");if("inst"==c)return e;if(e){if("isInitialized"==
c)return!0;if("option"==c){if(2==arguments.length)return $.isFunction(e._getOption)?e._getOption(arguments[1]):e.options[arguments[1]];$.isFunction(e._setOption)?e._setOption(arguments[1],arguments[2]):bm.prop(e.options,arguments[1],arguments[2]);return this}"extendObjElement"==c&&arguments[1].tag("bmui-"+a+"-obj",e);"removeObjElement"==c&&arguments[1].tag("bmui-"+a+"-obj",void 0);if(!$.isFunction(e[c])||c.startsWith("_"))throw Error("Undefined function "+c);return e[c].apply(e,Array.prototype.splice.call(arguments,
1))}if("isInitialized"==c)return!1;throw $.error("Function is called prior to initialization");},m=Array.prototype.splice.call(arguments,0);this.each(function(){var e=g.apply(this.jqObject,m);if(void 0!==e)return f=e,!1});return void 0===f?this:f}var e=function(){var e=$.extend({},c,this.config(d.markup_config_key||a)),f=new b(this,e);f.elm=this;f.options||(f.options=e);this.tag("bmui-"+a+"-obj",f);this.trigger(a+"-initialized")};1<this.length&&!d.common_for_multi_element?this.each(function(){e.call($(this))}):
e.call(this);return this};b.prototype.trigger||(b.prototype.trigger=function(){Array.prototype.unshift.call(arguments,a);bm.trigger.apply(this,arguments)})},keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},positionReference:function(a){var b=0,d=a.acss("left"),c=a.acss("right"),f=a.acss("top"),g=a.acss("bottom");"auto"==d?"auto"!=c&&(b=1):"auto"!=c&&(b=2);"auto"==f?"auto"!=g&&(b+=3):"auto"!=
g&&(b+=6);"static"==a.css("position")&&(5<b?b-=6:0==(b+1)%3&&(b-=2));return b},omit:function(a,b,d){var c={},f;for(f in a)b.contains(f)||d&&$.isFunction(c[f])||(c[f]=a[f]);return c},onReady:function(a,b,d,c){"undefined"==typeof c&&(c=10);0<c?"undefined"==typeof a[b]?($.isPlainObject(d)&&d.not&&(d=$.extend({},d),d.not.call(a),d.not=void 0),setTimeout(function(){bm.onReady(a,b,d,--c)},2E3)):($.isPlainObject(d)?d.ready:d).call(a[b]):$.isPlainObject(d)&&d.fail&&d.fail.call(a)},path:function(a){var b=
a.split(/[\\\/]/),d;if(!b.length)return{};b[0].endsWith(":")&&(d=b[0].substring(0,b[0].length-1));var c=b[b.length-1];a=c.indexOf("?");if(-1<a){var f=c.substring(a+1);c=c.substring(0,a)}a=f||c;var g=a.indexOf("#");-1<g&&f&&(f=a.substring(0,g));a=-1<g?a.substring(g+1):null;var m=c.lastIndexOf(".");g=-1<m?c.substring(m+1):null;c=-1<m?c.substring(0,m):c;f=f?bm.query(f):{};var l,n=d||2<b.length&&""==b[0]&&""==b[1];return l={host:n?b[2]:null,protocol:d,full:function(){var a=l.protocol?l.protocol+"://":
"";a+=l.host?(a?"":"//")+l.host+"/":"";var e=b.slice(n?3:0,b.length-1);a=a+(e.length?e.join("/")+"/":"")+l.file_name();e=$.param(l.query);return a+(e?"?"+e:"")+(l.fragmentPart?"#"+l.fragmentPart:"")},name:c,file_name:function(){return this.name+(this.ext?"."+this.ext:"")},ext:g,query:f,fragment:a}},pick:function(a,b){var d={},c;for(c in a)b.contains(c)&&(d[c]=a[c]);return d},prop:function(a,b,d){for(var c=b.split(/\./),f=3==arguments.length,g=0;g<c.length-1;g++){var m=""+c[g];if(!(m in a))if(f)a[m]=
{};else return;a=a[m];if("object"!=typeof a)return}if(void 0==d)return a[c[c.length-1]];a[c[c.length-1]]=d},query:function(a){var b={};a=decodeURIComponent(a);a=a.split("&");$(a).each(function(d){d=a[d].split("=");d[1]=d[1].replace(/\+/g," ");void 0==b[d[0]]?b[d[0]]=d[1]:$.isArray(b[d[0]])?b[d[0]].push(d[1]):b[d[0]]=[b[d[0]],d[1]]});return b},queryParams:function(a){a=(new RegExp("[?&]"+a+"=([^&#]*)")).exec(window.location.href);return null==a?null:a[1]||0},removeAll:function(a,b){var d;for(d in a){var c=
!1;for(var f in b)if(d==f){c=!0;break}c&&delete a[d]}},serializeMix:function(a,b){var d={};$.each(a,function(a,f){"undefined"==typeof b[a]?d[a]=f:$.isArray(f)?d[a]=f.concat(b[a]):$.isArray(b[a])?d[a]=b[a].concat(f):d[a]=[f,b[a]]});$.each(b,function(a,b){"undefined"==typeof d[a]&&(d[a]=b)});return d},saveSiteConfig:function(a,b,d){var c={type:[]};$.each(a,function(a,b){c.type.push(a);$.each(b,function(b,d){c[a+"."+b]=d})});bm.ajax({url:app.baseUrl+"setting/saveConfigurations",data:c,show_response_status:!1,
success:b,error:d})},synchronized:function(a,b){b||(b="skip-if-loaded");if("queue-if-loaded"==b){var d=new QueueManager(1,function(b){a.apply(window,b)},!0);return function(){d.push(arguments)}}if("skip-if-loaded"==b){var c=!1;return function(){if(!c){var b=arguments;c=!0;setTimeout(function(){a.apply(window,b);c=!1},1)}}}return function(){}},template:function(a,b){if(!b)return a;for(var d=b.length,c=0;c<d;c++)a=a.replaceAll("{"+c+"}",b[c]);return a},trigger:function(a,b,d,c,f){if(b instanceof $)return bm.trigger.call(a,
b,d,c,f);var g;$.isArray(c)||(c=[c]);a.isString&&(c=d,d=b,b=a,a=this.elm);$.isFunction(this["on"+d.capitalize()])&&(g=this["on"+d.capitalize()].apply(this,c));if(!1===g)return!1;if(this.options){if(this.options.events?$.isFunction(this.options.events[d])&&(g=this.options.events[d].apply(this,c)):$.isFunction(this.options[d])&&(g=this.options[d].apply(this,c)),!1===g)return!1}else if(this.events&&($.isFunction(this.events[d])&&(g=this.events[d].apply(this,c)),!1===g))return!1;return a.trigger(b+":"+
d,c)},editInlineText:function(a){var b=$.Deferred(),d=a.text().trim(),c=a.parents(".editable").addClass("active");a.html("<input type='text' class='inline-edit-input'><span class='tool-icon reset' tabindex='0'></span>");a.find(".reset").on("mousedown",function(){a.text(d);b.reject();c.removeClass("active")});var f=a.find("input").on("blur keydown.key_return",function(){var f=this,e=a.attr("data-editable-validation"),p=function(){var e=a.attr("data-editable-submit-url");e?bm.ajax({url:e,data:{value:f.value},
show_success_status:!1}).always(function(){c.removeClass("active")}).done(function(){a.text(f.value).trigger("inlinechange");b.resolve(f.value)}).fail(function(){a.text(d);b.reject()}):(a.text(f.value).trigger("inlinechange"),b.resolve(f.value),c.removeClass("active"))};if(e)if(e=ValidationField.validateAs(this.jqObject,e,a.config("editable-validation")),null!=e)if(e.promise)e.done(function(e){null!=e?bm.notify(bm.template(e.msg_template,e.msg_params),"alert"):p()});else if("after"==a.data("showError")){var l=
("<div class='errorlist after'><div class='message-block error-message'>"+bm.template(e.msg_template,e.msg_params)+"</div></div>").jqObject;a.next(".message-block.error-message").length?a.next(".message-block.error-message").replaceWith(l):a.after(l);b.done(function(){l.remove()}).fail(function(){l.remove()})}else bm.notify(bm.template(e.msg_template,e.msg_params),"alert");else p();else p()}).val(d);f.nat.focus();for(var g=a.nat.attributes,m=0;m<g.length;m++){var l=g[m].name,n=g[m].value;l.startsWith("data-editable-validation")&&
f.attr("data"+l.substring(13),n)}return b},editInlinePrice:function(a){var b=$.Deferred(),d=a.text().trim();a.html("<input type='text' class='inline-edit-input'><span class='tool-icon reset' tabindex='0'></span>");a.find(".reset").on("mousedown",function(){a.text($text);b.reject()});var c=a.find("input").on("blur keydown.key_return",function(){var c=this,f=a.attr("data-editable-validation"),e=function(){var e=a.attr("data-editable-submit-url");bm.ajax({url:e,data:{value:c.value},show_success_status:!1}).done(function(){a.text("$"+
c.value).trigger("inlinechange");b.resolve(c.value)}).fail(function(){a.text(d);b.reject()})};f?(f=ValidationField.validateAs(this.jqObject,f,a.config("editable-validation")),null!=f?f.promise?f.done(function(a){null!=a?bm.notify(bm.template(a.msg_template,a.msg_params),"alert"):e()}):bm.notify(bm.template(f.msg_template,f.msg_params),"alert"):e()):e()}).val(d.substring(1));c.nat.focus();for(var f=a.nat.attributes,g=0;g<f.length;g++){var m=f[g].name,l=f[g].value;m.startsWith("data-editable-validation")&&
c.attr("data"+m.substring(13),l)}return b},copy:function(a,b){b=$("<input>");$("body").append(b);b.val(a).select();a=document.execCommand("copy");b.remove();return a}});bm.expando="BM"+bm.getUUID();
$.extend(Function.prototype,{blend:function(a){if(!a)return this;var b=this;return function(){a.isString&&(a=bm.prop(window,a));var d=b.apply(this,arguments);return a.apply(this,arguments)||d}},mixin:function(a){return a?a.override||this.virtual?a:this.override||a.virtual?this:(this.order||0)<=(a.order||0)?this.blend(a):a.blend(this):this},inherit:function(a){var b=[];1<arguments.length&&(b=Array.prototype.slice.call(arguments,1));var d=function(){};d.prototype=a.prototype;var c=this.prototype,f=
this.prototype=new d;$.extend(f,bm.filterOwnProperties(c));if(b.length){var g=f;d=function(){};d.prototype=f;f=this.prototype=new d;b.every(function(a,b){$.each(b.prototype||($.isPlainObject(b)?b:{}),function(a){g[a]=g[a]?g[a].mixin(this):this});return!0});this._super=d.prototype;this._super.constructor=function(){a.apply(this,arguments);var c=this,d=arguments;b.every(function(a,b){"function"==typeof b&&b.apply(c,d)})}}else this._super=a.prototype,this._super.constructor=a;f.constructor=this;return f},
intercept:function(a){if(!a)return this;var b=this;return function(){a.isString&&(a=bm.prop(window,a));var d=a.apply(this,arguments);return b.apply(this,arguments)||d}},later:function(){var a=0;return function(b){var d;1<arguments.length&&(d=Array.prototype.splice.call(arguments,1));clearTimeout(a);a=setTimeout(d?function(){this.apply(null,d)}.bind(this):this,b)}}(),on:function(a){app.event.on(a,this)}});Array.prototype.contains=function(a){return-1<this.indexOf(a)};
$.extend(Array.prototype,{all:function(){for(h in this)if(!this[h])return!1;return!0},any:function(a){var b=this.length;if(a)if(a instanceof Function)for(c=0;c<b;c++){if(a(this[c]))return!0}else{var d=function(){return eval(a)};for(c=0;c<b;c++)if(d.call(this[c]))return!0}else for(var c=0;c<b;c++)if(this[c])return!0;return!1},collect:function(a){var b=[];$.isFunction(a)?$.each(this,function(){b.push(a.call(this))}):$.each(this,function(){b.push(this[a])});return b},clone:function(){return this.slice(0)},
count:function(a){var b=0;$.isFunction(a)?this.every(function(d,c){(function(){!0===a.apply(c)&&b++}).apply(c,Array.prototype.splice.call(arguments,1))}):this.every(function(d,c){(function(){!0===eval(a)&&b++}).apply(c,Array.prototype.splice.call(arguments,1))});return b},distinct:function(){for(var a=[],b=0;b<this.length;b++){var d=this[b];-1===$.inArray(d,a)&&a.push(d)}return a},every:function(a){var b=this;$.each(this,function(d,c){return!1!==a.call(c,d,c,b)})},exJoin:function(a){a=a||",";var b=
"";this.every(function(d,c){b+=(0<d?a:"")+(-1<c.indexOf(a)||"("==c.charAt(0)?"("+c+")":c)});return b},native_filter:Array.prototype.filter,filter:function(a){if($.isFunction(a))return this.native_filter.apply(this,arguments);var b=[];this.every(function(){!0===eval(a)&&b.push(this)});return b},native_find:Array.prototype.find,find:function(a){var b=void 0;if($.isFunction(a))return this.native_find.apply(this,arguments);this.every(function(d,c){if(!0===eval(a))return b=this,!1});return b},native_indexOf:Array.prototype.indexOf,
intersect:function(a){if(!a)return this;for(var b=[],d=this.distinct(),c=0;c<d.length;c++){for(var f=d[c],g=!0,m=0;m<arguments.length;m++){var l=arguments[m];if(0==l.length)return[];if(-1===$.inArray(f,l)){g=!1;break}}g&&b.push(f)}return b},iterate:function(a){var b=0,d=this,c=function(){b!=d.length&&a.call(d[b],{next:function(){b++;setTimeout(c,1)}},b)};c()},last:function(){return this[this.length-1]},minus:function(a){return this.filter(function(b){return 0>a.indexOf(b)})},pushAll:function(a){this.push.apply(this,
a)},remove:function(a){a=this.indexOf(a);-1<a&&this.splice(a,1)},removeAll:function(a){var b=this;this.filter(a).every(function(a,c){b.remove(c);return!0});return this},revery:function(a,b){for(var d=this.length-1,c=d;0<=c&&!1!==a.call(b||this[c],this[c],d-c,c,this);c--);},sum:function(a){var b=this.length,d=0;a.isString&&(a=new Function("return "+a));for(var c=0;c<b;c++)d+=a.call(this[c],c);return d}});for(var k in Array.prototype)$.prototype[k]||($.prototype[k]=Array.prototype[k]);
var string_org_index_of=String.prototype.indexOf,string_org_last_index_of=String.prototype.lastIndexOf;
$.extend(String.prototype,{array:function(){return"[]"==this?[]:JSON.parse(this)},bool:function(){return!/^\s*(false|no|off|0|inactive|negative|-(\d*\.)?\d+)\s*$/i.test(this)},byteCount:function(){for(var a=0,b=0;b<this.length;b++){var d=this.charCodeAt(b);128>d?(a+=1,10==d&&(a+=1)):a=2048>d?a+2:65536>d?a+3:2097152>d?a+4:67108864>d?a+5:a+6}return a},camelCase:function(a){var b=new StringWriter,d=this.reader();void 0===a&&(a=!0);for(var c=a;-1!=(a=d.read());)"`"<a&&"{">a||"@"<a&&"[">a||"/"<a&&":">
a?c?(b.plus(a.toUpperCase()),c=!1):b.plus(a):c=!0;return b.toString()},capitalize:function(){return 0==this.length?"":this[0].toUpperCase()+this.substring(1)},contains:function(a){return-1<this.indexOf(a)},dotCase:function(){for(var a=new StringWriter,b=this.reader(),d;-1!=(d=b.read());)"@"<d&&"[">d?(a.plus("."),a.plus(d.toLowerCase())):a.plus(d);return a.toString()},equals:function(a,b){1==arguments.length&&(b=!0);var d=b?this+"":this.toLowerCase(),c=b?a+"":a.toLowerCase();return d==c},exSplit:function(a){a=
a||",";var b=[],d=0,c=!1,f=0;b[0]="";for(var g=0;g<this.length;g++){var m=this.charAt(g);c||m!=a?"("!=m||f?")"!=m||!c||g+1!=this.length&&this.charAt(g+1)!=a?(f++,b[d]+=m):c=!1:c=!0:(b[++d]="",f=0)}return b},hash:function(){var a=0;if(0==this.length)return a;var b;for(b=0;b<this.length;b++){var d=this.charCodeAt(b);a=(a<<5)-a+d;a&=a}return a},htmlEncode:function(){return this.replace(/&/g,"&amp").replace(/</g,"&lt").replace(/>/g,"&gt").replace(/"/g,"&quot").replace(/'/g,"&#39").replace(/\r\n/g,"<br>").replace(/\n/g,
"<br>").replace(/  /g," &nbsp")},indexOf:function(a,b){return a instanceof RegExp?this.substr(b||0).search(a)+(b||0):string_org_index_of.apply(this,arguments)},int:function(a){return/^\s*\d+(.\d*)?\s*$/.test(a)?+a:parseInt(a)||0},lastIndexOf:function(a,b){if(a instanceof RegExp){b=(b||this.length-1)-(this.length-1);var d=this.reverse().indexOf(a,b);return-1==d?-1:d+this.length-1}return string_org_last_index_of.apply(this,arguments)},minusCase:function(){for(var a=new StringWriter,b=this.reader(),
d;-1!=(d=b.read());)"@"<d&&"[">d?(a.plus("-"),a.plus(d.toLowerCase())):a.plus(d);return a.toString()},reader:function(a){var b=0,d=this;return{read:function(){var c=d.charAt(b++);if(!c){if(a)throw"EOF";return-1}return c}}},replaceAll:function(a,b,d){return d?this.replace(new RegExp(a,"g"),b):this.split(a).join(b)},reverse:function(){return this.split("").reverse().join("")},sanitize:function(){return this.trim().toLowerCase().replace(/\s/g,"-").replace(/[^a-z0-9-\._]+/g,"-")},textify:function(){return this.replace(/<[^>]*>/g,
"")},toNumber:function(){return parseFloat(this)},upto:function(a){return this.substring(0,this.indexOf(a))},pxToVal:function(){var a=this.split("px")[0];return(a=parseFloat(a))?a:0}});var $_height=$.prototype.height,$_width=$.prototype.width,$_text=$.prototype.text,$_show=$.prototype.show,$_hide=$.prototype.hide;
$.extend($.prototype,{acss:function(a){try{return this.chide()[0].ownerDocument.defaultView.getComputedStyle(this[0])[a]}finally{this.cshow()}},addAttrProp:function(a,b,d){if(2>arguments.length||!this.is("["+a+"]"))return this;if(2<arguments.length)return this.removeAttrProp(a,b).addAttrProp(a,d);var c=this.attr(a);if(c.toLowerCase().contains(b.toLowerCase()))return this;this.attr(a,(c+" "+b).trim());return this},autoLoadDrop:function(a,b){var d=this.data("autoLoadDrop");if(d)return d;var c=$([]);
this.each(function(){c=bm.autoLoadDrop(this.jqObject,a,b)});return c},bottomRib:function(a,b,d){return this.dirRib("bottom",a,b,d)},changeTag:function(a){a=$("<"+a+">");var b={};$.each(this.get(0).attributes,function(a,d){b[d.name]=d.value});a.attr(b);a.data(this.data());var d=this.children().clone(!0,!0);a.append(d);this.replaceWith(a);return a},chide:function(){return this.each(function(){var a=this.style?this.style.display:void 0;$(this).data("display-cache",a).css({display:"none"})})},cleanWhitespace:function(){this.contents().filter(function(){if(3!=
this.nodeType)return $(this).cleanWhitespace(),!1;this.textContent=$.trim(this.textContent);return!/\S/.test(this.nodeValue)}).remove();return this},clearCache:function(a){if(!this.is("img"))throw $.error("This function is only applicable for img tag");var b=this.attr("src"),d=this,c=$("<iframe style='position: absolute left: -20000px top: -20000px'></iframe>");c.appendTo(document.body);c.one("load",function(){c.one("load",function(){c.remove();d.attr("src",b);a&&a()})[0].contentWindow.location.reload()}).attr("src",
b).bind("error",function(){c.remove()})},_closestCache:$.prototype.closest,closest:function(a){if($.isFunction(a)){var b=this;do if(a.call(b[0]))return b;while(0!=(b=b.parent()).length);return null}return this._closestCache.apply(this,arguments)},collect:function(a){return Array.prototype.collect.call(this,a)},config:function(a,b){if(this.length){var d="attr-parsed-cache#"+a,c=this.tag(d);if(!c){c={};this.tag(d,c);var f=a.length+1;$.each(this.nat.attributes,function(){this.name.startsWith(a+"-")&&
(c[this.name.substring(f).toLowerCase()]=bm.autoType(this.value))})}if(b){if("string"==typeof b)return c[b.toLowerCase()];var g=this;$.each(b,function(b,d){b=b.toLowerCase();c[b]=d;g.attr(a+"-"+b,d)});return this}return c}},copyDeepEvents:function(a,b){function d(a,f){var c=f.children();a=a.children();c.length==a.length&&a.each(function(a){$(this).copyEvents(c.eq(a),b);d($(this),c.eq(a))})}this.copyEvents(a,b);d(this,a)},copyEvents:function(a,b){var d=this,c=this[0][$_priv_data.expando];c&&(c=c.events)&&
$.each(c,function(c,g){$.each(g,function(){var f=this,l=c;this.namespace&&(l=c+"."+this.namespace);var g=b?function(){f.selector?f.handler.apply(d.find(f.selector),arguments):f.handler.apply(d,arguments)}:this.handler;if(this.selector)a.on(l,this.selector,g);else a.on(l,g)})})},cshow:function(){return this.each(function(){var a=$(this).data("display-cache");this.style.display=a;$(this).removeData("display-cache")})},cssCodeEditor:function(){return CodeMirror.fromTextArea(this[0],{lineNumbers:!0,extraKeys:{"Ctrl-Space":"autocomplete"},
mode:"css",theme:"eclipse",highlightSelectionMatches:{showToken:/\w/},showCursorWhenSelecting:!0,matchBrackets:!0,autoCloseBrackets:!0})},decimal:function(){return this.each(function(){var a=$(this);a.bind("keydown.restrict",function(b){var d=b.keyCode;return b.shiftKey?browser.key.isArrows(d):d==browser.key.POINT||d==browser.key.NUM_POINT?-1==a.val().indexOf("."):d==browser.key.BACKSPACE||d==browser.key.TAB||d==browser.key.DELETE||browser.key.isArrows(d)||browser.key.isDigit(d)||b.ctrlKey&&(browser.key.is("a",
d)||browser.key.is("A",d)||browser.key.is("c",d)||browser.key.is("v",d)||browser.key.is("x",d)||browser.key.is("C",d)||browser.key.is("V",d)||browser.key.is("X",d))}).on("paste",function(){var a=this,d=this.value;setTimeout(function(){isNaN(a.value)&&(a.value=d)},0)})})},dirRib:function(a,b,d,c){var f=[];void 0===c&&(c=!0);void 0===d&&(d=!0);void 0===b&&(b=!0);c&&f.push("padding");d&&f.push("border");b&&f.push("margin");var g=this;return f.sum(function(){var b=g.css(this+"-"+a+("border"==this?"-width":
""));try{var c=parseInt(b,10);var d=isNaN(c)?0:c}catch(q){d=0}return d})},dropify:function(a,b){var d=window.dropify_instance_count?++window.dropify_instance_count:window.dropify_instance_count=1;if(!this.length)return this;b=b||{};var c=this,f=this.isParentOf(a),g=function(){if(!a.is(":visible")){b.no_position&&b.animation||c.add(a).addClass("bmui-state-visible");var f=function(){c.triggerHandler("dropify:expanded",[a])};if($.isFunction(b.position))b.position();else if(!b.no_position)a.position({my:b.my||
"right top-1",at:b.at||"right bottom",of:b.position_of||c,collision:b.position_collision||"flip",within:b.position_within}),a.offset().top<c.offset().top?a.add(c).addClass("dropped-up"):a.add(c).addClass("dropped-down");else if(b.animation)switch(b.animation){case "slideright":a.toggle("slide",{direction:"left"},void 0,function(){c.add(a).addClass("bmui-state-visible");f()})}if(!1!==b.auto_hide)$(document).one("mousedown.dropify_"+d,function(b){if(a.add(c).isParentOf(b.target)||a.add(c).is(b.target))$(document).one("mousedown.dropify_"+
d,arguments.callee);else if(0==m())$(document).one("mousedown.dropify_"+d,arguments.callee)});b.no_position&&b.animation||f()}},m=function(d){if(!a.is(":hidden")){var f=!0;a[0].dropify_hide_intercept&&(f=a[0].dropify_hide_intercept(d));if(!1!==f)if(d=function(){if(0==c.triggerHandler("dropify:beforeCollapsed",[a]))return!1;a.add(c).removeClass("dropped-down dropped-up bmui-state-visible");b.remove_on_hide&&a.remove();c.triggerHandler("dropify:collapsed",[a])},b.animation)switch(b.animation){case "slideright":a.toggle("slide",
{direction:"left"},void 0,d)}else return d()}};if(!b.keep_on_click)a.off(".dropify_"+d).on("click.dropify_"+d,function(a){m(a.target.jqObject)});b.drop_instant?g():(this.click(function(b){f&&a.isParentOf(b.target)||this.jqObject.is(".disabled")||(a.is(".bmui-state-visible")?(m(),$(document).off("mousedown.dropify_"+d)):g())}),m());f&&void 0==b.no_position&&(b.no_position=!0);a.find(".close-dropbox").on("click.dropify_"+d,function(){m()});a[0].dropify_hide_function=m;a[0].dropify_show_function=g;return this},
editable:function(){var a="<span class='tool-icon edit inline-edit'></span>".jqObject;this.each(function(){var b=this.jqObject;b.hover(function(){this.edit_off||b.append(a)},function(){this.edit_off||a.detach()})});a.on("click",function(){var b=this.jqObject.closest(".inline-editable"),d=b.attr("data-editable-type")||"text";a.detach();b.nat.edit_off=!0;b.addClass("editting");bm["editInline"+d.capitalize()](b).always(function(){b.nat.edit_off=!1;b.removeClass("editting")})});return this},fill:function(a){return bm.ajax($.extend(a,
{fill:this}))},flash:function(a){function b(a){this.opacity=0;this.el=a}b.prototype.start=function(){var a=this;this.interval=setInterval(function(){a.el.animate({opacity:a.opacity},600);a.opacity=a.opacity?0:1},600);this.isFlashing=!0};b.prototype.stop=function(){this.isFlashing&&(this.opacity=1,clearInterval(this.interval),this.el.animate({opacity:1},600),this.isFlashing=!1)};var d=this.data("flash-inst");d||(d=new b(this),this.on("click.flash",function(){d.isFlashing&&d.stop()}),this.on("remove",
function(){d.stop()}),this.data("flash-inst",d));d.isFlashing||d.start()},free:function(){return this.each(function(){var a=$(this);a.is("input")&&a.unbind("keydown.restrict")})},hasAttr:function(a){if(bm.isString(a))return this.is("["+a+"]");var b=!1;$.each(this.nat.attributes,function(){b=a.test(this.name);return!b});return b},hasparent:function(a){return this.parent().is(a)},height:function(a,b,d){if(2>arguments.length||!b&&!d)return $_height.apply(this,arguments);var c=this.outerHeight(d||!1)-
this.height();return $_height.call(this,a-c)},hide:function(){$(this).find("*").each(function(){$(this).triggerHandler("hide")});return $_hide.apply(this,arguments)},htmlCodeEditor:function(){return CodeMirror.fromTextArea(this[0],{lineNumbers:!0,extraKeys:{"Ctrl-Space":"autocomplete"},mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},theme:"eclipse"})},ichange:function(a,b){return this.on("ichange",
a,b)},intercept:function(a,b){return this.on("before_"+a,b)},isBound:function(a,b){var d=this[0][$_priv_data.expando];if(!d)return!1;d=d.events;var c,f=!1;d&&(c=d[a])&&$.each(c,function(){b&&this.namespace!=b||(f=!0);return!f});return f},isChildOf:function(a){return 0<this.parents(a).length},isSelfOrChildOf:function(a){return 0<this.closest(a).length},isParentOf:function(a){return 0<this.find(a).length},leafs:function(){return this.find("*").filter(function(){return 0==$(this).children().length})},
leftRib:function(a,b,d){return this.dirRib("left",a,b,d)},linkify:function(){return this.each(function(){var a=$(this),b=a.attr("data-fill-target");if((b=b?$(b):a.attr("data-target"))||"#workspace".jqObject.length)var d=a.attr("data-processor"),c=app.base+a.click(function(){bm.jsNavigate(c,b,d,a)}).attr("data-url")})},loader:function(a){this.nat.mask_loadtimer&&clearTimeout(this.nat.mask_loadtimer);if(!1===a)bm.unmask(this);else{var b='<div><span class="loader"></span></div>'.jqObject;"string"==typeof a&&
b.addClass(a);this.nat.mask_loadtimer=setTimeout(function(){bm.mask(this,b)}.bind(this),300)}return this},mask:function(a){bm.mask(this,a?a:"<div></div>")},numeric:function(){return this.each(function(){$(this).bind("keydown.restrict",function(a){var b=a.keyCode;return a.shiftKey?browser.key.isArrows(b):b==browser.key.BACKSPACE||b==browser.key.TAB||b==browser.key.DELETE||browser.key.isArrows(b)||browser.key.isDigit(b)||a.ctrlKey&&(browser.key.is("a",b)||browser.key.is("A",b)||browser.key.is("c",b)||
browser.key.is("v",b)||browser.key.is("x",b)||browser.key.is("C",b)||browser.key.is("V",b)||browser.key.is("X",b))}).on("paste",function(){var a=this,b=this.value;setTimeout(function(){var d=a.value;if(isNaN(d)||d.contains(".")||0>d)a.value=b},0)})})},obj:function(a){var b=this.data();if(!b)return null;if("string"==typeof a)return b[a];$.isFunction(a)||(a=null);var d=null;$.each(b,function(b){if(a)return this instanceof a?(d=this,!1):!0;if(b.endsWith("Inst")||b.startsWith("wcui"))return d=this,!1});
return d},outer:function(){return this[0].outerHTML},overflowParent:function(a){var b=this[0].ownerDocument;this.parents().each(function(){var d=this.jqObject;if((!a||"x"==a)&&/hidden|auto|scroll/.test(d.css("overflow-x"))||(!a||"y"==a)&&/hidden|auto|scroll/.test(d.css("overflow-y")))return b=d,!1});return b},pairuncheck:function(){this.after(function(){var a=$(this),b=$("<input style='display: none' class='single' type='checkbox' name='"+a.attr("name")+"' value='"+a.attr("uncheck-value")+"'>");a.bind("change.form",
function(){b[0].checked=this.checked?!1:!0});a.triggerHandler("change.form");return b})},positionFromBody:function(){for(var a=this.get(0),b=0,d=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,d+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;return{top:d,left:b}},pposition:function(a,b){var d=this.position();if("left"==a||"top"==a)return d[a];var c=$(this[0].offsetParent);a&&"right"!=a||(d.right=c.innerWidth()-d.left-this.outerWidth(!0));a&&"bottom"!=
a||(d.bottom=c.innerHeight()-d.top-this.outerHeight(!0));if(!a&&b||"width"==a||"height"==a)a?d[a]=this["outer"+a.capitalize()](!0):(d.width=this.outerWidth(!0),d.height=this.outerHeight(!0));return a?d[a]:d},rect:function(a,b){var d=$.extend({},this.nat.getBoundingClientRect()),c=this[0].ownerDocument,f=$(/webkit/i.test(navigator.userAgent)||"BackCompat"==c.compatMode?c.body:c.documentElement);c=f.scrollTop();f=f.scrollLeft();d.top+=c;d.left+=f;d.bottom+=c;d.right+=f;if(0==arguments.length)return d;
if(a instanceof Boolean||"boolean"==typeof a)b=a,a=void 0;a instanceof $&&(c=a.offset(),c.left*=-1,c.left-=a.leftRib(!1,!0,!1),c.top*=-1,c.top-=a.topRib(!1,!0,!1),a=c);a&&(d.left+=a.left,d.top+=a.top,d.right+=a.left,d.bottom+=a.top);if(b){c=parseInt(this.css("margin-left"));f=parseInt(this.css("margin-right"));var g=parseInt(this.css("margin-top")),m=parseInt(this.css("margin-bottom"));d.left-=c;d.top-=g;d.right+=f;d.bottom+=m;d.width+=c+f;d.height+=g+m}return d},replaceClass:function(a,b){return this.removeClass(a).addClass(b)},
removeAttrProp:function(a,b){if(2>arguments.length||!this.is("["+a+"]"))return this;var d=this.attr(a);this.attr(a,d.replaceAll(b,function(a,b,d){var c=b?d.substring(0,b):"";b=d.substring(b+a.length,d.length);return c.contains("[")&&b.contains("]")?a:""}).trim());return this},reset:function(){this.each(function(){var a=$(this);if(a.is(":input")){var b=this.nextSibling,d=a.parent(),c=$("<form></form>");c.append(a);c[0].reset();b?$(b).before(a):d.append(a)}else a.nat.reset&&a.nat.reset()})},rightRib:function(a,
b,d){return this.dirRib("right",a,b,d)},scrollHere:function(a){a?a.nat instanceof Document&&(a=bm.getTopScroller(a.nat)):(a=this.closest(".scrollable"),a.length||(a=bm.getTopScroller(this[0].ownerDocument)));if(!this.is(":hidden")){var b=a.height(),d=a.width(),c=a.offset(),f=this.offset(),g=f.top-c.top-b;0<g?a.animate({scrollTop:"+="+(g+Math.min(b/3,150))+"px"},800):(g=c.top-f.top,0<g&&a.animate({scrollTop:"-="+(g+Math.min(b/3,150))+"px"},800));b=f.left-c.left-d;0<b?a.animate({scrollLeft:"+="+(b+
Math.min(d/3,150))+"px"},800):(c=c.left-f.left,0<c&&a.animate({scrollLeft:"-="+(c+Math.min(d/3,150))+"px"},800));return this}},serializeObject:function(){var a={},b=(this.is("form")?this:this.find(":input")).serializeArray();$.each(b,function(){void 0!==a[this.name]?($.isArray(a[this.name])||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""});return a},show:function(){var a=function(){$(this).find("*").each(function(){$(this).triggerHandler("show")});b&&
b.apply(this,arguments)};if(1==arguments.length&&$.isPlainObject(arguments[0])){var b=arguments[0].complete;arguments[0].complete=a}var d=-1;$.each(arguments,function(a){"function"==typeof this&&(b=this,d=a)});-1<d&&(arguments[d]=a);$_show.apply(this,arguments);b||a.call(this[0]);return this},signed_decimal:function(){return this.each(function(){var a=$(this);a.bind("keydown.restrict",function(b){var d=b.keyCode;return b.shiftKey?browser.key.isArrows(d):d==browser.key.MINUS||d==browser.key.NUM_MINUS?
("-"!=a.val().charAt(0)&&a.val("-"+a.val()),!1):d==browser.key.POINT||d==browser.key.NUM_POINT?-1==a.val().indexOf("."):d==browser.key.BACKSPACE||d==browser.key.TAB||d==browser.key.DELETE||browser.key.isArrows(d)||browser.key.isDigit(d)||b.ctrlKey&&(browser.key.is("a",d)||browser.key.is("A",d)||browser.key.is("c",d)||browser.key.is("v",d)||browser.key.is("x",d)||browser.key.is("C",d)||browser.key.is("V",d)||browser.key.is("X",d))}).on("paste",function(){var a=this,d=this.value;setTimeout(function(){isNaN(a.value)&&
(a.value=d)},0)})})},signed_numeric:function(){return this.each(function(){var a=$(this);a.bind("keydown.restrict",function(b){var d=b.keyCode;return b.shiftKey?browser.key.isArrows(d):d==browser.key.MINUS||d==browser.key.NUM_MINUS?("-"!=a.val().charAt(0)&&a.val("-"+a.val()),!1):d==browser.key.BACKSPACE||d==browser.key.TAB||d==browser.key.DELETE||browser.key.isArrows(d)||browser.key.isDigit(d)||b.ctrlKey&&(browser.key.is("a",d)||browser.key.is("A",d)||browser.key.is("c",d)||browser.key.is("v",d)||
browser.key.is("x",d)||browser.key.is("C",d)||browser.key.is("V",d)||browser.key.is("X",d))}).on("paste",function(){var a=this,d=this.value;setTimeout(function(){var b=a.value;if(isNaN(b)||b.contains("."))a.value=d},0)})})},sortablecolumn:function(a){function b(b,c){var d=b.index();b=b.closest("table");var f=b.find("tr").not(":first");f.sort(function(b,f){b=$("td:eq("+d+")",b).text().trim().toUpperCase();f=$("td:eq("+d+")",f).text().trim().toUpperCase();if(b==f)return 0;if(""==b){if("always-below"==
a.empty)return 1;if("always-above"==a.empty)return-1}if(""==f){if("always-below"==a.empty)return-1;if("always-above"==a.empty)return 1}return"up"==c&&b>f||"down"==c&&b<f?1:-1});b.append(f.remove())}var d={resetSortState:function(){return this.removeAttr("sort-dir").removeClass("sort-down").removeClass("sort-up")}};if("string"==typeof a)return d[a].call(this);$.extend(a,{empty:"always-below"});d=$(this);d.addClass("sortable").click(function(){var a=$(this),c=a.attr("sort-dir")||"down";"down"==c?(a.attr("sort-dir",
c="up"),a.addClass("sort-up").removeClass("sort-down")):(a.attr("sort-dir",c="down"),a.addClass("sort-down").removeClass("sort-up"));b(a,c);a.closest("table").trigger("sort");a.closest("table").trigger("change")});var c=d.closest("table");c.bind("row-update",function(){var a=$(this).find("th.sortable");a.each(function(){var a=$(this),c=a.attr("sort-dir");c&&b(a,c)});a.trigger("sort");c.trigger("change")});return this},store:function(a,b){return 2==arguments.length?(this.each(function(){this[a]=b}),
this):this.length?this[0][a]:null},swap:function(a){var b=this.parent(),d=this.index(),c=a.parent(),f=a.index();b[0]==c[0]?d<f?(this.before(a),a=c.find(">*:eq("+f+")"),a[0]!=this[0]&&(a.length?a.after(this):c.append(this))):(this.after(a),a=c.find(">*:eq("+f+")"),a[0]!=this[0]&&(a.length?a.before(this):c.append(this))):(this.before(a),a=c.find(">*:eq("+f+")"),a.length?a.before(this):c.append(this))},tag:function(a,b){var d=this.nat;if(a&&!d)return null;var c={remove:function(a){if(d[bm.expando]){var b=
d[bm.expando][a];delete d[bm.expando][a];return b}},get:function(a){return d[bm.expando]&&d[bm.expando][a]},set:function(a){d[bm.expando]||(d[bm.expando]={});var c=d[bm.expando][a];d[bm.expando][a]=b;return c},iterate:function(a){var b=d[bm.expando];b&&$.each(b,a)}};return a?1==arguments.length?c.get(a):void 0===b?c.remove(a):c.set(a):c},text:function(a){return"string"!=typeof a||-1==a.indexOf("\n")&&-1==a.indexOf("  ")?$_text.apply(this,arguments):(a=a.htmlEncode(),this.each(function(){this.innerHTML=
a}))},tip:function(a){a||(a={});this.mouseenter(function(b){$.global_tip_mouseevent_reference=b;b=$(this);var d=$.extend({},a);d.text=d.text||b.attr("tip-text")||b.attr("title");b.removeAttr("title");b.trigger("tip-show",[d]);$.global_tip_timer_reference=setTimeout(function(){$.global_tip_inst_reference&&$.global_tip_inst_reference.close();$.global_tip_timer_reference=null;$.global_tip_inst_reference=new POPUP({content:d.text,template:"<div><div class='content'></div></div>",clazz:"tip-popup",modal:!1,
is_always_up:!0,auto_active:!1,auto_active_on_focus:!1,ui_position:{my:"left bottom",at:"right top",of:$.global_tip_mouseevent_reference}});"function"===typeof a.render&&a.render($.global_tip_inst_reference.content)},d.delay||350)}).mouseleave(function(b){var d=$.global_tip_inst_reference;if(d&&a.sustain_on_hover){var c=d.getDom(),f=c.offset();f.right=f.left+c.outerWidth();f.bottom=f.top+c.outerHeight();if(b.pageX>f.left&&b.pageX<f.right&&b.pageY>f.top&&b.pageY<f.bottom){d.getDom().mouseleave(function(){d.close();
$.global_tip_inst_reference=null});return}}$.global_tip_timer_reference&&(clearTimeout($.global_tip_timer_reference),$.global_tip_timer_reference=null);d&&(d.close(),$.global_tip_inst_reference=null)}).mousemove(function(a){$.global_tip_mouseevent_reference=a});return this},_toggleClassCache:$.prototype.toggleClass,toggleClass:function(a,b){return 2==arguments.length&&b.isString?(this.hasClass(a)?this.removeClass(a).addClass(b):this.removeClass(b).addClass(a),this):this._toggleClassCache(a,b)},topRib:function(a,
b,d){return this.dirRib("top",a,b,d)},triggerWithPropagation:function(a,b){this.each(function(){var d=$.Event(a);d.target=this;for(var c=$(this).parents().addBack(),f=c.length-1;0<=f;f--)if(!1===c.eq(f).triggerHandler(d,b))return!1})},unmask:function(){this.removeClass("updating");this.find(".div-mask").detach()},unwrapInner:function(){var a=this.children().first(),b=a.contents();this.prepend(b);a.remove();return this},width:function(a,b,d){if(2>arguments.length||!b&&!d)return $_width.apply(this,
arguments);var c=this.outerWidth(d||!1)-this.width();return $_width.call(this,a-c)},xshow:function(){return this.each(function(){this.style.display=""})}});Object.defineProperty($.prototype,"nat",{get:function(){return this.length?this[0]:null}});bm.domnode_parent_remove_handler=[];bm.domnode_self_remove_handler=[];
$(document).on("DOMNodeRemoved",function(a){var b=a.target,d=b.remove_key_hash||(b.remove_key_hash=bm.getUUID());if(bm.domnode_self_remove_handler[d]){var c=bm.domnode_self_remove_handler[d];delete bm.domnode_self_remove_handler[d];c.every(function(c,d){b==d.element&&d.handler.call(b,a);return!0})}bm.domnode_parent_remove_handler.every(function(c,d){$(b).find(d.element).length&&(d.selector?$(d.element).find(d.selector).each(function(){d.handler.call(this,a)}):d.handler.call(d.element,a));return!0})});
bm.jquery_data_clean_handler=[];var original_clean=$.cleanData;$.cleanData=function(a,b){a instanceof Array||(a=$.makeArray(a));a.every(function(a,b){return b.cleaning_data=!0});bm.jquery_data_clean_handler.every(function(b,c){a.contains(c.element)&&(c.selector?$(c.element).find(c.selector).each(function(){c.handler.call(this,$.Event("jqclean"))}):c.handler.call(c.element,$.Event("jqclean")))});original_clean.apply(this,arguments,b);a.every(function(a,b){delete b.cleaning_data;return!0})};
$.extend($.event.special,{ichange:{add:function(a){var b=a.selector?a.selector.split(","):["no-selector"],d=a.data||400,c=$(this),f=a.namespace?a.namespace.split("."):["no-namespace"],g;$.each(b,function(a,b){function l(){var e=b?c.find(b):c,a=e.val();if(a!=p){var d=p;p=a;setTimeout(function(){b?c.triggerHandler({type:"ichange",target:e[0]},[a,d]):c.triggerHandler("ichange",[a,d])},5)}}function m(){e&&clearInterval(e);e=setInterval(l,d)}b=b.trim();var e,p,t=c.data("ichange-bound");if(!t)t={},t[b]=
f,c.data("ichange-bound",t);else if(null!=t[b]){$.each(f,function(){t[b].push(this)});return}"no-selector"==b&&(b=null);a=function(){p=this.value;g=this;m()};var w=function(){e&&clearInterval(e);l()},y=function(e,a,d){this!=g&&(b?c.triggerHandler({type:"ichange",target:this},[this.value,d]):c.triggerHandler("ichange",[this.value,d]))};b?(c.on("focus.ichange-event",b,a),c.on("blur.ichange-event",b,w),c.on("keydown.ichange-event",b,m),c.on("change.ichange-event",b,y)):(c.on("focus.ichange-event",a),
c.on("blur.ichange-event",w),c.on("keydown.ichange-event",m),c.on("change.ichange-event",y),c.each(function(){this.isilent=function(e){this==g&&(p=e);this.value=e;return $(this)}}))})},remove:function(a){var b=a.selector?a.selector.split(","):["no-selector"],d=$(this),c="";$.each(b,function(b,g){g=g.trim();var f=d.data("ichange-bound");if(f)if(f[g]&&a.namespace){b=a.namespace.split(".");var l=f[g];$.each(b,function(a,b){var e=[];$.each(l,function(a){b==this&&e.push(a)});$.each(e,function(e){f[g].splice(this-
e,1)})});0==f[g].length&&(c+=" "+g,delete f[g])}else c+=" "+g});""!=c&&("no-selector"!=c?(d.off("focus.ichange-event",c),d.off("blur.ichange-event",c),d.off("keydown.ichange-event",c)):(d.off("focus.ichange-event"),d.off("blur.ichange-event"),d.off("keydown.ichange-event")))}},remove:{add:function(a){var b={element:this,namespace:a.namespace,handler:a.handler};a.selector||(a=this.remove_key_hash||(this.remove_key_hash=bm.getUUID()),bm.domnode_self_remove_handler[a]||(bm.domnode_self_remove_handler[a]=
[]),bm.domnode_self_remove_handler[a].push(b));bm.domnode_parent_remove_handler.push(b)},remove:function(a){var b=this;if(!a.selector&&!this.cleaning_data){var d=this.remove_key_hash||(this.remove_key_hash=bm.getUUID());bm.domnode_self_remove_handler[d]&&(bm.domnode_self_remove_handler[d].removeAll(function(c){return b==c.element&&(!a.namespace||a.namespace==c.namespace)&&(!a.handler||a.handler==c.handler)}),bm.domnode_self_remove_handler[d].length||delete bm.domnode_self_remove_handler[d])}bm.domnode_parent_remove_handler.removeAll(function(c){return b==
c.element&&(!a.namespace||a.namespace==c.namespace)&&(!a.selector||a.selector==c.selector)&&(!a.handler||a.handler==c.handler)})}},jqclean:{add:function(a){bm.jquery_data_clean_handler.push({element:this,namespace:a.namespace,selector:a.selector,handler:a.handler})},remove:function(a){var b=this;bm.jquery_data_clean_handler.removeAll(function(d){return b==d.element&&(!a.namespace||a.namespace==d.namespace)&&(!a.selector||a.selector==d.selector)&&(!a.handler||a.handler==d.handler)})}}});
var _to_fixed=Number.prototype.toFixed;
$.extend(Number.prototype,{toFixed:function(a,b){a=_to_fixed.call(this,a);return b?a.replace(/\.?0+$/,""):a},toByteNotation:function(){if(1024>this)return this.toFixed(3,!0)+" B";var a=this/1024;if(1024>a)return a.toFixed(3,!0)+" KB";a/=1024;if(1024>a)return a.toFixed(3,!0)+" MB";a/=1024;return 1024>a?a.toFixed(3,!0)+" GB":(a/1024).toFixed(3,!0)+" TB"},loop:function(a,b){null==b&&(b=0);for(var d=this+b;b<d;b++)a(b)},rloop:function(a,b){null==b&&(b=this);for(var d=this-b;b>d&&!1!==a(b);b--);}});
function StringWriter(){this.buffer=[]}StringWriter.prototype.plus=function(a){this.buffer.push(a);return this};StringWriter.prototype.toString=function(){return this.buffer.join("")};$.extend(Date.prototype,{gmt:function(){return new Date(this.getTime()+6E4*this.getTimezoneOffset())},toZone:function(){return new Date(this.getTime()-6E4*this.getTimezoneOffset())},format:function(a){return this.toString(a)}});var _cachedObjectProtoToString=Object.prototype.toString;
Object.defineProperty(Object.prototype,"isArray",{get:function(){return this.cached_is_array||"[object Array]"==_cachedObjectProtoToString.call(this)},set:function(a){this.cached_is_array=a}});Object.defineProperty(Object.prototype,"isFunction",{get:function(){return this.cached_is_function||"function"===typeof this},set:function(a){this.cached_is_function=a}});Object.defineProperty(Object.prototype,"isString",{get:function(){return"[object String]"==_cachedObjectProtoToString.call(this)}});
Object.defineProperty(Object.prototype,"isNumber",{get:function(){return this.cached_is_number||"[object Number]"==_cachedObjectProtoToString.call(this)},set:function(a){this.cached_is_number=a}});Object.defineProperty(Object.prototype,"isDate",{get:function(){return"[object Date]"==_cachedObjectProtoToString.call(this)}});Object.defineProperty(Object.prototype,"isUndefined",{get:function(){return"undefined"===typeof this}});
Object.defineProperty(Object.prototype,"jqObject",{get:function(){return this instanceof String?$(this.toString()):$(this)}});var sizzle_expando=Object.keys($.expr.pseudos.not)[0];$.extend($.expr.pseudos,{hasparent:function(){var a=function(a){return function(b){return $(b.parentNode).is(a)}};a[sizzle_expando]=!0;return a}(),value:function(){var a=function(a){return function(b){return b.value==a}};a[sizzle_expando]=!0;return a}()});
(function(){var a,b={}.hasOwnProperty,d=function(a,c){function d(){this.constructor=a}for(var f in c)b.call(c,f)&&(a[f]=c[f]);d.prototype=c.prototype;a.prototype=new d;a.__super__=c.prototype;return a};var c=function(){function a(){this.options_index=0;this.parsed=[]}a.prototype.add_node=function(a){return"OPTGROUP"===a.nodeName.toUpperCase()?this.add_group(a):this.add_option(a)};a.prototype.add_group=function(a){var b;var c=this.parsed.length;this.parsed.push({array_index:c,group:!0,label:this.escapeExpression(a.label),
children:0,disabled:a.disabled});var e=a.childNodes;var d=[];var f=0;for(b=e.length;f<b;f++){var l=e[f];d.push(this.add_option(l,c,a.disabled))}return d};a.prototype.add_option=function(a,b,c){if("OPTION"===a.nodeName.toUpperCase()){if(""!==a.text){null!=b&&(this.parsed[b].children+=1);var e=a.getAttribute("depth");e=e?parseInt(e):0;this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:a.value,text:a.text,html:a.innerHTML,selected:a.selected,disabled:!0===c?c:a.disabled,
group_array_index:b,classes:a.className,style:a.style.cssText,depth:e})}else this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0});return this.options_index+=1}};a.prototype.escapeExpression=function(a){if(null==a||!1===a)return"";if(!/[\&\<\>\"\'\`]/.test(a))return a;var b={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};return a.replace(/&(?!\w+;)|[\<\>\"\'\`]/g,function(a){return b[a]||"&amp;"})};return a}();c.select_to_array=function(a){var b;
var d=new c;var f=a.childNodes;var e=0;for(b=f.length;e<b;e++)a=f[e],d.add_node(a);return d.parsed};var f=function(){function a(){this.options_index=0;this.parsed=[]}a.prototype.add_option=function(a){var b=g(a);this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:b.attr("value"),text:a.innerHTML.trim(),html:a.innerHTML.trim(),selected:b.is(".selected"),disabled:b.is("[disabled]"),group_array_index:void 0,classes:b.attr("class"),style:a.style.cssText});return this.options_index+=
1};return a}();f.select_to_array=function(a){var b;var c=new f;var d=g(a).find(".options");var e=0;for(b=d.length;e<b;e++)a=d[e],c.add_option(a);return c.parsed};window.AbstractChosen=function(){function a(a,b){this.form_field=a;if(this.is_custom_select=g(this.form_field).is("div.wcui-select"))a=g("<select></select>",{name:this.form_field.getAttribute("name"),"class":this.form_field.getAttribute("class")}).hide(),g(this.form_field).hide().after(a),this.custom_data_source=this.form_field,this.form_field=
a[0];this.options=null!=b?b:{};this.is_multiple=this.form_field.multiple;this.options_updated=!0;this.set_default_text();this.set_default_values();this.setup();this.set_up_html();this.register_observers()}a.prototype.set_default_values=function(){var a=this;this.activate_action=function(b){return a.activate_field(b)};this.results_showing=this.mouse_on_container=this.active_field=!1;this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text?
this.options.allow_single_deselect:!1;this.disable_search_threshold=this.options.disable_search_threshold||10;this.disable_search=this.options.disable_search||!1;this.enable_split_word_search=null!=this.options.enable_split_word_search?this.options.enable_split_word_search:!0;this.group_search=null!=this.options.group_search?this.options.group_search:!0;this.search_contains=this.options.search_contains||!1;this.single_backstroke_delete=null!=this.options.single_backstroke_delete?this.options.single_backstroke_delete:
!0;this.max_selected_options=this.options.max_selected_options||Infinity;this.inherit_select_classes=this.options.inherit_select_classes||!0;this.display_selected_options=null!=this.options.display_selected_options?this.options.display_selected_options:!0;return this.display_disabled_options=null!=this.options.display_disabled_options?this.options.display_disabled_options:!0};a.prototype.set_default_text=function(){this.form_field.getAttribute("data-placeholder")?this.default_text=this.form_field.getAttribute("data-placeholder"):
this.default_text=this.is_multiple?this.options.placeholder_text_multiple||this.options.placeholder_text||a.default_multiple_text:this.options.placeholder_text_single||this.options.placeholder_text||a.default_single_text;return this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||a.default_no_result_text};a.prototype.mouse_enter=function(){return this.mouse_on_container=!0};a.prototype.mouse_leave=function(){return this.mouse_on_container=!1};
a.prototype.input_focus=function(a){var b=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return b.container_mousedown()},50)}else if(!this.active_field)return this.activate_field()};a.prototype.input_blur=function(a){var b=this;this.search_field_blur_to_container=!1;if(this.mouse_on_container)this.search_field_blur_to_container=!0;else return this.active_field=!1,setTimeout(function(){return b.blur_test()},100)};a.prototype.results_option_build=function(a){var b;var c=
"";var e=this.results_data;var d=0;for(b=e.length;d<b;d++){var f=e[d];c=f.group?c+this.result_add_group(f):c+this.result_add_option(f);null!=a&&a.first&&(f.selected&&this.is_multiple?this.choice_build(f):f.selected&&!this.is_multiple&&this.single_set_selected_text(f.text))}return c};a.prototype.result_add_option=function(a){if(!a.search_match||!this.include_option_in_results(a))return"";var b=["chosen-result"];a.disabled||a.selected&&this.is_multiple||b.push("active-result");!a.disabled||a.selected&&
this.is_multiple||b.push("disabled-result");a.selected&&b.push("result-selected");null!=a.group_array_index&&b.push("group-option");""!==a.classes&&b.push(a.classes);var c=document.createElement("div");c.className=b.join(" ");c.style.cssText=a.style;c.setAttribute("data-option-array-index",a.array_index);if(1<a.depth){b="";for(i=1;i<a.depth;i++)b+="&nbsp;&nbsp;";b=b+"<span class='child'>-</span>&nbsp;"+a.search_text}else b=a.search_text;c.innerHTML=b;return this.outerHTML(c)};a.prototype.result_add_group=
function(a){if(!a.search_match&&!a.group_match||!(0<a.active_options))return"";var b=document.createElement("li");b.className="group-result";b.innerHTML=a.search_text;return this.outerHTML(b)};a.prototype.results_update_field=function(){this.options_updated=!0;this.set_default_text();this.is_multiple||this.results_reset_cleanup();this.result_clear_highlight();this.results_build();if(this.results_showing)return this.winnow_results()};a.prototype.reset_single_select_options=function(){var a;var b=this.results_data;
var c=[];var e=0;for(a=b.length;e<a;e++){var d=b[e];d.selected?c.push(d.selected=!1):c.push(void 0)}return c};a.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()};a.prototype.results_search=function(a){return this.results_showing?this.winnow_results():this.results_show()};a.prototype.winnow_results=function(){var a,b=!this.search_field[0].readOnly;if(b||this.options_updated){this.no_results_clear();var c=0,e=this.get_search_text();var d=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,
"\\$&");var f=this.search_contains?"":"^";f=new RegExp(f+d,"i");var g=new RegExp(d,"i");var m=this.results_data;var A=0;for(a=m.length;A<a;A++){d=m[A];d.search_match=!1;var x=null;if(this.include_option_in_results(d)&&(d.group&&(d.group_match=!1,d.active_options=0),null!=d.group_array_index&&this.results_data[d.group_array_index]&&(x=this.results_data[d.group_array_index],0===x.active_options&&x.search_match&&(c+=1),x.active_options+=1),!d.group||this.group_search))if(d.search_text=d.group?d.label:
d.html,d.search_match=this.search_string_match(d.search_text,f),d.search_match&&!d.group&&(c+=1),d.search_match){if(e.length){var z=d.search_text.search(g);var D=d.search_text.substr(0,z+e.length)+"</em>"+d.search_text.substr(z+e.length);d.search_text=D.substr(0,z)+"<em>"+D.substr(z)}null!=x&&(x.group_match=!0)}else null!=d.group_array_index&&this.results_data[d.group_array_index].search_match&&(d.search_match=!0)}this.result_clear_highlight();1>c&&e.length?((b||this.options_updated)&&this.update_results_content(""),
b=this.no_results(e)):((b||this.options_updated)&&this.update_results_content(this.results_option_build()),b=this.winnow_results_set_highlight())}else b=this.winnow_results_set_highlight();this.dropdown.position({my:"left top",at:this.is_multiple?"left bottom+1":"left bottom",of:this.container,within:this.container[0].offsetParent});this.options_updated=!1;return b};a.prototype.search_string_match=function(a,b){var c;if(b.test(a))return!0;if(this.enable_split_word_search&&(0<=a.indexOf(" ")||0===
a.indexOf("["))){var e=a.replace(/\[|\]/g,"").split(" ");if(e.length){var d=0;for(c=e.length;d<c;d++)if(a=e[d],b.test(a))return!0}}};a.prototype.choices_count=function(){var a,b;if(null!=this.selected_option_count)return this.selected_option_count;this.selected_option_count=0;if(b=this.form_field.options){var c=0;for(a=b.length;c<a;c++){var e=b[c];e.selected&&(this.selected_option_count+=1)}}else this.selected_option_count=this.getSelectedCount();return this.selected_option_count};a.prototype.choices_click=
function(a){a.preventDefault();if(g(a.target).is(".search-choice, .search-choice > *")&&this.is_multiple&&this.results_showing)this.close_field();else if(!(this.results_showing||this.is_disabled||g(a.target).is(".search-choice, .search-choice > *")))return this.results_show()};a.prototype.keyup_checker=function(a){var b;var c=null!=(b=a.which)?b:a.keyCode;this.search_field_scale();switch(c){case 8:if(this.is_multiple&&1>this.backstroke_length&&0<this.choices_count())return this.keydown_backstroke();
if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:a.preventDefault();if(this.results_showing)return this.result_select(a);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}};a.prototype.clipboard_event_checker=function(a){var b=this;return setTimeout(function(){return b.results_search()},50)};a.prototype.include_option_in_results=function(a){return this.is_multiple&&
!this.display_selected_options&&a.selected||!this.display_disabled_options&&a.disabled||a.empty?!1:!0};a.prototype.search_results_touchstart=function(a){this.touch_started=!0;return this.search_results_mouseover(a)};a.prototype.search_results_touchmove=function(a){this.touch_started=!1;return this.search_results_mouseout(a)};a.prototype.search_results_touchend=function(a){if(this.touch_started)return this.search_results_mouseup(a)};a.prototype.outerHTML=function(a){if(a.outerHTML)return a.outerHTML;
var b=document.createElement("div");b.appendChild(a);return b.innerHTML};a.prototype.reset_single_select_options=function(){var a;var b=this.results_data;var c=[];var e=0;for(a=b.length;e<a;e++){var d=b[e];d.selected?c.push(d.selected=!1):c.push(void 0)}return c};a.default_multiple_text="Select Some Options";a.default_single_text="Select an Option";a.default_no_result_text="No results match";a.prototype.destroy=function(){this.destroy()};a.prototype.disable=function(a){var b=arguments,c=this.form_field_jq;
if("string"==typeof a){var e=c.find("option[value='"+a+"']");2!=b.length||b[1]?e.attr("disabled",""):e.removeAttr("disabled")}else a?c.attr("disabled",""):c.removeAttr("disabled");c.trigger("chosen:updated")};a.prototype.add=function(a){var b=this.form_field_jq;var c=b.find("option[value='"+(a.value?a.value:"").replace(/(')/g,"\\$1")+"']");c.length?c=c.text(a.text):(c=g("<option></option>",a),b.append(c));a.selected&&b.val(c.attr("value"));b.trigger("chosen:updated")};a.prototype.update=function(){this.form_field_jq.trigger("chosen:updated")};
a.prototype.val=function(a){var b=this.form_field_jq;if(void 0!=a)b.val(a),b.trigger("chosen:updated");else return b.val()};a.prototype.remove=function(a){var b=this.form_field_jq;if(a){if(a=a instanceof g?a:b.find("option[value='"+a+"']"),a.length){var c=a[0].selected;a.remove();c&&b.val(b.find("option:first").val());b.trigger("chosen:updated")}}else this.destroy(),b.remove()};a.prototype.removeAll=function(){this.form_field_jq.find("option").remove();this.form_field_jq.val("");this.form_field_jq.trigger("chosen:updated")};
a.prototype.dropshow=function(){this.form_field_jq.trigger("chosen:open.chosen")};return a}();var g=jQuery;g.fn.extend({chosen:function(a){var b=arguments;if(!this.length)return this;var c;g.each(this,function(){var d=g(this);var e=d.data("wcui-chosen");if("string"==typeof a&&e){if(c=e[a].apply(e,Array.prototype.splice.call(b,1)),"undefined"!=typeof c)return!1}else e||(g.extend(a,d.config("chosen")),d.data("wcui-chosen",new Chosen(this,a)))});return c?c:this}});window.Chosen=function(b){function l(){return a=
l.__super__.constructor.apply(this,arguments)}d(l,b);l.prototype.setup=function(){this.form_field_jq=g(this.form_field);this.current_selectedIndex=this.form_field.selectedIndex;return this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")};l.prototype.set_up_html=function(){var a=["chosen-container"];a.push("chosen-container-"+(this.is_multiple?"multi":"single"));this.inherit_select_classes&&this.form_field.className&&a.push(this.form_field.className);this.is_rtl&&a.push("chosen-rtl");a={"class":a.join(" "),
title:this.form_field.title};this.form_field.id.length&&(a.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen");this.container=g("<div />",a);this.form_field_jq.attr("validation")&&!this.form_field_jq.is("[error-on]")&&(a=a.id,a||(a=bm.getUUID(),this.container.attr("id",a)),this.form_field_jq.attr("error-on",a));this.is_multiple?this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><div class="chosen-results"></div></div>'):
this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><div class="chosen-results"></div></div>');a=this.container.find(".chosen-results");a.scrollbar({vertical:{offset:-2,step:"auto"}});a.css({maxHeight:"120px"});this.form_field_jq.hide().after(this.container);this.dropdown=this.container.find("div.chosen-drop").first();this.search_field=
this.container.find("input").first().change(function(a){a.originalEvent.ignore=!0});this.search_results=this.container.find(".chosen-results").first();this.search_field_scale();this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first());this.results_build();this.set_tab_index();
this.set_label_behavior();return this.form_field_jq.trigger("chosen:ready",{chosen:this})};l.prototype.register_observers=function(){var a=this;this.container.bind("mousedown.chosen",function(b){a.container_mousedown(b)});this.container.bind("mouseup.chosen",function(b){a.container_mouseup(b)});this.container.bind("mouseenter.chosen",function(b){a.mouse_enter(b)});this.container.bind("mouseleave.chosen",function(b){a.mouse_leave(b)});this.search_results.bind("mouseover.chosen",function(b){a.search_results_mouseover(b)});
this.search_results.bind("mouseup.chosen",function(b){a.search_results_mouseup(b)});this.search_results.bind("mouseout.chosen",function(b){a.search_results_mouseout(b)});this.form_field_jq.bind("chosen:updated.chosen",function(b){a.results_update_field(b)});this.form_field_jq.bind("chosen:activate.chosen",function(b){a.activate_field(b)});this.form_field_jq.bind("chosen:open.chosen",function(b){a.container_mousedown(b)});this.form_field_jq.bind("chosen:close.chosen",function(b){a.input_blur(b)});
this.search_field.bind("blur.chosen",function(b){a.input_blur(b)});this.search_field.bind("keyup.chosen",function(b){a.keyup_checker(b)});this.search_field.bind("keydown.chosen",function(b){a.keydown_checker(b)});this.search_field.bind("focus.chosen",function(b){a.input_focus(b)});this.search_field.bind("cut.chosen",function(b){a.clipboard_event_checker(b)});this.search_field.bind("paste.chosen",function(b){a.clipboard_event_checker(b)});return this.is_multiple?this.search_choices.bind("click.chosen",
function(b){a.choices_click(b)}):this.container.bind("click.chosen",function(a){a.preventDefault()})};l.prototype.destroy=function(){this.search_field[0].tabIndex&&(this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex);this.is_custom_select&&this.form_field.remove();this.container.remove();this.form_field_jq.removeData("wcui-chosen");return this.form_field_jq.show()};l.prototype.search_field_disabled=function(){if(this.is_disabled=this.form_field_jq[0].disabled)return this.container.addClass("chosen-disabled"),
this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus.chosen",this.activate_action),this.close_field();this.container.removeClass("chosen-disabled");this.search_field[0].disabled=!1;if(!this.is_multiple)return this.selected_item.bind("focus.chosen",this.activate_action)};l.prototype.container_mousedown=function(a){if(!this.is_disabled&&(a&&"mousedown"===a.type&&!this.results_showing&&a.preventDefault(),null==a||!g(a.target).is(".search-choice, .search-choice > *")))return this.active_field?
this.is_multiple||!a||g(a.target)[0]!==this.selected_item[0]&&!g(a.target).parents("a.chosen-single").length||(a.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),this.results_show()),this.search_activated_for_mousedown=!0,this.activate_field()};l.prototype.container_mouseup=function(a){if("ABBR"===a.target.nodeName&&!this.is_disabled)return this.results_reset(a);if(this.search_activated_for_mousedown||this.is_multiple&&this.search_field_blur_to_container&&!g(a.target).is(".search-choice, .search-choice > *"))this.search_activated_for_mousedown=
!1,this.search_field.focus()};l.prototype.search_results_mousewheel=function(a){var b;a.originalEvent&&(b=-a.originalEvent.wheelDelta||a.originalEvent.detail);if(null!=b)return a.preventDefault(),"DOMMouseScroll"===a.type&&(b*=40),this.search_results.scrollTop(b+this.search_results.scrollTop())};l.prototype.blur_test=function(a){if(!this.active_field&&this.container.hasClass("chosen-container-active"))return this.close_field()};l.prototype.close_field=function(){this.active_field=!1;this.results_hide();
this.container.removeClass("chosen-container-active");this.clear_backstroke();this.show_search_field_default();return this.search_field_scale()};l.prototype.activate_field=function(){this.container.addClass("chosen-container-active");this.active_field=!0;this.search_field.val(this.search_field.val());return this.search_field.focus()};l.prototype.results_build=function(){var a=this;this.parsing=!0;this.selected_option_count=null;this.results_data=this.is_custom_select?f.select_to_array(this.custom_data_source):
c.select_to_array(this.form_field);this.is_custom_select&&(a.form_field_jq.empty(),this.results_data.every(function(){var e=g("<option></option>",{value:this.value});this.selected&&e.attr("selected","selected");a.form_field_jq.append(e)}));if(this.is_multiple)this.search_choices.find("li.search-choice").remove();else if(!this.is_multiple){this.single_set_selected_text();var b=this.is_custom_select?this.form_field_jq.find(".options").length:this.form_field.options?this.form_field.options.length:0;
this.disable_search||b<=this.disable_search_threshold?(this.search_field[0].readOnly=!0,this.container.addClass("chosen-container-single-nosearch")):(this.search_field[0].readOnly=!1,this.container.removeClass("chosen-container-single-nosearch"))}this.update_results_content(this.results_option_build({first:!0}));this.search_field_disabled();this.show_search_field_default();this.search_field_scale();return this.parsing=!1};l.prototype.result_do_highlight=function(a){if(a.length){this.result_clear_highlight();
this.result_highlight=a;this.result_highlight.addClass("highlighted");var b=parseInt(this.search_results.css("maxHeight"),10);var e=this.search_results.scrollTop();var c=b+e;var d=this.result_highlight.position().top+this.search_results.scrollTop();a=d+this.result_highlight.outerHeight();if(a>=c)return this.search_results.scrollTop(0<a-b?a-b:0);if(d<e)return this.search_results.scrollTop(d)}};l.prototype.result_clear_highlight=function(){this.result_highlight&&this.result_highlight.removeClass("highlighted");
return this.result_highlight=null};l.prototype.results_show=function(){if(this.is_multiple&&this.max_selected_options<=this.choices_count())return this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1;var a=this.container.hasClass("always-bottom");this.container.addClass("chosen-with-drop");this.results_showing=!0;this.search_field.focus();this.search_field.val(this.search_field.val());this.winnow_results();if(!a){a=g(window);var b=this.container.parents(".scrollable.vertical").first(),
e=this.container.offset().top;b.length&&(a=b,e-=a.offset().top);b=this.container.find(".chosen-drop");var c=this.container.height();a.height()-(e+c)>b.height()?this.container.find(".chosen-drop").css({top:1.18*c}):this.container.find(".chosen-drop").css({top:-b.height()})}return this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this})};l.prototype.update_results_content=function(a){this.search_results.find(".chosen-result").remove();this.search_results.prepend(a);this.search_results.is(".scrollable")&&
this.search_results.obj()instanceof Scrollbar&&this.search_results.scrollbar("update")};l.prototype.results_hide=function(){this.results_showing&&(this.result_clear_highlight(),this.container.removeClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this}));return this.results_showing=!1};l.prototype.set_tab_index=function(a){if(this.form_field.tabIndex)return a=this.form_field.tabIndex,this.form_field.tabIndex=-1,this.search_field[0].tabIndex=a};l.prototype.set_label_behavior=
function(){var a=this;this.form_field_label=this.form_field_jq.parents("label");!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=g("label[for='"+this.form_field.id+"']"));if(0<this.form_field_label.length)return this.form_field_label.bind("click.chosen",function(b){return a.is_multiple?a.container_mousedown(b):a.activate_field()})};l.prototype.show_search_field_default=function(){if(this.is_multiple&&1>this.choices_count()&&!this.active_field)return this.search_field.val(this.default_text),
this.search_field.addClass("default");this.search_field.val("");return this.search_field.removeClass("default")};l.prototype.search_results_mouseup=function(a){var b=g(a.target).hasClass("active-result")?g(a.target):g(a.target).parents(".active-result").first();if(b.length)return this.result_highlight=b,this.result_select(a),this.search_field.focus()};l.prototype.search_results_mouseover=function(a){if(a=g(a.target).hasClass("active-result")?g(a.target):g(a.target).parents(".active-result").first())return this.result_do_highlight(a)};
l.prototype.search_results_mouseout=function(a){if(g(a.target).hasClass("active-result"))return this.result_clear_highlight()};l.prototype.choice_build=function(a){var b=this;var e=g("<li />",{"class":"search-choice"}).html("<span>"+a.html+"</span>");a.disabled?e.addClass("search-choice-disabled"):(a=g("<a />",{"class":"search-choice-close","data-option-array-index":a.array_index}),a.bind("click.chosen",function(e){return b.choice_destroy_link_click(e)}),e.append(a));return this.search_container.before(e)};
l.prototype.choice_destroy_link_click=function(a){if(!(this.before_choice_close&&!1===this.before_choice_close(g(a.target).closest("li"))||this.is_disabled))return this.choice_destroy(g(a.target))};l.prototype.choice_value=function(a){a.is("li")&&(a=a.find("a.search-choice-close"));a=a[0].getAttribute("data-option-array-index");return this.form_field.options[this.results_data[a].options_index].value};l.prototype.choice_destroy=function(a){var b=a[0].getAttribute("data-option-array-index");if(this.result_deselect(b))return this.show_search_field_default(),
this.is_multiple&&0<this.choices_count()&&1>this.search_field.val().length&&this.results_hide(),a.parents("li").first().remove(),a=this.form_field.options[this.results_data[b].options_index].value,this.form_field_jq.trigger("selection_removed",a),this.form_field_jq.trigger("change",[a,void 0]),this.search_field_scale()};l.prototype.results_reset=function(){this.reset_single_select_options();var a=this.is_multiple?null:-1<this.form_field.selectedIndex?this.form_field.options[this.form_field.selectedIndex].value:
null;this.form_field.options[0].selected=!0;this.single_set_selected_text();this.show_search_field_default();this.results_reset_cleanup();this.form_field_jq.trigger("change",[this.is_multiple?void 0:a,this.form_field.options[0].value]);if(this.active_field)return this.results_hide()};l.prototype.results_reset_cleanup=function(){this.current_selectedIndex=this.form_field.selectedIndex;return this.selected_item.find("abbr").remove()};l.prototype.result_select=function(a){if((!this.before_choice_chose||
!1!==this.before_choice_chose(a))&&this.result_highlight){a=this.result_highlight;this.result_clear_highlight();if(this.is_multiple&&this.max_selected_options<=this.choices_count())return this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1;this.is_multiple||(this.reset_single_select_options(),a.siblings(".result-selected").removeClass("result-selected"),a.addClass("result-selected"));a=this.results_data[a[0].getAttribute("data-option-array-index")];a.selected=!0;this.form_field.options[a.options_index].selected=
!0;this.selected_option_count=null;this.is_multiple?this.choice_build(a):this.single_set_selected_text(a.text);this.results_hide();this.search_field.val("");var b=this.form_field.selectedIndex;var e=this.form_field.options[a.options_index].value;var c=this.current_selectedIndex;this.current_selectedIndex=b;a=this.search_field_scale();var d=this;setTimeout(function(){d.is_multiple?(d.form_field_jq.trigger("selection_added",[e]),d.form_field_jq.trigger("change",[void 0,e])):b!==c&&d.form_field_jq.trigger("change",
[-1<c?d.form_field.options[c].value:void 0,e])},10);return a}};l.prototype.get_ordered_selection=function(){var a=this;if(this.is_multiple){var b=[];this.search_container.siblings(".search-choice").each(function(){b.push(a.results_data[g(this).find(".search-choice-close").attr("data-option-array-index")].value)});return b}};l.prototype.make_selection_sortable=function(){var a=this;this.is_multiple&&this.search_choices.sortable({items:".search-choice",update:function(){a.form_field_jq.trigger("chosen:re_ordered")}})};
l.prototype.single_set_selected_text=function(a){null==a&&(a=this.default_text);a===this.default_text?this.selected_item.addClass("chosen-default"):(this.single_deselect_control_build(),this.selected_item.removeClass("chosen-default"));return this.is_custom_select?this.selected_item.find("span").html(a):this.selected_item.find("span").text(a)};l.prototype.result_deselect=function(a){a=this.results_data[a];if(this.form_field.options[a.options_index].disabled)return!1;a.selected=!1;this.form_field.options[a.options_index].selected=
!1;this.selected_option_count=null;this.result_clear_highlight();this.results_showing&&this.winnow_results();return!0};l.prototype.single_deselect_control_build=function(){if(this.allow_single_deselect)return this.selected_item.find("abbr").length||this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'),this.selected_item.addClass("chosen-single-with-deselect")};l.prototype.get_search_text=function(){return this.search_field.val()===this.default_text?"":g("<div/>").text(g.trim(this.search_field.val())).html()};
l.prototype.winnow_results_set_highlight=function(){var a=this.is_multiple?[]:this.search_results.find(".result-selected.active-result");a=a.length?a.first():this.search_results.find(".active-result").first();if(null!=a)return this.result_do_highlight(a)};l.prototype.no_results=function(a){var b=g('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>');b.find("span").first().html(a);this.search_results.append(b);return this.form_field_jq.trigger("chosen:no_results",{chosen:this})};
l.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()};l.prototype.keydown_arrow=function(){var a;if(this.results_showing&&this.result_highlight){if(a=this.result_highlight.nextAll("div.active-result").first())return a=this.result_do_highlight(a),this.search_results.scrollbar("update"),a}else return this.results_show()};l.prototype.keyup_arrow=function(){if(!this.results_showing&&!this.is_multiple)return this.results_show();if(this.result_highlight){var a=
this.result_highlight.prevAll("div.active-result");if(a.length)return a=this.result_do_highlight(a.first()),this.search_results.scrollbar("update"),a;0<this.choices_count()&&this.results_hide();return this.result_clear_highlight()}};l.prototype.keydown_backstroke=function(){if(this.pending_backstroke)return this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke();var a=this.search_container.siblings("li.search-choice").last();if(a.length&&!a.hasClass("search-choice-disabled"))return this.pending_backstroke=
a,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")};l.prototype.clear_backstroke=function(){this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus");return this.pending_backstroke=null};l.prototype.keydown_checker=function(a){var b;var e=null!=(b=a.which)?b:a.keyCode;this.search_field_scale();8!==e&&this.pending_backstroke&&this.clear_backstroke();switch(e){case 8:this.backstroke_length=this.search_field.val().length;
break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(a);this.mouse_on_container=!1;break;case 13:a.preventDefault();break;case 38:a.preventDefault();this.keyup_arrow();break;case 40:a.preventDefault(),this.keydown_arrow()}};l.prototype.search_field_scale=function(){var a;if(this.is_multiple){var b="position:absolute; left: -1000px; top: -1000px; display:none;";var e="font-size font-style font-weight font-family line-height text-transform letter-spacing".split(" ");var c=0;for(a=
e.length;c<a;c++){var d=e[c];b+=d+":"+this.search_field.css(d)+";"}b=g("<div />",{style:b});b.text(this.search_field.val());g("body").append(b);d=b.width()+25;b.remove();b=this.container.outerWidth();d>b-10&&(d=b-10);(b=this.form_field_jq.attr("min-width"))&&b>d&&(d=b);return this.search_field.css({width:d+"px"})}};return l}(AbstractChosen)}).call(this);
(function(){bm.onReady(window,"VALIDATION_RULES",function(){VALIDATION_RULES["chosen-required"]={check:function(a,b,c){return 0<c.find("input").length},msg_template:VALIDATION_RULES.required.msg_template}});$.fn.extend({multitxtchosen:function(a){return this.length?$(this).each(function(){if(!$(this).hasClass("chosen-done")){"multi"!=a.type||a.name||(a.name=$(this).attr("name"));var b=new d(this,a);$(this).data("wcui-multitxtchosen",b);return b}}):this},multispecialchosen:function(a){return this.length?
this.each(function(b){var d=$(this);if(!d.hasClass("chosen-done"))return d[b].getAttribute("selected"),a.selectedItem=a.highlighted,d.data("wcui-chosen",new c(this,a))}):this}});var a={to_array:function(a){a=a.val();return""==a?[]:a.exSplit()}},b={to_array:function(a){var b=[];a.find("input").each(function(){b.push(this.value)});return b}},d=function(){function c(){arguments[0].multiple=!0;c._super.constructor.apply(this,arguments)}c.inherit(window.Chosen);c.prototype.results_build=function(){var c;
this.parsing=!0;this.selected_Invalid_count=this.selected_option_count=0;"multi"==this.options.type?(this.results_data=b.to_array(this.form_field_jq),this.form_field_jq.html("")):"csv"==this.options.type&&(this.results_data=a.to_array(this.form_field_jq),this.csv_as_array=[],this.form_field_jq.val(""));var d=this.results_data;var f=0;for(c=d.length;f<c;f++){var n=d[f];this.choice_build({array_index:"_"+(new Date).getTime()+"_",html:n})}this.search_field_disabled();this.show_search_field_default();
this.search_field_scale();this.search_results.html("");return this.parsing=!1};c.prototype.getSelectedCount=function(){this.results_data.length};c.prototype.choice_build=function(a){if(""!=$.trim(a.html)){var b=this;var c=this.container_id+"_c_"+a.array_index;var d=!0;if(!this.check_duplicate(a.html)){if(this.form_field_jq.is("[chosen-validation]")){var f=this.form_field_jq.attr("chosen-validation");d=!ValidationField.validateAs($("<input>").val(a.html),f)}f=$('<li class="search-choice '+(d?"":"invalid")+
'" id="'+c+'"><span>'+a.html.htmlEncode()+'</span><a href="javascript:void(0)" class="search-choice-close" data-option-array-index="'+a.array_index+'"></a></li>');this.search_container.before(f);f=f.find("a").first();d?(this.selected_option_count++,"multi"==this.options.type?this.form_field_jq.append("<input id='result_"+c+"' type='hidden' name='"+this.options.name+"' value='"+a.html+"'>"):"csv"==this.options.type&&(c=this.form_field_jq.val(),a=a.html,this.csv_as_array.push(a),a=-1<a.indexOf(",")||
"("==a.charAt(0)?"("+a+")":a,0<c.length&&(a=c+","+a),this.form_field_jq.val(a)),this.form_field_jq.trigger("change")):this.selected_Invalid_count++;return f.attr("chosen-option",!0).click(function(e){b.choice_destroy_link_click(e);b.search_field_scale();b.form_field_jq.trigger("change")})}}};c.prototype.check_duplicate=function(a){return"multi"==this.options.type?this.form_field_jq.find("[value='"+a+"']").length?!0:!1:"csv"==this.options.type?-1!=$.inArray(a,this.csv_as_array):!1};c.prototype.choice_destroy=
function(a){this.show_search_field_default();a=a.closest("li");if("multi"==this.options.type)this.form_field_jq.find("#result_"+a.attr("id")).remove();else if("csv"==this.options.type){var b=$.inArray(a.find("span:first").html(),this.csv_as_array);this.csv_as_array.splice(b,1);this.form_field_jq.val(this.csv_as_array.exJoin())}this.selected_option_count--;return a.first().remove()};c.prototype.close_field=function(){this.search_field.val()&&(this.choice_build({array_index:"_"+(new Date).getTime()+
"_",html:this.search_field.val()}),this.search_field.val(""));return c._super.close_field.call(this)};c.prototype.input_blur=function(a){var b=this;if(this.mouse_on_container)b.close_field(),b.input_focus(a);else return this.active_field=!1,setTimeout(function(){return b.blur_test()},100)};c.prototype.keydown_checker=function(a){var b;var c=null!=(b=a.which)?b:a.keyCode;this.search_field_scale();8!==c&&this.pending_backstroke&&this.clear_backstroke();switch(c){case 8:this.backstroke_length=this.search_field.val().length;
break;case 9:case 13:case 32:case 45:this.choice_build({array_index:"_"+(new Date).getTime()+"_",html:this.search_field.val()});this.search_field.val("");a.preventDefault();break;case 38:case 40:a.preventDefault()}};c.prototype.keyup_checker=function(a){var b;var c=null!=(b=a.which)?b:a.keyCode;this.search_field_scale();switch(c){case 8:if(this.is_multiple&&1>this.backstroke_length&&(0<this.choices_count()||0<this.selected_Invalid_count))return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),
this.results_search();break;case 13:a.preventDefault();if(this.results_showing)return this.result_select(a);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}};c.prototype.clear_all_selection=function(){this.container.find(".chosen-choices .search-choice .search-choice-close").trigger("click")};c.prototype.choices_click=c.prototype.result_select=c.prototype.winnow_results=function(){};return c}(),
c=function(){function a(){arguments[0].multiple=!0;a._super.constructor.apply(this,arguments)}a.inherit(window.Chosen);a.prototype.set_up_html=function(){var a=["chosen-container"];a.push("chosen-container-"+(this.is_multiple?"multi":"single"));this.inherit_select_classes&&this.form_field.className&&a.push(this.form_field.className);this.is_rtl&&a.push("chosen-rtl");a={"class":a.join(" "),title:this.form_field.title};this.form_field.id.length&&(a.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen");
this.container=$("<div />",a);this.form_field_jq.attr("validation")&&!this.form_field_jq.is("[error-on]")&&this.form_field_jq.attr("error-on",this.container_id);a=$("<input/>",{type:"hidden",name:this.options.hiddenfieldname||"highlighted",value:""});this.is_multiple?(this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>'),
this.container.find(".chosen-choices").append(a)):this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>');a=this.container.find(".chosen-results");a.scrollbar({vertical:{offset:-2,height:"auto"}});a.css({maxHeight:"120px"});this.form_field_jq.hide().after(this.container);this.dropdown=this.container.find("div.chosen-drop").first();
this.search_field=this.container.find("input").first();this.search_results=this.container.find("ul.chosen-results").first();this.search_field_scale();this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first());this.results_build();this.set_tab_index();this.set_label_behavior();
return this.form_field_jq.trigger("chosen:ready",{chosen:this})};a.prototype.choice_build=function(a){var b=this;if(1==b.choices_count()&&b.active_field||b.options.selectedItem==a.value&&!b.active_field){var c=$("<li />",{"class":"search-choice"}).html("<span class='selected' rel='"+a.array_index+"'>"+a.html+"</span>");b.changeSelected(c.find("span"),!1)}else c=$("<li />",{"class":"search-choice"}).html("<span rel='"+a.array_index+"'>"+a.html+"</span>");c.find("span").click(function(a){return $(this).closest(".chosen-container").hasClass("chosen-disabled")?
!1:b.choice_click(a,this)});a.disabled?c.addClass("search-choice-disabled"):(a=$("<a />",{href:"#","class":"search-choice-close","data-option-array-index":a.array_index}),a.bind("click.chosen",function(a){return $(this).closest(".chosen-container").hasClass("chosen-disabled")?!1:b.choice_destroy_link_click(a)}),c.append(a));return this.search_container.before(c)};a.prototype.result_deselect=function(a){var b=this.results_data[a];this.search_choices.find("input[name='"+(this.options.hiddenfieldname||
"highlighted")+"']").val()==b.value&&this.search_choices.find("input[type=hidden]").val("");if(this.form_field.options[b.options_index].disabled)return!1;b.selected=!1;this.form_field.options[b.options_index].selected=!1;this.selected_option_count=null;$("#"+this.container_id+"_o_"+a).removeClass("result-selected").addClass("active-result").show();this.result_clear_highlight();this.winnow_results();this.form_field_jq.trigger("change",{deselected:this.form_field.options[b.options_index].value});this.search_field_scale();
return!0};a.prototype.changeSelected=function(a,b){a=$(a);var c=this.search_choices;var d=a.attr("rel");d=this.results_data[d];c.find(".highlighted").removeClass("highlighted");a.closest("li").addClass("highlighted");a=c.find("input[type=hidden]");a.val(d.value);!1!==b&&a.trigger("change");c.append(a)};a.prototype.choice_click=function(a,b){this.changeSelected(b);return!1};return a}()})();
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(e){var b=e||window.event,g=l.call(arguments,1),m,n=0,A=0,x=0,z=0,D=0;if(e=a.event.fix(b),e.type="mousewheel","detail"in b&&(A=-1*b.detail),"wheelDelta"in b&&(A=b.wheelDelta),"wheelDeltaY"in b&&(A=b.wheelDeltaY),"wheelDeltaX"in b&&(n=-1*b.wheelDeltaX),"axis"in b&&b.axis===b.HORIZONTAL_AXIS&&(n=-1*A,A=0),m=0===A?n:A,"deltaY"in b&&(A=-1*b.deltaY,m=A),"deltaX"in
b&&(n=b.deltaX,0===A&&(m=-1*n)),0!==A||0!==n){if(1===b.deltaMode){var B=a.data(this,"mousewheel-line-height");m*=B;A*=B;n*=B}else 2===b.deltaMode&&(B=a.data(this,"mousewheel-page-height"),m*=B,A*=B,n*=B);if(x=Math.max(Math.abs(A),Math.abs(n)),(!f||f>x)&&(f=x,q.settings.adjustOldDeltas&&"mousewheel"===b.type&&0===x%120&&(f/=40)),q.settings.adjustOldDeltas&&"mousewheel"===b.type&&0===x%120&&(m/=40,n/=40,A/=40),m=Math[1<=m?"floor":"ceil"](m/f),n=Math[1<=n?"floor":"ceil"](n/f),A=Math[1<=A?"floor":"ceil"](A/
f),q.settings.normalizeOffset&&this.getBoundingClientRect)b=this.getBoundingClientRect(),z=e.clientX-b.left,D=e.clientY-b.top;return e.deltaX=n,e.deltaY=A,e.deltaFactor=f,e.offsetX=z,e.offsetY=D,e.deltaMode=0,g.unshift(e,m,n,A),c&&clearTimeout(c),c=setTimeout(d,200),(a.event.dispatch||a.event.handle).apply(this,g)}}function d(){f=null}var c,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],m="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],
l=Array.prototype.slice;if(a.event.fixHooks)for(var n=g.length;n;)a.event.fixHooks[g[--n]]=a.event.mouseHooks;var q=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var e=m.length;e;)this.addEventListener(m[--e],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",q.getLineHeight(this));a.data(this,"mousewheel-page-height",q.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=m.length;e;)this.removeEventListener(m[--e],
b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height");a.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){e=a(e);var b=e["offsetParent"in a.fn?"offsetParent":"parent"]();return b.length||(b=a("body")),parseInt(b.css("fontSize"),10)||parseInt(e.css("fontSize"),10)||16},getPageHeight:function(e){return a(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},
unmousewheel:function(e){return this.unbind("mousewheel",e)}})});
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(b,f){function c(){"number"===typeof m.opts.lines&&2>m.opts.lines?m.$el.addClass(m.opts.ellipLineClass):(y=m.$cont.height(),"auto"===m.opts.lines&&m.$el.prop("scrollHeight")<=y||!q||(A=a.trim(m.text).split(/\s+/),m.$el.html('<span style="white-space: nowrap;">'+A.join('</span> <span style="white-space: nowrap;">')+"</span>"),m.$el.find("span").each(q),null!=e&&(A[e]='<span class="'+m.opts.ellipLineClass+
'">'+A[e],A.push("</span>"),m.$el.html(A.join(" ")))))}var m=this,l=0,n=[],q,e,p,t,w,y,A;m.$cont=a(b);m.opts=a.extend({},d,f);"auto"===m.opts.lines&&(q=function(b,c){c=a(c);var d=c.position().top;w=w||c.height();d===t?n[l].push(c):(t=d,l+=1,n[l]=[c]);if(d+w>y)return e=b-n[l-1].length,!1});"number"===typeof m.opts.lines&&1<m.opts.lines&&(q=function(b,c){c=a(c).position().top;c!==t&&(t=c,l+=1);if(l===m.opts.lines)return e=b,!1});if(m.opts.responsive)a(window).on("resize.ellipsis",function(){n=[];l=
0;e=t=null;m.$el.html(m.text);clearTimeout(p);p=setTimeout(c,100)});m.text=m.$cont.text();m.opts.ellipLineClass=m.opts.ellipClass+"-line";m.$el=a('<span class="'+m.opts.ellipClass+'" />');m.$el.text(m.text);m.$cont.empty().append(m.$el);c()}var d={lines:"auto",ellipClass:"ellip",responsive:!1};a.fn.ellipsis=function(c){return this.each(function(){try{a(this).data("ellipsis",new b(this,c))}catch(f){window.console&&console.error("ellipsis: "+f)}})}});
(function(){window.WebDAVClient={doPropFind:function(a,b,d){bm.ajax({type:"PROPFIND",url:app.baseUrl+bm.encodePath(a),data:'<?xml version="1.0"?><propfind xmlns="bm:"><prop><getcontenttype/><getchildcount/><getfoldercount/><getcontentlength/><resourcetype/><displayname/><getlastmodified/><supportedlock/><lockdiscovery/></prop></propfind>',dataType:"xml",beforeSend:function(a){a.setRequestHeader("Depth","1")},success:function(c){c=$(c);var f=[],g=[],m=a;/\/$/.test(m)&&(m=m.substring(0,m.length-1));
c.find("D\\:response, response").each(function(a,b){if(0!=a){var c=$(b).find("D\\:resourcetype, resourcetype");a=$(b).find("D\\:displayname, displayname");0==c.children().length?(b=$(b).find("D\\:getcontentlength, getcontentlength"),c=a.text().substring(a.text().lastIndexOf(".")+1),f.push({name:a.text(),size:parseInt(b.text(),10),path:m+"/"+a.text(),parent:m,type:"file",clazz:c})):(c=$(b).find("D\\:getchildcount, getchildcount"),b=$(b).find("D\\:getfoldercount, getfoldercount"),g.push({name:a.text(),
path:m+"/"+a.text(),parent:m,type:"folder",hasChildFolder:0<parseInt(b.text()),hasChild:0<parseInt(c.text())}))}});d.onPopulate.call(b,{files:f,folders:g})},error:function(a,f){d.onError.call(b,f)}})},doDeletePath:function(a,b,d){bm.ajax({type:"DELETE",url:app.baseUrl+bm.encodePath(a),success:function(){b.success.call(d)},error:function(a,f){b.error.call(d,f)}})},doCreateDirectory:function(a,b,d){bm.ajax({type:"MKCOL",url:app.baseUrl+bm.encodePath(a),success:function(){d.success.call(b)},error:function(a,
f){d.error.call(b,a,f)}})},doMove:function(a,b,d,c){bm.ajax({type:"MOVE",url:app.baseUrl+bm.encodePath(a),beforeSend:function(a){a.setRequestHeader("Destination",b)},success:function(){d.success.call(c)},error:function(a,b){d.error.call(c,b)}})}}})();var ProgressBar=function(a,b){this.parent=a;this.maxValue=100;this.position=0;this.calculateInPercent=b};ProgressBar.prototype.render=function(){$(this.parent).empty();$(this.parent).append("<div class='progress-bar'></div>");$(this.parent).find("div").append("<div class='completed'></div>")};
ProgressBar.prototype.setMax=function(a){this.maxValue=a;this.update()};ProgressBar.prototype.update=function(){var a=this.calculateInPercent?this.position:this.position/this.maxValue*100;100<a&&(a=100);$(this.parent).find(".completed").css("width",a+"%")};ProgressBar.prototype.setPosition=function(a){this.position=a;this.update()};ProgressBar.prototype.advance=function(a){this.position=this.calculateInPercent?a:this.position+a;this.update()};
ProgressBar.prototype.complete=function(){this.position=this.maxValue;this.update()};
(function(a){a.Zebra_DatePicker=function(b,d){var c={always_visible:!1,days:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),days_abbr:!1,direction:0,disabled_dates:!1,enabled_dates:!1,first_day_of_week:1,format:"yyyy-MM-dd",header_navigation:["&#171;","&#187;"],inside:!0,lang_clear_date:"Clear date",months:"January February March April May June July August September October November December".split(" "),months_abbr:!1,offset:[5,-5],pair:!1,readonly_element:!0,select_other_months:!1,
show_clear_date:0,show_icon:!0,show_other_months:!0,show_select_today:"Today",show_week_number:!1,start_date:!1,strict:!1,view:"days",weekend_days:[0,6],zero_pad:!1,onChange:null,onClear:null,onSelect:null},f,g,m,l,n,q,e,p,t,w,y,A,x,z,D,B,G,L=0,J=0,P=0,fa,da,M,V,ea,Y,pa,N,Z,S,K,H,E,ra,X,I,sa,ma,Q,R,ua,C=this;C.settings={};var W=a(b),O=function(b){if(!b){C.settings=a.extend({},c,d);for(var E in W.data())0===E.indexOf("zdp_")&&(E=E.replace(/^zdp\_/,""),void 0!==c[E]&&(C.settings[E]=W.data("zdp_"+E)))}C.settings.readonly_element&&
W.attr("readonly","readonly");E={days:["d","j","D"],months:["F","m","M","n","t"],years:["o","Y","y"]};var X=!1,ra=!1,qa=!1,Ua=null;for(Ua in E)a.each(E[Ua],function(e,a){-1<C.settings.format.indexOf(a)&&("days"==Ua?X=!0:"months"==Ua?ra=!0:"years"==Ua&&(qa=!0))});I=X&&ra&&qa?["years","months","days"]:!X&&ra&&qa?["years","months"]:X||ra||!qa?X||!ra||qa?["years","months","days"]:["months"]:["years"];-1==a.inArray(C.settings.view,I)&&(C.settings.view=I[I.length-1]);Y=[];ea=[];for(var Ca=0;2>Ca;Ca++)E=
0===Ca?C.settings.disabled_dates:C.settings.enabled_dates,a.isArray(E)&&0<E.length&&a.each(E,function(){for(var e=this.split(" "),b=0;4>b;b++){e[b]||(e[b]="*");e[b]=-1<e[b].indexOf(",")?e[b].split(","):Array(e[b]);for(var c=0;c<e[b].length;c++)if(-1<e[b][c].indexOf("-")){var d=e[b][c].match(/^([0-9]+)\-([0-9]+)/);if(null!==d){for(var f=ya(d[1]);f<=ya(d[2]);f++)-1==a.inArray(f,e[b])&&e[b].push(f+"");e[b].splice(c,1)}}for(c=0;c<e[b].length;c++)e[b][c]=isNaN(ya(e[b][c]))?e[b][c]:ya(e[b][c])}0===Ca?Y.push(e):
ea.push(e)});E=new Date;var Ga=C.settings.reference_date?C.settings.reference_date:W.data("zdp_reference_date")&&void 0!==W.data("zdp_reference_date")?W.data("zdp_reference_date"):E,wa,pa;Z=N=void 0;x=Ga.getMonth();w=E.getMonth();z=Ga.getFullYear();y=E.getFullYear();D=Ga.getDate();A=E.getDate();if(!0===C.settings.direction)N=Ga;else if(!1===C.settings.direction)Z=Ga,H=Z.getMonth(),K=Z.getFullYear(),S=Z.getDate();else if(!a.isArray(C.settings.direction)&&Ma(C.settings.direction)&&0<ya(C.settings.direction)||
a.isArray(C.settings.direction)&&((wa=Ba(C.settings.direction[0]))||!0===C.settings.direction[0]||Ma(C.settings.direction[0])&&0<C.settings.direction[0])&&((pa=Ba(C.settings.direction[1]))||!1===C.settings.direction[1]||Ma(C.settings.direction[1])&&0<=C.settings.direction[1]))N=wa?wa:new Date(z,x,D+(a.isArray(C.settings.direction)?ya(!0===C.settings.direction[0]?0:C.settings.direction[0]):ya(C.settings.direction))),x=N.getMonth(),z=N.getFullYear(),D=N.getDate(),pa&&+pa>=+N?Z=pa:!pa&&!1!==C.settings.direction[1]&&
a.isArray(C.settings.direction)&&(Z=new Date(z,x,D+ya(C.settings.direction[1]))),Z&&(H=Z.getMonth(),K=Z.getFullYear(),S=Z.getDate());else if(!a.isArray(C.settings.direction)&&Ma(C.settings.direction)&&0>ya(C.settings.direction)||a.isArray(C.settings.direction)&&(!1===C.settings.direction[0]||Ma(C.settings.direction[0])&&0>C.settings.direction[0])&&((wa=Ba(C.settings.direction[1]))||Ma(C.settings.direction[1])&&0<=C.settings.direction[1]))Z=new Date(z,x,D+(a.isArray(C.settings.direction)?ya(!1===C.settings.direction[0]?
0:C.settings.direction[0]):ya(C.settings.direction))),H=Z.getMonth(),K=Z.getFullYear(),S=Z.getDate(),wa&&+wa<+Z?N=wa:!wa&&a.isArray(C.settings.direction)&&(N=new Date(K,H,S-ya(C.settings.direction[1]))),N&&(x=N.getMonth(),z=N.getFullYear(),D=N.getDate());else if(a.isArray(C.settings.disabled_dates)&&0<C.settings.disabled_dates.length)for(var ua in Y)if("*"==Y[ua][0]&&"*"==Y[ua][1]&&"*"==Y[ua][2]&&"*"==Y[ua][3]){var ba=[];a.each(ea,function(){"*"!=this[2][0]&&ba.push(parseInt(this[2][0]+("*"==this[1][0]?
"12":u(this[1][0],2))+("*"==this[0][0]?"*"==this[1][0]?"31":(new Date(this[2][0],this[1][0],0)).getDate():u(this[0][0],2)),10))});ba.sort();if(0<ba.length){var Sa=(ba[0]+"").match(/([0-9]{4})([0-9]{2})([0-9]{2})/);z=parseInt(Sa[1],10);x=parseInt(Sa[2],10)-1;D=parseInt(Sa[3],10)}break}if(Da(z,x,D)){for(;Da(z);)N?(z++,x=0):(z--,x=11);for(;Da(z,x);)N?(x++,D=1):(x--,D=(new Date(z,x+1,0)).getDate()),11<x?(z++,x=0,D=1):0>x&&(z--,x=11,D=(new Date(z,x+1,0)).getDate());for(;Da(z,x,D);)N?D++:D--,E=new Date(z,
x,D),z=E.getFullYear(),x=E.getMonth(),D=E.getDate();E=new Date(z,x,D);z=E.getFullYear();x=E.getMonth();D=E.getDate()}(wa=Ba(W.val()||(C.settings.start_date?C.settings.start_date:"")))&&C.settings.strict&&Da(wa.getFullYear(),wa.getMonth(),wa.getDate())&&W.val("");mb(wa);C.settings.always_visible||(b||(C.settings.show_icon?("firefox"==La.name&&W.is('input[type="text"]')&&"inline"==W.css("display")&&W.css("display","inline-block"),pa=jQuery('<span class="Zebra_DatePicker_Icon_Wrapper"></span>').css({display:W.css("display"),
position:"static"==W.css("position")?"relative":W.css("position"),"float":W.css("float"),top:W.css("top"),right:W.css("right"),bottom:W.css("bottom"),left:W.css("left")}),W.wrap(pa).css({position:"relative",top:"auto",right:"auto",bottom:"auto",left:"auto"}),m=jQuery('<button type="button" class="Zebra_DatePicker_Icon'+("disabled"==W.attr("disabled")?" Zebra_DatePicker_Icon_Disabled":"")+'">Pick a date</button>'),C.icon=m,sa=m.add(W)):sa=W,sa.bind("click",function(e){e.preventDefault();W.attr("disabled")||
("none"!=g.css("display")?C.hide():C.show())}),void 0!==m&&m.insertAfter(W)),void 0!==m&&(m.attr("style",""),C.settings.inside&&m.addClass("Zebra_DatePicker_Icon_Inside")));wa=wa||C.settings.start_date||new Date;fa=wa.getDay();B=wa.getMonth();G=wa.getYear();L=wa.getHours();J=wa.getMinutes();P=wa.getSeconds();R=!1!==C.settings.show_select_today&&-1<a.inArray("days",I)&&!Da(y,w,A)?C.settings.show_select_today:!1;b||(a(window).bind("resize",ka),b='<div class="Zebra_DatePicker"><table class="dp_header"><tr><td class="dp_previous">'+
C.settings.header_navigation[0]+'</td><td class="dp_caption">&#032;</td><td class="dp_next">'+C.settings.header_navigation[1]+'</td></tr></table><table class="dp_daypicker"></table><div class="dp_timepicker"><div class="dp_timepicker_hour_block"><div class="dp_caption dp_timepicker_hour_label">'+a.i18n.prop("hour")+'</div><div class="dp_timepicker_hour"><input value="0"></div></div><div class="dp_timepicker_minute_block"><div class="dp_caption dp_timepicker_minute_label">'+a.i18n.prop("minute")+'</div><div class="dp_timepicker_minute"><input value="0"></div></div><div class="dp_timepicker_second_block"><div class="dp_caption dp_timepicker_second_label">'+
a.i18n.prop("second")+'</div><div class="dp_timepicker_second"><input value="0"></div></div><table class="dp_timepicker_done"><tbody><tr><td class="dp_timepicker_done" style="width: 100%">'+a.i18n.prop("done")+'</td></tr></tbody></table></div><table class="dp_monthpicker"></table><table class="dp_yearpicker"></table><table class="dp_footer"><tr><td class="dp_today"'+(!1!==C.settings.show_clear_date?' style="width:50%"':"")+">"+R+'</td><td class="dp_clear"'+(!1!==R?' style="width:50%"':"")+">"+C.settings.lang_clear_date+
"</td></tr></table></div>",g=a(b),C.datepicker=g,l=a("table.dp_header",g),n=a("table.dp_daypicker",g),q=a(".dp_timepicker",g),e=a("table.dp_monthpicker",g),p=a("table.dp_yearpicker",g),Q=a("table.dp_footer",g),ma=a("td.dp_today",Q),t=a("td.dp_clear",Q),C.settings.always_visible?W.attr("disabled")||(C.settings.always_visible.append(g),C.show()):a("body").append(g),g.delegate("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked, .dp_week_number)","mouseover",function(){a(this).addClass("dp_hover")}).delegate("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked, .dp_week_number)",
"mouseout",function(){a(this).removeClass("dp_hover")}),ca(a("td",l)),a(".dp_previous",l).bind("click",function(){a(this).hasClass("dp_blocked")||("months"==f?G--:"years"==f?G-=12:0>--B&&(B=11,G--),Ka())}),a(".dp_caption",l).bind("click",function(){f="days"==f?-1<a.inArray("months",I)?"months":-1<a.inArray("years",I)?"years":"days":"months"==f?-1<a.inArray("years",I)?"years":-1<a.inArray("days",I)?"days":"months":-1<a.inArray("days",I)?"days":-1<a.inArray("months",I)?"months":"years";Ka()}),a(".dp_next",
l).bind("click",function(){a(this).hasClass("dp_blocked")||("months"==f?G++:"years"==f?G+=12:12==++B&&(B=0,G++),Ka())}),n.delegate("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_week_number)","click",function(){C.settings.select_other_months&&null!==(Sa=a(this).attr("class").match(/date\_([0-9]{4})(0[1-9]|1[012])(0[1-9]|[12][0-9]|3[01])/))?ab(Sa[1],Sa[2]-1,Sa[3],"days",a(this)):ab(G,B,ya(a(this).html()),"days",a(this))}),e.delegate("td:not(.dp_disabled)","click",function(){var e=
a(this).attr("class").match(/dp\_month\_([0-9]+)/);B=ya(e[1]);-1==a.inArray("days",I)?ab(G,B,1,"months",a(this)):(f="days",C.settings.always_visible&&W.val(""),Ka())}),p.delegate("td:not(.dp_disabled)","click",function(){G=ya(a(this).html());-1==a.inArray("months",I)?ab(G,1,1,"years",a(this)):(f="months",C.settings.always_visible&&W.val(""),Ka())}),a(ma).bind("click",function(e){e.preventDefault();ab(y,w,A,"days",a(".dp_current",n));C.settings.always_visible&&C.show();C.hide()}),a(t).bind("click",
function(e){e.preventDefault();W.val("").trigger("change");C.settings.always_visible?(V=M=da=null,a("td.dp_selected",g).removeClass("dp_selected")):fa=G=B=V=M=da=null;C.hide();if(C.settings.onClear&&"function"==typeof C.settings.onClear)C.settings.onClear(W)}),C.settings.always_visible||a(document).bind({mousedown:eb,keyup:Ea}),Ka())};C.destroy=function(){void 0!==C.icon&&C.icon.remove();C.datepicker.remove();a(document).unbind("keyup",Ea);a(document).unbind("mousedown",eb);a(window).unbind("resize",
ka);W.removeData("Zebra_DatePicker")};C.hide=function(){C.settings.always_visible||(Ga("hide"),g.hide())};C.show=function(){f=C.settings.view;var e=Ba(W.val()||(C.settings.start_date?C.settings.start_date:""));e?(B=M=e.getMonth(),G=V=e.getFullYear(),fa=da=e.getDate(),Da(V,M,da)&&(C.settings.strict&&W.val(""),B=x,G=z)):(B=x,G=z);Ka();if(C.settings.always_visible)g.show();else{e=g.outerWidth();var b=g.outerHeight(),c=(void 0!==m?m.offset().left+m.outerWidth(!0):W.offset().left+W.outerWidth(!0))+C.settings.offset[0],
d=(void 0!==m?m.offset().top:W.offset().top)-b+C.settings.offset[1],p=a(window).width(),l=a(window).height(),t=a(window).scrollTop(),n=a(window).scrollLeft();c+e>n+p&&(c=n+p-e);c<n&&(c=n);d+b>t+l&&(d=t+l-b);d<t&&(d=t);g.css({left:c,top:d});g.fadeIn("explorer"==La.name&&9>La.version?0:150,"linear");Ga()}};C.update=function(e){C.original_direction&&(C.original_direction=C.direction);C.settings=a.extend(C.settings,e);O(!0)};var Ba=function(e){e=a.trim(e);if(""==e)return!1;var b=C.settings.format;if(C.settings.time){var c=
C.settings.time;!0===C.settings.time&&(c="HH:mm:ss");b+=" "+c}return Date.parseExact(e,b)||!1},ca=function(e){"firefox"==La.name?e.css("MozUserSelect","none"):"explorer"==La.name?e.bind("selectstart",function(){return!1}):e.mousedown(function(){return!1})},Ja=function(){C.settings.time&&(q.find(".dp_timepicker_hour input").slider({from:0,to:23,step:1,callback:function(e){L=e}}).slider("value",L),!1!==C.settings.show_minute&&(q.find(".dp_timepicker_minute input").slider({from:0,to:59,step:1,callback:function(e){J=
e}}).slider("value",J),!1!==C.settings.show_second&&(q.find(".dp_timepicker_second input").slider({from:0,to:59,step:1,callback:function(e){P=e}}).slider("value",P),q.find(".dp_timepicker_done").click(function(){ab(G,B)}))))},qa=function(){var e=(new Date(G,B+1,0)).getDate(),b=(new Date(G,B,1)).getDay(),c=(new Date(G,B,0)).getDate();b-=C.settings.first_day_of_week;b=0>b?7+b:b;ia(C.settings.months[B]+", "+G);var d="<tr>";C.settings.show_week_number&&(d+="<th>"+C.settings.show_week_number+"</th>");
for(var f=0;7>f;f++)d+="<th>"+(a.isArray(C.settings.days_abbr)&&void 0!==C.settings.days_abbr[(C.settings.first_day_of_week+f)%7]?C.settings.days_abbr[(C.settings.first_day_of_week+f)%7]:C.settings.days[(C.settings.first_day_of_week+f)%7].substr(0,2))+"</th>";d+="</tr><tr>";for(f=0;42>f;f++){0<f&&0===f%7&&(d+="</tr><tr>");if(0===f%7&&C.settings.show_week_number){var p=new Date(G,B,f-b+1);var l=p.getFullYear();var g=p.getMonth()+1;var m=p.getDate();if(3>g){var t=l-1;var q=(t/4|0)-(t/100|0)+(t/400|
0);l=q-(((t-1)/4|0)-((t-1)/100|0)+((t-1)/400|0));p=0;g=m-1+31*(g-1)}else t=l,q=(t/4|0)-(t/100|0)+(t/400|0),l=q-(((t-1)/4|0)-((t-1)/100|0)+((t-1)/400|0)),p=l+1,g=m+((153*(g-3)+2)/5|0)+58+l;q=(t+q)%7;p=g+3-(g+q-p)%7;d+='<td class="dp_week_number">'+(0>p?53-((q-l)/5|0):p>364+l?1:(p/7|0)+1)+"</td>"}l=f-b+1;if(C.settings.select_other_months&&(f<b||l>e)){var x=new Date(G,B,l),z=x.getFullYear(),D=x.getMonth(),K=x.getDate();x=z+u(D+1,2)+u(K,2)}f<b?d+='<td class="'+(C.settings.select_other_months&&!Da(z,D,
K)?"dp_not_in_month_selectable date_"+x:"dp_not_in_month")+'">'+(C.settings.select_other_months||C.settings.show_other_months?u(c-b+f+1,C.settings.zero_pad?2:0):"&nbsp;")+"</td>":l>e?d+='<td class="'+(C.settings.select_other_months&&!Da(z,D,K)?"dp_not_in_month_selectable date_"+x:"dp_not_in_month")+'">'+(C.settings.select_other_months||C.settings.show_other_months?u(l-e,C.settings.zero_pad?2:0):"&nbsp;")+"</td>":(p=(C.settings.first_day_of_week+f)%7,g="",Da(G,B,l)?(g=-1<a.inArray(p,C.settings.weekend_days)?
"dp_weekend_disabled":g+" dp_disabled",B==w&&G==y&&A==l&&(g+=" dp_disabled_current")):(-1<a.inArray(p,C.settings.weekend_days)&&(g="dp_weekend"),B==M&&G==V&&da==l&&(g+=" dp_selected"),B==w&&G==y&&A==l&&(g+=" dp_current")),d+="<td"+(""!==g?' class="'+a.trim(g)+'"':"")+">"+(C.settings.zero_pad?u(l,2):l)+"</td>")}n.html(a(d+"</tr>"));C.settings.always_visible&&(E=a("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked, .dp_week_number)",n));n.show()},Ua=function(){ia(G);for(var b=
"<tr>",c=0;12>c;c++){0<c&&0===c%3&&(b+="</tr><tr>");var d="dp_month_"+c;Da(G,c)?d+=" dp_disabled":!1!==M&&M==c?d+=" dp_selected":w==c&&y==G&&(d+=" dp_current");b+='<td class="'+a.trim(d)+'">'+(a.isArray(C.settings.months_abbr)&&void 0!==C.settings.months_abbr[c]?C.settings.months_abbr[c]:C.settings.months[c].substr(0,3))+"</td>"}e.html(a(b+"</tr>"));C.settings.always_visible&&(ra=a("td:not(.dp_disabled)",e));e.show()},Ca=function(){ia(G-7+" - "+(G+4));for(var e="<tr>",b=0;12>b;b++){0<b&&0===b%3&&
(e+="</tr><tr>");var c="";Da(G-7+b)?c+=" dp_disabled":V&&V==G-7+b?c+=" dp_selected":y==G-7+b&&(c+=" dp_current");e+="<td"+(""!==a.trim(c)?' class="'+a.trim(c)+'"':"")+">"+(G-7+b)+"</td>"}p.html(a(e+"</tr>"));C.settings.always_visible&&(X=a("td:not(.dp_disabled)",p));p.show()},Ga=function(e){if("explorer"==La.name&&6==La.version){if(!pa){var b=ya(g.css("zIndex"))-1;pa=jQuery("<iframe>",{src:'javascript:document.write("")',scrolling:"no",frameborder:0,allowtransparency:"true",css:{zIndex:b,position:"absolute",
top:-1E3,left:-1E3,width:g.outerWidth(),height:g.outerHeight(),filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)",display:"none"}});a("body").append(pa)}switch(e){case "hide":pa.hide();break;default:e=g.offset(),pa.css({top:e.top,left:e.left,display:"block"})}}},Da=function(e,b,c){if((void 0===e||isNaN(e))&&(void 0===b||isNaN(b))&&(void 0===c||isNaN(c)))return!1;if(a.isArray(C.settings.direction)||0!==ya(C.settings.direction)){var d=ya(oa(e,"undefined"!=typeof b?u(b,2):"","undefined"!=typeof c?
u(c,2):"")),f=(d+"").length;if(8==f&&("undefined"!=typeof N&&d<ya(oa(z,u(x,2),u(D,2)))||"undefined"!=typeof Z&&d>ya(oa(K,u(H,2),u(S,2))))||6==f&&("undefined"!=typeof N&&d<ya(oa(z,u(x,2)))||"undefined"!=typeof Z&&d>ya(oa(K,u(H,2))))||4==f&&("undefined"!=typeof N&&d<z||"undefined"!=typeof Z&&d>K))return!0}"undefined"!=typeof b&&(b+=1);var p=!1,l=!1;Y&&a.each(Y,function(){if(!p&&(-1<a.inArray(e,this[2])||-1<a.inArray("*",this[2]))&&("undefined"!=typeof b&&-1<a.inArray(b,this[1])||-1<a.inArray("*",this[1]))&&
("undefined"!=typeof c&&-1<a.inArray(c,this[0])||-1<a.inArray("*",this[0]))){if("*"==this[3])return p=!0;var d=(new Date(e,b-1,c)).getDay();if(-1<a.inArray(d,this[3]))return p=!0}});ea&&a.each(ea,function(){if(!l&&(-1<a.inArray(e,this[2])||-1<a.inArray("*",this[2]))&&(l=!0,"undefined"!=typeof b))if(l=!0,-1<a.inArray(b,this[1])||-1<a.inArray("*",this[1])){if("undefined"!=typeof c){l=!0;if(-1<a.inArray(c,this[0])||-1<a.inArray("*",this[0])){if("*"==this[3])return l=!0;var d=(new Date(e,b-1,c)).getDay();
if(-1<a.inArray(d,this[3]))return l=!0}l=!1}}else l=!1});return ea&&l||!Y||!p?!1:!0},Ma=function(e){return(e+"").match(/^\-?[0-9]+$/)?!0:!1},ia=function(e){a(".dp_caption",l).html(e);if(a.isArray(C.settings.direction)||0!==ya(C.settings.direction)||1==I.length&&"months"==I[0]){e=G;var b=B;if("days"==f){var c=!Da(0>b-1?oa(e-1,"11"):oa(e,u(b-1,2)));var d=!Da(11<b+1?oa(e+1,"00"):oa(e,u(b+1,2)))}else if("months"==f){if(!N||N.getFullYear()<=e-1)c=!0;if(!Z||Z.getFullYear()>=e+1)d=!0}else if("years"==f){if(!N||
N.getFullYear()<e-7)c=!0;if(!Z||Z.getFullYear()>e+4)d=!0}c?a(".dp_previous",l).removeClass("dp_blocked"):(a(".dp_previous",l).addClass("dp_blocked"),a(".dp_previous",l).removeClass("dp_hover"));d?a(".dp_next",l).removeClass("dp_blocked"):(a(".dp_next",l).addClass("dp_blocked"),a(".dp_next",l).removeClass("dp_hover"))}},Ka=function(){if(""===n.text()||"days"==f){if(""===n.text()){C.settings.always_visible||g.css("left",-1E3);g.show();qa();Ja();var b=n.outerWidth(),c=n.outerHeight();e.css({width:b,
height:c});p.css({width:b,height:c});l.css("width",b);q.css("width",b);Q.css("width",b);g.hide()}else qa();C.settings.time||q.hide();e.hide();p.hide()}else"months"==f?(Ua(),n.hide(),q.hide(),p.hide()):"years"==f&&(Ca(),n.hide(),q.hide(),e.hide());C.settings.onChange&&"function"==typeof C.settings.onChange&&void 0!==f&&(b="days"==f?n.find("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked)"):"months"==f?e.find("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked)"):
p.find("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked)"),b.each(function(){if("days"==f)if(a(this).hasClass("dp_not_in_month_selectable")){var e=a(this).attr("class").match(/date\_([0-9]{4})(0[1-9]|1[012])(0[1-9]|[12][0-9]|3[01])/);a(this).data("date",e[1]+"-"+e[2]+"-"+e[3])}else a(this).data("date",G+"-"+u(B+1,2)+"-"+u(ya(a(this).text()),2));else"months"==f?(e=a(this).attr("class").match(/dp\_month\_([0-9]+)/),a(this).data("date",G+"-"+u(ya(e[1])+1,2))):a(this).data("date",
ya(a(this).text()))}),C.settings.onChange(f,b,W));Q.show();!0===C.settings.show_clear_date||0===C.settings.show_clear_date&&""!==W.val()||C.settings.always_visible&&!1!==C.settings.show_clear_date?(t.show(),R?(ma.css("width","50%"),t.css("width","50%")):(ma.hide(),t.css("width","100%"))):(t.hide(),R?ma.show().css("width","100%"):Q.hide())},ab=function(e,a,b,c,d){var f=new Date(e,a,b||fa,L,J,P);var p=C.settings.format;if(C.settings.time){var l=C.settings.time;!0===C.settings.time&&(l="HH:mm:ss");p+=
" "+l}p=f.toString(p);W.val(p).trigger("change");c&&(l="days"==c?E:"months"==c?ra:X,C.settings.always_visible&&(M=f.getMonth(),B=f.getMonth(),V=f.getFullYear(),G=f.getFullYear(),da=f.getDate(),l.removeClass("dp_selected"),d.addClass("dp_selected"),"days"==c&&d.hasClass("dp_not_in_month_selectable")&&C.show()));C.hide();mb(f);if(C.settings.onSelect&&"function"==typeof C.settings.onSelect)C.settings.onSelect(p,e+"-"+u(a+1,2)+"-"+u(b,2),f,W);W.focus()},oa=function(){for(var e="",a=0;a<arguments.length;a++)e+=
arguments[a]+"";return e},u=function(e,a){for(e+="";e.length<a;)e="0"+e;return e},ya=function(e){return parseInt(e,10)},mb=function(e){C.settings.pair&&a.each(C.settings.pair,function(){var b=a(this);if(b.data&&b.data("Zebra_DatePicker")){var c=b.data("Zebra_DatePicker");c.update({reference_date:e,direction:0===c.settings.direction?1:c.settings.direction});c.settings.always_visible&&c.show()}else b.data("zdp_reference_date",e);b.val()&&e&&new Date(b.val())<e&&b.val("")})},Ea=function(e){"block"!=
g.css("display")&&27!=e.which||C.hide()},eb=function(e){if("block"==g.css("display")){if(C.settings.show_icon&&a(e.target).get(0)===m.get(0))return!0;0===a(e.target).parents().filter(".Zebra_DatePicker").length&&C.hide()}},ka=function(){C.hide();void 0!==m&&(clearTimeout(ua),ua=setTimeout(function(){C.update()},100))},La={init:function(){this.name=this.searchString(this.dataBrowser)||"";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||""},searchString:function(e){for(var a=
0;a<e.length;a++){var b=e[a].string,c=e[a].prop;this.versionSearchString=e[a].versionSearch||e[a].identity;if(b){if(-1!=b.indexOf(e[a].subString))return e[a].identity}else if(c)return e[a].identity}},searchVersion:function(e){var a=e.indexOf(this.versionSearchString);if(-1!=a)return parseFloat(e.substring(a+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Firefox",identity:"firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"explorer",versionSearch:"MSIE"}]};
La.init();O()};a.fn.date=function(b){return this.each(function(){void 0!==a(this).data("Zebra_DatePicker")&&a(this).data("Zebra_DatePicker").destroy();var d=new a.Zebra_DatePicker(this,b);a(this).data("Zebra_DatePicker",d)})}})(jQuery);
var Hashtable=function(){function a(e){var b;if("string"==typeof e)return e;if(typeof e.hashCode==q)return b=e.hashCode(),"string"==typeof b?b:a(b);if(typeof e.toString==q)return e.toString();try{return String(e)}catch(D){return Object.prototype.toString.call(e)}}function b(e,a){return e.equals(a)}function d(e,a){return typeof a.equals==q?a.equals(e):e===a}function c(e){return function(a){if(null===a)throw Error("null is not a valid "+e);if("undefined"==typeof a)throw Error(e+" must not be undefined");
}}function f(e,a,b,c){this[0]=e;this.entries=[];this.addEntry(a,b);null!==c&&(this.getEqualityFunction=function(){return c})}function g(e){return function(a){for(var b=this.entries.length,c,d=this.getEqualityFunction(a);b--;)if(c=this.entries[b],d(a,c[0]))switch(e){case w:return!0;case y:return c;case A:return[b,c[1]]}return!1}}function m(e){return function(a){for(var b=a.length,c=0,d=this.entries.length;c<d;++c)a[b+c]=this.entries[c][e]}}function l(e,a){return(e=e[a])&&e instanceof f?e:null}function n(b,
c){var d=this,g=[],m={},w=typeof b==q?b:a,y=typeof c==q?c:null;this.put=function(e,a){p(e);t(a);var b=w(e),c,d,n=null;return c=l(m,b),c?(d=c.getEntryForKey(e),d?(n=d[1],d[1]=a):c.addEntry(e,a)):(c=new f(b,e,a,y),g[g.length]=c,m[b]=c),n};this.get=function(e){p(e);var a=w(e);if(a=l(m,a))if(e=a.getEntryForKey(e))return e[1];return null};this.containsKey=function(e){p(e);var a=w(e);return(a=l(m,a))?a.containsKey(e):!1};this.containsValue=function(e){t(e);for(var a=g.length;a--;)if(g[a].containsValue(e))return!0;
return!1};this.clear=function(){g.length=0;m={}};this.isEmpty=function(){return!g.length};var x=function(e){return function(){for(var a=[],b=g.length;b--;)g[b][e](a);return a}};this.keys=x("keys");this.values=x("values");this.entries=x("getEntries");this.remove=function(a){p(a);var b=w(a),c=null,d=l(m,b);if(d&&(c=d.removeEntryForKey(a),null!==c&&!d.entries.length)){a:{for(a=g.length;a--;)if(d=g[a],b===d[0])break a;a=null}e(g,a);delete m[b]}return c};this.size=function(){for(var e=0,a=g.length;a--;)e+=
g[a].entries.length;return e};this.each=function(e){for(var a=d.entries(),b=a.length,c;b--;)c=a[b],e(c[0],c[1])};this.putAll=function(e,a){e=e.entries();for(var b,c,f,p=e.length,l=typeof a==q;p--;)b=e[p],c=b[0],b=b[1],l&&(f=d.get(c))&&(b=a(c,f,b)),d.put(c,b)};this.clone=function(){var e=new n(b,c);return e.putAll(d),e}}var q="function",e=typeof Array.prototype.splice==q?function(e,a){e.splice(a,1)}:function(e,a){var b;if(a===e.length-1)e.length=a;else{var c=e.slice(a+1);e.length=a;var d=0;for(b=c.length;d<
b;++d)e[a+d]=c[d]}},p=c("key"),t=c("value"),w=0,y=1,A=2;return f.prototype={getEqualityFunction:function(e){return typeof e.equals==q?b:d},getEntryForKey:g(y),getEntryAndIndexForKey:g(A),removeEntryForKey:function(a){return(a=this.getEntryAndIndexForKey(a))?(e(this.entries,a[0]),a[1]):null},addEntry:function(e,a){this.entries[this.entries.length]=[e,a]},keys:m(0),values:m(1),getEntries:function(e){for(var a=e.length,b=0,c=this.entries.length;b<c;++b)e[a+b]=this.entries[b].slice(0)},containsKey:g(w),
containsValue:function(e){for(var a=this.entries.length;a--;)if(e===this.entries[a][1])return!0;return!1}},n}();
(function(a){function b(a,b,c){this.dec=a;this.group=b;this.neg=c}function d(a,d){if(0==c.size())for(var l=0;l<g.length;l++){localeGroup=g[l];for(var m=0;m<localeGroup.length;m++)c.put(localeGroup[m],l)}l=".";m=",";0==d&&(-1!=a.indexOf("_")?a=a.split("_")[1].toLowerCase():-1!=a.indexOf("-")&&(a=a.split("-")[1].toLowerCase()));(a=c.get(a))&&(a=f[a])&&(l=a[0],m=a[1]);return new b(l,m,"-")}var c=new Hashtable,f=[[".",","],[",","."],[","," "],[".","'"]],g=["ae au ca cn eg gb hk il in jp sk th tw us".split(" "),
"at br de dk es gr it nl pt tr vn".split(" "),"cz fi fr ru se pl".split(" "),["ch"]];a.fn.formatNumber=function(b,c,d){return this.each(function(){null==c&&(c=!0);null==d&&(d=!0);var f;a(this).is(":input")?f=new String(a(this).val()):f=new String(a(this).text());f=a.formatNumber(f,b);c&&(a(this).is(":input")?a(this).val(f):a(this).text(f));if(d)return f})};a.formatNumber=function(b,c){c=a.extend({},a.fn.formatNumber.defaults,c);d(c.locale.toLowerCase(),c.isFullLocale);for(var f="",g=!1,e=0;e<c.format.length;e++){if(-1!=
"0#-,.".indexOf(c.format.charAt(e))){if(0==e&&"-"==c.format.charAt(e)){g=!0;continue}break}f+=c.format.charAt(e)}var p="";for(e=c.format.length-1;0<=e&&-1=="0#-,.".indexOf(c.format.charAt(e));e--)p=c.format.charAt(e)+p;c.format=c.format.substring(f.length);c.format=c.format.substring(0,c.format.length-p.length);b=new Number(b);return a._formatNumber(b,c,p,f,g)};a._formatNumber=function(b,c,f,g,e){c=a.extend({},a.fn.formatNumber.defaults,c);var p=d(c.locale.toLowerCase(),c.isFullLocale),l=p.dec,m=
p.group;p=p.neg;var n=!1;if(isNaN(b)){if(1!=c.nanForceZero)return null;b=0;n=!0}"%"==f&&(b*=100);var q="";if(-1<c.format.indexOf(".")){var x=l,z=c.format.substring(c.format.lastIndexOf(".")+1);1==c.round?b=new Number(b.toFixed(z.length)):(b=b.toString(),b=b.substring(0,b.lastIndexOf(".")+z.length+1),b=new Number(b));var D=new String((b%1).toFixed(z.length));D=D.substring(D.lastIndexOf(".")+1);for(var B=0;B<z.length;B++)if("#"==z.charAt(B)&&"0"!=D.charAt(B))x+=D.charAt(B);else{if("#"==z.charAt(B)&&
"0"==D.charAt(B)){if(D.substring(B).match("[1-9]")){x+=D.charAt(B);continue}break}"0"==z.charAt(B)&&(x+=D.charAt(B))}q+=x}else b=Math.round(b);B=Math.floor(b);0>b&&(B=Math.ceil(b));x="";-1==c.format.indexOf(".")?x=c.format:x=c.format.substring(0,c.format.indexOf("."));z="";if(0!=B||"#"!=x.substr(x.length-1)||n){n=new String(Math.abs(B));D=9999;-1!=x.lastIndexOf(",")&&(D=x.length-x.lastIndexOf(",")-1);var G=0;for(B=n.length-1;-1<B;B--)z=n.charAt(B)+z,G++,G==D&&0!=B&&(z=m+z,G=0);if(x.length>z.length&&
(B=x.indexOf("0"),-1!=B))for(B=x.length-B,n=x.length-z.length-1;z.length<B;)D=x.charAt(n),","==D&&(D=m),z=D+z,n--}return!z&&-1!==x.indexOf("0",x.length-1)&&(z="0"),q=z+q,0>b&&e&&0<g.length?g=p+g:0>b&&(q=p+q),c.decimalSeparatorAlwaysShown||q.lastIndexOf(l)==q.length-1&&(q=q.substring(0,q.length-1)),q=g+q+f,q};a.fn.parseNumber=function(b,c,d){null==c&&(c=!0);null==d&&(d=!0);var f;a(this).is(":input")?f=new String(a(this).val()):f=new String(a(this).text());if(b=a.parseNumber(f,b))if(c&&(a(this).is(":input")?
a(this).val(b.toString()):a(this).text(b.toString())),d)return b};a.parseNumber=function(b,c){c=a.extend({},a.fn.parseNumber.defaults,c);var f=d(c.locale.toLowerCase(),c.isFullLocale),g=f.dec,e=f.group;for(f=f.neg;-1<b.indexOf(e);)b=b.replace(e,"");b=b.replace(g,".").replace(f,"-");g="";e=!1;if("%"==b.charAt(b.length-1)||1==c.isPercentage)e=!0;for(c=0;c<b.length;c++)-1<"1234567890.-".indexOf(b.charAt(c))&&(g+=b.charAt(c));b=new Number(g);e&&(b/=100,c=g.indexOf("."),b=-1!=c?b.toFixed(g.length-c-1+
2):b.toFixed(g.length-1));return b};a.fn.parseNumber.defaults={locale:"us",decimalSeparatorAlwaysShown:!1,isPercentage:!1,isFullLocale:!1};a.fn.formatNumber.defaults={format:"#,###.00",locale:"us",decimalSeparatorAlwaysShown:!1,nanForceZero:!0,round:!0,isFullLocale:!1};Number.prototype.toFixed=function(b){return a._roundNumber(this,b)};a._roundNumber=function(a,b){var c=Math.pow(10,b||0);a=String(Math.round(a*c)/c);if(0<b)for(c=a.indexOf("."),-1==c?(a+=".",c=0):c=a.length-(c+1);c<b;)a+="0",c++;return a}})(jQuery);
(function(){var a={};this.tmpl=function f(d,c){d=/\W/.test(d)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+d.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):a[d]=a[d]||f(document.getElementById(d).innerHTML);return c?d(c):d}})();
(function(a){a.baseClass=function(b){return b=a(b),b.get(0).className.match(/([^ ]+)/)[1]};a.fn.addDependClass=function(b,d){var c=d?d:"-";return this.each(function(){var d=a.baseClass(this);d&&a(this).addClass(d+c+b)})};a.fn.removeDependClass=function(b,d){var c=d?d:"-";return this.each(function(){var d=a.baseClass(this);d&&a(this).removeClass(d+c+b)})};a.fn.toggleDependClass=function(b,d){var c=d?d:"-";return this.each(function(){var d=a.baseClass(this);d&&(a(this).is("."+d+c+b)?a(this).removeClass(d+
c+b):a(this).addClass(d+c+b))})}})(jQuery);
(function(a){function b(){this._init.apply(this,arguments)}b.prototype.oninit=function(){};b.prototype.events=function(){};b.prototype.onmousedown=function(){this.ptr.css({position:"absolute"})};b.prototype.onmousemove=function(a,b,f){this.ptr.css({left:b,top:f})};b.prototype.onmouseup=function(){};b.prototype.isDefault={drag:!1,clicked:!1,toclick:!0,mouseup:!1};b.prototype._init=function(){if(0<arguments.length){this.ptr=a(arguments[0]);this.outer=a(".draggable-outer");this.is={};a.extend(this.is,
this.isDefault);var b=this.ptr.offset();this.d={left:b.left,top:b.top,width:this.ptr.width(),height:this.ptr.height()};this.oninit.apply(this,arguments);this._events()}};b.prototype._getPageCoords=function(a){return a.targetTouches&&a.targetTouches[0]?{x:a.targetTouches[0].pageX,y:a.targetTouches[0].pageY}:{x:a.pageX,y:a.pageY}};b.prototype._bindEvent=function(a,b,f){this.supportTouches_?a.get(0).addEventListener(this.events_[b],f,!1):a.bind(this.events_[b],f)};b.prototype._events=function(){var b=
this;this.supportTouches_=browser.gc&&-1!=navigator.userAgent.indexOf("Mobile");this.events_={click:this.supportTouches_?"touchstart":"click",down:this.supportTouches_?"touchstart":"mousedown",move:this.supportTouches_?"touchmove":"mousemove",up:this.supportTouches_?"touchend":"mouseup"};this._bindEvent(a(document),"move",function(a){b.is.drag&&(a.stopPropagation(),a.preventDefault(),b._mousemove(a))});this._bindEvent(a(document),"down",function(a){b.is.drag&&(a.stopPropagation(),a.preventDefault())});
this._bindEvent(a(document),"up",function(a){b._mouseup(a)});this._bindEvent(this.ptr,"down",function(a){return b._mousedown(a),!1});this._bindEvent(this.ptr,"up",function(a){b._mouseup(a)});this.ptr.find("a").click(function(){b.is.clicked=!0;if(!b.is.toclick)return b.is.toclick=!0,!1}).mousedown(function(a){return b._mousedown(a),!1});this.events()};b.prototype._mousedown=function(b){this.is.drag=!0;this.is.clicked=!1;this.is.mouseup=!1;var c=this.ptr.offset(),d=this._getPageCoords(b);this.cx=d.x-
c.left;this.cy=d.y-c.top;a.extend(this.d,{left:c.left,top:c.top,width:this.ptr.width(),height:this.ptr.height()});this.outer&&this.outer.get(0)&&this.outer.css({height:Math.max(this.outer.height(),a(document.body).height()),overflow:"hidden"});this.onmousedown(b)};b.prototype._mousemove=function(a){this.is.toclick=!1;var b=this._getPageCoords(a);this.onmousemove(a,b.x-this.cx,b.y-this.cy)};b.prototype._mouseup=function(a){this.is.drag&&(this.is.drag=!1,this.outer&&this.outer.get(0)&&(browser.ff?this.outer.css({overflow:"hidden"}):
this.outer.css({overflow:"visible"}),browser.ie&&6==browser.version?this.outer.css({height:"100%"}):this.outer.css({height:"auto"})),this.onmouseup(a))};window.Draggable=b})(jQuery);
(function(a){function b(a){return"undefined"==typeof a?!1:a instanceof Array||!(a instanceof Object)&&"[object Array]"==Object.prototype.toString.call(a)||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice")?!0:!1}function d(){return this.init.apply(this,arguments)}function c(){Draggable.apply(this,arguments)}a.slider=function(b,c){var f=a(b);return f.data("jslider")||f.data("jslider",new d(b,c)),f.data("jslider")};
a.fn.slider=function(c,d){var f,g=arguments;return this.each(function(){var l=a.slider(this,c);if("string"==typeof c)switch(c){case "value":void 0!==g[1]&&void 0!==g[2]?(l=l.getPointers(),null!=l[0]&&null!=g[1]&&(l[0].set(g[1]),l[0].setIndexOver()),null!=l[1]&&null!=g[2]&&(l[1].set(g[2]),l[1].setIndexOver())):void 0!==g[1]?(l=l.getPointers(),null!=l[0]&&null!=g[1]&&(l[0].set(g[1]),l[0].setIndexOver())):f=l.getValue();break;case "prc":void 0!==g[1]&&void 0!==g[2]?(l=l.getPointers(),null!=l[0]&&null!=
g[1]&&(l[0]._set(g[1]),l[0].setIndexOver()),null!=l[1]&&null!=g[2]&&(l[1]._set(g[2]),l[1].setIndexOver())):void 0!==g[1]?(l=l.getPointers(),null!=l[0]&&null!=g[1]&&(l[0]._set(g[1]),l[0].setIndexOver())):f=l.getPrcValue();break;case "calculatedValue":var e=l.getValue().split(";");f="";for(var p=0;p<e.length;p++)f+=(0<p?";":"")+l.nice(e[p]);break;case "skin":l.setSkin(g[1])}else c||d||(b(f)||(f=[]),f.push(l))}),b(f)&&1==f.length&&(f=f[0]),f||this};var f={settings:{from:1,to:10,step:1,smooth:!0,limits:!0,
round:0,format:{format:"#,##0.##"},value:"5;7",dimension:""},className:"jslider",selector:".jslider-",template:tmpl('<span class="<%=className%>"><table><tr><td><div class="<%=className%>-bg"><i class="l"></i><i class="f"></i><i class="r"></i><i class="v"></i></div><div class="<%=className%>-pointer"></div><div class="<%=className%>-pointer <%=className%>-pointer-to"></div><div class="<%=className%>-label"><span><%=settings.from%></span></div><div class="<%=className%>-label <%=className%>-label-to"><span><%=settings.to%></span><%=settings.dimension%></div><div class="<%=className%>-value"><span></span><%=settings.dimension%></div><div class="<%=className%>-value <%=className%>-value-to"><span></span><%=settings.dimension%></div><div class="<%=className%>-scale"><%=scale%></div></td></tr></table></span>')};
d.prototype.init=function(b,c){this.settings=a.extend(!0,{},f.settings,c?c:{});this.inputNode=a(b).hide();this.settings.interval=this.settings.to-this.settings.from;this.settings.value=this.inputNode.attr("value");this.settings.calculate&&a.isFunction(this.settings.calculate)&&(this.nice=this.settings.calculate);this.settings.onstatechange&&a.isFunction(this.settings.onstatechange)&&(this.onstatechange=this.settings.onstatechange);this.is={init:!1};this.o={};this.create()};d.prototype.onstatechange=
function(){};d.prototype.create=function(){var b=this;this.domNode=a(f.template({className:f.className,settings:{from:this.nice(this.settings.from),to:this.nice(this.settings.to),dimension:this.settings.dimension},scale:this.generateScale()}));this.inputNode.after(this.domNode);this.drawScale();this.settings.skin&&0<this.settings.skin.length&&this.setSkin(this.settings.skin);this.sizes={domWidth:this.domNode.width(),domOffset:this.domNode.offset()};a.extend(this.o,{pointers:{},labels:{0:{o:this.domNode.find(f.selector+
"value").not(f.selector+"value-to")},1:{o:this.domNode.find(f.selector+"value").filter(f.selector+"value-to")}},limits:{0:this.domNode.find(f.selector+"label").not(f.selector+"label-to"),1:this.domNode.find(f.selector+"label").filter(f.selector+"label-to")}});a.extend(this.o.labels[0],{value:this.o.labels[0].o.find("span")});a.extend(this.o.labels[1],{value:this.o.labels[1].o.find("span")});b.settings.value.split(";")[1]||(this.settings.single=!0,this.domNode.addDependClass("single"));b.settings.limits||
this.domNode.addDependClass("limitless");this.domNode.find(f.selector+"pointer").each(function(a){var d=b.settings.value.split(";")[a];if(d){b.o.pointers[a]=new c(this,a,b);var f=b.settings.value.split(";")[a-1];f&&new Number(d)<new Number(f)&&(d=f);d=d<b.settings.from?b.settings.from:d;d=d>b.settings.to?b.settings.to:d;b.o.pointers[a].set(d,!0)}});this.o.value=this.domNode.find(".v");this.is.init=!0;a.each(this.o.pointers,function(a){b.redraw(this)});(function(b){a(window).resize(function(){b.onresize()})})(this)};
d.prototype.setSkin=function(a){this.skin_&&this.domNode.removeDependClass(this.skin_,"_");this.domNode.addDependClass(this.skin_=a,"_")};d.prototype.setPointersIndex=function(b){a.each(this.getPointers(),function(a){this.index(a)})};d.prototype.getPointers=function(){return this.o.pointers};d.prototype.generateScale=function(){if(this.settings.scale&&0<this.settings.scale.length){for(var a="",b=this.settings.scale,c=Math.round(100/(b.length-1)*10)/10,d=0;d<b.length;d++)a+='<span style="left: '+d*
c+'%">'+("|"!=b[d]?"<ins>"+b[d]+"</ins>":"")+"</span>";return a}return""};d.prototype.drawScale=function(){this.domNode.find(f.selector+"scale span ins").each(function(){a(this).css({marginLeft:-a(this).outerWidth()/2})})};d.prototype.onresize=function(){var b=this;this.sizes={domWidth:this.domNode.width(),domOffset:this.domNode.offset()};a.each(this.o.pointers,function(a){b.redraw(this)})};d.prototype.update=function(){this.onresize();this.drawScale()};d.prototype.limits=function(a,b){if(!this.settings.smooth){var c=
100*this.settings.step/this.settings.interval;a=Math.round(a/c)*c}c=this.o.pointers[1-b.uid];return c&&b.uid&&a<c.value.prc&&(a=c.value.prc),c&&!b.uid&&a>c.value.prc&&(a=c.value.prc),0>a&&(a=0),100<a&&(a=100),Math.round(10*a)/10};d.prototype.redraw=function(a){if(!this.is.init)return!1;this.setValue();this.o.pointers[0]&&this.o.pointers[1]&&this.o.value.css({left:this.o.pointers[0].value.prc+"%",width:this.o.pointers[1].value.prc-this.o.pointers[0].value.prc+"%"});this.o.labels[a.uid].value.html(this.nice(a.value.origin));
this.redrawLabels(a)};d.prototype.redrawLabels=function(a){function b(e,a,b){return a.margin=-a.label/2,label_left=a.border+a.margin,0>label_left&&(a.margin-=label_left),a.border+a.label/2>c.sizes.domWidth?(a.margin=0,a.right=!0):a.right=!1,e.o.css({left:b+"%",marginLeft:a.margin,right:"auto"}),a.right&&e.o.css({left:"auto",right:0}),a}var c=this,d=this.o.labels[a.uid],f=a.value.prc,e={label:d.o.outerWidth(),right:!1,border:f*this.sizes.domWidth/100};if(!this.settings.single){var p=this.o.pointers[1-
a.uid],g=this.o.labels[p.uid];switch(a.uid){case 0:e.border+e.label/2>g.o.offset().left-this.sizes.domOffset.left?(g.o.css({visibility:"hidden"}),g.value.html(this.nice(p.value.origin)),d.o.css({visibility:"visible"}),f=(p.value.prc-f)/2+f,p.value.prc!=a.value.prc&&(d.value.html(this.nice(a.value.origin)+"&nbsp;&ndash;&nbsp;"+this.nice(p.value.origin)),e.label=d.o.outerWidth(),e.border=f*this.sizes.domWidth/100)):g.o.css({visibility:"visible"});break;case 1:e.border-e.label/2<g.o.offset().left-this.sizes.domOffset.left+
g.o.outerWidth()?(g.o.css({visibility:"hidden"}),g.value.html(this.nice(p.value.origin)),d.o.css({visibility:"visible"}),f=(f-p.value.prc)/2+p.value.prc,p.value.prc!=a.value.prc&&(d.value.html(this.nice(p.value.origin)+"&nbsp;&ndash;&nbsp;"+this.nice(a.value.origin)),e.label=d.o.outerWidth(),e.border=f*this.sizes.domWidth/100)):g.o.css({visibility:"visible"})}}e=b(d,e,f);g&&(e={label:g.o.outerWidth(),right:!1,border:p.value.prc*this.sizes.domWidth/100},e=b(g,e,p.value.prc));this.redrawLimits()};d.prototype.redrawLimits=
function(){if(this.settings.limits){var a=[!0,!0];for(key in this.o.pointers)if(!this.settings.single||0==key){var b=this.o.labels[this.o.pointers[key].uid],c=b.o.offset().left-this.sizes.domOffset.left,d=this.o.limits[0];c<d.outerWidth()&&(a[0]=!1);d=this.o.limits[1];c+b.o.outerWidth()>this.sizes.domWidth-d.outerWidth()&&(a[1]=!1)}for(b=0;b<a.length;b++)a[b]?this.o.limits[b].fadeIn("fast"):this.o.limits[b].fadeOut("fast")}};d.prototype.setValue=function(){var a=this.getValue();this.inputNode.attr("value",
a);this.onstatechange.call(this,a)};d.prototype.getValue=function(){if(!this.is.init)return!1;var b=this,c="";return a.each(this.o.pointers,function(a){void 0!=this.value.prc&&!isNaN(this.value.prc)&&(c+=(0<a?";":"")+b.prcToValue(this.value.prc))}),c};d.prototype.getPrcValue=function(){if(!this.is.init)return!1;var b="";return a.each(this.o.pointers,function(a){void 0!=this.value.prc&&!isNaN(this.value.prc)&&(b+=(0<a?";":"")+this.value.prc)}),b};d.prototype.prcToValue=function(a){if(this.settings.heterogeneity&&
0<this.settings.heterogeneity.length)for(var b=this.settings.heterogeneity,c=0,d=this.settings.from,f=0;f<=b.length;f++){var e=b[f]?b[f].split("/"):[100,this.settings.to];e[0]=new Number(e[0]);e[1]=new Number(e[1]);if(a>=c&&a<=e[0])var p=d+(a-c)*(e[1]-d)/(e[0]-c);c=e[0];d=e[1]}else p=this.settings.from+a*this.settings.interval/100;return this.round(p)};d.prototype.valueToPrc=function(a,b){if(this.settings.heterogeneity&&0<this.settings.heterogeneity.length)for(var c=this.settings.heterogeneity,d=
0,f=this.settings.from,e=0;e<=c.length;e++){var p=c[e]?c[e].split("/"):[100,this.settings.to];p[0]=new Number(p[0]);p[1]=new Number(p[1]);if(a>=f&&a<=p[1])var g=b.limits(d+(a-f)*(p[0]-d)/(p[1]-f));d=p[0];f=p[1]}else g=b.limits(100*(a-this.settings.from)/this.settings.interval);return g};d.prototype.round=function(a){return a=Math.round(a/this.settings.step)*this.settings.step,this.settings.round?a=Math.round(a*Math.pow(10,this.settings.round))/Math.pow(10,this.settings.round):a=Math.round(a),a};d.prototype.nice=
function(b){return b=b.toString().replace(/,/gi,".").replace(/ /gi,""),a.formatNumber?a.formatNumber(new Number(b),this.settings.format||{}).replace(/-/gi,"&minus;"):new Number(b)};c.prototype=new Draggable;c.prototype.oninit=function(a,b,c){this.uid=b;this.parent=c;this.value={};this.settings=this.parent.settings};c.prototype.onmousedown=function(a){this._parent={offset:this.parent.domNode.offset(),width:this.parent.domNode.width()};this.ptr.addDependClass("hover");this.setIndexOver()};c.prototype.onmousemove=
function(a,b){a=this._getPageCoords(a);this._set(this.calc(a.x))};c.prototype.onmouseup=function(b){this.parent.settings.callback&&a.isFunction(this.parent.settings.callback)&&this.parent.settings.callback.call(this.parent,this.parent.getValue());this.ptr.removeDependClass("hover")};c.prototype.setIndexOver=function(){this.parent.setPointersIndex(1);this.index(2)};c.prototype.index=function(a){this.ptr.css({zIndex:a})};c.prototype.limits=function(a){return this.parent.limits(a,this)};c.prototype.calc=
function(a){return this.limits(100*(a-this._parent.offset.left)/this._parent.width)};c.prototype.set=function(a,b){this.value.origin=this.parent.round(a);this._set(this.parent.valueToPrc(a,this),b)};c.prototype._set=function(a,b){b||(this.value.origin=this.parent.prcToValue(a));this.value.prc=a;this.ptr.css({left:a+"%"});this.parent.redraw(this)}})(jQuery);
(function(a,b){function d(e){e=a.extend({},n,e||{});for(var b=a(this),d=0,l=b.length;d<l;d++){var g=b.eq(d),m=e;if(!g.hasClass("stepper-input")){m=a.extend({},m,g.data("stepper-options"));var q=parseFloat(g.attr("min")),z=parseFloat(g.attr("max")),D=parseFloat(g.attr("step"))||1;g.addClass("stepper-input").wrap('<div class="stepper '+m.customClass+'" />').after('<span class="stepper-arrow up">'+m.labels.up+'</span><span class="stepper-arrow down">'+m.labels.down+"</span>");var B=g.parent(".stepper");
m=a.extend({$stepper:B,$input:g,$arrow:B.find(".stepper-arrow"),min:isNaN(q)?!1:q,max:isNaN(z)?!1:z,step:isNaN(D)?1:D,timer:null,et_data:{up:{clazz:"",attr:{}},down:{clazz:"",attr:{}}}},m);m.et_data&&(q=m.et_data.up,z=m.et_data.down,B.find(".stepper-arrow.up").addClass(q.clazz).attr(q.attr),B.find(".stepper-arrow.down").addClass(z.clazz).attr(z.attr));q=String(m.step);q=-1<q.indexOf(".")?q.length-q.indexOf(".")-1:0;m.digits=q;g.is(":disabled")&&B.addClass("disabled");B.on("keypress",".stepper-input",
m,c);B.on("touchstart.stepper mousedown.stepper",".stepper-arrow",m,f);g.data("stepper",m)}}return b}function c(e){var a=e.data;if(38===e.keyCode||40===e.keyCode)e.preventDefault(),m(a,38===e.keyCode?a.step:-a.step)}function f(e){e.preventDefault();e.stopPropagation();g(e);var b=e.data;if(!b.$input.is(":disabled")&&!b.$stepper.hasClass("disabled")){var c=a(e.target).hasClass("up")?b.step:-b.step;b.timer=l(b.timer,200,function(){m(b,c,!1)});m(b,c);a("body").on("touchend.stepper mouseup.stepper",b,
g)}}function g(e){e.preventDefault();e.stopPropagation();(e=e.data.timer)&&clearInterval(e);a("body").off(".stepper")}function m(e,a){var b=parseFloat(e.$input.val());a=isNaN(b)?!1!==e.min?e.min:0:!1!==e.min&&b<e.min?e.min:a+b;var c=(a-e.min)%e.step;0!==c&&(a-=c);!1!==e.max&&a>e.max&&(a=e.max,e.$stepper.trigger("max"));!1!==e.min&&a<e.min&&(a=e.min,e.$stepper.trigger("min"));a!==b&&(c=Math.pow(10,e.digits),a=Math.round(a*c)/c,e.$input.trigger("before-step-change"),e.$input.val(a).trigger("change",
[""+a,""+b]))}function l(e,a,b){e&&clearInterval(e);return setInterval(b,a)}var n={customClass:"",labels:{up:"Up",down:"Down"}},q={defaults:function(e){n=a.extend(n,e||{});return"object"===typeof this?a(this):!0},destroy:function(){return a(this).each(function(e){if(e=a(this).data("stepper"))e.$stepper.off(".stepper").find(".stepper-arrow").remove(),e.$input.unwrap().removeClass("stepper-input")})},disable:function(){return a(this).each(function(e){if(e=a(this).data("stepper"))e.$input.attr("disabled",
"disabled"),e.$stepper.addClass("disabled")})},enable:function(){return a(this).each(function(e){if(e=a(this).data("stepper"))e.$input.attr("disabled",null),e.$stepper.removeClass("disabled")})}};a.fn.stepper=function(e){return q[e]?q[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==typeof e&&e?this:(e&&""==e.max&&delete e.max,d.apply(this,arguments))};a.stepper=function(e){"defaults"===e&&q.defaults.apply(this,Array.prototype.slice.call(arguments,1))}})(jQuery,this);
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports&&"object"==typeof module?module.exports=a:a(jQuery)})(function(a,b){function d(e,b,c,d){for(var f=[],p=0;p<e.length;p++){var g=e[p];if(g){var l=tinycolor(g),m=.5>l.toHsl().l?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";m+=tinycolor.equals(b,g)?" sp-thumb-active":"";g=l.toString(d.preferredFormat||"rgb");var t=y?"background-color:"+l.toRgbString():"filter:"+l.toFilter();f.push('<span title="'+
g+'" data-color="'+l.toRgbString()+'" class="'+m+'"><span class="sp-thumb-inner" style="'+t+';" /></span>')}else f.push(a("<div />").append(a('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",d.noColorSelectedText)).html())}return"<div class='sp-cf "+c+"'>"+f.join("")+"</div>"}function c(e,b){e=a.extend({},p,e);e.callbacks={move:n(e.move,b),change:n(e.change,b),show:n(e.show,b),hide:n(e.hide,b),beforeShow:n(e.beforeShow,b)};return e}function f(f,
p){function m(){I.showPaletteOnly&&(I.showPalette=!0);la.text(I.showPaletteOnly?I.togglePaletteMoreText:I.togglePaletteLessText);if(I.palette){ia=I.palette.slice(0);Ka=a.isArray(ia[0])?ia:[ia];ab={};for(var e=0;e<Ka.length;e++)for(var b=0;b<Ka[e].length;b++){var c=tinycolor(Ka[e][b]).toRgbString();ab[c]=!0}}ka.toggleClass("sp-flat",sa);ka.toggleClass("sp-input-disabled",!I.showInput);ka.toggleClass("sp-alpha-enabled",I.showAlpha);ka.toggleClass("sp-clear-enabled",kb);ka.toggleClass("sp-buttons-disabled",
!I.showButtons);ka.toggleClass("sp-palette-buttons-disabled",!I.togglePaletteOnly);ka.toggleClass("sp-palette-disabled",!I.showPalette);ka.toggleClass("sp-palette-only",I.showPaletteOnly);ka.toggleClass("sp-initial-disabled",!I.showInitial);ka.addClass(I.className).addClass(I.containerClassName);ra()}function n(){if(Q&&window.localStorage){try{var e=window.localStorage[Q].split(",#");1<e.length&&(delete window.localStorage[Q],a.each(e,function(e,a){x(a)}))}catch(za){}try{oa=window.localStorage[Q].split(";")}catch(za){}}}
function x(e){if(ma){e=tinycolor(e).toRgbString();if(!ab[e]&&-1===a.inArray(e,oa))for(oa.push(e);oa.length>u;)oa.shift();if(Q&&window.localStorage)try{window.localStorage[Q]=oa.join(";")}catch(za){}}}function z(){var e=[];if(I.showPalette)for(var a=0;a<oa.length;a++){var b=tinycolor(oa[a]).toRgbString();ab[b]||e.push(oa[a])}return e.reverse().slice(0,I.maxSelectionSize)}function J(){var e=Z(),b=a.map(Ka,function(a,b){return d(a,e,"sp-palette-row sp-palette-row-"+b,I)});n();oa&&b.push(d(z(),e,"sp-palette-row sp-palette-row-selection",
I));Wa.html(b.join(""))}function P(){if(I.showInitial){var e=Ta,a=Z();aa.html(d([e,a],a,"sp-palette-row-initial",I))}}function fa(){(0>=O||0>=W||0>=ca)&&ra();ka.addClass("sp-dragging");ya=null;Ea.trigger("dragstart.spectrum",[Z()])}function da(){ka.removeClass("sp-dragging");Ea.trigger("dragstop.spectrum",[Z()])}function M(){var e=Ha.val();null!==e&&""!==e||!kb?(e=tinycolor(e),e.isValid()?(N(e),E(!0)):Ha.addClass("sp-validation-error")):(N(null),E(!0))}function V(){C?pa():ea()}function ea(){var e=
a.Event("beforeShow.spectrum");if(C)ra();else if(Ea.trigger(e,[Z()]),!1!==R.beforeShow(Z())&&!e.isDefaultPrevented()){for(e=0;e<t.length;e++)t[e]&&t[e].hide();C=!0;a(mb).bind("click.spectrum",Y);a(window).bind("resize.spectrum",ua);ib.addClass("sp-active");ka.removeClass("sp-hidden");ra();K();Ta=Z();P();R.show(Ta);Ea.trigger("show.spectrum",[Ta])}}function Y(e){2!=e.button&&(Za?E(!0):N(Ta,!0),pa())}function pa(){C&&!sa&&(C=!1,a(mb).unbind("click.spectrum",Y),a(window).unbind("resize.spectrum",ua),
ib.removeClass("sp-active"),ka.addClass("sp-hidden"),R.hide(Z()),Ea.trigger("hide.spectrum",[Z()]))}function N(e,a){if(tinycolor.equals(e,Z()))K();else{if(!e&&kb)rb=!0;else{rb=!1;var b=tinycolor(e);e=b.toHsv();Ca=e.h%360/360;Ga=e.s;Da=e.v;Ma=e.a}K();b&&b.isValid()&&!a&&(Na=Ra||b.getFormat())}}function Z(e){e=e||{};return kb&&rb?null:tinycolor.fromRatio({h:Ca,s:Ga,v:Da,a:Math.round(100*Ma)/100},{format:e.format||Na})}function S(){K();R.move(Z());Ea.trigger("move.spectrum",[Z()])}function K(){Ha.removeClass("sp-validation-error");
H();var e=tinycolor.fromRatio({h:Ca,s:1,v:1});wa.css("background-color",e.toHexString());e=Na;!(1>Ma)||0===Ma&&"name"===e||"hex"!==e&&"hex3"!==e&&"hex6"!==e&&"name"!==e||(e="rgb");var a=Z({format:e}),b="";$a.removeClass("sp-clear-display");$a.css("background-color","transparent");if(!a&&kb)$a.addClass("sp-clear-display");else{b=a.toHexString();var c=a.toRgbString();y||1===a.alpha?$a.css("background-color",c):($a.css("background-color","transparent"),$a.css("filter",a.toFilter()));if(I.showAlpha){c=
a.toRgb();c.a=0;c=tinycolor(c).toRgbString();var d="linear-gradient(left, "+c+", "+b+")";w?nb.css("filter",tinycolor(c).toFilter({gradientType:1},b)):(nb.css("background","-webkit-"+d),nb.css("background","-moz-"+d),nb.css("background","-ms-"+d),nb.css("background","linear-gradient(to right, "+c+", "+b+")"))}b=a.toString(e)}I.showInput&&Ha.val(b);I.showPalette&&J();P()}function H(){var e=Ga,a=Da;kb&&rb?(gb.hide(),qb.hide(),cb.hide()):(gb.show(),qb.show(),cb.show(),e*=W,a=O-a*O,e=Math.max(-Ba,Math.min(W-
Ba,e-Ba)),a=Math.max(-Ba,Math.min(O-Ba,a-Ba)),cb.css({top:a+"px",left:e+"px"}),gb.css({left:Ma*Ja-qa/2+"px"}),qb.css({top:Ca*ca-Ua+"px"}))}function E(e){var a=Z(),b="",c=!tinycolor.equals(a,Ta);a&&(b=a.toString(Na),x(a));Qa&&Ea.val(b);e&&c&&(R.change(a),Ea.trigger("change",[a]))}function ra(){W=wa.width();O=wa.height();Ba=cb.height();jb.width();ca=jb.height();Ua=qb.height();Ja=Ob.width();qa=gb.width();sa||(ka.css("position","absolute"),I.offset?ka.offset(I.offset):ka.offset(g(ka,sb)));H();I.showPalette&&
J();Ea.trigger("reflow.spectrum")}function X(){pa();eb=!0;Ea.attr("disabled",!0);sb.addClass("sp-disabled")}var I=c(p,f),sa=I.flat,ma=I.showSelectionPalette,Q=I.localStorageKey;p=I.theme;var R=I.callbacks,ua=e(ra,10),C=!1,W=0,O=0,Ba=0,ca=0,Ja=0,qa=0,Ua=0,Ca=0,Ga=0,Da=0,Ma=1,ia=[],Ka=[],ab={},oa=I.selectionPalette.slice(0),u=I.maxSelectionSize,ya=null,mb=f.ownerDocument,Ea=a(f),eb=!1,ka=a(A,mb).addClass(p),La=ka.find(".sp-picker-container"),wa=ka.find(".sp-color"),cb=ka.find(".sp-dragger"),jb=ka.find(".sp-hue"),
qb=ka.find(".sp-slider"),nb=ka.find(".sp-alpha-inner"),Ob=ka.find(".sp-alpha"),gb=ka.find(".sp-alpha-handle"),Ha=ka.find(".sp-input"),Wa=ka.find(".sp-palette"),aa=ka.find(".sp-initial"),ub=ka.find(".sp-cancel"),ba=ka.find(".sp-clear"),Sa=ka.find(".sp-choose"),la=ka.find(".sp-palette-toggle"),Qa=Ea.is("input");f=Qa&&"color"===Ea.attr("type")&&a.fn.spectrum.inputTypeColorSupport();var gc=Qa&&!sa,ib=gc?a("<div class='sp-replacer'><div class='sp-preview'><div class='sp-preview-inner'></div></div><div class='sp-dd'>&#9660;</div></div>").addClass(p).addClass(I.className).addClass(I.replacerClassName):
a([]),sb=gc?ib:Ea,$a=ib.find(".sp-preview-inner"),Ya=I.color||Qa&&Ea.val(),Ta=!1,Ra=I.preferredFormat,Na=Ra,Za=!I.showButtons||I.clickoutFiresChange,rb=!Ya,kb=I.allowEmpty&&!f;(function(){function e(e){e.data&&e.data.ignore?(N(a(e.target).closest(".sp-thumb-el").data("color")),S()):(N(a(e.target).closest(".sp-thumb-el").data("color")),S(),E(!0),I.hideAfterPaletteSelect&&pa());return!1}w&&ka.find("*:not(input)").attr("unselectable","on");m();gc&&Ea.after(ib).hide();kb||ba.hide();if(sa)Ea.after(ka).hide();
else{var b="parent"===I.appendTo?Ea.parent():a(I.appendTo);1!==b.length&&(b=a("body"));b.append(ka)}n();sb.bind("click.spectrum touchstart.spectrum",function(e){eb||V();e.stopPropagation();a(e.target).is("input")||e.preventDefault()});(Ea.is(":disabled")||!0===I.disabled)&&X();ka.click(l);Ha.change(M);Ha.bind("paste",function(){setTimeout(M,1)});Ha.keydown(function(e){13==e.keyCode&&M()});ub.text(I.cancelText);ub.bind("click.spectrum",function(e){e.stopPropagation();e.preventDefault();N(Ta,!0);pa()});
ba.attr("title",I.clearText);ba.bind("click.spectrum",function(e){e.stopPropagation();e.preventDefault();rb=!0;S();sa&&E(!0)});Sa.text(I.chooseText);Sa.bind("click.spectrum",function(e){e.stopPropagation();e.preventDefault();w&&Ha.is(":focus")&&Ha.trigger("change");Ha.hasClass("sp-validation-error")||(E(!0),pa())});la.text(I.showPaletteOnly?I.togglePaletteMoreText:I.togglePaletteLessText);la.bind("click.spectrum",function(e){e.stopPropagation();e.preventDefault();I.showPaletteOnly=!I.showPaletteOnly;
I.showPaletteOnly||sa||ka.css("left","-="+(La.outerWidth(!0)+5));m()});q(Ob,function(e,a,b){Ma=e/Ja;rb=!1;b.shiftKey&&(Ma=Math.round(10*Ma)/10);S()},fa,da);q(jb,function(e,a){Ca=parseFloat(a/ca);rb=!1;I.showAlpha||(Ma=1);S()},fa,da);q(wa,function(e,a,b){b.shiftKey?ya||(ya=Math.abs(e-Ga*W)>Math.abs(a-(O-Da*O))?"x":"y"):ya=null;b=!ya||"y"===ya;ya&&"x"!==ya||(Ga=parseFloat(e/W));b&&(Da=parseFloat((O-a)/O));rb=!1;I.showAlpha||(Ma=1);S()},fa,da);Ya?(N(Ya),K(),Na=Ra||tinycolor(Ya).format,x(Ya)):K();sa&&
ea();b=w?"mousedown.spectrum":"click.spectrum touchstart.spectrum";Wa.delegate(".sp-thumb-el",b,e);aa.delegate(".sp-thumb-el:nth-child(1)",b,{ignore:!0},e)})();var Ia={show:ea,hide:pa,toggle:V,reflow:ra,option:function(e,c){if(e===b)return a.extend({},I);if(c===b)return I[e];I[e]=c;m()},enable:function(){eb=!1;Ea.attr("disabled",!1);sb.removeClass("sp-disabled")},disable:X,offset:function(e){I.offset=e;ra()},set:function(e){N(e);E()},get:Z,destroy:function(){Ea.show();sb.unbind("click.spectrum touchstart.spectrum");
ka.remove();ib.remove();t[Ia.id]=null},container:ka};Ia.id=t.push(Ia)-1;return Ia}function g(e,b){var c=e.outerWidth(),d=e.outerHeight(),f=b.outerHeight(),p=e[0].ownerDocument,g=p.documentElement;e=g.clientWidth+a(p).scrollLeft();p=g.clientHeight+a(p).scrollTop();b=b.offset();b.top+=f;b.left-=Math.min(b.left,b.left+c>e&&e>c?Math.abs(b.left+c-e):0);b.top-=Math.min(b.top,b.top+d>p&&p>d?Math.abs(d+f-0):0);return b}function m(){}function l(e){e.stopPropagation()}function n(e,a){var b=Array.prototype.slice,
c=b.call(arguments,2);return function(){return e.apply(a,c.concat(b.call(arguments)))}}function q(e,b,c,d){function f(e){e.stopPropagation&&e.stopPropagation();e.preventDefault&&e.preventDefault();e.returnValue=!1}function p(a){if(m){if(w&&9>l.documentMode&&!a.button)return g();var c=a.originalEvent&&a.originalEvent.touches&&a.originalEvent.touches[0],d=Math.max(0,Math.min((c&&c.pageX||a.pageX)-t.left,q));c=Math.max(0,Math.min((c&&c.pageY||a.pageY)-t.top,n));y&&f(a);b.apply(e,[d,c,a])}}function g(){m&&
(a(l).unbind(x),a(l.body).removeClass("sp-dragging"),d.apply(e,arguments));m=!1}b=b||function(){};c=c||function(){};d=d||function(){};var l=document,m=!1,t={},n=0,q=0,y="ontouchstart"in window,x={};x.selectstart=f;x.dragstart=f;x["touchmove mousemove"]=p;x["touchend mouseup"]=g;a(e).bind("touchstart mousedown",function(b){(b.which?3==b.which:2==b.button)||m||!1===c.apply(e,arguments)||(m=!0,n=a(e).height(),q=a(e).width(),t=a(e).offset(),a(l).bind(x),a(l.body).addClass("sp-dragging"),y||p(b),f(b))})}
function e(e,a,b){var c;return function(){var d=this,f=arguments,p=function(){c=null;e.apply(d,f)};b&&clearTimeout(c);if(b||!c)c=setTimeout(p,a)}}var p={beforeShow:m,move:m,change:m,show:m,hide:m,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",
togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:["#ffffff #000000 #ff0000 #ff8000 #ffff00 #008000 #0000ff #4b0082 #9400d3".split(" ")],selectionPalette:[],disabled:!1,offset:null},t=[],w=!!/msie/i.exec(window.navigator.userAgent),y=function(){var e=document.createElement("div").style;e.cssText="background-color:rgba(0,0,0,.5)";return!!~(""+
e.backgroundColor).indexOf("rgba")||!!~(""+e.backgroundColor).indexOf("hsla")}(),A=function(){var e="";if(w)for(var a=1;6>=a;a++)e+="<div class='sp-"+a+"'></div>";return["<div class='sp-container sp-hidden'><div class='sp-palette-container'><div class='sp-palette sp-thumb sp-cf'></div><div class='sp-palette-button-container sp-cf'><button type='button' class='sp-palette-toggle'></button></div></div><div class='sp-picker-container'><div class='sp-top sp-cf'><div class='sp-fill'></div><div class='sp-top-inner'><div class='sp-color'><div class='sp-sat'><div class='sp-val'><div class='sp-dragger'></div></div></div></div><div class='sp-clear sp-clear-display'></div><div class='sp-hue'><div class='sp-slider'></div>",
e,"</div></div><div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div></div><div class='sp-input-container sp-cf'><input class='sp-input' type='text' spellcheck='false'  /></div><div class='sp-initial sp-thumb sp-cf'></div><div class='sp-button-container sp-cf'><a class='sp-cancel' href='#'></a><button type='button' class='sp-choose'></button></div></div></div>"].join("")}();a.fn.spectrum=function(e,b){if("string"==typeof e){var c=this,d=Array.prototype.slice.call(arguments,
1);this.each(function(){var b=t[a(this).data("spectrum.id")];if(b){var f=b[e];if(!f)throw Error("Spectrum: no such method: '"+e+"'");"get"==e?c=b.get():"container"==e?c=b.container:"option"==e?c=b.option.apply(b,d):"destroy"==e?(b.destroy(),a(this).removeData("spectrum.id")):f.apply(b,d)}});return c}return this.spectrum("destroy").each(function(){var b=a.extend({},e,a(this).data());b=f(this,b);a(this).data("spectrum.id",b.id)})};a.fn.spectrum.load=!0;a.fn.spectrum.loadOpts={};a.fn.spectrum.draggable=
q;a.fn.spectrum.defaults=p;a.fn.spectrum.inputTypeColorSupport=function z(){if("undefined"===typeof z._cachedResult){var e=a("<input type='color' value='!' />")[0];z._cachedResult="color"===e.type&&"!"!==e.value}return z._cachedResult};a.spectrum={};a.spectrum.localization={};a.spectrum.palettes={};a.fn.spectrum.processNativeColorInputs=function(){var e=a("input[type=color]");e.length&&!a.fn.spectrum.inputTypeColorSupport()&&e.spectrum({preferredFormat:"hex6"})};(function(){function e(e,a,b){e=E(e,
255);a=E(a,255);b=E(b,255);var c=C(e,a,b),d=ua(e,a,b),f=(c+d)/2;if(c==d)var p=d=0;else{var g=c-d;d=.5<f?g/(2-c-d):g/(c+d);switch(c){case e:p=(a-b)/g+(a<b?6:0);break;case a:p=(b-e)/g+2;break;case b:p=(e-a)/g+4}p/=6}return{h:p,s:d,l:f}}function a(e,a,b){function c(e,a,b){0>b&&(b+=1);1<b&&--b;return b<1/6?e+6*(a-e)*b:.5>b?a:b<2/3?e+(a-e)*(2/3-b)*6:e}e=E(e,360);a=E(a,100);b=E(b,100);if(0===a)b=a=e=b;else{var d=.5>b?b*(1+a):b+a-b*a,f=2*b-d;b=c(f,d,e+1/3);a=c(f,d,e);e=c(f,d,e-1/3)}return{r:255*b,g:255*
a,b:255*e}}function b(e,a,b){e=E(e,255);a=E(a,255);b=E(b,255);var c=C(e,a,b),d=ua(e,a,b),f=c-d;if(c==d)var p=0;else{switch(c){case e:p=(a-b)/f+(a<b?6:0);break;case a:p=(b-e)/f+2;break;case b:p=(e-a)/f+4}p/=6}return{h:p,s:0===c?0:f/c,v:c}}function c(e,a,b,c){e=[ra(R(e).toString(16)),ra(R(a).toString(16)),ra(R(b).toString(16))];return c&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function d(e,
a,b,c){return[ra(Math.round(255*parseFloat(c)).toString(16)),ra(R(e).toString(16)),ra(R(a).toString(16)),ra(R(b).toString(16))].join("")}function f(e,a){a=0===a?0:a||10;e=O(e).toHsl();e.s-=a/100;e.s=ua(1,C(0,e.s));return O(e)}function p(e,a){a=0===a?0:a||10;e=O(e).toHsl();e.s+=a/100;e.s=ua(1,C(0,e.s));return O(e)}function g(e){return O(e).desaturate(100)}function l(e,a){a=0===a?0:a||10;e=O(e).toHsl();e.l+=a/100;e.l=ua(1,C(0,e.l));return O(e)}function m(e,a){a=0===a?0:a||10;e=O(e).toRgb();e.r=C(0,
ua(255,e.r-R(255*-(a/100))));e.g=C(0,ua(255,e.g-R(255*-(a/100))));e.b=C(0,ua(255,e.b-R(255*-(a/100))));return O(e)}function t(e,a){a=0===a?0:a||10;e=O(e).toHsl();e.l-=a/100;e.l=ua(1,C(0,e.l));return O(e)}function n(e,a){e=O(e).toHsl();a=(R(e.h)+a)%360;e.h=0>a?360+a:a;return O(e)}function q(e){e=O(e).toHsl();e.h=(e.h+180)%360;return O(e)}function w(e){var a=O(e).toHsl(),b=a.h;return[O(e),O({h:(b+120)%360,s:a.s,l:a.l}),O({h:(b+240)%360,s:a.s,l:a.l})]}function y(e){var a=O(e).toHsl(),b=a.h;return[O(e),
O({h:(b+90)%360,s:a.s,l:a.l}),O({h:(b+180)%360,s:a.s,l:a.l}),O({h:(b+270)%360,s:a.s,l:a.l})]}function A(e){var a=O(e).toHsl(),b=a.h;return[O(e),O({h:(b+72)%360,s:a.s,l:a.l}),O({h:(b+216)%360,s:a.s,l:a.l})]}function S(e,a,b){a=a||6;b=b||30;var c=O(e).toHsl();b=360/b;e=[O(e)];for(c.h=(c.h-(b*a>>1)+720)%360;--a;)c.h=(c.h+b)%360,e.push(O(c));return e}function K(e,a){a=a||6;var b=O(e).toHsv();e=b.h;var c=b.s;b=b.v;for(var d=[],f=1/a;a--;)d.push(O({h:e,s:c,v:b})),b=(b+f)%1;return d}function H(e){e=parseFloat(e);
if(isNaN(e)||0>e||1<e)e=1;return e}function E(e,a){var b=e;"string"==typeof b&&-1!=b.indexOf(".")&&1===parseFloat(b)&&(e="100%");b="string"===typeof e&&-1!=e.indexOf("%");e=ua(a,C(0,parseFloat(e)));b&&(e=parseInt(e*a,10)/100);return 1E-6>Q.abs(e-a)?1:e%a/parseFloat(a)}function ra(e){return 1==e.length?"0"+e:""+e}function X(e){1>=e&&(e=100*e+"%");return e}var I=/^[\s,#]+/,sa=/\s+$/,ma=0,Q=Math,R=Q.round,ua=Q.min,C=Q.max,W=Q.random,O=function(e,b){var c,d;e=e?e:"";b=b||{};if(e instanceof O)return e;
if(!(this instanceof O))return new O(e,b);var f=e;var p={r:0,g:0,b:0};var g=1;var l=c=!1;if("string"==typeof f)a:{f=f.replace(I,"").replace(sa,"").toLowerCase();var m=!1;if(Ba[f])f=Ba[f],m=!0;else if("transparent"==f){f={r:0,g:0,b:0,a:0,format:"name"};break a}f=(d=Ja.rgb.exec(f))?{r:d[1],g:d[2],b:d[3]}:(d=Ja.rgba.exec(f))?{r:d[1],g:d[2],b:d[3],a:d[4]}:(d=Ja.hsl.exec(f))?{h:d[1],s:d[2],l:d[3]}:(d=Ja.hsla.exec(f))?{h:d[1],s:d[2],l:d[3],a:d[4]}:(d=Ja.hsv.exec(f))?{h:d[1],s:d[2],v:d[3]}:(d=Ja.hsva.exec(f))?
{h:d[1],s:d[2],v:d[3],a:d[4]}:(d=Ja.hex8.exec(f))?{a:parseInt(d[1],16)/255,r:parseInt(d[2],16),g:parseInt(d[3],16),b:parseInt(d[4],16),format:m?"name":"hex8"}:(d=Ja.hex6.exec(f))?{r:parseInt(d[1],16),g:parseInt(d[2],16),b:parseInt(d[3],16),format:m?"name":"hex"}:(d=Ja.hex3.exec(f))?{r:parseInt(d[1]+""+d[1],16),g:parseInt(d[2]+""+d[2],16),b:parseInt(d[3]+""+d[3],16),format:m?"name":"hex"}:!1}if("object"==typeof f){if(f.hasOwnProperty("r")&&f.hasOwnProperty("g")&&f.hasOwnProperty("b"))p=f.g,c=f.b,p=
{r:255*E(f.r,255),g:255*E(p,255),b:255*E(c,255)},c=!0,l="%"===String(f.r).substr(-1)?"prgb":"rgb";else if(f.hasOwnProperty("h")&&f.hasOwnProperty("s")&&f.hasOwnProperty("v")){f.s=X(f.s);f.v=X(f.v);l=f.h;m=f.s;p=f.v;l=6*E(l,360);m=E(m,100);p=E(p,100);c=Q.floor(l);var t=l-c;l=p*(1-m);d=p*(1-t*m);m=p*(1-(1-t)*m);c%=6;p={r:255*[p,d,l,l,m,p][c],g:255*[m,p,p,d,l,l][c],b:255*[l,l,m,p,p,d][c]};c=!0;l="hsv"}else f.hasOwnProperty("h")&&f.hasOwnProperty("s")&&f.hasOwnProperty("l")&&(f.s=X(f.s),f.l=X(f.l),p=
a(f.h,f.s,f.l),c=!0,l="hsl");f.hasOwnProperty("a")&&(g=f.a)}g=H(g);f=f.format||l;l=ua(255,C(p.r,0));d=ua(255,C(p.g,0));p=ua(255,C(p.b,0));this._originalInput=e;this._r=l;this._g=d;this._b=p;this._a=g;this._roundA=R(100*this._a)/100;this._format=b.format||f;this._gradientType=b.gradientType;1>this._r&&(this._r=R(this._r));1>this._g&&(this._g=R(this._g));1>this._b&&(this._b=R(this._b));this._ok=c;this._tc_id=ma++};O.prototype={isDark:function(){return 128>this.getBrightness()},isLight:function(){return!this.isDark()},
isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1E3},setAlpha:function(e){this._a=H(e);this._roundA=R(100*this._a)/100;return this},toHsv:function(){var e=b(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=b(this._r,this._g,this._b),a=R(360*e.h),c=R(100*e.s);
e=R(100*e.v);return 1==this._a?"hsv("+a+", "+c+"%, "+e+"%)":"hsva("+a+", "+c+"%, "+e+"%, "+this._roundA+")"},toHsl:function(){var a=e(this._r,this._g,this._b);return{h:360*a.h,s:a.s,l:a.l,a:this._a}},toHslString:function(){var a=e(this._r,this._g,this._b),b=R(360*a.h),c=R(100*a.s);a=R(100*a.l);return 1==this._a?"hsl("+b+", "+c+"%, "+a+"%)":"hsla("+b+", "+c+"%, "+a+"%, "+this._roundA+")"},toHex:function(e){return c(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return d(this._r,
this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:R(this._r),g:R(this._g),b:R(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+R(this._r)+", "+R(this._g)+", "+R(this._b)+")":"rgba("+R(this._r)+", "+R(this._g)+", "+R(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:R(100*E(this._r,255))+"%",g:R(100*E(this._g,255))+"%",b:R(100*E(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+
R(100*E(this._r,255))+"%, "+R(100*E(this._g,255))+"%, "+R(100*E(this._b,255))+"%)":"rgba("+R(100*E(this._r,255))+"%, "+R(100*E(this._g,255))+"%, "+R(100*E(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":1>this._a?!1:ca[c(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var a="#"+d(this._r,this._g,this._b,this._a),b=a,c=this._gradientType?"GradientType = 1, ":"";e&&(b=O(e).toHex8String());return"progid:DXImageTransform.Microsoft.gradient("+c+"startColorstr="+
a+",endColorstr="+b+")"},toString:function(e){var a=!!e;e=e||this._format;var b=!1,c=1>this._a&&0<=this._a;if(!a&&c&&("hex"===e||"hex6"===e||"hex3"===e||"name"===e))return"name"===e&&0===this._a?this.toName():this.toRgbString();"rgb"===e&&(b=this.toRgbString());"prgb"===e&&(b=this.toPercentageRgbString());if("hex"===e||"hex6"===e)b=this.toHexString();"hex3"===e&&(b=this.toHexString(!0));"hex8"===e&&(b=this.toHex8String());"name"===e&&(b=this.toName());"hsl"===e&&(b=this.toHslString());"hsv"===e&&
(b=this.toHsvString());return b||this.toHexString()},_applyModification:function(e,a){e=e.apply(null,[this].concat([].slice.call(a)));this._r=e._r;this._g=e._g;this._b=e._b;this.setAlpha(e._a);return this},lighten:function(){return this._applyModification(l,arguments)},brighten:function(){return this._applyModification(m,arguments)},darken:function(){return this._applyModification(t,arguments)},desaturate:function(){return this._applyModification(f,arguments)},saturate:function(){return this._applyModification(p,
arguments)},greyscale:function(){return this._applyModification(g,arguments)},spin:function(){return this._applyModification(n,arguments)},_applyCombination:function(e,a){return e.apply(null,[this].concat([].slice.call(a)))},analogous:function(){return this._applyCombination(S,arguments)},complement:function(){return this._applyCombination(q,arguments)},monochromatic:function(){return this._applyCombination(K,arguments)},splitcomplement:function(){return this._applyCombination(A,arguments)},triad:function(){return this._applyCombination(w,
arguments)},tetrad:function(){return this._applyCombination(y,arguments)}};O.fromRatio=function(e,a){if("object"==typeof e){var b={},c;for(c in e)e.hasOwnProperty(c)&&(b[c]="a"===c?e[c]:X(e[c]));e=b}return O(e,a)};O.equals=function(e,a){return e&&a?O(e).toRgbString()==O(a).toRgbString():!1};O.random=function(){return O.fromRatio({r:W(),g:W(),b:W()})};O.mix=function(e,a,b){b=0===b?0:b||50;e=O(e).toRgb();a=O(a).toRgb();b/=100;var c=2*b-1,d=a.a-e.a;c=((-1==c*d?c:(c+d)/(1+c*d))+1)/2;d=1-c;return O({r:a.r*
c+e.r*d,g:a.g*c+e.g*d,b:a.b*c+e.b*d,a:a.a*b+e.a*(1-b)})};O.readability=function(e,a){var b=O(e),c=O(a);a=b.toRgb();e=c.toRgb();b=b.getBrightness();c=c.getBrightness();return{brightness:Math.abs(b-c),color:Math.max(a.r,e.r)-Math.min(a.r,e.r)+Math.max(a.g,e.g)-Math.min(a.g,e.g)+Math.max(a.b,e.b)-Math.min(a.b,e.b)}};O.isReadable=function(e,a){e=O.readability(e,a);return 125<e.brightness&&500<e.color};O.mostReadable=function(e,a){for(var b=null,c=0,d=!1,f=0;f<a.length;f++){var p=O.readability(e,a[f]),
l=125<p.brightness&&500<p.color;p=p.brightness/125*3+p.color/500;if(l&&!d||l&&d&&p>c||!l&&!d&&p>c)d=l,c=p,b=O(a[f])}return b};var Ba=O.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",
cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",
floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",
lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",
mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",
sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},ca=O.hexNames=function(e){var a={},b;for(b in e)e.hasOwnProperty(b)&&(a[e[b]]=b);return a}(Ba),Ja={rgb:/rgb[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,
rgba:/rgba[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsl:/hsl[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsla:/hsla[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,
hsv:/hsv[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsva:/hsva[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};
window.tinycolor=O})();a(function(){a.fn.spectrum.load&&a.fn.spectrum.processNativeColorInputs()})});$.scrollbar_horizontal_without_bar_step=100;
(function(){function a(){var e=this,a=this.configs.vertical.add_margin_with_height?this.elm.outerHeight(!0):this.configs.vertical.reduce_padding_from_height?this.elm.height():this.elm.innerHeight();this.v_bar.height(a);var b=function(a,b,c){a=e["v_"+a+"_offset"];return 0<a?b+a:c+-1*a};a=b("left","+","-");var c=b("top","+","-");b=b("right","-","+");switch(this.configs.vertical.position){case "left":this.v_bar.position({my:"left top",at:"left"+a+" top"+c,of:this.elm});break;case "right":bm.posRefChangeLtoR(this.v_bar.position({my:"right top",
at:"right"+b+" top"+c,of:this.elm}))}}function b(){var e=this,a=this.configs.horizontal.add_margin_with_width?this.elm.outerWidth(!0):this.configs.horizontal.reduce_padding_from_width?this.elm.width():this.elm.innerWidth();this.configs.horizontal.width&&(a+=this.configs.horizontal.width);this.v_bar.width(a);var b=function(a,b,c){a=e["v_"+a+"_offset"];return 0<a?b+a:c+-1*a};a=b("left","+","-");b=b("bottom","-","+");switch(this.configs.horizontal.position){case "bottom":this.h_bar.position({my:"bottom left",
at:"bottom"+b+" left"+a,of:this.elm})}}function d(){if(this.ready_for_show){var a=this.elm.innerWidth(),c=this.elm[0].scrollWidth;if("always"==this.configs.visible_on||a<c){this.h_bar_shown?b.call(this):l.call(this,!1,!0);this.h_bar_shown&&(this.mouse_on_h||this.h_dragging?n.call(this,!1,!0):q.call(this,!1,!0));var d=this.h_bar.innerWidth();this.h_handler.css("width",bm.innerWidth(this.h_handler,a/c*d,!0));a=this.elm.scrollTop();this.h_handler.css("top",a/c*d)}else this.h_bar_shown&&e.call(this,!0,
!1,!0)}else this.h_bar_shown&&b.call(this)}function c(){var a=this,b=this.elm[0].setCapture;this.elm.mousemove(function(e){var b=a.elm.offset().top;b="bottom"==a.configs.horizontal.position?b+(a.elm.height()-a.h_bar.css("bottom").int()):b+a.h_bar.css("top").int();100>Math.abs(b-e.pageY)?(a.h_bar_in_area=!0,n.call(a,!1,!0),a.h_bar_shown||d.call(a,!0)):(a.h_bar_in_area=!1,a.h_hide_timer||!a.h_bar_shown||a.h_dragging||q.call(a,!1,!0))});this.h_bar.hover(function(){a.mouse_on_h=!0},function(){a.mouse_on_h=
!1});var c,f,p,l,g,m=function(c){a.h_dragging=!1;b?c.target.releaseCapture():(document.removeEventListener("mouseup",m,!0),document.removeEventListener("mousemove",t,!0));a.h_bar_in_area||e.call(a,!1,!0,!0)},t=function(e){if(a.h_dragging){bm.clearTextSelection();var b=f+(e.pageX-c);0>b&&(c=e.pageX,f=0);b+l>g&&(c=e.pageX,f=g-l);a.elm.scrollLeft(Math.round(b*p));a.update()}};this.h_handler.mousedown(function(e){c=e.pageX;f=a.h_handler.position().left;g=a.h_bar.innerWidth();p=a.elm[0].scrollWidth/g;
b?e.target.setCapture():(document.addEventListener("mouseup",m,!0),document.addEventListener("mousemove",t,!0));a.h_dragging=!0;l=a.h_handler.outerWidth()});b&&this.h_handler.mouseup(m).mousemove(t)}function f(){var e=this;if(this.configs.use_bar)c.call(this);else{var a=this.configs.horizontal.step||$.scrollbar_horizontal_without_bar_step;a="auto"==a?this.elm.width():$.scrollbar_horizontal_without_bar_step;this.configs.horizontal.handle.left.click(function(){t?e.elm.animate({scrollTop:"-="+a}):e.elm.animate({scrollLeft:"-="+
a})});this.configs.horizontal.handle.right.click(function(){t?e.elm.animate({scrollTop:"+="+a}):e.elm.animate({scrollLeft:"+="+a})})}}function g(){var e=this,a=this.elm[0].setCapture;this.elm.bind("mousewheel.scrollbar",function(a){var b=e.elm,c=b.scrollTop(),d=b[0].scrollHeight,f=b.innerHeight();if(0==c&&0<a.deltaY||0>a.deltaY&&c+f==d)return!0;b.scrollTop(c-a.deltaY*a.deltaFactor).trigger("vscroll");e.update();return!1});this.v_bar.hover(function(){e.mouse_on_v=!0},function(){e.mouse_on_v=!1});var b,
c,d,f,p,l=function(b){e.v_dragging=!1;a?b.target.releaseCapture():(document.removeEventListener("mouseup",l,!0),document.removeEventListener("mousemove",g,!0));e.mouse_on_v||q.call(e,!0,!1)},g=function(a){if(e.v_dragging){bm.clearTextSelection();var l=c+(a.pageY-b);0>l&&(b=a.pageY,c=0);l+f>p&&(b=a.pageY,c=p-f);e.elm.scrollTop(Math.round(l*d));e.update()}};this.v_handler.mousedown(function(m){b=m.pageY;c=e.v_handler.position().top;p=e.v_bar.innerHeight();d=e.elm[0].scrollHeight/p;a?m.target.setCapture():
(document.addEventListener("mouseup",l,!0),document.addEventListener("mousemove",g,!0));e.v_dragging=!0;f=e.v_handler.outerHeight()});a&&this.v_handler.mouseup(l).mousemove(g)}function m(){var e=this;$.fn.swipe&&e.elm.swipe({swipe:function(a,b){!e.configs.show_horizontal||"left"!=b&&"right"!=b||(a=e.configs.horizontal.step||$.scrollbar_horizontal_without_bar_step,a="auto"==a?e.elm.width():$.scrollbar_horizontal_without_bar_step,"right"==b?e.elm.animate({scrollLeft:"-="+a}):e.elm.animate({scrollLeft:"+="+
a}));if(e.configs.show_vertical&&("up"==b||"down"==b))return b="up"==b?1:-1,a=e.elm.scrollTop(),e.elm.scrollTop(a-40*b),this.ready_for_show=!0,e.update(),!1},threshold:30})}function l(e,c){this.configs.show_vertical&&e&&(this.v_bar.stop(!0,!0).show(),this.v_bar_shown&&a.call(this),this.v_bar_shown=!0);this.configs.show_horizontal&&c&&(this.h_bar.stop(!0,!0).show(),this.h_bar_shown&&b.call(this),this.h_bar_shown=!0)}function n(e,a){e&&this.v_hide_timer&&(clearTimeout(this.v_hide_timer),this.v_hide_timer=
null,this.v_bar_shown&&l.call(this,e));a&&this.h_hide_timer&&(clearTimeout(this.h_hide_timer),this.h_hide_timer=null,this.h_bar_shown&&l.call(this,!1,a))}function q(a,b){n(a,b);a&&(this.configs.hide_after?(l.call(this,a),this.v_hide_timer=setTimeout(function(){this.v_hide_timer=null;e.call(this,!0,!1)}.bind(this),this.configs.hide_after)):e.call(this,!0,!1));b&&(this.configs.hide_after?(l.call(this,!1,b),this.h_hide_timer=setTimeout(function(){this.h_hide_timer=null;e.call(this,!1,!0)}.bind(this),
this.configs.hide_after)):e.call(this,!1,!0))}function e(e,a,b){arguments.length||(e=a=!0);if(this.v_bar_shown&&this.configs.show_vertical&&e){var c=function(){this.v_bar_shown=!1}.bind(this);b?(this.v_bar.hide(),c()):this.v_bar.fadeOut(1500,c)}this.h_bar_shown&&this.configs.show_horizontal&&a&&(c=function(){this.h_bar_shown=!1}.bind(this),b?(this.h_bar.hide(),c()):this.h_bar.fadeOut(1500,c))}function p(){var e=this.container.find("tr:has(th)"),a=e.clone();e.copyDeepEvents(a,!0);var b=this.container.find("table");
if(this.false_header_row)var c=this.false_header_row.closest("table");else c=$("<div class='scrollable-table-header-wrapper'><table class='scrollable-table-header'></table></div>"),c=c.find("table"),b.copyEvents(c,!0);c.html(this.container.find("colgroup").clone()).append(a);this.false_header_row=c.find("tr:first");e.hide();return a}$.scrollbar={defaults:{show_vertical:!0,show_horizontal:!1,visible_on:"hover",hide_after:8E3,use_bar:!0,reduce_margin_from_offset:!1,add_padding_with_offset:!0,vertical:{position:"right",
offset:void 0,top_offset:5,right_offset:5,left_offset:void 0,add_margin_with_height:!1,reduce_padding_from_height:!1},horizontal:{position:"bottom",offset:void 0,top_offset:void 0,bottom_offset:5,left_offset:5,add_margin_with_width:!1,reduce_padding_from_width:!0,width:-10},swipe_scroll:!1}};$.tablescrollbar={defaults:{use_parent_as_wrapper:!0}};var t=!1,w=!1;window.Scrollbar=function(e,a){this.elm=e instanceof $?e:$(e);this.configs=$.extend(!0,{},$.scrollbar.defaults,a);this.init();this.render();
this.bindEvents();this.ready_for_show="always"==this.configs.visible_on||"auto"==this.configs.visible_on;this.update()};var y=Scrollbar.prototype;y.init=function(){this.elm.addClass("scrollable");var e=this.configs.reduce_margin_from_offset?[!0,!0,!1]:[!1,!1,this.configs.add_padding_with_offset];e=this.configs.reduce_margin_from_offset?{left:-1*this.elm.leftRib.apply(this.elm,[].concat($jscomp.arrayFromIterable(e))),top:-1*this.elm.topRib.apply(this.elm,[].concat($jscomp.arrayFromIterable(e))),right:-1*
this.elm.rightRib.apply(this.elm,[].concat($jscomp.arrayFromIterable(e))),bottom:-1*this.elm.bottomRib.apply(this.elm,[].concat($jscomp.arrayFromIterable(e)))}:{left:this.elm.leftRib.apply(this.elm,[].concat($jscomp.arrayFromIterable(e))),top:this.elm.topRib.apply(this.elm,[].concat($jscomp.arrayFromIterable(e))),right:this.elm.rightRib.apply(this.elm,[].concat($jscomp.arrayFromIterable(e))),bottom:this.elm.bottomRib.apply(this.elm,[].concat($jscomp.arrayFromIterable(e)))};this.v_top_offset=(null==
this.configs.vertical.offset?this.configs.vertical.top_offset:this.configs.vertical.offset)+e.top;this.v_right_offset=(null==this.configs.vertical.offset?this.configs.vertical.right_offset:this.configs.vertical.offset)+e.right;this.v_left_offset=(null==this.configs.vertical.offset?this.configs.vertical.left_offset:this.configs.vertical.offset)+e.left;this.h_top_offset=(null==this.configs.horizontal.offset?this.configs.horizontal.top_offset:offset)+e.top;this.h_bottom_offset=(null==this.configs.horizontal.offset?
this.configs.horizontal.bottom_offset:offset)+e.bottom;this.h_left_offset=(null==this.configs.horizontal.offset?this.configs.horizontal.left_offset:offset)+e.left};y.update=function(){if(this.configs.show_vertical&&this.configs.use_bar)if(this.ready_for_show){var b=this.elm.innerHeight(),c=this.elm[0].scrollHeight;if("always"==this.configs.visible_on||b<c){this.v_bar_shown?a.call(this):l.call(this,!0,!1);this.v_bar_shown&&(this.mouse_on_v||this.v_dragging?n.call(this,!0,!1):q.call(this,!0,!1));var f=
this.v_bar.innerHeight();this.v_handler.css("height",bm.innerHeight(this.v_handler,b/c*f,!0));b=this.elm.scrollTop();this.v_handler.css("top",b/c*f)}else this.v_bar_shown&&e.call(this,!0,!1,!0)}else this.v_bar_shown&&a.call(this);this.configs.show_horizontal&&(this.configs.use_bar?d.call(this,!1):"auto"==this.configs.visible_on&&(c=this.elm.innerWidth(),f=this.elm[0].scrollWidth,b=this.elm.innerHeight(),t=b<this.elm[0].scrollHeight&&c<b?!0:!1,(w=c<f&&c>b?!0:!1)||t?this.configs.horizontal.handle.left.is(":hidden")&&
(this.elm.addClass("content-overflow"),this.configs.horizontal.handle.left.show(),this.configs.horizontal.handle.right.show()):this.configs.horizontal.handle.left.is(":visible")&&(this.elm.removeClass("content-overflow"),this.configs.horizontal.handle.left.hide(),this.configs.horizontal.handle.right.hide())));return this};y.render=function(){if(this.configs.show_vertical&&this.configs.use_bar){this.elm.addClass("vertical-scroll").css("overflow-y","hidden");var e=this.v_bar="<div class='vertical scrollbar'></div>".jqObject.css("position",
"absolute").hide(),c=this.v_handler="<div class='scrollbar-handle'></div>".jqObject;e.append(c);this.elm.after(e);"static"==e.css("position")&&e.css("position","absolute");"auto"!=this.configs.vertical.position&&a.call(this)}this.configs.show_horizontal&&this.configs.use_bar&&(this.elm.addClass("horizontal-scroll").css("overflow-x","hidden"),e=this.h_bar="<div class='horizontal scrollbar'></div>".jqObject.css("position","absolute").hide(),c=this.h_handler="<div class='scrollbar-handle'></div>".jqObject,
e.append(c),this.elm.after(e),"auto"!=this.configs.horizontal.position&&b.call(this));this.configs.swipe_scroll&&m.call(this)};y.destroy=function(){this.h_hide_timer&&clearTimeout(this.h_hide_timer);this.v_hide_timer&&clearTimeout(this.v_hide_timer);this.elm.removeClass("scrollable vertical horizontal").off("hover").off("mousewheel.scrollbar");this.elm.is(this.elm)||this.elm.parent().unwrapInner();this.v_bar&&this.v_bar.remove();this.h_bar&&this.h_bar.remove()};y.bindEvents=function(){var a=this;
"hover"==this.configs.visible_on&&this.elm.add(this.h_bar&&this.v_bar?this.h_bar.add(this.v_bar):this.h_bar||this.v_bar).hover(function(){this.ready_for_show=!0;n.call(this,!0,!0);setTimeout(function(){this.update()}.bind(this),0)}.bind(this),function(){this.v_dragging||this.h_dragging||(this.ready_for_show=!1,setTimeout(function(){this.mouse_on_v||this.mouse_on_h||e.call(this)}.bind(this),0))}.bind(this));this.configs.show_vertical&&g.call(this);this.configs.show_horizontal&&f.call(this);this.elm.find(".scrollbar").on("remove",
function(){a.destroy()})};var A=Scrollbar.prototype;window.TableScroll=function(e,a){a&&(a=$.extend({},$.tablescrollbar.defaults,a));A.constructor.call(this,e,a)};TableScroll.inherit(Scrollbar);y=TableScroll.prototype;y.init=function(){this.configs.show_horizontal=!1;this.configs.show_vertical=!1;this.container=this.elm.wrap("<div class='scrollable-table-wrapper'></div>").parent();var e=p.call(this),a=this.false_header_row.closest(".scrollable-table-header-wrapper");this.container.before(a).css({marginTop:-1*
parseFloat(e.find("th:first").css("border-bottom-width"))});this.top_row_height=a.outerHeight();"auto"==this.configs.vertical.height?(e=this.container.parent().height(),this.configs.vertical.height=e-this.top_row_height):this.configs.vertical.height-=this.top_row_height;this.container.scrollbar({show_vertical:!0,vertical:{offset:0,step:"auto"}})};y.height=function(e){A.height.call(this,e-this.top_row_height)};y.destroy=function(){A.destroy.call(this);this.false_header_row.closest(".scrollable-table-header-wrapper").remove();
var e=this.container.find("tr:has(th)");e=this.container.find("table").prepend(e.show());e.parent().replaceWith(e)};y.content=function(e){if(e){var a=e.parentsUntil("tr"),b=this.false_header_row;a.length&&a.each(function(){var e=$(this).index();b=b.children().eq(e)});a=e.index();b=b.children().eq(a);a=e.clone();e.copyDeepEvents(a,!0);b.replaceWith(a)}else p.call(this),this.update();return this.container.find("table")};y.header=function(){return this.false_header_row}})();bm.jquerify("scrollbar",Scrollbar);
bm.jquerify("tscrollbar",TableScroll);bm&&bm.ui_updaters&&bm.ui_updaters.push(function(){this.find(".scrollable").addBack(".scrollable").each(function(){var a=this.jqObject,b=a.scrollbar("inst");b?b.update():(b=a.config("scrollable"),a.is("table")?a.tscrollbar(b):a.scrollbar(b))})});
!function(){var a={settings:{},post:function(e){return new b("post",e)},get:function(e){return new b("get",e)}},b=function(e,b){this.p=this.extend({method:e,url:"",before:function(){},success:function(){},error:function(){},data:!1,async:!0,headers:{}},b);this.p=this.extend(this.p,a.settings);this.p.method=this.p.method.toUpperCase();this.prepareData();this.xhr=new XMLHttpRequest;this.xhr.open(this.p.method,this.p.url,this.p.async);this.setHeaders();!1!==("function"!=typeof this.p.before||this.p.before(this.xhr))&&
this.send()};b.prototype={extend:function(e,a){if(a)for(var b in a)e[b]=a[b];return e},prepareData:function(){"POST"!==this.p.method||this.isFormData()||(this.p.headers["Content-Type"]="application/x-www-form-urlencoded");"object"!=typeof this.p.data||this.isFormData()||(this.p.data=this.toParams(this.p.data));"GET"===this.p.method&&(this.p.url=this.p.data?this.p.url+"?"+this.p.data:this.p.url)},setHeaders:function(){for(var e in this.xhr.setRequestHeader("X-Requested-With",this.p.headers["X-Requested-With"]||
"XMLHttpRequest"),this.p.headers)this.xhr.setRequestHeader(e,this.p.headers[e])},isFormData:function(){return void 0!==window.FormData&&this.p.data instanceof window.FormData},isComplete:function(){return!(200>this.xhr.status||300<=this.xhr.status&&304!==this.xhr.status)},send:function(){this.p.async?(this.xhr.onload=this.loaded.bind(this),this.xhr.send(this.p.data)):(this.xhr.send(this.p.data),this.loaded.call(this))},loaded:function(){if(this.isComplete()){var e=this.xhr.response;e=this.parseJson(e)||
e;"function"==typeof this.p.success&&this.p.success(e,this.xhr)}else"function"==typeof this.p.error&&this.p.error(this.xhr.statusText)},parseJson:function(e){try{var a=JSON.parse(e);if(a&&"object"==typeof a)return a}catch(t){}return!1},toParams:function(e){return Object.keys(e).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(e[a])}).join("&")}};var d=[0],c="data"+new Date,f={},g=function(e,a){return this.parse(e,a)};g.ready=function(e){"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",
e)};g.prototype={get dom(){return!0},get length(){return this.nodes.length},parse:function(e,a){if(e){if(e.dom)return this.nodes=e.nodes,e;e="string"!=typeof e?e.nodeType&&11===e.nodeType?e.childNodes:e.nodeType||e===window?[e]:e:/^\s*<(\w+|!)[^>]*>/.test(e)?this.create(e):this._query(e,a)}else e=[];this.nodes=this._slice(e)},create:function(e){if(/^<(\w+)\s*\/?>(?:<\/\1>|)$/.test(e))return[document.createElement(RegExp.$1)];var a=[],b=document.createElement("div"),c=b.childNodes;b.innerHTML=e;e=
0;for(b=c.length;e<b;e++)a.push(c[e]);return a},add:function(e){this.nodes=this.nodes.concat(this._toArray(e))},get:function(e){return this.nodes[e||0]||!1},getAll:function(){return this.nodes},eq:function(e){return new g(this.nodes[e])},first:function(){return new g(this.nodes[0])},last:function(){return new g(this.nodes[this.nodes.length-1])},contents:function(){return this.get().childNodes},each:function(e){for(var a=this.nodes.length,b=0;b<a;b++)e.call(this,this.nodes[b].dom?this.nodes[b].get():
this.nodes[b],b);return this},is:function(e){return 0<this.filter(e).length},filter:function(e){var a;return void 0===e?this:(a="function"==typeof e?e:function(a){return e instanceof Node?e===a:e&&e.dom?-1!==e.nodes.indexOf(a):(a.matches=a.matches||a.msMatchesSelector||a.webkitMatchesSelector,1===a.nodeType&&a.matches(e||"*"))},new g(this.nodes.filter(a)))},not:function(e){return this.filter(function(a){return!(new g(a)).is(e||!0)})},find:function(e){var a=[];return this.each(function(b){b=this._query(e||
"*",b);for(var c=0;c<b.length;c++)a.push(b[c])}),new g(a)},children:function(e){var a=[];return this.each(function(e){if(e.children){e=e.children;for(var b=0;b<e.length;b++)a.push(e[b])}}),(new g(a)).filter(e)},parent:function(e){var a=[];return this.each(function(e){e.parentNode&&a.push(e.parentNode)}),(new g(a)).filter(e)},parents:function(e,a){a=this._getContext(a);var b=[];return this.each(function(c){for(c=c.parentNode;c&&c!==a;)e?(new g(c)).is(e)&&b.push(c):b.push(c),c=c.parentNode}),new g(b)},
closest:function(e,a){a=this._getContext(a);var b=[],c=(e=e.dom?e.get():e)&&e.nodeType;return this.each(function(d){do if(c&&d===e||(new g(d)).is(e))return b.push(d);while((d=d.parentNode)&&d!==a)}),new g(b)},next:function(e){return this._getSibling(e,"nextSibling")},nextElement:function(e){return this._getSibling(e,"nextElementSibling")},prev:function(e){return this._getSibling(e,"previousSibling")},prevElement:function(e){return this._getSibling(e,"previousElementSibling")},css:function(e,a){if(void 0===
a&&"object"!=typeof e){var b=this.get();return"width"===e||"height"===e?b.style?this._getHeightOrWidth(e,b,!1)+"px":void 0:b.style?getComputedStyle(b,null)[e]:void 0}return this.each(function(b){var c={},d;for(d in"object"==typeof e?c=e:c[e]=a,c)b.style&&(b.style[d]=c[d])})},attr:function(e,a,b){if(b=b?"data-":"",void 0===a&&"object"!=typeof e){var c=this.get();return c&&3!==c.nodeType?"checked"===e?c.checked:this._getBooleanFromStr(c.getAttribute(b+e)):void 0}return this.each(function(c){var d={},
f;for(f in"object"==typeof e?d=e:d[e]=a,d)3!==c.nodeType&&("checked"===f?c.checked=d[f]:c.setAttribute(b+f,d[f]))})},data:function(e,a){if(void 0===e){e=/^data\-(.+)$/;a=this.get().attributes;var b={},c=function(e){return e[1].toUpperCase()},d;for(d in a)if(e.test(a[d].nodeName)){var f=a[d].nodeName.match(e)[1],p=a[d].value;f=f.replace(/-([a-z])/g,c);p=this._isObjectString(p)?this._toObject(p):this._isNumber(p)?parseFloat(p):this._getBooleanFromStr(p);b[f]=p}return b}return this.attr(e,a,!0)},val:function(e){if(void 0===
e){var a=this.get();return a.type&&"checkbox"===a.type?a.checked:a.value}return this.each(function(a){a.value=e})},removeAttr:function(e){return this.each(function(a){e.split(" ").forEach(function(e){3!==a.nodeType&&a.removeAttribute(e)})})},removeData:function(e){return this.each(function(a){e.split(" ").forEach(function(e){3!==a.nodeType&&a.removeAttribute("data-"+e)})})},dataset:function(e,a){return this.each(function(b){d[this.dataindex(b)][e]=a})},dataget:function(e){return d[this.dataindex(this.get())][e]},
dataindex:function(e){var a=e[c],b=d.length;return a||(a=e[c]=b,d[a]={}),a},addClass:function(e){return this._eachClass(e,"add")},removeClass:function(e){return this._eachClass(e,"remove")},toggleClass:function(e){return this._eachClass(e,"toggle")},hasClass:function(e){return this.nodes.some(function(a){return!!a.classList&&a.classList.contains(e)})},empty:function(){return this.each(function(e){e.innerHTML=""})},html:function(e){return void 0===e?this.get().innerHTML||"":this.empty().append(e)},
text:function(e){return void 0===e?this.get().textContent||"":this.each(function(a){a.textContent=e})},after:function(e){return this._inject(e,function(e,a){if("string"==typeof e)a.insertAdjacentHTML("afterend",e);else{e=e instanceof Node?[e]:this._toArray(e).reverse();for(var b=0;b<e.length;b++)a.parentNode.insertBefore(e[b],a.nextSibling)}return a})},before:function(e){return this._inject(e,function(e,a){if("string"==typeof e)a.insertAdjacentHTML("beforebegin",e);else{e=e instanceof Node?[e]:this._toArray(e);
for(var b=0;b<e.length;b++)a.parentNode.insertBefore(e[b],a)}return a})},append:function(e){return this._inject(e,function(e,a){if("string"==typeof e||"number"==typeof e)a.insertAdjacentHTML("beforeend",e);else{e=e instanceof Node?[e]:this._toArray(e);for(var b=0;b<e.length;b++)a.appendChild(e[b])}return a})},prepend:function(e){return this._inject(e,function(e,a){if("string"==typeof e||"number"==typeof e)a.insertAdjacentHTML("afterbegin",e);else{e=e instanceof Node?[e]:this._toArray(e).reverse();
for(var b=0;b<e.length;b++)a.insertBefore(e[b],a.firstChild)}return a})},wrap:function(e){return this._inject(e,function(e,a){e="string"==typeof e||"number"==typeof e?this.create(e)[0]:e instanceof Node?e:this._toArray(e)[0];return a.parentNode&&a.parentNode.insertBefore(e,a),e.appendChild(a),new g(e)})},unwrap:function(){return this.each(function(e){e=new g(e);return e.replaceWith(e.contents())})},replaceWith:function(e){return this._inject(e,function(e,a){var b=document.createDocumentFragment();
e="string"==typeof e||"number"==typeof e?this.create(e):e instanceof Node?[e]:this._toArray(e);for(var c=0;c<e.length;c++)b.appendChild(e[c]);e=b.childNodes[0];return a.parentNode.replaceChild(b,a),e})},remove:function(){return this.each(function(e){e.parentNode&&e.parentNode.removeChild(e)})},clone:function(e){var a=[];return this.each(function(b){var c=this._clone(b);e&&(c=this._cloneEvents(b,c));a.push(c)}),new g(a)},show:function(){return this.each(function(e){if(e.style&&"none"===this._getRealDisplay(e)){var a=
e.getAttribute("displayOld");if(e.style.display=a||"","none"===this._getRealDisplay(e)){var b=e.nodeName,c=document.body;if(f[b])a=f[b];else{var d=document.createElement(b);c.appendChild(d);"none"===(a=this._getRealDisplay(d))&&(a="block");c.removeChild(d);f[b]=a}e.setAttribute("displayOld",a);e.style.display=a}}}.bind(this))},hide:function(){return this.each(function(e){e.style&&(e.getAttribute("displayOld")||""===e.style.display||e.setAttribute("displayOld",e.style.display),e.style.display="none")})},
scrollTop:function(e){var a=this.get(),b=a===window,c=9===a.nodeType;a=c?document.scrollingElement||document.body.parentNode||document.body||document.documentElement:a;if(void 0===e)return c?void 0!==window.pageYOffset?window.pageYOffset:document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0:b?window.pageYOffset:a.scrollTop;b?window.scrollTo(0,e):a.scrollTop=e},offset:function(){return this._getDim("Offset")},position:function(){return this._getDim("Position")},
width:function(e,a){return this._getSize("width","Width",e,a)},height:function(e,a){return this._getSize("height","Height",e,a)},outerWidth:function(){return this._getInnerOrOuter("width","outer")},outerHeight:function(){return this._getInnerOrOuter("height","outer")},innerWidth:function(){return this._getInnerOrOuter("width","inner")},innerHeight:function(){return this._getInnerOrOuter("height","inner")},click:function(){return this._triggerEvent("click")},focus:function(){return this._triggerEvent("focus")},
trigger:function(e){return this.each(function(a){for(var b=e.split(" "),c=0;c<b.length;c++){try{var d=new window.CustomEvent(b[c],{bubbles:!0,cancelable:!0})}catch(A){(d=document.createEvent("CustomEvent")).initCustomEvent(b[c],!0,!0)}a.dispatchEvent(d)}})},on:function(e,a,b){return this.each(function(c){for(var d=e.split(" "),f=0;f<d.length;f++){var p=this._getEventName(d[f]),l=this._getEventNamespace(d[f]);a=b?this._getOneHandler(a,e):a;c.addEventListener(p,a);c._e=c._e||{};c._e[l]=c._e[l]||{};
c._e[l][p]=c._e[l][p]||[];c._e[l][p].push(a)}})},one:function(e,a){return this.on(e,a,!0)},off:function(e,a){var b=function(e,a,b){return e===b},c=function(e,a,b,c){return a===c},d=function(e,a,b,c){return e===b&&a===c},f=function(){return!0};return void 0===e?this.each(function(e){this._offEvent(e,!1,!1,a,f)}):this.each(function(f){for(var p=e.split(" "),l=0;l<p.length;l++){var g=this._getEventName(p[l]),m=this._getEventNamespace(p[l]);"_events"===m?this._offEvent(f,g,m,a,b):g||"_events"===m?this._offEvent(f,
g,m,a,d):this._offEvent(f,g,m,a,c)}})},serialize:function(e){for(var a={},b=this.get().elements,c=0;c<b.length;c++){var d=b[c];if((!/(checkbox|radio)/.test(d.type)||d.checked)&&d.name&&!d.disabled&&"file"!==d.type){if("select-multiple"===d.type)for(var f=0;f<d.options.length;f++){var l=d.options[f];l.selected&&(a[d.name]=l.value)}a[d.name]=d.value}}return e?a:this._toParams(a)},ajax:function(e,a){if(void 0!==b){var c=this.attr("method")||"post";e={url:this.attr("action"),data:this.serialize(),success:e,
error:a};return new b(c,e)}},_queryContext:function(e,a){return 3!==(a=this._getContext(a)).nodeType&&"function"==typeof a.querySelectorAll?a.querySelectorAll(e):[]},_query:function(e,a){return a?this._queryContext(e,a):/^[.#]?[\w-]*$/.test(e)?"#"===e[0]?(e=document.getElementById(e.slice(1)))?[e]:[]:"."===e[0]?document.getElementsByClassName(e.slice(1)):document.getElementsByTagName(e):document.querySelectorAll(e)},_getContext:function(e){return(e="string"==typeof e?document.querySelector(e):e)&&
e.dom?e.get():e||document},_inject:function(e,a){for(var b=this.nodes.length,c=[];b--;){var d="function"==typeof e?e.call(this,this.nodes[b]):e;d=0===b?d:this._clone(d);(d=a.call(this,d,this.nodes[b]))&&(d.dom?c.push(d.get()):c.push(d))}return new g(c)},_cloneEvents:function(e,a){if(e=e._e)for(var b in a._e=e,e._events)for(var c=0;c<e._events[b].length;c++)a.addEventListener(b,e._events[b][c]);return a},_clone:function(e){if(void 0!==e)return"string"==typeof e?e:e instanceof Node?e.cloneNode(!0):
"length"in e?[].map.call(this._toArray(e),function(e){return e.cloneNode(!0)}):e},_slice:function(e){return e&&0!==e.length?e.length?[].slice.call(e.nodes||e):[e]:[]},_eachClass:function(e,a){return this.each(function(b){e&&e.split(" ").forEach(function(e){b.classList&&b.classList[a](e)})})},_triggerEvent:function(e){var a=this.get();return a&&3!==a.nodeType&&a[e](),this},_getOneHandler:function(e,a){var b=this;return function(){e.apply(this,arguments);b.off(a)}},_getEventNamespace:function(e){e=
e.split(".");var a=e[1]?e[1]:"_events";return e[2]?a+e[2]:a},_getEventName:function(e){return e.split(".")[0]},_offEvent:function(e,a,b,c,d){for(var f in e._e)for(var p in e._e[f])if(d(p,f,a,b))for(var l=e._e[f][p],g=0;g<l.length;g++)void 0!==c&&l[g].toString()!==c.toString()||(e.removeEventListener(p,l[g]),e._e[f][p].splice(g,1),0===e._e[f][p].length&&delete e._e[f][p],0===Object.keys(e._e[f]).length&&delete e._e[f])},_getInnerOrOuter:function(e,a){return this[e](void 0,a)},_getDocSize:function(e,
a){var b=e.body;e=e.documentElement;return Math.max(b["scroll"+a],b["offset"+a],e["client"+a],e["scroll"+a],e["offset"+a])},_getSize:function(e,a,b,c){if(void 0===b){var d=this.get();return b=3===d.nodeType?0:9===d.nodeType?this._getDocSize(d,a):d===window?window["inner"+a]:this._getHeightOrWidth(e,d,c||"normal"),Math.round(b)}return this.each(function(a){b=parseFloat(b);b+=this._adjustResultHeightOrWidth(e,a,c||"normal");(new g(a)).css(e,b+"px")}.bind(this))},_getHeightOrWidth:function(e,a,b){var c=
e.charAt(0).toUpperCase()+e.slice(1),d=getComputedStyle(a,null),f=new g(a),p=0,l=f.parents().filter(function(e){return"none"===getComputedStyle(e,null).display&&e});if("none"===d.display&&l.add(a),0!==l.length){var m=[];l.each(function(e){e=new g(e);var a=e.attr("style");null!==a&&m.push(a);e.attr("style",null!==a?a+";visibility: hidden !important; display: block !important;":"visibility: hidden !important; display: block !important;")});p=f.get()["offset"+c]-this._adjustResultHeightOrWidth(e,a,b);
l.each(function(e,a){e=new g(e);void 0===m[a]?e.removeAttr("style"):e.attr("style",m[a])})}else p=a["offset"+c]-this._adjustResultHeightOrWidth(e,a,b);return p},_adjustResultHeightOrWidth:function(e,a,b){if(!a||!1===b)return 0;var c=0;a=getComputedStyle(a,null);var d="border-box"===a.boxSizing;return"height"===e?(("inner"===b||"normal"===b&&d)&&(c+=(parseFloat(a.borderTopWidth)||0)+(parseFloat(a.borderBottomWidth)||0)),"outer"===b&&(c-=(parseFloat(a.marginTop)||0)+(parseFloat(a.marginBottom)||0))):
(("inner"===b||"normal"===b&&d)&&(c+=(parseFloat(a.borderLeftWidth)||0)+(parseFloat(a.borderRightWidth)||0)),"outer"===b&&(c-=(parseFloat(a.marginLeft)||0)+(parseFloat(a.marginRight)||0))),c},_getDim:function(e){var a=this.get();return 3===a.nodeType?{top:0,left:0}:this["_get"+e](a)},_getPosition:function(e){return{top:e.offsetTop,left:e.offsetLeft}},_getOffset:function(e){var a=e.getBoundingClientRect(),b=e.ownerDocument;e=b.documentElement;b=b.defaultView;return{top:a.top+b.pageYOffset-e.clientTop,
left:a.left+b.pageXOffset-e.clientLeft}},_getSibling:function(e,a){var b,c=(e=e&&e.dom?e.get():e)&&e.nodeType;return this.each(function(d){for(;d=d[a];)if(c&&d===e||(new g(d)).is(e))return void(b=d)}),new g(b)},_toArray:function(e){if(e instanceof NodeList){for(var a=[],b=0;b<e.length;b++)a[b]=e[b];return a}return void 0===e?[]:e.dom?e.nodes:e},_toParams:function(e){var a="",b;for(b in e)a+="&"+this._encodeUri(b)+"="+this._encodeUri(e[b]);return a.replace(/^&/,"")},_toObject:function(e){return(new Function("return "+
e))()},_encodeUri:function(e){return encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")},_isNumber:function(e){return!isNaN(e)&&!isNaN(parseFloat(e))},_isObjectString:function(e){return-1!==e.search(/^{/)},_getBooleanFromStr:function(e){return"true"===e||"false"!==e&&e},_getRealDisplay:function(e){return e.currentStyle?e.currentStyle.display:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue("display"):
void 0}};var m=0,l=function(e,a){return n(e,a,[].slice.call(arguments,2))};l.version="3.0.9";l.options={};l.modules={};l.services={};l.classes={};l.plugins={};l.mixins={};l.modals={};l.lang={};l.dom=function(e,a){return new g(e,a)};l.ajax=a;l.Dom=g;l.keycodes={BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37};l.env={plugin:"plugins",module:"modules",service:"services",class:"classes",mixin:"mixins"};"undefined"!=typeof jQuery&&(jQuery.fn.redactor=
function(e){return n(this.toArray(),e,[].slice.call(arguments,1))});var n=function(e,a,b){var c;e=Array.isArray(e)?e:e&&e.nodeType?[e]:document.querySelectorAll(e);for(var d="string"==typeof a||"function"==typeof a,f=[],p=0;p<e.length;p++){var g=e[p],t=l.dom(g);if((c=t.dataget("redactor"))||d||(t.dataset("redactor",c=new q(g,a,m)),m++),c&&d){var n;g="destroy"===a;"function"==typeof(a=g?"stop":a)?n=a.apply(c,b):(b.unshift(a),n=c.api.apply(c,b));void 0!==n&&f.push(n);g&&t.dataset("redactor",!1)}}return 0===
f.length||1===f.length?0===f.length?c:f[0]:f};l.add=function(e,a,b){if(void 0!==l.env[e])if(b.translations&&(l.lang=l.extend(!0,{},l.lang,b.translations)),b.modals&&(l.modals=l.extend(!0,{},l.modals,b.modals)),"mixin"===e)l[l.env[e]][a]=b;else{var c=function(){};if(c.prototype=b,b.mixins)for(var d=0;d<b.mixins.length;d++)l.inherit(c,l.mixins[b.mixins[d]]);l[l.env[e]][a]=c}};l.addLang=function(e,a){void 0===l.lang[e]&&(l.lang[e]={});l.lang[e]=l.extend(l.lang[e],a)};l.create=function(e){var a=e.split("."),
b=[].slice.call(arguments,1),c="classes";void 0!==l.env[a[0]]&&(c=l.env[a[0]],e=a.slice(1).join("."));a=new l[c][e];return a.init?a.init.apply(a,b)||a:a};l.inherit=function(e,a){var b=function(){};b.prototype=a;b=new b;for(var c in e.prototype)e.prototype.__lookupGetter__(c)?b.__defineGetter__(c,e.prototype.__lookupGetter__(c)):b[c]=e.prototype[c];return e.prototype=b,e.prototype.super=a,e};l.error=function(e){throw e;};l.extend=function(){var e={},a=!1,b=0,c=arguments.length;for("[object Boolean]"===
Object.prototype.toString.call(arguments[0])&&(a=arguments[0],b++);b<c;b++){var d=void 0,f=arguments[b];for(d in f)Object.prototype.hasOwnProperty.call(f,d)&&(a&&"[object Object]"===Object.prototype.toString.call(f[d])?e[d]=l.extend(!0,e[d],f[d]):e[d]=f[d])}return e};l.opts={animation:!0,lang:"en",direction:"ltr",spellcheck:!0,structure:!1,scrollTarget:!1,styles:!0,stylesClass:"redactor-styles",placeholder:!1,source:!0,showSource:!1,inline:!1,breakline:!1,markup:"p",enterKey:!0,clickToEdit:!1,clickToSave:!1,
clickToCancel:!1,focus:!1,focusEnd:!1,minHeight:!1,maxHeight:!1,maxWidth:!1,plugins:[],callbacks:{},preClass:!1,preSpaces:4,tabindex:!1,tabAsSpaces:!1,tabKey:!0,autosave:!1,autosaveName:!1,autosaveData:!1,toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarContext:!0,air:!1,formatting:"p blockquote pre h1 h2 h3 h4 h5 h6".split(" "),formattingAdd:!1,formattingHide:!1,buttons:"html format bold italic deleted lists image file link".split(" "),buttonsTextLabeled:!1,
buttonsAdd:[],buttonsAddFirst:[],buttonsAddAfter:!1,buttonsAddBefore:!1,buttonsHide:[],buttonsHideOnMobile:[],imageUpload:!1,imageUploadParam:"file",imageData:!1,imageEditable:!0,imageCaption:!0,imagePosition:!1,imageResizable:!1,imageFloatMargin:"10px",imageFigure:!0,fileUpload:!1,fileUploadParam:"file",fileData:!1,fileAttachment:!1,uploadData:!1,dragUpload:!0,multipleUpload:!0,clipboardUpload:!0,uploadBase64:!1,linkTarget:!1,linkTitle:!1,linkNewTab:!1,linkNofollow:!1,linkSize:30,linkValidation:!0,
cleanOnEnter:!0,cleanInlineOnEnter:!1,paragraphize:!0,removeScript:!0,removeNewLines:!1,removeComments:!0,replaceTags:{b:"strong",i:"em",strike:"del"},pastePlainText:!1,pasteLinkTarget:!1,pasteImages:!0,pasteLinks:!0,pasteClean:!0,pasteKeepStyle:[],pasteKeepClass:[],pasteKeepAttrs:["td","th"],pasteBlockTags:"pre h1 h2 h3 h4 h5 h6 table tbody thead tfoot th tr td ul ol li blockquote p figure figcaption".split(" "),pasteInlineTags:"a img br strong ins code del span samp kbd sup sub mark var cite small b u em i abbr".split(" "),
activeButtons:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",u:"underline"},activeButtonsAdd:{},activeButtonsObservers:{},autoparse:!0,autoparseStart:!0,autoparsePaste:!0,autoparseLinks:!0,autoparseImages:!0,autoparseVideo:!0,shortcodes:{"p.":{format:"p"},"quote.":{format:"blockquote"},"pre.":{format:"pre"},"h1.":{format:"h1"},"h2.":{format:"h2"},"h3.":{format:"h3"},"h4.":{format:"h4"},"h5.":{format:"h5"},"h6.":{format:"h6"},"1.":{format:"ol"},"*.":{format:"ul"}},shortcodesAdd:!1,
shortcuts:{"ctrl+shift+m, meta+shift+m":{api:"module.inline.clearformat"},"ctrl+b, meta+b":{api:"module.inline.format",args:"b"},"ctrl+i, meta+i":{api:"module.inline.format",args:"i"},"ctrl+u, meta+u":{api:"module.inline.format",args:"u"},"ctrl+h, meta+h":{api:"module.inline.format",args:"sup"},"ctrl+l, meta+l":{api:"module.inline.format",args:"sub"},"ctrl+k, meta+k":{api:"module.link.open"},"ctrl+alt+0, meta+alt+0":{api:"module.block.format",args:"p"},"ctrl+alt+1, meta+alt+1":{api:"module.block.format",
args:"h1"},"ctrl+alt+2, meta+alt+2":{api:"module.block.format",args:"h2"},"ctrl+alt+3, meta+alt+3":{api:"module.block.format",args:"h3"},"ctrl+alt+4, meta+alt+4":{api:"module.block.format",args:"h4"},"ctrl+alt+5, meta+alt+5":{api:"module.block.format",args:"h5"},"ctrl+alt+6, meta+alt+6":{api:"module.block.format",args:"h6"},"ctrl+shift+7, meta+shift+7":{api:"module.list.toggle",args:"ol"},"ctrl+shift+8, meta+shift+8":{api:"module.list.toggle",args:"ul"}},shortcutsAdd:!1,grammarly:!0,bufferLimit:100,
emptyHtml:"<p></p>",markerChar:"\ufeff",imageTypes:["image/png","image/jpeg","image/gif"],inlineTags:"a span strong strike b u em i code del ins samp kbd sup sub mark var cite small abbr".split(" "),blockTags:"pre ul ol li p h1 h2 h3 h4 h5 h6 dl dt dd div table tbody thead tfoot tr th td blockquote output figcaption figure address section header footer aside article iframe".split(" "),regex:{youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,
vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/gi,imageurl:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi},input:!0,zindex:!1,modes:{inline:{pastePlainText:!0,pasteImages:!1,enterKey:!1,toolbar:!1,autoparse:!1,source:!1,showSource:!1,styles:!1,air:!1},original:{styles:!1}}};l.lang.en={format:"Format",image:"Image",file:"File",link:"Link",bold:"Bold",italic:"Italic",deleted:"Strikethrough",underline:"Underline",
superscript:"Superscript",subscript:"Subscript","bold-abbr":"B","italic-abbr":"I","deleted-abbr":"S","underline-abbr":"U","superscript-abbr":"Sup","subscript-abbr":"Sub",lists:"Lists","link-insert":"Insert Link","link-edit":"Edit Link","link-in-new-tab":"Open link in new tab",unlink:"Unlink",cancel:"Cancel",close:"Close",insert:"Insert",save:"Save",delete:"Delete",text:"Text",edit:"Edit",title:"Title",paragraph:"Normal text",quote:"Quote",code:"Code",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",
heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",filename:"Name",optional:"optional",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",horizontalrule:"Line",upload:"Upload","upload-label":"Drop files here or click to upload","accessibility-help-label":"Rich text editor",caption:"Caption",bulletslist:"Bullets",numberslist:"Numbers","image-position":"Position",none:"None",left:"Left",right:"Right",center:"Center",undo:"Undo",redo:"Redo"};l.buttons=
{html:{title:"HTML",icon:!0,api:"module.source.toggle"},undo:{title:"## undo ##",icon:!0,api:"module.buffer.undo"},redo:{title:"## redo ##",icon:!0,api:"module.buffer.redo"},format:{title:"## format ##",icon:!0,dropdown:{p:{title:"## paragraph ##",api:"module.block.format",args:{tag:"p"}},blockquote:{title:"## quote ##",api:"module.block.format",args:{tag:"blockquote"}},pre:{title:"## code ##",api:"module.block.format",args:{tag:"pre"}},h1:{title:"## heading1 ##",api:"module.block.format",args:{tag:"h1"}},
h2:{title:"## heading2 ##",api:"module.block.format",args:{tag:"h2"}},h3:{title:"## heading3 ##",api:"module.block.format",args:{tag:"h3"}},h4:{title:"## heading4 ##",api:"module.block.format",args:{tag:"h4"}},h5:{title:"## heading5 ##",api:"module.block.format",args:{tag:"h5"}},h6:{title:"## heading6 ##",api:"module.block.format",args:{tag:"h6"}}}},bold:{title:"## bold-abbr ##",icon:!0,tooltip:"## bold ##",api:"module.inline.format",args:{tag:"b"}},italic:{title:"## italic-abbr ##",icon:!0,tooltip:"## italic ##",
api:"module.inline.format",args:{tag:"i"}},deleted:{title:"## deleted-abbr ##",icon:!0,tooltip:"## deleted ##",api:"module.inline.format",args:{tag:"del"}},underline:{title:"## underline-abbr ##",icon:!0,tooltip:"## underline ##",api:"module.inline.format",args:{tag:"u"}},sup:{title:"## superscript-abbr ##",icon:!0,tooltip:"## superscript ##",api:"module.inline.format",args:{tag:"sup"}},sub:{title:"## subscript-abbr ##",icon:!0,tooltip:"## subscript ##",api:"module.inline.format",args:{tag:"sub"}},
lists:{title:"## lists ##",icon:!0,observe:"list",dropdown:{observe:"list",unorderedlist:{title:"&bull; ## unorderedlist ##",api:"module.list.toggle",args:"ul"},orderedlist:{title:"1. ## orderedlist ##",api:"module.list.toggle",args:"ol"},outdent:{title:"< ## outdent ##",api:"module.list.outdent"},indent:{title:"> ## indent ##",api:"module.list.indent"}}},ul:{title:"&bull; ## bulletslist ##",icon:!0,api:"module.list.toggle",observe:"list",args:"ul"},ol:{title:"1. ## numberslist ##",icon:!0,api:"module.list.toggle",
observe:"list",args:"ol"},outdent:{title:"## outdent ##",icon:!0,api:"module.list.outdent",observe:"list"},indent:{title:"## indent ##",icon:!0,api:"module.list.indent",observe:"list"},image:{title:"## image ##",icon:!0,api:"module.image.open"},file:{title:"## file ##",icon:!0,api:"module.file.open"},link:{title:"## link ##",icon:!0,observe:"link",dropdown:{observe:"link",link:{title:"## link-insert ##",api:"module.link.open"},unlink:{title:"## unlink ##",api:"module.link.unlink"}}},line:{title:"## horizontalrule ##",
icon:!0,api:"module.line.insert"}};var q=function(e,a,b){this.module={};this.plugin={};this.instances={};this.stopped=this.started=!1;this.uuid=b;this.rootElement=e;this.rootOpts=a;this.dragComponentInside=this.dragInside=!1;this.keycodes=l.keycodes;this.namespace="redactor";this.$win=l.dom(window);this.$doc=l.dom(document);this.$body=l.dom("body");this.editorReadOnly=!1;this.opts=l.create("service.options",a,e);this.lang=l.create("service.lang",this);this.buildServices();this.buildModules();this.buildPlugins();
this.start()};q.prototype={start:function(){this.stopped=!1;this.broadcast("start");this.broadcast("startcode");this.opts.clickToEdit?this.broadcast("startclicktoedit"):(this.broadcast("enable"),this.opts.showSource&&this.broadcast("startcodeshow"),this.broadcast("enablefocus"));this.broadcast("started");this.started=!0},stop:function(){this.started=!1;this.stopped=!0;this.broadcast("stop");this.broadcast("disable");this.broadcast("stopped")},isStarted:function(){return this.started},isStopped:function(){return this.stopped},
buildServices:function(){var e=["options","lang"],a="uuid keycodes opts lang $win $doc $body".split(" "),b=[];for(c in l.services)-1===e.indexOf(c)&&(this[c]=l.create("service."+c,this),b.push(c),a.push(c));for(e=0;e<b.length;e++){var c=b[e];for(var d=0;d<a.length;d++){var f=a[d];c!==f&&(this[c][f]=this[f])}}},buildModules:function(){for(var e in l.modules)this.module[e]=l.create("module."+e,this),this.instances[e]=this.module[e]},buildPlugins:function(){for(var e=this.opts.plugins,a=0;a<e.length;a++){var b=
e[a];void 0!==l.plugins[b]&&(this.plugin[b]=l.create("plugin."+b,this),this.instances[b]=this.plugin[b])}},isDragInside:function(){return this.dragInside},setDragInside:function(e){this.dragInside=e},isDragComponentInside:function(){return this.dragComponentInside},setDragComponentInside:function(e){this.dragComponentInside=e},getDragComponentInside:function(){return this.dragComponentInside},isReadOnly:function(){return this.editorReadOnly},enableReadOnly:function(){this.editorReadOnly=!0;this.broadcast("enablereadonly");
this.component.clearActive();this.toolbar.disableButtons()},disableReadOnly:function(){this.editorReadOnly=!1;this.broadcast("disablereadonly");this.toolbar.enableButtons()},callMessageHandler:function(e,a,b){var c=a.split(".");1===c.length?"function"==typeof e["on"+a]&&e["on"+a].apply(e,b):(c[0]="on"+c[0],a=this.utils.checkProperty(e,c),"function"==typeof a&&a.apply(e,b))},broadcast:function(e){var a=[].slice.call(arguments,1),b;for(b in this.instances)this.callMessageHandler(this.instances[b],e,
a);return this.callback.trigger(e,a)},on:function(e,a){this.callback.add(e,a)},off:function(e,a){this.callback.remove(e,a)},api:function(e){if(!(!this.isStarted()&&"start"!==e||this.isReadOnly()&&"disableReadOnly"!==e)){this.broadcast("state");var a=[].slice.call(arguments,1),b=e.split("."),c="on"===b[0]||"off"===b[0],d=!c&&2===b.length,f="plugin"===b[0],g="module"===b[0];if(1===b.length){if("function"==typeof this[b[0]])return this.callInstanceMethod(this,b[0],a)}else{if(c)return"on"===b[0]?this.on(b[1],
a[0]):this.off(b[1],a[0]||void 0);if(d){if(this.isInstanceExists(this,b[0]))return this.callInstanceMethod(this[b[0]],b[1],a);l.error(Error('Service "'+b[0]+'" not found'))}else if(f){if(this.isInstanceExists(this.plugin,b[1]))return this.callInstanceMethod(this.plugin[b[1]],b[2],a);l.error(Error('Plugin "'+b[1]+'" not found'))}else if(g){if(this.isInstanceExists(this.module,b[1]))return this.callInstanceMethod(this.module[b[1]],b[2],a);l.error(Error('Module "'+b[1]+'" not found'))}}}},isInstanceExists:function(e,
a){return void 0!==e[a]},callInstanceMethod:function(e,a,b){if("function"==typeof e[a])return e[a].apply(e,b)}};l.add("mixin","formatter",{buildArgs:function(e){this.args={class:e.class||!1,style:e.style||!1,attr:e.attr||!1};this.args.class||this.args.style||this.args.attr||(this.args=!1)},applyArgs:function(e,a){return this.args?this[this.type](this.args,!1,e,a):this._clearAll(e,a)},clearClass:function(e,a){this.selection.save();e=a?l.dom(a):this.getElements(e,!0);return e.removeAttr("class"),a=
this._unwrapSpanWithoutAttr(e.getAll()),this.selection.restore(),a},clearStyle:function(e,a){this.selection.save();e=a?l.dom(a):this.getElements(e,!0);return e.removeAttr("style"),a=this._unwrapSpanWithoutAttr(e.getAll()),this.selection.restore(),a},clearAttr:function(e,a){this.selection.save();e=a?l.dom(a):this.getElements(e,!0);return this._removeAllAttr(e),a=this._unwrapSpanWithoutAttr(e.getAll()),this.selection.restore(),a},set:function(e,a,b,c){!1!==c&&this.selection.save();a=b?l.dom(b):this.getElements(a);
return e.class&&(a.removeAttr("class"),a.addClass(e.class)),e.style&&(a.removeAttr("style"),a.css(e.style),a.each(function(a){a=l.dom(a);a.attr("data-redactor-style-cache",a.attr("style"))})),e.attr&&(this._removeAllAttr(a),a.attr(e.attr)),!1!==c&&this.selection.restore(),a.getAll()},toggle:function(a,b,c,d){!1!==d&&this.selection.save();var e;b=c?l.dom(c):this.getElements(b);return a.class&&b.toggleClass(a.class),a.style&&(e=a.style,b.each(function(a){var b=l.dom(a),c;for(c in e){var d=e[c],f=b.css(c);
f=this.utils.isRgb(f)?this.utils.rgb2hex(f):f.replace(/"/g,"");d=this.utils.isRgb(d)?this.utils.rgb2hex(d):d.replace(/"/g,"");f=this.utils.hex2long(f);("string"==typeof(d=this.utils.hex2long(d))?d.toLowerCase():d)===("string"==typeof f?f.toLowerCase():f)?b.css(c,""):b.css(c,d)}this._convertStyleQuotes(b);this.utils.removeEmptyAttr(a,"style")?b.removeAttr("data-redactor-style-cache"):b.attr("data-redactor-style-cache",b.attr("style"))}.bind(this))),a.attr&&(e=a.attr,b.each(function(a){a=l.dom(a);for(var b in e)a.attr(b)?
a.removeAttr(b):a.attr(b,e[b])})),!1!==d&&this.selection.restore(),b.getAll()},add:function(a,b,c,d){!1!==d&&this.selection.save();b=c?l.dom(c):this.getElements(b);if(a.class&&b.addClass(a.class),a.style){var e=a.style;b.each(function(a){a=l.dom(a);a.css(e);a.attr("data-redactor-style-cache",a.attr("style"));this._convertStyleQuotes(a)}.bind(this))}return a.attr&&b.attr(a.attr),!1!==d&&this.selection.restore(),b.getAll()},remove:function(a,b,c,d){!1!==d&&this.selection.save();b=c?l.dom(c):this.getElements(b);
if(a.class&&b.removeClass(a.class),a.style){var e=a.style;b.each(function(a){var b=l.dom(a);b.css(e,"");this.utils.removeEmptyAttr(a,"style")?b.removeAttr("data-redactor-style-cache"):b.attr("data-redactor-style-cache",b.attr("style"))}.bind(this))}return a.attr&&b.removeAttr(a.attr),c=this._unwrapSpanWithoutAttr(b.getAll()),!1!==d&&this.selection.restore(),c},_removeAllAttr:function(a){a.each(function(a){for(var e=a.attributes.length;0<e--;){var b=a.attributes[e],c=b.name;"style"!==c&&"class"!==
c&&a.removeAttributeNode(b)}})},_convertStyleQuotes:function(a){var e=a.attr("style");e&&a.attr("style",e.replace(/"/g,"'"))},_clearAll:function(a,b){!1!==b&&this.selection.save();for(var e=0;e<a.length;e++)for(var c=a[e];0<c.attributes.length;)c.removeAttribute(c.attributes[0].name);return a=this._unwrapSpanWithoutAttr(a),!1!==b&&this.selection.restore(),a},_unwrapSpanWithoutAttr:function(a){for(var e=[],b=0;b<a.length;b++){var c=a[b];0>=c.attributes.length&&3!==c.nodeType&&"SPAN"===c.tagName?l.dom(c).unwrap():
e.push(c)}return e}});l.add("mixin","dom",l.Dom.prototype);l.add("mixin","component",{get cmnt(){return!0}});l.add("service","options",{init:function(a,b){var e=l.dom(b);b=l.extend({},l.opts,b?e.data():{},l.options);return l.extend(!0,b,a)}});l.add("service","lang",{init:function(a){this.app=a;this.opts=a.opts;this.vars=this._build(this.opts.lang)},rebuild:function(a){this.opts.lang=a;this.vars=this._build(a)},extend:function(a){this.vars=l.extend(this.vars,a)},parse:function(a){if(void 0===a)return"";
var e=a.match(/## (.*?) ##/g);if(e)for(var b=0;b<e.length;b++){var c=e[b].replace(/^##\s/g,"").replace(/\s##$/g,"");a=a.replace(e[b],this.get(c))}return a},get:function(a){var e="";return void 0!==this.vars[a]?e=this.vars[a]:"en"!==this.opts.lang&&void 0!==l.lang.en[a]&&(e=l.lang.en[a]),e},_build:function(a){var e=l.lang.en;return"en"!==a&&(e=void 0!==l.lang[a]?l.lang[a]:e),e}});l.add("service","callback",{init:function(a){this.app=a;this.opts=a.opts;this.callbacks={};this.opts.callbacks&&this._set(this.opts.callbacks,
"")},stop:function(){this.callbacks={}},add:function(a,b){this.callbacks[a]||(this.callbacks[a]=[]);this.callbacks[a].push(b)},remove:function(a,b){if(void 0===b)delete this.callbacks[a];else{for(b=0;b<this.callbacks[a].length;b++)this.callbacks[a].splice(b,1);0===Object.keys(this.callbacks[a]).length&&delete this.callbacks[a]}},trigger:function(a,b){a=this._loop(a,b,this.callbacks);return void 0===a?b[0]:a},_set:function(a,b){for(var e in a){var c=""===b?e:b+"."+e;"object"==typeof a[e]?this._set(a[e],
c):(this.callbacks[c]=[],this.callbacks[c].push(a[e]))}},_loop:function(a,b,c){var e;for(e in c)if(a===e)for(var d=0;d<c[e].length;d++)var f=c[e][d].apply(this.app,b);return f}});l.add("service","animate",{init:function(a){this.animationOpt=a.opts.animation},start:function(a,b,c,d){var e={duration:!1,iterate:!1,delay:!1,timing:!1,prefix:"redactor-"};return e="function"==typeof c?e:l.extend(e,c),d="function"==typeof c?c:d,new l.AnimatePlay(a,b,e,d,this.animationOpt)},stop:function(a){this.$el=l.dom(a);
this.$el.removeClass("redactor-animated");a=this.$el.attr("redactor-animate-effect");this.$el.removeClass(a);this.$el.removeAttr("redactor-animate-effect");(a=this.$el.attr("redactor-animate-hide"))&&this.$el.addClass(a).removeAttr("redactor-animate-hide");this.$el.off("animationend webkitAnimationEnd")}});l.AnimatePlay=function(a,b,c,d,f){return this.hidableEffects="fadeOut flipOut slideUp zoomOut slideOutUp slideOutRight slideOutLeft".split(" "),this.prefixes=["","-webkit-"],this.$el=l.dom(a),this.$body=
l.dom("body"),this.callback=d,this.animation=f?b:this.buildAnimationOff(b),this.defaults=c,"slideUp"===this.animation&&this.$el.height(this.$el.height()),this.isInanimate()?this.inanimate():this.animate()};l.AnimatePlay.prototype={buildAnimationOff:function(a){return this.isHidable(a)?"hide":"show"},buildHideClass:function(){return"redactor-animate-hide"},isInanimate:function(){return"show"===this.animation||"hide"===this.animation},isAnimated:function(){return this.$el.hasClass("redactor-animated")},
isHidable:function(a){return-1!==this.hidableEffects.indexOf(a)},inanimate:function(){var a;return this.defaults.timing="linear","show"===this.animation?(a=this.buildHideClass(),this.$el.attr("redactor-animate-hide",a),this.$el.removeClass(a)):(a=this.$el.attr("redactor-animate-hide"),this.$el.addClass(a).removeAttr("redactor-animate-hide")),"function"==typeof this.callback&&this.callback(this),this},animate:function(){var a=this.defaults.delay?this.defaults.delay:0;return setTimeout(function(){if(this.$body.addClass("no-scroll-x"),
this.$el.addClass("redactor-animated"),!this.$el.attr("redactor-animate-hide")){var a=this.buildHideClass();this.$el.attr("redactor-animate-hide",a);this.$el.removeClass(a)}this.$el.addClass(this.defaults.prefix+this.animation);this.$el.attr("redactor-animate-effect",this.defaults.prefix+this.animation);this.set(this.defaults.duration+"s",this.defaults.iterate,this.defaults.timing);this.complete()}.bind(this),1E3*a),this},set:function(a,b,c){for(var e=this.prefixes.length;e--;)!1===a&&""!==a||this.$el.css(this.prefixes[e]+
"animation-duration",a),!1===b&&""!==b||this.$el.css(this.prefixes[e]+"animation-iteration-count",b),!1===c&&""!==c||this.$el.css(this.prefixes[e]+"animation-timing-function",c)},clean:function(){this.$body.removeClass("no-scroll-x");this.$el.removeClass("redactor-animated");this.$el.removeClass(this.defaults.prefix+this.animation);this.$el.removeAttr("redactor-animate-effect");this.set("","","")},complete:function(){this.$el.one("animationend webkitAnimationEnd",function(){if(this.$el.hasClass(this.defaults.prefix+
this.animation)&&this.clean(),this.isHidable(this.animation)){var a=this.$el.attr("redactor-animate-hide");this.$el.addClass(a).removeAttr("redactor-animate-hide")}"slideUp"===this.animation&&this.$el.height("");"function"==typeof this.callback&&this.callback(this.$el)}.bind(this))}};l.add("service","caret",{init:function(a){this.app=a},setStart:function(a){this._setCaret("Start",a)},setEnd:function(a){this._setCaret("End",a)},setBefore:function(a){this._setCaret("Before",a)},setAfter:function(a){this._setCaret("After",
a)},isStart:function(a){return this._isStartOrEnd(a,"First")},isEnd:function(a){return this._isStartOrEnd(a,"Last")},setAtEnd:function(a){var e=this.inspector.parse(a).getTag(),b=document.createRange();this._isInPage(a)&&("a"===e?(e=this.utils.createInvisibleChar(),a.appendChild(e),b.setStartBefore(e),b.collapse(!0)):(b.selectNodeContents(a),b.collapse(!1)),this.selection.setRange(b))},setAtStart:function(a){var e=document.createRange(),b=this.inspector.parse(a);if(this._isInPage(a)){if(e.setStart(a,
0),e.collapse(!0),b.isInline()||this.utils.isEmpty(a))a=this.utils.createInvisibleChar(),e.insertNode(a),e.selectNodeContents(a),e.collapse(!1);this.selection.setRange(e)}},setAtBefore:function(a){var e=this.inspector.parse(a),b=document.createRange();if(this._isInPage(a)){if(b.setStartBefore(a),b.collapse(!0),e.isInline())e=this.utils.createInvisibleChar(),a.parentNode.insertBefore(e,a),b.selectNodeContents(e),b.collapse(!1);this.selection.setRange(b)}},setAtAfter:function(a){var e=document.createRange();
this._isInPage(a)&&(e.setStartAfter(a),e.collapse(!0),a=this.utils.createInvisibleChar(),e.insertNode(a),e.selectNodeContents(a),e.collapse(!1),this.selection.setRange(e))},setAtPrev:function(a){(a=a.previousSibling)&&(a=3===a.nodeType&&this._isEmptyTextNode(a)?a.previousElementSibling:a)&&this.setEnd(a)},setAtNext:function(a){(a=a.nextSibling)&&(a=3===a.nodeType&&this._isEmptyTextNode(a)?a.nextElementSibling:a)&&this.setStart(a)},_setCaret:function(a,b){b=this.inspector.parse(b);var e=b.getNode();
e&&(this.component.clearActive(),this["_set"+a](e,b,b.getTag()))},_setStart:function(a,b,c){if(b.isText())return this.editor.focus(),this.setAtStart(a);if("ul"===c||"ol"===c){if(a=b.findFirstNode("li"),b=this.utils.getFirstElement(a),c=this.inspector.parse(b),b&&c.isComponent())return this.setStart(c.getComponent())}else if("dl"===c)a=b.findFirstNode("dt");else{if("br"===c||"hr"===c)return this.setBefore(a);if("td"===c||"th"===c){if(b=b.getFirstElement(a))return this.setStart(b)}else{if("table"===
c||"tr"===c)return this.setStart(b.findFirstNode("th, td"));if(b.isComponentType("code")&&!b.isFigcaption())return a=b.findLastNode("pre, code"),this.editor.focus(),this.setAtStart(a);if("figure"===c&&b.isComponentType("table"))return a=b.getTable(),a=this.inspector.parse(a),this.setStart(a.findFirstNode("th, td"));if(!b.isComponentType("table")&&b.isComponent()&&!b.isFigcaption())return this.component.setActive(a)}}this.editor.focus();this._setInline(a,"Start")||this.setAtStart(a)},_setEnd:function(a,
b,c){if(b.isText())return this.editor.focus(),this.setAtEnd(a);if("ul"===c||"ol"===c){if(a=b.findLastNode("li"),b=this.utils.getLastElement(a),c=this.inspector.parse(b),b&&c.isComponent())return this.setEnd(c.getComponent())}else if("dl"===c)a=b.findLastNode("dd");else{if("br"===c||"hr"===c)return this.setAfter(a);if("td"===c||"th"===c){if(b=b.getLastElement())return this.setEnd(b)}else{if("table"===c||"tr"===c)return this.setEnd(b.findLastNode("th, td"));if(b.isComponentType("code")&&!b.isFigcaption())return a=
b.findLastNode("pre, code"),this.editor.focus(),this.setAtEnd(a);if("figure"===c&&b.isComponentType("table"))return a=b.getTable(),a=this.inspector.parse(a),this.setEnd(a.findLastNode("th, td"));if(!b.isComponentType("table")&&b.isComponent()&&!b.isFigcaption())return this.component.setActive(a)}}if(this.editor.focus(),!this._setInline(a,"End")){if(this.utils.isEmpty(a))return this.setStart(a);this.setAtEnd(a)}},_setBefore:function(a,b,c){return 3===a.nodeType?this.setAtBefore(a):b.isInline()?this.setAtBefore(a):
b.isFirstTableCell()?this.setAtPrev(b.getComponent()):"td"===c||"th"===c?this.setAtPrev(a):b.isFirstListItem()?this.setAtPrev(b.getList()):b.isFigcaption()?this.setStart(b.getComponent()):!b.isComponentType("table")&&b.isComponent()?this.setAtPrev(b.getComponent()):b.isBlock()?this.setAtPrev(a):(this.editor.focus(),void this.setAtBefore(a))},_setAfter:function(a,b,c){return 3===a.nodeType?this.setAtAfter(a):b.isInline()?this.setAtAfter(a):b.isLastTableCell()?this.setAtNext(b.getComponent()):"td"===
c||"th"===c?this.setAtNext(a):b.isFirstListItem()?this.setAtNext(b.getList()):!b.isComponentType("table")&&b.isComponent()?this.setAtNext(b.getComponent()):b.isBlock()?this.setAtNext(a):(this.editor.focus(),void this.setAtAfter(a))},_setInline:function(a,b){if(a=this._hasInlineChild(a,"Start"===b?"first":"last"))return"Start"===b?this.setStart(a):this.setEnd(a),!0},_isStartOrEnd:function(a,b){a=this.utils.getNode(a);if(!a)return!1;var e=this.inspector.parse(a);if((a=this._getStartEndNode(a,e,b))&&
""===this.utils.trimSpaces(3===a.nodeType?a.textContent:a.innerHTML)||!e.isFigcaption()&&e.isComponent()&&!e.isComponentEditable())return!0;e=this.offset.get(a,!0);return!!e&&("First"===b?0===e.start:e.end===this.offset.size(a,!0))},_isInPage:function(a){return!(!a||!a.nodeType)&&a!==document.body&&document.body.contains(a)},_hasInlineChild:function(a,b){a=this.inspector.parse(a);b="first"===b?a.getFirstNode():a.getLastNode();a=l.dom(b);if(b&&3!==b.nodeType&&this.inspector.isInlineTag(b.tagName)&&
!a.hasClass("redactor-component")&&!a.hasClass("non-editable"))return b},_isEmptyTextNode:function(a){a=a.textContent.trim().replace(/\n/,"");return""===this.utils.removeInvisibleChars(a)},_getStartEndNode:function(a,b,c){return b.isFigcaption()?a=b.getFigcaption():b.isTable()?a=b["find"+c+"Node"]("th, td"):b.isList()?a=b["find"+c+"Node"]("li"):b.isComponentType("code")&&(a=b.findLastNode("pre, code")),a}});l.add("service","selection",{init:function(a){this.app=a},is:function(){var a=this.get();return a?
(a=this.inspector.parse(a.anchorNode),a.isInEditor()||a.isEditor()):!1},isCollapsed:function(){var a=this.get(),b=this.getRange();return!(!a||!a.isCollapsed)||!(!b||0!==b.toString().length)},isBackwards:function(){var a=!1,b=this.get();if(b&&!b.isCollapsed){var c=document.createRange();c.setStart(b.anchorNode,b.anchorOffset);c.setEnd(b.focusNode,b.focusOffset);a=c.collapsed;c.detach()}return a},isIn:function(a){a=l.dom(a).get();var e=this.getCurrent();return!(!e||!a)&&a.contains(e)},isText:function(){var a=
this.get();if(a){a=this.getBlock(a.anchorNode);var b=this.getBlocks();if(a&&this.inspector.isTableCellTag(a.tagName)||!1===a&&0===b.length)return!0}return!1},isAll:function(a){var e=this.utils.getNode(a);if(!e)return!1;a=this.editor.isEditor(e);var b=this.inspector.parse(e);if(!b.isFigcaption()&&this.component.isNonEditable(e)&&this.component.isActive(e))return!0;if(a){var c=this.editor.getElement();c=this.cleaner.output(c.html());if(c=c.replace(/<p><\/p>$/i,""),this.getHtml().length!==c.length)return!1}if(a&&
this.editor.isEmpty()||this.isCollapsed())return!1;c=this.offset.get(e,!0);e=this.offset.size(e,!0);return!a&&b.isComponentType("code")&&(e=this.getText().trim().length),!(!c||0!==c.start||c.end!==e)},hasNonEditable:function(){var a=this.getHtml();a=l.dom("<div>").html(a);return!this.isCollapsed()&&0!==a.find(".non-editable").length},setRange:function(a){var e=window.getSelection();e.removeAllRanges();e.addRange(a)},setAll:function(a){if(a=this.utils.getNode(a)){var e=this.inspector.parse(a);(this.component.clearActive(),
this.editor.focus(),this.editor.saveScroll(),this.editor.disableNonEditables(),a&&"TABLE"===a.tagName)?(a=e.findFirstNode("td, th"),e=e.findLastNode("td, th"),l.dom(a).prepend(this.marker.build("start")),l.dom(e).append(this.marker.build("end")),this.restoreMarkers()):!e.isFigcaption()&&this.component.isNonEditable(a)?this.component.setActive(a):(e.isComponentType("code")&&(a=e.getComponentCodeElement()).focus(),e=document.createRange(),e.selectNodeContents(a),this.setRange(e));this.editor.enableNonEditables();
this.editor.restoreScroll()}},get:function(){var a=window.getSelection();return 0<a.rangeCount?a:null},getRange:function(){var a=this.get();return a&&a.getRangeAt(0)?a.getRangeAt(0):null},getTextBeforeCaret:function(a){a=void 0===a?1:a;var e=this.editor.getElement().get(),b=this.getRange(),c=!1;return b&&((b=b.cloneRange()).collapse(!0),b.setStart(e,0),c=b.toString().slice(-a)),c},getTextAfterCaret:function(a){a=void 0===a?1:a;var e=this.editor.getElement().get(),b=this.getRange(),c=!1;b&&(c=b.cloneRange(),
c.selectNodeContents(e),c.setStart(b.endContainer,b.endOffset),c=c.toString().slice(0,a));return c},getPosition:function(){var a=this.getRange(),b={top:0,left:0,width:0,height:0};window.getSelection&&a.getBoundingClientRect&&(b=(a=a.cloneRange()).startOffset-1,a.setStart(a.startContainer,0>b?0:b),a=a.getBoundingClientRect(),b={top:a.top,left:a.left,width:a.right-a.left,height:a.bottom-a.top});return b},getCurrent:function(){var a=!1,b=this.get(),c=this.component.getActive();c?a=c:b&&this.is()&&(a=
!this.inspector.parse(b.anchorNode).isEditor()&&b.anchorNode);return a},getParent:function(){var a=!1,b=this.getCurrent();b&&(a=b.parentNode,a=!this.inspector.parse(a).isEditor()&&a);return a},getElement:function(a){for(a=a||this.getCurrent();a;){var e=this.inspector.parse(a);if(e.isElement()&&e.isInEditor())return a;a=a.parentNode}return!1},getInline:function(a){a=a||this.getCurrent();for(var e=!1;a;)this._isInlineNode(a)&&(e=a),a=a.parentNode;return e},getInlineFirst:function(a){for(a=a||this.getCurrent();a;){if(this._isInlineNode(a))return a;
a=a.parentNode}return!1},getInlineAll:function(a){a=a||this.getCurrent();for(var e=[];a;)this._isInlineNode(a)&&e.push(a),a=a.parentNode;return e},getBlock:function(a){for(a=a||this.getCurrent();a;){var e=this.inspector.parse(a);if(this.inspector.isBlockTag(a.tagName)&&e.isInEditor(a))return a;a=a.parentNode}return!1},getInlinesAllSelected:function(a){if(this.isAll())return[];var e=this.getInlines({all:!0}),b=this.getNodes({textnodes:!0,inline:!1}),c=this.getText().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,
"\\$&"),d=[];if(0!==b.length)return d;if(""===c)d=e;else if(1<e.length)for(b=0;b<e.length;b++)this._isTextSelected(e[b],c)&&d.push(e[b]);else 1===e.length&&this._isTextSelected(e[0],c)&&(d=e);return a&&a.tags?this._filterNodesByTags(d,a.tags):d},getInlines:function(a){for(var e=this.getNodes(),b=[],c=0;c<e.length;c++){var d;if(a&&a.all)for(d=e[c];d;)this._isInlineNode(d)&&!this._isInNodesArray(b,d)&&b.push(d),d=d.parentNode;else(d=this.getInline(e[c]))&&!this._isInNodesArray(b,d)&&b.push(d)}return b=
a&&a.tags?this._filterNodesByTags(b,a.tags):b,a&&a.inside?this._filterInlinesInside(b,a):b},getBlocks:function(a){var e=this.getNodes(),b=this.getBlock();e=0===e.length&&b?[b]:e;b=[];for(var c=0;c<e.length;c++){var d=this.getBlock(e[c]);d&&!this._isInNodesArray(b,d)&&b.push(d)}return b=a&&a.tags?this._filterNodesByTags(b,a.tags):b,a&&a.first?this._filterBlocksFirst(b,a):b},getElements:function(a){var e=this.getNodes({textnodes:!1}),b=this.getBlock();e=0===e.length&&b?[b]:e;b=[];for(var c=0;c<e.length;c++)this._isInNodesArray(b,
e[c])||b.push(e[c]);return a&&a.tags?this._filterNodesByTags(b,a.tags):b},getNodes:function(a){var e=[],b=this.component.getActive();b?e=this._getNodesComponent(b):this.isCollapsed()?e=(e=this.getCurrent())?[e]:[]:this.is()&&!b&&(e=this._getRangeSelectedNodes());return e=this._filterServicesNodes(e),e=this._filterEditor(e),e=a&&a.tags?this._filterNodesByTags(e,a.tags):e,e=a&&a.textnodes?this._filterNodesTexts(e,a):e,a&&!a.textnodes?this._filterNodesElements(e):e},getText:function(){var a=this.get();
return a?this.utils.removeInvisibleChars(a.toString()):""},getHtml:function(a){var e="",b=this.get();if(b){e=document.createElement("div");for(var c=b.rangeCount,d=0;d<c;++d)e.appendChild(b.getRangeAt(d).cloneContents());e=e.innerHTML;e=(e=!1!==a?this.cleaner.output(e):e).replace(/<p><\/p>$/i,"")}return e},clear:function(){this.component.clearActive();this.get().removeAllRanges()},collapseToStart:function(){var a=this.get();a&&!a.isCollapsed&&a.collapseToStart()},collapseToEnd:function(){var a=this.get();
a&&!a.isCollapsed&&a.collapseToEnd()},saveActiveComponent:function(){var a=this.component.getActive();return!!a&&(this.savedComponent=a,!0)},restoreActiveComponent:function(){return!!this.savedComponent&&(this.component.setActive(this.savedComponent),!0)},save:function(){this._clearSaved();var a=this.getElement();!a||"TD"!==a.tagName&&"TH"!==a.tagName||""!==a.innerHTML?this.saveActiveComponent()||(this.saved=this.offset.get()):this.savedElement=a},restore:function(){(this.saved||this.savedComponent||
this.savedElement)&&(this.editor.saveScroll(),this.savedElement?this.caret.setStart(this.savedElement):this.restoreActiveComponent()||this.offset.set(this.saved),this._clearSaved(),this.editor.restoreScroll())},saveMarkers:function(){this._clearSaved();this.saveActiveComponent()||this.marker.insert()},restoreMarkers:function(){this.editor.saveScroll();this.restoreActiveComponent()||this.marker.restore();this._clearSaved();this.editor.restoreScroll()},_getNextNode:function(a){if(a.hasChildNodes())return a.firstChild;
for(;a&&!a.nextSibling;)a=a.parentNode;return a?a.nextSibling:null},_getNodesComponent:function(a){var e=this.getCurrent();e=this.inspector.parse(e);return e.isFigcaption()?[e.getFigcaption()]:[a]},_getRangeSelectedNodes:function(){var a=[],b=this.getRange(),c=b.startContainer,d=b.startContainer,f=b.endContainer,l=this.editor.getElement();if(d===l.get()&&this.isAll())a=this.utils.getChildNodes(l);else if(c==f)a=[c];else{for(;c&&c!=f;)a.push(c=this._getNextNode(c));for(c=b.startContainer;c&&c!=b.commonAncestorContainer;)a.unshift(c),
c=c.parentNode}return a},_isInNodesArray:function(a,b){return-1!==a.indexOf(b)},_filterEditor:function(a){for(var e=[],b=0;b<a.length;b++)this.inspector.parse(a[b]).isInEditor()&&e.push(a[b]);return e},_filterServicesNodes:function(a){for(var e=[],b=0;b<a.length;b++){var c=l.dom(a[b]),d=!1;a[b]&&3===a[b].nodeType&&this.utils.isEmpty(a[b])&&(d=!0);(c.hasClass("redactor-script-tag")||c.hasClass("redactor-component-caret")||c.hasClass("redactor-selection-marker")||c.hasClass("non-editable"))&&(d=!0);
d||e.push(a[b])}return e},_filterNodesTexts:function(a,b){for(var e=[],c=0;c<a.length;c++)if(3===a[c].nodeType||b.keepbr&&"BR"===a[c].tagName)this.getInline(a[c])&&b&&!1===b.inline||e.push(a[c]);return e},_filterNodesElements:function(a){for(var e=[],b=0;b<a.length;b++)3!==a[b].nodeType&&e.push(a[b]);return e},_filterNodesByTags:function(a,b,c){for(var e=[],d=0;d<a.length;d++)if(c&&3===a[d].nodeType)e.push(a[d]);else if(3!==a[d].nodeType){var f=a[d].tagName.toLowerCase();-1!==b.indexOf(f.toLowerCase())&&
e.push(a[d])}return e},_filterBlocksFirst:function(a){for(var e=[],b=0;b<a.length;b++){var c=l.dom(a[b]),d=c.parent().get();c=c.parent().hasClass("redactor-in");d=d&&("TD"===d.tagName||"TH"===d.tagName);(c||d)&&e.push(a[b])}return e},_filterInlinesInside:function(a){for(var e=[],b=0;b<a.length;b++)window.getSelection().containsNode(a[b],!0)&&e.push(a[b]);return e},_isTextSelected:function(a,b){a=this.utils.removeInvisibleChars(a.textContent);return b===a||-1!==a.search(b)||-1!==b.search(new RegExp("^"+
a))||-1!==b.search(new RegExp(a+"$"))},_isInlineNode:function(a){var e=this.inspector.parse(a);return this.inspector.isInlineTag(a.tagName)&&e.isInEditor()},_clearSaved:function(){this.savedElement=this.savedComponent=this.saved=!1}});l.add("service","element",{init:function(a){this.app=a;this.rootElement=a.rootElement;this.$element={};this.type="inline"},start:function(){this._build();this._buildType()},isType:function(a){return a===this.type},getType:function(){return this.type},getElement:function(){return this.$element},
_build:function(){this.$element=l.dom(this.rootElement)},_buildType:function(){var a=this.$element.get().tagName;this.type="TEXTAREA"===a?"textarea":this.type;this.type="DIV"===a?"div":this.type;this.type=this.opts.inline?"inline":this.type}});l.add("service","editor",{init:function(a){this.app=a;this.pasting=this.scrolltop=!1},start:function(){this._build()},focus:function(){this.isFocus()||this._isContenteditableFocus()||(this.saveScroll(),this.$editor.focus(),this.restoreScroll())},startFocus:function(){this.caret.setStart(this.getFirstNode())},
endFocus:function(){this.caret.setEnd(this.getLastNode())},isPasting:function(){return this.pasting},enablePasting:function(){this.pasting=!0},disablePasting:function(){this.pasting=!1},saveScroll:function(){this.scrolltop=this._getScrollTarget().scrollTop()},restoreScroll:function(){!1!==this.scrolltop&&(this._getScrollTarget().scrollTop(this.scrolltop),this.scrolltop=!1)},disableNonEditables:function(){this.$noneditables=this.$editor.find("[contenteditable=false]");this.$noneditables.attr("contenteditable",
!0)},enableNonEditables:function(){this.$noneditables&&setTimeout(function(){this.$noneditables.attr("contenteditable",!1)}.bind(this),1)},getFirstNode:function(){return this.$editor.contents()[0]},getLastNode:function(){var a=this.$editor.contents();return a[a.length-1]},isSourceMode:function(){return this.source.getElement().hasClass("redactor-source-open")},isEditor:function(a){return l.dom(a).get()===this.$editor.get()},isEmpty:function(a){return this.utils.isEmptyHtml(this.$editor.html(),!1,
a)},isFocus:function(){var a=l.dom(document.activeElement);return 0!==this.$editor.find(".redactor-component-active").length||0!==a.closest(".redactor-in-"+this.uuid).length},setEmpty:function(){this.$editor.html(this.opts.emptyHtml)},getElement:function(){return this.$editor},_build:function(){var a=this.element.getElement();a=this.element.isType("textarea")?"<div>":a.get();this.$editor=l.dom(a)},_getScrollTarget:function(){return this.opts.scrollTarget?l.dom(this.opts.scrollTarget):this.$doc},_isContenteditableFocus:function(){var a=
this.selection.getBlock();return 0!==(a?l.dom(a).closest("[contenteditable=true]").not(".redactor-in"):[]).length}});l.add("service","container",{init:function(a){this.app=a},start:function(){this._build()},getElement:function(){return this.$container},_build:function(){var a=this.element.isType("inline")?"<span>":"<div>";this.$container=l.dom(a)}});l.add("service","source",{init:function(a){this.app=a;this.$source={};this.content=""},start:function(){this._build();this._buildName();this._buildStartedContent()},
getElement:function(){return this.$source},getCode:function(){return this.$source.val()},getName:function(){return this.$source.attr("name")},getStartedContent:function(){return this.content},setCode:function(a){return this.insertion.set(a,!0,!1)},isNameGenerated:function(){return this.name},_build:function(){var a=this.element.getElement();a=this.element.isType("textarea")?a.get():"<textarea>";this.$source=l.dom(a)},_buildName:function(){this.name=this.element.getElement().attr("name");this.$source.attr("name",
this.name?this.name:"content-"+this.uuid)},_buildStartedContent:function(){var a=this.element.getElement();this.content=(this.element.isType("textarea")?a.val():a.html()).trim()}});l.add("service","statusbar",{init:function(a){this.app=a;this.$statusbar={};this.items=[]},start:function(){this.$statusbar=l.dom("<ul>");this.$statusbar.attr("dir",this.opts.direction)},add:function(a,b){return this.update(a,b)},update:function(a,b){var e;return void 0!==this.items[a]?e=this.items[a]:(e=l.dom("<li>"),
this.$statusbar.append(e),this.items[a]=e),e.html(b)},get:function(a){return!!this.items[a]&&this.items[a]},remove:function(a){this.items[a]&&(this.items[a].remove(),delete this.items[a])},getItems:function(){return this.items},removeItems:function(){this.items={};this.$statusbar.html("")},getElement:function(){return this.$statusbar}});l.add("service","toolbar",{init:function(a){this.app=a;this.dropdownOpened=!1;this.buttonsObservers={}},start:function(){this.is()&&(this.opts.activeButtons=this.opts.activeButtonsAdd?
this._extendActiveButtons():this.opts.activeButtons,this.create())},stopObservers:function(){this.buttonsObservers={}},create:function(){this.$wrapper=l.dom("<div>");this.$toolbar=l.dom("<div>")},observe:function(){if(this.is()){for(c in this.setButtonsInactive(),this.buttonsObservers){var a=this.buttonsObservers[c];var b=this.getButton(c);this.app.broadcast("button."+a+".observe",b)}b=this.opts.activeButtons;a=this.selection.getInlinesAllSelected();var c=this.selection.getInline();this.selection.isCollapsed()&&
c&&a.push(c);a=this._inlinesToTags(a);for(var d in b)-1!==a.indexOf(d)&&this.getButton(b[d]).setActive()}},is:function(){return!(!this.opts.toolbar||this.detector.isMobile()&&this.opts.air)},isAir:function(){return!!this.is()&&this.$toolbar.hasClass("redactor-air")},isFixed:function(){return!!this.is()&&this.$toolbar.hasClass("redactor-toolbar-fixed")},isContextBar:function(){return this.$body.find("#redactor-context-toolbar-"+this.uuid).hasClass("open")},isTarget:function(){return this.opts.toolbarFixedTarget!==
document},getElement:function(){return this.$toolbar},getWrapper:function(){return this.$wrapper},getDropdown:function(){return this.dropdownOpened},getTargetElement:function(){return l.dom(this.opts.toolbarFixedTarget)},getButton:function(a){a=this._findButton(".re-"+a);return 0!==a.length&&a.dataget("data-button-instance")},getButtonByIndex:function(a){a=this.$toolbar.find(".re-button").eq(a);return 0!==a.length&&a.dataget("data-button-instance")},getButtons:function(){var a=[];return this._findButtons().each(function(e){e=
l.dom(e);a.push(e.dataget("data-button-instance"))}),a},getButtonsKeys:function(){var a=[];return this._findButtons().each(function(e){e=l.dom(e);a.push(e.attr("data-re-name"))}),a},addButton:function(a,b,c,d,f){c=c||"end";var e=l.create("toolbar.button",this.app,a,b);if(b.observe&&(this.opts.activeButtonsObservers[a]={observe:b.observe,button:e}),!0!==f)a=this.opts.buttons.indexOf(a),0===a?c="first":-1!==a&&(d=this.getButtonByIndex(a-1))&&(c="after");return this.is()&&("first"===c?this.$toolbar.prepend(e):
"after"===c?d.after(e):"before"===c?d.before(e):this.$toolbar.append(e)),e},addButtonFirst:function(a,b){return this.addButton(a,b,"first")},addButtonAfter:function(a,b,c){return(a=this.getButton(a))?this.addButton(b,c,"after",a):this.addButton(b,c)},addButtonBefore:function(a,b,c){return(a=this.getButton(a))?this.addButton(b,c,"before",a):this.addButton(b,c)},addButtonObserver:function(a,b){this.buttonsObservers[a]=b},setDropdown:function(a){this.dropdownOpened=a},setButtonsInactive:function(){for(var a=
this.getButtons(),b=0;b<a.length;b++)a[b].setInactive()},setButtonsActive:function(){for(var a=this.getButtons(),b=0;b<a.length;b++)a[b].setActive()},disableButtons:function(){for(var a=this.getButtons(),b=0;b<a.length;b++)a[b].disable()},enableButtons:function(){for(var a=this.getButtons(),b=0;b<a.length;b++)a[b].enable()},_findButton:function(a){return this.is()?this.$toolbar.find(a):l.dom()},_findButtons:function(){return this.is()?this.$toolbar.find(".re-button"):l.dom()},_extendActiveButtons:function(){return l.extend({},
this.opts.activeButtons,this.opts.activeButtonsAdd)},_inlinesToTags:function(a){for(var e=[],b=0;b<a.length;b++)e.push(a[b].tagName.toLowerCase());return e}});l.add("class","toolbar.button",{mixins:["dom"],init:function(a,b,c){this.app=a;this.opts=a.opts;this.lang=a.lang;this.$body=a.$body;this.toolbar=a.toolbar;this.detector=a.detector;this.obj=c;this.name=b;this.tooltip=this.dropdown=!1;this._init()},isActive:function(){return this.hasClass("redactor-button-active")},isDisabled:function(){return this.hasClass("redactor-button-disabled")},
hasIcon:function(){return this.obj.icon&&!this.opts.buttonsTextLabeled},setDropdown:function(a){this.obj.dropdown=a;this.obj.message=!1;this.dropdown=l.create("toolbar.dropdown",this.app,this.name,this.obj.dropdown);this.attr("data-dropdown",!0)},setMessage:function(a,b){this.obj.message=a;this.obj.args=b;this.obj.dropdown=!1},setApi:function(a,b){this.obj.api=a;this.obj.args=b;this.obj.dropdown=!1},setTitle:function(a){this.obj.title=this.lang.parse(a);this.obj.tooltip=this.obj.title;this.attr({alt:this.obj.tooltip,
"aria-label":this.obj.tooltip});this.attr("data-re-icon")||this.html(this.obj.title)},setTooltip:function(a){this.obj.tooltip=this.lang.parse(a);this.attr({alt:this.obj.tooltip,"aria-label":this.obj.tooltip})},setIcon:function(a){this.opts.buttonsTextLabeled||(this.obj.icon=!0,this.$icon=l.dom(a),this.html(""),this.append(this.$icon),this.attr("data-re-icon",!0),this.addClass("re-button-icon"),this.setTooltip(this.obj.title),this._buildTooltip())},setActive:function(){this.addClass("redactor-button-active")},
setInactive:function(){this.removeClass("redactor-button-active")},hideTooltip:function(){this.$body.find(".re-button-tooltip").remove()},getDropdown:function(){return this.dropdown},disable:function(){this.addClass("redactor-button-disabled")},enable:function(){this.removeClass("redactor-button-disabled")},toggle:function(a){a&&a.preventDefault();this.isDisabled()||(this.obj.dropdown?this.dropdown.toggle(a):this.obj.api?this.app.api(this.obj.api,this.obj.args,this.name):this.obj.message&&this.app.broadcast(this.obj.message,
this.obj.args,this.name),this.hideTooltip())},_init:function(){this._parseTitle();this._parseTooltip();this._build();this._buildCallback();this._buildAttributes();this._buildObserver();this.hasIcon()?(this._buildIcon(),this._buildTooltip()):this.html(this.obj.title)},_parseTooltip:function(){this.obj.tooltip=this.obj.tooltip?this.lang.parse(this.obj.tooltip):this.obj.title},_parseTitle:function(){this.obj.title=this.lang.parse(this.obj.title)},_build:function(){this.parse("<a>");this.addClass("re-button re-"+
this.name);this.attr("data-re-name",this.name);this.dataset("data-button-instance",this);this.obj.dropdown&&this.setDropdown(this.obj.dropdown)},_buildCallback:function(){this.on("click",this.toggle.bind(this))},_buildAttributes:function(){this.attr({href:"#",alt:this.obj.tooltip,rel:this.name,role:"button","aria-label":this.obj.tooltip,tabindex:"-1"})},_buildObserver:function(){void 0!==this.obj.observe&&this.toolbar.addButtonObserver(this.name,this.obj.observe)},_buildIcon:function(){var a=this.obj.icon,
b=/(<([^>]+)>)/gi.test(a);this.$icon=b?l.dom(a):l.dom("<i>");b||this.$icon.addClass("re-icon-"+this.name);this.append(this.$icon);this.attr("data-re-icon",!0);this.addClass("re-button-icon")},_buildTooltip:function(){this.detector.isDesktop()&&(this.tooltip=l.create("toolbar.button.tooltip",this.app,this))}});l.add("class","toolbar.button.tooltip",{mixins:["dom"],init:function(a,b){this.app=a;this.opts=a.opts;this.$body=a.$body;this.toolbar=a.toolbar;this.$button=b;this.created=!1;this._init()},open:function(){if(!this.$button.hasClass("redactor-button-disabled")&&
!this.$button.hasClass("redactor-button-active")){this.created=!0;this.parse("<span>");this.addClass("re-button-tooltip");this.$body.append(this);this.html(this.$button.attr("alt"));var a=this.$button.offset(),b=this.$button.height(),c=this.$button.width();this.css({top:a.top+b+4+"px",left:a.left+c/2-this.width()/2+"px",position:"absolute"});this.show()}},close:function(){this.created&&!this.$button.hasClass("redactor-button-disabled")&&(this.remove(),this.created=!1)},_init:function(){this.$button.on("mouseover",
this.open.bind(this));this.$button.on("mouseout",this.close.bind(this))}});l.add("class","toolbar.dropdown",{mixins:["dom"],init:function(a,b,c){this.app=a;this.uuid=a.uuid;this.opts=a.opts;this.$win=a.$win;this.$doc=a.$doc;this.$body=a.$body;this.animate=a.animate;this.toolbar=a.toolbar;this.name=b;this.started=!1;this.items=c;this.$items=[]},toggle:function(a){this.started||this._build();this.isOpened()&&this.isActive()?this.close(!1):this.open(a)},isOpened:function(){var a=this.$body.find(".redactor-dropdown-"+
this.uuid+".open");return 0!==a.length&&a.attr("data-re-name")===this.name},isActive:function(){return 0!==this.$body.find("#redactor-dropdown-"+this.uuid+"-"+this.name+".open").length},getName:function(){return this.attr("data-re-name")},getItem:function(a){return this.$items[a]},getItemsByClass:function(a){var e=[],b;for(b in this.$items)"object"==typeof this.$items[b]&&this.$items[b].hasClass(a)&&e.push(this.$items[b]);return e},open:function(a){this._closeAll();this.$btn=this.toolbar.getButton(this.name);
this.app.broadcast("dropdown.open",a,this,this.$btn);this.toolbar.setDropdown(this);this.show();this.removeClass("redactor-animate-hide");this.addClass("open");this._observe();this.$btn.hideTooltip();this.$btn.setActive();this.$doc.on("keyup.redactor.dropdown-"+this.uuid,this._handleKeyboard.bind(this));this.$doc.on("click.redactor.dropdown-"+this.uuid+" touchstart.redactor.dropdown-"+this.uuid,this.close.bind(this));this.updatePosition();this.app.broadcast("dropdown.opened",a,this,this.$btn)},close:function(a,
b){if(a){var e=l.dom(a.target);if(this._isButton(a)||e.hasClass("redactor-dropdown-not-close")||e.hasClass("redactor-dropdown-item-disabled"))return void a.preventDefault()}this.app.broadcast("dropdown.close",this,this.$btn);this.toolbar.setDropdown(!1);this.$btn.setInactive();!1===b?this._close():this.animate.start(this,"fadeOut",this._close.bind(this))},updatePosition:function(){var a=this.toolbar.isFixed(),b=this.$btn.offset();b.top=a?this.$btn.position().top:b.top;var c=this.$btn.height(),d=this.$btn.width();
a=a?"fixed":"absolute";var f=b.left+0,l=parseFloat(this.css("width"));d=this.$win.width()<f+l?l-d:0;this.css({position:a,top:b.top+c+2+"px",left:f-d+"px"})},_build:function(){this.parse("<div>");this.attr("dir",this.opts.direction);this.attr("id","redactor-dropdown-"+this.uuid+"-"+this.name);this.attr("data-re-name",this.name);this.addClass("redactor-dropdown redactor-dropdown-"+this.uuid+" redactor-dropdown-"+this.name);this.dataset("data-dropdown-instance",this);this.items.dom||"string"==typeof this.items?
this._buildDom():this._buildItems();this.$body.append(this);this.started=!0},_buildDom:function(){this.html("").append(l.dom(this.items))},_buildItems:function(){for(var a in this.items="format"===this.name?this._buildFormattingItems():this.items,this.items){var b=this.items[a];"observe"===a?this.attr("data-observe",this.items[a]):(b=l.create("toolbar.dropdown.item",this.app,a,b,this),this.$items[a]=b,this.append(b))}},_buildFormattingItems:function(){for(var a in this.items)-1===this.opts.formatting.indexOf(a)&&
delete this.items[a];if(this.opts.formattingHide)for(a in this.items)-1!==this.opts.formattingHide.indexOf(a)&&delete this.items[a];if(this.opts.formattingAdd)for(a in this.opts.formattingAdd)this.items[a]=this.opts.formattingAdd[a];return this.items},_handleKeyboard:function(a){27===a.which&&this.close()},_isButton:function(a){return l.dom(a.target).closest(".re-button").get()===this.$btn.get()},_close:function(){this.$btn.setInactive();this.$doc.off(".redactor.dropdown-"+this.uuid);this.removeClass("open");
this.addClass("redactor-animate-hide");this.app.broadcast("dropdown.closed",this,this.$btn)},_closeAll:function(){this.$body.find(".redactor-dropdown-"+this.uuid+".open").each(function(a){l.dom(a).dataget("data-dropdown-instance")._close()})},_observe:function(){var a=this.attr("data-observe");a&&this.app.broadcast("dropdown."+a+".observe",this)}});l.add("class","toolbar.dropdown.item",{mixins:["dom"],init:function(a,b,c,d){this.app=a;this.lang=a.lang;this.dropdown=d;this.name=b;this.obj=c;this._init()},
setTitle:function(a){this.$span.html(a)},getTitle:function(){return this.$span.html()},enable:function(){this.removeClass("redactor-dropdown-item-disabled")},disable:function(){this.addClass("redactor-dropdown-item-disabled")},toggle:function(a){a&&a.preventDefault();this.hasClass("redactor-dropdown-item-disabled")||(this.obj.message?this.app.broadcast(this.obj.message,this.obj.args,this.name):this.obj.api&&this.app.api(this.obj.api,this.obj.args,this.name))},_init:function(){this.parse("<a>");this.attr("href",
"#");this.addClass("redactor-dropdown-item-"+this.name);this.obj.classname&&this.addClass(this.obj.classname);this.attr("data-re-name",this.name);this.on("click",this.toggle.bind(this));this.$span=l.dom("<span>");this.append(this.$span);this.setTitle(this.lang.parse(this.obj.title))}});l.add("service","cleaner",{init:function(a){this.app=a;this.opts=a.opts;this.storedComponents=[];this.storedImages=[];this.storedLinks=[];this.deniedTags="font html head link title body meta applet".split(" ");this.convertRules=
{};this.unconvertRules={};this.reComments=/\x3c!--[\s\S]*?--\x3e/g;this.reSpacedEmpty=/^(||\s||<br\s?\/?>||&nbsp;)$/i;this.reScriptTag=/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi},addConvertRules:function(a,b){this.convertRules[a]=b},addUnconvertRules:function(a,b){this.unconvertRules[a]=b},input:function(a,b,c){return a=(a=(a=this.encodePreCode(a)).replace(/\$/g,"&#36;")).replace(/&amp;/g,"&"),a=l.create("cleaner.figure",this.app).convert(a,this.convertRules),a=this.storeComponents(a),a=this.replaceTags(a,
this.opts.replaceTags),a=this._setSpanAttr(a),a=this._setStyleCache(a),a=this.removeTags(a,this.deniedTags),a=this.opts.removeScript?this._removeScriptTag(a):this._replaceScriptTag(a),a=this.opts.removeComments?this.removeComments(a):a,a=this._isSpacedEmpty(a)?this.opts.emptyHtml:a,a=this.restoreComponents(a),a=this._cleanWrapped(a),b?this.paragraphize(a):a},output:function(a,b){return a=this.removeInvisibleSpaces(a),this._isSpacedEmpty(a)?"":this._isParagraphEmpty(a)?"":(a=this.removeServiceTagsAndAttrs(a,
b),a=this.storeComponents(a),a=this.removeSpanWithoutAttributes(a),a=this.removeFirstBlockBreaklineInHtml(a),a=this.opts.removeScript?a:this._unreplaceScriptTag(a),a=this.opts.preClass?this._setPreClass(a):a,a=this.opts.linkNofollow?this._setLinkNofollow(a):a,a=this.opts.removeNewLines?this.cleanNewLines(a):a,a=this.restoreComponents(a),a=l.create("cleaner.figure",this.app).unconvert(a,this.unconvertRules),a=this.removeEmptyAttributes(a,["style","class","rel","alt","title"]),a=this.cleanSpacesInPre(a),
""===(a=(a=this.tidy(a)).replace(/&amp;/g,"&")).replace(/\n/g,"")?"":a)},paste:function(a){a=this.storeComponents(a);var e=this.deniedTags.concat(["iframe"]);a=(a=(a=(a=this.removeTags(a,e)).replace(/<!doctype([\s\S]+?)>/gi,"")).replace(/<style([\s\S]+?)<\/style>/gi,"")).replace(/<\/p><br \/><p/gi,"</p><p");e=this._isHtmlMsWord(a);if(a=this._cleanGDocs(a),a=e?this._cleanMsWord(a):a,!this.opts.pasteClean)return a=this.restoreComponents(a);if(this.opts.pastePlainText)return a=this.restoreComponents(a),
this.pastePlainText(a);var b=this.opts.pasteBlockTags.concat(this.opts.pasteInlineTags);a=this.removeTagsExcept(a,b);a=this.opts.pasteLinks?a:this.removeTags(a,["a"]);a=this.opts.pasteImages?a:this.removeTags(a,["img"]);b=this.utils.buildWrapper(a);var c=b.find("*"),d=0!==this.opts.pasteKeepStyle.length?","+this.opts.pasteKeepStyle.join(","):"";c.not("[data-redactor-style-cache]"+d).removeAttr("style");d=0!==this.opts.pasteKeepClass.length?","+this.opts.pasteKeepClass.join(","):"";c.not("[data-redactor-style-cache]"+
d).removeAttr("class");d=0!==this.opts.pasteKeepAttrs.length?","+this.opts.pasteKeepAttrs.join(","):"";return c.not("img, a, [data-redactor-style-cache]"+d).each(function(a){for(;0<a.attributes.length;)a.removeAttribute(a.attributes[0].name)}),this.opts.pasteLinks&&!1!==this.opts.pasteLinkTarget&&b.find("a").attr("target",this.opts.pasteLinkTarget),b.find("[data-redactor-style-cache]").each(function(a){var e=a.getAttribute("data-redactor-style-cache");a.setAttribute("style",e)}),b.find("span").each(function(a){0===
a.attributes.length&&l.dom(a).unwrap()}),b.find(this.opts.inlineTags.join(",")).each(function(a){0===a.attributes.length&&this.utils.isEmptyHtml(a.innerHTML)&&l.dom(a).unwrap()}.bind(this)),b.find("ul, ol").each(function(a){var e=a.previousSibling;e&&"LI"===e.tagName&&(e=l.dom(e),e.find("p").unwrap(),e.append(a))}),a=(a=(a=(a=(a=this.utils.getWrapperHtml(b)).replace(/<li><p>/gi,"<li>")).replace(/<\/p><\/li>/gi,"</li>")).replace(/<p>&nbsp;<\/p>/gi,"<p></p>")).replace(/<p><br\s?\/?><\/p>/gi,"<p></p>"),
e&&(a=(a=a.replace(/<p><\/p>/gi,"")).replace(/<p>\s<\/p>/gi,"")),a=this.restoreComponents(a)},pastePlainText:function(a){return a=this.opts.pasteLinks?this.storeLinks(a):a,a=this.opts.pasteImages?this.storeImages(a):a,a=this.getPlainText(a),a=this._replaceNlToBr(a),a=this.opts.pasteLinks?this.restoreLinks(a):a,this.opts.pasteImages?this.restoreImages(a):a},tidy:function(a){return a},paragraphize:function(a){return l.create("cleaner.paragraphize",this.app).convert(a)},getFlatText:function(a){var e=
l.dom("<div>");return a.nodeType||a.dom?e.append(a):(a=(a=a.toString()).trim(),e.html(a)),void 0===(a=e.get().textContent||e.get().innerText||"")?"":a},getPlainText:function(a){a=(a=(a=(a=(a=(a=a.replace(/\x3c!--[\s\S]*?--\x3e/gi,"")).replace(/<style[\s\S]*?style>/gi,"")).replace(/<p><\/p>/g,"")).replace(/<\/div>|<\/li>|<\/td>/gi,"\n")).replace(/<\/p>/gi,"\n\n")).replace(/<\/H[1-6]>/gi,"\n\n");var e=document.createElement("div");return e.innerHTML=a,(e.textContent||e.innerText).trim()},replaceTags:function(a,
b){if(b){var e=this,c=Object.keys(b);a=this.utils.buildWrapper(a);a.find(c.join(",")).each(function(a){e.utils.replaceToTag(a,b[a.tagName.toLowerCase()])});a=this.utils.getWrapperHtml(a)}return a},replaceNbspToSpaces:function(a){return a.replace("&nbsp;"," ")},replaceBlocksToBr:function(a){return a.replace(/<\/div>|<\/li>|<\/td>|<\/p>|<\/H[1-6]>/gi,"<br>")},cleanNewLines:function(a){return a.replace(/\r?\n/g,"")},cleanSpacesInPre:function(a){return a.replace("&nbsp;&nbsp;&nbsp;&nbsp;","    ")},removeInvisibleSpaces:function(a){return this.utils.removeInvisibleChars(a).replace(/&#65279;/gi,
"")},removeNl:function(a){return a.replace(/\n/g," ").replace(/\s+/g,"s")},removeBrAtEnd:function(a){return a.replace(/<br\s?\/?>$/gi," ").replace(/<br\s?\/?><li/gi,"<li")},removeTags:function(a,b){return a.replace(b?/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi:/(<([^>]+)>)/gi,b?function(a,e){return-1===b.indexOf(e.toLowerCase())?a:""}:"")},removeTagsExcept:function(a,b){return void 0===b?a.replace(/(<([^>]+)>)/gi,""):a.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(a,e){return-1===b.indexOf(e.toLowerCase())?
"":a})},removeComments:function(a){return a.replace(this.reComments,"")},removeServiceTagsAndAttrs:function(a,b){a=this.utils.buildWrapper(a);var e=this;return!1!==b&&a.find(".redactor-selection-marker").each(function(a){a=l.dom(a);return""===e.utils.removeInvisibleChars(a.text())?a.remove():a.unwrap()}),a.find("[data-redactor-style-cache]").removeAttr("data-redactor-style-cache"),this.utils.getWrapperHtml(a)},removeSpanWithoutAttributes:function(a){a=this.utils.buildWrapper(a);return a.find("span").removeAttr("data-redactor-span data-redactor-style-cache").each(function(a){0===
a.attributes.length&&l.dom(a).unwrap()}),this.utils.getWrapperHtml(a)},removeFirstBlockBreaklineInHtml:function(a){return a.replace(/<\/li><br\s?\/?>/gi,"</li>")},removeEmptyAttributes:function(a,b){a=this.utils.buildWrapper(a);for(var e=0;e<b.length;e++)a.find("["+b[e]+'=""]').removeAttr(b[e]);return this.utils.getWrapperHtml(a)},encodeHtml:function(a){return a=(a=(a=(a=(a=(a=a.replace(/<br\s?\/?>/g,"\n")).replace(/&nbsp;/g," ")).replace(/\u201d/g,'"')).replace(/\u201c/g,'"')).replace(/\u2018/g,
"'")).replace(/\u2019/g,"'"),a=(a=this.encodeEntities(a)).replace(/\$/g,"&#36;"),this.opts.preSpaces&&(a=a.replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),a},encodePreCode:function(a){var e=a.match(/<code(.*?)>(.*?)<pre(.*?)>(.*?)<\/pre>(.*?)<\/code>/gi);if(null!==e)for(var b=0;b<e.length;b++){var c=e[b].match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);a=a.replace(c[0],this.encodeEntities(c[0]))}e=this.utils.buildWrapper(a);return e.find("code code").replaceWith(this._encodeOuter.bind(this)),e.find("code pre").replaceWith(this._encodeOuter.bind(this)),
e.find("pre pre").replaceWith(this._encodeOuter.bind(this)),e.find("code, pre").each(this._encodePreCodeLine.bind(this)),a=this.utils.getWrapperHtml(e),this._decodeMarkers(a)},encodeEntities:function(a){return this.decodeEntities(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},encodePhpCode:function(a){return a.replace("<?php","&lt;?php").replace("<?","&lt;?").replace("?>","?&gt;")},decodeEntities:function(a){return String(a).replace(/&lt;/g,"<").replace(/&gt;/g,
">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},storeComponents:function(a){var e=this.utils.getElementsFromHtml(a,"figure","table");return this._storeMatched(a,e,"Components","figure")},restoreComponents:function(a){return this._restoreMatched(a,"Components","figure")},storeLinks:function(a){var e=this.utils.getElementsFromHtml(a,"a");return this._storeMatched(a,e,"Links","a")},storeImages:function(a){var e=this.utils.getElementsFromHtml(a,"img");return this._storeMatched(a,e,"Images","img")},
restoreLinks:function(a){return this._restoreMatched(a,"Links","a")},restoreImages:function(a){return this._restoreMatched(a,"Images","img")},_cleanWrapped:function(a){return a.replace(/<p><figure([\w\W]*?)<\/figure><\/p>/gi,"<figure$1</figure>")},_cleanGDocs:function(a){return a.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2").replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3").replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,
"<b><i>$2</i></b>").replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>").replace(/<span[^>]*font-style: italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>").replace(/<span[^>]*font-weight: bold[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>").replace(/<span[^>]*font-weight: 700[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")},_cleanMsWord:function(a){a=(a=(a=(a=(a=a.replace(/\x3c!--[\s\S]+?--\x3e/gi,"")).replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,
"")).replace(/<(\/?)s>/gi,"<$1strike>")).replace(/&nbsp;/gi," ")).replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(a,e){return 0<e.length?e.replace(/./," ").slice(Math.floor(e.length/2)).split("").join("\u00a0"):""});var e=this.utils.buildWrapper(a);e.find("p").each(function(a){a=l.dom(a);var e=a.attr("style");(e=/mso-list:\w+ \w+([0-9]+)/.exec(e))&&a.data("_listLevel",parseInt(e[1],10))});this._parseWordLists(e);e.find("[style]").removeAttr("style");
e.find("[align]").removeAttr("align");e.find("[name]").removeAttr("name");e.find("span").unwrap();e.find("[class^='Mso']").removeAttr("class");e.find("a").filter(function(a){return!a.hasAttribute("href")}).unwrap();var b="";e=(a=(a=(a=(a=(a=this.utils.getWrapperHtml(e)).replace(/<p[^>]*><\/p>/gi,"")).replace(/<li>\u00b7/gi,"<li>")).trim()).replace(/\/(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)>\s+<(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)/gi,"/$1>\n<$2")).split(/\n/);for(a=0;a<e.length;a++){var c=""!==e[a]&&
-1===e[a].search(/>$/)?" ":"\n";b+=e[a]+c}return b},_parseWordLists:function(a){var e=0,b=null;a.find("p").each(function(a){a=l.dom(a);var c=a.data("_listLevel");if(null!==c){var d=a.text(),f="<ul></ul>";/^\s*\w+\./.test(d)&&((d=/([0-9])\./.exec(d))?(d=parseInt(d[1],10),f=1<d?'<ol start="'+d+'"></ol>':"<ol></ol>"):f="<ol></ol>");c>e&&(0===e?(a.before(f),b=a.prev()):(d=l.dom(f),b.append(d)));if(c<e)for(d=0;d<e-c;d++)b=b.parent();a.find("span").first().unwrap();b.append("<li>"+a.html()+"</li>");a.remove();
e=c}else e=0})},_isSpacedEmpty:function(a){return-1!==a.search(this.reSpacedEmpty)},_isParagraphEmpty:function(a){return-1!==a.search(/^<p><\/p>$/i)},_isHtmlMsWord:function(a){return a.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},_setSpanAttr:function(a){a=this.utils.buildWrapper(a);return a.find("span").attr("data-redactor-span",!0),this.utils.getWrapperHtml(a)},_setStyleCache:function(a){a=this.utils.buildWrapper(a);return a.find("[style]").each(function(a){a=l.dom(a);
a.attr("data-redactor-style-cache",a.attr("style"))}),this.utils.getWrapperHtml(a)},_setPreClass:function(a){a=this.utils.buildWrapper(a);return a.find("pre").addClass(this.opts.preClass),this.utils.getWrapperHtml(a)},_setLinkNofollow:function(a){a=this.utils.buildWrapper(a);return a.find("a").attr("rel","nofollow"),this.utils.getWrapperHtml(a)},_replaceScriptTag:function(a){return a.replace(this.reScriptTag,'<pre class="redactor-script-tag" $1>$2</pre>')},_unreplaceScriptTag:function(a){return a.replace(/<pre class="redactor-script-tag"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,
"<script$1>$2\x3c/script>")},_replaceNlToBr:function(a){return a.replace(/\n/g,"<br />")},_removeScriptTag:function(a){return a.replace(this.reScriptTag,"")},_storeMatched:function(a,b,c,d){if(this["stored"+c]=[],b)for(var e=0;e<b.length;e++)this["stored"+c][e]=b[e],a=a.replace(b[e],"####"+d+e+"####");return a},_restoreMatched:function(a,b,c){if(this["stored"+b])for(var e=0;e<this["stored"+b].length;e++)a=a.replace("####"+c+e+"####",this["stored"+b][e]);return a},_decodeMarkers:function(a){return a.replace(/&lt;span\sid="selection-marker-(start|end)"\sclass="redactor-selection-marker"&gt;(.*?[^>]?)&lt;\/span&gt;/g,
'<span id="selection-marker-$1" class="redactor-selection-marker">\u200b</span>')},_encodeOuter:function(a){return this.encodeEntities(a.outerHTML)},_encodePreCodeLine:function(a){var e=a.firstChild;"PRE"==a.tagName&&e&&"CODE"===e.tagName||(e=this.decodeEntities(a.innerHTML),e=e.replace(/&nbsp;/g," ").replace(/<br\s?\/?>/g,"\n"),e=this.opts.preSpaces?e.replace(/\t/g,Array(this.opts.preSpaces+1).join(" ")):e,a.textContent=e)}});l.add("class","cleaner.figure",{init:function(a){this.app=a;this.opts=
a.opts;this.utils=a.utils},convert:function(a,b){a=this.utils.buildWrapper(a);return a.find("img").each(this._convertImage.bind(this)),a.find("hr").each(this._convertLine.bind(this)),a.find("iframe").each(this._convertIframe.bind(this)),a.find("table").each(this._convertTable.bind(this)),a.find("form").each(this._convertForm.bind(this)),a.find("figure pre").each(this._convertCode.bind(this)),a.find("[data-redactor-type=variable]").addClass("redactor-component"),a.find("figure").not(".redactor-component, .redactor-figure-code").each(this._convertWidget.bind(this)),
a.find("figure pre").each(this._setContenteditableCode.bind(this)),a.find(".redactor-component, .non-editable").attr("contenteditable",!1),a.find("figcaption, td, th").attr("contenteditable",!0),a.find(".redactor-component, figcaption").attr("tabindex","-1"),this._acceptExtraRules(a,b),this.utils.getWrapperHtml(a)},unconvert:function(a,b){a=this.utils.buildWrapper(a);return a.find("th, td, figcaption, figure, pre, code, .redactor-component").removeAttr("contenteditable tabindex"),a.find("figure").removeClass("redactor-component redactor-component-active redactor-uploaded-figure"),
a.find("[data-redactor-type=variable]").removeClass("redactor-component"),a.find("figure[data-redactor-type=line]").unwrap(),a.find("figure[data-redactor-type=widget]").each(this._unconvertWidget.bind(this)),a.find("figure[data-redactor-type=form]").each(this._unconvertForm.bind(this)),a.find("figure[data-redactor-type=table]").each(this._unconvertTable.bind(this)),a.find("figure[data-redactor-type=image]").removeAttr("rel").each(this._unconvertImages.bind(this)),a.find("img").removeAttr("data-redactor-type").removeClass("redactor-component"),
a.find(".non-editable").removeAttr("contenteditable"),a.find("figure").each(this._removeTypes.bind(this)),a.find("span.redactor-component-caret").remove(),this.opts.breakline&&a.find('[data-redactor-tag="br"]').each(function(a){a.lastChild&&"BR"!==a.lastChild.tagName&&a.appendChild(document.createElement("br"))}).unwrap(),this._acceptExtraRules(a,b),a=(a=this.utils.getWrapperHtml(a)).replace(/<br\s?\/?>$/,"")},_convertImage:function(a){a=l.dom(a);if(!this._isNonEditable(a)){a.attr("data-image")||
a.attr("data-image",this.utils.getRandomId());var e=a.closest("a"),b=a.closest("figure");0===b.children().not("a, img, br, figcaption").length&&(0===b.length?b=0!==e.length?e.wrap("<figure>"):a.wrap("<figure>"):b.hasClass("redactor-uploaded-figure")?b.removeClass("redactor-uploaded-figure"):b.addClass("redactor-keep-figure"),this._setFigure(b,"image"))}},_convertTable:function(a){this._isNonEditable(a)||(a=this._wrapFigure(a),this._setFigure(a,"table"))},_convertLine:function(a){this._isNonEditable(a)||
(a=this._wrapFigure(a),this._setFigure(a,"line"))},_convertForm:function(a){this._isNonEditable(a)||(a=this.utils.replaceToTag(a,"figure"),this._setFigure(a,"form"))},_convertIframe:function(a){if(!this._isNonEditable(a)){var e=a.getAttribute("src");e=e&&(e.match(this.opts.regex.youtube)||e.match(this.opts.regex.vimeo));a=this._wrapFigure(a);e&&this._setFigure(a,"video")}},_convertCode:function(a){this._isNonEditable(a)||(a=this._wrapFigure(a),this._setFigure(a,"code"))},_convertWidget:function(a){if(!this._isNonEditable(a)){var e=
l.dom(a);e.addClass("redactor-component");e.attr("data-redactor-type","widget");e.attr("data-widget-code",encodeURI(a.innerHTML.trim()))}},_unconvertForm:function(a){this.utils.replaceToTag(a,"form")},_unconvertTable:function(a){l.dom(a).unwrap()},_unconvertWidget:function(a){a=l.dom(a);a.html(decodeURI(a.attr("data-widget-code")));a.removeAttr("data-widget-code")},_unconvertImages:function(a){a=l.dom(a);a.removeClass("redactor-component");var e=0!==a.closest("li").length,b=0!==a.closest("table").length,
c=0!==a.find("figcaption").length,d=a.attr("style");d=!(null===d||""===d);var f=""!==a.attr("class");(e||b&&!c&&!d&&!f)&&a.unwrap()},_removeTypes:function(a){a=l.dom(a);var e=a.attr("data-redactor-type");(e&&-1!=="image widget line video code form table".split(" ").indexOf(e)&&a.removeAttr("data-redactor-type"),a.hasClass("redactor-keep-figure"))?a.removeClass("redactor-keep-figure"):!1===this.opts.imageFigure&&(0!==a.find("figcaption").length||a.unwrap())},_wrapFigure:function(a){a=l.dom(a);var e=
a.closest("figure");return 0===e.length?a.wrap("<figure>"):e},_setFigure:function(a,b){a.addClass("redactor-component");a.attr("data-redactor-type",b)},_setContenteditableCode:function(a){if(!this._isNonEditable(a)){a=l.dom(a);var e=a.children("code").first();(0!==e.length?e:a).attr("contenteditable",!0).attr("tabindex","-1")}},_acceptExtraRules:function(a,b){for(var e in b)"function"==typeof b[e]&&b[e](a)},_isNonEditable:function(a){return 0!==l.dom(a).closest(".non-editable").length}});l.add("class",
"cleaner.paragraphize",{init:function(a){this.app=a;this.opts=a.opts;this.utils=a.utils;this.element=a.element;this.stored=[];this.remStart="#####replace";this.remEnd="#####";this.paragraphizeTags="table div pre form ul ol h1 h2 h3 h4 h5 h6 dl blockquote figcaption address section header footer aside article object style script iframe select input textarea button option map area math hr fieldset legend hgroup nav figure details menu summary p".split(" ")},convert:function(a){var e=this._isConverted(a);
return!0===e?this._convert(a):e},_convert:function(a){var e=this.opts.breakline?"sdivtag":this.opts.markup;return a=(a=this._storeTags(a)).trim(),a=this.opts.breakline?(a=(a=(a=(a=(a=a.replace(/\n#####/gi,"xnonbreakmarkerz#####")).replace(/#####\n\n/gi,"#####\nxnonbreakmarkerz")).replace(/#####\n/gi,"#####xnonbreakmarkerz")).replace(/<br\s?\/?>\n/gi,"<br>")).replace(/\n/g,"<br>")).replace(/xnonbreakmarkerz/gi,"\n"):a.replace(/[\n]+/g,"\n"),a=this._trimEmptyLines(a),a=(a=(a=this.opts.breakline?a:a.replace(/<br\s?\/?>\n/gi,
"xbreakmarkerz\n")).replace(/(?:\r\n|\r|\n)/g,"xparagraphmarkerz")).replace(/xparagraphmarkerz/gi,"</"+e+">\n<"+e+">"),a=(a=(a="<"+e+">"+(a=this.opts.breakline?a:a.replace(/xbreakmarkerz/gi,"<br>"))+"</"+e+">").replace(new RegExp("<"+e+">#####","gi"),"#####")).replace(new RegExp("#####</"+e+">","gi"),"#####"),a=this._restoreTags(a),(this.opts.breakline?a:a.replace(new RegExp("<"+e+"><br\\s?/?></"+e+">","gi"),"<"+e+"></"+e+">")).replace(/<sdivtag>/gi,'<div data-redactor-tag="br">').replace(/sdivtag/gi,
"div")},_storeTags:function(a){var e=this;a=this.utils.buildWrapper(a);return this.opts.breakline&&a.find("p").each(function(a){a=l.dom(a);0===a.closest("figure[data-redactor-type=widget],figure[data-redactor-type=form],.non-editable").length&&(a.append("<br><br>"),a.unwrap())}),a.find(this.paragraphizeTags.join(", ")).each(function(a,b){b=document.createTextNode("\n"+e.remStart+b+e.remEnd+"\n");e.stored.push(a.outerHTML);a.parentNode.replaceChild(b,a)}),this.utils.getWrapperHtml(a)},_restoreTags:function(a){for(var e=
0;e<this.stored.length;e++)this.stored[e]=this.stored[e].replace(/\$/g,"&#36;"),a=a.replace(this.remStart+e+this.remEnd,this.stored[e]);return a},_trimEmptyLines:function(a){var e="";a=a.split("\n");for(var b=0;b<a.length;b++)""!==a[b].trim()&&(e+=a[b]+"\n");return e.replace(/\n$/,"")},_isConverted:function(a){return this._isDisabled(a)?a:!this._isEmptyHtml(a)||this.opts.emptyHtml},_isDisabled:function(){return!1===this.opts.paragraphize||this.element.isType("inline")},_isEmptyHtml:function(a){return""===
a||"<p></p>"===a||"<div></div>"===a}});l.add("service","detector",{init:function(a){this.app=a;this.userAgent=navigator.userAgent.toLowerCase()},isWebkit:function(){return/webkit/.test(this.userAgent)},isFirefox:function(){return-1<this.userAgent.indexOf("firefox")},isIe:function(a){return document.documentMode||/Edge/.test(navigator.userAgent)?"edge":((e=RegExp("msie"+(isNaN(a)?"":"\\s"+a),"i").test(navigator.userAgent))||(e=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)),e);var e},isMobile:function(){return/(iPhone|iPod|Android)/.test(navigator.userAgent)},
isDesktop:function(){return!/(iPhone|iPod|iPad|Android)/.test(navigator.userAgent)},isIpad:function(){return/iPad/.test(navigator.userAgent)}});l.add("service","offset",{init:function(a){this.app=a},get:function(a,b){var e={start:0,end:0};a=this.utils.getNode(a);if(!a)return!1;var c=this.editor.isEditor(a),d=!!c||this.selection.isIn(a),f=this.selection.getRange();c||d?this.selection.is()&&d&&(c=l.dom(f.startContainer).hasClass("redactor-component")?f.startOffset:0,d=f.cloneRange(),d.selectNodeContents(a),
d.setEnd(f.startContainer,f.startOffset),e.start=this._getString(d,b).length-c,e.end=e.start+this._getString(f,b).length+c):e=!1;return e},set:function(a,b){if(!this._setComponentOffset(b)&&(this.component.clearActive(),b=this.utils.getNode(b))){var e=this.size(b),c=0,d=document.createRange();a.end=a.end>e?e:a.end;d.setStart(b,0);d.collapse(!0);e=[b];for(var f=!1,l=!1;!l&&(b=e.pop());)if(3==b.nodeType){var g=c+b.length;!f&&!this._isFigcaptionNext(b)&&a.start>=c&&a.start<=g&&(d.setStart(b,a.start-
c),f=!0);f&&a.end>=c&&a.end<=g&&(d.setEnd(b,a.end-c),l=!0);c=g}else for(g=b.childNodes.length;g--;)e.push(b.childNodes[g]);this.selection.setRange(d)}},size:function(a,b){if(a=this.utils.getNode(a)){var e=document.createRange().cloneRange();return e.selectNodeContents(a),this._getString(e,b).length}return 0},_getString:function(a,b){a=a.toString();return a=this.editor.isEmpty()?a.replace(/\uFEFF/g,""):a,b?a.trim():a},_setComponentOffset:function(a){return!!this.component.isNonEditable(a)&&this.component.setActive(a)},
_isFigcaptionNext:function(a){var e=a.nextSibling;return""===a.nodeValue.trim()&&e&&"FIGCAPTION"===e.tagName}});l.add("service","inspector",{init:function(a){this.app=a},parse:function(a){return l.create("inspector.parser",this.app,this,a)},isText:function(a){return"string"!=typeof a||/^\s*<(\w+|!)[^>]*>/.test(a)?(a=l.dom(a).get())&&3===a.nodeType:!0},isInlineTag:function(a,b){b=this._extendTags(this.opts.inlineTags,b);return this._isTag(a)&&-1!==b.indexOf(a.toLowerCase())},isBlockTag:function(a,
b){b=this._extendTags(this.opts.blockTags,b);return this._isTag(a)&&-1!==b.indexOf(a.toLowerCase())},isTableCellTag:function(a){return-1!==["td","th"].indexOf(a.toLowerCase())},isHeadingTag:function(a){return-1!=="h1 h2 h3 h4 h5 h6".split(" ").indexOf(a.toLowerCase())},_isTag:function(a){return void 0!==a&&a},_extendTags:function(a,b){if(a=a.concat(a),b)for(var e=0;e<b.length;e++)a.push(b[e]);return a}});l.add("class","inspector.parser",{init:function(a,b,c){this.app=a;this.uuid=a.uuid;this.opts=
a.opts;this.utils=a.utils;this.editor=a.editor;this.selection=a.selection;this.inspector=b;this.el=c;this.$el=l.dom(this.el);this.node=this.$el.get();this.$component=this.$el.closest(".redactor-component",".redactor-in")},isEditor:function(){return this.node===this.editor.getElement().get()},isInEditor:function(){return 0!==this.$el.parents(".redactor-in-"+this.uuid).length},isComponent:function(){return 0!==this.$component.length},isComponentType:function(a){return this.getComponentType()===a},isComponentActive:function(){return this.isComponent()&&
this.$component.hasClass("redactor-component-active")},isComponentEditable:function(){var a=this.getComponentType();return this.isComponent()&&-1!==["code","table"].indexOf(a)},isFigcaption:function(){return this.getFigcaption()},isPre:function(){return this.getPre()},isCode:function(){var a=this.$el.closest("code"),b=a.parent("pre");return 0!==a.length&&0===b.length},isList:function(){return this.getList()},isFirstListItem:function(){return this._getLastOrFirstListItem("first")},isLastListItem:function(){return this._getLastOrFirstListItem("last")},
isFirstTableCell:function(){return this._getLastOrFirstTableCell("first")},isLastTableCell:function(){return this._getLastOrFirstTableCell("last")},isTable:function(){return this.isComponentType("table")||this.getTable()},isHeading:function(){return this.getHeading()},isBlockquote:function(){return this.getBlockquote()},isDl:function(){return this.getDl()},isParagraph:function(){return this.getParagraph()},isLink:function(){return this.getLink()},isFile:function(){return this.getFile()},isText:function(){return this.inspector.isText(this.el)},
isInline:function(){var a=this.opts.inlineTags;return!!this.isElement()&&-1!==a.indexOf(this.node.tagName.toLowerCase())},isBlock:function(){var a=this.opts.blockTags;return!!this.isElement()&&-1!==a.indexOf(this.node.tagName.toLowerCase())},isElement:function(){return this.node&&this.node.nodeType&&3!==this.node.nodeType},hasParent:function(a){return 0!==this.$el.closest(a.join(",")).length},getNode:function(){return this.node},getTag:function(){return!!this.isElement()&&this.node.tagName.toLowerCase()},
getComponent:function(){return!!this.isComponent()&&this.$component.get()},getComponentType:function(){return!!this.isComponent()&&this.$component.attr("data-redactor-type")},getFirstNode:function(){return this.utils.getFirstNode(this.node)},getLastNode:function(){return this.utils.getLastNode(this.node)},getFirstElement:function(){return this.utils.getFirstElement(this.node)},getLastElement:function(){return this.utils.getLastElement(this.node)},getFigcaption:function(){return this._getClosestNode("figcaption")},
getPre:function(){return this._getClosestNode("pre")},getCode:function(){return this._getClosestNode("code")},getList:function(){return this._getClosestNode("ul, ol")},getParentList:function(){return this._getClosestUpNode("ul, ol")},getListItem:function(){return this._getClosestNode("li")},getTable:function(){return this.getComponentType("table")?this.$component.find("table").get():this._getClosestNode("table")},getTableCell:function(){var a=this.$el.closest("td, th");return 0!==a.length&&a.get()},
getComponentCodeElement:function(){return!!this.isComponentType("code")&&this.$component.find("pre code, pre").last().get()},getImageElement:function(){return!!this.isComponentType("image")&&this.$component.find("img").get()},getParagraph:function(){return this._getClosestNode("p")},getHeading:function(){return this._getClosestNode("h1, h2, h3, h4, h5, h6")},getDl:function(){return this._getClosestNode("dl")},getBlockquote:function(){return this._getClosestNode("blockquote")},getLink:function(){var a=
this.isComponent()&&!this.isFigcaption();return this.isComponentType("table")||!a?(a=this._getClosestElement("a"),!(!a||a.attr("data-file"))&&a.get()):!1},getFile:function(){var a=this.isComponent();return this.isComponentType("table")||!a?(a=this._getClosestElement("a"),!(!a||!a.attr("data-file"))&&a.get()):!1},findFirstNode:function(a){return this.$el.find(a).first().get()},findLastNode:function(a){return this.$el.find(a).last().get()},_getLastOrFirstListItem:function(a){var e=this.getList(),b=
this.getTag();return e&&"li"===b&&(a=l.dom(e).find("li")[a]().get())&&this.node===a?!0:!1},_getLastOrFirstTableCell:function(a){var e=this.getTable(),b=this.getTag();return e&&("td"===b||"th"===b)&&(a=l.dom(e).find("td, th")[a]().get())&&this.node===a?!0:!1},_getClosestUpNode:function(a){a=this.$el.parents(a,".redactor-in").last();return 0!==a.length&&a.get()},_getClosestNode:function(a){a=this.$el.closest(a,".redactor-in");return 0!==a.length&&a.get()},_getClosestElement:function(a){a=this.$el.closest(a,
".redactor-in");return 0!==a.length&&a}});l.add("service","marker",{init:function(a){this.app=a},build:function(a,b){var e=document.createElement("span");return e.id="selection-marker-"+this._getPos(a),e.className="redactor-selection-marker",e.innerHTML=this.opts.markerChar,b?e.outerHTML:e},buildHtml:function(a){return this.build(a,!0)},insert:function(a){this.remove();a="both"!==a&&("start"===a||this.selection.isCollapsed());this.selection.is()||this.editor.focus();var e=this.selection.getRange();
if(e){var b=this.build("start"),c=this.build("end"),d=e.cloneRange();return a||(d.collapse(!1),d.insertNode(c)),d.setStart(e.startContainer,e.startOffset),d.collapse(!0),d.insertNode(b),e.setStartAfter(b),a||e.setEndBefore(c),this.selection.setRange(e),b}},find:function(a,b){var e=this.editor.getElement();a=(b||e).find("span#selection-marker-"+this._getPos(a));return 0!==a.length&&a.get()},restore:function(){var a=this.find("start"),b=this.find("end"),c=this.selection.getRange();if(c&&this.selection.is()||
(this.editor.focus(),c=document.createRange()),a){var d=!!b&&b.previousSibling,f=a.nextSibling;f=(!f||3!==f.nodeType||""!==f.textContent.replace(/[\n\t]/g,""))&&f;b?f&&"selection-marker-end"===f.id?this._restoreInject(c,a):d&&f?(c.selectNodeContents(d),c.collapse(!1),c.setStart(f,0)):d&&!f?(c.selectNodeContents(d),c.collapse(!1),c.setStartAfter(a)):(c.setStartAfter(a),c.setEndBefore(b)):f?(c.selectNodeContents(f),c.collapse(!0)):this._restoreInject(c,a);this.selection.setRange(c);a&&a.parentNode.removeChild(a);
b&&b.parentNode.removeChild(b)}},remove:function(){var a=this.find("start"),b=this.find("end");a&&a.parentNode.removeChild(a);b&&b.parentNode.removeChild(b)},_getPos:function(a){return void 0===a?"start":a},_restoreInject:function(a,b){var e=this.utils.createInvisibleChar();l.dom(b).after(e);a.selectNodeContents(e);a.collapse(!1)}});l.add("service","component",{init:function(a){this.app=a;this.activeClass="redactor-component-active"},create:function(a,b){return l.create(a+".component",this.app,b)},
build:function(a){var e,b=l.dom(a).attr("data-redactor-type");return b&&(e=this.create(b,a)),e||a},remove:function(a,b){a=l.dom(a).closest(".redactor-component");var e=a.attr("data-redactor-type"),c=a.parent(),d=this.inspector.parse(c);c=this.utils.findSiblings(a,"prev");var f=this.utils.findSiblings(a,"next");if(!1!==this.app.broadcast(e+".delete",a)){if(a.remove(),this.app.broadcast(e+".deleted",a),this.app.broadcast("contextbar.close"),this.app.broadcast("imageresizer.stop"),!1!==b)(b=d.getTableCell())&&
this.utils.isEmptyHtml(b.innerHTML)?this.caret.setStart(b):f?this.caret.setStart(f):c?this.caret.setEnd(c):this.editor.startFocus();this.editor.isEmpty()&&(this.editor.setEmpty(),this.editor.startFocus(),this.app.broadcast("empty"))}},isNonEditable:function(a){a=this.inspector.parse(a);return a.isComponent()&&!a.isComponentEditable()},isActive:function(a){return a?(a=this.inspector.parse(a),l.dom(a.getComponent()).hasClass(this.activeClass)):0!==this._find().length},getActive:function(a){var e=this._find();
return 0!==e.length&&(a?e:e.get())},setActive:function(a){this.clearActive();this.editor.focus();a=this.inspector.parse(a);var e=a.getComponent();e=l.dom(e);a.isFigcaption()||(a=e.find(".redactor-component-caret"),0===a.length&&(a=this._buildCaret(),e.prepend(a)),this.caret.setAtStart(a.get()));e.addClass(this.activeClass)},clearActive:function(){var a=this._find();a.removeClass(this.activeClass);a.find(".redactor-component-caret").remove();this.app.broadcast("imageresizer.stop")},setOnEvent:function(a,
b){this.clearActive();var e=this.inspector.parse(a.target);e.isFigcaption()||e.isComponentEditable()||e.isComponent()&&(this.setActive(a.target),!0!==b&&a.preventDefault())},executeScripts:function(){for(var a=this.editor.getElement().find("[data-redactor-type]").find("script").getAll(),b=0;b<a.length;b++)if(""!==a[b].src){var c=a[b].src;this.$doc.find('head script[src="'+c+'"]').remove();var d=document.createElement("script");d.src=c;document.getElementsByTagName("head")[0].appendChild(d)}else eval(a[b].innerHTML)},
_find:function(){return this.editor.getElement().find("."+this.activeClass)},_buildCaret:function(){var a=l.dom("<span>");return a.addClass("redactor-component-caret"),a.attr("contenteditable",!0),a}});l.add("service","insertion",{init:function(a){this.app=a},set:function(a,b,c){return a=!1!==b?this.cleaner.input(a):a,a=!1!==b?this.cleaner.paragraphize(a):a,this.editor.getElement().html(a),!1!==c&&this.editor.endFocus(),a},insertNode:function(a,b){this.editor.focus();a=this.utils.isFragment(a)?a:
this.utils.createFragment(a);return this._collapseSelection(),this._insertFragment(a),this._setCaret(b,a),this._sendNodes(a.nodes)},insertBreakLine:function(){return this.insertNode(document.createElement("br"),"after")},insertNewline:function(){return this.insertNode(document.createTextNode("\n"),"after")},insertText:function(a){return this.insertHtml(this.cleaner.getFlatText(a))},insertChar:function(a){return this.insertNode(a,"after")},insertRaw:function(a){return this.insertHtml(a,!1)},insertPoint:function(a){var e,
b=this.marker.build("start"),c=!1,d=a.clientX;a=a.clientY;document.caretPositionFromPoint?(d=document.caretPositionFromPoint(d,a),a=document.getSelection(),this.inspector.parse(d.offsetNode).isInEditor()&&((e=a.getRangeAt(0)).setStart(d.offsetNode,d.offset),e.collapse(!0),e.insertNode(b),c=!0)):document.caretRangeFromPoint&&(e=document.caretRangeFromPoint(d,a),this.inspector.parse(e.startContainer).isInEditor()&&(e.insertNode(b),c=!0));return c},insertToPoint:function(a,b,c){!0===c||this.insertPoint(a)||
(a=this.editor.getLastNode(),l.dom(a).after(this.marker.build("start")));return this.component.clearActive(),this.selection.restoreMarkers(),this.insertHtml(b)},insertToOffset:function(a,b){return this.offset.set({start:a,end:a}),this.insertHtml(b)},insertHtml:function(a,b){if(this.opts.input){a=this.utils.parseHtml(a);if(this.selection.isAll())return this._insertToAllSelected(a);this.selection.is()||this.editor.startFocus();var e=this.selection.isCollapsed(),c=this.selection.isText(),d=this.selection.getCurrent(),
f=this.inspector.parse(d);this._collapseSelection();a=this._getCleanedInput(a,f,b);var g,m,p=this._isFigure(a.html),n=this._isComponentSpan(a.html),q=this.inspector.isText(a.html);return this.editor.isEmpty()?this._insertToEmptyEditor(a.html):f.isComponent()&&!f.isComponentEditable()?this._insertToWidget(d,f,a.html):n?this.insertNode(a.nodes,"end"):!p||c||f.isList()?f.isCode()?this._insertToCode(a,d,b):f.isPre()?this._insertToPre(a,b):f.isHeading()||f.isFigcaption()?(a.html=!1!==b?this.cleaner.removeTagsExcept(a.html,
["a"]):a.html,a.html=!1!==b?this.cleaner.replaceNbspToSpaces(a.html):a.html,g=this.utils.createFragment(a.html),this.insertNode(g,"end")):q?!c&&"br"!==this.opts.markup&&this._hasBlocksAndImages(a.nodes)?(a.html=!1!==b?this.cleaner.paragraphize(a.html):a.html,g=this.utils.createFragment(a.html),this.utils.splitNode(d,g),this.caret.setEnd(g.last),this._sendNodes(g.nodes)):(a.html=!1!==b?a.html.replace(/\n/g,"<br>"):a.html,g=this.utils.createFragment(a.html),this.insertNode(g.nodes,"end")):e||p?f.isInline()&&
!this._isPlainHtml(a.html)?this._insertToInline(d,a):f.isBlockquote()||f.isDl()?((m=this.opts.inlineTags).concat(["br"]),a.html=!1!==b?this.cleaner.replaceBlocksToBr(a.html):a.html,a.html=!1!==b?this.cleaner.removeTagsExcept(a.html,m):a.html,g=this.utils.createFragment(a.html),this.insertNode(g,"end")):f.isParagraph()?this._isPlainHtml(a.html)?this.insertNode(a.nodes,"end"):(a.html=!1!==b?this.cleaner.paragraphize(a.html):a.html,g=this.utils.createFragment(a.html),this.utils.splitNode(d,g),this.caret.setEnd(g.last),
this._sendNodes(g.nodes)):f.isList()&&(m=(m=this.opts.inlineTags).concat(["br","li","ul","ol","img"]),a.html=!1!==b?this.cleaner.replaceBlocksToBr(a.html):a.html,a.html=!1!==b?this.cleaner.removeTagsExcept(a.html,m):a.html,a.html=!1!==b?this.cleaner.removeBrAtEnd(a.html):a.html,g=this.utils.createFragment(a.html),a.nodes=g.nodes,this._containsTags(a.html,["ul","ol","li"]))?(b=this.selection.getElement(d))&&"LI"===b.tagName&&this.caret.isStart(b)?(a.nodes=l.dom(g.nodes).unwrap("ul, ol").getAll(),l.dom(b).before(a.nodes),
this.caret.setEnd(a.nodes[a.nodes.length-1]),this._sendNodes(a.nodes)):this._isPlainHtml(a.html)?this.insertNode(g,"end"):(g=this._buildList(a,b,g),this.utils.splitNode(d,g,!0),this.caret.setEnd(g.last),this._sendNodes(g.nodes)):this.insertNode(a.nodes,"end"):(a.html=!1!==b?this.cleaner.paragraphize(a.html):a.html,g=this.utils.createFragment(a.html),this.insertNode(g,"end")):f.isInline()?this._insertToInline(d,a):(g=this.utils.createFragment(a.html),this.utils.splitNode(d,g),this.caret.setEnd(g.last),
this._sendNodes(g.nodes))}},_insertToAllSelected:function(a){a=this.set(a.html);a=this.utils.parseHtml(a);return this._sendNodes(a.nodes)},_insertToEmptyEditor:function(a){a=this.cleaner.paragraphize(a);a=this.utils.createFragment(a);var b=this.editor.getElement();return b.html(""),b.append(a.frag),this.caret.setEnd(b),this._sendNodes(a.nodes)},_insertToInline:function(a,b){b=this.utils.createFragment(b.html);return this.utils.splitNode(a,b,!1,!0),this.caret.setEnd(b.last),this._sendNodes(b.nodes)},
_insertToCode:function(a,b,c){a.html=!1!==c?this.cleaner.encodeHtml(a.html):a.html;a.html=!1!==c?this.cleaner.removeNl(a.html):a.html;a=this.utils.createFragment(a.html);a=this.insertNode(a,"end");return this.utils.normalizeTextNodes(b),a},_insertToPre:function(a,b){a.html=!1!==b?this.cleaner.encodeHtml(a.html):a.html;a=this.utils.createFragment(a.html);return this.insertNode(a,"end")},_insertToWidget:function(a,b,c){c=this._isComponentSpan(c)?c:this.cleaner.paragraphize(c);a=this.utils.createFragment(c);
b=b.getComponent();b=l.dom(b);return b.after(a.frag),b.remove(),this.caret.setEnd(a.last),this._sendNodes(a.nodes)},_insertFragment:function(a){var b=this.selection.getRange();if(b){if(this.selection.isCollapsed()){var e=b.startContainer;3!==e.nodeType&&"BR"===e.tagName&&(this.caret.setAfter(e),e.parentNode.removeChild(e))}else b.deleteContents();b.insertNode(a.frag)}},_sendNodes:function(a){for(var b=0;b<a.length;b++){var e=a[b],c=3!==e.nodeType&&"function"==typeof e.getAttribute&&e.getAttribute("data-redactor-type");
c&&this.app.broadcast(c+".inserted",this.component.build(e))}return this.app.broadcast("inserted",a),this.component.executeScripts(),a},_setCaret:function(a,b){var e=this._isLastInline(b);a?(a=e&&"end"===a?"after":a,this.caret["set"+this.utils.ucfirst(a)](b.last)):!1!==a&&e&&this.caret.setAfter(b.last)},_isLastInline:function(a){return!!a.last&&this.inspector.parse(a.last).isInline()},_getCleanedInput:function(a,b,c){b=b.isCode()||b.isPre();return a.html=b||!1===c?a.html:this.cleaner.input(a.html),
b||!1===c?a:this.utils.parseHtml(a.html)},_getContainer:function(a){return l.dom(this.utils.createTmpContainer(a))},_buildList:function(a,b,c){return(a=a.nodes[0])&&3!==a.nodeType&&"li"===a.tagName?(b=l.dom(b).get().tagName.toLowerCase(),b=l.dom("<"+b+" />"),b.append(c.nodes),this.utils.createFragment(b.get().outerHTML)):c},_containsTags:function(a,b){return 0!==this._getContainer(a).find(b.join(",")).length},_collapseSelection:function(){},_hasFigureOrTable:function(a){return 0!==this._getContainer(a).find("figure, table").length},
_hasBlocks:function(a){return 0!==this._getContainer(a).find(this.opts.blockTags.join(",")).length},_hasBlocksAndImages:function(a){return 0!==this._getContainer(a).find(this.opts.blockTags.join(",")+",img").length},_isPlainHtml:function(a){return 0===this._getContainer(a).find(this.opts.blockTags.join(",")+", img").length},_isFigure:function(a){if(this._isHtmlString(a))return 0!==l.dom(a).closest("figure").length},_isComponentSpan:function(a){if(this._isHtmlString(a))return 0!==l.dom(a).closest("span.redactor-component").length},
_isHtmlString:function(a){return!("string"==typeof a&&!/^\s*<(\w+|!)[^>]*>/.test(a))}});l.add("service","block",{mixins:["formatter"],init:function(a){this.app=a},format:function(a){return this.type=a.type?a.type:"set",this.tag="string"==typeof a?a:a.tag,this.tag=this._prepareTag(this.tag),this.tag=this.tag.toLowerCase(),"string"==typeof a?this.args=!1:this.buildArgs(a),this._format()},getBlocks:function(a){return this.selection.getBlocks({tags:a||this._getTags(),first:!0})},getElements:function(a){var b=
this.selection.getBlock();return this.selection.isCollapsed()||!b||"TD"!==b.tagName&&"TH"!==b.tagName?l.dom(this.getBlocks(a)):this._wrapInsideTable("div")},clearFormat:function(a){this.selection.save();a=this.getElements(a||this._getTags());return a.each(function(a){for(;0<a.attributes.length;)a.removeAttribute(a.attributes[0].name)}),this.selection.restore(),a.getAll()},_format:function(){this.selection.save();var a,b,c=this.getBlocks(),d=this.selection.getBlock(),f=[];if(1===c.length&&"DIV"===
c[0].tagName){if(!(a=this._getTextNodesData())||0===a.nodes.length)return f=this._replaceBlocks(c),f=this._sendNodes(f),setTimeout(function(){this.selection.restore()}.bind(this),0),f;var g=this._getReplacedTag("set");var m=l.dom("<"+g+">");(b=a.last.nextSibling)&&"BR"===b.tagName&&l.dom(b).remove();for(g=0;g<a.nodes.length;g++)m.append(a.nodes[g]);return this.utils.splitNode(c[0],[m.get()]),f=this._sendNodes([m.get()]),this.utils.isEmptyHtml(m.html())?this.caret.setStart(m):setTimeout(function(){this.selection.restore()}.bind(this),
0),f}return 0<c.length?(f=this._replaceBlocks(c),f=this._sendNodes(f),setTimeout(function(){this.selection.restore()}.bind(this),0),f):this.selection.isCollapsed()||!d||"TD"!==d.tagName&&"TH"!==d.tagName?void 0:(g=this._getReplacedTag("set"),m=this._wrapInsideTable(g),this.selection.setAll(m),this._sendNodes([m.get()]))},_wrapInsideTable:function(a){var b=this._getTextNodesData();a=l.dom("<"+a+">");l.dom(b.first).before(a);for(var e=0;e<b.nodes.length;e++)a.append(b.nodes[e]);b=a.get().nextSibling;
return b&&"BR"===b.tagName&&l.dom(b).remove(),a},_prepareTag:function(a){return void 0===a?this.opts.markup:a},_sendNodes:function(a){return 0<a.length&&(a=this.applyArgs(a,!1),a=this._combinePre(a),a=this._cleanBlocks(a)),a},_getTags:function(){return"div p blockquote pre h1 h2 h3 h4 h5 h6".split(" ")},_replaceBlocks:function(a){var b=[],e=this._isToggleFormatType(a)?"toggle":"set";e=this._getReplacedTag(e);for(var c=0;c<a.length;c++){var d=this.utils.replaceToTag(a[c],e);b.push(d.get())}return b},
_getReplacedTag:function(a){a="toggle"===a?this.opts.markup:this.tag;return this.opts.breakline&&"p"===a?"div":a},_getTextNodesData:function(){var a=this.selection.getNodes({textnodes:!0,keepbr:!0});if(0===a.length)return!1;for(var b=a[0],c=a[a.length-1],d=c,f=!1;!f;){var g=this.selection.getInline(d);(d=g?g.nextSibling:d.nextSibling)&&(3===d.nodeType||"BR"!==d.tagName&&!this.inspector.isBlockTag(d.tagName))?a.push(d):f=!0}return{nodes:a,first:b,last:c}},_isToggleFormatType:function(a){for(var b=
0,e=a.length,c=0;c<e;c++)a[c]&&this.tag===a[c].tagName.toLowerCase()&&b++;return b===e},_combinePre:function(a){for(var b=[],e=0;e<a.length;e++){var c=a[e].nextElementSibling;if(c&&"PRE"===a[e].tagName&&"PRE"===c.tagName){var d=l.dom(a[e]);c=l.dom(c);var f=document.createTextNode("\n");d.append(f);d.append(c);c.unwrap("pre")}b.push(a[e])}return b},_cleanBlocks:function(a){for(var b="h1 h2 h3 h4 h5 h6".split(" "),e=this.opts.inlineTags,c=0;c<a.length;c++){var d=a[c].tagName.toLowerCase(),f=l.dom(a[c]);
-1!==b.indexOf(d)?f.find("span").not(".redactor-component, .non-editable, .redactor-selection-marker").unwrap():"pre"===d&&f.find(e.join(",")).not(".redactor-selection-marker").unwrap();this.opts.breakline&&"div"===d?f.attr("data-redactor-tag","br"):f.removeAttr("data-redactor-tag");this.utils.normalizeTextNodes(a[c])}return a}});l.add("service","inline",{mixins:["formatter"],init:function(a){this.app=a},format:function(a){return this._isFormat()?(this.type=a.type?a.type:"set",this.tag="string"==
typeof a?a:a.tag,this.tag=this.tag.toLowerCase(),this.tag=this.arrangeTag(this.tag),"string"==typeof a?this.args=!1:this.buildArgs(a),this.selection.isCollapsed()?this.formatCollapsed():this.formatUncollapsed()):[]},_isFormat:function(){var a=this.selection.getCurrent(),b=this.inspector.parse(a),c=b.isComponent()&&!b.isComponentType("table")&&!b.isFigcaption();return!(!a||b.isPre()||b.isCode()||c)},arrangeTag:function(a){var b=this.opts.replaceTags,e;for(e in b)a===e&&(a=b[e]);return a},formatCollapsed:function(){var a,
b,c,d=[],f=this.selection.getInlineFirst(),g=this.selection.getInlines({all:!0}),m=l.dom(f);if(f){var n=this.inspector.parse(f);if(this.utils.isEmptyHtml(f.innerHTML))if(f.tagName.toLowerCase()===this.tag)if(this.hasSameArgs(f)){this.caret.setAfter(f);m.remove();var q=this.selection.getElement();this.utils.normalizeTextNodes(q)}else"span"===this.tag?(d=this.applyArgs([f],!1),this.caret.setStart(f)):d=this.insertInline(d);else n.hasParent([this.tag])?(a=(q=m.closest(this.tag)).get(),this.hasSameArgs(a)?
(q.unwrap(),this.caret.setStart(f)):d=this.insertInline(d)):d=this.insertInline(d);else if(f.tagName.toLowerCase()===this.tag)this.hasSameArgs(f)?(c=this.utils.extractHtmlFromCaret(f),b=l.dom("<"+this.tag+" />"),b=this.utils.cloneAttributes(f,b),m.after(b.append(c)),this.caret.setAfter(f)):d=this.insertInline(d);else if(n.hasParent([this.tag]))if(a=(q=m.closest(this.tag)).get(),this.hasSameArgs(a)){var B,G;c=this.utils.extractHtmlFromCaret(a,a);b=l.dom("<"+this.tag+" />");b=this.utils.cloneAttributes(a,
b);f=0;g=g.reverse();for(m=0;m<g.length;m++)g[m]!==a&&(G=l.dom("<"+g[m].tagName.toLowerCase()+">"),0===f?B=G:B.append(G),f++);q.after(b.append(c));q.after(B);this.caret.setStart(G)}else d=this.insertInline(d);else d=this.insertInline(d)}else d=this.insertInline(d);return d},insertInline:function(a){var b=document.createElement(this.tag);return a=this.insertion.insertNode(b,"start"),this.applyArgs(a,!1)},hasSameArgs:function(a){if(0===a.attributes.length&&!1===this.args)return!0;var b=!0;if(this.args){b=
0;for(var e in this.args){var c=l.dom(a),d=this.args[e],f=this.utils.toParams(d),g=c.attr(e);if(d)if("style"===e){f=f.trim().replace(/;$/,"");d=this.utils.styleToObj(c.attr("style"));f=f.split(";");for(var m=g=0;m<f.length;m++){var n=f[m].split(":"),q=n[0].trim();n=n[1].trim();-1!==q.search(/color/)?(q=c.css(q),!q||q!==n&&this.utils.rgb2hex(q)!==n||g++):c.css(q)===n&&g++}g===f.length&&Object.keys(d).length===f.length&&b++}else g===f&&b++;else g&&""!==g||b++}b=b===Object.keys(this.args).length}return b},
formatUncollapsed:function(){var a=this.selection.getInlines({all:!0,inside:!0});this.selection.save();this._convertTags("u");this._convertTags("del");this._convertToStrike(a);this.selection.restore();document.execCommand("strikethrough");this._clearDecoration();this.selection.save();a=this._revertToInlines();return a=this.applyArgs(a,!1),this.selection.restore(),this._clearEmptyStyle(),this._normalizeBlocks(a)},_convertTags:function(a){this.tag!==a&&this.editor.getElement().find(a).each(function(b){this.utils.replaceToTag(b,
"span").addClass("redactor-convertable-"+a)}.bind(this))},_revertTags:function(a){this.editor.getElement().find("span.redactor-convertable-"+a).each(function(b){b=this.utils.replaceToTag(b,a);b.removeClass("redactor-convertable-"+a);this.utils.removeEmptyAttr(b,"class")&&b.removeAttr("class")}.bind(this))},_convertToStrike:function(a){for(var b=this.selection.getText().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e=0;e<a.length;e++){var c=this.arrangeTag(a[e].tagName.toLowerCase()),d=a[e],
f=l.dom(d),g=this.hasSameArgs(d);c===this.tag&&("span"===this.tag&&this._isTextSelected(d,b)?f.addClass("redactor-convertable-apply"):g?this._replaceToStrike(f):"span"===this.tag&&f.addClass("redactor-unconvertable-apply"))}},_replaceToStrike:function(a){a.replaceWith(function(){return l.dom("<strike>").append(a.contents())})},_revertToInlines:function(){var a=[],b=this.editor.getElement();return"u"!==this.tag&&b.find("u").unwrap(),b.find("span.redactor-convertable-apply").each(function(b){var e=
l.dom(b);e.find("strike").unwrap();this._forceRemoveClass(e,"redactor-convertable-apply");a.push(b)}.bind(this)),b.find("span.redactor-unconvertable-apply").each(function(a){a=l.dom(a);this._forceRemoveClass(a,"redactor-unconvertable-apply")}.bind(this)),b.find("strike").each(function(b){b=this.utils.replaceToTag(b,this.tag);a.push(b.get())}.bind(this)),this._revertTags("u"),this._revertTags("del"),a},_normalizeBlocks:function(a){var b=this.opts.inlineTags,e=this.selection.getBlocks();if(e)for(var c=
0;c<e.length;c++)"PRE"===e[c].tagName&&l.dom(e[c]).find(b.join(",")).not(".redactor-selection-marker").each(function(b){-1!==a.indexOf(b)&&(a=this.utils.removeFromArrayByValue(a,b));l.dom(b).unwrap()}.bind(this));return a},_clearDecoration:function(){this.editor.getElement().find(this.opts.inlineTags.join(",")).each(function(a){if("line-through"===a.style.textDecoration||"line-through"===a.style.textDecorationLine)a=l.dom(a),a.css("textDecorationLine",""),a.css("textDecoration",""),a.wrap("<strike>")})},
_clearEmptyStyle:function(){for(var a=this.getInlines(),b=0;b<a.length;b++){this._clearEmptyStyleAttr(a[b]);var c=a[b].childNodes;if(c)for(var d=0;d<c.length;d++)this._clearEmptyStyleAttr(c[d])}},_clearEmptyStyleAttr:function(a){3!==a.nodeType&&this.utils.removeEmptyAttr(a,"style")&&(a.removeAttribute("style"),a.removeAttribute("data-redactor-style-cache"))},_forceRemoveClass:function(a,b){a.removeClass(b);this.utils.removeEmptyAttr(a,"class")&&a.removeAttr("class")},_isTextSelected:function(a,b){a=
this.utils.removeInvisibleChars(a.textContent);return b===a||-1!==b.search(new RegExp("^"+this.utils.escapeRegExp(a)+"$"))},getInlines:function(a){return a?this.selection.getInlines({tags:a,all:!0}):this.selection.getInlines({all:!0})},getElements:function(a){return l.dom(this.getInlines(a))},clearFormat:function(){this.selection.save();for(var a=this.selection.getInlines({all:!0}),b=0;b<a.length;b++){var c=l.dom(a[b]);this.selection.getInline(a[b])&&c.unwrap()}this.selection.restore()}});l.add("service",
"autoparser",{init:function(a){this.app=a},observe:function(){var a=this.editor.getElement().find(".redactor-autoparser-object").each(function(a){a=l.dom(a);a.removeClass("redactor-autoparser-object");""===a.attr("class")&&a.removeAttr("class")});0<a.length&&a.each(function(a){var b,e=!1,c=a.tagName;"A"===c?b="link":"IMG"===c?b="image":"IFRAME"===c&&(b="video");b&&(e=l.create(b+".component",this.app,a),this.app.broadcast(b+".inserted",e),this.app.broadcast("autoparse",b,e))}.bind(this))},format:function(a,
b){this._isKey(b)&&this._format()},parse:function(a){var b="figure pre code a iframe img i em span".split(" "),e=["img","i","em","span"],c=[],d=0;a=this.cleaner.encodePreCode(a);for(var f=0;f<b.length;f++){var g=-1!==e.indexOf(b[f])?"<"+b[f]+"[^>]*>":"<"+b[f]+"([\\w\\W]*?)</"+b[f]+">";g=a.match(new RegExp(g,"gi"));if(null!==g)for(var l=0;l<g.length;l++)a=a.replace(g[l],"#####replaceparse"+d+"#####"),c.push(g[l]),d++}if(this.opts.autoparseImages&&a.match(this.opts.regex.imageurl))for(b=a.match(this.opts.regex.imageurl),
f=0;f<b.length;f++)a=a.replace(b[f],'<img class="redactor-autoparser-object" src="'+b[f]+'">');if(this.opts.autoparseVideo&&(a.match(this.opts.regex.youtube)||a.match(this.opts.regex.vimeo))){var m,n;a.match(this.opts.regex.youtube)?(m="//www.youtube.com/embed/$1",n=this.opts.regex.youtube):a.match(this.opts.regex.vimeo)&&(m="//player.vimeo.com/video/$2",n=this.opts.regex.vimeo);a=a.replace(n,'<iframe width="500" height="281" class="redactor-autoparser-object" src="'+m+'" frameborder="0" allowfullscreen></iframe>')}this.opts.autoparseLinks&&
a.match(this.opts.regex.url)&&(a=this._formatLinks(a));for(f=0;f<c.length;f++)a=a.replace("#####replaceparse"+f+"#####",c[f]);return a},_isKey:function(a){return a===this.keycodes.ENTER||a===this.keycodes.SPACE},_format:function(){var a=this.selection.getParent(),b=l.dom(a);if((!a||0===b.closest("figure, pre, code, img, a, iframe").length)&&this.selection.isCollapsed()){b=this.utils.createInvisibleChar();this.selection.getRange().insertNode(b);var c=this.selection.getCurrent(),d=this.inspector.parse(c);
a=l.dom(c);if(b.parentNode.removeChild(b),c&&3===c.nodeType){b=c.textContent;if(this.opts.autoparseImages&&b.match(this._convertToRegExp(this.opts.regex.imageurl))){var f=d.isList();var g=b.match(this.opts.regex.imageurl);f=this.component.create("image",f?void 0:"<figure><img></figure>");f.setSrc(g[0]);f.addClass("redactor-autoparser-object");b=b.replace(g[0],f.get().outerHTML);g="image"}else if(this.opts.autoparseVideo&&(b.match(this._convertToRegExp(this.opts.regex.youtube))||b.match(this._convertToRegExp(this.opts.regex.vimeo)))){var m;
b.match(this.opts.regex.youtube)?(m="//www.youtube.com/embed/$1",f=this.opts.regex.youtube):b.match(this.opts.regex.vimeo)&&(m="//player.vimeo.com/video/$2",f=this.opts.regex.vimeo);g=this.component.create("video",'<iframe width="500" height="281" src="'+m+'" frameborder="0" allowfullscreen></iframe>');g.addClass("redactor-autoparser-object");b=b.replace(f,g.get().outerHTML);g="video"}else this.opts.autoparseLinks&&b.match(this._convertToRegExp(this.opts.regex.url))&&(b=this._formatLinks(b),g="link");
g&&(a.replaceWith(b),a=this.editor.getElement().find(".redactor-autoparser-object").removeClass("redactor-autoparser-object"),(a="link"===g?l.create("link.component",this.app,a):a,"link"===g)?(this.caret.setAfter(a),this.app.broadcast("link.inserted",a)):(this.caret.setAfter(a),f=a.clone(),a.remove(),a=this.insertion.insertHtml(f),a=this.component.build(a)),this.app.broadcast("autoparse",g,a))}}},_formatLinks:function(a){for(var b=a.match(this.opts.regex.url),e={},c=0;c<b.length;c++){var d=b[c],f=
d,g=null!==d.match(/(https?|ftp):\/\//i)?"":"http://",l=-1!==["/","&","="].indexOf(d.slice(-1))?"":"\\b",m=!1!==this.opts.pasteLinkTarget?' target="'+this.opts.pasteLinkTarget+'"':"";f=-1===(f=f.length>this.opts.linkSize?f.substring(0,this.opts.linkSize)+"...":f).search("%")?decodeURIComponent(f):f;e["("+d.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+l+")"]='<a href="'+g+d.trim()+'"'+m+' class="redactor-autoparser-object">'+f.trim()+"</a>"}for(var n in e)a=a.replace(new RegExp(n,"g"),e[n]);
return a},_convertToRegExp:function(a){return new RegExp(String(a).replace(/^\//,"").replace(/\/ig$/,"").replace(/\/gi$/,"")+"$","gi")}});l.add("service","storage",{init:function(a){this.app=a;this.data=[]},observeImages:function(){this.editor.getElement().find("[data-image]").each(this._addImage.bind(this))},observeFiles:function(){this.editor.getElement().find("[data-file]").each(this._addFile.bind(this))},setStatus:function(a,b){this.data[a].status=b},getChanges:function(){var a=this.editor.getElement(),
b;for(b in this.data){var c=this.data[b],d=a.find("[data-"+c.type+'="'+c.id+'"]');this.setStatus(c.id,0!==d.length)}return this.data},add:function(a,b){b=l.dom(b);var e=b.attr("data-"+a);this.data[e]={type:a,status:!0,node:b.get(),id:b.attr("data-"+a)}},_addImage:function(a){this.add("image",a)},_addFile:function(a){this.add("file",a)}});l.add("service","utils",{init:function(a){this.app=a},isEmpty:function(a){var b=!1;return(a=l.dom(a).get())&&(b=3===a.nodeType?""===a.textContent.trim().replace(/\n/,
""):""===a.innerHTML),b},isEmptyHtml:function(a,b,c){return a=(a=(a=(a=(a=(a=this.removeInvisibleChars(a)).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,b?"br":"")).replace(/\s/g,"")).replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,"")).replace(/^<div>[^\W\w\D\d]*?<\/div>$/i,""),c&&(a=(a=a.replace(/<ul(.*?[^>])>$/i,"ul")).replace(/<ol(.*?[^>])>$/i,"ol")),""===a.replace(/<hr(.*?[^>])>$/i,"hr").replace(/<iframe(.*?[^>])>$/i,"iframe").replace(/<source(.*?[^>])>$/i,"source").replace(/<[^\/>][^>]*><\/[^>]+>/gi,
"").replace(/<[^\/>][^>]*><\/[^>]+>/gi,"").trim()},trimSpaces:function(a){return this.removeInvisibleChars(a.trim())},createInvisibleChar:function(){return document.createTextNode(this.opts.markerChar)},searchInvisibleChars:function(a){return a.search(/^\uFEFF$/g)},removeInvisibleChars:function(a){return a.replace(/\uFEFF/g,"")},trimInvisibleChars:function(a){if(this.selection.isCollapsed()){var b=this.selection.getCurrent(),e="left"===a?this.selection.getTextBeforeCaret():this.selection.getTextAfterCaret();
b&&3===b.nodeType&&0===this.searchInvisibleChars(e)&&("left"===a?l.dom(b).replaceWith(b.textContent.trim()):(a=this.offset.get(),this.offset.set({start:a.start+1,end:a.end+1})))}},buildWrapper:function(a){return l.dom("<div>").html(a)},getWrapperHtml:function(a){var b=a.html();return a.remove(),b},createTmpContainer:function(a){var b=l.dom("<div>");return"string"==typeof a?b.html(a):b.append(l.dom(a).clone(!0)),b.get()},createFragment:function(a){var b,e;a=this.createTmpContainer(a);for(var c=document.createDocumentFragment(),
d=[],f=0;b=a.firstChild;){f++;var g=c.appendChild(b);1===f&&(e=g);d.push(g)}return{frag:c,first:e,last:g,nodes:d}},isFragment:function(a){return"object"==typeof a&&a.frag},parseHtml:function(a){a=this.createTmpContainer(a);return{html:a.innerHTML,nodes:a.childNodes}},splitNode:function(a,b,c,d){b=this.isFragment(b)?b.frag:b;var e=d?this.inspector.isInlineTag(a.tagName)?a:this.selection.getInline(a):this.inspector.isBlockTag(a.tagName)?a:this.selection.getBlock(a);a=l.dom(e);if(!d&&this.isEmptyHtml(e.innerHTML,
!0))return a.after(b),a.remove(),b;var f=a.get().tagName.toLowerCase(),g=this.caret.isEnd(e),m=this.caret.isStart(e);g||m||(d=this.extractHtmlFromCaret(d),f=l.dom("<"+f+" />"),f=this.cloneAttributes(e,f),a.after(f.append(d)));if(m)return a.before(b);if(c)return a.append(b);b=a.after(b);c=a.html();return""===this.removeInvisibleChars(c).replace(/&nbsp;/gi,"")&&a.remove(),b},extractHtmlFromCaret:function(a,b){var e=this.selection.getRange();if(e&&(b=b||(a?this.selection.getInline():this.selection.getBlock())))return a=
e.cloneRange(),a.selectNodeContents(b),a.setStart(e.endContainer,e.endOffset),a.extractContents()},createMarkup:function(a){var b=document.createElement(this.opts.markup);this.opts.breakline&&b.setAttribute("data-redactor-tag","br");l.dom(a).after(b);this.caret.setStart(b)},getNode:function(a){var b=l.dom(a).get(),e=this.editor.getElement().get();return void 0===a?e:b||!1},findSiblings:function(a,b){a=l.dom(a).get();for(b="next"===b?"nextSibling":"previousSibling";a=a[b];)if((3!==a.nodeType||""!==
a.textContent.trim())&&"BR"!==a.tagName)return a;return!1},getElementsFromHtml:function(a,b,c){var e=document.createElement("div");e.innerHTML=a;a=e.querySelectorAll(b);return function(a,b){if("number"==typeof this.length&&"function"==typeof a){var e=[];if("object"==typeof this)for(var c=0;c<this.length;c++){if(!(c in this))return;e[c]=a.call(b||this,this[c],c,this)}return e}}.call(a,function(a){var b=a.getAttribute("data-redactor-type");if(!c||!b||b!==c)return a.outerHTML})},getChildNodes:function(a,
b,c){a=(a&&a.nodeType&&11===a.nodeType?a:l.dom(a).get()).childNodes;var e=[];if(a)for(var d=0;d<a.length;d++)if(!(!0===c&&3===a[d].nodeType||3===a[d].nodeType&&this.isEmpty(a[d])||(e.push(a[d]),!1===b))){var f=this.getChildNodes(a[d],c);0<f.length&&(e=e.concat(f))}return e},getChildElements:function(a){return this.getChildNodes(a,!0,!0)},getFirstNode:function(a){return this._getFirst(this.getChildNodes(a,!1))},getLastNode:function(a){return this._getLast(this.getChildNodes(a,!1))},getFirstElement:function(a){return this._getFirst(this.getChildNodes(a,
!1,!0))},getLastElement:function(a){return this._getLast(this.getChildNodes(a,!1,!0))},replaceToTag:function(a,b){return l.dom(a).replaceWith(function(a){var e=l.dom("<"+b+">").append(l.dom(a).contents());if(a.attributes){a=a.attributes;for(var c=0;c<a.length;c++)e.attr(a[c].nodeName,a[c].value)}return e})},ucfirst:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},removeFromArrayByValue:function(a,b){for(var e,c=arguments,d=c.length;1<d&&a.length;)for(b=c[--d];-1!==(e=a.indexOf(b));)a.splice(e,
1);return a},removeEmptyAttr:function(a,b){a=l.dom(a);return void 0===a.attr(b)||null===a.attr(b)||""===a.attr(b)&&(a.removeAttr(b),!0)},cloneAttributes:function(a,b){a=l.dom(a).get();b=l.dom(b);a=a.attributes;for(var e=a.length;e--;){var c=a[e];b.attr(c.name,c.value)}return b},toParams:function(a){var b=Object.keys(a);if(!b.length)return"";for(var e="",c=0;c<b.length;c++){var d=b[c];e+=d+":"+a[d]+";"}return e},styleToObj:function(a){var b={};if(a){a=a.replace(/;$/,"").split(";");for(var e=0;e<a.length;e++){var c=
a[e].split(":");b[c[0].trim()]=c[1].trim()}}return b},checkProperty:function(a){for(var b=arguments[1]&&Array.isArray(arguments[1])?arguments[1]:[].slice.call(arguments,1),e=0;e<b.length;e++){if(!a||void 0===a[b[e]])return!1;a=a[b[e]]}return a},extendData:function(a,b){for(var e in b)"elements"===e?l.dom(b[e]).each(function(b){var e=l.dom(b);if("FORM"===b.tagName){e=e.serialize(!0);for(var c in e)a=this._setData(a,c,e[c])}else c=e.attr("name")?e.attr("name"):e.attr("id"),a=this._setData(a,c,e.val())}.bind(this)):
a=this._setData(a,e,b[e]);return a},_setData:function(a,b,c){return a instanceof FormData?a.append(b,c):a[b]=c,a},normalizeTextNodes:function(a){(a=l.dom(a).get())&&a.normalize()},isRgb:function(a){return 0===a.search(/^rgb/i)},rgb2hex:function(a){return(a=a.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===a.length?"#"+("0"+parseInt(a[1],10).toString(16)).slice(-2)+("0"+parseInt(a[2],10).toString(16)).slice(-2)+("0"+parseInt(a[3],10).toString(16)).slice(-2):""},
hex2long:function(a){return-1!==a.search(/^#/)&&4===a.length&&(a="#"+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]),a},escapeRegExp:function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},getRandomId:function(){for(var a="",b=0;12>b;b++)a+="abcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(36*Math.random()));return a},_getFirst:function(a){return 0!==a.length&&a[0]},_getLast:function(a){return 0!==a.length&&a[a.length-1]}});l.add("service","progress",{init:function(a){this.app=a;this.$bar=this.$box=
null},show:function(){this._is()||this._build();this.$box.show()},hide:function(){this._is()&&this.animate.start(this.$box,"fadeOut",this._destroy.bind(this))},update:function(a){this.show();this.$bar.css("width",a+"%")},_is:function(){return null!==this.$box},_build:function(){this.$bar=l.dom("<span />");this.$box=l.dom('<div id="redactor-progress" />');this.$box.append(this.$bar);this.$body.append(this.$box)},_destroy:function(){this._is()&&this.$box.remove();this.$bar=this.$box=null}});l.add("module",
"starter",{init:function(a){this.app=a;this.opts=a.opts;this.plugin=a.plugin;this.module=a.module},onstart:function(){this._startStop("start",this.app,"element container source editor statusbar toolbar".split(" "));this._startStop("start",this.module,"element container source editor statusbar contextbar input".split(" "))},onstop:function(){this._startStop("stop",this.module,"observer element container source editor contextbar".split(" "))},onenable:function(){var a=this.opts.plugins;this._startStop("start",
this.module,["observer","toolbar"]);this._startStop("start",this.plugin,a)},ondisable:function(){var a=this.opts.plugins;this._startStop("stop",this.module,["observer","toolbar"]);this._startStop("stop",this.plugin,a)},_startStop:function(a,b,c){for(var e=0;e<c.length;e++)void 0!==b[c[e]]&&this.app.callInstanceMethod(b[c[e]],a)}});l.add("module","element",{init:function(a){this.app=a;this.uuid=a.uuid;this.opts=a.opts;this.namespace=a.namespace;this.element=a.element;this.rootOpts=l.extend({},!0,l.options,
a.rootOpts)},start:function(){this._build();this._buildModes();this._buildMarkup()},stop:function(){this.element.getElement().removeData(this.namespace+"-uuid")},_build:function(){this.element.getElement().data(this.namespace+"-uuid",this.uuid)},_buildModes:function(){var a=this.element.getType();"inline"===a&&this._redefineOptions(this.opts.modes.inline);"div"===a&&this._redefineOptions(this.opts.modes.original);"inline"!==a&&(this._isRootOption("styles")&&this.rootOpts.styles&&(this.opts.styles=
!0),this._isRootOption("source")&&!this.rootOpts.source&&(this.opts.showSource=!1))},_buildMarkup:function(){"inline"===this.element.getType()?this.opts.emptyHtml="":this.opts.breakline?(this.opts.markup="div",this.opts.emptyHtml='<div data-redactor-tag="br">'+this.opts.markerChar+"</div>"):this.opts.emptyHtml="<"+this.opts.markup+"></"+this.opts.markup+">"},_redefineOptions:function(a){for(var b in a)this.opts[b]=a[b]},_isRootOption:function(){return void 0!==this.rootOpts.styles}});l.add("module",
"editor",{init:function(a){this.app=a;this.uuid=a.uuid;this.opts=a.opts;this.editor=a.editor;this.source=a.source;this.element=a.element;this.component=a.component;this.container=a.container;this.inspector=a.inspector;this.autoparser=a.autoparser;this.events=this.placeholder=!1},onenable:function(){this.enable()},ondisable:function(){this.disable()},onenablefocus:function(){this._enableFocus()},oncontextmenu:function(a){this.component.setOnEvent(a,!0)},onclick:function(a){this.component.setOnEvent(a)},
onkeyup:function(a){this.inspector.parse(a.target).isComponent()||this.component.clearActive()},onenablereadonly:function(){this._enableReadOnly()},ondisablereadonly:function(){this._disableReadOnly()},onautoparseobserve:function(){this.autoparser.observe()},onplaceholder:{build:function(){this._buildPlaceholder()},toggle:function(){this._togglePlacehodler()}},start:function(){this._build();this._buildEvents();this._buildOptions();this._buildAccesibility()},stop:function(){var a=this.editor.getElement(),
b=this.container.getElement(),c=["redactor-in","redactor-in-"+this.uuid,"redactor-structure","redactor-placeholder",this.opts.stylesClass];a.removeAttr("spellcheck");a.removeAttr("dir");a.removeAttr("contenteditable");a.removeAttr("placeholder");a.removeAttr("data-gramm_editor");a.removeClass(c.join(" "));b.removeClass("redactor-focus redactor-blur redactor-over redactor-styles-on redactor-styles-off redactor-toolbar-on redactor-text-labeled-on redactor-source-view");this._destroyEvents();0===a.get().classList.length&&
a.removeAttr("class")},enable:function(){var a=this.editor.getElement(),b=this.container.getElement();a.addClass("redactor-in redactor-in-"+this.uuid);a.attr({contenteditable:!0});this.opts.structure&&a.addClass("redactor-structure");!this.opts.toolbar||this.opts.air||this.opts.toolbarExternal||b.addClass("redactor-toolbar-on");this._disableBrowsersEditing()},disable:function(){var a=this.editor.getElement(),b=this.container.getElement();a.removeClass("redactor-in redactor-in-"+this.uuid);a.removeClass("redactor-structure");
a.removeAttr("contenteditable");b.addClass("redactor-toolbar-on")},_build:function(){var a=this.editor.getElement(),b=this.element.getElement(),c=this.container.getElement();c.addClass("redactor-blur");this.opts.grammarly||a.attr("data-gramm_editor",!1);this.opts.styles?(a.addClass(this.opts.stylesClass),c.addClass("redactor-styles-on")):c.addClass("redactor-styles-off");this.opts.buttonsTextLabeled&&c.addClass("redactor-text-labeled-on");this.element.isType("textarea")&&b.before(a)},_buildEvents:function(){this.events=
l.create("editor.events",this.app)},_buildOptions:function(){var a=this.editor.getElement();a.attr("dir",this.opts.direction);this.opts.tabindex&&a.attr("tabindex",this.opts.tabindex);this.opts.minHeight&&a.css("min-height",this.opts.minHeight);this.opts.maxHeight&&a.css("max-height",this.opts.maxHeight);this.opts.maxWidth&&a.css({"max-width":this.opts.maxWidth,margin:"auto"})},_buildAccesibility:function(){this.editor.getElement().attr({"aria-labelledby":"redactor-voice-"+this.uuid,role:"presentation"})},
_buildPlaceholder:function(){this.placeholder=l.create("editor.placeholder",this.app)},_enableFocus:function(){this.opts.showSource?this._enableFocusSource():this._enableFocusEditor()},_enableFocusSource:function(){var a=this.source.getElement();this.opts.focus?(a.focus(),a.get().setSelectionRange(0,0)):this.opts.focusEnd&&a.focus()},_enableFocusEditor:function(){this.opts.focus?setTimeout(this.editor.startFocus.bind(this.editor),100):this.opts.focusEnd&&setTimeout(this.editor.endFocus.bind(this.editor),
100)},_togglePlacehodler:function(){this.placeholder&&this.placeholder.toggle()},_disableBrowsersEditing:function(){try{document.execCommand("enableObjectResizing",!1,!1);document.execCommand("enableInlineTableEditing",!1,!1);document.execCommand("AutoUrlDetect",!1,!1);var a=this.editor.getElement().get();a.addEventListener?a.addEventListener("mscontrolselect",function(a){a.preventDefault()}):a.attachEvent("oncontrolselect",function(a){a.returnValue=!1})}catch(p){}},_destroyEvents:function(){this.events&&
this.events.destroy()},_enableReadOnly:function(){var a=this.editor.getElement();this._getEditables(a).removeAttr("contenteditable");a.removeAttr("contenteditable");a.addClass("redactor-read-only");this.events&&this.events.destroy()},_disableReadOnly:function(){var a=this.editor.getElement();this._getEditables(a).attr({contenteditable:!0});a.removeClass("redactor-read-only");a.attr({contenteditable:!0});this._buildEvents()},_getEditables:function(a){return a.find("figcaption, td, th")}});l.add("class",
"editor.placeholder",{init:function(a){this.app=a;this.opts=a.opts;this.editor=a.editor;this.element=a.element;this.build()},build:function(){var a=this.element.getElement(),b=this.editor.getElement();if(!1!==this.opts.placeholder||a.attr("placeholder"))a=!1!==this.opts.placeholder?this.opts.placeholder:a.attr("placeholder"),b.attr("placeholder",a),this.toggle()},toggle:function(){return this.editor.isEmpty(!0)?this.show():this.hide()},show:function(){this.editor.getElement().addClass("redactor-placeholder")},
hide:function(){this.editor.getElement().removeClass("redactor-placeholder")}});l.add("class","editor.events",{init:function(a){this.app=a;this.opts=a.opts;this.$doc=a.$doc;this.uuid=a.uuid;this.editor=a.editor;this.cleaner=a.cleaner;this.container=a.container;this.insertion=a.insertion;this.inspector=a.inspector;this.selection=a.selection;this.component=a.component;this.blurNamespace=".redactor-blur."+this.uuid;this.eventsList="paste click contextmenu keydown keyup mouseup touchstart cut copy dragenter dragstart drop dragover dragleave".split(" ");
this._init()},destroy:function(){this.editor.getElement().off(".redactor-focus");this.$doc.off("keyup"+this.blurNamespace+" mousedown"+this.blurNamespace);this._loop("off")},focus:function(a){var b=this.container.getElement();this.editor.isPasting()||b.hasClass("redactor-focus")||(b.addClass("redactor-focus"),b.removeClass("redactor-blur"),this.app.broadcast("observe",a),this.app.broadcast("focus",a),this.isFocused=!0,this.isBlured=!1)},blur:function(a){var b=this.container.getElement(),e=l.dom(a.target),
c=[".redactor-in-"+this.uuid,".redactor-toolbar",".redactor-dropdown",".redactor-context-toolbar","#redactor-modal-box","#redactor-image-resizer"];this.app.broadcast("originalblur",a);this.app.stopBlur||this.app.isStarted()&&!this.editor.isPasting()&&0===e.closest(c.join(",")).length&&(this.isBlured||b.hasClass("redactor-blur")||(b.removeClass("redactor-focus"),b.addClass("redactor-blur"),this.app.broadcast("blur",a),this.isFocused=!1,this.isBlured=!0))},cut:function(a){var b=this.selection.getCurrent(),
e=this.inspector.parse(b);this.app.broadcast("state",a);this.component.isNonEditable(b)&&(this._passSelectionToClipboard(a,e,!0),a.preventDefault())},copy:function(a){var b=this.selection.getCurrent(),e=this.inspector.parse(b);this.app.broadcast("state",a);this.component.isNonEditable(b)&&(this._passSelectionToClipboard(a,e,!1),a.preventDefault())},drop:function(a){if((a=a.originalEvent||a).stopPropagation(),this._removeOverClass(),this.app.isDragComponentInside()){var b=l.dom(this.app.getDragComponentInside()),
e=b.clone(!0);return this.insertion.insertToPoint(a,e),b.remove(),this.app.setDragComponentInside(!1),this.app.broadcast("state",a),this.app.broadcast("drop",a),this.app.broadcast("image.observe",a),void a.preventDefault()}if(this.app.isDragInside()&&this.opts.input){this.insertion.insertPoint(a);b=a.dataTransfer.getData("text/html");var c=this.selection.getRange();if(c)for(e=this.selection.getBlocks(),c.deleteContents(),c=0;c<e.length;c++)""===e[c].innerHTML&&l.dom(e[c]).remove();return l.create("input.paste",
this.app,a,!0,b,!0),this.app.broadcast("state",a),this.app.broadcast("drop",a),this.app.setDragInside(!1),void a.preventDefault()}this.app.broadcast("state",a);this.app.broadcast("paste",a,a.dataTransfer);this.app.broadcast("drop",a)},dragenter:function(a){a.preventDefault()},dragstart:function(a){this.app.setDragComponentInside(!1);this.app.setDragInside(!1);var b=this.inspector.parse(a.target);!b.isComponent()||b.isComponentEditable()||b.isFigcaption()?this.selection.is()&&!this.selection.isCollapsed()&&
(this.app.setDragInside(!0),this._setDragData(a)):this.app.setDragComponentInside(b.getComponent());this.app.broadcast("dragstart",a)},dragover:function(a){this.app.broadcast("dragover",a)},dragleave:function(a){this.app.broadcast("dragleave",a)},paste:function(a){this.app.broadcast("paste",a)},contextmenu:function(a){this.editor.disableNonEditables();setTimeout(function(){this.editor.enableNonEditables();this.app.broadcast("contextmenu",a)}.bind(this),0)},click:function(a){if(3===a.detail){a.preventDefault();
var b=this.selection.getBlock(),e=document.createRange();e.selectNodeContents(b);this.selection.setRange(e)}this.app.broadcast("state",a);this.app.broadcast("click",a)},keydown:function(a){if(this.app.broadcast("state",a),!1===this.app.broadcast("keydown",a))return a.preventDefault()},keyup:function(a){this.app.broadcast("observe",a);this.app.broadcast("keyup",a)},mouseup:function(a){this.app.broadcast("observe",a);this.app.broadcast("state",a)},touchstart:function(a){this.app.broadcast("observe",
a);this.app.broadcast("state",a)},_init:function(){this.editor.getElement().on("focus.redactor-focus click.redactor-focus",this.focus.bind(this));this.$doc.on("keyup"+this.blurNamespace+" mousedown"+this.blurNamespace,this.blur.bind(this));this._loop("on")},_removeOverClass:function(){this.editor.getElement().removeClass("over")},_loop:function(a){for(var b=this.editor.getElement(),e=0;e<this.eventsList.length;e++)b[a](this.eventsList[e]+".redactor-events",this[this.eventsList[e]].bind(this))},_passSelectionToClipboard:function(a,
b,c){a=a.clipboardData;b=b.getComponent();var e=l.dom(b).clone();e.find(".redactor-component-caret").remove();e.removeClass("redactor-component-active");e.removeAttr("contenteditable");e.removeAttr("tabindex");e=e.get().outerHTML;c&&this.component.remove(b);a.setData("text/html",e);a.setData("text/plain",e.toString().replace(/\n$/,""))},_setDragData:function(a){a=(a.originalEvent||a).dataTransfer;a.effectAllowed="move";a.setData("text/Html",this.selection.getHtml())}});l.add("module","container",
{init:function(a){this.app=a;this.uuid=a.uuid;this.opts=a.opts;this.lang=a.lang;this.element=a.element;this.container=a.container},start:function(){this._build();this._buildAccesibility()},stop:function(){var a=this.element.getElement(),b=this.container.getElement();b.after(a);b.remove();a.show()},_build:function(){var a=this.element.getElement(),b=this.container.getElement();b.addClass("redactor-box");b.attr("dir",this.opts.direction);this.element.isType("inline")&&b.addClass("redactor-inline");
a.after(b);b.append(a)},_buildAccesibility:function(){var a=this.container.getElement(),b=l.dom("<span />");b.addClass("redactor-voice-label");b.attr({id:"redactor-voice-"+this.uuid,"aria-hidden":!1});b.html(this.lang.get("accessibility-help-label"));a.prepend(b)}});l.add("module","source",{init:function(a){this.app=a;this.uuid=a.uuid;this.opts=a.opts;this.utils=a.utils;this.element=a.element;this.source=a.source;this.editor=a.editor;this.toolbar=a.toolbar;this.cleaner=a.cleaner;this.component=a.component;
this.container=a.container;this.autoparser=a.autoparser;this.selection=a.selection;this.syncedHtml=""},onstartcode:function(){var a=this.source.getStartedContent(),b=this.editor.getElement(),c=this.source.getElement();this.opts.autoparse&&this.opts.autoparseStart&&(a=this.autoparser.parse(a));a=this.cleaner.input(a,!0,!0);var d=this.cleaner.output(a);b.html(a);c.val(d);this.syncedHtml=d;this.app.broadcast("placeholder.build");this.app.broadcast("autoparseobserve");this.component.executeScripts()},
onstartcodeshow:function(){this.show()},ontrytosync:function(){this.sync()},start:function(){this._build();this._buildClasses()},stop:function(){var a=this.element.getElement(),b=this.source.getElement();a.removeClass("redactor-source redactor-source-open");b.off("input.redactor-source");b.removeAttr("data-gramm_editor");0===b.get().classList.length&&b.removeAttr("class");this.source.isNameGenerated()||a.removeAttr("name");this.element.isType("textarea")||b.remove()},getCode:function(){return this.source.getCode()},
toggle:function(){if(this.opts.source)return this.source.getElement().hasClass("redactor-source-open")?this.hide():this.show()},show:function(){if(this.opts.source){var a=this.editor.getElement(),b=this.source.getElement(),c=this.container.getElement(),d=b.val();this.app.isStarted()&&(d=this.app.broadcast("source.open",d));var f=l.create("source.selection",this.app),g=f.insertMarkersToEditor();g=(g=this.cleaner.output(g,!1)).trim();var m=a.height();a.hide();b.height(m);b.val(d.trim());b.show();b.addClass("redactor-source-open");
b.on("input.redactor-source-events",this._onChangedSource.bind(this));b.on("keydown.redactor-source-events",this._onTabKey.bind(this));b.on("focus.redactor-source-events",this._onFocus.bind(this));c.addClass("redactor-source-view");f.setSelectionOffsetSource(g);setTimeout(function(){this._disableButtons();this._setActiveSourceButton()}.bind(this),100);this.app.isStarted()&&this.app.broadcast("source.opened")}},hide:function(){if(this.opts.source){var a=this.editor.getElement(),b=this.source.getElement(),
c=this.container.getElement(),d=b.val(),f=l.create("source.selection",this.app);d=f.insertMarkersToSource(d);d=this.cleaner.input(d,!0);d=this.utils.isEmptyHtml(d)?this.opts.emptyHtml:d;d=this.app.broadcast("source.close",d);this._enableButtons();this._setInactiveSourceButton();b.hide();b.removeClass("redactor-source-open");b.off(".redactor-source-events");a.show();a.html(d);c.removeClass("redactor-source-view");setTimeout(function(){f.isOffset()?this.selection.restoreMarkers():f.isOffsetEnd()?this.editor.endFocus():
this.editor.startFocus();this.component.executeScripts()}.bind(this),0);this.app.broadcast("source.closed")}},sync:function(){var a=this,b=this.editor.getElement().html();b=this.app.broadcast("syncBefore",b);b=this.cleaner.output(b);this._isSync(b)&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){a._syncing(b)},200))},_build:function(){var a=this.source.getElement(),b=this.element.getElement();a.hide();this.opts.grammarly||a.attr("data-gramm_editor",!1);this.element.isType("textarea")||
b.after(a)},_buildClasses:function(){this.source.getElement().addClass("redactor-source")},_syncing:function(a){a=this.app.broadcast("syncing",a);this.source.getElement().val(a);this.app.broadcast("synced",a);this.app.broadcast("changed",a)},_isSync:function(a){return this.syncedHtml!==a&&(this.syncedHtml=a,!0)},_onChangedSource:function(){var a=this.source.getElement().val();this.app.broadcast("changed",a);this.app.broadcast("source.changed",a)},_onTabKey:function(a){if(9!==a.keyCode)return!0;a.preventDefault();
a=this.source.getElement();var b=a.get(),e=b.selectionStart;a.val(a.val().substring(0,e)+"    "+a.val().substring(b.selectionEnd));b.selectionStart=b.selectionEnd=e+4},_onFocus:function(){this.app.broadcast("sourcefocus")},_disableButtons:function(){this.toolbar.disableButtons()},_enableButtons:function(){this.toolbar.enableButtons()},_setActiveSourceButton:function(){var a=this.toolbar.getButton("html");a.enable();a.setActive()},_setInactiveSourceButton:function(){this.toolbar.getButton("html").setInactive()}});
l.add("class","source.selection",{init:function(a){this.app=a;this.utils=a.utils;this.source=a.source;this.editor=a.editor;this.marker=a.marker;this.component=a.component;this.selection=a.selection;this.markersOffsetEnd=this.markersOffset=!1},insertMarkersToEditor:function(){var a=this.editor.getElement(),b=this.marker.build("start"),c=this.marker.build("end"),d=this.component.getActive();d?(this.marker.remove(),d=l.dom(d),d.after(c),d.after(b)):window.getSelection&&this.selection.is()&&this.marker.insert("both");
return this._getHtmlAndRemoveMarkers(a)},setSelectionOffsetSource:function(a){var b=0,e=0,c=this.source.getElement();""!==a&&(b=this.utils.removeInvisibleChars(this.marker.buildHtml("start")),e=this.utils.removeInvisibleChars(this.marker.buildHtml("end")),b=this._strpos(a,b),e=this._strpos(a,e)-e.toString().length-2,!1===b&&(b=0,e=0));c.get().setSelectionRange(b,e);c.get().scrollTop=0;setTimeout(function(){c.focus()}.bind(this),0)},isOffset:function(){return this.markersOffset},isOffsetEnd:function(){return this.markersOffsetEnd},
insertMarkersToSource:function(a){var b=this.source.getElement(),e=this.marker.buildHtml("start"),c=this.marker.buildHtml("end"),d=e.toString().length,f=this._enlargeOffset(a,b.get().selectionStart);b=this._enlargeOffset(a,b.get().selectionEnd);return f===a.length?this.markersOffsetEnd=!0:0!==f&&0!==b?(this.markersOffset=!0,a=(a=a.substr(0,f)+e+a.substr(f)).substr(0,b+d)+c+a.substr(b+d)):this.markersOffset=!1,a},_getHtmlAndRemoveMarkers:function(a){var b=a.html();return a.find(".redactor-selection-marker").remove(),
b},_strpos:function(a,b,c){a=a.indexOf(b,c);return 0<=a&&a},_enlargeOffset:function(a,b){var e=a.length,c=0;if(">"===a[b])c++;else for(var d=b;d<=e&&(c++,">"!==a[d]);d++)if("<"===a[d]||d===e){c=0;break}return b+c}});l.add("module","observer",{init:function(a){this.app=a;this.editor=a.editor;this.observerUnit=!1},start:function(){if(window.MutationObserver){var a=this.editor.getElement().get();this.observerUnit=this._build(a);this.observerUnit.observe(a,{attributes:!0,subtree:!0,childList:!0,characterData:!0,
characterDataOldValue:!0})}},stop:function(){this.observerUnit&&this.observerUnit.disconnect()},_build:function(a){var b=this;return new MutationObserver(function(e){e.forEach(function(e){b._iterate(e,a)})})},_iterate:function(a,b){this.app.isReadOnly()||"attributes"===a.type&&a.target===b||(this.app.broadcast("observe"),this.app.broadcast("trytosync"),this.app.broadcast("placeholder.toggle"))}});l.add("module","clicktoedit",{init:function(a){this.app=a;this.opts=a.opts;this.source=a.source;this.editor=
a.editor;this.container=a.container;this.selection=a.selection},onstartclicktoedit:function(){this.start()},onenablereadonly:function(){this._isEnabled()||this.stop()},ondisablereadonly:function(){this._isEnabled()||this.start()},onstop:function(){this.stop()},start:function(){this._build()},stop:function(){this.buttonSave&&this.buttonSave.stop();this.buttonCancel&&this.buttonCancel.stop();this._destroy();this.app.broadcast("disable")},enable:function(){this.app.broadcast("clickStart");var a=this.editor.isEmpty();
a||this.selection.saveMarkers();this._setFocus();this._destroy();this.app.broadcast("enable");this.buttonSave.enable();this.buttonCancel.enable();a||this.selection.restoreMarkers();a&&this.editor.focus();this.container.getElement().addClass("redactor-clicktoedit-enabled")},save:function(a){a&&a.preventDefault();a=this.source.getCode();this.app.broadcast("disable");this.app.broadcast("clickSave",a);this.app.broadcast("clickStop");this._build()},cancel:function(a){a&&a.preventDefault();a=this.saved;
this.editor.getElement().html(a);this.saved="";this.app.broadcast("disable");this.app.broadcast("clickCancel",a);this.app.broadcast("clickStop");this._build()},_build:function(){this.buttonSave=l.create("clicktoedit.button","save",this.app,this);this.buttonCancel=l.create("clicktoedit.button","cancel",this.app,this);this.buttonSave.stop();this.buttonCancel.stop();var a=this.editor.getElement(),b=this.container.getElement();a.on("click.redactor-click-to-edit mouseup.redactor-click-to-edit",this.enable.bind(this));
b.addClass("redactor-over");b.removeClass("redactor-clicktoedit-enabled")},_isEnabled:function(){return this.container.getElement().hasClass("redactor-clicktoedit-enabled")},_destroy:function(){var a=this.editor.getElement(),b=this.container.getElement();a.off(".redactor-click-to-edit");b.removeClass("redactor-over redactor-clicktoedit-enabled")},_setFocus:function(){this.saved=this.source.getCode();this.buttonSave.start();this.buttonCancel.start()}});l.add("class","clicktoedit.button",{init:function(a,
b,c){this.app=b;this.opts=b.opts;this.toolbar=b.toolbar;this.context=c;this.type=a;this.name="save"===a?"clickToSave":"clickToCancel";this.enabled=this.objected=!1;this.namespace=".redactor-click-to-edit";this._build()},enable:function(){if(this.objected){var a=this.opts[this.name];a.api="module.clicktoedit."+this.type;this.toolbar.addButton(this.type,a);this.enabled=!0}},start:function(){this.objected||(this.$button.off(this.namespace),this.$button.show(),this.$button.on("click"+this.namespace,this.context[this.type].bind(this.context)))},
stop:function(){!this.objected&&this.enabled&&this.$button.hide()},_build:function(){(this.objected="object"==typeof this.opts[this.name])||(this.$button=l.dom(this.opts[this.name]),this.enabled=!0)}});l.add("module","statusbar",{init:function(a){this.app=a;this.opts=a.opts;this.element=a.element;this.statusbar=a.statusbar;this.container=a.container},start:function(){if(!this.element.isType("inline")){var a=this.statusbar.getElement(),b=this.container.getElement();a.addClass("redactor-statusbar");
b.append(a)}}});l.add("module","contextbar",{init:function(a){this.app=a;this.opts=a.opts;this.uuid=a.uuid;this.$win=a.$win;this.$doc=a.$doc;this.$body=a.$body;this.editor=a.editor;this.toolbar=a.toolbar;this.detector=a.detector;this.$target=this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$body},onenablereadonly:function(){this.stop()},ondisablereadonly:function(){this.start()},oncontextbar:{close:function(){this.close()}},start:function(){if(this.opts.toolbarContext){var a=this.editor.getElement();
this._build();a.on("click.redactor-context mouseup.redactor-context",this.open.bind(this))}},stop:function(){this.editor.getElement().off(".redactor-context");this.$doc.off(".redactor-context");this.$win.off(".redactor-context");this.$contextbar&&this.$contextbar.remove()},is:function(){return this.$contextbar&&this.$contextbar.hasClass("open")},set:function(a,b,c,d){for(var e in this.$contextbar.html(""),this.$el=l.dom(b),c)b=l.create("contextbar.button",this.app,c[e]),""!==b.html()&&this.$contextbar.append(b);
a=this._buildPosition(a,this.$el,d);this.$contextbar.css(a);this.$contextbar.show();this.$contextbar.addClass("open");this.$doc.on("click.redactor-context mouseup.redactor-context",this.close.bind(this));this.$win.on("resize.redactor-context",this.close.bind(this))},open:function(a){setTimeout(function(){this.app.broadcast("contextbar",a,this)}.bind(this),0)},close:function(a){if(this.$contextbar){if(a&&(a=l.dom(a.target),this.$el&&0!==a.closest(this.$el).length))return;this.$contextbar.hide();this.$contextbar.removeClass("open");
this.$doc.off(".redactor.context")}},_build:function(){this.$contextbar=l.dom("<div>");this.$contextbar.attr("id","redactor-context-toolbar-"+this.uuid);this.$contextbar.attr("dir",this.opts.direction);this.$contextbar.addClass("redactor-context-toolbar");this.$contextbar.hide();this.$target.append(this.$contextbar)},_buildPosition:function(a,b,c){var e,d,f=this.toolbar.isTarget(),g=f?b.position():b.offset(),l=b.width();b=b.height();var m=this.$contextbar.width(),p=this.$contextbar.height(),n=f?this.$target.scrollTop()+
this.$doc.scrollTop():this.$doc.scrollTop(),q=this.$target.offset(),t=f?q.left:0;f=f?q.top:0;return c?"top"===c?(e=g.top-p,d=g.left+l/2-m/2):"bottom"===c&&(e=g.top+b,d=g.left+l/2-m/2):(e=a.clientY+n-p,d=a.clientX-m/2),0>d&&(d=0),{top:e-f+"px",left:d-t+"px"}}});l.add("class","contextbar.button",{mixins:["dom"],init:function(a,b){this.app=a;this.obj=b;this._init()},_init:function(){this.parse("<a>");this.attr("href","#");this._buildTitle();this._buildMessage()},_buildTitle:function(){this.html(this.obj.title)},
_buildMessage:function(){void 0===this.obj.message&&void 0===this.obj.api||this.on("click",this._toggle.bind(this))},_toggle:function(a){a.preventDefault();this.obj.message?this.app.broadcast(this.obj.message,this.obj.args):this.obj.api&&this.app.api(this.obj.api,this.obj.args)}});l.add("module","toolbar",{init:function(a){this.app=a;this.opts=a.opts;this.utils=a.utils;this.toolbar=a.toolbar;this.buttons=[];this.toolbarModule=!1},onsource:{open:function(){!this.toolbar.isAir()&&this.toolbar.isFixed()&&
this.toolbarModule.resetPosition()},opened:function(){this.toolbar.isAir()&&this.toolbarModule&&this.toolbarModule.createSourceHelper()},close:function(){this.toolbar.isAir()&&this.toolbarModule&&this.toolbarModule.destroySourceHelper()},closed:function(){this.toolbar.is()&&this.opts.air&&this.toolbarModule.openSelected()}},onobserve:function(){this.toolbar.is()&&this.toolbar.observe()},onfocus:function(){this._setExternalOnFocus()},onsourcefocus:function(){this._setExternalOnFocus()},onempty:function(){this.toolbar.isFixed()&&
this.toolbarModule.resetPosition()},onenablereadonly:function(){this.toolbar.isAir()&&this.toolbarModule.close()},start:function(){this.toolbar.is()&&(this._buildButtons(),this._initToolbar(),this._initButtons())},stop:function(){this.toolbarModule&&this.toolbarModule.stop()},_buildButtons:function(){this.buttons=this.opts.buttons.concat();this._buildImageButton();this._buildFileButton();this._buildSourceButton();this._buildAdditionalButtons();this._buildHiddenButtons()},_buildImageButton:function(){this.opts.imageUpload||
this.utils.removeFromArrayByValue(this.buttons,"image")},_buildFileButton:function(){this.opts.fileUpload||this.utils.removeFromArrayByValue(this.buttons,"file")},_buildSourceButton:function(){this.opts.source||this.utils.removeFromArrayByValue(this.buttons,"html")},_buildAdditionalButtons:function(){if(0!==this.opts.buttonsAdd.length&&(this.opts.buttonsAdd=this._removeExistButtons(this.opts.buttonsAdd),this.buttons=this.buttons.concat(this.opts.buttonsAdd)),0!==this.opts.buttonsAddFirst.length&&
(this.opts.buttonsAddFirst=this._removeExistButtons(this.opts.buttonsAddFirst),this.buttons.unshift(this.opts.buttonsAddFirst)),!1!==this.opts.buttonsAddAfter){var a=this.buttons.indexOf(this.opts.buttonsAddAfter.after)+1;var b=this.opts.buttonsAddAfter.buttons;for(var c=0;c<b.length;c++)this.buttons.splice(a+c,0,b[c])}if(!1!==this.opts.buttonsAddBefore)for(a=this.buttons.indexOf(this.opts.buttonsAddBefore.before)+1,b=this.opts.buttonsAddBefore.buttons,c=0;c<b.length;c++)this.buttons.splice(a-(1-
c),0,b[c])},_buildHiddenButtons:function(){if(0!==this.opts.buttonsHide.length)for(var a=this.opts.buttonsHide,b=0;b<a.length;b++)this.utils.removeFromArrayByValue(this.buttons,a[b])},_removeExistButtons:function(a){for(var b=0;b<a.length;b++)-1!==this.opts.buttons.indexOf(a[b])&&this.utils.removeFromArrayByValue(a,a[b]);return a},_setExternalOnFocus:function(){!this.opts.air&&this.opts.toolbarExternal&&this.toolbarModule.setExternal()},_initToolbar:function(){this.toolbarModule=this.opts.air?l.create("toolbar.air",
this.app):l.create("toolbar.standard",this.app)},_initButtons:function(){for(var a=0;a<this.buttons.length;a++){var b=this.buttons[a];l.buttons[b]&&this.toolbar.addButton(b,l.buttons[b],!1,!1,!0)}}});l.add("class","toolbar.air",{init:function(a){this.app=a;this.$doc=a.$doc;this.$win=a.$win;this.utils=a.utils;this.editor=a.editor;this.animate=a.animate;this.toolbar=a.toolbar;this.container=a.container;this.inspector=a.inspector;this.selection=a.selection;this.clicks=0;this._init()},stop:function(){this.toolbar.getWrapper().remove();
this.editor.getElement().off(".redactor-air-trigger");this.$doc.off(".redactor-air");this.$doc.off(".redactor-air-trigger");this.toolbar.stopObservers()},createSourceHelper:function(){this.$airHelper=l.dom("<span>");this.$airHelper.addClass("redactor-air-helper");this.$airHelper.html('<i class="re-icon-html"></i>');this.$airHelper.on("click",function(a){a.preventDefault();this.app.api("module.source.hide")}.bind(this));this.container.getElement().append(this.$airHelper)},destroySourceHelper:function(){this.$airHelper&&
this.$airHelper.remove()},openSelected:function(){setTimeout(function(){this._isSelection()&&this._open(!1)}.bind(this),0)},close:function(){this.$doc.off(".redactor-air");var a=this.toolbar.getElement();a.removeClass("open");a.hide()},_init:function(){this.toolbar.create();var a=this.toolbar.getWrapper(),b=this.toolbar.getElement(),c=this.editor.getElement(),d=this.container.getElement();a.addClass("redactor-toolbar-wrapper-air");b.addClass("redactor-air");b.hide();a.append(b);d.prepend(a);this.openSelected();
this.$doc.on("mouseup.redactor-air-trigger",this._open.bind(this));c.on("keyup.redactor-air-trigger",this._openCmd.bind(this))},_isSelection:function(){return this.selection.is()&&!this.selection.isCollapsed()},_isOpened:function(){return this.toolbar.getElement().hasClass("open")},_open:function(a){var b=!!a&&a.target,e=!!a&&l.dom(a.target),c=this.inspector.parse(b);b=c.isComponent()&&!c.isComponentType("table");c=c.isFigcaption();var d=e&&0!==e.closest(".redactor-modal").length,f=a&&0!==e.closest(".re-button").length;
if(!(a&&0!==e.closest(".redactor-dropdown").length||f||d||c||b||this.toolbar.isContextBar())&&this._isSelection()){var g=this.selection.getPosition();setTimeout(function(){this.app.isReadOnly()||this._isSelection()&&this._doOpen(g)}.bind(this),1)}},_openCmd:function(){if(this.selection.isAll()){var a=this.toolbar.getElement(),b=this.selection.getPosition();b.top=20>b.top?0:b.top-a.height();b.height=0;this._doOpen(b)}},_doOpen:function(a){var b=this.toolbar.getWrapper(),e=this.toolbar.getElement(),
c=this.container.getElement().offset();b.css({left:a.left-c.left-0+"px",top:a.top-c.top+a.height+this.$doc.scrollTop()+"px"});this.app.broadcast("airOpen");e.addClass("open");e.show();this.$doc.on("click.redactor-air",this._close.bind(this));this.$doc.on("keydown.redactor-air",this._close.bind(this));this.app.broadcast("airOpened")},_close:function(a){var b=!!a&&l.dom(a.target),e=a&&0!==b.closest("[data-dropdown], .redactor-dropdown-not-close").length;(!e&&a&&0!==b.closest(".re-button").length||!e&&
this._isOpened())&&(this.app.broadcast("airClose"),this.close(),this.app.broadcast("airClosed"))}});l.add("class","toolbar.fixed",{init:function(a){this.app=a;this.opts=a.opts;this.$doc=a.$doc;this.$win=a.$win;this.editor=a.editor;this.toolbar=a.toolbar;this.detector=a.detector;this.container=a.container;this._init()},stop:function(){this.$fixedTarget.off(".redactor-toolbar");this.$win.off(".redactor-toolbar")},reset:function(){var a=this.toolbar.getElement();this.toolbar.getWrapper().css("height",
"");a.removeClass("redactor-toolbar-fixed");a.css({position:"",top:"",left:"",width:""});(a=this.toolbar.getDropdown())&&a.updatePosition()},_init:function(){this.$fixedTarget=this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$win;this._doFixed();this.toolbar.isTarget()&&(this.$win.on("scroll.redactor-toolbar",this._doFixed.bind(this)),this.$win.on("resize.redactor-toolbar",this._doFixed.bind(this)));this.$fixedTarget.on("scroll.redactor-toolbar",this._doFixed.bind(this));this.$fixedTarget.on("resize.redactor-toolbar",
this._doFixed.bind(this))},_doFixed:function(){var a=this.editor.getElement(),b=this.container.getElement(),c=this.toolbar.getElement(),d=this.toolbar.getWrapper();if(0===b.parents().filter(function(a){return"none"===getComputedStyle(a,null).display&&a}).length){a=100>a.height();var f=this.editor.isEmpty();if(!(a||f||this.editor.isSourceMode())){a=c.height();f=b.offset().top;var g=f+b.height()-(60+this.opts.toolbarFixedTopOffset),l=this.$fixedTarget.scrollTop(),m=this.toolbar.isTarget()?this.$fixedTarget.offset().top-
this.$win.scrollTop():0;l>f&&l<g?(g=this.detector.isDesktop()?"fixed":"absolute",m=this.detector.isDesktop()?m:l-f+this.opts.toolbarFixedTopOffset,this.detector.isMobile()&&(this.fixedScrollTimeout&&clearTimeout(this.fixedScrollTimeout),c.hide(),this.fixedScrollTimeout=setTimeout(function(){c.show()},250)),d.height(a),c.addClass("redactor-toolbar-fixed"),c.css({position:g,top:m+this.opts.toolbarFixedTopOffset+"px",width:b.width()+"px"}),(b=this.toolbar.getDropdown())&&b.updatePosition(),this.app.broadcast("toolbar.fixed")):
(this.reset(),this.app.broadcast("toolbar.unfixed"))}}}});l.add("class","toolbar.standard",{init:function(a){this.app=a;this.opts=a.opts;this.uuid=a.uuid;this.toolbar=a.toolbar;this.container=a.container;this.toolbarFixed=this.isExternalMultiple=!1;this._init()},stop:function(){this.toolbar.getWrapper().remove();this.toolbarFixed&&this.toolbarFixed.stop();this.opts.toolbarExternal&&this._findToolbars();this.toolbar.stopObservers()},setExternal:function(){(this._findToolbars(),this.isExternalMultiple)&&
(this.$toolbars.hide(),this.$external.find(".redactor-toolbar-external-"+this.uuid).show())},resetPosition:function(){this.toolbarFixed&&this.toolbarFixed.reset()},_init:function(){(this._build(),this.opts.toolbarExternal)?this._buildExternal():(this._buildFixed(),this.toolbar.getElement().show())},_build:function(){this.toolbar.create();var a=this.toolbar.getWrapper(),b=this.toolbar.getElement();(a.addClass("redactor-toolbar-wrapper"),b.addClass("redactor-toolbar"),b.hide(),a.append(b),this.opts.toolbarExternal)||
this.container.getElement().prepend(a)},_buildExternal:function(){(this._initExternal(),this._findToolbars(),this.isExternalMultiple)?this._hideToolbarsExceptFirst():this.toolbar.getElement().show()},_buildFixed:function(){this.opts.toolbarFixed&&(this.toolbarFixed=l.create("toolbar.fixed",this.app))},_initExternal:function(){var a=this.toolbar.getElement(),b=this.toolbar.getElement();a.addClass("redactor-toolbar-external redactor-toolbar-external-"+this.uuid);this.$external=l.dom(this.opts.toolbarExternal);
this.$external.append(b)},_findToolbars:function(){this.$toolbars=this.$external.find(".redactor-toolbar-external");this.isExternalMultiple=1<this.$toolbars.length},_hideToolbarsExceptFirst:function(){this.$toolbars.hide();this.$toolbars.first().show()}});l.add("module","line",{init:function(a){this.app=a;this.lang=a.lang;this.component=a.component;this.inspector=a.inspector;this.insertion=a.insertion},oncontextbar:function(a,b){var e=this.inspector.parse(a.target);if(e.isComponentType("line")){e=
e.getComponent();var c={remove:{title:this.lang.get("delete"),api:"module.line.remove",args:e}};b.set(a,e,c,"bottom")}},insert:function(){var a=this.component.create("line");this.insertion.insertRaw(a)},remove:function(a){this.component.remove(a)}});l.add("class","line.component",{mixins:["dom","component"],init:function(a,b){return this.app=a,b&&void 0!==b.cmnt?b:this._init(b)},_init:function(a){var b,e;if(void 0!==a){a=l.dom(a);var c=a.get();"HR"===c.tagName?e=c:"FIGURE"===c.tagName&&(b=c,e=a.find("hr").get())}this._buildWrapper(b);
this._buildElement(e);this._initWrapper()},_buildElement:function(a){a?this.$element=l.dom(a):(this.$element=l.dom("<hr>"),this.append(this.$element))},_buildWrapper:function(a){this.parse(a||"<figure>")},_initWrapper:function(){this.addClass("redactor-component");this.attr({"data-redactor-type":"line",tabindex:"-1",contenteditable:!1})}});l.add("module","link",{modals:{link:'<form action="">                 <div class="form-item">                     <label for="modal-link-url">URL <span class="req">*</span></label>                     <input type="text" id="modal-link-url" name="url">                 </div>                 <div class="form-item">                     <label for="modal-link-text">## text ##</label>                     <input type="text" id="modal-link-text" name="text">                 </div>                 <div class="form-item form-item-title">                     <label for="modal-link-title">## title ##</label>                     <input type="text" id="modal-link-title" name="title">                 </div>                 <div class="form-item form-item-target">                     <label class="checkbox">                         <input type="checkbox" name="target"> ## link-in-new-tab ##                     </label>                 </div>             </form>'},
init:function(a){this.app=a;this.opts=a.opts;this.lang=a.lang;this.utils=a.utils;this.inline=a.inline;this.editor=a.editor;this.inspector=a.inspector;this.insertion=a.insertion;this.selection=a.selection;this.currentText=this.isCurrentLink=!1},onmodal:{link:{open:function(a,b){this._setFormData(b,a)},opened:function(a,b){this._setFormFocus(b)},update:function(a,b){a=b.getData();this._validateData(b,a)&&this._update(a)},insert:function(a,b){a=b.getData();this._validateData(b,a)&&this._insert(a)},unlink:function(){this._unlink()}}},
onbutton:{link:{observe:function(a){this._observeButton(a)}}},ondropdown:{link:{observe:function(a){this._observeUnlink(a);this._observeEdit(a)}}},oncontextbar:function(a,b){var e=this._getCurrent();e=this.inspector.parse(e);if(e.isLink()){e=e.getLink();var c=l.dom(e),d=l.dom("<a>");c=c.attr("href");d.text(this._truncateText(c));d.attr("href",c);d.attr("target","_blank");d={link:{title:d},edit:{title:this.lang.get("edit"),api:"module.link.open"},unlink:{title:this.lang.get("unlink"),api:"module.link.unlink"}};
b.set(a,e,d,"bottom")}},open:function(){this.$link=this._buildCurrent();this.app.api("module.modal.build",this._getModalData())},insert:function(a){this._insert(a)},update:function(a){this._update(a)},unlink:function(){this._unlink()},_observeButton:function(a){var b=this.selection.getCurrent();b=this.inspector.parse(b);b.isPre()||b.isCode()?a.disable():a.enable()},_observeUnlink:function(a){a=a.getItem("unlink");0===this._getLinks().length?a.disable():a.enable()},_observeEdit:function(a){var b=this._getCurrent();
a=a.getItem("link");b=this.inspector.parse(b).isLink()?this.lang.get("link-edit"):this.lang.get("link-insert");a.setTitle(b)},_unlink:function(){this.app.api("module.modal.close");var a=[],b=this._getLinks();this.selection.save();for(var c=0;c<b.length;c++){var d=l.create("link.component",this.app,b[c]);a.push(this.selection.getElement(b[c]));d.unwrap();this.app.broadcast("link.deleted",d)}this.selection.restore();for(c=0;c<a.length;c++)b=a[c]?a[c]:this.editor.getElement(),this.utils.normalizeTextNodes(b);
this._resetCurrent()},_update:function(a){this.app.api("module.modal.close");var b=this._getLinks();this._setLinkData(b,a,"updated");this._resetCurrent()},_insert:function(a){this.app.api("module.modal.close");var b=this._getLinks();this._insertSingle(b,a)||(this._removeInSelection(b),this._insertMultiple(a));this._resetCurrent()},_removeInSelection:function(a){this.selection.save();for(var b=0;b<a.length;b++){var e=l.create("link.component",this.app,a[b]),c=e.clone();e.unwrap();this.app.broadcast("link.deleted",
c)}this.selection.restore()},_insertMultiple:function(a){var b=this.selection.getRange();b&&this._isCurrentTextChanged(a)&&this._deleteContents(b);b=this.inline.format({tag:"a"});this._setLinkData(b,a,"inserted")},_insertSingle:function(a,b){var e=this.selection.getInline();return 1===a.length&&a[0].textContext===this.selection.getText()||e&&"A"===e.tagName?(a=l.create("link.component",this.app,a[0]),a.setData(b),this.caret.setAfter(a),this.app.broadcast("link.inserted",a),!0):!1},_setLinkData:function(a,
b,c){b.text=""===b.text.trim()?this._truncateText(b.url):b.text;var e=!this.currentText||this.currentText!==b.text;this.selection.save();for(var d=0;d<a.length;d++){var f=l.create("link.component",this.app,a[d]),g={};b.text&&e&&(g.text=b.text);b.url&&(g.url=b.url);void 0!==b.title&&(g.title=b.title);void 0!==b.target&&(g.target=b.target);f.setData(g);this.app.broadcast("link."+c,f)}setTimeout(this.selection.restore.bind(this.selection),0)},_deleteContents:function(a){var b=this.selection.getHtml();
(b=this.utils.parseHtml(b).nodes[0])&&3!==b.nodeType?(a=b.tagName.toLowerCase(),a=document.createElement(a),this.insertion.insertNode(a,"start")):a.deleteContents()},_getModalData:function(){var a;return a=this._isLink()?{update:{title:this.lang.get("save")},unlink:{title:this.lang.get("unlink"),type:"danger"},cancel:{title:this.lang.get("cancel")}}:{insert:{title:this.lang.get("insert")},cancel:{title:this.lang.get("cancel")}},{name:"link",title:this._isLink()?this.lang.get("link-edit"):this.lang.get("link-insert"),
handle:this._isLink()?"update":"insert",commands:a}},_isLink:function(){return this.currentLink},_isCurrentTextChanged:function(a){return this.currentText&&this.currentText!==a.text},_buildCurrent:function(){var a=this._getCurrent();a=this.inspector.parse(a);if(a.isLink())this.currentLink=!0,a=a.getLink(),a=l.create("link.component",this.app,a);else{this.currentLink=!1;a=l.create("link.component",this.app);var b={text:this.selection.getText()};a.setData(b)}return a},_getCurrent:function(){return this.selection.getInlinesAllSelected({tags:["a"]})[0]},
_getLinks:function(){for(var a=this.selection.getInlines({all:!0,tags:["a"]}),b=[],c=0;c<a.length;c++)this.inspector.parse(a[c]).isLink()&&b.push(a[c]);return b},_resetCurrent:function(){this.currentText=this.isCurrentLink=!1},_truncateText:function(a){return a.length>this.opts.linkSize?a.substring(0,this.opts.linkSize)+"...":a},_validateData:function(a,b){return""!==b.url.trim()||a.setError("url")},_setFormFocus:function(a){a.getField("url").focus()},_setFormData:function(a,b){var e=this.$link.getData();
e={url:e.url,text:e.text,title:e.title,target:this.opts.linkTarget||e.target};this.opts.linkNewTab||b.find(".form-item-target").hide();this.opts.linkTitle||b.find(".form-item-title").hide();a.setData(e);this.currentText=a.getField("text").val()}});l.add("class","link.component",{mixins:["dom","component"],init:function(a,b){return this.app=a,this.opts=a.opts,this.reUrl=/^(?:(?:(?:https?|ftp):)?\/\/)?(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i,
b&&void 0!==b.cmnt?b:this._init(b)},setData:function(a){for(var b in a)this._set(b,a[b])},getData:function(){for(var a=["url","text","target","title"],b={},c=0;c<a.length;c++)b[a[c]]=this._get(a[c]);return b},_init:function(a){var b=l.dom(a);void 0===a?this.parse("<a>"):this.parse(b)},_set:function(a,b){this["_set_"+a](b)},_get:function(a){return this["_get_"+a]()},_get_target:function(){return!!this.attr("target")&&this.attr("target")},_get_url:function(){return this.attr("href")},_get_title:function(){return this.attr("title")},
_get_text:function(){return this._getContext().text()},_getContext:function(){return this._findDeepestChild(this).element},_set_target:function(a){!1===a?this.removeAttr("target"):a&&this.attr("target",!0===a?"_blank":a)},_set_text:function(a){this._getContext().html(a)},_set_title:function(a){a&&""!==a?this.attr("title",a):this.removeAttr("title")},_set_url:function(a){this.opts.linkValidation&&(a=this._cleanUrl(a),this._isMailto(a)?a="mailto:"+a.replace("mailto:",""):this._isUrl(a)&&-1===a.search(/^(ftp|https?)/i)&&
(a="http://"+a.replace(/(ftp|https?):\/\//i,"")));this.attr("href",a)},_isMailto:function(a){return-1!==a.search("@")&&!1===/(ftp|https?):\/\//i.test(a)},_isUrl:function(a){return this.reUrl.test(a)},_cleanUrl:function(a){return a.trim().replace(/[^\W\w\D\d+&\'@#/%?=~_|!:,.;\(\)]/gi,"")},_findDeepestChild:function(a){var b={depth:0,element:a};return a.children().each(function(e){var c=l.dom(e);e.outerHTML===a.html()&&(e=this._findDeepestChild(c),e.depth+1>b.depth&&(b={depth:1+e.depth,element:e.element}))}.bind(this)),
b}});l.add("module","modal",{init:function(a){this.app=a;this.lang=a.lang;this.$doc=a.$doc;this.$win=a.$win;this.$body=a.$body;this.animate=a.animate;this.detector=a.detector;this.selection=a.selection;this.selectionMarkers=this.$modal=this.$box=!1;this.defaults={name:!1,url:!1,title:!1,width:"600px",height:!1,handle:!1,commands:!1}},build:function(a){this._open(a)},close:function(){this._close()},stop:function(){this.$box&&(this.$box.remove(),this.$box=!1,this.$modal=!1,this.$doc.off(".redactor.modal"),
this.$win.off(".redactor.modal"));this.$overlay&&this.$overlay.remove()},resize:function(){this.$modal.setWidth(this.p.width);this.$modal.updatePosition()},_isOpened:function(){return this.$modal&&this.$modal.hasClass("open")},_open:function(a){this._buildDefaults(a);this.p.url?this._openUrl():this._openTemplate()},_openUrl:function(){l.ajax.post({url:this.p.url,success:this._doOpen.bind(this)})},_openTemplate:function(){if(void 0!==l.modals[this.p.name]){var a=this.lang.parse(l.modals[this.p.name]);
this._doOpen(a)}},_doOpen:function(a){this.stop();this.selection.isCollapsed()?(this.selection.save(),this.selectionMarkers=!1):(this.selection.saveMarkers(),this.selectionMarkers=!0);this.detector.isDesktop()||document.activeElement.blur();this._createModal(a);this._buildModalBox();this._buildOverlay();this._buildModal();this._buildModalForm();this._buildModalCommands();this._broadcast("open");this.$modal.updatePosition();this._buildModalTabs();this.animate.start(this.$box,"fadeIn",this._opened.bind(this));
this.animate.start(this.$overlay,"fadeIn")},_opened:function(){this.$modal.addClass("open");this.$box.on("mousedown.redactor.modal",this._close.bind(this));this.$doc.on("keyup.redactor.modal",this._handleEscape.bind(this));this.$win.on("resize.redactor.modal",this.resize.bind(this));this.$modal.getBody().find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor.modal",this._handleEnter.bind(this));window.jQuery&&jQuery(document).off("focusin.modal");this._broadcast("opened")},
_close:function(a){if(this.$box&&this._isOpened()){if(a){if(!this._needToClose(a.target))return;a.stopPropagation();a.preventDefault()}this.selectionMarkers?this.selection.restoreMarkers():this.selection.restore();this.selectionMarkers=!1;this._broadcast("close");this.animate.start(this.$box,"fadeOut",this._closed.bind(this));this.animate.start(this.$overlay,"fadeOut")}},_closed:function(){this.$modal.removeClass("open");this.$box.off(".redactor.modal");this.$doc.off(".redactor.modal");this.$win.off(".redactor.modal");
this._broadcast("closed")},_createModal:function(a){this.$modal=l.create("modal.element",this.app,a)},_broadcast:function(a){this.app.broadcast("modal."+a,this.$modal,this.$modalForm);this.app.broadcast("modal."+this.p.name+"."+a,this.$modal,this.$modalForm)},_buildDefaults:function(a){this.p=l.extend({},this.defaults,a)},_buildModalBox:function(){this.$box=l.dom("<div>");this.$box.attr("id","redactor-modal");this.$box.addClass("redactor-animate-hide");this.$box.html("");this.$body.append(this.$box)},
_buildOverlay:function(){this.$overlay=l.dom("#redactor-overlay");0===this.$overlay.length&&(this.$overlay=l.dom("<div>"),this.$overlay.attr("id","redactor-overlay"),this.$overlay.addClass("redactor-animate-hide"),this.$body.prepend(this.$overlay))},_buildModal:function(){this.$box.append(this.$modal);this.$modal.setTitle(this.p.title);this.$modal.setHeight(this.p.height);this.$modal.setWidth(this.p.width)},_buildModalCommands:function(){if(this.p.commands){var a=this.p.commands,b=this.$modal.getFooter(),
c;for(c in a){var d=l.dom("<button>");d.html(a[c].title);d.attr("data-command",c);"cancel"===c&&(d.attr("data-action","close"),d.addClass("redactor-button-unstyled"));void 0!==a[c].type&&"danger"===a[c].type&&d.addClass("redactor-button-danger");d.on("click",this._handleCommand.bind(this));b.append(d)}}},_buildModalTabs:function(){var a=this.$modal.getBody(),b=a.find(".redactor-modal-tab"),c=a.find(".redactor-modal-tabs");1<b.length&&((c=0===c.length?l.dom("<div>"):c.html("")).addClass("redactor-modal-tabs"),
b.each(function(a,b){a=l.dom(a);var e=l.dom("<a>");e.attr("href","#");e.attr("rel",b);e.text(a.attr("data-title"));e.on("click",this._showTab.bind(this));0===b&&e.addClass("active");c.append(e)}.bind(this)),a.prepend(c))},_buildModalForm:function(){this.$modalForm=l.create("modal.form",this.app,this.$modal.getForm())},_showTab:function(a){a.preventDefault();a=l.dom(a.target);var b=a.attr("rel"),e=this.$modal.getBody(),c=e.find(".redactor-modal-tab");c.hide();c.eq(b).show();e.find(".redactor-modal-tabs a").removeClass("active");
a.addClass("active")},_needToClose:function(a){var b=l.dom(a);return!("close"!==b.attr("data-action")&&!this.$modal.isCloseNode(a)&&0!==b.closest(".redactor-modal").length)},_handleCommand:function(a){var b=l.dom(a.target).closest("button").attr("data-command");"cancel"!==b&&a.preventDefault();this._broadcast(b)},_handleEnter:function(a){13===a.which&&this.p.handle&&(a.preventDefault(),this._broadcast(this.p.handle))},_handleEscape:function(a){27===a.which&&this._close()}});l.add("class","modal.element",
{mixins:["dom"],init:function(a,b){this.app=a;this.opts=a.opts;this.$win=a.$win;this._init(b)},getForm:function(){return this.find("form")},getHeader:function(){return this.$modalHeader},getBody:function(){return this.$modalBody},getFooter:function(){return this.$modalFooter},setTitle:function(a){a&&this.$modalHeader.html(a)},setWidth:function(a){a=parseInt(a)>=this.$win.width()?"96%":a;this.css("max-width",a)},setHeight:function(a){!1!==a&&this.$modalBody.css("height",a)},updatePosition:function(){var a=
this.width();this.css({left:"50%","margin-left":"-"+a/2+"px"});a=this.$win.height();var b=this.height(),c=a/2-b/2;b<a&&0!==c&&this.css("margin-top",c+"px")},isCloseNode:function(a){return a===this.$modalClose.get()},_init:function(a){this._build();this._buildClose();this._buildHeader();this._buildBody();this._buildFooter();this._buildTemplate(a)},_build:function(){this.parse("<div>");this.addClass("redactor-modal");this.attr("dir",this.opts.direction)},_buildClose:function(){this.$modalClose=l.dom("<span>");
this.$modalClose.addClass("redactor-close");this.append(this.$modalClose)},_buildHeader:function(){this.$modalHeader=l.dom("<div>");this.$modalHeader.addClass("redactor-modal-header");this.append(this.$modalHeader)},_buildBody:function(){this.$modalBody=l.dom("<div>");this.$modalBody.addClass("redactor-modal-body");this.append(this.$modalBody)},_buildFooter:function(){this.$modalFooter=l.dom("<div>");this.$modalFooter.addClass("redactor-modal-footer");this.append(this.$modalFooter)},_buildTemplate:function(a){this.$modalBody.html(a)}});
l.add("class","modal.form",{mixins:["dom"],init:function(a,b){this.app=a;this.build(b)},build:function(a){this.parse(a)},getData:function(){var a={};return this.find("[name]").each(function(b){b=l.dom(b);a[b.attr("name")]=b.val()}),a},setData:function(a){this.find("[name]").each(function(b){var e=l.dom(b),c=e.attr("name");a.hasOwnProperty(c)&&(b.type&&"checkbox"===b.type?b.checked=a[c]:e.val(a[c]))})},getField:function(a){return this.find("[name="+a+"]")},setError:function(a){a=this.getField(a);return a.addClass("error"),
a.one(this._getFieldEventName(a.get()),this._clearError),!1},_clearError:function(){return l.dom(this).removeClass("error")},_getFieldEventName:function(a){return"SELECT"===a.tagName||"checkbox"===a.type||"radio"===a.type?"change":"keyup"}});l.add("module","block",{init:function(a){this.app=a;this.block=a.block},format:function(a){a=this.block.format(a);this.app.broadcast("format","block",a)},clearformat:function(){this.block.clearFormat()},clearstyle:function(){this.block.clearStyle()},clearclass:function(){this.block.clearClass()},
clearattr:function(){this.block.clearAttr()},add:function(a,b){this.block.add(a,b)},toggle:function(a,b){this.block.toggle(a,b)},set:function(a,b){this.block.set(a,b)},remove:function(a,b){this.block.remove(a,b)}});l.add("module","inline",{init:function(a){this.app=a;this.inline=a.inline},format:function(a){a=this.inline.format(a);this.app.broadcast("format","inline",a)},clearformat:function(){this.inline.clearFormat()},clearstyle:function(){this.inline.clearStyle()},clearclass:function(){this.inline.clearClass()},
clearattr:function(){this.inline.clearAttr()},add:function(a,b){this.inline.add(a,b)},toggle:function(a,b){this.inline.toggle(a,b)},set:function(a,b){this.inline.set(a,b)},remove:function(a,b){this.inline.remove(a,b)}});l.add("module","autosave",{init:function(a){this.app=a;this.opts=a.opts;this.utils=a.utils;this.source=a.source},onsynced:function(){this.opts.autosave&&this._send()},_send:function(){var a=this.opts.autosaveName?this.opts.autosaveName:this.source.getName(),b={};b[a]=this.source.getCode();
b=this.utils.extendData(b,this.opts.autosaveData);l.ajax.post({url:this.opts.autosave,data:b,success:function(e){this._complete(e,a,b)}.bind(this)})},_complete:function(a,b,c){this.app.broadcast(a&&a.error?"autosaveError":"autosave",b,c,a)}});l.add("module","input",{init:function(a){this.app=a;this.opts=a.opts;this.utils=a.utils;this.editor=a.editor;this.keycodes=a.keycodes;this.element=a.element;this.selection=a.selection;this.insertion=a.insertion;this.inspector=a.inspector;this.autoparser=a.autoparser;
this.lastShiftKey=!1},onpaste:function(a,b){if(this.opts.input)return l.create("input.paste",this.app,a,b)},onkeydown:function(a){if(this.opts.input){var b=a.which;if(!l.create("input.shortcut",this.app,a).is()){if((a.ctrlKey||a.metaKey)&&!a.altKey&&65===b)return a.preventDefault(),this._selectAll();var e=-1!==[this.keycodes.ENTER,this.keycodes.SPACE,this.keycodes.BACKSPACE,this.keycodes.DELETE].indexOf(b),c=(a.ctrlKey||a.metaKey)&&88===b;if(this.selection.isAll()&&(c||!(a.ctrlKey||a.metaKey||a.altKey||
a.shiftKey))){((e||c)&&a.preventDefault(),this.element.isType("inline"))?(this.editor.getElement().html(""),this.editor.startFocus()):this.insertion.set(this.opts.emptyHtml);if(e||c)return;this.app.broadcast("empty")}if(this.opts.autoparse&&this.autoparser.format(a,b),a.ctrlKey||a.metaKey||!(48<=b&&57>=b||65<=b&&90>=b)||!this.selection.hasNonEditable())return b===this.keycodes.ENTER?l.create("input.enter",this.app,a,b):a.metaKey&&219===b?(a.preventDefault(),void this.app.api("module.list.outdent")):
b===this.keycodes.TAB||a.metaKey&&221===b?l.create("input.tab",this.app,a,b):b===this.keycodes.SPACE?l.create("input.space",this.app,a,b,this.lastShiftKey):this._isDeleteKey(b)?l.create("input.delete",this.app,a,b):this._isArrowKey(b)?l.create("input.arrow",this.app,a,b):void 0;a.preventDefault()}}},onkeyup:function(a){if(this.opts.input){var b=a.which;if(this.lastShiftKey=a.shiftKey,this.app.broadcast("contextbar.close"),!l.create("input.shortcode",this.app,a,b).is()){if(b===this.keycodes.BACKSPACE&&
(b=this.editor.getElement(),""===this.utils.trimSpaces(b.html()).replace(/<br\s?\/?>/g,"").replace(/<div><\/div>/,"")))return a.preventDefault(),this.editor.setEmpty(),void this.editor.startFocus();this.editor.isEmpty()&&this.app.broadcast("empty")}}},start:function(){this.opts.shortcutsAdd&&(this.opts.shortcuts=l.extend({},!0,this.opts.shortcuts,this.opts.shortcutsAdd))},_selectAll:function(){var a,b=this.selection.getCurrent();b=this.inspector.parse(b);return b.isComponentType("table")?(a=b.getTable(),
void this.selection.setAll(a)):b.isComponentType("code")?(a=b.getComponentCodeElement(),void this.selection.setAll(a)):void this.selection.setAll()},_isArrowKey:function(a){return-1!==[this.keycodes.UP,this.keycodes.DOWN,this.keycodes.RIGHT,this.keycodes.LEFT].indexOf(a)},_isDeleteKey:function(a){return a===this.keycodes.BACKSPACE||a===this.keycodes.DELETE}});l.add("class","input.arrow",{init:function(a,b,c){this.app=a;this.opts=a.opts;this.utils=a.utils;this.caret=a.caret;this.offset=a.offset;this.marker=
a.marker;this.editor=a.editor;this.keycodes=a.keycodes;this.component=a.component;this.inspector=a.inspector;this.selection=a.selection;this.key=c;this._init(b)},_init:function(a){this._isRightLeftKey()&&this._isExitVariable(a)||this._isRightDownKey()&&(this._isExitOnDownRight(a)||this._selectComponent(a,"End","next"))||this._isLeftUpKey()&&(this._isExitOnUpLeft(a)||this._selectComponent(a,"Start","prev"))||(this.key===this.keycodes.LEFT?this.utils.trimInvisibleChars("left"):this.key===this.keycodes.RIGHT&&
this.utils.trimInvisibleChars("right"))},_isRightDownKey:function(){return-1!==[this.keycodes.DOWN,this.keycodes.RIGHT].indexOf(this.key)},_isLeftUpKey:function(){return-1!==[this.keycodes.UP,this.keycodes.LEFT].indexOf(this.key)},_isRightLeftKey:function(){return-1!==[this.keycodes.RIGHT,this.keycodes.LEFT].indexOf(this.key)},_isExitVariable:function(a){var b=this.selection.getCurrent();b=this.inspector.parse(b);var e=b.getComponent();b.isComponentType("variable")&&b.isComponentActive()&&(a.preventDefault(),
this.caret[this.key===this.keycodes.LEFT?"setBefore":"setAfter"](e))},_isExitOnUpLeft:function(a){var b=this.selection.getCurrent(),e=this.selection.getBlock(b),c=this.inspector.parse(b),d=e.previousElementSibling;if((b=this.caret.isStart(e))&&d&&"TABLE"===d.tagName)return a.preventDefault(),this.caret.setEnd(d),!0;if(c.isFigcaption()){if(e=c.getFigcaption(),b=this.caret.isStart(e),e=l.dom(e).closest(".redactor-component"),b&&0!==e.length)return a.preventDefault(),this.caret.setEnd(e),!0}else{if(c.isTable()&&
b)return a.preventDefault(),this.caret.setEnd(e.previousElementSibling),!0;if(!c.isComponentEditable()&&c.isComponent()&&!c.isComponentType("variable")&&(e=c.getComponent(),e.previousElementSibling))return a.preventDefault(),this.component.clearActive(),this.caret.setEnd(e.previousElementSibling),!0}},_isExitOnDownRight:function(a){var b,e=this.editor.getElement(),c=this.selection.getCurrent(),d=this.inspector.parse(c),f=this.caret.isEnd();if(d.isTable()){if(g||f)return this._exitNextElement(a,d.getComponent())}else if(d.isFigcaption()){if(b=
d.getFigcaption(),this.caret.isEnd(b)||f)return this._exitNextElement(a,d.getComponent())}else if(d.isComponentType("code")){f=d.getComponent();d=l.dom(d.getComponentCodeElement()).closest("pre");var g=this.caret.isEnd(b);b=d&&d.get().nextElementSibling;if(g&&!b)return this._exitNextElement(a,f)}else if(d.isPre()||d.isBlockquote()||d.isDl()){if(f){if(d.isPre())return this._exitNextElement(a,d.getPre());if(d.isBlockquote())return this._exitNextElement(a,d.getBlockquote());if(d.isDl())return this._exitNextElement(a,
d.getDl())}}else if(d.isList()){if(g=l.dom(c).parents("ul, ol",e).last(),this.caret.isEnd(g)||f)return this._exitNextElement(a,g.get())}else if(d.isComponent()&&!d.isComponentType("variable"))return this.component.clearActive(),this._exitNextElement(a,d.getComponent())},_exitNextElement:function(a,b){return a.preventDefault(),b.nextElementSibling?this.caret.setStart(b.nextElementSibling):this.utils.createMarkup(b),!0},_selectComponent:function(a,b,c){var e=this.selection.getCurrent(),d=this.selection.getBlock(e),
f=this.utils.findSiblings(e,c);c=this.utils.findSiblings(d,c);f&&this.caret["is"+b](e)?this._selectComponentItem(a,f,b):c&&this.caret["is"+b](d)&&this._selectComponentItem(a,c,b)},_selectComponentItem:function(a,b,c){if(this.component.isNonEditable(b))return a.preventDefault(),this.caret["set"+c](b),!0}});l.add("class","input.delete",{init:function(a,b,c){this.app=a;this.opts=a.opts;this.caret=a.caret;this.utils=a.utils;this.editor=a.editor;this.marker=a.marker;this.keycodes=a.keycodes;this.component=
a.component;this.inspector=a.inspector;this.selection=a.selection;this.key=c;this._init(b)},_init:function(a){if(!this._removeActiveComponent(a)&&!this._removeAllSelectedTable(a)){if(this.key===this.keycodes.BACKSPACE){var b=this.editor.getElement();if(this.utils.trimSpaces(b.html())===this.opts.emptyHtml)return void a.preventDefault()}this._detectVariableOrNonEditable()||this.selection.hasNonEditable()?a.preventDefault():(this.selection.isCollapsed()&&(this.key===this.keycodes.BACKSPACE?this._traverseBackspace(a):
this.key===this.keycodes.DELETE&&this._traverseDelete(a)),this.key===this.keycodes.BACKSPACE&&this.utils.trimInvisibleChars("left"),this._removeUnwantedStyles(),this._removeEmptySpans(),this._removeSpanTagsInHeadings(),this._removeInlineTagsInPre())}},_detectVariableOrNonEditable:function(){var a,b=this.selection.getBlock(),c=this.caret.isStart(b),d=this.caret.isEnd(b);if(this.key===this.keycodes.BACKSPACE&&c){if(a=b.previousSibling,this._isNonEditable(a))return!0}else if(this.key===this.keycodes.DELETE&&
d&&(a=b.nextSibling,this._isNonEditable(a)))return!0;b=this.selection.getCurrent();c=this.caret.isStart(b);d=this.caret.isEnd(b);var f=""===this.selection.getTextBeforeCaret().trim(),g=""===this.selection.getTextAfterCaret().trim();if(this.key===this.keycodes.BACKSPACE&&c&&!f){if(a=b.previousSibling,this._isVariable(a))return this.caret.setEnd(a),!0;if(this._isNonEditable(a))return!0}else if(this.key===this.keycodes.DELETE&&d&&!g){if(a=b.nextSibling,this._isVariable(a))return this.caret.setStart(a),
!0;if(this._isNonEditable(a))return!0}},_isVariable:function(a){return 0!==l.dom(a).closest('[data-redactor-type="variable"]').length},_isNonEditable:function(a){return 0!==l.dom(a).closest(".non-editable").length},_getBlock:function(){var a=this.editor.getElement(),b=this.selection.getBlock(),c=this.inspector.parse(b);return b=c.isList()?l.dom(b).parents("ul, ol",a).last().get():b,b=c.isDl()?c.getDl():b,c.isTable()?c.getTable():b},_traverseDelete:function(a){var b,e,c=this.selection.getCurrent(),
d=this.inspector.parse(c);if(d.isFigcaption()){if(b=d.getFigcaption(),this.caret.isEnd(b))return void a.preventDefault()}else if(d.isComponentType("code")&&(b=d.getComponent(),this.caret.isEnd(b)))return void a.preventDefault();b=this._getBlock();if(c=this.utils.findSiblings(b,"next")){var f=this.caret.isEnd(b);var g=this.inspector.parse(c),m="P"===c.tagName||"DIV"===c.tagName;if(f&&g.isComponentEditable())return a.preventDefault(),void this.component.remove(c,!1);if(f&&g.isComponent())return a.preventDefault(),
this.caret.setStart(c),void(this.utils.isEmptyHtml(b.innerHTML)&&l.dom(b).remove());if(f&&g.isList()){b=l.dom(b);if(e=l.dom(c),d.isList())return a.preventDefault(),b.append(e),void e.unwrap();c=e.children("li").first();d=c.find("ul, ol");if(0!==d.length)return a.preventDefault(),e.prepend(d),d.unwrap(),b.append(c),void c.unwrap()}else if(f&&!d.isTable()&&m&&!this.utils.isEmptyHtml(b.innerHTML))return a.preventDefault(),a=l.dom(b),e=l.dom(c),a.append(e),void e.unwrap()}},_traverseBackspace:function(a){var b,
e,c=this.selection.getCurrent(),d=this.inspector.parse(c);if(d.isFigcaption()){if(b=d.getFigcaption(),this.caret.isStart(b))return void a.preventDefault()}else if(d.isComponentType("code")&&(b=d.getComponent(),this.caret.isStart(b)&&b.previousElementSibling))return a.preventDefault(),this.caret.setEnd(b.previousElementSibling),!0;b=this._getBlock();if(c=this.utils.findSiblings(b,"prev")){var f=this.caret.isStart(b);var g=this.inspector.parse(c),m="P"===c.tagName||"DIV"===c.tagName;if(f&&g.isComponentEditable())return a.preventDefault(),
void this.component.remove(c,!1);if(f&&g.isComponent())return a.preventDefault(),this.caret.setStart(c),void(this.utils.isEmptyHtml(b.innerHTML)&&l.dom(b).remove());if(f&&d.isList())(a.preventDefault(),b=l.dom(b),e=l.dom(c),g.isList())?(b.children("li").first().prepend(this.marker.build("start")),e.append(b),b.unwrap(),this.selection.restoreMarkers()):(c=b.children("li").first(),e=c.get(),c=c.find("ul, ol"),e=this.utils.replaceToTag(e,this.opts.markup),this.opts.breakline&&e.attr("data-redactor-tag",
"br"),b.before(e),this.caret.setStart(e),0!==c.length&&(b.prepend(c),c.unwrap()));else if(f&&m)return a.preventDefault(),a=this.utils.createInvisibleChar(),b=l.dom(b),e=l.dom(c),this.caret.setEnd(e),b.prepend(a),e.append(b.contents()),void b.remove()}else setTimeout(this._replaceBlock.bind(this),1)},_replaceBlock:function(){var a=this.selection.getBlock(),b=l.dom(a);if("p"===this.opts.markup&&a&&this._isNeedToReplaceBlock(a)){var c=document.createElement(this.opts.markup);b.replaceWith(c);this.caret.setStart(c)}this.opts.breakline&&
a&&"DIV"===a.tagName&&b.attr("data-redactor-tag","br")},_isNeedToReplaceBlock:function(a){return"DIV"===a.tagName&&this.utils.isEmptyHtml(a.innerHTML)},_removeActiveComponent:function(a){var b=this.selection.getCurrent();b=this.inspector.parse(b);var c=b.getComponent();if(b.isComponent()&&this.component.isActive(c))return a.preventDefault(),this.component.remove(c),!0},_removeAllSelectedTable:function(a){var b=this.selection.getCurrent();if((b=this.inspector.parse(b).getTable())&&this.selection.isAll(b))return a.preventDefault(),
this.component.remove(b),!0},_removeUnwantedStyles:function(){var a=this.editor.getElement();setTimeout(function(){a.find("*[style]").not("img, figure, iframe, [data-redactor-style-cache], [data-redactor-span]").removeAttr("style")},0)},_removeEmptySpans:function(){var a=this.editor.getElement();setTimeout(function(){a.find("span").each(function(a){0===a.attributes.length&&l.dom(a).replaceWith(a.childNodes)})},0)},_removeSpanTagsInHeadings:function(){var a=this.editor.getElement();setTimeout(function(){a.find("h1, h2, h3, h4, h5, h6").each(function(a){a=
l.dom(a);0===a.closest("figure").length&&a.find("span").not(".redactor-component, .non-editable, .redactor-selection-marker, [data-redactor-style-cache], [data-redactor-span]").unwrap()})},1)},_removeInlineTagsInPre:function(){var a=this.editor.getElement(),b=this.opts.inlineTags;setTimeout(function(){a.find("pre").each(function(a){a=l.dom(a);0===a.closest("figure").length&&a.find(b.join(",")).not("code, .redactor-selection-marker").unwrap()})},1)}});l.add("class","input.enter",{init:function(a,b){this.app=
a;this.opts=a.opts;this.utils=a.utils;this.caret=a.caret;this.editor=a.editor;this.insertion=a.insertion;this.selection=a.selection;this.inspector=a.inspector;this._init(b)},_init:function(a){return this.opts.enterKey?!1===this.app.broadcast("enter",a)?a.preventDefault():this.selection.hasNonEditable()?void a.preventDefault():a.ctrlKey||a.shiftKey?this._insertBreak(a):void(this._isExit(a)||this._traverse(a)):this._disable(a)},_disable:function(a){a.preventDefault();(a=this.selection.getRange())&&
!a.collapsed&&a.deleteContents()},_insertBreak:function(a){a.preventDefault();a=this.selection.getCurrent();a=this.inspector.parse(a);a.isComponent()&&!a.isComponentEditable()||a.isCode()||(a.isPre()?this.insertion.insertNewline():this.insertion.insertBreakLine())},_isExit:function(a){var b=this.editor.getElement(),c=this.selection.getBlock(),e=this.inspector.parse(c),d=this.caret.isEnd(c),f=this.selection.getCurrent(),g=f.previousSibling;if(e.isBlockquote()){if(b=d&&this._isExitableBlock(c,"P"),
d=d&&this._isExitableDblBreak(g),b||d)return this._exitFromElement(a,d?g:c,e.getBlockquote())}else if(!e.isComponentType("code")&&e.isPre()){if(d&&null!==this.utils.removeInvisibleChars(c.innerHTML).match(/(\n\n\n)$/))return l.dom(g.previousSibling.previousSibling).remove(),this._exitFromElement(a,g,c)}else if(e.isDl()){if(d&&this._isExitableBlock(c,"DT"))return this._exitFromElement(a,c,e.getDl())}else if(e.isList()){if(e=l.dom(f).parents("ul, ol",b).last(),this.caret.isEnd(e)&&this._isExitableBlock(c,
"LI"))return this._exitFromElement(a,c,e)}else if(e.isComponent()&&e.isComponentActive()&&!e.isFigcaption()&&!e.isComponentEditable())return this._exitFromElement(a,!1,e.getComponent())},_isExitableDblBreak:function(a){if(a=!!a&&a.nextSibling){var b=this.utils.removeInvisibleChars(a.textContent);return 3===a.nodeType&&""===b.trim()}},_isExitableBlock:function(a,b){return a&&a.tagName===b&&this.utils.isEmptyHtml(a.innerHTML)},_exitFromElement:function(a,b,c){return a.preventDefault(),b&&l.dom(b).remove(),
this.utils.createMarkup(c),!0},_exitNextElement:function(a,b){return a.preventDefault(),b.nextSibling?this.caret.setStart(b.nextSibling):this.utils.createMarkup(b),!0},_traverse:function(a){var b=this.selection.getCurrent(),c=this.selection.isText(),e=this.selection.getBlock(),d=this.inspector.parse(b),f=!!e&&e.tagName.toLowerCase();return d.isPre()?(a.preventDefault(),this.insertion.insertNewline()):d.isBlockquote()?(e=this.selection.getBlock(b))&&"BLOCKQUOTE"===e.tagName?(a.preventDefault(),this.insertion.insertBreakLine()):
void 0:d.isFigcaption()?(e=d.getFigcaption(),b=this.caret.isEnd(e),c=this.caret.isEnd(),b||c?this._exitNextElement(a,d.getComponent()):void a.preventDefault()):d.isDl()?(a.preventDefault(),this._traverseDl(b)):c||this.opts.breakline&&"div"===f?(a.preventDefault(),this.insertion.insertBreakLine()):void setTimeout(this._replaceBlock.bind(this),1)},_traverseDl:function(a){var b=this.selection.getBlock(a),c=this.inspector.parse(b).getTag();a=l.dom(b);var e=a.get().nextSibling||!1,d=l.dom(e),f=e&&d.is("dd");
e=e&&d.is("dt");b=this.caret.isEnd(b);return"dt"===c&&!f&&b?(c=document.createElement("dd"),a.after(c),void this.caret.setStart(c)):"dd"===c&&!e&&b?(c=document.createElement("dt"),a.after(c),void this.caret.setStart(c)):this.insertion.insertBreakLine()},_replaceBlock:function(){var a=this.selection.getBlock(),b=l.dom(a);if("p"===this.opts.markup&&a&&this._isNeedToReplaceBlock(a)){var c=document.createElement(this.opts.markup);b.replaceWith(c);this.caret.setStart(c)}else a&&(this.utils.isEmptyHtml(a.innerHTML)?
this._clearBlock(b,a):(c=this.utils.getFirstNode(a))&&"BR"===c.tagName&&(l.dom(c).remove(),this.caret.setStart(a)));a&&this._isNeedToCleanBlockStyle(a)&&this.opts.cleanOnEnter&&b.removeAttr("class style");this.opts.breakline&&a&&"DIV"===a.tagName&&b.attr("data-redactor-tag","br")},_clearBlock:function(a,b){(this.opts.cleanInlineOnEnter||"<br>"===b.innerHTML)&&a.html("");this.caret.setStart(b)},_isNeedToReplaceBlock:function(a){return"DIV"===a.tagName&&this.utils.isEmptyHtml(a.innerHTML)},_isNeedToCleanBlockStyle:function(a){return"P"===
a.tagName&&this.utils.isEmptyHtml(a.innerHTML)}});l.add("class","input.paste",{init:function(a,b,c,d,f){this.app=a;this.opts=a.opts;this.editor=a.editor;this.cleaner=a.cleaner;this.container=a.container;this.inspector=a.inspector;this.insertion=a.insertion;this.selection=a.selection;this.autoparser=a.autoparser;this.pasteHtml=d;this.pointInserted=f;this.dataTransfer=c;this._init(b)},_init:function(a){var b=this.dataTransfer||a.clipboardData,c=this.selection.getCurrent();c=this.inspector.parse(c);
if(this.dropPasted=this.dataTransfer,this.isRawCode=c.isPre()||c.isCode(),this.editor.enablePasting(),this.editor.saveScroll(),this.dropPasted||this.selection.saveMarkers(),this.isRawCode||!b)return c=b.getData("text/plain"),a.preventDefault(),void this._insert(a,c);if(this.pasteHtml)a.preventDefault(),this._insert(a,this.pasteHtml);else{var e=b.getData("URL");c=this._isPlainText(b)?b.getData("text/plain"):b.getData("text/html");c=e&&""!==e?e:c;e=b.items||b.files;b=!b.items&&b.files;if(e&&""===c){for(var d=
[],f=0;f<e.length;f++){var g=b?e[f]:e[f].getAsFile();g&&d.push(g)}if(0<d.length)return a.preventDefault(),void this._insertFiles(a,d)}a.preventDefault();this._insert(a,c)}},_isPlainText:function(a){var b=a.getData("text/plain");a=a.getData("text/html");if(!b||!a)return null!==b;var c=document.createElement("div");return c.innerHTML=a,c.textContent===b?!c.querySelector(":not(meta)"):void 0},_restoreSelection:function(){this.editor.restoreScroll();this.editor.disablePasting();this.dropPasted||this.selection.restoreMarkers()},
_insert:function(a,b){var c=this.app.broadcast("pasteBefore",b);if(b=void 0===c?b:c,b=this.isRawCode?b:this.cleaner.paste(b),b=this.isRawCode?this.cleaner.encodePhpCode(b):b,b=void 0===(c=this.app.broadcast("pasting",b))?b:c,this._restoreSelection(),this.opts.input)this.opts.autoparse&&this.opts.autoparsePaste&&(b=this.autoparser.parse(b)),a=this.dropPasted?this.insertion.insertToPoint(a,b,this.pointInserted):this.insertion.insertHtml(b),this.app.broadcast("pasted",a),this.app.broadcast("autoparseobserve")},
_insertFiles:function(a,b){this._restoreSelection();var c=-1!==this.opts.imageTypes.indexOf(b[0].type),e=void 0===this.dropPasted;c?this.app.broadcast("dropimage",a,b,e):this.app.broadcast("dropfile",a,b,e)}});l.add("class","input.shortcode",{init:function(a,b,c){this.app=a;this.opts=a.opts;this.utils=a.utils;this.marker=a.marker;this.keycodes=a.keycodes;this.selection=a.selection;this.worked=!1;c===this.keycodes.SPACE&&this._init()},is:function(){return this.worked},_init:function(){var a=this.selection.getCurrent();
if(a&&3===a.nodeType){var b=this.utils.removeInvisibleChars(a.textContent),c=this.opts.shortcodes,d;for(d in c){var f=new RegExp("^"+this.utils.escapeRegExp(d));if(null!==b.match(f)&&void 0!==c[d].format)return this._format(c[d].format,a,f)}}},_format:function(a,b,c){var e=(b=this.marker.insert("start").previousSibling).textContent;e=(e=this.utils.trimSpaces(e)).replace(c,"");b.textContent=e;this.app.api("ul"===a||"ol"===a?"module.list.toggle":"module.block.format",a);this.selection.restoreMarkers();
this.worked=!0}});l.add("class","input.shortcut",{init:function(a,b){this.app=a;this.opts=a.opts;this.worked=!1;this.hotkeys={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",
115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};this.hotkeysShiftNums={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"};this._init(b)},is:function(){return this.worked},_init:function(a){if(!1!==this.opts.shortcuts)for(var b in this.opts.shortcuts)this._build(a,
b,this.opts.shortcuts[b]);else!a.ctrlKey&&!a.metaKey||66!==a.which&&73!==a.which||a.preventDefault()},_build:function(a,b,c){b=b.split(",");for(var e=b.length,d=0;d<e;d++)"string"==typeof b[d]&&this._handler(a,b[d].trim(),c)},_handler:function(a,b,c){b=b.toLowerCase().split(" ");for(var e=this.hotkeys[a.keyCode],d=String.fromCharCode(a.which).toLowerCase(),f="",g={},l=["alt","ctrl","meta","shift"],m=0;m<l.length;m++){var n=l[m];a[n+"Key"]&&e!==n&&(f+=n+"+")}e&&(g[f+e]=!0);d&&(g[f+d]=!0,g[f+this.hotkeysShiftNums[d]]=
!0,"shift+"===f&&(g[this.hotkeysShiftNums[d]]=!0));e=b.length;for(m=0;m<e;m++)if(g[b[m]])return a.preventDefault(),this.worked=!0,void(c.message?this.app.broadcast(c.message,c.args):c.api&&this.app.api(c.api,c.args))}});l.add("class","input.space",{init:function(a,b,c,d){this.app=a;this.keycodes=a.keycodes;this.insertion=a.insertion;this.selection=a.selection;this.key=c;this.lastShiftKey=d;this._init(b)},_init:function(a){if(!this.selection.hasNonEditable())return this.lastShiftKey||this.key!==this.keycodes.SPACE||
!a.ctrlKey&&!a.shiftKey||a.metaKey?void 0:(a.preventDefault(),void this.insertion.insertChar("&nbsp;"));a.preventDefault()}});l.add("class","input.tab",{init:function(a,b){this.app=a;this.opts=a.opts;this.inspector=a.inspector;this.insertion=a.insertion;this.selection=a.selection;this._init(b)},_init:function(a){return this.opts.tabKey?!1===this.app.broadcast("tab",a)?a.preventDefault():void this._traverse(a):this._disable(a)},_disable:function(a){a.preventDefault()},_traverse:function(a){var b=this.selection.getCurrent();
b=this.inspector.parse(b);return!b.isComponent()&&a.shiftKey?this._insertHardTab(a,4):b.isList()?(a.preventDefault(),this.app.api("module.list.indent")):b.isPre()||b.isComponentType("code")&&!b.isFigcaption()?this._tabCode(a):!1!==this.opts.tabAsSpaces?this._insertHardTab(a,this.opts.tabAsSpaces):void 0},_insertHardTab:function(a,b){a.preventDefault();a=document.createTextNode(Array(b+1).join("\u00a0"));return this.insertion.insertNode(a,"end")},_tabCode:function(a){a.preventDefault();a=this.opts.preSpaces?
document.createTextNode(Array(this.opts.preSpaces+1).join("\u00a0")):document.createTextNode("\t");return this.insertion.insertNode(a,"end")}});l.add("module","upload",{init:function(a){this.app=a;this.opts=a.opts;this.lang=a.lang;this.utils=a.utils;this.editor=a.editor;this.progress=a.progress;this.defaults={event:!1,element:!1,name:!1,files:!1,url:!1,data:!1,paramName:!1}},build:function(a){this.p=l.extend(this.defaults,a);this.$el=l.dom(this.p.element);"INPUT"===this.$el.get().tagName?this._buildInput():
this._buildBox()},send:function(a){this.p=l.extend(this.defaults,a);this.$uploadbox=this.editor.getElement();this._send(this.p.event,this.p.files)},complete:function(a,b){this._complete(a,b)},_buildInput:function(){this.box=!1;this.prefix="";this.$uploadbox=l.dom('<div class="upload-box" />');this.$el.hide();this.$el.after(this.$uploadbox);this.opts.multipleUpload?this.$el.attr("multiple","multiple"):this.$el.removeAttr("multiple");this._buildPlaceholder();this._buildEvents()},_buildBox:function(){this.box=
!0;this.prefix="box-";this.$uploadbox=this.$el;this.$uploadbox.attr("ondragstart","return false;");this.$uploadbox.on("drop.redactor.upload",this._onDropBox.bind(this));this.$uploadbox.on("dragover.redactor.upload",this._onDragOver.bind(this));this.$uploadbox.on("dragleave.redactor.upload",this._onDragLeave.bind(this))},_buildPlaceholder:function(){this.$placeholder=l.dom('<div class="upload-placeholder" />');this.$placeholder.html(this.lang.get("upload-label"));this.$uploadbox.append(this.$placeholder)},
_buildEvents:function(){this.$el.on("change.redactor.upload",this._onChange.bind(this));this.$uploadbox.on("click.redactor.upload",this._onClick.bind(this));this.$uploadbox.on("drop.redactor.upload",this._onDrop.bind(this));this.$uploadbox.on("dragover.redactor.upload",this._onDragOver.bind(this));this.$uploadbox.on("dragleave.redactor.upload",this._onDragLeave.bind(this))},_onClick:function(a){a.preventDefault();this.$el.click()},_onChange:function(a){this.app.broadcast("upload.start");this._send(a,
this.$el.get().files)},_onDrop:function(a){a.preventDefault();this._clear();this._setStatusDrop();this.app.broadcast("upload.start");this._send(a)},_onDragOver:function(a){return a.preventDefault(),this._setStatusHover(),!1},_onDragLeave:function(a){return a.preventDefault(),this._removeStatusHover(),!1},_onDropBox:function(a){a.preventDefault();this._clear();this._setStatusDrop();this.app.broadcast("upload.start");this._send(a)},_removeStatusHover:function(){this.$uploadbox.removeClass("upload-"+
this.prefix+"hover")},_setStatusDrop:function(){this.$uploadbox.addClass("upload-"+this.prefix+"drop")},_setStatusHover:function(){this.$uploadbox.addClass("upload-"+this.prefix+"hover")},_setStatusError:function(){this.$uploadbox.addClass("upload-"+this.prefix+"error")},_setStatusSuccess:function(){this.$uploadbox.addClass("upload-"+this.prefix+"success")},_clear:function(){for(var a=["drop","hover","error","success"],b=0;b<a.length;b++)this.$uploadbox.removeClass("upload-"+this.prefix+a[b]);this.$uploadbox.removeAttr("ondragstart")},
_send:function(a,b){a=a.originalEvent||a;b=b||a.dataTransfer.files;var c=new FormData,e=this._getUploadParam();c=this._buildData(e,b,c);c=this.utils.extendData(c,this.p.data);this._sendData(c,b,a)},_sendData:function(a,b,c){(this.progress.show(),"function"==typeof this.p.url)?(a=this.p.url(a,b,c,this),a instanceof Promise||this._complete(a)):l.ajax.post({url:this.p.url,data:a,before:function(a){return this.app.broadcast("upload.beforeSend",a)}.bind(this),success:function(a){this._complete(a,c)}.bind(this)})},
_getUploadParam:function(){return this.p.paramName?this.p.paramName:"file"},_buildData:function(a,b,c){if(1===b.length)c.append(a+"[]",b[0]);else if(1<b.length&&!1!==this.opts.multipleUpload)for(var e=0;e<b.length;e++)c.append(a+"[]",b[e]);return c},_complete:function(a,b){this._clear();this.progress.hide();a&&a.error?(this._setStatusError(),this.app.broadcast("upload."+this.p.name+".error",a,b),this.app.broadcast("upload.error",a)):(this._setStatusSuccess(),this.app.broadcast("upload."+this.p.name+
".complete",a,b),this.app.broadcast("upload.complete",a),setTimeout(this._clear.bind(this),500))}});l.add("class","code.component",{mixins:["dom","component"],init:function(a,b){return this.app=a,b&&void 0!==b.cmnt?b:this._init(b)},_init:function(a){if(void 0!==a){var b=l.dom(a).closest("figure");0!==b.length?this.parse(b):(this.parse("<figure>"),this.append(a));a=this.find("pre code, pre").last()}else a=l.dom("<pre>"),this.parse("<figure>"),this.append(a);this._initElement(a);this._initWrapper()},
_initElement:function(a){a.attr({tabindex:"-1",contenteditable:!0})},_initWrapper:function(){this.addClass("redactor-component");this.attr({"data-redactor-type":"code",tabindex:"-1",contenteditable:!1})}});l.add("module","form",{init:function(a){this.app=a;this.lang=a.lang;this.component=a.component;this.inspector=a.inspector},onform:{remove:function(a){this._remove(a)}},oncontextbar:function(a,b){var c=this.inspector.parse(a.target);if(c.isComponentType("form")){c=c.getComponent();var e={remove:{title:this.lang.get("delete"),
api:"module.form.remove",args:c}};b.set(a,c,e,"top")}},_remove:function(a){this.component.remove(a)}});l.add("class","form.component",{mixins:["dom","component"],init:function(a,b){return this.app=a,this.utils=a.utils,b&&void 0!==b.cmnt?b:this._init(b)},_init:function(a){void 0!==a?0!==l.dom(a).closest("form").length?(a=this.utils.replaceToTag(a,"figure"),this.parse(a)):(this.parse("<figure>"),this.append(a)):this.parse("<figure>");this._initWrapper()},_initWrapper:function(){this.addClass("redactor-component");
this.attr({"data-redactor-type":"form",tabindex:"-1",contenteditable:!1})}});l.add("module","image",{modals:{image:'<div class="redactor-modal-tab" data-title="## upload ##"><form action="">                 <input type="file" name="file">             </form></div>',imageedit:'<div class="redactor-modal-group">                 <div id="redactor-modal-image-preview" class="redactor-modal-side"></div>                 <form action="" class="redactor-modal-area">                     <div class="form-item">                         <label for="modal-image-title"> ## title ##</label>                         <input type="text" id="modal-image-title" name="title" />                     </div>                     <div class="form-item">                         <label for="modal-image-caption">## caption ##</label>                         <input type="text" id="modal-image-caption" name="caption" aria-label="## caption ##" />                     </div>                     <div class="form-item form-item-align">                         <label>## image-position ##</label>                         <select name="align" aria-label="## image-position ##">                             <option value="none">## none ##</option>                             <option value="left">## left ##</option>                             <option value="center">## center ##</option>                             <option value="right">## right ##</option>                         </select>                     </div>                     <div class="form-item">                         <label for="modal-image-url">## link ##</label>                         <input type="text" id="modal-image-url" name="url" aria-label="## link ##" />                     </div>                     <div class="form-item">                         <label class="checkbox"><input type="checkbox" name="target" aria-label="## link-in-new-tab ##"> ## link-in-new-tab ##</label>                     </div>                 </form>             </div>'},
init:function(a){this.app=a;this.opts=a.opts;this.lang=a.lang;this.caret=a.caret;this.utils=a.utils;this.editor=a.editor;this.storage=a.storage;this.component=a.component;this.inspector=a.inspector;this.insertion=a.insertion;this.selection=a.selection;this.justResized=!1},oninsert:function(){this._observeImages()},onstarted:function(){this.storage.observeImages();this.opts.imageResizable&&(this.resizer=l.create("image.resize",this.app));this._observeImages()},ondropimage:function(a,b,c){this.opts.imageUpload&&
this.app.api("module.upload.send",{url:this.opts.imageUpload,event:!c&&a,files:b,name:"imagedrop",data:this.opts.imageData})},onstop:function(){this.resizer&&this.resizer.stop()},onimageresizer:{stop:function(){this.resizer&&this.resizer.hide()}},onsource:{open:function(){this.resizer&&this.resizer.hide()},closed:function(){this._observeImages();this.resizer&&this.resizer.rebuild()}},onupload:{complete:function(){this._observeImages()},image:{complete:function(a){this._insert(a)},error:function(a){this._uploadError(a)}},
imageedit:{complete:function(a){this._change(a)},error:function(a){this._uploadError(a)}},imagedrop:{complete:function(a,b){this._insert(a,b)},error:function(a){this._uploadError(a)}},imagereplace:{complete:function(a){this._change(a,!1)},error:function(a){this._uploadError(a)}}},onmodal:{image:{open:function(a,b){this._setUpload(b)}},imageedit:{open:function(a,b){this._setFormData(a,b)},opened:function(a,b){this._setFormFocus(b)},remove:function(){this._remove(this.$image)},save:function(a,b){this._save(a,
b)}}},onimage:{observe:function(){this._observeImages()},resized:function(){this.justResized=!0}},oncontextbar:function(a,b){if(this.justResized)this.justResized=!1;else{var c=this.selection.getCurrent();c=this.inspector.parse(c);if(!c.isFigcaption()&&c.isComponentType("image")){c=c.getComponent();var e={edit:{title:this.lang.get("edit"),api:"module.image.open"},remove:{title:this.lang.get("delete"),api:"module.image.remove",args:c}};b.set(a,c,e)}}},open:function(){this.$image=this._getCurrent();
this.app.api("module.modal.build",this._getModalData())},insert:function(a){this._insert(a)},remove:function(a){this._remove(a)},_getModalData:function(){return this._isImage()&&this.opts.imageEditable?{name:"imageedit",width:"800px",title:this.lang.get("edit"),handle:"save",commands:{save:{title:this.lang.get("save")},remove:{title:this.lang.get("delete"),type:"danger"},cancel:{title:this.lang.get("cancel")}}}:{name:"image",title:this.lang.get("image")}},_isImage:function(){return this.$image},_getCurrent:function(){var a=
this.selection.getCurrent();a=this.inspector.parse(a);return!(!a.isComponentType("image")||!a.isComponentActive())&&this.component.create("image",a.getComponent())},_insert:function(a,b){if(this.app.api("module.modal.close"),Array.isArray(a)){for(var c={},e=0;e<a.length;e++)c=l.extend(c,a[e]);a=c}else"string"==typeof a&&(a={file:{url:a}});"object"==typeof a&&(1<Object.keys(a).length?this._insertMultiple(a,b):this._insertSingle(a,b))},_insertSingle:function(a,b){for(var c in a){var e=this._createImageAndStore(a[c]);
e=b?this.insertion.insertToPoint(b,e):this.insertion.insertHtml(e);this._removeSpaceBeforeFigure(e[0]);this.component.setActive(e[0]);this.app.broadcast("image.uploaded",e[0],a)}},_insertMultiple:function(a,b){var c=0,e=[],d;for(d in a){c++;var f=this._createImageAndStore(a[d]);1===c?e=b?this.insertion.insertToPoint(b,f):this.insertion.insertHtml(f):(l.dom(e[0]).after(f),e=[f.get()],this.app.broadcast("image.inserted",f));f=e[0];this._removeSpaceBeforeFigure(e[0]);this.app.broadcast("image.uploaded",
e[0],a)}this.component.setActive(f)},_createImageAndStore:function(a){var b=this.component.create("image");return b.addClass("redactor-uploaded-figure"),b.setData({src:a.url,id:a.id?a.id:this.utils.getRandomId()}),this.storage.add("image",b.getElement()),b},_removeSpaceBeforeFigure:function(a){a&&(a=a.previousSibling)&&(this._removeInvisibleSpace(a),this._removeInvisibleSpace(a.previousSibling))},_removeInvisibleSpace:function(a){a&&3===a.nodeType&&-1!==this.utils.searchInvisibleChars(a.textContent)&&
a.parentNode.removeChild(a)},_save:function(a,b){a=b.getData();b={title:a.title,link:{url:a.url,target:a.target}};this.opts.imageCaption&&(b.caption=a.caption);this.opts.imagePosition&&(b.align=a.align);this.$image.setData(b);this.resizer&&this.resizer.rebuild();this.app.broadcast("image.changed",this.$image);this.app.api("module.modal.close")},_change:function(a,b){if("string"==typeof a&&(a={file:{url:a}}),"object"==typeof a){var c,e;for(e in a){(c=l.dom("<img>")).attr("src",a[e].url);this.$image.changeImage(a[e]);
this.app.broadcast("image.changed",this.$image,a);this.app.broadcast("image.uploaded",this.$image,a);break}!1!==b&&c.on("load",function(){this.$previewBox.html(c)}.bind(this))}},_uploadError:function(a){this.app.broadcast("image.uploadError",a)},_remove:function(a){this.app.api("module.modal.close");this.component.remove(a)},_observeImages:function(){var a=this;this.editor.getElement().find("img").each(function(b){var c=l.dom(b);c.off(".drop-to-replace");c.on("dragover.drop-to-replace dragenter.drop-to-replace",
function(a){a.preventDefault()});c.on("drop.drop-to-replace",function(b){if(!a.app.isDragComponentInside())return a._setReplaceUpload(b,c)})})},_setFormData:function(a,b){this._buildPreview();this._buildPreviewUpload();var c=this.$image.getData(),e={title:c.title};this.opts.imageCaption?e.caption=c.caption:a.find(".form-item-caption").hide();this.opts.imagePosition?e.align=c.align:a.find(".form-item-align").hide();c.link&&(e.url=c.link.url,c.link.target&&(e.target=!0));b.setData(e)},_setFormFocus:function(a){a.getField("title").focus()},
_setReplaceUpload:function(a,b){if((a=a.originalEvent||a).stopPropagation(),a.preventDefault(),this.opts.imageUpload)this.$image=this.component.create("image",b),this.app.api("module.upload.send",{url:this.opts.imageUpload,files:a.dataTransfer.files,name:"imagereplace",data:this.opts.imageData})},_setUpload:function(a){a={url:this.opts.imageUpload,element:a.getField("file"),name:"image",data:this.opts.imageData,paramName:this.opts.imageUploadParam};this.app.api("module.upload.build",a)},_buildPreview:function(){this.$preview=
l.dom("#redactor-modal-image-preview");var a=this.$image.getData(),b=l.dom("<img>");b.attr("src",a.src);this.$previewBox=l.dom("<div>");this.$previewBox.append(b);this.$preview.html("");this.$preview.append(this.$previewBox)},_buildPreviewUpload:function(){if(this.opts.imageUpload){var a=l.dom('<div class="desc">');a.html("Drop a new image to change");this.$preview.append(a);this.app.api("module.upload.build",{url:this.opts.imageUpload,element:this.$previewBox,name:"imageedit"})}}});l.add("class",
"image.component",{mixins:["dom","component"],init:function(a,b){return this.app=a,this.opts=a.opts,this.selection=a.selection,b&&void 0!==b.cmnt?b:this._init(b)},setData:function(a){for(var b in a)this._set(b,a[b])},getData:function(){for(var a="src title caption align link id".split(" "),b={},c=0;c<a.length;c++)b[a[c]]=this._get(a[c]);return b},getElement:function(){return this.$element},changeImage:function(a){this.$element.attr("src",a.url)},_init:function(a){var b=l.dom(a),c=b.closest("figure");
void 0===a?(this.$element=l.dom("<img>"),this.parse("<figure>"),this.append(this.$element)):0===c.length?(this.parse("<figure>"),this.$element=b,this.$element.wrap(this)):(this.parse(c),this.$element=this.find("img"));this._initWrapper()},_set:function(a,b){this["_set_"+a](b)},_get:function(a){return this["_get_"+a]()},_set_src:function(a){this.$element.attr("src",a)},_set_id:function(a){this.$element.attr("data-image",a)},_set_title:function(a){""===(a=a.trim().replace(/(<([^>]+)>)/gi,""))?(this.$element.removeAttr("alt"),
this.$element.removeAttr("title")):(this.$element.attr("alt",a),this.$element.attr("title",a))},_set_caption:function(a){var b=this.find("figcaption");return 0===b.length&&((b=l.dom("<figcaption>")).attr("contenteditable","true"),this.append(b)),""===a?b.remove():b.html(a),b},_set_align:function(a){var b="",c="",e="";if("object"==typeof this.opts.imagePosition){b=this.opts.imagePosition;for(var d in b)this.removeClass(b[d]);(a=void 0!==b[a]&&b[a])&&this.addClass(a)}else{switch(a){case "left":b="left";
c="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case "right":b="right";c="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case "center":e="center"}this.css({float:b,margin:c,"text-align":e});this.attr("rel",this.attr("style"))}},_set_link:function(a){var b=this._findLink();if(""!==a.url)return b||(b=l.dom("<a>"),this.$element.wrap(b)),b.attr("href",a.url),a.target?b.attr("target",a.target):b.removeAttr("target"),b;b&&b.unwrap()},_get_src:function(){return this.$element.attr("src")},
_get_id:function(){return this.$element.attr("data-image")},_get_title:function(){var a=this.$element.attr("alt"),b=this.$element.attr("title");return a||b||""},_get_caption:function(){var a=this.find("figcaption");return 0===a.length?"":a.html()},_get_align:function(){if("object"==typeof this.opts.imagePosition){var a="none";var b=this.opts.imagePosition,c;for(c in b)if(this.hasClass(b[c])){a=c;break}}else a="center"===this.css("text-align")?"center":this.css("float");return a},_get_link:function(){var a=
this._findLink();if(a){var b=!!a.attr("target");return{url:a.attr("href"),target:b}}},_initWrapper:function(){this.addClass("redactor-component");this.attr({"data-redactor-type":"image",tabindex:"-1",contenteditable:!1})},_findLink:function(){var a=this.find("a").filter(function(a){return 0===l.dom(a).closest("figcaption").length});return 0!==a.length&&a}});l.add("class","image.resize",{init:function(a){this.app=a;this.$doc=a.$doc;this.$win=a.$win;this.$body=a.$body;this.editor=a.editor;this.toolbar=
a.toolbar;this.inspector=a.inspector;this.$target=this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$body;this._init()},rebuild:function(){this._setResizerPosition()},hide:function(){this.$target.find("#redactor-image-resizer").remove()},stop:function(){this.editor.getElement().off(".redactor.image-resize");this.$doc.off(".redactor.image-resize");this.$win.off("resize.redactor.image-resize");this.hide()},_init:function(){this.editor.getElement().on("click.redactor.image-resize",this._build.bind(this));
this.$win.on("resize.redactor.image-resize",this._setResizerPosition.bind(this))},_build:function(a){this.$target.find("#redactor-image-resizer").remove();a=this.inspector.parse(a.target);var b=this.editor.getElement();a.isComponentType("image")&&(this.$resizableBox=b,this.$resizableImage=l.dom(a.getImageElement()),this.$resizer=l.dom("<span>"),this.$resizer.attr("id","redactor-image-resizer"),this.$target.append(this.$resizer),this._setResizerPosition(),this.$resizer.on("mousedown touchstart",this._set.bind(this)))},
_setResizerPosition:function(){if(this.$resizer){var a=this.toolbar.isTarget(),b=this.$target.offset(),c=a?7-b.top+this.$target.scrollTop():7;a=a?7-b.left:7;b=this.$resizableImage.offset();var d=this.$resizableImage.width(),f=this.$resizableImage.height(),g=this.$resizer.width(),l=this.$resizer.height();this.$resizer.css({top:b.top+f-l+c+"px",left:b.left+d-g+a+"px"})}},_set:function(a){a.preventDefault();this.resizeHandle={x:a.pageX,y:a.pageY,el:this.$resizableImage,ratio:this.$resizableImage.width()/
this.$resizableImage.height(),h:this.$resizableImage.height()};(a=a.originalEvent||a).targetTouches&&(this.resizeHandle.x=a.targetTouches[0].pageX,this.resizeHandle.y=a.targetTouches[0].pageY);this.app.broadcast("contextbar.close");this.app.broadcast("image.resize",this.$resizableImage);this._start()},_start:function(){this.$doc.on("mousemove.redactor.image-resize touchmove.redactor.image-resize",this._move.bind(this));this.$doc.on("mouseup.redactor.image-resize touchend.redactor.image-resize",this._stop.bind(this))},
_stop:function(){this.$doc.off(".redactor.image-resize");this.app.broadcast("image.resized",this.$resizableImage)},_move:function(a){a.preventDefault();a=a.originalEvent||a;var b=this.resizeHandle.h;a.targetTouches?b+=a.targetTouches[0].pageY-this.resizeHandle.y:b+=a.pageY-this.resizeHandle.y;a=b*this.resizeHandle.ratio;50>b||100>a||this._getResizableBoxWidth()<=a||(this.resizeHandle.el.attr({width:a,height:b}),this.resizeHandle.el.width(a),this.resizeHandle.el.height(b),this._setResizerPosition())},
_getResizableBoxWidth:function(){return this.$resizableBox.width()-parseInt(this.$resizableBox.css("padding-left"))-parseInt(this.$resizableBox.css("padding-right"))}});l.add("module","file",{modals:{file:'<div class="redactor-modal-tab" data-title="## upload ##"><form action="">                 <div class="form-item form-item-title">                     <label for="modal-file-title"> ## filename ## <span class="desc">(## optional ##)</span></label>                     <input type="text" id="modal-file-title" name="title" />                 </div>                 <input type="file" name="file">             </form></div>'},
init:function(a){this.app=a;this.opts=a.opts;this.lang=a.lang;this.caret=a.caret;this.utils=a.utils;this.storage=a.storage;this.component=a.component;this.inspector=a.inspector;this.insertion=a.insertion;this.selection=a.selection},onstarted:function(){this.storage.observeFiles()},ondropfile:function(a,b,c){this.opts.fileUpload&&this.app.api("module.upload.send",{url:this.opts.fileUpload,event:!c&&a,files:b,name:"filedrop",data:this.opts.fileData})},onmodal:{file:{open:function(a,b){this._setFormData(a,
b);this._setUpload(b)},opened:function(a,b){this._setFormFocus(b);this.$form=b}}},onupload:{file:{complete:function(a){this._insert(a)},error:function(a){this._uploadError(a)}},filedrop:{complete:function(a,b){this._insert(a,b)},error:function(a){this._uploadError(a)}}},oncontextbar:function(a,b){var c=this.selection.getCurrent();c=this.inspector.parse(c);if(c.isFile()){c=c.getFile();var e={remove:{title:this.lang.get("delete"),api:"module.file.remove",args:c}};b.set(a,c,e,"bottom")}},open:function(){this._open()},
insert:function(a){this._insert(a)},remove:function(a){this._remove(a)},_open:function(){this.app.api("module.modal.build",this._getModalData())},_getModalData:function(){return{name:"file",title:this.lang.get("file")}},_insert:function(a,b){if(this.app.api("module.modal.close"),"object"==typeof a){if(Array.isArray(a)){for(var c={},e=0;e<a.length;e++)c=l.extend(c,a[e]);a=c}1<Object.keys(a).length?this._insertMultiple(a,b):this._insertSingle(a,b);this.$form=!1}},_insertSingle:function(a,b){var c;for(c in a){var e=
this._createFileAndStore(a[c]);e=this.opts.fileAttachment?this._insertAsAttachment(e):b?this.insertion.insertToPoint(b,e):this.insertion.insertRaw(e);this.app.broadcast("file.uploaded",e[0],a)}},_insertMultiple:function(a,b){var c=0,e=[],d;for(d in a){c++;var f=this._createFileAndStore(a[d]);this.opts.fileAttachment?e=this._insertAsAttachment(f,a):1===c?e=b?this.insertion.insertToPoint(b,f):this.insertion.insertRaw(f):(l.dom(e[0]).after(f),e=[f.get()],this.app.broadcast("file.inserted",f));this.app.broadcast("file.uploaded",
e[0],a)}this.opts.fileAttachment||this.caret.setAfter(f)},_insertAsAttachment:function(a,b){var c=l.dom(this.opts.fileAttachment);a=a.wrapAttachment();c.append(a);c=[a.get()];return this.app.broadcast("file.appended",c[0],b),c},_createFileAndStore:function(a){var b=!!this.$form&&this.$form.getData(),c=a.name?a.name:a.url;b=!this.opts.fileAttachment&&b&&""!==b.title?b.title:this._truncateUrl(c);c=this.component.create("file");return c.attr("href",a.url),c.attr("data-file",a.id?a.id:this.utils.getRandomId()),
c.attr("data-name",a.name),c.html(b),this.storage.add("file",c),c},_remove:function(a){this.selection.save();a=this.component.create("file",a);!1!==this.app.broadcast("file.delete",a)?(a.unwrap(),this.selection.restore(),this.app.broadcast("file.deleted",a)):this.selection.restore()},_truncateUrl:function(a){return-1!==a.search(/^http/)&&20<a.length?a.substring(0,20)+"...":a},_setUpload:function(a){a={url:this.opts.fileUpload,element:a.getField("file"),name:"file",data:this.opts.fileData,paramName:this.opts.fileUploadParam};
this.app.api("module.upload.build",a)},_setFormData:function(a,b){this.opts.fileAttachment?a.find(".form-item-title").hide():b.setData({title:this.selection.getText()})},_setFormFocus:function(a){a.getField("title").focus()},_uploadError:function(a){this.app.broadcast("file.uploadError",a)}});l.add("class","file.component",{mixins:["dom","component"],init:function(a,b){return this.app=a,this.opts=a.opts,b&&void 0!==b.cmnt?b:this._init(b)},wrapAttachment:function(){return this.$wrapper=l.dom('<span class="redactor-file-item">'),
this.$remover=l.dom('<span class="redactor-file-remover">'),this.$remover.html("&times;"),this.$remover.on("click",this.removeAttachment.bind(this)),this.$wrapper.append(this),this.$wrapper.append(this.$remover),this.$wrapper},removeAttachment:function(a){a.preventDefault();!1!==this.app.broadcast("file.delete",this,this.$wrapper)&&(this.$wrapper.remove(),this.app.broadcast("file.deleted",this),this.app.broadcast("file.removeAttachment",this))},_init:function(a){void 0===a?this.parse("<a>"):(a=l.dom(a).closest("a"),
this.parse(a))}});l.add("module","buffer",{init:function(a){this.app=a;this.opts=a.opts;this.editor=a.editor;this.offset=a.offset;this.keycodes=a.keycodes;this.selection=a.selection;this.savedOffset=this.savedHtml=this.keyPressed=this.passed=this.state=!1;this.undoStorage=[];this.redoStorage=[]},onkeydown:function(a){this._listen(a)},onsyncing:function(){this.keyPressed||this.trigger();this.keyPressed=!1},onstate:function(a,b,c){a&&(a.ctrlKey||a.metaKey)||a&&(this._isUndo(a)||this._isRedo(a))||(this.passed=
!1,this._saveState(b,c))},onenable:function(){this.clear()},clear:function(){this.state=!1;this.undoStorage=[];this.redoStorage=[]},undo:function(){this._getUndo()},redo:function(){this._getRedo()},trigger:function(){this.state&&!1===this.passed&&this._setUndo()},_saveState:function(a,b){var c=this.editor.getElement();this.state={html:a||c.html(),offset:b||this.offset.get()}},_listen:function(a){var b=a.which,c=a.ctrlKey||a.metaKey,e=c||a.shiftKey||a.altKey,d=[this.keycodes.SPACE,this.keycodes.ENTER,
this.keycodes.BACKSPACE,this.keycodes.DELETE,this.keycodes.TAB,this.keycodes.LEFT,this.keycodes.RIGHT,this.keycodes.UP,this.keycodes.DOWN];return this._isUndo(a)?(a.preventDefault(),void this.undo()):this._isRedo(a)?(a.preventDefault(),void this.redo()):((c||-1===d.indexOf(b))&&(!c||88!==b&&67!==b)||(e=!0,this.trigger()),e||this._hasUndo()||this.trigger(),void(this.keyPressed=!0))},_isUndo:function(a){var b=a.which;return(a.ctrlKey||a.metaKey)&&90===b&&!a.shiftKey&&!a.altKey},_isRedo:function(a){var b=
a.which;return(a.ctrlKey||a.metaKey)&&(90===b&&a.shiftKey||89===b&&!a.shiftKey)&&!a.altKey},_setUndo:function(){var a=this.undoStorage[this.undoStorage.length-1];void 0!==a&&a[0]===this.state.html||(this.undoStorage.push([this.state.html,this.state.offset]),this._removeOverStorage())},_setRedo:function(){var a=this.editor.getElement(),b=this.offset.get();a=a.html();this.redoStorage.push([a,b]);this.redoStorage=this.redoStorage.slice(0,this.opts.bufferLimit)},_getUndo:function(){if(this._hasUndo()){this.passed=
!0;var a=this.editor.getElement(),b=this.undoStorage.pop();this._setRedo();a.html(b[0]);this.offset.set(b[1]);this.selection.restore();this.app.broadcast("undo",b[0],b[1])}},_getRedo:function(){if(this._hasRedo()){this.passed=!0;var a=this.editor.getElement(),b=this.redoStorage.pop();this._setUndo();a.html(b[0]);this.offset.set(b[1]);this.app.broadcast("redo",b[0],b[1])}},_removeOverStorage:function(){this.undoStorage.length>this.opts.bufferLimit&&(this.undoStorage=this.undoStorage.slice(0,this.undoStorage.length-
this.opts.bufferLimit))},_hasUndo:function(){return 0!==this.undoStorage.length},_hasRedo:function(){return 0!==this.redoStorage.length}});l.add("module","list",{init:function(a){this.app=a;this.opts=a.opts;this.utils=a.utils;this.block=a.block;this.toolbar=a.toolbar;this.inspector=a.inspector;this.selection=a.selection},onbutton:{list:{observe:function(a){this._observeButton(a)}}},ondropdown:{list:{observe:function(a){this._observeDropdown(a)}}},toggle:function(a){this.selection.saveMarkers();var b=
this._getBlocks(),c=this.selection.getBlock();c=l.dom(c).parents("ul, ol",".redactor-in").last();return 0===b.length&&0!==c.length&&(b=[c.get()]),b=0!==b.length&&this._isUnformat(a,b)?this._unformat(a,b):this._format(a,b),this.selection.restoreMarkers(),b},indent:function(){var a=this.selection.isCollapsed(),b=this.selection.getCurrent();b=this.inspector.parse(b);var c=!!b.isList()&&b.getListItem();b=l.dom(c);var d=b.prevElement();d=d.get();a&&c&&d&&"LI"===d.tagName&&(this.selection.saveMarkers(),
a=(d=l.dom(d)).children("ul, ol"),c=b.closest("ul, ol"),0!==a.length?a.append(b):(a=c.get().tagName.toLowerCase(),a=l.dom("<"+a+">"),a.append(b),d.append(a)),this.selection.restoreMarkers())},outdent:function(){var a=this.selection.isCollapsed(),b=this.selection.getCurrent();b=this.inspector.parse(b);var c=!!b.isList()&&b.getListItem();b=l.dom(c);if(a&&c){var d;a=b.parent();c=a.closest("li");var f=b.prevElement();var g=b.nextElement();f=f.get();var m=g.get();g=!1===f;var n=!1!==f&&!1!==m;m=!g&&!1===
m;if(this.selection.saveMarkers(),0!==c.length)if(n){g=this._getAllNext(b.get());n=l.dom("<"+a.get().tagName.toLowerCase()+">");for(m=0;m<g.length;m++)n.append(g[m]);c.after(b);b.append(n)}else c.after(b),0===a.children().length?a.remove():g&&b.append(a);else{c=this._createUnformatContainer(b);f=c.find("ul, ol").first();if(g)a.before(c);else if(m)a.after(c);else if(n){n=l.dom("<"+a.get().tagName.toLowerCase()+">");g=this._getAllNext(b.get());for(m=0;m<g.length;m++)n.append(g[m]);a.after(c);c.after(n)}0!==
f.length&&((d=c.nextElement().get())&&d.tagName===a.get().tagName?(l.dom(d).prepend(f),f.unwrap()):c.after(f));b.remove()}this.selection.restoreMarkers()}},_getAllNext:function(a){for(var b=[];a&&(a=l.dom(a).nextElement().get());)b.push(a);return b},_isUnformat:function(a,b){for(var c=0,e=0;e<b.length;e++)if(3!==b[e].nodeType){var d=b[e].tagName.toLowerCase();d!==a&&"figure"!==d||c++}return c===b.length},_format:function(a,b){b=this._uniteBlocks(b,"p div blockquote pre h1 h2 h3 h4 h5 h6 ul ol".split(" "));
var c=[],e;for(e in b){for(var d=b[e],f=this._createList(a,b[e]),g=0;g<d.length;g++)if(3===d[g].nodeType||"UL"!==d[g].tagName&&"OL"!==d[g].tagName){var m=this._createListItem(d[g]);this.utils.normalizeTextNodes(m);f.append(m)}else{var n=l.dom(d[g]);m=n.contents();f.append(m);this.utils.isEmpty(n)&&n.remove()}c.push(f.get())}return c},_uniteBlocks:function(a,b){for(var c=0,e={0:[]},d=!1,f=0;f<a.length;f++){var g=l.dom(a[f]).closest("th, td");0!==g.length?(g.get()!==d&&(e[++c]=[]),this._isUniteBlock(a[f],
b)&&e[c].push(a[f])):this._isUniteBlock(a[f],b)?e[c].push(a[f]):e[++c]=[];d=g.get()}return e},_isUniteBlock:function(a,b){return 3===a.nodeType||-1!==b.indexOf(a.tagName.toLowerCase())},_createList:function(a,b){b=l.dom(b[b.length-1]);a=l.dom("<"+a+">");return b.after(a),a},_createListItem:function(a){var b=l.dom("<li>");3===a.nodeType?b.append(a):(a=l.dom(a),b.append(a.contents()),a.remove());return b},_unformat:function(a,b){if(1===b.length){a=l.dom(b[0]);var c=a.find("li"),e=this.selection.getNodes({tags:["li"]}),
d=this.selection.getBlock();d=l.dom(d).closest("li");if(0===e.length&&0!==d.length&&(e=[d.get()]),e.length===c.length)return this._unformatEntire(b[0]);b=this._getItemsPosition(c,e);if("Top"===b)return this._unformatAtSide("before",e,a);if("Bottom"===b)return e.reverse(),this._unformatAtSide("after",e,a);if("Middle"===b){var f=l.dom(e[e.length-1]),g=!1,m=!1,n=l.dom("<"+a.get().tagName.toLowerCase()+">");c.each(function(a){if(g){var b=l.dom(a);0!==b.closest(".redactor-split-item").length||!1!==m&&
0!==b.closest(m).length||b.addClass("redactor-split-item");m=b}a===f.get()&&(g=!0)});c.filter(".redactor-split-item").each(function(a){l.dom(a).removeClass("redactor-split-item");n.append(a)});a.after(n);e.reverse();for(c=0;c<e.length;c++)b=l.dom(e[c]),d=this._createUnformatContainer(b),a.after(d),d.find("ul, ol").remove(),b.remove()}}else for(c=0;c<b.length;c++)3!==b[c].nodeType&&b[c].tagName.toLowerCase()===a&&this._unformatEntire(b[c])},_unformatEntire:function(a){var b=l.dom(a);b.find("li").each(function(a){a=
l.dom(a);var c=this._createUnformatContainer(a);a.remove();b.before(c)}.bind(this));b.remove()},_unformatAtSide:function(a,b,c){for(var e=0;e<b.length;e++){var d=l.dom(b[e]),f=this._createUnformatContainer(d);c[a](f);f=f.find("ul, ol").first();d.append(f);f.each(function(a){a=l.dom(a);var c=a.closest("li");c.get()===b[e]&&(a.unwrap(),c.addClass("r-unwrapped"))});this.utils.isEmptyHtml(d.html())&&d.remove()}c.find(".r-unwrapped").each(function(a){a=l.dom(a);""===a.html().trim()?a.remove():a.removeClass("r-unwrapped")})},
_getItemsPosition:function(a,b){var c="Middle",e=b[0];b=b[b.length-1];var d=a.first().get();a=a.last().get();return d===e&&a!==b?c="Top":d!==e&&a===b&&(c="Bottom"),c},_createUnformatContainer:function(a){var b=l.dom("<"+this.opts.markup+">");return this.opts.breakline&&b.attr("data-redactor-tag","br"),b.append(a.contents()),b},_getBlocks:function(){return this.selection.getBlocks({first:!0})},_observeButton:function(){var a=this.selection.getCurrent();a=this.inspector.parse(a);a=a.isPre()||a.isCode()||
a.isFigcaption();this._observeButtonsList(a,["lists","ul","ol","outdent","indent"]);a=this.toolbar.getButton("outdent");var b=this.toolbar.getButton("indent");this._observeIndent(b,a)},_observeDropdown:function(a){var b=a.getItem("outdent");a=a.getItem("indent");this._observeIndent(a,b)},_observeIndent:function(a,b){var c=this.selection.isCollapsed(),e=this.selection.getCurrent();e=this.inspector.parse(e);e=!!e.isList()&&e.getListItem();var d=l.dom(e).prevElement().get();d=c&&e&&d&&"LI"===d.tagName;
b&&(e&&c?b.enable():b.disable());a&&(e&&d?a.enable():a.disable())},_observeButtonsList:function(a,b){for(var c=0;c<b.length;c++){var e=this.toolbar.getButton(b[c]);e&&(a?e.disable():e.enable())}}});window.Redactor=window.$R=l;window.addEventListener("load",function(){l("[data-redactor]")})}();
(function(a){a.add("plugin","alignment",{translations:{en:{align:"Align","align-left":"Align Left","align-center":"Align Center","align-right":"Align Right","align-justify":"Align Justify"}},init:function(a){this.app=a;this.lang=a.lang;this.block=a.block;this.toolbar=a.toolbar},start:function(){var a={};a.left={title:this.lang.get("align-left"),api:"plugin.alignment.set",args:"left"};a.center={title:this.lang.get("align-center"),api:"plugin.alignment.set",args:"center"};a.right={title:this.lang.get("align-right"),
api:"plugin.alignment.set",args:"right"};a.justify={title:this.lang.get("align-justify"),api:"plugin.alignment.set",args:"justify"};var d=this.toolbar.addButton("alignment",{title:this.lang.get("align")});d.setIcon('<i class="re-icon-alignment"></i>');d.setDropdown(a)},set:function(a){if("left"===a)return this._remove();this.block.toggle({style:{"text-align":a}})},_remove:function(){this.block.remove({style:"text-align"})}})})(Redactor);
(function(a){a.add("plugin","bufferbuttons",{translations:{en:{undo:"Undo",redo:"Redo"}},init:function(a){this.app=a;this.lang=a.lang;this.toolbar=a.toolbar},start:function(){var a={title:this.lang.get("undo"),icon:'<i class="re-icon-undo"></i>',api:"module.buffer.undo"},d={title:this.lang.get("redo"),icon:'<i class="re-icon-redo"></i>',api:"module.buffer.redo"};this.toolbar.addButtonFirst("undo",a);this.toolbar.addButtonAfter("undo","redo",d)}})})(Redactor);
(function(a){a.add("plugin","clips",{translations:{en:{clips:"Clips","clips-select":"Please, select a clip"}},modals:{clips:""},init:function(a){this.app=a;this.opts=a.opts;this.lang=a.lang;this.toolbar=a.toolbar;this.insertion=a.insertion},onmodal:{clips:{open:function(a){this._build(a)}}},start:function(){if(this.opts.clips){var a={title:this.lang.get("clips"),api:"plugin.clips.open"};this.toolbar.addButton("clips",a).setIcon('<i class="re-icon-clips"></i>')}},open:function(a){a={title:this.lang.get("clips"),
width:"600px",name:"clips"};this.app.api("module.modal.build",a)},_build:function(a){a=a.getBody();var b=this._buildLabel(),c=this._buildList();this._buildItems(c);a.html("");a.append(b);a.append(c)},_buildLabel:function(){var b=a.dom("<label>");b.html(this.lang.parse("## clips-select ##:"));return b},_buildList:function(){var b=a.dom("<ul>");b.addClass("redactor-clips-list");return b},_buildItems:function(b){for(var d=this.opts.clips,c=0;c<d.length;c++){var f=a.dom("<li>"),g=a.dom("<span>");g.attr("data-index",
c);g.html(d[c][0]);g.on("click",this._insert.bind(this));f.append(g);b.append(f)}},_insert:function(b){b=a.dom(b.target).attr("data-index");b=this.opts.clips[b][1];this.app.api("module.modal.close");this.insertion.insertRaw(b)}})})(Redactor);
(function(a){a.add("plugin","counter",{translations:{en:{words:"words",chars:"chars"}},init:function(a){this.app=a;this.lang=a.lang;this.utils=a.utils;this.editor=a.editor;this.statusbar=a.statusbar},start:function(){this.editor.getElement().on("keyup.redactor-plugin-counter",this.count.bind(this));this.count()},stop:function(){this.editor.getElement().off(".redactor-plugin-counter");this.statusbar.removeItem("words");this.statusbar.removeItem("chars")},count:function(){var a=0,d=0,c=0,f=this.editor.getElement().html();
f=this._clean(f);""!==f&&(a=f.split(/\s+/),d=f.match(/\s/g),a=a?a.length:0,c=d?d.length:0,d=f.length);f={words:a,characters:d,spaces:c};this.app.broadcast("counter",f);this.statusbar.add("words",this.lang.get("words")+": "+f.words);this.statusbar.add("chars",this.lang.get("chars")+": "+f.characters)},_clean:function(a){a=a.replace(/<\/(.*?)>/gi," ");a=a.replace(/<(.*?)>/gi,"");a=a.replace(/\t/gi,"");a=a.replace(/\n/gi," ");a=a.replace(/\r/gi," ");a=a.replace(/&nbsp;/g,"1");a=a.trim();return a=this.utils.removeInvisibleChars(a)}})})(Redactor);
(function(a){a.add("plugin","definedlinks",{init:function(a){this.app=a;this.opts=a.opts;this.component=a.component;this.links=[]},onmodal:{link:{open:function(a,d){this.opts.definedlinks&&(this.$modal=a,this.$form=d,this._load())}}},_load:function(){"object"===typeof this.opts.definedlinks?this._build(this.opts.definedlinks):a.ajax.get({url:this.opts.definedlinks,success:this._parse.bind(this)})},_parse:function(a){this._build(JSON.parse(a))},_build:function(b){var d=this.$modal.find("#redactor-defined-links");
if(0===d.length){var c=this.$modal.getBody(),f=a.dom('<div class="form-item" />');d=a.dom('<select id="redactor-defined-links" />');f.append(d);c.prepend(f)}this.links=[];d.html("");d.off("change");for(var g in b)this.links[g]=b[g],c=a.dom("<option>"),c.val(g),c.html(b[g].name),d.append(c);d.on("change",this._select.bind(this))},_select:function(b){var d=this.$form.getData();b=a.dom(b.target).val();var c={text:"",url:""};"0"!==b&&(c.text=this.links[b].name,c.url=this.links[b].url);""!==d.text&&(c=
{url:c.url});this.$form.setData(c)}})})(Redactor);
(function(a){a.add("plugin","filemanager",{translations:{en:{choose:"Choose"}},init:function(a){this.app=a;this.lang=a.lang;this.opts=a.opts},onmodal:{file:{open:function(a,d){this.opts.fileManagerJson&&this._load(a)}}},_load:function(b){b=b.getBody();this.$box=a.dom("<div>");this.$box.attr("data-title",this.lang.get("choose"));this.$box.addClass("redactor-modal-tab");this.$box.hide();this.$box.css({overflow:"auto",height:"300px","line-height":1});b.append(this.$box);a.ajax.get({url:this.opts.fileManagerJson,
success:this._parse.bind(this)})},_parse:function(b){var d=a.dom('<ul id="redactor-filemanager-list">'),c;for(c in b){var f=b[c];if("object"===typeof f){var g=a.dom("<li>"),m=a.dom("<a>");m.attr("href","#");m.addClass("redactor-file-manager-link");m.attr("data-params",encodeURI(JSON.stringify(f)));m.text(f.title||f.name);m.on("click",this._insert.bind(this));var l=a.dom("<span>");l.addClass("r-file-name");l.text(f.name);m.append(l);l=a.dom("<span>");l.addClass("r-file-size");l.text("("+f.size+")");
m.append(l);g.append(m);d.append(g)}}this.$box.append(d)},_insert:function(b){b.preventDefault();b=a.dom(b.target).closest(".redactor-file-manager-link");b=JSON.parse(decodeURI(b.attr("data-params")));this.app.api("module.file.insert",{file:b})}})})(Redactor);
(function(a){a.add("plugin","fontcolor",{translations:{en:{fontcolor:"Text Color",text:"Text",highlight:"Highlight"}},init:function(a){this.app=a;this.opts=a.opts;this.lang=a.lang;this.inline=a.inline;this.toolbar=a.toolbar;this.selection=a.selection;this.colors=this.opts.fontcolors?this.opts.fontcolors:"#ffffff #000000 #eeece1 #1f497d #4f81bd #c0504d #9bbb59 #8064a2 #4bacc6 #f79646 #ffff00 #f2f2f2 #7f7f7f #ddd9c3 #c6d9f0 #dbe5f1 #f2dcdb #ebf1dd #e5e0ec #dbeef3 #fdeada #fff2ca #d8d8d8 #595959 #c4bd97 #8db3e2 #b8cce4 #e5b9b7 #d7e3bc #ccc1d9 #b7dde8 #fbd5b5 #ffe694 #bfbfbf #3f3f3f #938953 #548dd4 #95b3d7 #d99694 #c3d69b #b2a2c7 #b7dde8 #fac08f #f2c314 #a5a5a5 #262626 #494429 #17365d #366092 #953734 #76923c #5f497a #92cddc #e36c09 #c09100 #7f7f7f #0c0c0c #1d1b10 #0f243e #244061 #632423 #4f6128 #3f3151 #31859b #974806 #7f6000".split(" ")},
onfontcolor:{set:function(a,d){this._set(a,d)},remove:function(a){this._remove(a)}},start:function(){var a={title:this.lang.get("fontcolor")},d=this._buildDropdown();this.$button=this.toolbar.addButton("fontcolor",a);this.$button.setIcon('<i class="re-icon-fontcolor"></i>');this.$button.setDropdown(d)},_buildDropdown:function(){var b=a.dom('<div class="redactor-dropdown-cells">');this.$selector=this._buildSelector();this.$selectorText=this._buildSelectorItem("text",this.lang.get("text"));this.$selectorText.addClass("active");
this.$selectorBack=this._buildSelectorItem("back",this.lang.get("highlight"));this.$selector.append(this.$selectorText);this.$selector.append(this.$selectorBack);this.$pickerText=this._buildPicker("textcolor");this.$pickerBack=this._buildPicker("backcolor");b.append(this.$selector);b.append(this.$pickerText);b.append(this.$pickerBack);this._buildSelectorEvents();b.width(242);return b},_buildSelector:function(){var b=a.dom("<div>");b.addClass("redactor-dropdown-selector");return b},_buildSelectorItem:function(b,
d){var c=a.dom("<span>");c.attr("rel",b).html(d);c.addClass("redactor-dropdown-not-close");return c},_buildSelectorEvents:function(){this.$selectorText.on("mousedown",function(a){a.preventDefault();this.$selector.find("span").removeClass("active");this.$pickerBack.hide();this.$pickerText.show();this.$selectorText.addClass("active")}.bind(this));this.$selectorBack.on("mousedown",function(a){a.preventDefault();this.$selector.find("span").removeClass("active");this.$pickerText.hide();this.$pickerBack.show();
this.$selectorBack.addClass("active")}.bind(this))},_buildPicker:function(b){for(var d=a.dom('<div class="re-dropdown-box-'+b+'">'),c="backcolor"==b?"background-color":"color",f=this.colors.length,g=this,m=function(b){b.preventDefault();b=a.dom(b.target);g._set(b.data("rule"),b.attr("rel"))},l=0;l<f;l++){var n=this.colors[l],q=a.dom("<span>");q.attr({rel:n,"data-rule":c});q.css({"background-color":n,"font-size":0,border:"2px solid #fff",width:"22px",height:"22px"});q.on("mousedown",m);d.append(q)}f=
a.dom("<a>");f.attr({href:"#"});f.css({display:"block",clear:"both",padding:"8px 5px","font-size":"12px","line-height":1});f.html(this.lang.get("none"));f.on("click",function(a){a.preventDefault();g._remove(c)});d.append(f);"backcolor"==b&&d.hide();return d},_set:function(a,d){var b={};b[a]=d;this.inline.format({tag:"span",style:b,type:"toggle"})},_remove:function(a){this.inline.remove({style:a})}})})(Redactor);
(function(a){a.add("plugin","fontsize",{translations:{en:{size:"Size","remove-size":"Remove Font Size"}},init:function(a){this.app=a;this.lang=a.lang;this.inline=a.inline;this.toolbar=a.toolbar;this.sizes=[10,11,12,14,16,18,20,24,28,30]},start:function(){for(var a={},d=0;d<this.sizes.length;d++){var c=this.sizes[d];a[d]={title:c+"px",api:"plugin.fontsize.set",args:c}}a.remove={title:this.lang.get("remove-size"),api:"plugin.fontsize.remove"};d=this.toolbar.addButton("fontsize",{title:this.lang.get("size")});
d.setIcon('<i class="re-icon-fontsize"></i>');d.setDropdown(a)},set:function(a){this.inline.format({tag:"span",style:{"font-size":a+"px"},type:"toggle"})},remove:function(){this.inline.remove({style:"font-size"})}})})(Redactor);
(function(a){a.add("plugin","fullscreen",{translations:{en:{fullscreen:"Fullscreen"}},init:function(a){this.app=a;this.opts=a.opts;this.lang=a.lang;this.$win=a.$win;this.$doc=a.$doc;this.$body=a.$body;this.editor=a.editor;this.toolbar=a.toolbar;this.container=a.container;this.selection=a.selection;this.isOpen=!1},start:function(){var b={title:this.lang.get("fullscreen"),api:"plugin.fullscreen.toggle"};this.toolbar.addButton("fullscreen",b).setIcon('<i class="re-icon-expand"></i>');this.$target=(this.isTarget=
this.opts.toolbarFixedTarget!==document)?a.dom(this.opts.toolbarFixedTarget):this.$body;this.opts.fullscreen&&this.toggle()},toggle:function(){return this.isOpen?this.close():this.open()},open:function(){this._createPlacemarker();this.selection.save();var b=this.container.getElement(),d=this.editor.getElement(),c=this.isTarget?a.dom("body, html"):this.$target;this.opts.toolbarExternal&&this._buildInternalToolbar();this.$target.prepend(b);this.$target.addClass("redactor-body-fullscreen");b.addClass("redactor-box-fullscreen");
this.isTarget&&b.addClass("redactor-box-fullscreen-target");c.css("overflow","hidden");this.opts.maxHeight&&d.css("max-height","");this.opts.minHeight&&d.css("min-height","");this._resize();this.$win.on("resize.redactor-plugin-fullscreen",this._resize.bind(this));this.$doc.scrollTop(0);this.toolbar.getButton("fullscreen").setIcon('<i class="re-icon-retract"></i>');this.selection.restore();this.isOpen=!0;this.opts.zindex=1051},close:function(){this.isOpen=!1;this.opts.zindex=!1;this.selection.save();
var b=this.container.getElement(),d=this.editor.getElement(),c=a.dom("body, html");this.opts.toolbarExternal&&this._buildExternalToolbar();this.$target.removeClass("redactor-body-fullscreen");this.$win.off("resize.redactor-plugin-fullscreen");c.css("overflow","");b.removeClass("redactor-box-fullscreen redactor-box-fullscreen-target");d.css("height","auto");this.opts.minHeight&&d.css("minHeight",this.opts.minHeight);this.opts.maxHeight&&d.css("maxHeight",this.opts.maxHeight);this.toolbar.getButton("fullscreen").setIcon('<i class="re-icon-expand"></i>');
this._removePlacemarker(b);this.selection.restore()},_resize:function(){var a=this.editor.getElement(),d=this.$win.height();a.height(d)},_buildInternalToolbar:function(){var a=this.toolbar.getWrapper(),d=this.toolbar.getElement();a.addClass("redactor-toolbar-wrapper");a.append(d);d.removeClass("redactor-toolbar-external");$container.prepend(a)},_buildExternalToolbar:function(){var b=this.toolbar.getWrapper(),d=this.toolbar.getElement();this.$external=a.dom(this.opts.toolbarExternal);d.addClass("redactor-toolbar-external");
this.$external.append(d);b.remove()},_createPlacemarker:function(){var b=this.container.getElement();this.$placemarker=a.dom("<span />");b.after(this.$placemarker)},_removePlacemarker:function(a){this.$placemarker.before(a);this.$placemarker.remove()}})})(Redactor);
(function(a){a.add("plugin","imagemanager",{translations:{en:{choose:"Choose"}},init:function(a){this.app=a;this.lang=a.lang;this.opts=a.opts},onmodal:{image:{open:function(a,d){this.opts.imageManagerJson&&this._load(a)}}},_load:function(b){b=b.getBody();this.$box=a.dom("<div>");this.$box.attr("data-title",this.lang.get("choose"));this.$box.addClass("redactor-modal-tab");this.$box.hide();this.$box.css({overflow:"auto",height:"300px","line-height":1});b.append(this.$box);a.ajax.get({url:this.opts.imageManagerJson,
success:this._parse.bind(this)})},_parse:function(b){for(var d in b){var c=b[d];if("object"===typeof c){var f=a.dom("<img>");f.attr("src",c.thumb?c.thumb:c.url);f.attr("data-params",encodeURI(JSON.stringify(c)));f.css({width:"96px",height:"72px",margin:"0 4px 2px 0",cursor:"pointer"});f.on("click",this._insert.bind(this));this.$box.append(f)}}},_insert:function(b){b.preventDefault();b=a.dom(b.target);b=JSON.parse(decodeURI(b.attr("data-params")));this.app.api("module.image.insert",{image:b})}})})(Redactor);
(function(a){a.add("plugin","inlinestyle",{translations:{en:{style:"Style"}},init:function(a){this.app=a;this.lang=a.lang;this.toolbar=a.toolbar;this.styles={marked:{title:"Marked",args:"mark"},code:{title:"Code",args:"code"},variable:{title:"Variable",args:"var"},shortcut:{title:"Shortcut",args:"kbd"},sup:{title:"Superscript",args:"sup"},sub:{title:"Subscript",args:"sub"}}},start:function(){var a={};for(c in this.styles){var d=this.styles[c];a[c]={title:d.title,api:"module.inline.format",args:d.args}}var c=
this.toolbar.addButtonAfter("format","inline",{title:this.lang.get("style")});c.setIcon('<i class="re-icon-inline"></i>');c.setDropdown(a)}})})(Redactor);
(function(a){a.add("plugin","limiter",{init:function(a){this.app=a;this.utils=a.utils;this.opts=a.opts;this.editor=a.editor;this.keycodes=a.keycodes},onpasting:function(a){this.opts.limiter&&(a=this.utils.removeInvisibleChars(a),this.opts.input=!(a.length>=this.opts.limiter))},start:function(){this.opts.limiter&&(this._count(),this.editor.getElement().on("keydown.redactor-plugin-limiter",this._limit.bind(this)))},stop:function(){this.editor.getElement().off(".redactor-plugin-limiter");this.opts.input=
!0},_limit:function(a){var b=a.which,c=a.ctrlKey||a.metaKey,f=[37,38,39,40];b===this.keycodes.BACKSPACE||b===this.keycodes.DELETE||b===this.keycodes.ESC||b===this.keycodes.SHIFT||c&&65===b||c&&88===b||c&&82===b||c&&116===b||-1!==f.indexOf(b)||this._count(a)},_count:function(a){var b=this.editor.getElement().text();b=this.utils.removeInvisibleChars(b);if(b.length>=this.opts.limiter)return a&&a.preventDefault(),this.opts.input=!1;this.opts.input=!0}})})(Redactor);
(function(a){a.add("plugin","properties",{modals:{properties:'<form action=""> \r\n                    <div class="form-item"> \r\n                        <label>Id</label> \r\n                        <input type="text" name="id"> \r\n                    </div> \r\n                    <div class="form-item"> \r\n                        <label>Class</label> \r\n                        <input type="text" name="classname"> \r\n                    </div> \r\n                </form>'},translations:{en:{properties:"Properties"}},
init:function(a){this.app=a;this.opts=a.opts;this.lang=a.lang;this.$body=a.$body;this.toolbar=a.toolbar;this.inspector=a.inspector;this.selection=a.selection;this.labelStyle={"font-family":"monospace",position:"absolute",padding:"2px 5px","line-height":1,"border-radius":"3px","font-size":"11px",color:"rgba(255, 255, 255, .9)"}},onmodal:{properties:{open:function(a,d){this.$block&&(a=this._getData(this.$block),d.setData(a))},opened:function(a,d){d.getField("id").focus()},save:function(a,d){a=d.getData();
this._save(a)}}},onbutton:{properties:{observe:function(a){this._observeButton(a)}}},start:function(){var a={title:this.lang.get("properties"),api:"plugin.properties.open",observe:"properties"};this.toolbar.addButton("properties",a).setIcon('<i class="re-icon-properties"></i>');this._createLabel()},stop:function(){this._removeLabel()},open:function(){var b=this.selection.getBlock();b&&(this.$block=a.dom(b),b={title:this.lang.get("properties"),width:"500px",name:"properties",handle:"save",commands:{save:{title:this.lang.get("save")},
cancel:{title:this.lang.get("cancel")}}},this.app.api("module.modal.build",b))},_save:function(a){this.app.api("module.modal.close");""===a.id?this.$block.removeAttr("id"):this.$block.attr("id",a.id);""===a.classname?this.$block.removeAttr("class"):this.$block.attr("class",a.classname)},_getData:function(b){b=a.dom(b);return{id:b.attr("id"),classname:b.attr("class")}},_showData:function(b,d){var c="";d.id&&(c+="#"+d.id+" ");d.classname&&(c+="."+d.classname);""!==c?(b=a.dom(b).offset(),this.$label.css({top:b.top-
12+"px",left:b.left+"px","z-index":this.opts.zindex?this.opts.zindex+3:"auto"}),this.$label.html(c),this.$label.show()):this.$label.hide()},_createLabel:function(){this.$label=a.dom("<span />");this.$label.hide();this.$label.css(this.labelStyle).css("background","rgba(229, 57, 143, .7)");this.$body.append(this.$label)},_removeLabel:function(){this.$label&&this.$label.remove()},_observeButton:function(a){var b=this.selection.getBlock(),c=this.inspector.parse(b);b&&!c.isComponent()?(c=this._getData(b),
this._showData(b,c),a.enable()):(a.disable(),this.$label&&this.$label.hide())}})})(Redactor);
(function(a){a.add("plugin","table",{translations:{en:{table:"Table","insert-table":"Insert table","insert-row-above":"Insert row above","insert-row-below":"Insert row below","insert-column-left":"Insert column left","insert-column-right":"Insert column right","add-head":"Add head","delete-head":"Delete head","delete-column":"Delete column","delete-row":"Delete row","delete-table":"Delete table"}},init:function(a){this.app=a;this.lang=a.lang;this.opts=a.opts;this.caret=a.caret;this.toolbar=a.toolbar;
this.component=a.component;this.inspector=a.inspector;this.insertion=a.insertion;this.selection=a.selection},ondropdown:{table:{observe:function(a){this._observeDropdown(a)}}},start:function(){var a={observe:"table","insert-table":{title:this.lang.get("insert-table"),api:"plugin.table.insert"},"insert-row-above":{title:this.lang.get("insert-row-above"),classname:"redactor-table-item-observable",api:"plugin.table.addRowAbove"},"insert-row-below":{title:this.lang.get("insert-row-below"),classname:"redactor-table-item-observable",
api:"plugin.table.addRowBelow"},"insert-column-left":{title:this.lang.get("insert-column-left"),classname:"redactor-table-item-observable",api:"plugin.table.addColumnLeft"},"insert-column-right":{title:this.lang.get("insert-column-right"),classname:"redactor-table-item-observable",api:"plugin.table.addColumnRight"},"add-head":{title:this.lang.get("add-head"),classname:"redactor-table-item-observable",api:"plugin.table.addHead"},"delete-head":{title:this.lang.get("delete-head"),classname:"redactor-table-item-observable",
api:"plugin.table.deleteHead"},"delete-column":{title:this.lang.get("delete-column"),classname:"redactor-table-item-observable",api:"plugin.table.deleteColumn"},"delete-row":{title:this.lang.get("delete-row"),classname:"redactor-table-item-observable",api:"plugin.table.deleteRow"},"delete-table":{title:this.lang.get("delete-table"),classname:"redactor-table-item-observable",api:"plugin.table.deleteTable"}},d={title:this.lang.get("table")};d=this.toolbar.addButtonBefore("link","table",d);d.setIcon('<i class="re-icon-table"></i>');
d.setDropdown(a)},insert:function(){for(var a=this.component.create("table"),d=0;2>d;d++)a.addRow(3);a=this.insertion.insertHtml(a);this.caret.setStart(a)},addRowAbove:function(){var a=this._getComponent();if(a){var d=this.selection.getCurrent();a=a.addRowTo(d,"before");this.caret.setStart(a)}},addRowBelow:function(){var a=this._getComponent();if(a){var d=this.selection.getCurrent();a=a.addRowTo(d,"after");this.caret.setStart(a)}},addColumnLeft:function(){var a=this._getComponent();if(a){var d=this.selection.getCurrent();
this.selection.save();a.addColumnTo(d,"left");this.selection.restore()}},addColumnRight:function(){var a=this._getComponent();if(a){var d=this.selection.getCurrent();this.selection.save();a.addColumnTo(d,"right");this.selection.restore()}},addHead:function(){var a=this._getComponent();a&&(this.selection.save(),a.addHead(),this.selection.restore())},deleteHead:function(){var b=this._getComponent();if(b){var d=this.selection.getCurrent();0!==a.dom(d).closest("thead").length?(b.removeHead(),this.caret.setStart(b)):
(this.selection.save(),b.removeHead(),this.selection.restore())}},deleteColumn:function(){var b=this._getComponent();if(b){var d=this.selection.getCurrent(),c=a.dom(d).closest("td, th"),f=c.nextElement().get();c=c.prevElement().get();b.removeColumn(d);f?this.caret.setStart(f):c?this.caret.setEnd(c):this.deleteTable()}},deleteRow:function(){var b=this._getComponent();if(b){var d=this.selection.getCurrent(),c=a.dom(d).closest("tr"),f=c.nextElement().get();c=c.prevElement().get();b.removeRow(d);f?this.caret.setStart(f):
c?this.caret.setEnd(c):this.deleteTable()}},deleteTable:function(){var a=this._getTable();a&&this.component.remove(a)},_getTable:function(){var a=this.selection.getCurrent();a=this.inspector.parse(a);if(a.isTable())return a.getTable()},_getComponent:function(){var a=this.selection.getCurrent();a=this.inspector.parse(a);if(a.isTable())return a=a.getTable(),this.component.create("table",a)},_observeDropdown:function(a){var b=this._getTable(),c=a.getItemsByClass("redactor-table-item-observable");a=a.getItem("insert-table");
b?(this._observeItems(c,"enable"),a.disable()):(this._observeItems(c,"disable"),a.enable())},_observeItems:function(a,d){for(var b=0;b<a.length;b++)a[b][d]()}})})(Redactor);
(function(a){a.add("class","table.component",{mixins:["dom","component"],init:function(a,d){this.app=a;return d&&void 0!==d.cmnt?d:this._init(d)},addHead:function(){this.removeHead();var b=this.$element.find("tr").first().children("td, th").length,d=a.dom("<thead>");b=this._buildRow(b,"<th>");d.append(b);this.$element.prepend(d)},addRow:function(a){a=this._buildRow(a);this.$element.append(a);return a},addRowTo:function(a,d){return this._addRowTo(a,d)},addColumnTo:function(b,d){b=a.dom(b);var c=b.closest("tr"),
f=b.closest("td, th"),g=0;c.find("td, th").each(function(a,b){a===f.get()&&(g=b)});this.$element.find("tr").each(function(b){b=a.dom(b).find("td, th").get(g);b=a.dom(b);var c=b.clone();c.html("");"right"===d?b.after(c):b.before(c)})},removeHead:function(){var a=this.$element.find("thead");0!==a.length&&a.remove()},removeRow:function(b){a.dom(b).closest("tr").remove()},removeColumn:function(b){b=a.dom(b);var d=b.closest("tr"),c=b.closest("td, th"),f=0;d.find("td, th").each(function(a,b){a===c.get()&&
(f=b)});this.$element.find("tr").each(function(b){b=a.dom(b).find("td, th").get(f);a.dom(b).remove()})},_init:function(b){if("undefined"!==typeof b){var d=a.dom(b);b=d.get();d=d.closest("figure");if(0!==d.length){var c=d;var f=d.find("table").get()}else"TABLE"===b.tagName&&(f=b)}this._buildWrapper(c);this._buildElement(f);this._initWrapper()},_addRowTo:function(b,d){b=a.dom(b).closest("tr");if(0!==b.length){var c=b.children("td, th").length;c=this._buildRow(c);b[d](c);return c}},_buildRow:function(b,
d){d=d||"<td>";for(var c=a.dom("<tr>"),f=0;f<b;f++){var g=a.dom(d);g.attr("contenteditable",!0);c.append(g)}return c},_buildElement:function(b){b?this.$element=a.dom(b):(this.$element=a.dom("<table>"),this.append(this.$element))},_buildWrapper:function(a){this.parse(a||"<figure>")},_initWrapper:function(){this.addClass("redactor-component");this.attr({"data-redactor-type":"table",tabindex:"-1",contenteditable:!1})}})})(Redactor);
(function(a){a.add("plugin","textdirection",{translations:{en:{"change-text-direction":"RTL-LTR","left-to-right":"Left to Right","right-to-left":"Right to Left"}},init:function(a){this.app=a;this.lang=a.lang;this.block=a.block;this.toolbar=a.toolbar},start:function(){var a={};a.ltr={title:this.lang.get("left-to-right"),api:"plugin.textdirection.set",args:"ltr"};a.rtl={title:this.lang.get("right-to-left"),api:"plugin.textdirection.set",args:"rtl"};var d=this.toolbar.addButton("textdirection",{title:this.lang.get("change-text-direction")});
d.setIcon('<i class="re-icon-textdirection"></i>');d.setDropdown(a)},set:function(a){"rtl"===a?this.block.add({attr:{dir:"rtl"}}):this.block.remove({attr:"dir"})}})})(Redactor);
(function(a){a.add("plugin","video",{translations:{en:{video:"Video","video-html-code":"Video Embed Code or Youtube/Vimeo Link"}},modals:{video:'<form action=""> \r\n                    <div class="form-item"> \r\n                        <label for="modal-video-input">## video-html-code ## <span class="req">*</span></label> \r\n                        <textarea id="modal-video-input" name="video" style="height: 160px;"></textarea> \r\n                    </div> \r\n                </form>'},init:function(a){this.app=
a;this.lang=a.lang;this.opts=a.opts;this.toolbar=a.toolbar;this.component=a.component;this.insertion=a.insertion;this.inspector=a.inspector},onmodal:{video:{opened:function(a,d){d.getField("video").focus()},insert:function(a,d){a=d.getData();this._insert(a)}}},oncontextbar:function(a,d){var b=this.inspector.parse(a.target);if(b.isComponentType("video")){b=b.getComponent();var f={remove:{title:this.lang.get("delete"),api:"plugin.video.remove",args:b}};d.set(a,b,f,"bottom")}},start:function(){var a=
{title:this.lang.get("video"),api:"plugin.video.open"};this.toolbar.addButtonAfter("image","video",a).setIcon('<i class="re-icon-video"></i>')},open:function(){var a={title:this.lang.get("video"),width:"600px",name:"video",handle:"insert",commands:{insert:{title:this.lang.get("insert")},cancel:{title:this.lang.get("cancel")}}};this.app.api("module.modal.build",a)},remove:function(a){this.component.remove(a)},_insert:function(a){this.app.api("module.modal.close");""!==a.video.trim()&&(a.video=this._matchData(a.video),
this._isVideoIframe(a.video)&&(a=this.component.create("video",a.video),this.insertion.insertHtml(a)))},_isVideoIframe:function(a){return null!==a.match(/<iframe|<video/gi)},_matchData:function(a){if(this._isVideoIframe(a)){var b=["iframe","video"];a=a.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(a,d){return-1===b.indexOf(d.toLowerCase())?"":a})}a.match(this.opts.regex.youtube)?a=a.replace(this.opts.regex.youtube,'<iframe style="width: 500px; height: 281px;" src="//www.youtube.com/embed/$1" frameborder="0" allowfullscreen></iframe>'):
a.match(this.opts.regex.vimeo)&&(a=a.replace(this.opts.regex.vimeo,'<iframe style="width: 500px; height: 281px;" src="//player.vimeo.com/video/$2" frameborder="0" allowfullscreen></iframe>'));return a}})})(Redactor);
(function(a){a.add("class","video.component",{mixins:["dom","component"],init:function(a,d){this.app=a;return d&&void 0!==d.cmnt?d:this._init(d)},_init:function(b){if("undefined"!==typeof b){var d=a.dom(b).closest("figure");0!==d.length?this.parse(d):(this.parse("<figure>"),this.append(b))}else this.parse("<figure>");this._initWrapper()},_initWrapper:function(){this.addClass("redactor-component");this.attr({"data-redactor-type":"video",tabindex:"-1",contenteditable:!1})}})})(Redactor);
!function(){function a(b){if(!b||"object"!=typeof b)return b;var c=new b.constructor,e;for(e in b)b.hasOwnProperty(e)&&(c[e]=a(b[e]));return c}function b(a,b){if(a){var c,e=0,d=a.length;if(void 0===d)for(c in a){if(!1===b.call(a[c],c,a[c]))break}else for(c=a[0];e<d&&!1!==b.call(c,e,c);c=a[++e]);return a}}function d(a,c,e){if("object"!=typeof c)return a;a&&c&&b(c,function(b,c){e&&"function"==typeof c||(a[b]=c)});return a}function c(a){var c=a.indexOf(".");if(-1!=c){var e=a.slice(0,c)||"*",d=a.slice(c+
1,a.length),f=[];b(document.getElementsByTagName(e),function(){this.className&&-1!=this.className.indexOf(d)&&f.push(this)});return f}}function f(a){a=a||window.event;a.preventDefault?(a.stopPropagation(),a.preventDefault()):(a.returnValue=!1,a.cancelBubble=!0);return!1}function g(a,b,c){a[b]=a[b]||[];a[b].push(c)}function m(a){return a.replace(/&amp;/g,"%26").replace(/&/g,"%26").replace(/=/g,"%3D")}function l(){return"_"+(""+Math.random()).slice(2,10)}function n(c,n,q){var w=this,y=null,A=!1,B,G,
L=[],J={},P={},fa,da,M,V,ea,Y;d(w,{id:function(){return fa},isLoaded:function(){return null!==y&&void 0!==y.fp_play&&!A},getParent:function(){return c},hide:function(a){a&&(c.style.height="0px");w.isLoaded()&&(y.style.height="0px");return w},show:function(){c.style.height=Y+"px";w.isLoaded()&&(y.style.height=ea+"px");return w},isHidden:function(){return w.isLoaded()&&0===parseInt(y.style.height,10)},load:function(a){if(!w.isLoaded()&&!1!==w._fireEvent("onBeforeLoad")){var e=0;b(t,function(){this.unload(function(b){++e==
t.length&&(B&&!flashembed.isSupported(n.version)&&(c.innerHTML=""),a&&(a.cached=!0,g(P,"onLoad",a)),flashembed(c,n,{config:q}))})})}return w},unload:function(a){if(""!==B.replace(/\s/g,"")){if(!1===w._fireEvent("onBeforeUnload"))return a&&a(!1),w;A=!0;try{y&&(y.fp_isFullscreen()&&y.fp_toggleFullscreen(),y.fp_close(),w._fireEvent("onUnload"))}catch(S){}var b=function(){y=null;c.innerHTML=B;A=!1;a&&a(!0)};/WebKit/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent)?setTimeout(b,0):b()}else a&&
a(!1);return w},getClip:function(a){void 0===a&&(a=V);return L[a]},getCommonClip:function(){return G},getPlaylist:function(){return L},getPlugin:function(a){var b=J[a];if(!b&&w.isLoaded()){var c=w._api().fp_getPlugin(a);c&&(b=new p(a,c,w),J[a]=b)}return b},getScreen:function(){return w.getPlugin("screen")},getControls:function(){return w.getPlugin("controls")._fireEvent("onUpdate")},getLogo:function(){try{return w.getPlugin("logo")._fireEvent("onUpdate")}catch(N){}},getPlay:function(){return w.getPlugin("play")._fireEvent("onUpdate")},
getConfig:function(b){return b?a(q):q},getFlashParams:function(){return n},loadPlugin:function(a,b,c,e){"function"==typeof c&&(e=c,c={});var d=e?l():"_";w._api().fp_loadPlugin(a,b,c,d);b={};b[d]=e;e=new p(a,null,w,b);return J[a]=e},getState:function(){return w.isLoaded()?y.fp_getState():-1},play:function(a,b){var c=function(){void 0!==a?w._api().fp_play(a,b):w._api().fp_play()};w.isLoaded()?c():A?setTimeout(function(){w.play(a,b)},50):w.load(function(){c()});return w},getVersion:function(){if(w.isLoaded()){var a=
y.fp_getVersion();a.push("flowplayer.js @VERSION");return a}return"flowplayer.js @VERSION"},_api:function(){if(!w.isLoaded())throw"Flowplayer "+w.id()+" not loaded when calling an API method";return y},setClip:function(a){b(a,function(b,e){if("function"==typeof e)g(P,b,e),delete a[b];else if("onCuepoint"==b)$f(c).getCommonClip().onCuepoint(a[b][0],a[b][1])});w.setPlaylist([a]);return w},getIndex:function(){return M},bufferAnimate:function(a){y.fp_bufferAnimate(void 0===a||a);return w},_swfHeight:function(){return y.clientHeight}});
b("Click* Load* Unload* Keypress* Volume* Mute* Unmute* PlaylistReplace ClipAdd Fullscreen* FullscreenExit Error MouseOver MouseOut".split(" "),function(){var a="on"+this;if(-1!=a.indexOf("*")){a=a.slice(0,a.length-1);var b="onBefore"+a.slice(2);w[b]=function(a){g(P,b,a);return w}}w[a]=function(b){g(P,a,b);return w}});b("pause resume mute unmute stop toggle seek getStatus getVolume setVolume getTime isPaused isPlaying startBuffering stopBuffering isFullscreen toggleFullscreen reset close setPlaylist addClip playFeed setKeyboardShortcutsEnabled isKeyboardShortcutsEnabled".split(" "),
function(){var a=this;w[a]=function(b,c){if(!w.isLoaded())return w;b=void 0!==b&&void 0!==c?y["fp_"+a](b,c):void 0===b?y["fp_"+a]():y["fp_"+a](b);return"undefined"===b||void 0===b?w:b}});w._fireEvent=function(a){"string"==typeof a&&(a=[a]);var c=a[0],d=a[1],f=a[2],g=a[3],l=0;q.debug&&console.log("$f.fireEvent",[].slice.call(a));w.isLoaded()||"onLoad"!=c||"player"!=d||(y=y||document.getElementById(da),ea=w._swfHeight(),b(L,function(){this._fireEvent("onLoad")}),b(J,function(a,b){b._fireEvent("onUpdate")}),
G._fireEvent("onLoad"));if("onLoad"!=c||"player"==d)if("onError"==c&&("string"==typeof d||"number"==typeof d&&"number"==typeof f)&&(d=f,f=g),"onContextMenu"==c)b(q.contextMenu[d],function(a,b){b.call(w)});else if("onPluginEvent"==c||"onBeforePluginEvent"==c){if(g=J[d.name||d])return g._fireEvent("onUpdate",d),g._fireEvent(f,a.slice(3))}else{if("onPlaylistReplace"==c){L=[];var m=0;b(d,function(){L.push(new e(this,m++,w))})}if("onClipAdd"==c){if(d.isInStream)return;d=new e(d,f,w);L.splice(f,0,d);for(l=
f+1;l<L.length;l++)L[l].index++}var n=!0;"number"==typeof d&&d<L.length&&(V=d,(a=L[d])&&(n=a._fireEvent(c,f,g)),a&&!1===n||(n=G._fireEvent(c,f,g,a)));b(P[c],function(){n=this.call(w,d,f);this.cached&&P[c].splice(l,1);if(!1===n)return!1;l++});return n}};if("string"==typeof c){var pa=document.getElementById(c);if(!pa)throw"Flowplayer cannot access element: "+c;c=pa}(function(){function a(a){if(!(!/iPad|iPhone|iPod/i.test(navigator.userAgent)||/.flv$/i.test(L[0].url)||w.hasiPadSupport&&w.hasiPadSupport()))return!0;
w.isLoaded()||!1===w._fireEvent("onBeforeClick")||w.load();return f(a)}$f(c)?($f(c).getParent().innerHTML="",M=$f(c).getIndex(),t[M]=w):(t.push(w),M=t.length-1);Y=parseInt(c.style.height,10)||c.clientHeight;fa=c.id||"fp"+l();da=n.id||fa+"_api";n.id=da;B=c.innerHTML;"string"==typeof q&&(q={clip:{url:q}});q.playerId=fa;q.clip=q.clip||{};c.getAttribute("href",2)&&!q.clip.url&&(q.clip.url=c.getAttribute("href",2));q.clip.url&&(q.clip.url=m(q.clip.url));G=new e(q.clip,-1,w);q.playlist=q.playlist||[q.clip];
var d=0;b(q.playlist,function(){var a=this;"object"==typeof a&&a.length&&(a={url:""+a});a.url&&(a.url=m(a.url));b(q.clip,function(b,c){void 0!==c&&void 0===a[b]&&"function"!=typeof c&&(a[b]=c)});q.playlist[d]=a;a=new e(a,d,w);L.push(a);d++});b(q,function(a,b){if("function"==typeof b){if(G[a])G[a](b);else g(P,a,b);delete q[a]}});b(q.plugins,function(a,b){b&&(J[a]=new p(a,b,w))});q.plugins&&void 0!==q.plugins.controls||(J.controls=new p("controls",null,w));J.canvas=new p("canvas",null,w);B=c.innerHTML;
setTimeout(function(){""!==B.replace(/\s/g,"")?c.addEventListener?c.addEventListener("click",a,!1):c.attachEvent&&c.attachEvent("onclick",a):(!c.addEventListener||w.hasiPadSupport&&w.hasiPadSupport()||c.addEventListener("click",f,!1),w.load())},0)})()}function q(a){this.length=a.length;this.each=function(c){b(a,c)};this.size=function(){return a.length};var c=this;for(name in n.prototype)c[name]=function(){var a=arguments;c.each(function(){this[name].apply(this,a)})}}var e=function(a,c,e){var f=this,
m={},n={};f.index=c;"string"==typeof a&&(a={url:a});d(this,a,!0);b("Begin* Start Pause* Resume* Seek* Stop* Finish* LastSecond Update BufferFull BufferEmpty BufferStop".split(" "),function(){var a="on"+this;if(-1!=a.indexOf("*")){a=a.slice(0,a.length-1);var b="onBefore"+a.slice(2);f[b]=function(a){g(n,b,a);return f}}f[a]=function(b){g(n,a,b);return f};-1==c&&(f[b]&&(e[b]=f[b]),f[a]&&(e[a]=f[a]))});d(this,{onCuepoint:function(a,b){if(1==arguments.length)return m.embedded=[null,a],f;"number"==typeof a&&
(a=[a]);var d=l();m[d]=[a,b];e.isLoaded()&&e._api().fp_addCuepoints(a,c,d);return f},update:function(a){d(f,a);e.isLoaded()&&e._api().fp_updateClip(a,c);var b=e.getConfig();d(-1==c?b.clip:b.playlist[c],a,!0)},_fireEvent:function(a,g,l,q){if("onLoad"==a)return b(m,function(a,b){b[0]&&e._api().fp_addCuepoints(b[0],c,a)}),!1;q=q||f;if("onCuepoint"==a){var p=m[g];if(p)return p[1].call(e,q,l)}g&&-1!="onBeforeBegin,onMetaData,onMetaDataChange,onStart,onUpdate,onResume".indexOf(a)&&(d(q,g),g.metaData&&(q.duration?
q.fullDuration=g.metaData.duration:q.duration=g.metaData.duration));var t=!0;b(n[a],function(){t=this.call(e,q,g,l)});return t}});if(a.onCuepoint){var q=a.onCuepoint;f.onCuepoint.apply(f,"function"==typeof q?[q]:q);delete a.onCuepoint}b(a,function(b,c){"function"==typeof c&&(g(n,b,c),delete a[b])});-1==c&&(e.onCuepoint=this.onCuepoint)},p=function(a,c,e,f){var g=this,m={},n=!1;f&&d(m,f);b(c,function(a,b){"function"==typeof b&&(m[a]=b,delete c[a])});d(this,{animate:function(b,d,f){if(!b)return g;"function"==
typeof d&&(f=d,d=500);if("string"==typeof b){var n=b;b={};b[n]=d;d=500}if(f){var q=l();m[q]=f}void 0===d&&(d=500);c=e._api().fp_animate(a,b,d,q);return g},css:function(b,f){if(void 0!==f){var l={};l[b]=f;b=l}c=e._api().fp_css(a,b);d(g,c);return g},show:function(){this.display="block";e._api().fp_showPlugin(a);return g},hide:function(){this.display="none";e._api().fp_hidePlugin(a);return g},toggle:function(){this.display=e._api().fp_togglePlugin(a);return g},fadeTo:function(b,c,d){"function"==typeof c&&
(d=c,c=500);if(d){var f=l();m[f]=d}this.display=e._api().fp_fadeTo(a,b,c,f);this.opacity=b;return g},fadeIn:function(a,b){return g.fadeTo(1,a,b)},fadeOut:function(a,b){return g.fadeTo(0,a,b)},getName:function(){return a},getPlayer:function(){return e},_fireEvent:function(c,f,l){if("onUpdate"==c){l=e._api().fp_getPlugin(a);if(!l)return;d(g,l);delete g.methods;n||(b(l.methods,function(){var b=""+this;g[b]=function(){var c=[].slice.call(arguments);c=e._api().fp_invoke(a,b,c);return"undefined"===c||void 0===
c?g:c}}),n=!0)}return(l=m[c])?(f=l.apply(g,f),"_"==c.slice(0,1)&&delete m[c],f):g}})},t=[];window.flowplayer=window.$f=function(){var e=null,f=arguments[0];if(!arguments.length)return b(t,function(){if(this.isLoaded())return e=this,!1}),e||t[0];if(1==arguments.length){if("number"==typeof f)return t[f];if("*"==f)return new q(t);b(t,function(){if(this.id()==f.id||this.id()==f||this.getParent()==f)return e=this,!1});return e}if(1<arguments.length){var g=arguments[1],l=3==arguments.length?arguments[2]:
{};"string"==typeof g&&(g={src:g});g=d({bgcolor:"#000000",version:[10,1],expressInstall:"http://releases.flowplayer.org/swf/expressinstall.swf",cachebusting:!1},g);if("string"==typeof f){if(-1!=f.indexOf(".")){var m=[];b(c(f),function(){m.push(new n(this,a(g),a(l)))});return new q(m)}var p=document.getElementById(f);return new n(null!==p?p:a(f),a(g),a(l))}if(f)return new n(f,a(g),a(l))}return null};d(window.$f,{fireEvent:function(){var a=[].slice.call(arguments),b=$f(a[0]);return b?b._fireEvent(a.slice(1)):
null},addPlugin:function(a,b){n.prototype[a]=b;return $f},each:b,extend:d});"function"==typeof jQuery&&(jQuery.fn.flowplayer=function(b,c){if(!arguments.length||"number"==typeof arguments[0]){var e=[];this.each(function(){var a=$f(this);a&&e.push(a)});return arguments.length?e[arguments[0]]:new q(e)}return this.each(function(){$f(this,a(b),c?a(c):{})})})}();
!function(){function a(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function b(a,b){var c=[],e;for(e in a)a.hasOwnProperty(e)&&(c[e]=b(a[e]));return c}function d(b,e,d){if(l.isSupported(e.version))b.innerHTML=l.getHTML(e,d);else if(e.expressInstall&&l.isSupported([6,65]))b.innerHTML=l.getHTML(a(e,{src:e.expressInstall}),{MMredirectURL:encodeURIComponent(location.href),MMplayerType:"PlugIn",MMdoctitle:document.title});else if(b.innerHTML.replace(/\s/g,"")||(b.innerHTML="<h2>Flash version "+
e.version+" or greater is required</h2><h3>"+(0<n[0]?"Your version is "+n:"You have no flash plugin installed")+"</h3>"+("A"==b.tagName?"<p>Click here to download latest version</p>":"<p>Download latest version from <a href='http://get.adobe.com/flashplayer'>here</a></p>"),"A"!=b.tagName&&"DIV"!=b.tagName)||(b.onclick=function(){location.href="http://get.adobe.com/flashplayer"}),e.onFail){var f=e.onFail.call(this);"string"==typeof f&&(b.innerHTML=f)}c&&(window[e.id]=document.getElementById(e.id));
a(this,{getRoot:function(){return b},getOptions:function(){return e},getConf:function(){return d},getApi:function(){return b.firstChild}})}var c=document.all,f="function"==typeof jQuery,g=/(\d+)[^\d]+(\d+)[^\d]*(\d*)/,m={width:"100%",height:"100%",id:"_"+(""+Math.random()).slice(9),allowfullscreen:!0,allowscriptaccess:"always",quality:"high",version:[3,0],onFail:null,expressInstall:null,w3c:!1,cachebusting:!1};window.attachEvent&&window.attachEvent("onbeforeunload",function(){__flash_unloadHandler=
function(){};__flash_savedUnloadHandler=function(){}});window.flashembed=function(b,c,f){"string"==typeof b&&(b=document.getElementById(b.replace("#","")));if(b)return"string"==typeof c&&(c={src:c}),new d(b,a(a({},m),c),f)};var l=a(window.flashembed,{conf:m,getVersion:function(){var a,b;try{var c=navigator.plugins["Shockwave Flash"];null!=c[0].enabledPlugin&&(b=c.description.slice(16))}catch(t){try{b=(a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"),a.GetVariable("$version"))}catch(w){try{b=
(a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),a.GetVariable("$version"))}catch(y){}}}return(b=g.exec(b))?[1*b[1],1*b[9<1*b[1]?2:3]]:[0,0]},asString:function(a){if(null===a||void 0===a)return null;var c=typeof a;"object"==c&&a.push&&(c="array");switch(c){case "string":return a=a.replace(/(["\\])/g,"\\$1"),a=a.replace(/^\s?(\d+\.?\d*)%/,"$1pct"),'"'+a+'"';case "array":return"["+b(a,function(a){return l.asString(a)}).join(",")+"]";case "function":return'"function()"';case "object":c=[];for(var d in a)a.hasOwnProperty(d)&&
c.push('"'+d+'":'+l.asString(a[d]));return"{"+c.join(",")+"}"}return String(a).replace(/\s/g," ").replace(/\'/g,'"')},getHTML:function(b,e){b=a({},b);var d='<object width="'+b.width+'" height="'+b.height+'" id="'+b.id+'" name="'+b.id+'"';b.cachebusting&&(b.src+=(-1!=b.src.indexOf("?")?"&":"?")+Math.random());d=b.w3c||!c?d+(' data="'+b.src+'" type="application/x-shockwave-flash"'):d+' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"';d+=">";if(b.w3c||c)d+='<param name="movie" value="'+b.src+'" />';
b.width=b.height=b.id=b.w3c=b.src=null;b.onFail=b.version=b.expressInstall=null;for(var f in b)b[f]&&(d+='<param name="'+f+'" value="'+b[f]+'" />');b="";if(e){for(var g in e)e[g]&&(f=e[g],b+=g+"="+(/function|object/.test(typeof f)?l.asString(f):f)+"&");b=b.slice(0,-1);d+='<param name="flashvars" value=\''+b+"' />"}return d+"</object>"},isSupported:function(a){return n[0]>a[0]||n[0]==a[0]&&n[1]>=a[1]}}),n=l.getVersion();f&&(jQuery.tools=jQuery.tools||{version:"@VERSION"},jQuery.tools.flashembed={conf:m},
jQuery.fn.flashembed=function(a,b){return this.each(function(){$(this).data("flashembed",flashembed(this,a,b))})})}();
var UndoRedoFactory=function(){var a={hotkey_enabled:!0,hotkey_active:!0,changeState:function(){}},b=0,d=function(){this.states=[];this.index=0;this.hash=++b},c=d.prototype;c.bindGlobalNNavigator=function(){var a=this;if(this.config.hotkey_enabled)$(document).on("keyup."+this.hash+".ctrl_z",function(){a.config.hotkey_active&&a.undo()}).on("keyup."+this.hash+".ctrl_y",function(){a.config.hotkey_active&&a.redo()});if(this.undo_btn)this.undo_btn.on("click",function(){a.undo()});if(this.redo_btn)this.redo_btn.on("click",
function(){a.redo()})};c.activateHotkey=function(){this.config.hotkey_active=!0};c.deactivateHotkey=function(){this.config.hotkey_active=!1};c.destroy=function(){this.config.hotkey_enabled&&$(document).off("."+this.hash);this.undo_btn&&this.undo_btn.off("click");this.redo_btn&&this.redo_btn.off("click")};c.undo=function(){if(0!=this.index){this.index--;var a=this.states[this.index];this.undo_btn.trigger("before_undo",a);a.doer?a.doer.undo.call(a):this.config.changeState(a.type,a.previous,a.current);
this.index||this.undo_btn.addClass("disabled").attr("disabled","disabled");this.redo_btn&&this.redo_btn.is(".disabled")&&this.redo_btn.removeClass("disabled").removeAttr("disabled");0==this.index&&this.undo_btn&&this.undo_btn.trigger("undo_bottom_reached");this.undo_btn.trigger("undo",a)}};c.redo=function(){if(this.index!=this.states.length){var a=this.states[this.index];this.redo_btn.trigger("before_redo",a);a.doer?a.doer.redo.call(a):this.config.changeState(a.type,a.current,a.previous);this.index++;
this.index==this.states.length&&this.redo_btn.addClass("disabled").attr("disabled","disabled");this.undo_btn&&this.undo_btn.is(".disabled")&&this.undo_btn.removeClass("disabled").removeAttr("disabled");0==this.index&&this.states.length&&this.undo_btn.trigger("redo_top_reached");this.redo_btn.trigger("redo",a)}};c.reset=function(){this.index=0;this.states=[];this.redo_btn&&!this.redo_btn.is(".disabled")&&this.redo_btn.addClass("disabled").attr("disabled","disabled");this.undo_btn&&!this.undo_btn.is(".disabled")&&
this.undo_btn.addClass("disabled").attr("disabled","disabled")};c.push=function(a,b,c,d){this.index!=this.states.length&&this.states.splice(this.index);"object"==typeof a&&a.undo&&(d=a,a=void 0);this.states.push({type:a,previous:b,current:c,doer:d});this.index++;this.undo_btn&&this.undo_btn.is(".disabled")&&this.undo_btn.removeClass("disabled").removeAttr("disabled");this.redo_btn&&!this.redo_btn.is(".disabled")&&this.redo_btn.addClass("disabled").attr("disabled","disabled")};c.isAvailable=function(){return this.states.length};
return{createManager:function(b,c,m){var f=new d;f.config=$.extend({},a,m);f.undo_btn=b;f.redo_btn=c;f.bindGlobalNNavigator();return f}}}();function CssParser(a){this.reader=a?a.reader(!0):void 0;this.rulesets=[];this.imports=[]}var _c=CssParser.prototype;
(function(){function a(){for(var a,b=[" ","\r","\n","\t"];b.contains(a=this.reader.read()););return a}function b(){do var a=this.reader.read();while(" "!=a)}function d(){var a=this.reader.read();if("*"==a){do{for(;"*"!=this.reader.read(););a=this.reader.read()}while("/"!=a)}}function c(a,b){for(var c;!a.contains(c=this.reader.read());)b.plus(c);return c}function f(b){var e=new StringWriter,f=[];e.plus(b);do{do{var g=c.call(this,["/",",","{"],e);"/"==g?d.call(this):(f.push(e.toString().trim()),e=new StringWriter)}while("/"==
g)}while("{"!=g);b=[];do if(g=c.call(this,[":","}"],e),":"==g){var l=e.toString().trim();for(e=new StringWriter;;)if(g=c.call(this,["(",";"],e),"("==g)e.plus(g),c.call(this,[")"],e),e.plus(")");else break;e=e.toString().trim();g={};g.key=l;g.value=e;b.push(g);for(e=new StringWriter;;)if(g=a.call(this),"/"==g)d.call(this);else{e.plus(g);break}}else e=new StringWriter;while("}"!=g);return new CssRule(f,b)}function g(){var g=new StringWriter;b.call(this);c.call(this,["{"],g);g=g.toString().trim();var e=
[];do{var l=a.call(this);if("/"==l)d.call(this);else if("}"==l)break;else"@"==l?e.push(n.call(this,l)):e.push(f.call(this,l))}while(1);return new CssMedia(g,e)}function m(){var a=new StringWriter;b.call(this);c.call(this,[";"],a);return a.toString().trim()}function l(b){var e={},f=new StringWriter;f.plus(b);c.call(this,["{"],f);e.offset=f.toString().trim();b=[];f=new StringWriter;do{var g=c.call(this,[":","}"],f);if(":"==g){g=f.toString().trim();f=new StringWriter;c.call(this,[";"],f);f=f.toString().trim();
var l={};l.key=g;l.value=f;b.push(l);for(f=new StringWriter;;)if(g=a.call(this),"/"==g)d.call(this);else{f.plus(g);break}}else f=new StringWriter}while("}"!=g);e.declarations=b;return e}function n(){var f=[],e=new StringWriter;b.call(this);c.call(this,["{"],e);e=e.toString().trim();do{var g=a.call(this);if("/"==g)d.call(this);else if("}"==g)break;else f.push(l.call(this,g))}while(1);return new CssKeyframe(e,f)}_c.parse=function(){if(!this.reader)return this;try{for(;;){var b=a.call(this);if(-1==b)break;
switch(b.charCodeAt(0)){case 47:d.call(this);break;case 64:b=this.reader.read();"m"==b?this.rulesets.push(g.call(this)):"i"==b?this.imports.push(m.call(this)):"k"==b?this.rulesets.push(n.call(this)):this.rulesets.push(f.call(this,"@"+b));break;case 46:case 35:case 91:case 58:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:this.rulesets.push(f.call(this,
b))}}}catch(e){}return this}})();_c.getRule=function(a){if(2==arguments.length){var b=this.getMedia(a);return b?(a=arguments[1],b.getRule(a)):null}"string"==typeof a&&(a=[a]);var d;$.each(this.rulesets,function(){if("rule"==this.type&&this.selectors.length==a.length){var b=!0;$.each(this.selectors,function(){if(!a.collect(function(){return""+this}).contains(""+this))return b=!1});if(b)return d=this,!1}});return d};
_c.getMedias=function(){var a=[];$.each(this.rulesets,function(){"media"==this.type&&a.push(this)});return a};_c.getMedia=function(a){var b;$.each(this.rulesets,function(){if("media"==this.type&&this.definition==a)return b=this,!1});return b};_c.setAttribute=function(a,b,d){var c=this.getRule(a);c?c.setAttribute(b,d):(c={},c[b]=d,this.addRule(a,c))};_c.getAttribute=function(a,b){return(a=this.getRule(a))?a.getAttribute(b):null};_c.removeAttribute=function(a,b){(a=this.getRule(a))&&a.removeAttribute(b)};
_c.toString=function(a){0==arguments.length&&(a=!1);for(var b=new StringWriter,d=this.imports,c=0;c<d.length;c++)b.plus("@import "+d[c]+";"+(a?"\n":""));d=this.rulesets;for(c=0;c<d.length;c++)b.plus(d[c].toString(a,0));return b.toString()};_c.removeMedia=function(a){if(a)if(a instanceof CssMedia)for(var b=0;b<this.rulesets.length;b++){if(this.rulesets[b]==a){this.rulesets.splice(b,1);break}}else this.removeMedia(this.getMedia(a))};
_c.removeMediaRules=function(a){if(a)for(var b=this.getMedias(),d=0;d<b.length;d++){for(var c=b[d].rulesets,f=0;f<c.length;f++){for(var g=c[f].selectors,m=0;m<g.length;m++)g[m].endsWith(a)&&(g.splice(m,1),g.length&&m--);g.length||(b[d].removeRule(c[f]),c.length&&f--)}c.length||this.removeMedia(b[d])}};_c.addMedia=function(a,b){a=new CssMedia(a,b);this.rulesets.push(a);return a};_c.addRule=function(a,b){a=a instanceof CssRule?a:new CssRule(a,b);this.rulesets.push(a);return a};
_c.removeRule=function(a){if("number"==typeof a)var b=this.rulesets.splice(a,1);else if(a instanceof CssRule)for(var d=0;d<this.rulesets.length;d++){if(this.rulesets[d]==a){b=this.rulesets.splice(d,1);break}}else for("string"==typeof a&&(a=[a]),d=0;d<this.rulesets.length;d++)if(bm.equal(this.rulesets[d].selectors,a)){b=this.rulesets.splice(d,1);break}if(b&&b.length)return b[0]};var CssMedia=function(a,b){this.definition=a;this.rulesets=b||[];this.type="media"},_m=CssMedia.prototype;
_m.getRule=function(a){return CssParser.prototype.getRule.call(this,a)};_m.removeRule=function(a){CssParser.prototype.removeRule.call(this,a)};_m.setAttribute=function(a,b,d){CssParser.prototype.setAttribute.call(this,a,b,d)};_m.getAttribute=function(a,b){return CssParser.prototype.getAttribute.call(this,a,b)};_m.removeAttribute=function(a,b){CssParser.prototype.removeAttribute.call(this,a,b)};_m.addRule=function(a,b){return CssParser.prototype.addRule.call(this,a,b)};
_m.copy=function(){var a=this.definition,b=this.rulesets.collect(function(){return this.copy()});return new CssMedia(a,b)};_m.merge=function(a){var b=this;a.rulesets.every(function(){var a=b.getRule(this.selectors);a||(a=b.addRule(this.selectors,[]));var c={};this.attributes.every(function(){c[this.key]=this.value});a.setAttribute(c)})};
_m.toString=function(a,b){0==arguments.length&&(a=!1,b=0);for(var d="",c=0;c<b;c++)d+="\t";var f=new StringWriter;f.plus(d+"@media "+this.definition+(a?" {\n":"{"));for(c=0;c<this.rulesets.length;c++)f.plus(this.rulesets[c].toString(a,b+1));f.plus(a?d+"}\n":"}");return f.toString()};
var CssRule=function(a,b){$.isArray(a)||(a=[a]);this.selectors=a.collect(function(){return""+this});if(b&&!$.isArray(b)){var d=[];$.each(b,function(a){d.push({key:a,value:this})});b=d}this.attributes=b||[];this.type="rule"},_r=CssRule.prototype;_r.addAttribute=function(a,b){var d=this;if(1==arguments.length)$.each(a,function(a,b){d.addAttribute(a,b)});else{var c={};c.key=a;c.value=b;this.attributes.push(c)}};
_r.setAttribute=function(a,b){var d=this;if(1==arguments.length)$.each(a,function(a,b){d.setAttribute(a,b)});else{var c;$.each(this.attributes,function(){if(this.key==a)return c=this,!1});if(c)c.value=b;else{var f={};f.key=a;f.value=b;this.attributes.push(f)}}};_r.getAttribute=function(a){var b;$.each(this.attributes,function(){if(this.key==a)return b=this,!1});return b?b.value:null};_r.getAttributes=function(a){var b=[];$.each(this.attributes,function(){this.key==a&&b.push(this.value)});return b};
_r.removeAttribute=function(a){var b=this;if($.isArray(a))$.each(a,function(){b.removeAttribute(this)});else if("string"==typeof a||a instanceof String){var d=this,c=[];$.each(this.attributes,function(b){this.key==a&&c.push(b)});var f=0;$.each(c,function(){d.attributes.splice(this+f--,1)})}else"number"==typeof a&&this.attributes.splice(a,1);return this};
_r.copy=function(){var a=this.selectors.collect(function(){return this}),b=this.attributes.collect(function(){return{key:this.key,value:this.value}});return new CssRule(a,b)};
_r.toString=function(a,b){0==arguments.length&&(a=!1,b=0);for(var d="",c=0;c<b;c++)d+="\t";var f=d+"\t",g=new StringWriter;if(a){for(c=0;c<this.selectors.length;c++)g.plus(d+this.selectors[c]),c<this.selectors.length-1&&g.plus(",\n");g.plus(" {\n")}else g.plus(d+this.selectors.join(a?", ":",")),g.plus("{");c=this.attributes;for(var m=0;m<c.length;m++)g.plus((a?f:"")+c[m].key+(a?" : ":":")+c[m].value+";"),g.plus(a?"\n":"");g.plus(a?d+"}\n":"}");return g.toString()};
var CssKeyframe=function(a,b){this.id=a;this.frames=b;this.type="keyframe"},_k=CssKeyframe.prototype;
_k.toString=function(a,b){0==arguments.length&&(a=!1,b=0);for(var d="",c=0;c<b;c++)d+="\t";var f=d+"\t",g=new StringWriter;g.plus(d+"@keyframe "+this.id+(a?" {\n":"{"));for(c=0;c<this.frames.length;c++){var m=this.frames[c];g.plus(a?f:"");g.plus(m.offset);g.plus(a?" { ":"{");for(var l=0;l<m.declarations.length;l++){var n=m.declarations[l];g.plus(n.key+(a?": ":":")+n.value+";")}g.plus(a?" }\n":"}")}g.plus(a?d+"}\n":"}");return g.toString()};
var swfobject=function(){function a(){if(!pa){try{var a=B.getElementsByTagName("body")[0].appendChild(B.createElement("span"));a.parentNode.removeChild(a)}catch(X){return}pa=!0;a=J.length;for(var b=0;b<a;b++)J[b]()}}function b(a){pa?a():J[J.length]=a}function d(a){if("undefined"!=typeof D.addEventListener)D.addEventListener("load",a,!1);else if("undefined"!=typeof B.addEventListener)B.addEventListener("load",a,!1);else if("undefined"!=typeof D.attachEvent)w(D,"onload",a);else if("function"==typeof D.onload){var b=
D.onload;D.onload=function(){b();a()}}else D.onload=a}function c(){var a=B.getElementsByTagName("body")[0],b=B.createElement("object");b.setAttribute("type","application/x-shockwave-flash");var c=a.appendChild(b);if(c){var e=0;(function(){if("undefined"!=typeof c.GetVariable){var d=c.GetVariable("$version");d&&(d=d.split(" ")[1].split(","),H.pv=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)])}else if(10>e){e++;setTimeout(arguments.callee,10);return}a.removeChild(b);c=null;f()})()}else f()}
function f(){var a=P.length;if(0<a)for(var b=0;b<a;b++){var c=P[b].id,e=P[b].callbackFn,d={success:!1,id:c};if(0<H.pv[0]){var f=t(c);if(f)if(!y(P[b].swfVersion)||H.wk&&312>H.wk)if(P[b].expressInstall&&m()){d={};d.data=P[b].expressInstall;d.width=f.getAttribute("width")||"0";d.height=f.getAttribute("height")||"0";f.getAttribute("class")&&(d.styleclass=f.getAttribute("class"));f.getAttribute("align")&&(d.align=f.getAttribute("align"));var q={};f=f.getElementsByTagName("param");for(var p=f.length,w=
0;w<p;w++)"movie"!=f[w].getAttribute("name").toLowerCase()&&(q[f[w].getAttribute("name")]=f[w].getAttribute("value"));l(d,q,c,e)}else n(f),e&&e(d);else x(c,!0),e&&(d.success=!0,d.ref=g(c),e(d))}else x(c,!0),e&&((c=g(c))&&"undefined"!=typeof c.SetVariable&&(d.success=!0,d.ref=c),e(d))}}function g(a){var b=null;(a=t(a))&&"OBJECT"==a.nodeName&&("undefined"!=typeof a.SetVariable?b=a:(a=a.getElementsByTagName("object")[0])&&(b=a));return b}function m(){return!N&&y("6.0.65")&&(H.win||H.mac)&&!(H.wk&&312>
H.wk)}function l(a,b,c,d){N=!0;ea=d||null;Y={success:!1,id:c};var f=t(c);if(f){"OBJECT"==f.nodeName?(M=q(f),V=null):(M=f,V=c);a.id="SWFObjectExprInst";if("undefined"==typeof a.width||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if("undefined"==typeof a.height||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";B.title=B.title.slice(0,47)+" - Flash Player Installation";d=H.ie&&H.win?"ActiveX":"PlugIn";d="MMredirectURL="+D.location.toString().replace(/&/g,"%26")+"&MMplayerType="+
d+"&MMdoctitle="+B.title;b.flashvars="undefined"!=typeof b.flashvars?b.flashvars+("&"+d):d;H.ie&&H.win&&4!=f.readyState&&(d=B.createElement("div"),c+="SWFObjectNew",d.setAttribute("id",c),f.parentNode.insertBefore(d,f),f.style.display="none",function(){4==f.readyState?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)}());e(a,b,c)}}function n(a){if(H.ie&&H.win&&4!=a.readyState){var b=B.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(q(a),b);a.style.display="none";
(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(q(a),a)}function q(a){var b=B.createElement("div");if(H.win&&H.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName("object")[0])if(a=a.childNodes)for(var c=a.length,e=0;e<c;e++)1==a[e].nodeType&&"PARAM"==a[e].nodeName||8==a[e].nodeType||b.appendChild(a[e].cloneNode(!0));return b}function e(a,b,c){var e=t(c);if(H.wk&&312>H.wk)return l;if(e)if("undefined"==typeof a.id&&
(a.id=c),H.ie&&H.win){var d="";for(f in a)a[f]!=Object.prototype[f]&&("data"==f.toLowerCase()?b.movie=a[f]:"styleclass"==f.toLowerCase()?d+=' class="'+a[f]+'"':"classid"!=f.toLowerCase()&&(d+=" "+f+'="'+a[f]+'"'));var f="";for(var g in b)b[g]!=Object.prototype[g]&&(f+='<param name="'+g+'" value="'+b[g]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+d+">"+f+"</object>";fa[fa.length]=a.id;var l=t(a.id)}else{g=B.createElement("object");g.setAttribute("type","application/x-shockwave-flash");
for(var m in a)a[m]!=Object.prototype[m]&&("styleclass"==m.toLowerCase()?g.setAttribute("class",a[m]):"classid"!=m.toLowerCase()&&g.setAttribute(m,a[m]));for(d in b)b[d]!=Object.prototype[d]&&"movie"!=d.toLowerCase()&&(a=g,f=d,m=b[d],c=B.createElement("param"),c.setAttribute("name",f),c.setAttribute("value",m),a.appendChild(c));e.parentNode.replaceChild(g,e);l=g}return l}function p(a){var b=t(a);b&&"OBJECT"==b.nodeName&&(H.ie&&H.win?(b.style.display="none",function(){if(4==b.readyState){var c=t(a);
if(c){for(var e in c)"function"==typeof c[e]&&(c[e]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function t(a){var b=null;try{b=B.getElementById(a)}catch(X){}return b}function w(a,b,c){a.attachEvent(b,c);da[da.length]=[a,b,c]}function y(a){var b=H.pv;a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function A(a,b,c,e){if(!H.ie||
!H.mac){var d=B.getElementsByTagName("head")[0];d&&(c=c&&"string"==typeof c?c:"screen",e&&(S=Z=null),Z&&S==c||(e=B.createElement("style"),e.setAttribute("type","text/css"),e.setAttribute("media",c),Z=d.appendChild(e),H.ie&&H.win&&"undefined"!=typeof B.styleSheets&&0<B.styleSheets.length&&(Z=B.styleSheets[B.styleSheets.length-1]),S=c),H.ie&&H.win?Z&&"object"==typeof Z.addRule&&Z.addRule(a,b):Z&&"undefined"!=typeof B.createTextNode&&Z.appendChild(B.createTextNode(a+" {"+b+"}")))}}function x(a,b){K&&
(b=b?"visible":"hidden",pa&&t(a)?t(a).style.visibility=b:A("#"+a,"visibility:"+b))}function z(a){return null!=/[\\\"<>\.;]/.exec(a)&&"undefined"!=typeof encodeURIComponent?encodeURIComponent(a):a}var D=window,B=document,G=navigator,L=!1,J=[function(){L?c():f()}],P=[],fa=[],da=[],M,V,ea,Y,pa=!1,N=!1,Z,S,K=!0,H=function(){var a="undefined"!=typeof B.getElementById&&"undefined"!=typeof B.getElementsByTagName&&"undefined"!=typeof B.createElement,b=G.userAgent.toLowerCase(),c=G.platform.toLowerCase(),
e=c?/win/.test(c):/win/.test(b);c=c?/mac/.test(c):/mac/.test(b);b=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1;var d=!+"\v1",f=[0,0,0],g=null;if("undefined"!=typeof G.plugins&&"object"==typeof G.plugins["Shockwave Flash"])!(g=G.plugins["Shockwave Flash"].description)||"undefined"!=typeof G.mimeTypes&&G.mimeTypes["application/x-shockwave-flash"]&&!G.mimeTypes["application/x-shockwave-flash"].enabledPlugin||(L=!0,d=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),f[0]=parseInt(g.replace(/^(.*)\..*$/,
"$1"),10),f[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),f[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if("undefined"!=typeof D.ActiveXObject)try{if(g=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version"))d=!0,g=g.split(" ")[1].split(","),f=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}catch(R){}return{w3:a,pv:f,wk:b,ie:d,win:e,mac:c}}();(function(){H.w3&&(("undefined"!=typeof B.readyState&&"complete"==B.readyState||"undefined"==
typeof B.readyState&&(B.getElementsByTagName("body")[0]||B.body))&&a(),pa||("undefined"!=typeof B.addEventListener&&B.addEventListener("DOMContentLoaded",a,!1),H.ie&&H.win&&(B.attachEvent("onreadystatechange",function(){"complete"==B.readyState&&(B.detachEvent("onreadystatechange",arguments.callee),a())}),D==top&&function(){if(!pa){try{B.documentElement.doScroll("left")}catch(E){setTimeout(arguments.callee,0);return}a()}}()),H.wk&&function(){pa||(/loaded|complete/.test(B.readyState)?a():setTimeout(arguments.callee,
0))}(),d(a)))})();(function(){H.ie&&H.win&&window.attachEvent("onunload",function(){for(var a=da.length,b=0;b<a;b++)da[b][0].detachEvent(da[b][1],da[b][2]);a=fa.length;for(b=0;b<a;b++)p(fa[b]);for(var c in H)H[c]=null;H=null;for(var e in swfobject)swfobject[e]=null;swfobject=null})})();return{registerObject:function(a,b,c,e){if(H.w3&&a&&b){var d={};d.id=a;d.swfVersion=b;d.expressInstall=c;d.callbackFn=e;P[P.length]=d;x(a,!1)}else e&&e({success:!1,id:a})},getObjectById:function(a){if(H.w3)return g(a)},
embedSWF:function(a,c,d,f,g,n,q,p,t,w){var A={success:!1,id:c};H.w3&&!(H.wk&&312>H.wk)&&a&&c&&d&&f&&g?(x(c,!1),b(function(){d+="";f+="";var b={};if(t&&"object"===typeof t)for(var z in t)b[z]=t[z];b.data=a;b.width=d;b.height=f;z={};if(p&&"object"===typeof p)for(var K in p)z[K]=p[K];if(q&&"object"===typeof q)for(var B in q)z.flashvars="undefined"!=typeof z.flashvars?z.flashvars+("&"+B+"="+q[B]):B+"="+q[B];if(y(g))K=e(b,z,c),b.id==c&&x(c,!0),A.success=!0,A.ref=K;else{if(n&&m()){b.data=n;l(b,z,c,w);return}x(c,
!0)}w&&w(A)})):w&&w(A)},switchOffAutoHideShow:function(){K=!1},ua:H,getFlashPlayerVersion:function(){return{major:H.pv[0],minor:H.pv[1],release:H.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(a,b,c){if(H.w3)return e(a,b,c)},showExpressInstall:function(a,b,c,e){H.w3&&m()&&l(a,b,c,e)},removeSWF:function(a){H.w3&&p(a)},createCSS:function(a,b,c,e){H.w3&&A(a,b,c,e)},addDomLoadEvent:b,addLoadEvent:d,getQueryParamValue:function(a){var b=B.location.search||B.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);
if(null==a)return z(b);b=b.split("&");for(var c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return z(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(N){var a=t("SWFObjectExprInst");a&&M&&(a.parentNode.replaceChild(M,a),V&&(x(V,!0),H.ie&&H.win&&(M.style.display="block")),ea&&ea(Y));N=!1}}}}();
(function(a,b,d){var c=/\s+/;a.Events={on:function(a,b,d){var f,g;if(!b)return this;a=a.split(c);for(f=this._callbacks||(this._callbacks={});g=a.shift();)g=f[g]||(f[g]=[]),g.push(b,d);return this},off:function(a,b,d){var f,g,m;if(!(g=this._callbacks))return this;if(!(a||b||d))return delete this._callbacks,this;for(a=a?a.split(c):_.keys(g);f=a.shift();)if((m=g[f])&&(b||d))for(f=m.length-2;0<=f;f-=2)b&&m[f]!==b||d&&m[f+1]!==d||m.splice(f,2);else delete g[f];return this},trigger:function(a){var b,d,
f,n,q;if(!(d=this._callbacks))return this;var e=[];a=a.split(c);var p=1;for(n=arguments.length;p<n;p++)e[p-1]=arguments[p];for(;b=a.shift();){if(q=d.all)q=q.slice();if(f=d[b])f=f.slice();if(f)for(p=0,n=f.length;p<n;p+=2)f[p].apply(f[p+1]||this,e);if(q)for(b=[b].concat(e),p=0,n=q.length;p<n;p+=2)q[p].apply(q[p+1]||this,b)}return this}}})(window.AV||(window.AV={}),window,document);"undefined"==typeof AV&&(AV={});AV.JSON={};
(function(){function a(a){return 10>a?"0"+a:a}function b(a){return f.lastIndex=0,f.test(a)?'"'+a.replace(f,function(a){var b=l[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(a,c){var e,f=g,l=c[a];l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(a));"function"==typeof n&&(l=n.call(c,a,l));switch(typeof l){case "string":return b(l);case "number":return isFinite(l)?String(l):"null";case "boolean":case "null":return String(l);
case "object":if(!l)return"null";g+=m;var q=[];if("[object Array]"===Object.prototype.toString.apply(l)){c=l.length;for(a=0;a<c;a+=1)q[a]=d(a,l)||"null";return e=0===q.length?"[]":g?"[\n"+g+q.join(",\n"+g)+"\n"+f+"]":"["+q.join(",")+"]",g=f,e}if(n&&"object"==typeof n)for(c=n.length,a=0;a<c;a+=1){var A=n[a];"string"==typeof A&&(e=d(A,l),e&&q.push(b(A)+(g?": ":":")+e))}else for(A in l)Object.hasOwnProperty.call(l,A)&&(e=d(A,l),e&&q.push(b(A)+(g?": ":":")+e));return e=0===q.length?"{}":g?"{\n"+g+q.join(",\n"+
g)+"\n"+f+"}":"{"+q.join(",")+"}",g=f,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(b){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,m,l={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},n;"function"!=typeof AV.JSON.stringify&&(AV.JSON.stringify=function(a,b,c){var e;m=g="";if("number"==typeof c)for(e=0;e<c;e+=1)m+=" ";else"string"==typeof c&&(m=c);n=b;if(!b||"function"==typeof b||"object"==typeof b&&"number"==typeof b.length)return d("",{"":a});throw Error("AV.JSON.stringify");
});"function"!=typeof AV.JSON.parse&&(AV.JSON.parse=function(a,b){function e(a,c){var d,f,g=a[c];if(g&&"object"==typeof g)for(d in g)Object.hasOwnProperty.call(g,d)&&(f=e(g,d),void 0!==f?g[d]=f:delete g[d]);return b.call(a,c,g)}var d;a=String(a);c.lastIndex=0;c.test(a)&&(a=a.replace(c,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),"function"==typeof b?e({"":d},""):d;throw new SyntaxError("AV.JSON.parse");})})();
(function(a){a.build={version:"3.0.1.210",bundled:!1,MINIMUM_FLASH_PLAYER_VERSION:"10.2.0",feather_baseURL:"http://feather.aviary.com/3.0.1.210/",feather_baseURL_SSL:"https://dme0ih8comzn4.cloudfront.net/3.0.1.210/",feather_stickerURL:"http://feather.aviary.com/stickers/",feather_stickerURL_SSL:"https://dme0ih8comzn4.cloudfront.net/stickers/",imgrecvBase:"http://featherservices.aviary.com/",imgrecvBase_SSL:"https://featherservices.aviary.com/",featherTargetAnnounce:"http://featherservices.aviary.com/feather_target_announce_v3.html",
featherTargetAnnounce_SSL:"https://featherservices.aviary.com/feather_target_announce_v3.html",imgrecvServer:"http://featherservices.aviary.com/FeatherReceiver.aspx",imgrecvServer_SSL:"https://featherservices.aviary.com/FeatherReceiver.aspx",jsonp_imgserver:"http://featherservices.aviary.com/imgjsonpserver.aspx",jsonp_imgserver_SSL:"https://featherservices.aviary.com/imgjsonpserver.aspx",proxyServer:"http://featherservices.aviary.com/proxy.aspx",proxyServer_SSL:"https://featherservices.aviary.com/proxy.aspx",
asyncImgrecvBase:"http://api.aviary.com/",asyncImgrecvBase_SSL:"https://api.aviary.com/",partnerAssetURL:"http://api.aviary.com/getassets",partnerAssetURL_SSL:"https://api.aviary.com/getassets",asyncFeatherTargetAnnounce:"http://api.aviary.com/feather_target_announce_v3.html",asyncFeatherTargetAnnounce_SSL:"https://api.aviary.com/feather_target_announce_v3.html",asyncImgrecvCreateJob:"http://api.aviary.com/createjob",asyncImgrecvCreateJob_SSL:"https://api.aviary.com/createjob",asyncImgrecvGetJobStatus:"http://api.aviary.com/getjobstatus",
asyncImgrecvGetJobStatus_SSL:"https://api.aviary.com/getjobstatus",googleTracker:"UA-84575-16",inAppPurchaseFrameURL:"http://purchases.viary.com/gateway.aspx?p=flickr",filterServer:"http://featherservices.aviary.com/moa.ashx",filterServer_SSL:"https://featherservices.aviary.com/moa.ashx",featherFilterAnnounce:"http://featherservices.aviary.com/feather_filter_announce.html",featherFilterAnnounce_SSL:"https://featherservices.aviary.com/feather_filter_announce.html"}})(AV=window.AV||{});
"undefined"==typeof AV&&(AV={});AV.validLanguages={en:!0,zh_hant:!0,nl:!0,fr:!0,de:!0,it:!0,ja:!0,ko:!0,pl:!0,pt_br:!0,ru:!0,es:!0,android:!0,bg:!0,zh_hans:!0,cs:!0,da:!0,fi:!0,el:!0,he:!0,hu:!0,id:!0,no:!0,pt:!0,sk:!0,sv:!0,tr:!0,vi:!0,lv:!0,lt:!0,ca:!0,sl:!0};
(function(a,b,d){a.util={getX:function(a){for(var b=0;null!=a;)b+=a.offsetLeft,a=a.offsetParent;return b},getY:function(a){for(var b=0;null!=a;)b+=a.offsetTop,a=a.offsetParent;return b},getTouch:function(a){a.originalEvent&&(a=a.originalEvent);return a.changedTouches&&1==a.changedTouches.length?a.changedTouches[0]:a.touches&&1==a.touches.length?a.touches[0]:!1},getScaledDims:function(a,b,d,m){m=m||d;var c=a,f=b,g=a/b;if(a>d||b>m)a-d>g*(b-m)?(c=d,f=d*b/a+.5|0):(c=m*g+.5|0,f=m);return{width:c,height:f}},
nextFrame:function(a){setTimeout(a,1)},getDomain:function(a,b){var c="http://"==a.substr(0,7)?7:"https://"==a.substr(0,8)?8:"ftp://"==a.substr(0,6)?6:0;var d=a.indexOf("/",c);-1==d&&(d=a.length);b||(b=a.lastIndexOf(":"),b=b>c?a.substring(c,b):a.substring(c,d),b.match(/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/)||(b=a.lastIndexOf(".",d),b=a.lastIndexOf(".",b-1),c=-1==b?c:b+1));return a.substring(c,d)},extend:function(){var a,b,d,m=arguments[0]||{},l=1,n=arguments.length,q=!1;"boolean"===typeof m&&(q=m,m=arguments[1]||
{},l=2);"object"===typeof m||jQuery.isFunction(m)||(m={});n===l&&(m=this,--l);for(;l<n;l++)if(null!=(a=arguments[l]))for(b in a){var e=m[b];var p=a[b];m!==p&&(q&&p&&(jQuery.isPlainObject(p)||(d=jQuery.isArray(p)))?(d?(d=!1,e=e&&jQuery.isArray(e)?e:[]):e=e&&jQuery.isPlainObject(e)?e:{},m[b]=jQuery.extend(q,e,p)):void 0!==p&&(m[b]=p))}return m},findItemByKeyValueFromArray:function(a,b,d){var c;for(c=0;c<d.length;c++)if(d[c]&&d[c][a]&&d[c][a]===b){var f=d[c];break}return f},loadFile:function(){var a,
b=0,g;var m=function(a,b){if(b){var c=function(a){4!=this.readyState&&"complete"!=this.readyState&&"loaded"!=this.readyState||b(a)};"Microsoft Internet Explorer"==navigator.appName?a.onreadystatechange=c:a.onload=b}};return function(c,f,q){if("js"==f){var e=d.createElement("script");e.setAttribute("type","text/javascript");m(e,q);e.setAttribute("src",c)}else"css"==f?d.createStyleSheet?d.createStyleSheet(c,b++):(e=d.createElement("link"),e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),
e.setAttribute("href",c)):"img"==f&&(e=d.createElement("img"),m(e,q),e.setAttribute("src",c));e&&(a=a||d.getElementsByTagName("head")[0],"js"==f?a.appendChild(e):"css"==f&&(g=g||d.createDocumentFragment(),g.appendChild(e),a.insertBefore(e,void 0)));return e}}(),getImageElem:function(a){return"string"==typeof a?d.getElementById(a):a.length?a[0]:a},getImageId:function(a){return"string"==typeof a?a:a.id},imgOnLoad:function(a,b){a=avpw$(a);a.load(b);1!=a[0].complete&&4!=a[0].readyState&&"complete"!=a[0].readyState&&
"loaded"!=a[0].readyState||a.trigger("load")},color_is_white:function(a){a=a.toLowerCase();return"#fff"==a||"#ffffff"==a||"white"==a||"rgb(255,255,255)"==a||"rgb(255, 255, 255)"==a},color_is_light:function(b){b=a.util.color_to_array(b);return 127.5<.2*b[0]+.7*b[1]+.1*b[2]},color_expand:function(a){if(4==a.length){var b=a.charAt(1);var c=a.charAt(2);a=a.charAt(3);a="#"+b+b+c+c+a+a}return a},color_to_array:function(b){if("#"==b.charAt(0)){b=a.util.color_expand(b);var c=parseInt(b.substr(1,2),16);var d=
parseInt(b.substr(3,2),16);var m=parseInt(b.substr(5,2),16)}else"r"==b.charAt(0).toLowerCase()&&(b=a.util.rgb_to_color(b),c=parseInt(b.substr(1,2),16),d=parseInt(b.substr(3,2),16),m=parseInt(b.substr(5,2),16));return b=[c,d,m,1]},array_to_color:function(b){b=a.util.array_to_rgb(b);return b=a.util.rgb_to_color(b)},array_to_rgb:function(a){var b="rgb(0,0,0)";a.join&&(3<a.length&&(a=a.slice(0,3)),b="rgb("+a.join(",")+")");return b},color_to_rgb:function(b){b=a.util.color_to_array(b);return b=a.util.array_to_rgb(b)},
rgb_to_color:function(a){var b;if(b=a.match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/)){a=parseInt(b[1]).toString(16);1==a.length&&(a="0"+a);var c=parseInt(b[2]).toString(16);1==c.length&&(c="0"+c);b=parseInt(b[3]).toString(16);1==b.length&&(b="0"+b);return"#"+a+c+b}return a},color_to_int:function(b){b=a.util.color_expand(b);b=a.util.rgb_to_color(b);return parseInt(b.substr(1),16)},loadImagesSync:function(b,d){for(var c=0,f=b.length,l=0;l<f;l++){var n=b[l].img,q=b[l].src;n.onload=function(){c++;
d&&c==b.length&&a.util.nextFrame(d)};n.src=q}},getApiVersion:function(a){return a&&a.apiVersion?parseInt(a.apiVersion,10):1},getUserFriendlyToolName:function(a){var b={overlay:"Stickers",drawing:"Draw",textwithfont:"Text",colorsplash:"Splash",tiltshift:"Tilt Shift"},c="";a&&(c=b[a]||a.substr(0,1).toUpperCase()+a.substr(1));return c},addFontToPage:function(b,d){b||d&&d();var c=b.value;if(b.system)d&&d(b);else if(a.WebFont){var f={loading:function(){a.controlsWidgetInstance&&a.controlsWidgetInstance.showWaitThrobber(!0)},
active:function(){a.controlsWidgetInstance&&a.controlsWidgetInstance.showWaitThrobber(!1);d&&d(b)},inactive:function(){a.controlsWidgetInstance&&a.controlsWidgetInstance.showWaitThrobber(!1);a.errorNotify("UNSUPPORTED_FONT",[c]);d&&d()}};b.custom?(f.custom={families:[c],urls:[b.url]},f.active=function(){a.controlsWidgetInstance&&a.controlsWidgetInstance.showWaitThrobber(!1);d&&a.util.nextFrame(function(){d(b)},500)}):f.google={families:[c]};a.WebFont.load(f)}}}})(window.AV||(window.AV={}),window,
document);"undefined"===typeof AV&&(AV={});
AV.FlashAPI=function(){var a=null,b=function(){return function(a,b,c,d,n){n=n||{};var f={quality:"high",bgcolor:"#808080",allowscriptaccess:"always",allowfullscreen:"true"},e={};e.id=a;e.name=a;AV.msie&&9>AV.msie&&(e.align="center");a+="_replace";var g=n;n={};if(e&&"object"===typeof e)for(var l in e)n[l]=e[l];n.data=b;n.width=(c||"100%")+"";n.height=(d||"100%")+"";b={};if(f&&"object"===typeof f)for(var m in f)b[m]=f[m];if(g&&"object"===typeof g)for(var y in g)b.flashvars="undefined"!=typeof b.flashvars?
b.flashvars+("&"+y+"="+g[y]):y+"="+g[y];if(f=document.getElementById(a))if("undefined"==typeof n.id&&(n.id=a),AV.msie){var A="";for(x in n)n[x]!=Object.prototype[x]&&("data"==x.toLowerCase()?b.movie=n[x]:"styleclass"==x.toLowerCase()?A+=' class="'+n[x]+'"':"classid"!=x.toLowerCase()&&(A+=" "+x+'="'+n[x]+'"'));var x="";for(var z in b)b[z]!=Object.prototype[z]&&(x+='<param name="'+z+'" value="'+b[z]+'" />');f.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+A+">"+x+"</object>";
"undefined"==typeof objIdArr&&(objIdArr=[]);objIdArr[objIdArr.length]=n.id}else{z=document.createElement("object");z.setAttribute("type","application/x-shockwave-flash");for(var D in n)n[D]!=Object.prototype[D]&&("styleclass"==D.toLowerCase()?z.setAttribute("class",n[D]):"classid"!=D.toLowerCase()&&z.setAttribute(D,n[D]));for(A in b)b[A]!=Object.prototype[A]&&"movie"!=A.toLowerCase()&&(n=z,x=A,D=b[A],a=document.createElement("param"),a.setAttribute("name",x),a.setAttribute("value",D),n.appendChild(a));
f.parentNode.replaceChild(z,f)}}}(),d=function(){};d.prototype=function(){return{getPlugins:function(){return[]},createCanvas:function(){this.initsize?b("avpw_canvas_swf",AV.build.feather_baseURL+"canvas.swf",this.initsize.width,this.initsize.height):b("avpw_canvas_swf",AV.build.feather_baseURL+"canvas.swf")},_onComponentLoaded:function(a){switch(a){case "canvas":a=document.getElementById("avpw_canvas_swf"),AV.FlashAPI._onCanvasLoaded(a)}},_onComponentReady:function(a){var b=AV.paintWidgetInstance;
"canvas"===a&&b.canvasReadyCallback&&b.canvasReadyCallback.resolve()}}}();var c=function(){var a=[];return{init:function(){for(var b=0;256>b;b++)a[b]=String.fromCharCode(b);a[0]=String.fromCharCode(1)+String.fromCharCode(1);a[1]=String.fromCharCode(1)+String.fromCharCode(2)},shutdown:function(){a=[]},decode:function(a,b,c){b=[];for(var d,f=c=0,e=[0,0,1];f<a.length;)b[c++]=1!=(d=a.charCodeAt(f++))?d:e[a.charCodeAt(f++)];return b},encode:function(b){for(var c="",d=0;d<b.length;d+=4)c+=a[b[d+3]],c+=
a[b[d]],c+=a[b[d+1]],c+=a[b[d+2]];return c}}}();return function(){var b=!1,g=!1;return{mapToFlashToolName:function(a){switch(a){case "rotate":return"rotate90"}return a},mapFromFlashToolName:function(a){switch(a){case "rotate90":return"rotate"}return a},customBridge:function(a){var b=function(){};b.prototype=new d;b.prototype.constructor=d;for(var c in a)b.prototype[c]=a[c];return b},activate:function(a){this.bridge=a||new d;this.goldenEggCallback=null},setHiresSize:function(a,b){this.canvas&&this.canvas.setHiresSize(a,
b)},hiresSizeChanged:function(a,b){AV.paintWidgetInstance&&AV.paintWidgetInstance.actions&&AV.paintWidgetInstance.actions.setDims(a,b)},startEditing:function(a){this.canvas=null;this.active_target=a;this.bridge.createCanvas()},restartEditing:function(a){this.active_target=a;this._setupEditing()},close:function(){},runGoldenEgg:function(a,b,c,d){this.goldenEggCallback=d;this.canvas.renderGoldenEgg(a,b,c)},doCrop:function(){this.canvas.executeCrop()},activatePlugin:function(a){this.canvas.activatePlugin(a)},
deactivatePlugin:function(a){this.canvas.deactivatePlugin(a)},changeProperty:function(a,b){this.canvas.changeProperty(a,b)},applyPreviewFromPlugin:function(a){this.canvas.applyPreviewFromPlugin(a)},commitChangesFromPlugin:function(a){this.canvas.commitChangesFromPlugin(a)},discardChangesFromPlugin:function(a){this.canvas.discardChangesFromPlugin(a)},resizeCanvas:function(a,b){var c=this.canvas;c.width=a+"px";c.height=b+"px";AV.paintWidgetInstance&&AV.paintWidgetInstance.setDimensions(a,b)},hideCanvas:function(){this.canvas&&
(this.canvas.style.visibility="hidden")},showCanvas:function(){this.canvas&&(this.canvas.style.visibility="visible")},executePlugin:function(){this.canvas.executePlugin()},renderPreview:function(a,b){this.canvas.renderPreview(a,b)},getDynamicPropertyDefaultValue:function(a){return this.canvas.getDynamicPropertyDefaultValue(a)},syncProperty:function(a,b){},syncPreview:function(a){},setCanvasDataArray:function(a,b,c){AV.canvasDataReceiver&&AV.canvasDataReceiver.apply(this,[a,b,c])},setThumb:function(a,
b){},getHistory:function(){return this.canvas.getHistory()},getHiResStickerUrl:function(a){return AV.paintWidgetInstance&&AV.paintWidgetInstance.overlayRegistry?AV.paintWidgetInstance.overlayRegistry.getHiRes(a):null},getImageData:function(b,c){c&&"function"===typeof c&&(a=c);this.canvas.commit({})},getMaxSize:function(){return AV.launchData.maxEditSize||AV.launchData.maxSize},getMaxBitmapSize:function(){return AV.launchData.maxSize},_cropSelectionStarted:function(a,b,c){},_onPreviewRendered:function(a,
b){},_onPluginLoaded:function(a,b){b=AV.paintWidgetInstance;b.moduleLoadedCallback&&b.moduleLoadedCallback[a]&&b.moduleLoadedCallback[a].resolve()},_onImageLoaded:function(a,b){AV.paintWidgetLauncher_Flash_stage2&&AV.paintWidgetLauncher_Flash_stage2(a,b)},_onGoldenEggComplete:function(){this.goldenEggCallback&&this.goldenEggCallback()},_onCanvasLoaded:function(a){this.canvas=a;this._setupEditing(AV.launchData.url||null)},_onGetImageDataComplete:function(b){a&&(a.apply(this,[b]),a=null)},_setupEditing:function(a){var b=
this.bridge.getPlugins();a=a||this.active_target.src;this.canvas.setup(a,AV.build.proxyServer,b)},_canUndo:function(){return b},_onUndo:function(){this.canvas.undo()},_canRedo:function(){return g},_onRedo:function(){this.canvas.redo()},_onHistoryChange:function(a,c){b=a;g=c;AV.controlsWidgetInstance&&AV.controlsWidgetInstance.layoutNotify(AV.launchData.openType,"updateUndoRedo",[a,c])},setCheckpoint:function(a){this.canvas.setCheckpoint(a)},isACheckpoint:function(a){return this.canvas.isACheckpoint(a)},
undoToCheckpoint:function(){this.canvas.undoToCheckpoint()},redoToCheckpoint:function(){return this.canvas.redoToCheckpoint()},truncateActionList:function(){this.canvas.truncateActionList()},_onError:function(a,b){"BAD_IMAGE"===a&&(AV.paintWidgetCloser(!0),AV.launchData.url&&(a="BAD_URL"));AV.errorNotify(a,b)},init:function(a){AV.FlashAPI.activate(function(){if(!a)return new d;if(a.plugins){for(var b=[],c=a.plugins,f=0;f<c.length;++f){var e=AV.FlashAPI.mapToFlashToolName(c[f]),g=AV.toolDefaults[c[f]];
g&&g.files&&b.push({id:e,presets:g.presetsFlash,files:g.files})}0<b.length&&(a.getPlugins=function(){return b});delete a.plugins}c=function(){};c.prototype=new d;c.prototype.constructor=d;for(var m in a)c.prototype[m]=a[m];return new c}());c.init()},pibeca:c}}()}();
(function(a,b,d){a.AV=a.AV||{};var c=a.AV;c.ImageSizeTracker=function(a){var b=this;b.setImageScaledIndicator=function(){c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"updateImageScaledIndicator")};b.setOrigSize=function(a,d,f){if(a.hiresWidth&&a.hiresHeight){var g=parseInt(a.hiresWidth,10);a=parseInt(a.hiresHeight,10)}else if(a.hiresUrl)g=d.width,a=d.height;else if(a.displayImageSize)g=f.width,a=f.height;else return null;c.paintWidgetInstance.actions.setOrigSize(g,a);b.setImageScaledIndicator();
return{width:g,height:a}};b.isDisplayingImageSize=function(a){return a.hiresWidth||a.hiresHeight||a.displayImageSize};b.isUsingHiResDimensions=function(a){return a.hiresWidth||a.hiresHeight||a.displayImageSize&&a.hiresUrl}};return a})(this,"undefined"!==typeof window?window:{},"undefined"!==typeof document?document:{});
(function(a,b,d){a.AV=a.AV||{};var c=a.AV,f=c.Events;c.ToolManager=function(a){var g=null,l=function(b,c,e){return a.objectNotify("tool",b,c,e)},n=function(a){null!=a&&(avpw$(".avpw_controlpanel").each(function(){avpw$(this).hide()}),avpw$("#avpw_controlpanel_"+a).show())},q=function(){var e,d=function(d){l(g,"panelWillClose");l(d,"panelWillOpen");f.trigger("canvas:activate",a.panelMode2WidgetMode(d));n(d);l(d,"resetUI");b.setTimeout(function(a){return function(){l(a,"panelDidClose");g=d;l(d,"panelDidOpen");
e=!1}}(g),200);g=d;a.layoutNotify(c.launchData.openType,"disableZoomMode")};return function(a){e||(e=!0,d(a))}}(),e=function(b){if(!a.paintWidget||!a.paintWidget.busy){a.layoutNotify(c.launchData.openType,"showView",["editpanel"]);q(b);c.controlsWidgetInstance.onEggWaitThrobber.stop();if("mobile"==c.launchData.openType){var e;if(e=d.getElementById("avpw_main_"+b))if(e=e.getAttribute("data-header"))d.getElementById("avpw_control_toolname").innerHTML=e}c.usageTracker.addUsage(b)}},p=function(){f.on("tool:open",
w);f.on("tool:close",t);f.on("tool:init",y);f.on("tool:shutdown",z);f.on("tool:commit",A);f.on("tool:cancel",x);f.on("tool:undo",D);f.on("tool:redo",B)},t=function(){a.layoutNotify(c.launchData.openType,"showView",["main"]);q(null)},w=function(b,d){b=c.publicName2PanelMode(b);var g,l=a.activeTools,m=!1;if(l){var n=l.length;for(g=0;g<n;g++)if(l[g]===b){m=!0;break}}m||c.errorNotify("UNSUPPORTED_TOOL",[b]);m&&a.paintWidget&&!a.paintWidget.moduleLoaded(b,e)&&d&&(a.onEggWaitThrobber.stop(),a.onEggWaitThrobber.spin(avpw$(d).children(".avpw_icon_waiter")[0]));
f.trigger("usage:tool",b,"opened");f.trigger("usage:firstclick",b)},y=function(b){l(b,"init",[a])},A=function(){var a=g;if(a){var b=l(g,"commit");!1!==b&&(f.trigger("usage:tool",a,"applied",!0!==b?b:""),f.trigger("tool:commitDone"))}},x=function(){l(g,"cancel");f.trigger("usage:tool",g,"canceled")},z=function(a){l(a,"shutdown")},D=function(){f.trigger("usage:tool","undo","applied",g||"");a.paintWidget.actions.isACheckpoint()?a.paintWidget.busy||!1===l(g,"onUndo",[{global:!0}])||(a.paintWidget.actions.undoToCheckpoint(),
l(g,"onUndoComplete",[{global:!0}])):a.paintWidget.busy||!1===l(g,"onUndo")||(a.paintWidget.actions.undo(),l(g,"onUndoComplete"))},B=function(){f.trigger("usage:tool","redo","applied",g||"");if(a.paintWidget.busy||!1===l(g,"onRedo",[{global:!0}]))var b=!1;else(b=a.paintWidget.actions.redoToCheckpoint())&&l(g,"onRedoComplete",[{global:!0}]);b||a.paintWidget.busy||!1===l(g,"onRedo")||(a.paintWidget.actions.redo(),l(g,"onRedoComplete"))};this.init=p;this.shutdown=function(){f.off("tool:open",w);f.off("tool:close",
t);f.off("tool:init",y);f.off("tool:shutdown",z);f.off("tool:commit",A);f.off("tool:cancel",x);f.off("tool:undo",D);f.off("tool:redo",B)};this.notify=l;this.getActiveTool=function(){return g};p();return this};return a})(this,"undefined"!==typeof window?window:{},"undefined"!==typeof document?document:{});
(function(a,b,d){a.AssetManager=function(c,d){var f={EFFECT:"effect",STICKER:"sticker",IMAGEBORDER:"imageborder",PERMISSION:"permission",FONTPACK:"fontpack"},m={},l,n=function(b){var c=b.resourceUrl;c&&(-1===c.indexOf("http")&&(c=a.build.feather_baseURL+c),b.resourceUrl=c)},q=function(b){for(var c=0;c<l.length;c++)for(var e=0;e<b.length;e++)b[e].assetId===l[c].assetId&&(l[c].purchased=!0,a.util.extend(l[c],b[e]),n(l[c]))},e=function(a){var b=[];if(a){a=f[a];for(var c=0;c<l.length;c++)l[c].assetType===
a&&b.push(l[c])}else b=l.slice(0);return b},p=function(b,c){l?c&&c.apply(this,[e(b)]):(m.getPartnerAssets||(m.getPartnerAssets=[],z.authenticate()),m.getPartnerAssets.push(function(d){d&&d.assets?l=d.assets:(a.errorNotify("ERROR_AUTHENTICATING"),y());a.util.nextFrame(function(){if(l){for(var a=0;a<l.length;a++)n(l[a]);c&&c.apply(this,[e(b)])}})}))},t=function(a,c){b.setTimeout(function(){try{return b.avpw_purchase_frame.postMessage("getAssets","*"),m.getAssets=c,!0}catch(G){return!1}},2E3)},w=function(a,
c){if(!l)return t(a,function(b){l=b;for(b=0;b<l.length;b++)n(l[b]);x(a,c)}),!1;try{return b.avpw_purchase_frame.postMessage("getPurchasedAssets","*"),m.getPurchasedAssets=function(b){q(b);c&&c.apply(this,[e(a)])},!0}catch(G){return!1}},y=function(b,c){l=[{needsPurchase:!1,assetId:"default_effects",assetType:"effect",displayName:"Default",resourceUrl:"js/proclist_default_effects.js"},{needsPurchase:!1,assetId:"original_effects",assetType:"effect",displayName:"Original",resourceUrl:"js/proclist_original_effects.js"},
{needsPurchase:!1,assetId:"original_stickers",assetType:"sticker",displayName:"Original",resourceUrl:"js/stickers_original_stickers.js"},{needsPurchase:!1,assetId:"borders",assetType:"imageborder",displayName:"Default Image Borders",resourceUrl:"js/borders_original.js"}];c&&a.util.nextFrame(function(){for(var a=0;a<l.length;a++)n(l[a]);c.apply(this,[e(b)])});return!0},A=function(a){var b,c;if(a.messageName&&(c=m[a.messageName]))if("function"===typeof c)c.apply(this,[a.data]);else{var e=c.length;for(b=
0;b<e;b++)c[b].apply(this,[a.data])}},x=c?p:d?w:y,z=this;z.getAssets=x;z.getById=function(a){for(var b=0;b<l.length;b++)if(l[b].assetId===a)return l[b]};z.showAssetPurchaseView=function(c,e){var d={messageName:"showAssetPurchaseView",assetId:c};d=a.JSON.stringify(d);try{return b.avpw_purchase_frame.postMessage(d,"*"),m.showAssetPurchaseView=function(){z.showAssetPurchasePopup(c,e)},!0}catch(L){return!1}};z.showAssetPurchasePopup=function(b,c){avpw$("#avpw_purchase_frame").show();a.controlsWidgetInstance.messager.show("avpw_purchase_pack",
!0);avpw$("#avpw_purchase_pack_close").bind("click",z.hideAssetPurchasePopup);m.getPurchasedAssets=function(a){q(a);a=z.getById(b);c&&"function"===typeof c&&a&&c.apply(this,[a]);z.hideAssetPurchasePopup()}};z.hideAssetPurchasePopup=function(){m.getPurchasedAssets=null;avpw$("#avpw_purchase_frame").hide();a.controlsWidgetInstance.messager.hide("avpw_purchase_pack");avpw$("#avpw_purchase_pack_close").unbind("click",z.hideAssetPurchasePopup)};z.authenticate=function(){var b=function(a){A({messageName:"getPartnerAssets",
data:a})};return function(){return a.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_auth_form",action:a.build.partnerAssetURL,method:"POST",dataType:"json",announcer:a.build.asyncFeatherTargetAnnounce,origin:a.build.asyncImgrecvBase,keyValues:{apikey:a.launchData.apiKey,timestamp:a.launchData.timestamp,signature:a.launchData.signature,salt:a.launchData.salt,encryptionmethod:a.launchData.encryptionMethod},callback:b})}}();z.types=f;d&&(b.avpw_purchase_frame||avpw$("#avpw_messaging").append(a.template[a.launchData.layout].inAppPurchaseFrame({src:a.build.inAppPurchaseFrameURL})));
return z}})(window.AV||(window.AV={}),window,document);
(function(a,b,d){a.ServerMessaging=function(c){var f=[],g=function(b,c){var e=!0,d=f.shift();if(d){c&&d.origin&&(e=c===a.util.getDomain(d.origin));if(d.id){c=avpw$("#"+d.id);var g=c.attr("target");avpw$("#"+g).unbind("load");avpw$("#"+d.id+"_target_holder").empty();c.remove()}if(e&&d.callback){if(d.dataType&&"json"===d.dataType&&"string"===typeof b)try{b=a.JSON.parse(b)}catch(B){}d.callback.call(this,b)}}0<f.length&&t()},m=function(b,c,e,d,f){return avpw$.ajax({url:b,type:c,data:e,dataType:d,error:function(){a.errorNotify("ERROR_SAVING",
[a.build.imgrecvServer])},success:f})},l=function(a,b,c){c||(c="");b||(b=a);return['<iframe width="1" height="1" style="position:absolute;left:-9999px;" ','id="'+a+'" name="'+b+'" src="'+c+'">',"</iframe>"].join("")},n=function(a,b,c){if(!a)return null;var d=a+"_target_holder",f="avpw_form_target_"+Math.floor(4294967295*Math.random()).toString(16),g=avpw$("#"+d);g&&g.length||(g=avpw$('<div id="'+d+'"></div>').css({position:"absolute",top:0,left:0}).appendTo("#avpw_holder"));g.html(l(f));b?avpw$("#"+
f).load(function(){e(f,a,b)}):avpw$("#"+f).load(c);return f},q=function(a,b,c,e,f,g,l){e=n(a,g,l);b+="?responsecontenttypeheader="+escape("text/html");a=avpw$("<form></form>").attr({id:a,action:b,target:e,method:c||"POST"}).css({display:"none"});c=d.createDocumentFragment();for(var m in f)f.hasOwnProperty(m)&&c.appendChild(avpw$("<input></input>").attr({name:m,value:f[m],type:"hidden"})[0]);a.html(c);a.appendTo("#avpw_holder");a.submit();return a},e=function(c,e,d){var f=e+"_announcer";if(b.postMessage)b[f]?
b[f].postMessage("avpw_load:"+c,"*"):(e=avpw$(l(f,f,d)),e.load(function(){a.util.nextFrame(function(){b[f].postMessage("avpw_load:"+c,"*")})}),avpw$("#avpw_holder").append(e));else{var m=e+"_observer",n=0;var q=avpw$(l(m,m,d+"#"+c))[0];avpw$(q).load(function(){var b;try{if("about:blank"==q.contentWindow.location)return}catch(J){}2===n&&(b=q.contentWindow.name)&&(n=3,b!==m&&b.substr&&"avpw:"==b.substr(0,5)?(b=b.substr(5),g(b)):(a.errorNotify("ERROR_SAVING",[a.build.imgrecvServer]),g()),avpw$(q).unbind().remove());
1===n&&(n=2,q.contentWindow.location="");n||(n=1)});avpw$(q).appendTo("#avpw_holder")}},p=function(b){var c=b.data;b=a.util.getDomain(b.origin);c.substr&&"avpw:"==c.substr(0,5)&&(c=c.substr(5),g(c,b))},t=function(){var a=f[0];a&&q(a.id,a.action,a.method,a.origin,a.keyValues,a.announcer)},w=function(a){a.announcer?(f.push(a),1===f.length&&t()):q(a.id,a.action,a.method,a.origin,a.keyValues,a.announcer,a.callback)};this.shutdown=function(){b.removeEventListener?b.removeEventListener("message",p,!1):
b.detachEvent&&b.detachEvent("onmessage",p);f=[]};this.sendMessage=function(b){var c;"xhr"===(b.transport||"xhr")&&avpw$.support.cors&&(!a.firefox||4<=a.firefox)?(c=m(b.action,b.method,b.keyValues,b.dataType,b.callback))||w(b):w(b)};b.addEventListener?b.addEventListener("message",p,!1):b.attachEvent&&b.attachEvent("onmessage",p);return this}})(window.AV||(window.AV={}),window,document);
(function(a,b,d){a.AV=a.AV||{};var c=a.AV,f=c.Events;c.usageTracker=function(){var a=null,d=[],l,n={},q=function(){c.controlsWidgetInstance&&n.submit("close")},e=function(a,b,c){},p=function(a,b,c){},t=function(a){n.submit("firstclick",a);f.off("usage:firstclick")};n.setup=function(){avpw$(b).bind("unload",q);f.on("usage:submit",n.submit,n);f.on("usage:tool",e,n);f.on("usage:firstclick",t,n);f.on("usage:interact",p)};n.shutdown=function(){avpw$(b).unbind("unload",q);f.off("usage:submit",n.submit);
f.off("usage:tool",e);f.off("usage:firstclick",t);f.off("usage:interact",p)};n.clear=function(){a=null;d=[]};n.getUUID=function(){return a?a:a=Math.floor(4294967295*Math.random()).toString(16)+Math.floor(4294967295*Math.random()).toString(16)};n.addUsage=function(a,b){};n.setPageCount=function(a){var b;d=Array(a);for(b=0;b<a;b++)d[b]=0};n.addPageHit=function(a){a!==l&&d[a]++;l=a};n.submit=function(a,b){};return n}();c.getActiveTools=function(a){var b=c.featherUseFlash?c.flashSupportedTools:c.defaultTools,
d=a;d&&"all"!==d&&"All"!==d&&"ALL"!==d&&""!==d||(d=b);"string"===typeof d&&(d=a.split(","));a=[];var f={},g;for(g=0;g<b.length;g++){var e=b[g];f[e]=!0}for(g=0;g<d.length;g++)e=c.publicName2PanelMode(d[g]),e in f&&a.push(e);return a};c.paintWidgetGetPopupEmbedDiv=function(a){var b=avpw$("#avpw_canvas_embed_popup");if(a){var c=avpw$(a),f,g="top left bottom right margin-top margin-right margin-bottom margin-left border-top border-right border-bottom border-left padding-top padding-right padding-bottom padding-left".split(" "),
e={position:"relative"};for(f=0;f<g.length;f++){var p=g[f];e[p]=c.css(p)}c=avpw$(a).css("display");if(""==c||"inline"==c)c="inline-block";e.display=c;0==b.length&&(b=d.createElement("div"),b.id="avpw_canvas_embed_popup");avpw$(b).hide().css(e).insertBefore(a)}return b};c.paintWidgetLauncher=function(a,b){if(!c.paintWidgetInstance)return c.usageTracker.clear(),c.featherUseFlash?c.paintWidgetLauncher_Flash(a,b):c.paintWidgetLauncher_HTML(a,b)};c.paintWidgetLauncher_Flash=function(a,m){function g(){avpw$(B).unbind("load",
g);c.msie&&7==c.msie&&(avpw$("#avpw_controls").css("visibility","hidden"),avpw$("#avpw_controls").show());c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"placeControls_Flash",[1<c.util.getApiVersion(c.launchData)?c.launchData.appendTo:void 0]);c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"enableControls");t=c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"getScaledImageDims_Flash",[B]);w=t.width;y=t.height;A=w>y?w:y;c.launchData.maxEditSize=A;c.paintWidgetInstance=
new c.PaintWidget(w,y,new c.Actions,new c.ModeManager,new c.FilterManager,new c.OverlayRegistry,new c.ImageBorderManager);c.paintWidgetInstance.setOrigSize(w,y);var d=c.template[c.launchData.layout].flashCanvasBox({id:"avpw_canvas_swf_replace"});avpw$(D).append(d);c.controlsWidgetInstance.initAllTools.call(c.controlsWidgetInstance);var l={initsize:t,plugins:x,action:{origUrl_:m?m:e.src,sessionID_:c.usageTracker.getUUID(),referrerUrl_:b.location.href,url:c.build.imgrecvServer,name:"file"}};c.controlsWidgetInstance.layoutNotify(c.launchData.openType,
"hideOriginalImage",[e]);c.util.nextFrame(function(){c.controlsWidgetInstance.setupScrollPanels()});c.msie&&7==c.msie&&(avpw$("#avpw_controls").hide(),avpw$("#avpw_controls").css("visibility","visible"));avpw$("#avpw_controls").fadeIn(q);c.launchData.noCloseButton&&avpw$("#avpw_control_cancel_pane").css("display","none");setTimeout(function(){c.FlashAPI.init(l);c.FlashAPI.startEditing(a);c.controlsWidgetInstance.initWithPaintWidget(c.paintWidgetInstance);f.trigger("tool:close");c.controlsWidgetInstance.loaderPhase=
1},q)}function n(){c.util.imgOnLoad(B,g);avpw$(B).attr("src",m?m:p)}var q=c.launchData.launchDelay,e=c.util.getImageElem(a),p=e.src,t,w,y,A;var x=c.getActiveTools(c.launchData.tools);var z=new c.AssetManager(c.launchData.isPremiumPartner,c.launchData.allowInAppPurchase);c.controlsWidgetInstance=new c.ControlsWidget(null,a,x,z,new c.ServerMessaging);c.controlsWidgetInstance.origURL=m?m:avpw$(e).attr("src");avpw$(".avpw_isa_previewcanvas").hide();var D=c.controlsWidgetInstance.layoutNotify(c.launchData.openType,
"getEmbedElement",[e]);avpw$(D).show();var B=d.createElement("img");avpw$(B).css({display:"block",visibility:"hidden",position:"absolute"}).attr("src",m?m:e.src);c.build.bundled?n():c.util.loadFile(c.build.feather_baseURL+"js/featherpaint_flash.js","js",n)};c.paintWidgetLauncher_Flash_stage2=function(a,b){c.controlsWidgetInstance.loaderPhase=2;c.controlsWidgetInstance.imageSizeTracker.setOrigSize(c.launchData,{width:a,height:b},{width:c.paintWidgetInstance.width,height:c.paintWidgetInstance.height});
c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"launchStage2_Flash");c.controlsWidgetInstance.showWaitThrobber(!1);avpw$(c.controlsWidgetInstance.onEggWaitThrobber).hide();f.trigger("usage:submit","launch");c.fireLaunchComplete()};c.paintWidgetLauncher_HTML=function(a,b){var f=c.launchData.launchDelay,g=c.util.getImageElem(a),m;var e=c.getActiveTools(c.launchData.tools);c.isRelaunched&&"undefined"!=typeof g.avpw_prevURL&&(b=g.avpw_prevURL);var p=new c.AssetManager(c.launchData.isPremiumPartner,
c.launchData.allowInAppPurchase);c.controlsWidgetInstance=new c.ControlsWidget(null,a,e,p,new c.ServerMessaging);c.controlsWidgetInstance.origURL=b?b:avpw$(g).attr("src");c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"placeControls",[1<c.util.getApiVersion(c.launchData)?c.launchData.appendTo:void 0]);c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"enableControls");avpw$("#avpw_controls").fadeIn(f);c.util.nextFrame(function(){"mobile"==c.launchData.openType&&c.setPageWidth(avpw$("#avpw_controls").width());
c.controlsWidgetInstance.setupScrollPanels()});c.launchData.noCloseButton&&avpw$("#avpw_control_cancel_pane").css("display","none");if(g&&"canvas"===g.nodeName.toLowerCase())c.mockLauncher(g);else{var t=c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"getEmbedElement",[g]);var w=d.createElement("img");w.id="avpw_temp_loading_image";c.tempLoadingImageSrc=w.src;avpw$(w).load(function(){m=c.controlsWidgetInstance.getScaledDims(avpw$(g).width(),avpw$(g).height());w.width=m.width;w.height=
m.height;c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"getScaledImageDims",[w]);avpw$(w).unbind();w.style.display="block";avpw$(t).append(w);c.controlsWidgetInstance.showWaitThrobber(!0);c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"hideOriginalImage",[g]);avpw$(t).show();c.util.nextFrame(function(){c.build.bundled?c.paintWidgetLauncher_stage2(a,b):c.util.loadFile(c.build.feather_baseURL+"js/featherpaint.js","js",function(e){c.paintWidgetLauncher_stage2(a,b)})})}).error(function(){c.paintWidgetCloser(!0);
c.errorNotify("BAD_IMAGE",[b])});w.src=g.src;return!1}};c.mockLauncher=function(a){var b=c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"getEmbedElement",[a]);c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"getScaledImageDims",[a]);avpw$(a).detach();avpw$(b).append(a);avpw$(b).show();c.controlsWidgetInstance.showWaitThrobber(!0);c.util.nextFrame(function(){var a=function(){};c.controlsWidgetInstance.initAllTools=function(){for(var a in this.activeTools){var b=this.activeTools[a];
this.tool.hasOwnProperty(b)&&f.trigger("tool:init",b)}};c.controlsWidgetInstance.initWithPaintWidget=function(a){this.paintWidget=a;this.initAllTools();this.bindControls();this.paintWidget.showWaitThrobber=this.showWaitThrobber.AV_bindInst(this)};c.controlsWidgetInstance.loaderPhase=1;c.paintWidgetInstance={moduleLoaded:function(a,b){return b.call(this)},setMode:a,setCurrentLayerByName:a,shutdown:a,actions:{setCheckpoint:a}};c.controlsWidgetInstance.initWithPaintWidget(c.paintWidgetInstance);c.controlsWidgetInstance.showWaitThrobber(!1);
c.controlsWidgetInstance.loaderPhase=2;c.fireLaunchComplete()})};c.paintWidgetLauncher_stage2=function(a,b){var d=c.util.getImageElem(a),g;var m=c.controlsWidgetInstance.getScaledDims(avpw$(d).width(),avpw$(d).height());c.controlsWidgetInstance.loaderPhase=1;c.paintWidgetInstance=new c.PaintWidget(m.width,m.height,new c.Actions,new c.ModeManager,new c.FilterManager,new c.OverlayRegistry,new c.ImageBorderManager);c.controlsWidgetInstance.canvasUI=new c.PaintUI(c.paintWidgetInstance.canvas,c.controlsWidgetInstance.layoutNotify(c.launchData.openType,
"getEmbedElement"));c.controlsWidgetInstance.initWithPaintWidget(c.paintWidgetInstance);c.paintWidgetInstance.setOrigSize(m.width,m.height);c.controlsWidgetInstance.imageSizeTracker.setOrigSize(c.launchData,d,m);var e=avpw$("#avpw_temp_loading_image");c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"scaleCanvas");(function(a){c.controlsWidgetInstance&&c.paintWidgetInstance&&(g=new Image,avpw$(g).load(function(a){if(c.controlsWidgetInstance&&c.paintWidgetInstance){m=c.controlsWidgetInstance.getScaledDims(g.width,
g.height);c.controlsWidgetInstance.imageSizeTracker.setOrigSize(c.launchData,g,m);g.width=m.width;g.height=m.height;c.paintWidgetInstance.setDimensions(m.width,m.height);if(!c.paintWidgetInstance.setBackground(g))return c.paintWidgetCloser(!0),c.errorNotify("IMAGE_NOT_CLEAN",[b]),!1;c.paintWidgetInstance.setOrigSize(m.width,m.height);d.src!==b&&c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"scaleCanvas");avpw$(c.paintWidgetInstance.canvas).insertBefore("#avpw_temp_loading_image");e.remove();
c.tempLoadingImageSrc=b;c.controlsWidgetInstance.showWaitThrobber(!1);c.controlsWidgetInstance.loaderPhase=2;c.launchData.actionListJSON&&c.paintWidgetInstance.actions.importJSON(c.launchData.actionListJSON,c.fireLaunchComplete)}}).attr("src",a))})(b);f.trigger("usage:submit","launch");c.launchData.actionListJSON||c.fireLaunchComplete();return!1};c.fireLaunchComplete=function(){var a=c.launchData.initTool;a&&c.util.nextFrame(function(){f.trigger("tool:open",a)});if("function"===typeof c.launchData.onReady)c.launchData.onReady()};
c.paintWidgetShutdown=function(){f.trigger("usage:submit","close");c.paintWidgetInstance&&c.paintWidgetInstance.shutdown();c.controlsWidgetInstance&&(c.controlsWidgetInstance.serverMessaging&&(c.controlsWidgetInstance.serverMessaging.shutdown(),c.controlsWidgetInstance.serverMessaging=null),c.controlsWidgetInstance.shutdown());c.featherUseFlash&&c.FlashAPI.close();avpw$("#avpw_controls").hide();c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"onShutdown");if("function"===typeof c.launchData.onClose)c.launchData.onClose(c.paintWidgetInstance.dirty);
c.paintWidgetInstance=null;c.controlsWidgetInstance=null;c.tempLoadingImageSrc=null};c.paintWidgetCloser=function(a){var b=c.launchData.closeDelay;c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"onClose",[a]);a||0===b?(avpw$("#avpw_controls").hide(),c.paintWidgetShutdown()):avpw$("#avpw_controls").fadeOut(b,function(){c.paintWidgetInstance&&c.paintWidgetShutdown()})};c.controlsWidget_saveResponder=function(a,b,d){var g;"function"===typeof a&&(g=a.apply(c.launchData,[c.util.getImageId(c.controlsWidgetInstance.paintImgIdElem),
b,d]));c.controlsWidgetInstance&&(c.util.getImageElem(c.controlsWidgetInstance.paintImgIdElem).avpw_prevURL=b,f.trigger("tool:close"),g&&c.controlsWidgetInstance.messager.show("avpw_aviary_beensaved",!0),c.controlsWidgetInstance.paintWidget.dirty=!1,c.controlsWidgetInstance.saving=!1)};c.controlsWidget_onImageSaved=function(a,b){c.controlsWidget_saveResponder(c.launchData.onSave,a,b)};c.controlsWidget_onHiResImageSaved=function(a){c.controlsWidget_saveResponder(c.launchData.onSaveHiRes,a)};c.ControlsWidget=
function(a,b,d,n,q){this.maxHeight=this.maxWidth=parseInt(c.launchData.maxSize);this.saving=!1;this.origURL=null;this.activeTools=d;this.quitCount=0;c.usageTracker.setup();this.paintImgIdElem=b;f.on("layout:resize",this.setupScrollPanels,this);this.layoutNotify(c.launchData.openType,"showView",["main"]);a&&this.initWithPaintWidget(a);a={className:"avpw_tool_spinner",lines:12,length:6,width:2,radius:6,color:"#fff",speed:.5,trail:70};"mobile"!=c.launchData.openType&&(a.color="#555",a.length=4);this.waitThrobber=
new c.Spinner({className:"avpw_canvas_spinner",lines:12,length:6,width:2,radius:6,color:"#fff",speed:.5,trail:70});this.onEggWaitThrobber=new c.Spinner(a);this.toolManager=new c.ToolManager(this);this.assetManager=n;this.serverMessaging=q};c.ControlsWidget.prototype.tool={};c.ControlsWidget.prototype.layout={};c.ControlsWidget.prototype.layoutNotify=function(a,b,c){return this.objectNotify("layout",a,b,c)};c.ControlsWidget.prototype.objectNotify=function(a,b,c,d){return"object"==typeof this[a][b]&&
(a=this[a][b],"function"==typeof a[c])?(c=a[c],d||(d=[]),c.apply(a,d)):!0};c.ControlsWidget.prototype.shutdown=function(){this.canvasUI&&this.canvasUI.shutdown();this.messager&&this.messager.hide();f.off("layout:resize",this.setupScrollPanels);this.shutdownAllTools();this.unbindControls();this.toolsPager&&(this.toolsPager.shutdown(),this.toolsPager=null);this.paintWidget&&(this.paintWidget.showWaitThrobber=null);c.usageTracker.shutdown();this.waitThrobber.stop();this.onEggWaitThrobber.stop();this.onEggWaitThrobber=
this.waitThrobber=null;this.showPanel(null);this.toolManager.shutdown();this.toolManager=null};c.ControlsWidget.prototype.initAllTools=function(){c.paintWidgetInstance.filterManager.loadPack("tools");for(var a in this.activeTools){var b=this.activeTools[a];this.tool.hasOwnProperty(b)&&c.paintWidgetInstance.moduleLoaded(b,function(a){f.trigger("tool:init",a)}.AV_bindInst(this))}};c.ControlsWidget.prototype.shutdownAllTools=function(){for(var a in this.activeTools)f.trigger("tool:shutdown",this.activeTools[a])};
c.ControlsWidget.prototype.bindControls=function(){};c.ControlsWidget.prototype.unbindControls=function(){};c.ControlsWidget.prototype.initWithPaintWidget=function(a){this.paintWidget=a;this.imageSizeTracker=new c.ImageSizeTracker(a.actions);c.featherUseFlash||this.initAllTools();this.bindControls();this.paintWidget.showWaitThrobber=this.showWaitThrobber.AV_bindInst(this)};c.ControlsWidget.prototype.showWaitThrobber=function(a,d){a?(a=this.layoutNotify(c.launchData.openType,"getEmbedElement"),a.is(":visible")&&
(this.waitThrobber.spin(a[0]),avpw$(this.waitThrobber).fadeIn(300))):avpw$(this.waitThrobber.el).fadeOut(300,this.waitThrobber.stop);d&&b.setTimeout(d,5)};c.publicName2PanelMode=function(a){"stickers"===a&&(a="overlay");"draw"===a&&(a="drawing");"text"!==a||c.featherUseFlash||(a="textwithfont");return a};c.ControlsWidget.prototype.panelMode2WidgetMode=function(a){switch(a){case "rotate":return"rotate90";case "greeneye":return"redeye";case "pinch":return"bulge"}return a};c.ControlsWidget.prototype.setupScrollPanels=
function(){if(this.activeTools&&this.activeTools.length){var a,b,d=this,n=this.layoutNotify(c.launchData.openType,"getDims").TOOLS_BROWSER_WIDTH,q={itemCount:this.activeTools.length,itemsPerPage:this.layoutNotify(c.launchData.openType,"getToolsPerPage"),pageWidth:n,leftArrow:avpw$("#avpw_lftArrow"),rightArrow:avpw$("#avpw_rghtArrow"),itemBuilder:function(e){a=d.activeTools[e];b=c.util.getUserFriendlyToolName(a);b=c.getLocalizedString(b);return c.template[c.launchData.layout].eggIcon({optionName:a,
capOptionName:b})},pageTemplate:c.template[c.launchData.layout].genericScrollPanel,pipTemplate:c.template[c.launchData.layout].scrollPanelPip,lastPageTemplate:void 0,lastPageContents:{},pageContainer:avpw$("#avpw_control_main_scrolling_region"),pipContainer:avpw$("#avpw_tools_pager ul"),onPageChange:function(a){c.usageTracker.addPageHit(a)}};d.toolsPager=new c.Pager(q);avpw$("#avpw_control_main_scrolling_region").css("width",d.toolsPager.getPageCount()*n+"px");this.assetManager.getAssets("PERMISSION",
function(a){var b=!0;if(a)for(var e=0;e<a.length;e++)if(a[e]&&"whitelabel"===a[e].assetId){b=!1;break}b&&(avpw$("#avpw_powered_branding").html(c.template[c.launchData.layout].poweredByFooterLogo).click(function(){f.trigger("modal:show","avpw_aviary_aviaryfeedback",!1,!1)}),d.toolsPager.shutdown(),d.toolsPager=new c.Pager(q),avpw$("#avpw_control_main_scrolling_region").css("width",d.toolsPager.getPageCount()*n+"px"),d.toolsPager.changePage())});c.usageTracker.setPageCount(d.toolsPager.getPageCount());
d.toolsPager.changePage()}};c.ControlsWidget.prototype.messager=function(){var a={},d,l,n,q={show:function(e,f,g){d=d||avpw$("#avpw_messaging");l=l||avpw$("#avpw_messaging_inner");e=a[e]||(a[e]=avpw$("#"+e));l.append(e);d.fadeIn(150);f?(d.data("needsConfirmation",!0),c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"disableControls")):(d.data("needsConfirmation",!1),g||b.setTimeout(this.hide,1E3))},hide:function(e,f){d=d||avpw$("#avpw_messaging");n=n||avpw$("#avpw_messages");e?(e=a[e])&&
n.append(e):avpw$.each(a,function(a,b){n.append(b)});d.data("needsConfirmation")?(b.setTimeout(function(){f&&f()},400),c.controlsWidgetInstance&&c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"enableControls")):(d.hide(),f&&f())},addMessage:function(a){n=n||avpw$("#avpw_messages");a&&(n[0].innerHTML+=a)}};f.on("modal:show",q.show);f.on("modal:hide",q.hide);return q}();c.ControlsWidget.prototype.orientationChanged=function(a){};c.ControlsWidget.prototype.windowResized=function(){var a=
null;return function(c){b.clearTimeout(a);a=b.setTimeout(function(){f.trigger("layout:resize");a=null},500)}}();c.ControlsWidget.prototype.Slider=function(a){var b=!1,c=function(c,e){!b&&a.onstart&&a.onstart.apply(this,[c,e])},d=function(c,e){!b&&a.onchange&&a.onchange.apply(this,[c,e])},f=function(c,e){!b&&a.onslide&&a.onslide.apply(this,[c,e])},e=avpw$(a.element).slider({range:"min",max:a.max,min:a.min,value:a.defaultValue||a.max/2,delay:a.delay});this.getValue=function(){return e.slider("value")};
this.setValue=function(a){return e.slider("value",a)};this.reset=function(c){b=!0;this.setValue(a.defaultValue);b=!1};this.addListeners=function(){e.bind("slidestart",c).bind("slidechange",d).bind("slide",f)};this.removeListeners=function(){e.unbind("slidestart").unbind("slide").unbind("slidechange")};this.shutdown=function(){e.slider("destroy")};return this};c.ControlsWidget.prototype._drawUICircle=function(a,b,d,f,q){c.featherUseFlash||this._drawUICircle_HTML(a,b,d,f,q)};c.ControlsWidget.prototype._drawUICircle_HTML=
function(a,b,d,f,q){a=avpw$(a)[0];var e=a.getContext("2d");e.clearRect(0,0,a.width,a.height);q&&"transparent"!==f&&this._drawUIGrid(e,a.width,a.height);e.globalCompositeOperation="source-over";null!=d?(q&&("transparent"==d||c.util.color_is_white(d)||null==f)?e.strokeStyle="#444":e.strokeStyle=d,d=3):(e.strokeStyle="rgba(0,0,0,0)",d=1);e.lineWidth=d;e.beginPath();e.arc(a.width/2,a.height/2,b,0,2*Math.PI,!0);e.stroke();e.closePath();null!=f&&(e.save(),e.clip(),q&&"transparent"==f?this._drawUIGrid(e,
a.width,a.height):(e.fillStyle=f,e.fillRect(0,0,a.width,a.height)),e.restore())};c.ControlsWidget.prototype._drawUIGrid=function(a,b,c,d){var f;d||(d=5);for(f=0;f<c+d;f+=d)for(b=0;b<c+d;b+=d)a.fillStyle=1==(b+f&1)?"#fff":"#ddd",a.fillRect(b,f,d,d)};c.ControlsWidget.prototype.showPanel=function(a){null!=a&&(avpw$(".avpw_controlpanel").each(function(){avpw$(this).hide()}),avpw$("#avpw_controlpanel_"+a).show())};c.ControlsWidget.prototype.save=function(){var a=null,d=!0,l=function(){return{apikey:c.launchData.apiKey,
timestamp:c.launchData.timestamp,signature:c.launchData.signature,salt:c.launchData.salt,encryptionmethod:c.launchData.encryptionMethod}},n=function(a,b){var e=c.controlsWidgetInstance;e.layoutNotify(c.launchData.openType,"enableControls",[!0]);e.paintWidget.showWaitThrobber(!1);a?(avpw$(c.util.getImageElem(e.paintImgIdElem)).avpw_prevURL=a,c.controlsWidget_onHiResImageSaved(a)):(c.errorNotify("ERROR_SAVING",[c.build.asyncImgrecvBase,b]),c.controlsWidgetInstance.saving=!1)},q=function(a){var b="";
if("string"===typeof a){var e=a.split("---FEATHER-POSTMESSAGE---");var d=e[0];e=e[1]}else{var f=avpw$(a).find("error");if(0<f.length)b=f.text();else{if(f=avpw$(a).find("url"))d=f.text(),d=d.replace(/^\s+|\s+$/g,"");if(a=avpw$(a).find("hiresurl"))e=a.text(),e=e.replace(/^\s+|\s+$/g,"")}}a=c.controlsWidgetInstance;a.layoutNotify(c.launchData.openType,"enableControls",[!0]);a.paintWidget.showWaitThrobber(!1);d?(avpw$(c.util.getImageElem(a.paintImgIdElem)).avpw_prevURL=d,c.controlsWidget_onImageSaved(d,
e)):(c.errorNotify("ERROR_SAVING",[c.build.imgrecvServer,b]),c.controlsWidgetInstance.saving=!1)},e=function(){var a=this;a.paintWidget.exportImage(null,function(b){var e=b.indexOf(";",0),d=b.indexOf(",",e);b.slice(5,e);b=b.slice(d+1);c.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_save_form",action:c.build.imgrecvServer,method:"POST",announcer:c.build.featherTargetAnnounce,origin:c.build.imgrecvBase,keyValues:c.util.extend(l(),{file:b,postdata:c.launchData.postData,posturl:c.launchData.postUrl,
sessionid:c.usageTracker.getUUID(),actionlist:a.paintWidget.actions.exportJSON(!0),origurl:a.origURL,hiresurl:c.launchData.hiresUrl,contenttype:c.launchData.fileFormat,jpgquality:c.launchData.jpgQuality,debug:c.launchData.debug,asyncsave:c.launchData.asyncSave,usecustomfileexpiration:c.launchData.useCustomFileExpiration,encodedas:"base64text"}),callback:q})})},p=function(){var e=c.util.extend(l(),{actionlist:this.paintWidget.actions.exportJSON(!0),origurl:c.launchData.hiresUrl,fileformat:c.launchData.fileFormat,
notificationmethod:"GET",backgroundcolor:"0xffffffff",jpgquality:c.launchData.jpgQuality}),f=function(c){!c||c&&"JobFailed"===c.JobStatusCode?(n(null),b.clearInterval(a)):c&&"JobCompleted"===c.JobStatusCode&&(b.clearInterval(a),n(c.JobStatus));d=!0};c.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_save_form",action:c.build.asyncImgrecvCreateJob,method:"POST",dataType:"json",announcer:c.build.asyncFeatherTargetAnnounce,origin:c.build.asyncImgrecvBase,keyValues:e,callback:function(e){if(e&&
e.JobId){var g=e.JobId;a=b.setInterval(function(){d&&c.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_save_form",action:c.build.asyncImgrecvGetJobStatus,method:"POST",dataType:"json",announcer:c.build.asyncFeatherTargetAnnounce,origin:c.build.asyncImgrecvBase,keyValues:c.util.extend(l(),{jobid:g}),callback:f});d=!1},1E3)}else n(null)}})},t=function(a,b,e){this.paintWidget.exportImage(e,function(e){var d=c.controlsWidgetInstance;d.saving=!1;d.layoutNotify(c.launchData.openType,"enableControls",
[!0]);d.paintWidget.showWaitThrobber(!1);a&&"function"===typeof a&&(b?b=!1===a(e)?!1:!0:a(e));b&&c.util.nextFrame(function(){c.controlsWidget_onImageSaved(d.origURL)})})},w=function(a,b,d,f){var g=!c.featherUseFlash;g&&this.layoutNotify(c.launchData.openType,"disableControls");this.paintWidget.showWaitThrobber(g,function(){switch(a){case "saveHiRes":p.call(l);break;case "getImageData":t.call(l,b,d,f);break;default:e.call(l)}});var l=this;return!1};return function(a,b,e,d){if(2>c.controlsWidgetInstance.loaderPhase||
this.saving)return!1;f.trigger("tool:commit");f.trigger("tool:close");this.saving=!0;c.prevActionList=this.paintWidget.actions.exportJSON(!0);c.launchData.postData&&"string"!==typeof c.launchData.postData&&(c.launchData.postData=c.JSON.stringify(c.launchData.postData));return w.apply(this,[a,b,e,d])}}();c.ControlsWidget.prototype.onSaveButtonClicked=function(a){f.trigger("usage:submit","saveclicked");return"function"===typeof c.launchData.onSaveButtonClicked&&!1===c.launchData.onSaveButtonClicked.apply(c.launchData,
[c.util.getImageId(c.controlsWidgetInstance.paintImgIdElem)])?!1:c.controlsWidgetInstance.save()};c.ControlsWidget.prototype.showAreYouSure=function(){this.messager.show("avpw_aviary_quitareyousure",!0)};c.ControlsWidget.prototype.cancel=function(a){this.quitCount++;a=0<this.quitCount&&this.paintWidget&&this.paintWidget.dirty;if("function"===typeof c.launchData.onCloseButtonClicked&&!1===c.launchData.onCloseButtonClicked.apply(c.launchData,[a]))return!1;a?this.showAreYouSure():c.paintWidgetCloser();
return!1};c.ControlsWidget.prototype.getScaledDims=function(a,b){return c.util.getScaledDims(a,b,this.maxWidth,this.maxHeight)};c.TransformStyle=function(a){var b=a||"";this.set=function(a){if(b)for(var c in a){var d=!1;b=b.replace(new RegExp(c+"\\([^\\)]*"),function(b,f,g){d=!0;return c+"("+a[c]});d||(b+=" "+c+"("+a[c]+")")}else for(c in a)b+=" "+c+"("+a[c]+")"};this.serialize=function(){return b};return this};return a})(this,"undefined"!==typeof window?window:{},"undefined"!==typeof document?document:
{});
(function(a,b,d){a.errorNotify=function(b,d){b={BAD_IMAGE:{code:1,message:"There was a problem loading your image provided to the `image` config key. Either it's not actually an image file or it doesn't really exist."},UNSUPPORTED:{code:2,message:"It looks like you're using a browser that doesn't support the HTML canvas element (and also doesn't have Flash installed either). Please try accessing this page through a modern browser like Chrome, Firefox, Safari, or Internet Explorer (version 9 or higher). Your internets will thank you."},BAD_URL:{code:3,
message:"There was a problem loading your image provided by URI to the `url` config key. It is not reachable by the public (and our service at "+(a.featherUseFlash?a.build.proxyServer:a.build.imgrecvBase)+")"},UNSUPPORTED_TOOL:{code:4,message:"So sorry, but this tool is not available because it is not part of the set chosen with the `tools` config key. It's alternatively possible that your browser does not support this specific tool."},IMAGE_NOT_CLEAN:{code:5,message:"Uh oh! We can't edit this image because the editor wasn't set up correctly to load external files via their address. You must either provide images from the same domain as the web page with the editor OR pass the external image address via the `url` config key in order for Aviary to be able to get permission from the browser to open it for editing. Sorry for the inconvenience!"},
UNSUPPORTED_FONT:{code:6,message:"So sorry, but this font looks to be unsupported by your browser or platform"},ERROR_SAVING:{code:7,message:"There was a problem saving your photo. Please try again."},NO_APIKEY:{code:8,message:"apiKey is required and not provided. See http://www.aviary.com/web-documentation#constructor-config-apikey."},ERROR_AUTHENTICATING:{code:9,message:"There was a problem retrieving access to content from our server. Please ensure all authentication keys are present or do not attempt premium partner authentication."},
ERROR_BAD_THEME:{code:10,message:"Selected theme does not exist. Please use 'dark', 'light' or 'minimum' or see aviary.com/web for more info."}}[b];var c=b.message;"function"===typeof a.launchData.onError&&(b.args=d,c=a.launchData.onError(b)||c);return c}})(window.AV||(window.AV={}),window,document);
(function(a,b,d){a.AV=a.AV||{};var c=a.AV,f=c.Events;a.Aviary=c;c.feather_loaded=!1;c.feather_loading=!1;c.build=c.build||{version:"",imgrecvServer:"imgrecvserver",flashGatewayServer:"",imgrecvBase:"",inAppPurchaseFrameURL:"",imgtrackServer:"imgtrackserver",filterServer:"",jsonp_imgserver:"",featherTargetAnnounce:"feather_target_announce_v3.html",proxyServer:"",feather_baseURL:"",feather_stickerURL:"",googleTracker:"",MINIMUM_FLASH_PLAYER_VERSION:"10.2.0"};c.defaultTools="enhance effects frames overlay crop resize orientation focus brightness contrast saturation warmth sharpness colorsplash drawing textwithfont redeye whiten blemish".split(" ");
c.flashSupportedTools="enhance effects overlay crop resize orientation brightness contrast saturation sharpness drawing text redeye blemish".split(" ");c.baseConfig={image:null,apiKey:void 0,apiVersion:1,appendTo:null,language:"en",theme:null,minimumStyling:!1,maxSize:800,noCloseButton:!1,launchDelay:300,closeDelay:300,tools:void 0,initTool:"",cropPresets:["Original","Custom",["Square","1:1"],"3:2","3:5","4:3","4:5","4:6","5:7","8:10","16:9"],cropPresetDefault:"Custom",cropPresetsStrict:!1,url:null,
postUrl:void 0,postData:null,fileFormat:"",jpgQuality:100,displayImageSize:!1,hiresMaxSize:1E4,hiresWidth:null,hiresHeight:null,onLoad:void 0,onReady:void 0,onSaveButtonClicked:void 0,onSave:void 0,onSaveHiRes:void 0,onClose:void 0,onError:void 0,signature:null,timestamp:null,hiresUrl:void 0,useCustomFileExpiration:!1,allowInAppPurchase:!1,forceFlash:!1,forceSupport:!1,poweredByURL:"http://www.aviary.com",giveFeedbackURL:"http://www.aviary.com/feature-requests",getWidgetURL:"http://www.aviary.com",
debug:!1,asyncSave:!0};(function(a){var b=function(a){return{language:a.Feather_Language,forceFlash:a.Feather_ForceFlash,forceSupport:a.AV_Feather_ForceSupport,onLoad:a.Feather_OnLoad,onReady:a.Feather_OnLaunchComplete,onClose:a.Feather_OnClose,onSave:a.Feather_OnSave,noCloseButton:a.Feather_NoCloseButton,maxSize:a.Feather_MaxSize||a.Feather_MaxDisplaySize,tools:a.Feather_EditOptions,cropPresets:a.Feather_CropSizes,resizePresets:a.Feather_ResizeSizes,apiKey:a.Feather_APIKey,hiresUrl:a.Feather_HiResURL,
postUrl:a.Feather_PostURL,fileFormat:a.Feather_FileFormat||a.Feather_ContentType,jpgQuality:a.Feather_FileQuality,signature:a.Feather_Signature,timestamp:a.Feather_Timestamp}};c.baseConfig=c.util.extend(c.baseConfig,b(a));if("https:"==a.location.protocol||"chrome-extension:"==a.location.protocol){var d;for(d in c.build){var f=d.split("_SSL");2===f.length&&c.build[d]&&(f=f[0],c.build[f]=c.build[d])}}(a.Feather_Theme||a.Feather_OpenType||a.Feather_APIKey)&&c.util.nextFrame(function(){var d=new c.Feather(c.baseConfig);
a.aviaryeditor=function(e,f,g,l){c.launchData=c.util.extend(c.baseConfig,b(a));e=c.util.extend(c.launchData,{image:e,url:f,postData:g,appendTo:l});d.launch(e)};a.aviaryeditor_close=d.close;a.aviaryeditor_relaunch=d.relaunch;a.aviaryeditor_activatetool=d.activateTool;a.aviarynewimage=d.replaceImage})})(b);c.getLocalizedString=function(a){try{var b=c.lang[c.launchData.language][a];void 0===b&&(b=a);return b}catch(l){}return a};Function.prototype.AV_bindInst=function(a){var b=this;return function(){return b.apply(a,
arguments)}};c.injectControls=function(){if("popup"==c.launchData.openType){var a="";var b=c.template[c.launchData.layout].saveBlock()}else a=c.template[c.launchData.layout].saveBlock(),b="";if(c.criticalLayoutStyles&&!c.feather_loaded){var f=d.createElement("style");f.type="text/css";var n=d.createTextNode(c.criticalLayoutStyles);f.styleSheet?f.styleSheet.cssText=n.nodeValue:f.appendChild(n);d.getElementsByTagName("head")[0].appendChild(f)}a=c.template[c.launchData.layout].controls({internalSaveBlock:a,
externalSaveBlock:b});b=d.createElement("div");b.id="avpw_holder";f="";c.featherUseFlash&&(f="avpw_flash ");c.msie&&(f+="avpw_ie"+c.msie);f&&(b.className=f);(f=d.getElementsByTagName("body"))&&(f=f[0]);f||(f=d.documentElement);f.appendChild(b);b.innerHTML=a};c.Feather=function(a){var g=this,l=function(){c.injectControls();c.util.nextFrame(c.loadStageFinal)},n=function(){"undefined"!==typeof avpw$?avpw$(d).ready(l):l()};a&&(a.openType="aviary",a.layout="desktop");a=a||{};c.launchData=c.util.extend(c.baseConfig,
a);a=function(){function a(a){c.util.loadFile(c.build.feather_baseURL+"css/"+a+".css","css")}c.featherUseFlash=!c.featherHtmlOk()&&c.featherFlashOk();c.launchData.language=c.launchData.language.toLowerCase();if(!c.feather_loaded&&!c.feather_loading){c.feather_loading=!0;var b=c.launchData.language||"en";var e="js/feathercontrols_desktop";e=c.validLanguages&&c.validLanguages[b]?e+("_"+b+".js"):e+"_en.js";c.launchData.minimumStyling?a("feather_core"):a("feather_theme_aviary");c.util.loadFile(c.build.feather_baseURL+
"images/aviary_atlas.png","img");c.build.bundled?n():c.util.loadFile(c.build.feather_baseURL+e,"js",n)}};var q=function(){c.featherUseFlash=!c.featherHtmlOk()&&c.featherFlashOk();c.launchData.language=c.launchData.language.toLowerCase();if(!c.feather_loaded&&!c.feather_loading){c.feather_loading=!0;var a=c.launchData.language||"en";var b="js/feathercontrols_desktop";b=c.validLanguages&&c.validLanguages[a]?b+("_"+a+".js"):b+"_en.js";!c.launchData.theme&&c.launchData.minimumStyling&&(c.launchData.theme=
"minimum");"minimum"==c.launchData.theme&&(c.launchData.minimumStyling=!0);c.launchData.theme||(c.launchData.theme="dark");switch(c.launchData.theme){case "dark":case "light":case "minimum":break;default:c.errorNotify("ERROR_BAD_THEME")}a=c.launchData.minimumStyling?"feather_core_":"feather_theme_aviary_";a+=c.launchData.theme;c.util.loadFile(c.build.feather_baseURL+"css/"+a+".css","css");c.build.bundled?n():c.util.loadFile(c.build.feather_baseURL+b,"js",n)}};if(2===c.util.getApiVersion(c.launchData)){c.build.feather_baseURL=
b.location.protocol+"//feather.aviary.com/2.6.2.182/";c.build.feather_baseURL_SSL=b.location.protocol+"//dme0ih8comzn4.cloudfront.net/2.6.2.182/";if("https:"==b.location.protocol||"chrome-extension:"==b.location.protocol)for(var e in c.build)q=e.split("_SSL"),2===q.length&&c.build[e]&&(q=q[0],c.build[q]=c.build[e]);a()}else q();var p=function(){if(c.paintWidgetInstance)return!1;var a=c.util.getImageElem(c.launchData.image);c.paintWidgetLauncher(a,c.launchData.url)};g.launch=function(a){if(!c.feather_loaded)return!1;
var b=d.getElementById("avpw_holder");b||c.injectControls();if(c.paintWidgetInstance){if(b)return!1;g.close(!0)}a&&a.language&&delete a.language;c.launchData=a?c.util.extend(c.launchData,a):c.launchData;if(!c.launchData.image)return c.errorNotify("BAD_IMAGE"),!1;c.launchData.image=c.util.getImageElem(c.launchData.image);if(c.featherUseFlash)p();else{if(!c.featherSupported())return c.errorNotify("UNSUPPORTED")&&(c.controlsWidgetInstance=new c.ControlsWidget,c.controlsWidgetInstance.layoutNotify(c.launchData.openType,
"placeControls",[1<c.util.getApiVersion(c.launchData)?c.launchData.appendTo:void 0]),c.controlsWidgetInstance.bindControls(),d.getElementById("avpw_controls").style.display="block",c.controlsWidgetInstance.messager.show("avpw_aviary_unsupported",!0)),!0;c.util.nextFrame(p)}return!0};g.showWaitIndicator=function(){return c.controlsWidgetInstance&&c.controlsWidgetInstance.showWaitThrobber?(c.controlsWidgetInstance.showWaitThrobber(!0),!0):!1};g.hideWaitIndicator=function(){return c.controlsWidgetInstance&&
c.controlsWidgetInstance.showWaitThrobber?(c.controlsWidgetInstance.showWaitThrobber(!1),!0):!1};g.getImageDimensions=function(){var a=null;c.paintWidgetInstance&&(a=c.paintWidgetInstance.getScaledSize(),c.launchData.hiresWidth&&c.launchData.hiresHeight||(delete a.hiresWidth,delete a.hiresHeight));return a};g.save=function(){return c.paintWidgetInstance?c.controlsWidgetInstance.save():!1};g.saveHiRes=function(){return c.paintWidgetInstance?c.controlsWidgetInstance.save("saveHiRes"):!1};g.getImageData=
function(a,b,e){return c.paintWidgetInstance?c.controlsWidgetInstance.save("getImageData",a,b,e):!1};g.close=function(a){if(!c.paintWidgetInstance)return!1;c.paintWidgetCloser(a)};g.relaunch=function(){f.trigger("usage:interact","api","relaunch");c.isRelaunched=!0;if(c.launchData)g.launch(c.launchData);else return!1};g.activateTool=function(a){f.trigger("tool:open",a,c.controlsWidgetInstance)};g.replaceImage=function(a){f.trigger("usage:interact","api","replaceImage");if(c.launchData)g.close(!0),
c.util.nextFrame(function(){c.launchData.url=a;g.launch(c.launchData)});else return!1};g.updateConfig=function(a,b){if(c.launchData)if(a&&"object"===typeof a)for(var e in a)a.hasOwnProperty(e)&&(c.launchData[e]=a[e]);else if(a&&"string"===typeof a)c.launchData[a]=b;else return!1;else return!1};g.getIsDirty=function(){return c.paintWidgetInstance?c.paintWidgetInstance.dirty:!1};g.getActionList=function(){if(c.paintWidgetInstance)return f.trigger("tool:commit"),c.paintWidgetInstance.actions.exportJSON(!0)};
g.disableControls=function(){c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"disableControls")};g.enableControls=function(){c.controlsWidgetInstance.layoutNotify(c.launchData.openType,"enableControls")};g.on=function(a,b){if(f&&a&&b&&"function"===typeof b)f.on(a,b)};g.off=function(a,b){f&&a&&b&&"function"===typeof b&&f.off(a,b)};return g};c.loadStageFinal=function(){c.feather_loaded=!0;if("function"===typeof c.launchData.onLoad)c.launchData.onLoad()};c.featherSupported=function(){return c.featherHtmlOk()||
c.featherFlashOk()||c.launchData.forceSupport};c.featherFlashOk=function(){return c.launchData.forceFlash?!0:avpw_swfobject&&avpw_swfobject.hasFlashPlayerVersion(c.build.MINIMUM_FLASH_PLAYER_VERSION)};c.featherHtmlOk=function(){if(c.launchData.forceFlash)return!1;var a=!!d.createElement("canvas").getContext,f="function"===typeof b.postMessage;return a&&f};c.getFlashMovie=function(a){return b[a]||d[a]};c.msie=function(){for(var a=3,b=d.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML=
"\x3c!--[if gt IE "+ ++a+"]><i></i><![endif]--\x3e",c[0];);return 4<a?a:void 0}();c.firefox=function(){if("Gecko"===b.navigator.product){var a=navigator.userAgent.split("Firefox/")[1];a=parseInt(a,10)}return a}();c.PAGE_WIDTH=360;c.setPageWidth=function(a){c.PAGE_WIDTH=a};return a})(this,"undefined"!==typeof window?window:{},"undefined"!==typeof document?document:{});
(function(a,b,d){a.support=function(a){var b=a.navigator.userAgent,c=a.screen.width;a={0:/Android/i,1:/webOS/i,2:/iPhone/i,3:/iPod/i,4:/BlackBerry/i,5:/iPad/i};var m,l=0,n=0,q=0,e;for(e in a)b.match(a[e])&&(m=parseInt(e));b.match(/AppleWebKit/i)&&(l=1);0===m&&(n=1);1===n&&(b=b.match(/Android [0-9].[0-9]/).toString())&&(q=parseFloat(b.split("Android ")[1]));b={isAppleWebkit:function(){return 1===l},isMobileWebkit:function(){return 1===l&&c&&(480>=c||0<q&&2.3>=q)},isIPhoneOrIPod:function(){return 2===
m||3===m},isAndroid:function(){return 1===n},getAndroidVersion:function(){return q}};b.getVendorProperty=function(){var a={};return function(b){var c;if(!(c=a[b])){a:{var e=d.createElement("div");c=b;var f=["webkit","ms","Moz","O"],g,l=e.style;if(void 0===l[c]){c=c.charAt(0).toUpperCase()+c.slice(1);for(g=0;g<f.length;g++)if(e=f[g]+c,void 0!==l[e]){c=e;break a}c=void 0}}c=a[b]=c}return c}}();return b}(b)})(window.AV||(window.AV={}),window,document);
var FEATHER_EDITOR,FEATHER_CONFIGS={apiKey:"ivi35oh8nmumnuhp",apiVersion:3,theme:"dark",tools:"all",appendTo:"",maxSize:1E3,language:browser.lang,onSaveButtonClicked:function(){var a=this;FEATHER_EDITOR.getImageData(function(b){var d=b.substring(22),c=new FormData;c.append("url",a.url);c.append("image",d);c.append("type","png");bm.ajax({contentType:!1,processData:!1,cache:!1,url:FEATHER_EDITOR.saveUrl,type:"post",data:c,beforeSend:function(a){a.setRequestHeader("base64_encoded","true")},success:function(){FEATHER_EDITOR.close();
FEATHER_EDITOR.afterSave&&FEATHER_EDITOR.afterSave(b)}})});return!1},onSave:function(a,b){},onClose:function(){return!1},onError:function(a){}};
Aviary.launchEditor=function(a,b,d){function c(){FEATHER_EDITOR.launch({image:$("<img src='"+a+"'>")[0],url:a})}AV.feather_loaded?(FEATHER_EDITOR=new Aviary.Feather(FEATHER_CONFIGS),c()):($(document.body).loader(),FEATHER_EDITOR=new Aviary.Feather($.extend({onLoad:function(){$(document.body).loader(!1);c()}},FEATHER_CONFIGS)));FEATHER_EDITOR.saveUrl=b||a;FEATHER_EDITOR.afterSave=d;return!1};bm.view={};
$.extend(bm,{alert:function(a,b,d){var c=$("<div><div class='header-line'><span class='icon "+b+"'></span><span class='ok'></span></div><div class='body'><span class='message content'></span></div></div>"),f=c.find(".ok").text($.i18n.prop("ok"));return c.popup({is_fixed:!0,is_always_up:!0,clazz:"alert-popup "+b,content:a,events:{render:function(a){f.click(function(){d&&d(0);a.close(0)});if(d)a.on("close",function(a,b){b&&d(1)})}}}).obj(POPUP)},attachModernUiPanel:function(){var a=this,b=a.body.find(".modern-list-left-panel");
if(b.length){var d=$.extend({thumbPanel:$(),url:"",thumb_menu_entries:[],thumbMenuClick:function(a){},leftNavigationClick:function(a){}},a.leftPanelConfig||{});b.find(".left-panel-btn button").click(function(){function c(){if(m.validate()){var c=m.elm.val();bm.ajax({show_response_status:!1,url:d.url,data:{name:c},success:function(c){a.reload(c.id,!0,function(a){b.find(".item-thumb[item-id="+a+"]").trigger("click")})},error:function(a,b,c){m.elm.focus();m.showError({msg_template:c.message,msg_params:[],
rule:void 0})}})}else m.elm.focus()}var f=b.find(".item-thumb.new-item"),g=b.find(".body .selected").attr("item-id");if(f.length)f.find(".item-title").focus();else{f=d.thumbPanel.clone();a.body.find(".left-panel .item-wrapper").prepend(f);var m=ValidationField.createDetachedField(f.find("input"),{error_position:"after"}),l=!1;f.find(".item-title").focus().on("keyup.key_return",function(){c()}).on("blur",function(){l||a.reload(g,!0);l=!1});f.find(".tool-icon.apply").mousedown(function(){l=!0}).click(function(){c()})}});
bm.menu(d.thumb_menu_entries,a.body.find(".left-panel .float-menu-navigator"),null,{hide:function(a){a.parent().removeClass("float-menu-opened")},click:function(b,f){f=f.closest(".item-thumb").config("item");d.thumbMenuClick.call(a,b,f)}},"click",["center bottom","right+22 top+7"]);a.body.find(".item-thumb").on("click",function(b){var c=$(this);$(b.target).is(".float-menu-navigator")||(a.body.find(".item-thumb.selected").removeClass("selected"),c.addClass("selected"),b=c.attr("item-id"),a.reload(b))});
b.find(".one-line-scroll-content").scrollbar({show_vertical:!1,show_horizontal:!0,use_bar:!1,visible_on:"auto",horizontal:{handle:{left:b.find(".left-scroller"),right:b.find(".right-scroller")},step:"auto"}});b.find(".navigation-button").on("click",function(){var b=$(this);d.leftNavigationClick.call(a,b.attr("item-type"))})}},autoToggle:function(a){function b(b){var c=b.filter(":radio");b=b.not(c);var e=[];c.each(function(){var d=$(this),f=d.attr("name");if(!e.contains(f)){e.push(f);var g=c.filter("[name='"+
f+"']:checked");g.length||(g=a.find("[name='"+f+"']:checked"));g.length||(g=d);b=b.add(g)}});return b}function d(a,c,e){var d=a.find("[toggle-target]");a.is("[toggle-target]")&&(d=d.add(a));d=b(d);d.each(function(){var a=$(this),b=a.is("select, :checkbox, :radio")?"change":"click";c?a.triggerHandler(b+"."+g,[!1,e]):a.triggerHandler(b+"."+g,[!0,e])})}function c(a,b,c,f){a.each(function(){var a=$(this);if(!f||!a.is(f)){var e=a.is("[do-reverse-toggle]"),g=b;e&&(g=!b);e="none"==a.css("display");g&&e?
(g=function(){d(a,!0,f)},c?a.show(c,g):(a.show(),g())):g||e?d(a,g,f):(g=function(){var b=a.find('[validation]:not([validate-on="call-only"])');a.is("[validation]")&&(b=b.add(a));b.trigger('[validation]:not([validate-on="call-only"])');d(a,!1,f);a.find("input").valid()},c?a.hide(c,g):(a.hide(),g()))}})}function f(b){var c=!1;a.find("[toggle-target]").each(function(){var e=$(this).attr("toggle-target");$(this).is("select")?$(this).find("option").each(function(){var d="."+e+"-"+$(this).val();if(b.closest(d,
a[0]).length)return c=!0,!1}):c=b.closest("."+e,a[0]).length;if(c)return!1});return c}var g=bm.getUUID(),m=function(b){var c=b;b.each(function(){var b=$(this);if(b.is("select")){var d=b.val().replaceAll("\\.","_");b=a.find("."+b.attr("toggle-target")+"-"+d)}else b=a.find("."+b.attr("toggle-target"));b.length&&(d=b.find("[toggle-target]"),d=d.add(b.filter("[toggle-target]")),d.length&&(c=c.add(m(d))))});return c},l=a.find("[toggle-target]").each(function(){var b=$(this),d=b.attr("toggle-anim")?b.attr("toggle-anim"):
"blind";"none"==d&&(d=null);if(b.is("select"))b.on("change."+g,function(e,f,g){"boolean"!=typeof f&&(f=!1,g=null);var l=b.val().replaceAll("\\.","_"),n="."+b.attr("toggle-target")+"-"+l,q=$();b.find("option").each(function(c,e){c=$(e).val().replaceAll("\\.","_");c!=l&&(c=b.attr("toggle-target")+"-"+c,c=a.find("."+c),q=q.add(c.not(n)))});n=a.find(n);e=g?g.add(m(n)):m(n);c(q,!1,d,e);c(n,f?!1:!0,d,g)});else if(b.is(":checkbox, :radio")){var e=function(e,f,g,l){"boolean"!=typeof f&&(f=!1,g=null);if(!f){e=
a.find("[name='"+b.attr("name")+"']").not(b).filter("[toggle-target]:not([independent])");var n=$();e.each(function(b,c){b=a.find("."+$(c).attr("toggle-target"));n=n.add(b.not(w))});c(n,!1,d,l?g?g.add(m(w)):m(w):g)}e=b.prop("checked");b.state=e;b.is(".toggle-reverse")&&(e=!e);c(w,f?!1:e,d,g,l)};var f="change";var l="."+b.attr("toggle-target"),w=a.find(l);b.on(f+"."+g,function(a,b,c){e(a,b,c,!0)});if(b.is(":radio"))a.find("[name='"+b.attr("name")+"']:radio").not("[toggle-target]").on(f+"."+g,function(a,
c,d){"boolean"!=typeof c&&(d=null);(b.state||void 0===b.state)&&e(a,!0,d)})}else f="click",w=a.find("."+b.attr("toggle-target")),b.on(f+"."+g,function(a,e,f){a="true"==b.attr("row-expanded");"undefined"==typeof e&&(a=!a,b.attr("row-expanded",""+a));c(w,e?!1:a,d,f)})});b(l).each(function(){var a=$(this),b=a.is("select, :checkbox, :radio")?"change":"click";f(a)||a.triggerHandler(b+"."+g,[!1])});return a},brandAndManufacturerSelectionPopup:function(a,b){var d=b.url||app.baseUrl+"brandAdmin/selectBrandAndManufacturer",
c=b.title||$.i18n.prop("select.brands.or.manufacturers"),f=b.emphasized,g=b.success;var m=b.brandField||"brand";var l=b.manufacturerField||"manufacturer";var n=b.preview_panel||a,q=b.previewer||function(a,b){n.find("input[name='"+m+"'], input[name='"+l+"']").remove();b.find("input:hidden[name]").each(function(){var a=$(this).attr("name");a=$("<input type='hidden' name='"+a+"' value='"+$(this).val()+"'>");n.append(a)})},e={},p=e[m]=[],t=e[l]=[];n.find("input:hidden[name]").each(function(){var a=$(this),
b=a.attr("name");e[b].push(a.val())});e=$.extend({brandField:m,manufacturerField:l,brand:p,manufacturer:t},b.data);return bm.editPopup(d,c,f,e,{width:850,events:{content_loaded:function(){var a=bm.twoSideSelection(this,10,"brand","brandAdmin/loadBrandForSelection",{view:!1,edit:!1,"column-sort":!1},[m]),b=$('<span class="tool-icon remove-search" style="display: none"></span>'),c=this.find("input.search-text"),e=this.find(".search-form");e.prepend(b);a.beforeLoadTableContent=function(a){var e={searchText:c.val()};
$.extend(a,e);c.val()?b.show():b.hide()};this.find("select[name='selection-type']").change(function(){"brand"==this.value?a.setUrl("brandAdmin/loadBrandForSelection","brand",{view:!1,edit:!1,"column-sort":!0},[m]):a.setUrl("manufacturerAdmin/loadManufacturerForSelection","manufacturer",{view:!1,edit:!1,"column-sort":!0},[l])});e.form({preSubmit:function(){a.reload();return!1}});b.on("click",function(){c.val("");a.reload()})}},beforeSubmit:function(b,c,e){var d={};d[m]=[];d[l]=[];b.find("input:hidden[name]").each(function(){var a=
$(this),b=a.attr("name"),c=a.parents("tr");d[b].push({name:c.find("td:eq(0)").text().trim(),value:a.val()})});q(d,b,n);a.trigger("change");e.close();return!1},success:g})},cBaseDoc:function(a){var b=$("<div id='documentation-slide' style='display: none'><div class='icon-block'><span class='tool-icon close-icon' title='"+$.i18n.prop("close")+"'></span></div><iframe src='about:blank'></iframe></div>"),d=$(document.body);a.each(function(){var a=$(this);a.attr("attached")||(a.click(function(){var c=a.attr("target-url");
b.is(":hidden")&&(d.prepend(b),b.css({height:window.innerHeight}),b.find(".tool-icon.close-icon").click(function(){b.toggle("slide",{direction:"right"},function(){d.find("#documentation-slide").remove()})}),b.toggle("slide",{direction:"right"}));b.find("iframe").attr("src",c)}),a.attr("attached",!0))})},clearTextSelection:function(a){a||(a=document);var b=null,d=a.defaultView;d.getSelection?b=d.getSelection():a.selection&&(b=a.selection);b&&(b.empty&&b.empty(),b.removeAllRanges&&b.removeAllRanges())},
confirm:function(a,b,d,c,f){f||(f={});$.extend(f,{focus_button_class:"yes-button"});var g=$("<div><div class='header-line'><span class='title'></span><span class='icon close'></span></div><div class='body'><span class='message content'></span></div><div class='button-line'></div></div>");g.find(".title").text($.i18n.prop("confirmation"));return g.popup({close_on_escape:!1,is_fixed:!0,is_always_up:!0,clazz:"confirm-popup "+(f.clazz?f.clazz:""),content:a,events:{render:function(a){var l=this.find(".button-line");
g.find(".icon").click(function(){a.close()});if(b instanceof Array)b.every(function(){var b=this,c=$("<button class='"+b.clazz+"'></button>");c.text($.i18n.prop(b.text));l.append(c);c.on("click",function(){b.handler.call(a);a.close()});c.focus()});else if(b){if(d&&(m=$("<button class='no-button'></button>"),m.text($.i18n.prop("no")),l.append(m),m.click(function(){$.isFunction(d)&&d.call(a);a.close()}),c)){var m=$("<button class='cancel-button'></button>");m.text($.i18n.prop("cancel"));l.append(m);
m.click(function(){$.isFunction(c)&&c();a.close()})}m=$("<button class='yes-button'></button>");m.text($.i18n.prop("yes"));l.append(m);m.click(function(){a.close();b.call(a)})}if(0!=f.focus_button_class){var q=l.find("."+f.focus_button_class).addClass("confirm-focus");a.el.on("keyup",function(a){if(q.hasClass("confirm-focus")){switch(a.keyCode){case 13:q.trigger("click");break;case 37:a=q.prev("button");q=a.length?a:q;break;case 39:a=q.next("button"),q=q=a.length?a:q}a=q;l.find("button").removeClass("confirm-focus");
a.addClass("confirm-focus")}})}}}}).obj(POPUP)},countryChange:function(a,b){a.find("#countryId").on("change",function(){var d=this.name,c;d.indexOf(".")&&(c=d.split(".")[0]);d=$(this).attr("name").endsWith("default_country");var f=$(this).val();c=$.extend({},{id:f,inputClass:"large",stateLabel:d?"default.state":"state",stateName:(c?c+".":"")+(d?"default_state":"state"),noSelection:null},b);bm.ajax({url:app.baseUrl+"app/loadStateForCountry",dataType:"html",data:c,success:function(b){a.find(".form-row.state-selector-row").remove();
a.find(".form-row.country-selector-row").after(b);a.find(".form-row.state-selector-row").updateUi();a.trigger("state-load")}})})},countryChangeSelection:function(a,b,d){function c(a){a.find("select[name=zone\\.state\\.id]").change(function(){var a=$(this).val();a&&1<a.length?m.hide():m&&m.show()}).trigger("change")}var f=a.closest(".form-row"),g=f.next(".state-selector-row"),m=f.siblings(".post-code");g&&c(g);var l=a.val();(!l||1<l.length)&&m.hide();a.change(function(){var a=$(this).val();g.remove();
a&&1==a.length||!b?($.extend(d,{id:b?a[0]:a}),bm.ajax({url:app.baseUrl+"app/loadStateForCountry",dataType:"html",data:d,success:function(a){if(g=$(a).insertAfter(f))c(g),g.updateUi();f.parents("form").trigger("state-load")}}),m.show()):b&&m.hide()})},createMenu:function(a,b){if(a instanceof $)return a.addClass("floating-menu");var d=$("<div class='floating-menu' tabindex='0'></div>");$.each(a,function(){var a=this.ui_class;if("item-separator"==a)var f=$("<div class='"+a+"'></div>");else f=$("<div class='menu-item'><span class='icon'></span><span class='label'></span></div>"),
this.href&&(f.addClass(this.ui_class),f=f.wrap("<a></a>").parent().attr("href",this.href).attr("target",this.target||"_self")),f.find(".label").text(this.text),f.addClass(this.ui_class),this.license&&app.licenses&&!app.licenses[this.license]&&f.addClass("restricted insufficient-provision"),this.permission&&f.attr("permission",this.permission),f.attr("action",(b?b+">":"")+(this.action||a)),this.data&&(f[0].data=this.data);var g=f[0];d.append(f);this.sub&&(g.sub=bm.createMenu(this.sub,a).addClass("sub-menu"))});
return d},customerAndGroupSelectionPopup:function(a,b){var d=b.url||app.baseUrl+"customerAdmin/selectCustomerAndGroups",c=b.title||$.i18n.prop("select.customers.or.groups"),f=b.emphasized,g=b.success;var m=b.customerField||"customer";var l=b.groupField||"customerGroup";var n=b.data||{};$.extend(n,{customerField:m,groupField:l});var q=b.preview_panel||a,e=b.previewer||function(a,b){q.find("input[name=isCustomerSelectorDirty]").length||q.append('<input type="hidden" name="isCustomerSelectorDirty" value="true">');
q.find("input[name='"+m+"'], input[name='"+l+"']").remove();b.find("input:hidden[name]").each(function(){var a=$(this).attr("name");a=$("<input type='hidden' name='"+a+"' value='"+$(this).val()+"'>");q.append(a)})};n={};var p=n[m]=[],t=n[l]=[];q.find("input:hidden[name]").each(function(){var a=$(this),b=a.attr("name");a.parents("tr");n[b]&&n[b].push(a.val())});n=$.extend({customerField:m,groupField:l,customer:p,customerGroup:t},b.data);return bm.editPopup(d,c,f,n,{width:b.width?b.width:850,height:b.height?
b.height:730,events:{content_loaded:function(){var a=bm.twoSideSelection(this,10,"customer","customerAdmin/loadCustomerForMultiSelect",{view:!1,edit:!1,"column-sort":!1},[m]),b=$('<span class="tool-icon remove-search" style="display: none"></span>'),c=this.find("input.search-text"),e=this.find(".search-form");e.prepend(b);a.beforeLoadTableContent=function(a){var e={searchText:c.val()};$.extend(a,e);c.val()?b.show():b.hide()};this.find("select[name='selection-type']").change(function(){"customer"==
this.value?a.setUrl("customerAdmin/loadCustomerForMultiSelect","customer",{view:!1,edit:!1,"column-sort":!0},[m]):a.setUrl("customerGroup/loadCustomerGroupForMultiSelect","customer-group",{view:!1,edit:!1,"column-sort":!0},[l])});e.form({preSubmit:function(){a.reload();return!1}});b.on("click",function(){c.val("");a.reload()})}},beforeSubmit:b.beforeSubmit||function(b,c,d){var f={};f[m]=[];f[l]=[];b.find("input:hidden[name]").each(function(){var a=$(this),b=a.attr("name"),c=a.parents("tr");f[b].push({name:c.find("td:eq(0)").text().trim(),
value:a.val()})});e(f,b,q);a.trigger("change");d.close();return!1},success:g})},customTooltip:function(a,b,d,c,f,g){config={auto_close_on_success:!0,disable_on_submit:!0,disable_on_invalid:!0,disable_button_text:void 0,modify_ui:!0,on_load_loader:!1};d[b-1].length||(b+=1,c="7",f="-7");var m=config.events||{};$(d[b-1]).addClass("active");m.content_loaded=function(a){this.updateUi();if(2<b){c="7";f="-7";var l=$("<button type='button' class='submit-button-pre'></button>");l.text($.i18n.prop("prev"));
this.find(".pop-bottom").append(l)}8==b&&(this.find(".submit-button-next").remove(),l=$("<button type='button' class='submit-button-done'></button>"),l.text($.i18n.prop("done")),this.find(".pop-bottom").prepend(l),l=$("<div class='show-next-wrapper'><input type='checkbox' name='remember' class='single'><span class='show-next'> Show on next login</span></div>"),this.find(".pop-bottom").append(l));var m=!0;this.find(".single").on("change",function(){m=this.checked?!1:!0});this.find(".submit-button-done, .submit-button-skip").click(function(){bm.ajax({url:app.baseUrl+
"user/saveIsMatured",data:{check:m},success:function(a){g&&g.getStart&&g.getStart()}});a.close(1);$(d[b-1]).removeClass("active")});this.find(".submit-button-next").click(function(){b++;a.close(1);$(d[b-2]).removeClass("active");c="7";f="-7";f=3==b?"+15":"-7";b<d.length+1&&bm.customTooltip(app.baseUrl+"dashboard/loadOnScreenHelp",b,d,c,f,g)});this.find(".submit-button-pre").click(function(){a.close(1);if(1<b)switch($(d[b-1]).removeClass("active"),b--,b){case 1:c="100";f="-100";break;case 3:c="7";
f="+15";break;default:c="7",f="-7"}bm.customTooltip(app.baseUrl+"dashboard/loadOnScreenHelp",b,d,c,f,g)});this.find(".tool-tip-close").click(function(){$(d[b-1]).removeClass("active");a.close(1);g&&g.getStart&&g.getStart(1)});this.addClass("loaded")};delete config.events;return new POPUP($.extend({template:"<div></div>",show_title:!1,width:380,height:150,ajax_url:a,ajax_settings:{data:{count:b,wizard:d[0].length?!0:null}},ui_position:{my:"right top+10",at:"right"+f+" bottom+"+c,of:d[b-1]},draggable:!1},
config,{clazz:"tool-tip-popup",events:m}))},disableTextSelection:function(a){a||(a=document);browser.ff?(bm.clearTextSelection(a),a.body.style.MozUserSelect="none"):a.onselectstart=function(){return!1}},editPopup:function(a,b,d,c,f){f=$.extend({},{auto_close_on_success:!0,disable_on_submit:!0,disable_on_invalid:!0,disable_button_text:void 0,modify_ui:!0,width:500,form_selector:".edit-popup-form",buttonLine:"button-line",scroll:!0},f);var g=f.events||{},m=g?g.content_loaded:void 0;g.content_loaded=
function(a){var b=this.find(f.form_selector);if("string"==typeof f.buttonLine){var c=b.find("."+f.buttonLine);var e=c.clone();c.remove()}else e=f.buttonLine;c=e.find(".submit-button, button[type=submit]").addClass("edit-popup-form-submit").on("click",function(){b.submit()});this.append(e);f.scroll&&this.find("> .content").scrollbar({reduce_margin_from_offset:!1,vertical:{offset:0}});this.updateUi();var d=f.ajax&&f.ajax.success||f.success;b.form({ajax:null==this.find(".edit-popup-form").attr("no-ajax"),
disable_on_submit:f.disable_on_submit,disable_on_invalid:f.disable_on_invalid,disable_button_text:f.disable_button_text,submitButton:c,preSubmit:function(c){$.extend(c,{response:f.response,error:f.error},f.ajax,{success:function(){f.auto_close_on_success&&a.close();d&&d.apply(this,arguments)}});if(f.beforeSubmit)return f.beforeSubmit.call(a.getDom(),b,c?c.data=c.data||{}:null,a)}});b.find("[default-focus]").focus();var g=b.find(".bmui-tab:first");if(g.length)b.on("invalid",function(a,b){g.tabs&&g.tabs instanceof
Function&&g.tabs("activate",b.validator.elm)});this.find(".cancel-button").click(function(){a.close(1)});a.on("content-change",function(a,c,e){c&&b.obj(ValidationPanel).attach(c.filter("[validation]").add(c.find("[validation]")));e&&b.obj(ValidationPanel).detach(e.filter("[validation]").add(e.find("[validation]")))});b.on("trash-restore",function(){a.close()});m&&m.apply(this,[a,b])};delete f.events;return new POPUP($.extend({title:b+(d?" - <span class='emphasized'>"+bm.htmlEncode(d)+"</span>":""),
width:430,ajax_url:a,ajax_settings:{data:c},draggable:!1},f,{clazz:"edit-popup"+(f.clazz?" "+f.clazz:""),events:g}))},enableTextSelection:function(a){a||(a=document);browser.ff?a.body.style.MozUserSelect="":a.onselectstart=null},errorHighlight:function(a,b){a.addClass("error-highlight");setTimeout(function(){a.removeClass("error-highlight")},b?b:1E3)},floatingPanel:function(a,b,d,c){c=c?c:{};c.clazz="floating-panel-popup"+(c.clazz?" "+c.clazz:"");return new POPUP($.extend({ajax_url:b,ajax_settings:{data:d},
show_title:!1,masking:!1,show_close:!1,close_on_blur:!0,modal:!1,is_center:!1,width:350,ui_position:{my:"right top",at:"right+10 bottom+7",of:a,collision:c.position_collison}},c))},floatingPopup:function(a,b){a.find(".popup-body").hide();a.find(".action-navigator").click(function(){var a=$.extend({},b),c=this.jqObject,f=c.data("popup");if(f)f.show();else{var g=c.next(".popup-body");a=$.extend({content:g,position_collison:"none",events:{content_loaded:function(a){g.show()}}},a);f=bm.floatingPanel(c,
null,{},a);f.close=f.hide;c.data("popup",f)}});return a},getTopScroller:function(a){return $(/webkit/i.test(navigator.userAgent)||"BackCompat"==a.compatMode?a.body:a.documentElement)},highlight:function(a,b,d){a.addClass("highlight-row"+(d?" blink":""));setTimeout(function(){a.removeClass("highlight-row"+(d?" blink":""))},b?b:3E3)},initArticleSelection:function(a,b,d){"undefined"==typeof b&&(b="article");var c=$.extend({tab:null,view:!1,edit:!1,"column-sort":!0},d),f=this.twoSideSelection(a,10,"article",
app.baseUrl+"content/loadArticlesForSelection",c,[b]),g=a.find("select.section-selector").change(function(){f.reload()}),m=a.find("select.article-sorting").change(function(){f.reload()});a.find(".icon-search").click(function(){f.reload()});f.beforeLoadTableContent=function(b){var c={searchText:a.find("input.search-text").val(),section:g.val(),sortBy:m.val()};$.extend(b,c)};a.find(".filter-block").form({disable_on_submit:!1,preSubmit:function(){f.reload()}});f.onViewClick=function(a,b,c,e){app.tabs.content.viewArticle(b.article)};
f.onEditClick=function(a,d,f,e){app.tabs.content.editArticle(d[b],f,c.tab)};return f},initBrandSelection:function(a,b,d){"undefined"==typeof b&&(b="brand");var c=$.extend({tab:null,view:!1,edit:!1,"column-sort":!0},d),f=this.twoSideSelection(a,10,"brand",app.baseUrl+"brandAdmin/loadBrandForSelection",c,[b]),g=a.find("input.search-text"),m=$('<span class="remove-search" title="'+$.i18n.prop("remove.search")+'">').tooltipster();m.on("click",function(){g.val("");m.hide();f.reload()});g.before(m);m.hide();
f.beforeLoadTableContent=function(a){var b={searchText:g.val()};$.extend(a,b)};a.find(".filter-block").form({disable_on_submit:!1,preSubmit:function(){f.reload();g.val()?m.show():m.hide()}});f.onEditClick=function(a,d,f,e){app.tabs.brand.editBrand(d[b],f,c.tab)};return f},initCategorySelection:function(a,b,d){"undefined"==typeof b&&(b="category");var c=$.extend({tab:null,view:!1,edit:!1,"column-sort":!0},d),f=this.twoSideSelection(a,10,"category",app.baseUrl+"categoryAdmin/loadCategoriesForSelection",
c,[b]),g=a.find("select.category-sorting").change(function(){f.reload()});f.beforeLoadTableContent=function(b){var c={searchText:a.find("input.search-text").val(),sortBy:g.val()};$.extend(b,c)};a.find(".filter-block").form({disable_on_submit:!1,preSubmit:function(){f.reload()}});f.onEditClick=function(a,d,f,g){app.tabs.item.editCategory(d[b],f,c.tab)};return f},initCityValidator:function(a,b,d,c,f){b=b?b:"country.id";d=d?d:"state.id";f=f?f:"city";a.length&&a.each(function(){function a(a){var b={state:l.val(),
postCode:m.val(),cityFieldName:f};1!=a&&(b.country=n.val());if(a=q.find(":input").attr("validation"))b.validation=a;bm.ajax({url:app.baseUrl+"app/loadCitiesByCountryOrState",data:b,dataType:"html",success:function(a){a=$(a);app.is_front_end?q.find(":input").remove():q.children().not("label").remove();q.append(a);app.is_front_end||"dropdown"!=a.attr("et-category")||a.chosen();var b=a.closest("form").obj(ValidationPanel);b&&b.attach(a.filter("[validation]"),b);if(a=a.find("option:selected").attr("state"))l.val(a),
app.is_front_end||l.trigger("chosen:updated")}})}var m=$(this);c=c?c:m.closest("form");var l=c.find('[name="'+d+'"]'),n=c.find('[name="'+b+'"]'),q=c.find(".city-selector-row");q.length&&(l.change(function(){a(!0)}),c.on("state-load",function(){l=c.find('[name="'+d+'"]');a();l.length&&l.change(a)}),m.ichange(a))})},initCountryChangeHandler:function(a,b){a.change(function(){var d=$(this).closest("form"),c=$(this).val();$.ajax({url:app.baseUrl+"app/loadStateForCountry",dataType:"html",data:{id:c,stateName:b},
success:function(b){d.find(".form-row.state-selector-row").remove();a.parents(".form-row").after(b);d.trigger("state-load")}})})},initFilterSelection:function(a){var b=this.twoSideSelection(a,10,"filter",app.baseUrl+"filterAdmin/loadFiltersForSelection",{edit:!1,"column-sort":!0},["filter"]),d=$('<span class="tool-icon remove-search" style="display: none"></span>'),c=a.find("input.search-text");a=a.find(".search-form");a.prepend(d);b.beforeLoadTableContent=function(a){var b={searchText:c.val()};$.extend(a,
b);c.val()?d.show():d.hide()};a.form({disable_on_submit:!1,submitButton:a.find(".search-button"),preSubmit:function(){b.reload()}});d.on("click",function(){c.val("");b.reload()});return b},initManufacturerSelection:function(a,b,d){"undefined"==typeof b&&(b="manufacturer");var c=$.extend({tab:null,view:!1,edit:!1,"column-sort":!0},d);app.global_event.on("manufacturer-create manufacturer-update manufacturer-delete",function(){f.reload()});var f=this.twoSideSelection(a,10,"manufacturer",app.baseUrl+
"manufacturerAdmin/loadManufacturerForSelection",c,[b]);f.beforeLoadTableContent=function(b){var c={searchText:a.find("input.search-text").val()};$.extend(b,c)};a.find(".filter-block").form({disable_on_submit:!1,preSubmit:function(){f.reload()}});f.onEditClick=function(a,d,f,n){app.tabs.manufacturer.editManufacturer(d[b],f,c.tab)};return f},initProductSelection:function(a,b,d){"undefined"==typeof b&&(b="product");var c=$.extend({tab:null,view:!1,edit:!1,"column-sort":!0},d),f=this.twoSideSelection(a,
10,b,app.baseUrl+"productAdmin/loadProductsForSelection",c,[b]),g=a.find("select.category-selector").change(function(){f.reload()}),m=a.find("select.product-sorting").change(function(){f.reload()}),l=a.find("select.special-product-filtering").change(function(){f.reload()});f.beforeLoadTableContent=function(b){var c={searchText:a.find("input.search-text").val(),parent:g.val(),sortBy:m.val(),specialProductsFilter:l.val(),priceFrom:a.find("input[name='form-amount']").val(),priceTo:a.find("input[name='to-amount']").val()};
$.extend(b,c)};a.find(".filter-block").form({disable_on_submit:!1,preSubmit:function(){f.reload()}});f.onEditClick=function(a,b,e,d){app.tabs.item.editProduct(b.product,e,c.tab)};f.onViewClick=function(a,c,e,d){app.tabs.item.viewProduct(c[b])};return f},initZoneSelection:function(a,b,d,c){b=b?b:"zone";c=c?c:[b];d=$.extend({tab:null,view:!1,edit:!1,"column-sort":!0},d);app.global_event.on("zone-create zone-update zone-delete",function(){f.reload()});var f=this.twoSideSelection(a,10,b,app.baseUrl+"zone/loadZoneForSelection",
d,c);f.beforeLoadTableContent=function(b){var c={searchText:a.find("input.search-text").val()};$.extend(b,c)};a.find(".filter-block").form({disable_on_submit:!1,preSubmit:function(){f.reload()}});return f},innerHeight:function(a,b,d){var c=a.css("box-sizing");switch(d){case "inner":a=a.innerHeight()-a.height();break;default:a="border-box"==c?0:a.outerHeight()-a.height();break;case "extra_outer":a=a.outerHeight(!0)-("border-box"==c?a.outerHeight():a.height())}return b-a},innerWidth:function(a,b,d){var c=
a.css("box-sizing");switch(d){case "inner":a=a.innerWidth()-a.width();break;default:a="border-box"==c?0:a.outerWidth()-a.width();break;case "extra_outer":a=a.outerWidth(!0)-("border-box"==c?a.outerWidth():a.width())}return b-a},instantSearch:function(a,b,d,c,f){function g(){var b=m.val();b?a.addClass("search-active"):a.removeClass("search-active");a.find(d).each(function(){var a=$(this);a.find(c).text().trim().match(new RegExp(b,"i"))?a.show():a.hide()})}var m=b.find(".search-text");m.ichange(800,
function(){g()});b.form({preSubmit:function(){g();return!1}})},makeTableCellEditable:function(a,b){function d(){function a(a){a=a.val();m.text(a);a!=l&&b&&!1===b(d,a,l)?p.focus():(e.remove(),d.removeClass("editing"),m.cshow(),g.siblings("tr.data-row").addBack().each(function(){$(this).trigger("heightChange")}))}var d=$(this).parent(),g=d.parent();d.addClass("editing");var m=d.find(".value"),l=m.chide().text().trim(),n=d.attr("validation"),q=d.attr("maxlength");d.append("<input type='text' class='td-full-width' maxlength='"+
(q?q:"")+"' validation='"+(n?n:"")+"'>");n=d.attr("restrict");var e=d.find("input[type='text']");e.val(l);if(n)e[n]();var p=e.get(0);p.selectionStart=p.selectionEnd=p.value.length;p.focus();d.trigger("cell-edit");g.siblings("tr.data-row").addBack().each(function(){$(this).trigger("heightChange")});e.on("focusout",function(){a($(this))}).on("keypress",function(b){13==b.keyCode&&(b.preventDefault(),a($(this)))})}a.each(function(){var a=$(this);if(!a.find(".value").length){var b=a.html();a.html('<span class="value"></span>');
a.find(".value").html(b)}b="edit";a.is(".custom-edit")?(b="change-all",a.append('<span class="fake-link '+b+'">'+$.i18n.prop("change.all")+"</span>")):a.append('<span class="tool-icon '+b+'"></span>');a.find("."+b).on("click",d)})},makeTableCellSelectable:function(a,b,d,c){function f(){var a=$(this).parent();a.addClass("editing");var c=a.find(".value"),f=a.find(".text"),n=c.chide().text().trim(),q=$.isFunction(b)?b(a):b.clone().show();q.addClass("td-full-width");if(a.is(".hidden-overflow-selectable")){var e=
$("<div class='selectable-td-proxy'></div>").appendTo(document.body);e.append(q);e.position({my:"left top",at:"left top",of:a,collision:"none"});e.width(a.outerWidth(),!0);e.height(a.outerHeight(),!0)}else a.append(q);q.val(n);q.chosen();q.on("chosen:hiding_dropdown",function(){var b=$(this).val();q.chosen("remove");if(n!=b){c.text(b);var e=$(this).find("option:selected").text();f.text(e);d&&d(a,b,e,n)}a.removeClass("editing");a.is(".hidden-overflow-selectable")&&$(".selectable-td-proxy").remove();
c.cshow()});q.chosen("dropshow");return!1}a.each(function(){var a=$(this);if(!a.find(".value").length){var b=a.html();a.html('<span class="value"></span><span class="text"></span>');a.find(".value").html(b);a.find(".text").html(b)}b="edit";a.is(".custom-select")?(b="change-all",a.prepend('<span class="fake-link '+b+'">'+$.i18n.prop("change.all")+"</span>")):a.append('<span class="tool-icon '+b+'"></span>');a.find("."+b).on("click",function(){c&&!1===c(a)||f.call(this)})})},mask:function(a,b){b=$(b);
var d=a.position(),c={position:"absolute"};"static"==a.css("position")?$.extend(c,{left:d.left+a.leftRib(!0,!1,!1),top:d.top+a.topRib(!0,!1,!1),width:b.width(a.outerWidth()),height:b.height(a.outerHeight())}):$.extend(c,{left:0,top:0,right:0,bottom:0});b.css(c).addClass("div-mask");a.append(b)},maskIframe:function(a){var b=$("<div class='iframe-mask'></div>").css($.extend({bottom:0,left:0,position:"absolute",right:0,top:0,"z-index":500},browser.ie&&8==browser.version?{"background-image":"url(../../images/common/transparent_00.png)"}:
{"background-color":"transparent"}));a.contents().find("body").append(b)},menu:function(a,b,d,c,f,g){function m(a,f,m){a&&($(document.body).append(a),n=a,m=g?1<b.length||d?f.closest(d||b):b:m,a.position({at:g?g[0]:"left top+1",my:g?g[1]:"left top",of:m,using:function(b,e){var d=$(this);d.css({left:b.left+"px",top:b.top+"px"});"top"==e.vertical?d.removeClass("up-side").addClass("down-side"):d.addClass("up-side").removeClass("down-side");c.open&&c.open.call(a,f,e);d.find(".menu-item").each(function(){var a=
$(this),b=a.attr("permission");b&&(app.isPermitted(b)?a.removeClass("disabled"):a.addClass("disabled"))})}}).find(".menu-item").on("click",function(){var a=this.jqObject;a.is(".disabled")||(c.multitype?c.click(e(f),a.attr("action"),f,this.data):c.click(a.attr("action"),f,this.data),a.hasClass("ignore-hide-on-select")||c.hide&&!1===c.hide(f)||l())}),$(document).on("mousedown."+p,function(b){a.isParentOf(b.target)||c.hide&&!1===c.hide(f)||l()}),a.children().each(function(){if(this.sub){var a=$(this),
b=this.sub;a.hover(function(){n.active_sub_menu&&n.active_sub_menu.hide();n.active_sub_menu=b.show().position({my:"left top",at:"right+10 top",of:a})},function(){setTimeout(function(){n.hover_on_submenu||b.hide()},100)});b.hover(function(){n.hover_on_submenu=!0},function(){n.hover_on_submenu=!1})}}))}function l(){n&&($(document).off("mousedown."+p),n.remove().find(".menu-item").off("click"),n.active_sub_menu&&(n.active_sub_menu.hide(),delete n.active_sub_menu,delete n.hover_on_submenu))}if(a){var n;
if(c.multitype){var q={};$.each(a,function(a){q[a]=bm.createMenu(this)});a=q;var e=function(a){return a.attr("content-type")}}else $.isArray(a)?(e=function(){return"def"},a={def:bm.createMenu(a)}):(e=function(){return"def"},a={def:a});var p=bm.getUUID();$.isFunction(c)&&(c={click:c});!c.multitype&&g&&"always"==f?m(a.def,b,null):(b.on(f||"contextmenu",d,function(b){var c=$(this);m(a[e(c)],c,b);return!1}),$.each(a,function(){$(this).children().each(function(){this.sub&&$(this).append(this.sub.hide())})}));
var t={show:function(a,b){if(1<arguments.length)l(),m(this,a,b);else if(n){var c=n.find("[action='"+a+"']");c.length||(c=n.find("."+a));c.show()}},hide:function(a){if(!a)l();else if(n){var b=n.find("[action='"+a+"']");b.length||(b=n.find("."+a));b.hide()}},enable:function(a){if(a&&n){var b=n.find("[action='"+a+"']");b.length||(b=n.find("."+a));b.removeClass("disabled")}},disable:function(a){if(a&&n){var b=n.find("[action='"+a+"']");b.length||(b=n.find("."+a));b.addClass("disabled")}}};f=$.each(a,
function(){$.extend(this,t)});return f.def?f.def:f}},metaTagEditor:function(a){function b(a){bm.makeTableCellEditable(a.find("td.editable"),function(a,b,c){c=a.parent("tr");if(!b)return d(a.find("input")),bm.notify($.i18n.prop("value.must.not.be.empty"),"error"),!1;a.is(".name")?c.find("[name=tag_name]").val(b):c.find("[name=tag_content]").val(b)});a.find("td span.remove").on("click",function(){$(this).parents("tr").remove()})}function d(a){a.addClass("error-highlight");setTimeout(function(){a.removeClass("error-highlight")},
1E3)}a=a.find(".meta-tag-editor").find("table");var c=a.find("tr.last-row");a.find("tr:gt(0):not(.last-row)").each(function(){b($(this))});a=function(){var a=c.find(".name").val(),g=c.find(".value").val();if(a){if(g)return a=$('<tr><td class="name editable" maxlength="">#NAME#</td><td class="value editable" maxlength="">#VALUE#</td><td class="actions-column"><input type="hidden" name="tag_name" value="#NAME#"><input type="hidden" name="tag_content" value="#VALUE#"><span class="tool-icon remove"></span></td></tr>'.replaceAll("#NAME#",
a.htmlEncode()).replaceAll("#VALUE#",g.htmlEncode())),c&&(c.find(".name").attr("maxlength")&&a.find(".name").attr("maxlength",c.find(".name").attr("maxlength")),c.find(".value").attr("maxlength")&&a.find(".value").attr("maxlength",c.find(".value").attr("maxlength"))),b(a),c.before(a),c.find("input").val(""),!1;d(c.find(".value"))}else d(c.find(".name"))};c.find("input").bind("keyup.key_return",a);c.find(".add-row").on("click",a);c.find("input").on("keydown, keyup, keypress",function(a){if(13==a.keyCode)return!1})},
notify:function(a,b){var d=$(".popup.notification");if(d.length)d.find(".message").html(a.trim()),d.find(".type").text($.i18n.prop(b)+"!"),d.removeClass("success error info warning alert").addClass(b),d.obj().resetCloseTimer();else return d=$("<div class='notification'><span class='icon'></span><span class='type'></span></span><span class='message'></span><span class='close'></span></div>"),d.find(".message").html(a.trim()),d.find(".type").text($.i18n.prop(b)+"!"),d.popup({auto_close:3E3,auto_active:!1,
auto_active_on_focus:!1,modal:!1,is_fixed:!0,is_center:!0,top:20,is_always_up:!0,clazz:b,position:function(){var a=this.getDom();a.css({top:-a.outerHeight(),left:bm.center(a.outerWidth(),0,!0).left});a.animate({top:20},{easing:"easeOutBounce"})},close:function(){var a=this.getDom(),b=this,d=arguments;a.fadeOut(function(){POPUP.prototype.close.apply(b,d)})},events:{render:function(){var a=this;a.hover(function(){a.addClass("hover")},function(){a.removeClass("hover")})}}})},pageableTable:function(a,
b){var d=a.find("tr:gt(0)").length,c=$("paginator",{max:b.max||3,offset:0,total:d});a.after(c);c.paginator({onPageClick:function(b){var d=c.obj();a.find("tr:not(:first)").hide();d=d.all?d.getTotal():d.getItemsPerPage();b=(b-1)*d;1>b&&(b=0);a.find("tr:gt("+b+"):lt("+d+")").show()}})},pageableView:function(a,b){var d={};d.menu=bm.menu(b.menu_entries,a,".float-menu-navigator",{open:function(a){if(a.parent().is(".grid-item")){a=a.parent();a.addClass("float-menu-opened");var b=a.config("content");if(d.onMenuOpen)d.onMenuOpen(type,
b.type,a)}},hide:function(a){a=menu_opened_from_tree?a.parent(".tree-node"):a.parent(".grid-item");a.removeClass("float-menu-opened")},click:function(a,b,g){if(menu_opened_from_tree){var c=treeOptions.treeObj.data;g=void 0}else c=g.parent(".grid-item").config("content");d.onActionClick(a,b,c,g)},multitype:!0},"click",["center bottom","right+21 top+2"])},permissionPopup:function(a,b,d){function c(a){var b=a.find("[name=allowAll]"),c=a.find("[name=denyAll]"),d=a.find(".allow-group"),f=a.find(".deny-group");
if(d)d.on("change",function(){d.filter(":checked").length==d.length?b.checkbox("state","checked"):b.checkbox("state","unchecked");var a=$(this),c=a.closest("tr").find(".deny-group");a.is(":checked")&&c.is(":checked")&&(c.checkbox("state","unchecked"),c.trigger("change"))});if(f)f.on("change",function(){f.filter(":checked").length==f.length?c.checkbox("state","checked"):c.checkbox("state","unchecked");var a=$(this),b=a.closest("tr").find(".allow-group");a.is(":checked")&&b.is(":checked")&&(b.checkbox("state",
"unchecked"),b.trigger("change"))});if(b)b.on("change",function(){d.prop("checked",this.checked);d.trigger("change")});if(c)c.on("change",function(){$(this).is(":checked")?f.checkbox("state","checked"):f.checkbox("state","unchecked");f.trigger("change")})}app.licenses&&!app.licenses[CONSTANTS.LICENSES.ACL]?bm.notify($.i18n.prop("feature.disabled",[$.i18n.prop(CONSTANTS.LICENSES.ACL)]),"alert"):bm.editPopup(app.baseUrl+"role/managePermissions",a,b,d,{width:450,events:{content_loaded:function(){var a=
this;c(a);a.find("select[name='type']").on("change",function(b,f){b=this.value;var g=a.find(".edit-popup-form");f=$("<div class='block-for-"+f+"'><input type='hidden' name='type' value='"+f+"'></div>").hide();f.append(a.find("form > .permission-entry-list"));g.append(f);f=a.find(".block-for-"+b);if(f.length)g.append(f.find(".permission-entry-list")),f.remove();else{a.find(".content").loader();f=$.extend({},d);f.type=b;var m=a.find("input[name=entityType]").val();m&&(f.type=m,f.user=b);bm.ajax({url:app.baseUrl+
"role/managePermissions",data:f,dataType:"html",response:function(b,e){a.find(".content").loader(!1);e="<"==e[0]?$(e):$("<div class='permission-entry-list'>"+e+"</div>");b=e.find(".permission-entry-list");b.length||(b=$("<div class='permission-entry-list'></div>"),b.append(e));g.append(b);b.find("input:checkbox").checkbox().filter("[uncheck-value]").pairuncheck();c(b)}})}})}},success:function(){app.updatePermissions()}})},posRefChangeLtoR:function(a){var b=a.offsetParent().innerWidth()-a.position().left-
a.outerWidth();a.css({left:"auto",right:b})},productAndCategorySelectionPopup:function(a,b){var d=b.url||app.baseUrl+"itemAdmin/loadProductAndCategorySelector",c=b.title||$.i18n.prop("select.products.or.categories"),f=b.emphasized,g=b.success;var m=b.productField||"product";var l=b.categoryField||"category";var n=b.preview_panel||a,q=b.previewer||function(a,b){n.find("input[name='"+m+"'], input[name='"+l+"']").remove();b.find("input:hidden[name]").each(function(){var a=$(this).attr("name");a=$("<input type='hidden' name='"+
a+"' value='"+$(this).val()+"'>");n.append(a)})},e={},p=e[m]=[],t=e[l]=[];n.find("input:hidden[name]").each(function(){var a=$(this),b=a.attr("name");e[b]&&e[b].push(a.val())});e=$.extend({productField:m,categoryField:l,selectedProducts:p,selectedCategories:t},b.data);return bm.editPopup(d,c,f,e,{width:850,events:{content_loaded:function(){var a=bm.twoSideSelection(this,10,"product","productAdmin/loadProductsForSelection",{view:!1,edit:!1,"column-sort":!1},[m]),b=$('<span class="tool-icon remove-search" style="display: none"></span>'),
c=this.find("input.search-text"),e=this.find(".search-form");e.prepend(b);a.beforeLoadTableContent=function(a){var e={searchText:c.val()};$.extend(a,e);c.val()?b.show():b.hide()};this.find("select[name='selection-type']").change(function(){"product"==this.value?a.setUrl("productAdmin/loadProductsForSelection","product",{view:!1,edit:!1,"column-sort":!0},[m]):a.setUrl("categoryAdmin/loadCategoriesForSelection","category",{view:!1,edit:!1,"column-sort":!0},[l])});e.form({preSubmit:function(){a.reload();
return!1}});b.on("click",function(){c.val("");a.reload()})}},beforeSubmit:function(b,c,e){var d={};d[m]=[];d[l]=[];b.find("input:hidden[name]").each(function(){var a=$(this),b=a.attr("name"),c=a.parents("tr");d[b].push({name:c.find("td:eq(0)").text().trim(),value:a.val()})});q(d,b,n);a.trigger("change");e.close();return!1},success:g})},productSelectionPopup:function(a,b){var d=b.url||app.baseUrl+"productAdmin/productSelectionPopup",c=b.title||$.i18n.prop("select.products"),f=b.emphasized,g=b.data||
{},m=b.fieldName||"product",l=[],n=b.preview_holder||a;n.find("input[name='"+m+"']").each(function(){l.push($(this).val())});$.extend(g,{fieldName:m,product:l});var q=b.previewer||function(a,b){n.find("input[name='"+m+"']").remove();b.find("input:hidden[name]").each(function(){var a=$(this).attr("name");a=$("<input type='hidden' name='"+a+"' value='"+$(this).val()+"'>");n.append(a)})};return bm.editPopup(d,c,f,g,{width:850,form_selector:".product-selection-panel",events:{content_loaded:function(a,
b){a=bm.initProductSelection(this,m);$(this).data("selector",a)}},beforeSubmit:function(b,c,d){var e={};e[m]=[];b.find("input:hidden[name]").each(function(){var a=$(this),b=a.attr("name"),c=a.parents("tr");e[b].push({name:c.find("td:eq(0)").text().trim(),value:a.val()})});q(e,b,n);a.trigger("change");d.close();return!1}})},recipientSelectorPopup:function(a,b,d){var c=b.title?b.title:$.i18n.prop("select.recipient"),f=app.baseUrl+"customerAdmin/loadRecipientSelector",g=b.data;b.url&&(f=b.url);a.find(".selected-recipient").each(function(){var a=
g[$(this).attr("name")];a||(a=g[$(this).attr("name")]=[]);a.push($(this).val())});bm.editPopup(f,c,"",g,{width:850,events:{content_loaded:function(){var a=bm.twoSideSelection(this,10,"customer","customerAdmin/loadCustomerForMultiSelect",{view:!1,edit:!1,"column-sort":!0},["customer"]),b=$('<span class="tool-icon remove-search" style="display: none"></span>'),c=this.find("input.search-text"),d=this.find(".search-form");d.prepend(b);a.beforeLoadTableContent=function(a){var e={searchText:c.val()};$.extend(a,
e);c.val()?b.show():b.hide()};a.getPanelBody=function(){return'<div class="body"><div class="form-row"><label>'+$.i18n.prop("name")+'</label><input type="text" class="medium name"></div><div class="form-row"><label>'+$.i18n.prop("email")+'</label><input type="text" class="medium email" validation="required email"></div></div><div class="inline-button-line"><button type="button" class="submit-button add-email">'+$.i18n.prop("add")+"</button></div>"};a.initContent=function(b,c){function e(a){var b=
d.is(":disabled")?"":d.val().trim(),c=f.val();if(b){var e=c.trim();a([b+" <"+c+">"],[e,b])}else $.each(c.split(/[,;]/),function(){var b=this.trim();if(""!=b){var c="",e=b,d=b.indexOf("<");-1<d&&(c=b.substring(0,d).trim(),b=b.substring(d+1),d=b.indexOf(">"),b=b.substring(0,d).trim());a([e],[b,c])}})}var d=b.find(".name"),f=b.find(".email");b.attachValidator();b.find(".add-email").click(function(){!1!==b.valid()&&(e(c),d.val("").removeAttr("disabled"),f.val(""))});f.blur(function(){var a=this.value;
-1!=a.indexOf(",")||-1!=a.indexOf(";")||-1!=a.indexOf("<")?d.attr("disabled","disabled").val($.i18n.prop("single.email.without.name")):d.is(":disabled")&&d.val("").removeAttr("disabled")});b.obj(ValidationPanel).addValidatorRule(f,function(){var b=!1;e(function(c,e){a.isSelected("email",e[0])&&(b=!0)});return!b},$.i18n.prop("email.address.exist"))};this.find("select[name='selection-type']").change(function(){"customer"==this.value?a.setUrl("customerAdmin/loadCustomerForMultiSelect","customer",{view:!1,
edit:!1,"column-sort":!0},["customer"]):"group"==this.value?a.setUrl("customerGroup/loadCustomerGroupForMultiSelect","customer-group",{view:!1,edit:!1,"column-sort":!0},["customerGroup"]):a.setUrl(null,"email",{view:!1,edit:!1,"column-sort":!0},["recipientEmail","recipientName"])});d.form({disable_on_submit:!1,preSubmit:function(){a.reload();return!1}});b.on("click",function(){c.val("");a.reload()})}},beforeSubmit:function(b,c,f){if(a instanceof $)return a.find(".selected-recipient").remove(),b.find("input:hidden[name]").each(function(){a.append('<input type="hidden" class="selected-recipient" name="'+
$(this).attr("name")+'" value="'+$(this).val()+'">')}),"function"==typeof d&&d(b),f.close(),!1}})},remove:function(a,b,d,c,f,g){var m=function(){g.is_final||app.global_event.trigger("send-trash",[a,f]);app.global_event.trigger(a+"-deleted",[f]);g.success&&g.success.apply(this,arguments)},l={id:f};g.at2_reply&&(l.at2_reply=g.at2_reply);g.at1_reply&&(l.at1_reply=g.at1_reply);g.is_final&&(l.is_final=!0);var n=function(){g.start&&g.start();bm.ajax({url:c,data:l,response:g.stop,success:m,error:function(l,
e,m){if("attachment.exists"==m.error_code){l=function(a,c){var e=[b];if(a.has){var d=n(a.has);delete a.has;c+=".has";e.push(d)}a.as&&(d=a.as.collect(function(){return $.i18n.prop(""+this)}).join(", "),delete a.as,c+=".as",e.push(d));if(a=n(a))c+=".attach",e.push(a);return $.i18n.prop(c+".message",e)};var n=function(a){var b="";$.each(a,function(a){var c=this,e=!0;$.isPlainObject(this)&&(c=this.count,e=this.list||!0);b+=e?", <a class='fake-link' href='javascript:window.tempFunction(\""+a+"\")'>"+c+
" "+$.i18n.prop(a)+"</a>":", "+c+" "+$.i18n.prop(a)});return b.substring(2)},q={id:f,type:a};g.is_final&&(q.is_final=!0);m=m.attachments;if(m.at3){m=l(m.at3,"at3.prevent");var p=bm.alert(m,"error",function(){});window.tempFunction=function(a){p.close();bm.viewPopup(app.baseUrl+"app/viewAttachments",$.extend({},q,{entity:a,att_type:3}),{width:500})}}else m.at2?(m=l(m.at2,"at2.information"),p=bm.confirm(m,function(){bm.remove(a,b,d,c,f,$.extend({},g,{at2_reply:"yes",no_confirm:!0}))},function(){}),
window.tempFunction=function(a){p.hide();bm.viewPopup(app.baseUrl+"app/viewAttachments",$.extend({},q,{entity:a,att_type:2}),{width:500}).on("close",function(){p.show()})}):m.at1&&(m=l(m.at1,"at1.information"),p=bm.confirm(m,function(){bm.remove(a,b,d,c,f,$.extend({},g,{at1_reply:"exclude",no_confirm:!0}))},function(){bm.remove(a,b,d,c,f,$.extend({},g,{at1_reply:"include",no_confirm:!0}))},function(){}),window.tempFunction=function(a){p.hide();bm.viewPopup(app.baseUrl+"app/viewAttachments",$.extend({},
q,{entity:a,att_type:1}),{width:500}).on("close",function(){p.show()})})}}})};g.no_confirm?n():bm.confirm($("<p>").text(d),n,function(){})},renderSitePopup:function(a,b,d,c,f){f=$.extend({},{auto_close_on_success:!0,disable_on_submit:!0,disable_on_invalid:!0,disable_button_text:void 0,modify_ui:!0,width:500,form_selector:".site-popup-form",buttonLine:"button-line",scroll:!0},f);var g=f.events||{},m=g?g.content_loaded:void 0;g.content_loaded=function(a){var b=this.find(f.form_selector);if("string"==
typeof f.buttonLine){var c=b.find("."+f.buttonLine);var e=c.clone();c.remove()}else e=f.buttonLine;c=e.find(".submit-button, button[type=submit]").addClass("site-popup-form-submit").on("click",function(){b.submit()});this.append(e);var d=f.ajax&&f.ajax.success||f.success;b.form({ajax:null==this.find(".site-popup-form").attr("no-ajax"),disable_on_submit:f.disable_on_submit,disable_on_invalid:f.disable_on_invalid,disable_button_text:f.disable_button_text,submitButton:c,preSubmit:function(c){$.extend(c,
{response:f.response,error:f.error},f.ajax,{success:function(){f.auto_close_on_success&&a.close();d&&d.apply(this,arguments)}});if(f.beforeSubmit)return f.beforeSubmit.call(a.getDom(),b,c?c.data=c.data||{}:null,a)}});b.find("[default-focus]").focus();this.find(".cancel-button").click(function(){a.close(1)});a.on("content-change",function(a,c,e){c&&b.obj(ValidationPanel).attach(c.filter("[validation]").add(c.find("[validation]")));e&&b.obj(ValidationPanel).detach(e.filter("[validation]").add(e.find("[validation]")))});
m&&m.apply(this,[a,b])};delete f.events;return new POPUP($.extend({title:b+(d?" - <span class='emphasized'>"+bm.htmlEncode(d)+"</span>":""),width:430,ajax_url:a,ajax_settings:{data:c}},f,{clazz:"site-popup"+(f.clazz?" "+f.clazz:""),events:g}))},renderZoneView:function(a){function b(){var g=a.body.find(".right-panel");g.loader();bm.ajax({url:c,dataType:"html",response:function(){g.loader(!1)},success:function(m){f=$(m);g.find(".body").html(f);bm.table(f,{url:c,onload:function(){},menu_entries:[{text:$.i18n.prop("edit"),
ui_class:"edit",action:"edit"},{text:$.i18n.prop("remove"),ui_class:"remove",action:"remove"}],onActionClick:function(a,c,f){switch(a){case "edit":d(f.parents("tr"),c);break;case "remove":app.tabs.zone.deleteZone(c.id,c.name,void 0,b)}}});f.find(".add-zone-btn").on("click",function(){var a=$(f.find("tr")[0]);d(a)});a.body.find(".toolbar-btn.save").hide();g.scrollbar()}})}function d(c,d){var f=a.body.find(".right-panel");f.loader();bm.ajax({url:app.baseUrl+"zone/createZone",data:d,dataType:"html",
response:function(){f.loader(!1)},success:function(a){a=$("<td colspan='5'>"+a+"</td>");var d=a.find("form");bm.countryChangeSelection(d.find("select[name=zone\\.country\\.id]"),!0,{isMultiple:"true",stateName:"zone.state.id"});d.find(".cancel-button").on("click",function(){b()});c.empty().append(a);d.form({ajax:!0,preSubmit:function(a){$.extend(a,{success:function(a){b()}})}});d.updateUi()}})}var c=app.baseUrl+"zone/loadZoneView",f;b()},selectFromAssetLibrary:function(a,b,d,c,f){var g,m;c=$.extend({},
c,{_self:this,width:500,events:{content_loaded:function(a){function c(a){"undefined"==typeof a&&(a="pub");WebDAVClient.doPropFind(a,this,{onPopulate:function(b){e.find(".folder, .file").remove();if("pub"!=a){var n=$('<div class="folder"> <span class="tool-icon back" title="'+$.i18n.prop("back")+'"></span></div>');e.append(n);n.click(function(){m=!1;p=p.substring(0,p.lastIndexOf("/"));c(p)})}$.each(b.folders,function(a,b){var d=$('<div class="folder"> <span class="tree-icon"></span> <span class="tree-title">'+
b.name+"</span></div>");e.append(d);var l=0;d.click(function(){var a=null;l++;1===l?a=setTimeout(function(){l=0;d.siblings(".selected").removeClass("selected");m=!1;0==f&&(m=!0,d.addClass("selected").siblings(".selected").removeClass("selected"),g=bm.encodePath(app.baseUrl+"pub"+b.path.substring(b.path.indexOf("/"))))},200):(l=0,clearTimeout(a),p=b.path,c(b.path),e.next().find(".selectedValue").removeAttr("src").data("loaded",!1))})});$.each(b.files,function(a,b){a="bmp gif jpg png psd pspimage thm tif yuv jpeg".split(" ");
var c=b.clazz;d=d?d:a;if(d.contains(c)&&0!=f){var n=$('<div class="file '+c+'"> <span class="tree-icon"></span> <span class="tree-title">'+b.name+"</span></div>");e.append(n);n.click(function(){m=!1;g=bm.encodePath(app.systemPubUrl+"/"+b.path.substring(b.path.indexOf("/")));if(void 0===f){var a=$("<img>",{src:g});l.find(".asset-library-image-preview").html(a);a.on("load",function(){m=!0;n.addClass("selected").siblings(".selected").removeClass("selected")})}else f&&(e.find(".file.selected").removeClass("selected"),
n.addClass("selected"),m=!0)})}})}})}var l=this,e=this.find(".remote_folders").scrollbar({vertical:{offset:2}}),p;c("pub");this.find(".file-selector").form({preSubmit:function(){m?(b(g),a.close()):f?bm.notify($.i18n.prop("file.not.selected"),"error"):void 0===f?bm.notify($.i18n.prop("image.not.selected"),"error"):bm.notify($.i18n.prop("folder.not.selected"),"error");return!1}})}}});bm.editPopup(app.baseUrl+"remoteRepository/selectFileFromAssetLibraryForWidget",a,"",{isFile:void 0===f?f:!0},c)},selectionFloatingPanel:function(a,
b,d,c){var f={isLoaded:!1,reload:function(){var a=this,d=a.el,f={searchText:a.searchText};d.loader();c.beforeReload&&c.beforeReload(f);bm.ajax({url:b,data:f,dataType:"html",response:function(){d.loader(!1)},success:function(b){d.find(".body").replaceWith($(b).find(".body"));a.attachEvents()}})},attachEvents:function(){var a=this,b=a.el;b.find(".body").scrollbar({vertical:{offset:15}});b.updateUi();b.find(".select-item").on("click",function(){var b=$(this);if(!b.is(".selected"))c.onSelect(b.config("entity"));
a.popup.close()})}},g=c.events||{},m=g?g.content_loaded:void 0;g.content_loaded=function(a){var b=f.el=a.el,c=b.find(".search-form");f.popup=a;b.find(".cancel-button").on("click",function(){a.close()});c.form({preSubmit:function(){var a=c.find(".search-text").val();if(f.searchText===a)return!1;f.searchText=a;f.reload();return!1}});f.attachEvents();m&&m.apply(this,arguments)};delete c.events;bm.floatingPanel(a,b,d,$.extend({width:400,height:null,events:g,position_collison:"none"},c));return f},table:function(a,
b){function d(){l.param=n?{max:n.all?-1:n.itemsPerPage,offset:(n.currentPage-1)*n.itemsPerPage}:{max:-1,offset:0};l.sortable&&l.sorted&&$.extend(l.param,{sort:l.sortable[l.sorted],dir:"down"==l.sortedDir?"desc":"asc"});l.beforeReloadRequest&&l.beforeReloadRequest();a.loader();bm.ajax({url:l.url+(l.appendUrl||""),type:l.type,data:l.param,dataType:"html",success:function(){f.apply(this,arguments);l.afterLoad&&l.afterLoad()},response:function(){a.loader(!1)}})}function c(){l.sortable&&($.each(l.sortable,
function(a){q.find("th:nth-child("+(+a+1)+")").eq(0).addClass("sortable")}),l.sorted&&q.find("th:nth-child("+(+l.sorted+1)+")").eq(0).addClass("sort-"+l.sortedDir))}function f(e){e=$(e);q.html(e.find(b.isNonTable?".table":"table").html()).updateUi();var d=e.filter(".header").find(".title");0==d.length&&(d=e.find(".header").find(".title"));a.find(".header .title").replaceWith(d);a.trigger("tabulator-load-success",[e]);var f=e.find("paginator");e=+f.attr("total");d=+f.attr("max");f=+f.attr("offset");
n&&n.update(e,d,Math.floor(f/d)+1);c();g();m()}function g(){var a=q.find("td.editable");a.length&&bm.makeTableCellEditable(a,p.afterCellEdit)}function m(){var a=q.find("td.selectable");a.length&&p.selectableCellSelect&&bm.makeTableCellSelectable(a,p.selectableCellSelect,p.afterCellSelect,p.beforeCellSelect)}var l={url:"",appendUrl:null,type:"get"},n=a.find(".pagination")?a.find(".pagination").obj():null,q=a.find(b.isNonTable?".table:first":"table:first"),e;b.menu_entries&&(e=bm.menu(b.menu_entries,
q,".action-navigator",{click:function(a,b){p.onActionClick(a,b.config("entity"),b)},open:function(a,b){if(p.onMenuOpen)p.onMenuOpen(a,e)}},"click",["right+10 bottom+5","right top"]));q.on("click",".sortable",function(a){a=$(a.target);var b=a.index();l.sorted=""+b;l.sortedDir=a.is(".sort-up")?"down":"up";p.reload()});var p=$.extend({paginator:n,reload:function(){if(n)n.onPageClick(n.getCurrentPage());else d()},menu:e,sortAdd:function(a,b){l.sortable[a]=b},sortRemove:function(a){delete l.sortable[a]}},
b);$.extend(l,b);a.find("select.per-page-count").change(function(a,b,c){n.update(void 0,+c,1);d()});n&&(n.onPageClick=d);c();g();m();return p},tableCheckAll:function(a,b,d,c){var f=a.filter(".content");f.delegate("td.select-column :checkbox","change",function(){var g=a.find("td.select-column :checkbox");g.length==g.filter(":checked").length?(f.find(".check-all").prop("checked",!0),b&&1<g.filter(":checked").length&&b()):1<g.filter(":checked").length?(f.find(".check-all").checkbox("state","partial"),
d&&d()):(f.find(".check-all").prop("checked",!1),c&&c());f.obj(Scrollbar)&&f.tscrollbar("content",f.find(".check-all").closest("th"))});a.delegate(".check-all","change",function(){var a=f.find(".select-column :checkbox");a.prop("checked",this.checked);this.checked&&2<a.filter(":checked").length?b&&b():c&&c();f.tscrollbar("content",f.find(".check-all").closest("th"))})},tableToggleRow:function(a,b){a.find(".toggle-cell").click(function(){var a=$(this),c=a.parents("tr").next();a.is(".collapsed")?(a.removeClass("collapsed").addClass("expanded"),
c.show()):(a.removeClass("expanded").addClass("collapsed"),c.hide());b&&b(a)})},taskPopup:function(a,b,d){app.taskPopupCaches||(app.taskPopupCaches={});var c=b.token+"#"+b.name;if(app.taskPopupCaches[c])app.taskPopupCaches[c].setActive();else{var f=function(){bm.ajax({url:b.detail_status_url,data:{token:b.token},success:function(a){b.detail_viewer.update(g,a);"running"==a.status&&setTimeout(f,1E3)}})},g=new POPUP($.extend({title:$.i18n.prop("task.detail")+" - <span class='emphasized'>"+bm.htmlEncode(b.name)+
"</span>",ajax_url:a,ajax_settings:{data:b},clazz:"task-popup",draggable:!1,modal:!1,events:{content_loaded:function(){b.detail_viewer.init(g);f()}}},d));g.on("close",function(){delete app.taskPopupCaches[c]});return app.taskPopupCaches[c]=g}},twoSideSelection:function(a,b,d,c,f,g,m){function l(){var a=[];$.each(da,function(b,c){f[b]&&a.push(c)});return a}function n(a){a.removeClass("expanded up-side").addClass("collapsed");ea.off("blur").removeClass("up-side").remove();a=a.attr("entry-hidden");ea.find(a).removeClass("hidden")}
function q(a){for(var b=$(),c=0;c<a;c++){var e=Z.clone();S.append(e);b=b.add(e)}return b}function e(){var a=S.find("tr td[item]").length,b=K.find("tr td").length/2;b=1<b?b:1;b=a?0>b-a?0:b-a:b;if(0==a||b!=Y)a=0>Y?0:S.find("tr.empty").length,b<a?S.find("tr.empty").filter(":lt("+(a-b)+")").remove():q(b-a),H.onPageClick(H.getCurrentPage())}function p(a){var b={};0<a.find("input[name]").length?a.find("input[name]").each(function(){b[$(this).attr("name")]=$(this).val()}):g.every(function(c,e){a.attr(e)&&
(b[e]=a.attr(e))});return b}function t(a){a=S.find("td[item].actions-column"+(a?":visible":""));var b=$();K.length&&(a.each(function(){var a=$(this).attr("item");b=b.add(N.find("td.actions-column["+d+"='"+a+"'] input:checkbox")).prop("checked",!1)}),K.trigger("change"));w(b,a.closest("tr"))}function w(a,b){a.closest("tr").removeClass("selected");a.length&&z();b.length&&(b.remove(),H.setTotal(H.getTotal()-b.length),H.onPageClick(H.getCurrentPage()),e())}function y(a){var b=$();a.each(function(){var a=
$(this).parent().attr(d);b=b.add(S.find("td.actions-column[item='"+a+"'][type='"+d+"']").closest("tr"))});w(a,b)}function A(a){H.setTotal(H.getTotal()+a.length);S.find(".empty").length<a.length&&(q(a.length),H.getPageCount()==H.getCurrentPage()+1&&H.setCurrentPage(H.getCurrentPage()+1,!0));$.each(a,function(){var a=this.row?this.row:S.find(".empty:first").removeClass("empty");for(var b=a.find("td").not(":last"),c=0;c<this.name.length;c++)$(b[c]).text(this.name[c]);a.attr("type",d).find("td.actions-column").attr("item",
this.value).attr("type",d);a.addClass(d);var e=this;a.find("input[type='hidden']").each(function(a,b){$(b).attr("name",g[a]).val(e.value[a])});V.onNewSelection(a)});S.trigger("row-update");H.onPageClick(H.getCurrentPage())}function x(a){a.closest("tr").addClass("selected");var b=[],c=$(S.find("tr")[0]).find("th").not(":last");a.each(function(){var a=$(this),e=[];a.siblings("input").each(function(){e.push($(this).val())});var d=[];a=a.closest("tr").find("td").not(":last");if(c.length==a.length)for(var f=
0;f<c.length;f++)d.push($(a[f]).text().trim());else if(c.length<a.length){f=0;for(var g=[];f<c.length-1;)d.push($(a[f]).text().trim()),f++;for(;f<a.length;)$(a[f]).text()&&g.push($(a[f]).text().trim()),f++;d.push(g.join("-"))}else for(g=f=0;g<c.length;)d.push($(a[f]).text().trim()),f++,g++,f==a.length&&(f=0);b.push({name:d,value:e})});A(b);z()}function z(){var a=K.find("td.actions-column :checkbox");0==a.filter(":checked").length?K.find(".check-all").prop("checked",!1):a.length==a.filter(":checked").length?
K.find(".check-all").prop("checked",!0):K.find(".check-all").checkbox("state","partial");K.find(".check-all").closest("th").length&&K.tscrollbar("content",K.find(".check-all").closest("th"))}function D(){var a=N.find("td.actions-column");a.each(function(){var a=$(this).attr(d);S.find("td[type='"+d+"'][item='"+a+"']").length&&$(this).closest("tr").addClass("selected").find("input:checkbox").prop("checked",!0)});var b=a.find("input:checkbox").length;a=a.find("input:checkbox:checked").length;var c=K.find(".check-all:first").filter(":hidden");
b==a&&0!=a?c.prop("checked",!0):0<a?c.checkbox("state","partial"):c.prop("checked",!1);z()}function B(a){var b=pa.find("td.actions-column[type='"+d+"']"),e=[];b.each(function(){e.push($(this).attr("item"))});e.length&&(pa.loader(),bm.ajax({url:c,data:{ids:e,max:e.length},dataType:"html",response:function(){pa.loader(!1)},success:function(c){0==M.resetRightPanel?a():V.resetRightPanel($(c),b,a)},error:function(){a&&a()}}))}function G(a){N.loader();E=!0;var b={max:Y,offset:Y*(a-1),fieldName:d};V.beforeLoadTableContent&&
V.beforeLoadTableContent(b);c?bm.ajax({url:c,data:b,dataType:"html",response:function(){N.loader(!1)},success:function(a){if(P)P=!1,N.html(a),N.updateUi(),ra=J();else{var b=$(a).find("table");K.tscrollbar("destroy");N.find("table").replaceWith(b);b.updateUi()}var c=$(a).find("paginator");a=+c.attr("total");b=+c.attr("max");c=+c.attr("offset");ra.update(a,b,Math.floor(c/b)+1);K=N.find("table").tscrollbar({vertical:{height:442}});B(function(){D();e()})},complete:function(){N.removeClass("updating");
E=!1}}):(a=function(a){N.html(a);V.initContent(N,function(a,b){A([{name:a,value:b}])});N.loader(!1);E=!1;K=$("")},P=!0,b=V.getPanelBody(d,b),"string"==typeof b?a(b):b.then=a)}function L(){D();N.on("click",".tool-icon.view",function(a){if(!$(a.target).hasClass("disabled")){a=$(a.target).parent();var b=a.attr(d);V.onViewClick(d,b,a.prev().html().trim(),a)}}).on("click",".tool-icon.edit",function(a){if(!$(a.target).hasClass("disabled")){a=$(a.target).parent();var b=a.attr(d);V.onEditClick(d,b,a.prev().html().trim(),
a.closest("tr"))}});return J()}function J(){var b=N.find(".pagination").obj();b&&(b.onPageClick=G);a.find(".per-page-count").change(function(a,c,e){e=+e;b.update(void 0,e,1);H.update(void 0,e,1);Y=e;H.onPageClick(H.getCurrentPage());V.reload()});return b}m=void 0===m?{}:m;var P=!1,fa={remove:!0,view:!0,edit:!0,config:!1,"column-sort":!1};f=$.extend({},fa,f);var da={view:{text:$.i18n.prop("view"),ui_class:"view",action:"view"},edit:{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"},config:{text:$.i18n.prop("configure"),
ui_class:"config",action:"config"},remove:{text:$.i18n.prop("remove"),ui_class:"remove",action:"remove"}},M=m,V={reload:function(){if(!E)ra.onPageClick(ra.getCurrentPage())},setUrl:function(a,b,e,m){d=b;c=a;g=m;f=$.extend({},fa,e,{"column-sort":f["column-sort"]});E||G(1);ea=bm.createMenu(l())},clearAllSelection:function(){t(!1)},getAllSelectedByField:function(a){var b=[];a&&S.find("input[name='"+a+"']").each(function(a,c){b.push($(c).val())});return b},hasSelected:function(a,b){var c=!1;"undefined"==
typeof b?S.find("tr:not(.empty) td.actions-column").each(function(b,e){$(e).find("input:first").val()==a&&(c=!0)}):S.find("input[name='"+a+"']").each(function(a,e){$(e).val()==b&&(c=!0)});return c},onViewClick:function(){},onEditClick:function(a,b,c,e){},onDeleteClick:function(a,b,c,e){},onConfigClick:function(){},onNewSelection:function(){},getPanelBody:function(){},triggerExternalInit:function(){V.initContent(N,function(a,b,c){"undefined"==typeof c?A([{name:a,value:b}]):A([{name:a,value:b,row:c}])})},
unselect:function(a,b){var c=d==a?N.find("td.actions-column["+a+"='"+b+"'] input:checkbox"):[];c.length||(c=S.find("tr:has(td.actions-column[item='"+b+"'][type='"+a+"'])"));c.filter("input:checkbox").prop("checked",!1);y(c)},getSavedData:function(a,b,c){"string"==typeof a&&(a=S.find("td.actions-column[item='"+a+"'][type='"+b+"']"));return a.data(c)},saveData:function(a,b,c,e){"string"==typeof a&&(a=S.find("td.actions-column[item='"+a+"'][type='"+b+"']"));a.data(c,e)},getAllSelectedData:function(){var a=
S.serializeObject();S.find("td.actions-column[item]").each(function(){var b=$(this).data();b&&(a=bm.serializeMix(a,b))});return a},isSelected:function(a,b){return S.find("input[name='"+a+"'][value='"+b+"']").length},resetRightPanel:function(a,b,c){a=a.find("td.actions-column");for(var e=0;e<b.length;e++){var d=$(b[e]),f=a.find("input[value="+d.attr("item")+"]").parent();f.length?d.prev("td").text(f.prev("td").text()):d.parent().remove()}c&&c()}},ea=bm.createMenu(l());if("number"==typeof b)var Y=b;
else b?b.is("select")||(b=b.find("select")):b=a.find(".pagination-perpage-selector"),b.change(function(){Y=+this.value;G(1);H.setItemsPerPage(Y);e();H.onPageClick(H.getCurrentPage())}),Y=+b.val();b&&b.length||(Y=10);var pa=a.find(".last-column .column-content"),N=a.find(".first-column .column-content"),Z=pa.find(".action-column-dice-content table tr").addClass("empty"),S=pa.find("table:first"),K=N.find("table:first");f["column-sort"]&&(S.find("th:eq(0)").sortablecolumn({}),S.bind("sort",function(){H.setCurrentPage(H.getCurrentPage(),
!0);S.tscrollbar("content",S.find("th:eq(0)"))}));var H=pa.find(".pagination").obj();H.onPageClick=function(a){var b=H.all?10<H.getTotal()?H.getTotal():10:H.getItemsPerPage(),c=(a-1)*b;1>c&&(c=0);for(var e=S.find("tr:not(:first)"),d=0;d<H.getTotal();d++)d>=c&&d<=b*a?$(e[d]).show():$(e[d]).hide()};e();S.on("click",".remove-item",function(){var a=$(this).closest("td"),b=p(a),c=a.attr("type"),e=a.closest("tr");V.onDeleteClick(c,b,a.prev().html().trim(),e);b=$();K&&d==c&&(a=a.attr("item"),b=b.add(K.find("td.actions-column["+
c+"='"+a+"'] input:checkbox")),b.prop("checked",!1));w(b,e)});a.on("click",".action-navigator",function(){var a=$(this),b=a.attr("entry-hidden");ea.find(b).addClass("hidden");if(a.is(".collapsed")){a.is("[tabindex]")||a.attr("tabindex","0");a.removeClass("collapsed").addClass("expanded");a.after(ea);b=a.outerHeight();var c=ea.outerHeight();b=a.offset().top-$(window).scrollTop()+b+c;$(window).height()<b?(ea.position({my:"right bottom",at:"right top+1",of:a}).addClass("up-side"),a.addClass("up-side")):
ea.position({my:"right top",at:"right bottom-1",of:a});a.focus().on("blur",function(){n(a)})}else n(a)});a.on("mousedown",".menu-item",function(a){var b=$(this);if(!b.is(".disabled")){a=b.closest(".floating-menu").siblings(".action-navigator");var c=b.attr("action");b=a.closest("td");var e=p(b);a=b.attr("type");switch(c){case "remove":c=b.closest("tr");V.onDeleteClick(a,e,b.prev().html().trim(),c);e=$();K&&d==a&&(b=b.attr("item"),e=e.add(K.find("td.actions-column["+a+"='"+b+"'] input:checkbox")),
e.prop("checked",!1),K.trigger("change"));w(e,c);break;case "view":V.onViewClick(a,e,b.prev().html().trim(),b);break;case "edit":V.onEditClick(a,e,b.prev().html().trim(),b.closest("tr"));break;case "config":V.onConfigClick(a,e,b.prev().html().trim(),b)}}});S.find(".remove-all").on("click",function(){t(!0);"function"==typeof V.onRemoveAll&&V.onRemoveAll.call(this)});S.tscrollbar({vertical:{height:443}});S.on("click","td.actions-column .move-up",function(a){a=$(a.target).closest("tr");var b=a.prev();
b.length&&0==b.has("th").length&&(a.swap(b),b.is(":hidden")&&(a.hide(),b.show()),S.find("th:eq(0)").sortablecolumn("resetSortState"),S.tscrollbar("content",S.find("th:eq(0)")));S.trigger("change")}).on("click","td.actions-column .move-down",function(a){a=$(a.target).closest("tr");var b=a.next();b.length&&!b.is(".empty")&&(a.swap(b),b.is(":hidden")&&(a.hide(),b.show()),S.find("th:eq(0)").sortablecolumn("resetSortState"),S.tscrollbar("content",S.find("th:eq(0)")));S.trigger("change")});H.setCurrentPage(1,
!0);N=a.find(".first-column .column-content");var E=!1;N.on("change","td.actions-column input:checkbox",function(a){$(a.target).prop("checked")?x($(a.target)):y($(a.target))});K=N.find("table").tscrollbar({vertical:{height:443}});N.on("change",".check-all",function(a){$(a.target).prop("checked")?(a=N.find("td input:checkbox:not(:checked)"),a.length?(a.each(function(){$(this).prop("checked",!0)}),x(a)):z()):(a=N.find("td input:checkbox:checked"),a.length&&(a.each(function(){$(this).prop("checked",
!1)}),y(a)))});var ra=c?L():null;(function(){pa.find("td.actions-column").each(function(){var a=$(this);a.closest("tr").addClass(a.attr("type"))})})();return V},unique:function(a){function b(a,b){if(1==b.length){$(b[0]).closest(".form-row").after(a);var c=a.find(".trash-duplicate-delete");c.is(":checked")&&c.trigger("change");c.attr("name","deleteTrashItem."+b[0].name);a.show()}else a.hide()}function d(a,c){a.form("unlock",f);if(c.is(".trash-conflict-element")){c.removeClass("trash-conflict-element");
var e=a.find(".trash-row");a=a.data("trash-conflicts-list");a.remove(c[0]);b(e,a)}}function c(){var c=(new Date).getTime();if(!(20>=c-q)){q=c;var e=a.elm,g={},n=a.form||e.closest("form");a.editMode&&(g.id=n.find("input[name=id]").val());g.field=e.attr("unique-field")||e.attr("name");g.value=e.val().trim();g.customName=e.attr("unique-field-name");m&&(g.compositeField=m,g.compositeValue=l.val().trim());g.value&&(this!=e[0]&&e[0].validation_obj.clear(),bm.ajax({url:a.url,data:g,show_response_status:!1,
success:function(){a.elm.trigger("unique");d(n,e)},error:function(a,c,d){e[0].validation_obj.showError({msg_template:d.message});n.form("lock",f);"inTrash"==d.errorFlag?(e.data("trash-params",g),e.is(".trash-conflict-element")||(a=n.find(".trash-row"),(c=n.data("trash-conflicts-list"))?c.push(e[0]):n.data("trash-conflicts-list",c=[e[0]]),b(a,c),e.addClass("trash-conflict-element"))):e.is(".trash-conflict-element")&&(e.removeClass("trash-conflict-element"),a=n.find(".trash-row"),c=n.data("trash-conflicts-list"),
c.remove(e[0]),b(a,c))}}))}}var f=bm.getUUID();a=$.extend({lockId:f},{url:"",elm:void 0,editMode:!1},a);var g=a.elm.closest("form"),m=a.elm.attr("composite-unique"),l,n=a.elm;m&&(l=g.find("[name='"+m+"']"));var q=0;n.on("change blur",c);if(l)l.on("change",c);g.find(".trash-duplicate-restore").off("click").click(function(){var a=g.data("trash-conflicts-list"),b=$(a[0]).data("trash-params");bm.ajax({url:a[0].unique_config.restoreUrl,data:b,success:function(a){g.trigger("trash-restore",[a.type,a.id]);
app.global_event.trigger("trash-restore",[a.type,a.id]);app.global_event.trigger(a.type+"-restore",[a.id]);(a=g.closest(".popup").obj(POPUP))&&a.close()}})});g.find(".trash-duplicate-delete").off("change").on("change",function(){var a=g.data("trash-conflicts-list")[0].unique_config;if($(this).prop("checked"))g.form("unlock",a.lockId).on("ajax-submit-success",function(){app.global_event.trigger("trash-delete")});else g.form("lock",a.lockId).off("ajax-submit-success")});var e=ValidationField.createDetachedField(n);
a.elm.on("focus",function(){d(g,a.elm);e.clear()});a.elm[0].validation_obj=e;a.elm[0].unique_config=a},unmask:function(a){a.unmask()},updateCategorySelector:function(a,b){a.filter("select").each(function(){var a=$(this),c=a.val(),f="[]"!=a.attr("select-values")?JSON.parse(a.attr("select-values")):[""],g={domain:b};c?"string"==typeof c&&(c=[c]):c=[];a.attr("select-key")&&(g.key=a.attr("select-key"));a.attr("select-text")&&(g.text=a.attr("select-text"));bm.ajax({url:app.baseUrl+"app/hierarchySelector",
data:g,dataType:"html",success:function(b){var d=$(b);b=a.find("option.domain-prepend");var g=a.find("option.domain-append");a.find("option").remove();var m=!1;$.each(c,function(a,b){0<d.find("option[value='"+b+"']").length&&(m=!0)});var e=m?c:f;a.append(b).append(d.find("option")).append(g).val(e);a.attr("multiple")?a.trigger("liszt:updated"):a.chosen()}})})},updateDomainSelector:function(a,b){a.filter("select").each(function(){var a=$(this),c=a.val(),f="[]"!=a.attr("select-values")?JSON.parse(a.attr("select-values")):
[""],g={domain:b};c?"string"==typeof c&&(c=[c]):c=[];a.attr("select-key")&&(g.key=a.attr("select-key"));a.attr("select-text")&&(g.text=a.attr("select-text"));bm.ajax({url:app.baseUrl+"app/domainSelector",data:g,dataType:"html",success:function(b){var d=$(b);b=a.find("option.domain-prepend");var g=a.find("option.domain-append");a.find("option").remove();var m=!1;$.each(c,function(a,b){0<d.find("option[value='"+b+"']").length&&(m=!0)});var e=m?c:f;a.append(b).append(d.find("option")).append(g).val(e);
a.attr("multiple")?a.trigger("liszt:updated"):a.chosen()}})})},uploadImageToAssetLibrary:function(a){a=$.extend({},a);bm.editPopup(app.baseUrl+"app/imageUploadForm",$.i18n.prop("upload.image"),"",{},a)},viewPopup:function(a,b,d){app.viewCaches||(app.viewCaches={});var c=a+"#"+bm.hash(b),f=app.viewCaches[c];if(f)return f.setActive(),f;f=new POPUP($.extend({ajax_url:a,ajax_settings:{data:b},show_title:!1,clazz:"view-popup",draggable:!0,drag_handle:"*",drag_cancel:":input, .view-content-block",modal:!1,
width:500},d));f.on("close",function(){delete app.viewCaches[c]});return app.viewCaches[c]=f},waitPopup:function(){return new POPUP({show_close:!1,width:620,height:400,el:$('<div><div class="bg-white div-mask" style="position: absolute; top: 0; bottom: 0; left: 0; right: 0"><div class="loader2"></div><div class="wait-message">'+$.i18n.prop("this.may.take.some.time")+"</div></div></div>")})},zoneSelectionPopup:function(a,b){var d=b.url||app.baseUrl+"zone/zoneSelectionPopup",c=b.title||$.i18n.prop("select.zones"),
f=b.emphasized,g=b.data||{},m=b.fieldName||"zone",l=[],n=b.preview_holder||a;n.find("input[name='"+m+"']").each(function(){l.push($(this).val())});$.extend(g,{fieldName:m,zone:l});var q=b.previewer||function(a,b){n.find("input[name='"+m+"']").remove();b.find("input:hidden[name]").each(function(){var a=$(this).attr("name");a=$("<input type='hidden' name='"+a+"' value='"+$(this).val()+"'>");n.append(a)})};return bm.editPopup(d,c,f,g,{width:850,events:{content_loaded:function(a,b){bm.initZoneSelection(this,
"zone",null,[m])}},beforeSubmit:function(c,d,f){var e={};e[m]=[];c.find("input:hidden[name]").each(function(){var a=$(this),b=a.attr("name"),c=a.parents("tr");e[b].push({name:c.find("td:eq(0)").text().trim(),value:a.val()})});q(e,c,n,b.previewConfig);a.trigger("change");f.close();return!1}})},zoneSelector:function(a,b){var d=a.find(".zone-create-panel"),c=a.find("form");d.length||(d=$('<div class="zone-create-panel" action="/zone/"></div>'),b.parent().after(d));b.change(function(){if("create-zone"==
b.val())bm.ajax({url:app.baseUrl+"zone/fields",dataType:"html",success:function(a){a=$(a);d.append(a);a.updateUi();c.form("append",d);bm.countryChangeSelection(a.find("select[name=zone\\.country\\.id]"),!0,{isMultiple:"true",stateName:"zone.state.id"})}});else{var f=a.find(".zone-create-panel *");a.trigger("content-change",[null,f]);f.remove()}});b.trigger("change")},countryChange:function(a,b){a.find("#countryId").on("change",function(){var d=this.name,c;d.indexOf(".")&&(c=d.split(".")[0]);d=$(this).attr("name").endsWith("default_country");
var f=$(this).val();c=$.extend({},{id:f,inputClass:"large",stateLabel:d?"default.state":"state",stateName:(c?c+".":"")+(d?"default_state":"state"),noSelection:null},b);bm.ajax({url:app.baseUrl+"app/loadStateForCountry",dataType:"html",data:c,success:function(b){a.find(".form-row.state-selector-row").remove();a.find(".form-row.country-selector-row").after(b);a.find(".form-row.state-selector-row").updateUi();a.trigger("state-load")}})})},countryChangeSelection:function(a,b,d){function c(a){a.find("select[name=zone\\.state\\.id]").change(function(){var a=
$(this).val();a&&1<a.length?m.hide():m&&m.show()}).trigger("change")}var f=a.closest(".form-row"),g=f.next(".state-selector-row"),m=f.siblings(".post-code");g&&c(g);var l=a.val();(!l||1<l.length)&&m.hide();a.change(function(){var a=$(this).val();g.remove();a&&1==a.length||!b?($.extend(d,{id:b?a[0]:a}),bm.ajax({url:app.baseUrl+"app/loadStateForCountry",dataType:"html",data:d,success:function(a){if(g=$(a).insertAfter(f))c(g),g.updateUi();f.parents("form").trigger("state-load")}}),m.show()):b&&m.hide()})},
updateDomainSelector:function(a,b){a.filter("select").each(function(){var a=$(this),c=a.val(),f="[]"!=a.attr("select-values")?JSON.parse(a.attr("select-values")):[""],g={domain:b};c?"string"==typeof c&&(c=[c]):c=[];a.attr("select-key")&&(g.key=a.attr("select-key"));a.attr("select-text")&&(g.text=a.attr("select-text"));bm.ajax({url:app.baseUrl+"app/domainSelector",data:g,dataType:"html",success:function(b){var d=$(b);b=a.find("option.domain-prepend");var g=a.find("option.domain-append");a.find("option").remove();
var m=!1;$.each(c,function(a,b){0<d.find("option[value='"+b+"']").length&&(m=!0)});var e=m?c:f;a.append(b).append(d.find("option")).append(g).val(e);a.attr("multiple")?a.trigger("liszt:updated"):a.chosen()}})})},updateCategorySelector:function(a,b){a.filter("select").each(function(){var a=$(this),c=a.val(),f="[]"!=a.attr("select-values")?JSON.parse(a.attr("select-values")):[""],g={domain:b};c?"string"==typeof c&&(c=[c]):c=[];a.attr("select-key")&&(g.key=a.attr("select-key"));a.attr("select-text")&&
(g.text=a.attr("select-text"));bm.ajax({url:app.baseUrl+"app/hierarchySelector",data:g,dataType:"html",success:function(b){var d=$(b);b=a.find("option.domain-prepend");var g=a.find("option.domain-append");a.find("option").remove();var m=!1;$.each(c,function(a,b){0<d.find("option[value='"+b+"']").length&&(m=!0)});var e=m?c:f;a.append(b).append(d.find("option")).append(g).val(e);a.attr("multiple")?a.trigger("liszt:updated"):a.chosen()}})})},tableToggleRow:function(a,b){a.find(".toggle-cell").click(function(){var a=
$(this),c=a.parents("tr").next();a.is(".collapsed")?(a.removeClass("collapsed").addClass("expanded"),c.show()):(a.removeClass("expanded").addClass("collapsed"),c.hide());b&&b(a)})},selectFromAssetLibrary:function(a,b,d,c,f){var g,m;c=$.extend({},c,{_self:this,width:500,events:{content_loaded:function(a){function c(a){"undefined"==typeof a&&(a="pub");WebDAVClient.doPropFind(a,this,{onPopulate:function(b){e.find(".folder, .file").remove();if("pub"!=a){var n=$('<div class="folder"> <span class="tool-icon back" title="'+
$.i18n.prop("back")+'"></span></div>');e.append(n);n.click(function(){m=!1;p=p.substring(0,p.lastIndexOf("/"));c(p)})}$.each(b.folders,function(a,b){var d=$('<div class="folder"> <span class="tree-icon"></span> <span class="tree-title">'+b.name+"</span></div>");e.append(d);var l=0;d.click(function(){var a=null;l++;1===l?a=setTimeout(function(){l=0;d.siblings(".selected").removeClass("selected");m=!1;0==f&&(m=!0,d.addClass("selected").siblings(".selected").removeClass("selected"),g=bm.encodePath(app.baseUrl+
"pub"+b.path.substring(b.path.indexOf("/"))))},200):(l=0,clearTimeout(a),p=b.path,c(b.path),e.next().find(".selectedValue").removeAttr("src").data("loaded",!1))})});$.each(b.files,function(a,b){a="bmp gif jpg png psd pspimage thm tif yuv jpeg".split(" ");var c=b.clazz;d=d?d:a;if(d.contains(c)&&0!=f){var n=$('<div class="file '+c+'"> <span class="tree-icon"></span> <span class="tree-title">'+b.name+"</span></div>");e.append(n);n.click(function(){m=!1;g=bm.encodePath(app.systemPubUrl+"/"+b.path.substring(b.path.indexOf("/")+
1));if(void 0===f){var a=$("<img>",{src:g});l.find(".asset-library-image-preview").html(a);a.on("load",function(){m=!0;n.addClass("selected").siblings(".selected").removeClass("selected")})}else f&&(e.find(".file.selected").removeClass("selected"),n.addClass("selected"),m=!0)})}})}})}var l=this,e=this.find(".remote_folders").scrollbar({vertical:{offset:2}}),p;c("pub");this.find(".file-selector").form({preSubmit:function(){m?(b(g),a.close()):f?bm.notify($.i18n.prop("file.not.selected"),"error"):void 0===
f?bm.notify($.i18n.prop("image.not.selected"),"error"):bm.notify($.i18n.prop("folder.not.selected"),"error");return!1}})}}});bm.editPopup(app.baseUrl+"remoteRepository/selectFileFromAssetLibraryForWidget",a,"",{isFile:void 0===f?f:!0},c)},uploadImageToAssetLibrary:function(a){a=$.extend({},a);bm.editPopup(app.baseUrl+"app/imageUploadForm",$.i18n.prop("upload.image"),"",{},a)},makeTableCellEditable:function(a,b){function d(){function a(a){a=a.val();m.text(a);if(a!=l&&(t.val(a),b&&!1===b(d,a,l))){p.focus();
return}e.remove();d.removeClass("editing");m.cshow();g.siblings("tr.data-row").addBack().each(function(){$(this).trigger("heightChange")})}var d=$(this).parent(),g=d.parent();d.addClass("editing");var m=d.find(".value"),l=m.chide().text().trim(),n=d.attr("validation"),q=d.attr("maxlength");d.append("<input type='text' class='td-full-width' maxlength='"+(q?q:"")+"' validation='"+(n?n:"")+"'>");n=d.attr("restrict");var e=d.find("input[type='text']");e.val(l);if(n)e[n]();var p=e.get(0),t=d.find("input[type='hidden']");
p.selectionStart=p.selectionEnd=p.value.length;p.focus();d.trigger("cell-edit");g.siblings("tr.data-row").addBack().each(function(){$(this).trigger("heightChange")});e.on("focusout",function(){a($(this))}).on("keypress",function(b){13==b.keyCode&&(b.preventDefault(),a($(this)))})}a.each(function(){var a=$(this);if(!a.find(".value").length){var b=a.html();a.html('<span class="value"></span>');a.find(".value").html(b)}b="edit";a.is(".custom-edit")?(b="change-all",a.append('<span class="fake-link '+
b+'">'+$.i18n.prop("change.all")+"</span>")):a.append('<span class="tool-icon '+b+'"></span>');a.find("."+b).on("click",d)})},makeTableCellSelectable:function(a,b,d,c){function f(){var a=$(this).parent();a.addClass("editing");var c=a.find(".value"),f=a.find(".text"),n=c.chide().text().trim(),q=$.isFunction(b)?b(a):b.clone().show();q.addClass("td-full-width");if(a.is(".hidden-overflow-selectable")){var e=$("<div class='selectable-td-proxy'></div>").appendTo(document.body);e.append(q);e.position({my:"left top",
at:"left top",of:a,collision:"none"});e.width(a.outerWidth(),!0);e.height(a.outerHeight(),!0)}else a.append(q);q.val(n);q.chosen();q.on("chosen:hiding_dropdown",function(){var b=$(this).val();q.chosen("remove");if(n!=b){c.text(b);var e=$(this).find("option:selected").text();f.text(e);d&&d(a,b,e,n)}a.removeClass("editing");a.is(".hidden-overflow-selectable")&&$(".selectable-td-proxy").remove();c.cshow()});q.chosen("dropshow");return!1}a.each(function(){var a=$(this);if(!a.find(".value").length){var b=
a.html();a.html('<span class="value"></span><span class="text"></span>');a.find(".value").html(b);a.find(".text").html(b)}b="edit";a.is(".custom-select")?(b="change-all",a.prepend('<span class="fake-link '+b+'">'+$.i18n.prop("change.all")+"</span>")):a.append('<span class="tool-icon '+b+'"></span>');a.find("."+b).on("click",function(){c&&!1===c(a)||f.call(this)})})},autoToggle:function(a){function b(b){var c=b.filter(":radio");b=b.not(c);var e=[];c.each(function(){var d=$(this),f=d.attr("name");if(!e.contains(f)){e.push(f);
var g=c.filter("[name='"+f+"']:checked");g.length||(g=a.find("[name='"+f+"']:checked"));g.length||(g=d);b=b.add(g)}});return b}function d(a,c,e){var d=a.find("[toggle-target]");a.is("[toggle-target]")&&(d=d.add(a));d=b(d);d.each(function(){var a=$(this),b=a.is("select, :checkbox, :radio")?"change":"click";c?a.triggerHandler(b+"."+g,[!1,e]):a.triggerHandler(b+"."+g,[!0,e])})}function c(a,b,c,f){a.each(function(){var a=$(this);if(!f||!a.is(f)){var e=a.is("[do-reverse-toggle]"),g=b;e&&(g=!b);e="none"==
a.css("display");g&&e?(g=function(){d(a,!0,f)},c?a.show(c,g):(a.show(),g())):g||e?d(a,g,f):(g=function(){var b=a.find('[validation]:not([validate-on="call-only"])');a.is("[validation]")&&(b=b.add(a));b.trigger('[validation]:not([validate-on="call-only"])');d(a,!1,f);a.find("input").valid()},c?a.hide(c,g):(a.hide(),g()))}})}function f(b){var c=!1;a.find("[toggle-target]").each(function(){var e=$(this).attr("toggle-target");$(this).is("select")?$(this).find("option").each(function(){var d="."+e+"-"+
$(this).val();if(b.closest(d,a[0]).length)return c=!0,!1}):c=b.closest("."+e,a[0]).length;if(c)return!1});return c}var g=bm.getUUID(),m=function(b){var c=b;b.each(function(){var b=$(this);if(b.is("select")){var d=b.val().replaceAll("\\.","_");b=a.find("."+b.attr("toggle-target")+"-"+d)}else b=a.find("."+b.attr("toggle-target"));b.length&&(d=b.find("[toggle-target]"),d=d.add(b.filter("[toggle-target]")),d.length&&(c=c.add(m(d))))});return c},l=a.find("[toggle-target]").each(function(){var b=$(this),
d=b.attr("toggle-anim")?b.attr("toggle-anim"):"blind";"none"==d&&(d=null);if(b.is("select"))b.on("change."+g,function(e,f,g){"boolean"!=typeof f&&(f=!1,g=null);var l=b.val().replaceAll("\\.","_"),n="."+b.attr("toggle-target")+"-"+l,q=$();b.find("option").each(function(c,e){c=$(e).val().replaceAll("\\.","_");c!=l&&(c=b.attr("toggle-target")+"-"+c,c=a.find("."+c),q=q.add(c.not(n)))});n=a.find(n);e=g?g.add(m(n)):m(n);c(q,!1,d,e);c(n,f?!1:!0,d,g)});else if(b.is(":checkbox, :radio")){var e=function(e,
f,g,l){"boolean"!=typeof f&&(f=!1,g=null);if(!f){e=a.find("[name='"+b.attr("name")+"']").not(b).filter("[toggle-target]:not([independent])");var n=$();e.each(function(b,c){b=a.find("."+$(c).attr("toggle-target"));n=n.add(b.not(w))});c(n,!1,d,l?g?g.add(m(w)):m(w):g)}e=b.prop("checked");b.state=e;b.is(".toggle-reverse")&&(e=!e);c(w,f?!1:e,d,g,l)};var f="change";var l="."+b.attr("toggle-target"),w=a.find(l);b.on(f+"."+g,function(a,b,c){e(a,b,c,!0)});if(b.is(":radio"))a.find("[name='"+b.attr("name")+
"']:radio").not("[toggle-target]").on(f+"."+g,function(a,c,d){"boolean"!=typeof c&&(d=null);(b.state||void 0===b.state)&&e(a,!0,d)})}else f="click",w=a.find("."+b.attr("toggle-target")),b.on(f+"."+g,function(a,e,f){a="true"==b.attr("row-expanded");"undefined"==typeof e&&(a=!a,b.attr("row-expanded",""+a));c(w,e?!1:a,d,f)})});b(l).each(function(){var a=$(this),b=a.is("select, :checkbox, :radio")?"change":"click";f(a)||a.triggerHandler(b+"."+g,[!1])});return a},cBaseDoc:function(a){var b=$("<div id='documentation-slide' style='display: none'><div class='icon-block'><span class='tool-icon close-icon' title='"+
$.i18n.prop("close")+"'></span></div><iframe src='about:blank'></iframe></div>"),d=$(document.body);a.each(function(){var a=$(this);a.attr("attached")||(a.click(function(){var c=a.attr("target-url");b.is(":hidden")&&(d.prepend(b),b.css({height:window.innerHeight}),b.find(".tool-icon.close-icon").click(function(){b.toggle("slide",{direction:"right"},function(){d.find("#documentation-slide").remove()})}),b.toggle("slide",{direction:"right"}));b.find("iframe").attr("src",c)}),a.attr("attached",!0))})},
floatingPanel:function(a,b,d,c){c=c?c:{};c.clazz="floating-panel-popup"+(c.clazz?" "+c.clazz:"");return new POPUP($.extend({ajax_url:b,ajax_settings:{data:d},show_title:!1,masking:!1,show_close:!1,close_on_blur:!0,modal:!1,is_center:!1,width:350,ui_position:{my:"right top",at:"right+10 bottom+7",of:a,collision:c.position_collison}},c))},selectionFloatingPanel:function(a,b,d,c){var f={isLoaded:!1,reload:function(){var a=this,d=a.el,f={searchText:a.searchText};d.loader();c.beforeReload&&c.beforeReload(f);
bm.ajax({url:b,data:f,dataType:"html",response:function(){d.loader(!1)},success:function(b){d.find(".body").replaceWith($(b).find(".body"));a.attachEvents()}})},attachEvents:function(){var a=this,b=a.el;b.find(".body").scrollbar({vertical:{offset:15}});b.updateUi();b.find(".select-item").on("click",function(){var b=$(this);if(!b.is(".selected"))c.onSelect(b.config("entity"));a.popup.close()})}},g=c.events||{},m=g?g.content_loaded:void 0;g.content_loaded=function(a){var b=f.el=a.el,c=b.find(".search-form");
f.popup=a;b.find(".cancel-button").on("click",function(){a.close()});c.form({preSubmit:function(){var a=c.find(".search-text").val();if(f.searchText===a)return!1;f.searchText=a;f.reload();return!1}});f.attachEvents();m&&m.apply(this,arguments)};delete c.events;bm.floatingPanel(a,b,d,$.extend({width:400,height:null,events:g,position_collison:"none"},c));return f},metaTagEditor:function(a){function b(a){bm.makeTableCellEditable(a.find("td.editable"),function(a,b,c){c=a.parent("tr");if(!b)return d(a.find("input")),
bm.notify($.i18n.prop("value.must.not.be.empty"),"error"),!1;a.is(".name")?c.find("[name=tag_name]").val(b):c.find("[name=tag_content]").val(b)});a.find("td span.remove").on("click",function(){$(this).parents("tr").remove()})}function d(a){a.addClass("error-highlight");setTimeout(function(){a.removeClass("error-highlight")},1E3)}a=a.find(".meta-tag-editor").find("table");var c=a.find("tr.last-row");a.find("tr:gt(0):not(.last-row)").each(function(){b($(this))});a=function(){var a=c.find(".name").val(),
g=c.find(".value").val();if(a){if(g)return a=$('<tr><td class="name editable" maxlength="">#NAME#</td><td class="value editable" maxlength="">#VALUE#</td><td class="actions-column"><input type="hidden" name="tag_name" value="#NAME#"><input type="hidden" name="tag_content" value="#VALUE#"><span class="tool-icon remove"></span></td></tr>'.replaceAll("#NAME#",a.htmlEncode()).replaceAll("#VALUE#",g.htmlEncode())),c&&(c.find(".name").attr("maxlength")&&a.find(".name").attr("maxlength",c.find(".name").attr("maxlength")),
c.find(".value").attr("maxlength")&&a.find(".value").attr("maxlength",c.find(".value").attr("maxlength"))),b(a),c.before(a),c.find("input").val(""),!1;d(c.find(".value"))}else d(c.find(".name"))};c.find("input").bind("keyup.key_return",a);c.find(".add-row").on("click",a);c.find("input").on("keydown, keyup, keypress",function(a){if(13==a.keyCode)return!1})},initCityValidator:function(a,b,d,c,f){b=b?b:"country.id";d=d?d:"state.id";a.length&&a.each(function(){function a(a){var b={state:l.val(),postCode:m.val(),
cityFieldName:f};1!=a&&(b.country=n.val());if(a=q.find(":input").attr("validation"))b.validation=a;bm.ajax({url:app.baseUrl+"app/loadCitiesByCountryOrState",data:b,dataType:"html",success:function(a){a=$(a);app.is_front_end?q.find(":input").remove():q.children().not("label").remove();q.append(a);app.is_front_end||"dropdown"!=a.attr("et-category")||a.chosen();var b=a.closest("form").obj(ValidationPanel);b&&b.attach(a.filter("[validation]"),b);if(a=a.find("option:selected").attr("state"))l.val(a),app.is_front_end||
l.trigger("chosen:updated")}})}var m=$(this);c=c?c:m.closest("form");var l=c.find('[name="'+d+'"]'),n=c.find('[name="'+b+'"]'),q=c.find(".city-selector-row");q.length&&(l.change(function(){a(!0)}),c.on("state-load",function(){l=c.find('[name="'+d+'"]');a();l.length&&l.change(a)}),m.ichange(a))})},initCountryChangeHandler:function(a,b){a.change(function(){var d=$(this).closest("form"),c=$(this).val();$.ajax({url:app.baseUrl+"app/loadStateForCountry",dataType:"html",data:{id:c,stateName:b},success:function(b){d.find(".form-row.state-selector-row").remove();
a.parents(".form-row").after(b);d.trigger("state-load")}})})},customTooltip:function(a,b,d,c,f,g){config={auto_close_on_success:!0,disable_on_submit:!0,disable_on_invalid:!0,disable_button_text:void 0,modify_ui:!0,on_load_loader:!1};d[b-1].length||(b+=1,c="7",f="-7");var m=config.events||{};$(d[b-1]).addClass("active");m.content_loaded=function(a){this.updateUi();if(2<b){c="7";f="-7";var l=$("<button type='button' class='submit-button-pre'></button>");l.text($.i18n.prop("prev"));this.find(".pop-bottom").append(l)}8==
b&&(this.find(".submit-button-next").remove(),l=$("<button type='button' class='submit-button-done'></button>"),l.text($.i18n.prop("done")),this.find(".pop-bottom").prepend(l),l=$("<div class='show-next-wrapper'><input type='checkbox' name='remember' class='single'><span class='show-next'> Show on next login</span></div>"),this.find(".pop-bottom").append(l));var m=!0;this.find(".single").on("change",function(){m=this.checked?!1:!0});this.find(".submit-button-done, .submit-button-skip").click(function(){bm.ajax({url:app.baseUrl+
"user/saveIsMatured",data:{check:m},success:function(a){g&&g.getStart&&g.getStart()}});a.close(1);$(d[b-1]).removeClass("active")});this.find(".submit-button-next").click(function(){b++;a.close(1);$(d[b-2]).removeClass("active");c="7";f="-7";f=3==b?"+15":"-7";b<d.length+1&&bm.customTooltip(app.baseUrl+"dashboard/loadOnScreenHelp",b,d,c,f,g)});this.find(".submit-button-pre").click(function(){a.close(1);if(1<b)switch($(d[b-1]).removeClass("active"),b--,b){case 1:c="100";f="-100";break;case 3:c="7";
f="+15";break;default:c="7",f="-7"}bm.customTooltip(app.baseUrl+"dashboard/loadOnScreenHelp",b,d,c,f,g)});this.find(".tool-tip-close").click(function(){$(d[b-1]).removeClass("active");a.close(1);g&&g.getStart&&g.getStart(1)});this.addClass("loaded")};delete config.events;return new POPUP($.extend({template:"<div></div>",show_title:!1,width:380,height:150,ajax_url:a,ajax_settings:{data:{count:b,wizard:d[0].length?!0:null}},ui_position:{my:"right top+10",at:"right"+f+" bottom+"+c,of:d[b-1]},draggable:!1},
config,{clazz:"tool-tip-popup",events:m}))},highlight:function(a,b,d){a.addClass("highlight-row"+(d?" blink":""));setTimeout(function(){a.removeClass("highlight-row"+(d?" blink":""))},b?b:3E3)},renderZoneView:function(a){function b(){var g=a.body.find(".right-panel");g.loader();bm.ajax({url:c,dataType:"html",response:function(){g.loader(!1)},success:function(m){f=$(m);g.find(".body").html(f);bm.table(f,{url:c,onload:function(){},menu_entries:[{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"},
{text:$.i18n.prop("remove"),ui_class:"remove",action:"remove"}],onActionClick:function(a,c,f){switch(a){case "edit":d(f.parents("tr"),c);break;case "remove":app.tabs.zone.deleteZone(c.id,c.name,void 0,b)}}});f.find(".add-zone-btn").on("click",function(){var a=$(f.find("tr")[0]);d(a)});a.body.find(".toolbar-btn.save").hide();g.scrollbar()}})}function d(c,d){var f=a.body.find(".right-panel");f.loader();bm.ajax({url:app.baseUrl+"zone/createZone",data:d,dataType:"html",response:function(){f.loader(!1)},
success:function(a){a=$("<td colspan='5'>"+a+"</td>");var d=a.find("form");bm.countryChangeSelection(d.find("select[name=zone\\.country\\.id]"),!0,{isMultiple:"true",stateName:"zone.state.id"});d.find(".cancel-button").on("click",function(){b()});c.empty().append(a);d.form({ajax:!0,preSubmit:function(a){$.extend(a,{success:function(a){b()}})}});d.updateUi()}})}var c=app.baseUrl+"zone/loadZoneView",f;b()},trigger:function(a,b,d,c){if(5==arguments.length)return bm.trigger.call(a,b,d,c,arguments[4]);
var f;$.isArray(c)||(c=[c]);$.isFunction(this["on"+d.capitalize()])&&(f=this["on"+d.capitalize()].apply(this,c));if(!1===f)return!1;this.options&&$.isFunction(this.options[d])&&(f=this.options[d].apply(this,c));return!1===f?!1:a.trigger(b+":"+d,c)},$wrap:function(a,b){var d=a.camelCase(!1);window.jquery_conflict_prefix&&(d=window.jquery_conflict_prefix+d);$.prototype[d]=function(c){if(!this.length)return this;var d;if("string"==typeof c||c instanceof String)if(d=this.data("wcui-"+a+"-obj")){if("option"==
c){if(2==arguments.length)return $.isFunction(d._getOption)?d._getOption(arguments[1]):d.options[arguments[1]];$.isFunction(d._setOption)?d._setOption(arguments[1],arguments[2]):d.options[arguments[1]]=arguments[2];return this}"extendObjElement"==c&&arguments[1].data("wcui-"+a+"-obj",d);"removeObjElement"==c&&arguments[1].removeData("wcui-"+a+"-obj");if(!$.isFunction(d[c])||c.startsWith("_"))throw Error("Undefined function "+c);d=d[c].apply(d,Array.prototype.splice.call(arguments,1));return void 0===
d?this:d}c=$.extend({},c,this.config(a));d=new b(this,c);this.data("wcui-"+a+"-obj",d);return this}},clearTextSelection:function(a){a||(a=document);var b=null,d=a.defaultView;d.getSelection?b=d.getSelection():a.selection&&(b=a.selection);b&&(b.empty&&b.empty(),b.removeAllRanges&&b.removeAllRanges())},disableTextSelection:function(a){a||(a=document);browser.ff?(bm.clearTextSelection(a),a.body.style.MozUserSelect="none"):a.onselectstart=function(){return!1}},enableTextSelection:function(a){a||(a=document);
browser.ff?a.body.style.MozUserSelect="":a.onselectstart=null},getTopScroller:function(a){return $(/webkit/i.test(navigator.userAgent)||"BackCompat"==a.compatMode?a.body:a.documentElement)},errorHighLight:function(a,b){a.addClass("error-highlight");setTimeout(function(){a.removeClass("error-highlight")},b?b:1E3)},attachModernUiPanel:function(){var a=this,b=a.body.find(".modern-list-left-panel");if(b.length){var d=$.extend({thumbPanel:$(),url:"",thumb_menu_entries:[],thumbMenuClick:function(a){},leftNavigationClick:function(a){}},
a.leftPanelConfig||{});b.find(".left-panel-btn button").click(function(){function c(){if(m.validate()){var c=m.elm.val();bm.ajax({show_response_status:!1,url:d.url,data:{name:c},success:function(c){a.reload(c.id,!0,function(a){b.find(".item-thumb[item-id="+a+"]").trigger("click")})},error:function(a,b,c){m.elm.focus();m.showError({msg_template:c.message,msg_params:[],rule:void 0})}})}else m.elm.focus()}var f=b.find(".item-thumb.new-item"),g=b.find(".body .selected").attr("item-id");if(f.length)f.find(".item-title").focus();
else{f=d.thumbPanel.clone();a.body.find(".left-panel .item-wrapper").prepend(f);var m=ValidationField.createDetachedField(f.find("input"),{error_position:"after"}),l=!1;f.find(".item-title").focus().on("keyup.key_return",function(){c()}).on("blur",function(){l||a.reload(g,!0);l=!1});f.find(".tool-icon.apply").mousedown(function(){l=!0}).click(function(){c()})}});bm.menu(d.thumb_menu_entries,a.body.find(".left-panel .float-menu-navigator"),null,{hide:function(a){a.parent().removeClass("float-menu-opened")},
click:function(b,f){f=f.closest(".item-thumb").config("item");d.thumbMenuClick.call(a,b,f)}},"click",["center bottom","right+22 top+7"]);a.body.find(".item-thumb").on("click",function(b){var c=$(this);$(b.target).is(".float-menu-navigator")||(a.body.find(".item-thumb.selected").removeClass("selected"),c.addClass("selected"),b=c.attr("item-id"),a.reload(b))});b.find(".one-line-scroll-content").scrollbar({show_vertical:!1,show_horizontal:!0,use_bar:!1,visible_on:"auto",horizontal:{handle:{left:b.find(".left-scroller"),
right:b.find(".right-scroller")},step:"auto"}});b.find(".navigation-button").on("click",function(){var b=$(this);d.leftNavigationClick.call(a,b.attr("item-type"))})}},instantSearch:function(a,b,d,c,f){function g(){var b=m.val();b?a.addClass("search-active"):a.removeClass("search-active");a.find(d).each(function(){var a=$(this);a.find(c).text().trim().match(new RegExp(b,"i"))?a.show():a.hide()})}var m=b.find(".search-text");m.ichange(800,function(){g()});b.form({preSubmit:function(){g();return!1}})},
floatingPopup:function(a,b){a.find(".popup-body").hide();var d=void 0;a.find(".floating-action-dropper").click(function(){var a=$.extend({},b),f=this.jqObject,g=f.data("popup");if(g)g.show();else{var m=f.next(".popup-body");a=$.extend({content:m,position_collison:"none",events:{content_loaded:function(a){m.show()}}},a);d=g=bm.floatingPanel(f,null,{},a);g.close=g.hide;f.data("popup",g)}});a.find(".close-popup").click(function(){d&&d.close()});return a},renderSitePopup:function(a,b,d,c,f){f=$.extend({},
{auto_close_on_success:!0,disable_on_submit:!0,disable_on_invalid:!0,disable_button_text:void 0,modify_ui:!0,width:500,form_selector:".site-popup-form",buttonLine:"button-line",scroll:!0},f);var g=f.events||{},m=g?g.content_loaded:void 0;g.content_loaded=function(a){var b=this.find(f.form_selector);if("string"==typeof f.buttonLine){var c=b.find("."+f.buttonLine);var e=c.clone();c.remove()}else e=f.buttonLine;c=e.find(".submit-button, button[type=submit]").addClass("site-popup-form-submit").on("click",
function(){b.submit()});this.append(e);var d=f.ajax&&f.ajax.success||f.success;b.form({ajax:null==this.find(".site-popup-form").attr("no-ajax"),disable_on_submit:f.disable_on_submit,disable_on_invalid:f.disable_on_invalid,disable_button_text:f.disable_button_text,submitButton:c,preSubmit:function(c){$.extend(c,{response:f.response,error:f.error},f.ajax,{success:function(){f.auto_close_on_success&&a.close();d&&d.apply(this,arguments)}});if(f.beforeSubmit)return f.beforeSubmit.call(a.getDom(),b,c?c.data=
c.data||{}:null,a)}});b.find("[default-focus]").focus();this.find(".cancel-button").click(function(){a.close(1)});a.on("content-change",function(a,c,e){c&&b.obj(ValidationPanel).attach(c.filter("[validation]").add(c.find("[validation]")));e&&b.obj(ValidationPanel).detach(e.filter("[validation]").add(e.find("[validation]")))});m&&m.apply(this,[a,b])};delete f.events;return new POPUP($.extend({title:b+(d?" - <span class='emphasized'>"+bm.htmlEncode(d)+"</span>":""),width:430,ajax_url:a,ajax_settings:{data:c}},
f,{clazz:"site-popup"+(f.clazz?" "+f.clazz:""),events:g}))}});
$.extend(app,{isPermitted:function(a,b){if(void 0===app.permissions)return!0;var d=app.admin_id;a=app.permissions[a]?app.permissions[a]:{};var c=1==a.general,f=b?b.id:void 0;f=f?f instanceof Array?f:[f]:[];if(f.length&&(null==a.general||c)){if(a.allowed_entity){var g=a.allowed_entity.intersect(f);Object.keys(a.allowed_entity).length&&g.length==f.length&&(c=!0)}a.denied_entity&&(f=a.denied_entity.intersect(f),Object.keys(a.denied_entity).length&&0!=f.length&&(c=!1))}c||a.owner&&d==b.owner_id&&(c=!0);
return c},checkPermission:function(a,b,d){void 0!==app.permissions&&a&&$.each(b,function(b,f){app.isPermitted(f.key,f.isEntity?d:{})?a.enable?a.enable(f["class"]):a.find("."+f["class"]).removeClass("disabled"):a.disable?a.disable(f["class"]):a.find("."+f["class"]).addClass("disabled")})},updatePermissions:function(){bm.ajax({url:app.baseUrl+"adminBase/updatePermissions",data:{},success:function(a){void 0!==app.permissions&&(app.permissions=a.permissions)}})}});
Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),abbreviatedDayNames:"Sun Mon Tue Wed Thu Fri Sat".split(" "),shortestDayNames:"Su Mo Tu We Th Fr Sa".split(" "),firstLetterDayNames:"SMTWTFS".split(""),monthNames:"January February March April May June July August September October November December".split(" "),abbreviatedMonthNames:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),
amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,
may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,
millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",
offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]};
(function(){var a=Date,b=a.prototype,d=a.CultureInfo,c=function(a,b){b||(b=2);return("000"+a).slice(-1*b)};b.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this};b.setTimeToNow=function(){var a=new Date;this.setHours(a.getHours());this.setMinutes(a.getMinutes());this.setSeconds(a.getSeconds());this.setMilliseconds(a.getMilliseconds());return this};a.today=function(){return(new Date).clearTime()};a.compare=function(a,b){if(isNaN(a)||isNaN(b))throw Error(a+
" - "+b);if(a instanceof Date&&b instanceof Date)return a<b?-1:a>b?1:0;throw new TypeError(a+" - "+b);};a.equals=function(a,b){return 0===a.compareTo(b)};a.getDayNumberFromName=function(a){var b=d.dayNames,c=d.abbreviatedDayNames,e=d.shortestDayNames;a=a.toLowerCase();for(var f=0;f<b.length;f++)if(b[f].toLowerCase()==a||c[f].toLowerCase()==a||e[f].toLowerCase()==a)return f;return-1};a.getMonthNumberFromName=function(a){var b=d.monthNames,c=d.abbreviatedMonthNames;a=a.toLowerCase();for(var e=0;e<b.length;e++)if(b[e].toLowerCase()==
a||c[e].toLowerCase()==a)return e;return-1};a.isLeapYear=function(a){return 0===a%4&&0!==a%100||0===a%400};a.getDaysInMonth=function(b,c){return[31,a.isLeapYear(b)?29:28,31,30,31,30,31,31,30,31,30,31][c]};a.getTimezoneAbbreviation=function(a){for(var b=d.timezones,c=0;c<b.length;c++)if(b[c].offset===a)return b[c].name;return null};a.getTimezoneOffset=function(a){for(var b=d.timezones,c=0;c<b.length;c++)if(b[c].name===a.toUpperCase())return b[c].offset;return null};b.clone=function(){return new Date(this.getTime())};
b.compareTo=function(a){return Date.compare(this,a)};b.equals=function(a){return Date.equals(this,a||new Date)};b.between=function(a,b){return this.getTime()>=a.getTime()&&this.getTime()<=b.getTime()};b.isAfter=function(a){return 1===this.compareTo(a||new Date)};b.isBefore=function(a){return-1===this.compareTo(a||new Date)};b.isToday=function(){return this.isSameDay(new Date)};b.isSameDay=function(a){return this.clone().clearTime().equals(a.clone().clearTime())};b.addMilliseconds=function(a){this.setMilliseconds(this.getMilliseconds()+
a);return this};b.addSeconds=function(a){return this.addMilliseconds(1E3*a)};b.addMinutes=function(a){return this.addMilliseconds(6E4*a)};b.addHours=function(a){return this.addMilliseconds(36E5*a)};b.addDays=function(a){this.setDate(this.getDate()+a);return this};b.addWeeks=function(a){return this.addDays(7*a)};b.addMonths=function(b){var c=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+b);this.setDate(Math.min(c,a.getDaysInMonth(this.getFullYear(),this.getMonth())));return this};b.addYears=
function(a){return this.addMonths(12*a)};b.add=function(a){if("number"==typeof a)return this._orient=a,this;a.milliseconds&&this.addMilliseconds(a.milliseconds);a.seconds&&this.addSeconds(a.seconds);a.minutes&&this.addMinutes(a.minutes);a.hours&&this.addHours(a.hours);a.weeks&&this.addWeeks(a.weeks);a.months&&this.addMonths(a.months);a.years&&this.addYears(a.years);a.days&&this.addDays(a.days);return this};var f,g,m;b.getWeek=function(){f=f?f:this.getFullYear();g=g?g:this.getMonth()+1;m=m?m:this.getDate();
if(2>=g){var a=f-1;var b=(a/4|0)-(a/100|0)+(a/400|0);var c=b-(((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0));var e=0;var d=m-1+31*(g-1)}else a=f,b=(a/4|0)-(a/100|0)+(a/400|0),c=b-(((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0)),e=c+1,d=m+(153*(g-3)+2)/5+58+c;a=(a+b)%7;e=d+3-(d+a-e)%7|0;f=g=m=null;return 0>e?53-((a-c)/5|0):e>364+c?1:(e/7|0)+1};b.getISOWeek=function(){f=this.getUTCFullYear();g=this.getUTCMonth()+1;m=this.getUTCDate();return c(this.getWeek())};b.setWeek=function(a){return this.moveToDayOfWeek(1).addWeeks(a-
this.getWeek())};a._validate=function(a,b,c,e){if("undefined"==typeof a)return!1;if("number"!=typeof a)throw new TypeError(a+" is not a Number.");if(a<b||a>c)throw new RangeError(a+" is not a valid value for "+e+".");return!0};a.validateMillisecond=function(b){return a._validate(b,0,999,"millisecond")};a.validateSecond=function(b){return a._validate(b,0,59,"second")};a.validateMinute=function(b){return a._validate(b,0,59,"minute")};a.validateHour=function(b){return a._validate(b,0,23,"hour")};a.validateDay=
function(b,c,d){return a._validate(b,1,a.getDaysInMonth(c,d),"day")};a.validateMonth=function(b){return a._validate(b,0,11,"month")};a.validateYear=function(b){return a._validate(b,0,9999,"year")};b.set=function(b){a.validateMillisecond(b.millisecond)&&this.addMilliseconds(b.millisecond-this.getMilliseconds());a.validateSecond(b.second)&&this.addSeconds(b.second-this.getSeconds());a.validateMinute(b.minute)&&this.addMinutes(b.minute-this.getMinutes());a.validateHour(b.hour)&&this.addHours(b.hour-
this.getHours());a.validateMonth(b.month)&&this.addMonths(b.month-this.getMonth());a.validateYear(b.year)&&this.addYears(b.year-this.getFullYear());a.validateDay(b.day,this.getFullYear(),this.getMonth())&&this.addDays(b.day-this.getDate());b.timezone&&this.setTimezone(b.timezone);b.timezoneOffset&&this.setTimezoneOffset(b.timezoneOffset);b.week&&a._validate(b.week,0,53,"week")&&this.setWeek(b.week);return this};b.moveToFirstDayOfMonth=function(){return this.set({day:1})};b.moveToLastDayOfMonth=function(){return this.set({day:a.getDaysInMonth(this.getFullYear(),
this.getMonth())})};b.moveToNthOccurrence=function(a,b){var c=0;if(0<b)c=b-1;else if(-1===b)return this.moveToLastDayOfMonth(),this.getDay()!==a&&this.moveToDayOfWeek(a,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(a,1).addWeeks(c)};b.moveToDayOfWeek=function(a,b){a=(a-this.getDay()+7*(b||1))%7;return this.addDays(0===a?a+7*(b||1):a)};b.moveToMonth=function(a,b){a=(a-this.getMonth()+12*(b||1))%12;return this.addMonths(0===a?a+12*(b||1):a)};b.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-
new Date(this.getFullYear(),0,1))/864E5)+1};b.getTimezone=function(){return a.getTimezoneAbbreviation(this.getUTCOffset())};b.setTimezoneOffset=function(a){var b=this.getTimezoneOffset();return this.addMinutes(-6*Number(a)/10-b)};b.setTimezone=function(b){return this.setTimezoneOffset(a.getTimezoneOffset(b))};b.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()};b.isDaylightSavingTime=function(){return this.hasDaylightSavingTime()&&
(new Date).getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset()};b.getUTCOffset=function(){var a=-10*this.getTimezoneOffset()/6;if(0>a)return a=(a-1E4).toString(),a.charAt(0)+a.substr(2);a=(a+1E4).toString();return"+"+a.substr(1)};b.getElapsed=function(a){return(a||new Date)-this};b.toISOString||(b.toISOString=function(){function a(a){return 10>a?"0"+a:a}return'"'+this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+
":"+a(this.getUTCSeconds())+'Z"'});b._toString=b.toString;b.toString=function(a){var b=this;if(a&&1==a.length){var f=d.formatPatterns;b.t=b.toString;switch(a){case "d":return b.t(f.shortDate);case "D":return b.t(f.longDate);case "F":return b.t(f.fullDateTime);case "m":return b.t(f.monthDay);case "r":return b.t(f.rfc1123);case "s":return b.t(f.sortableDateTime);case "t":return b.t(f.shortTime);case "T":return b.t(f.longTime);case "u":return b.t(f.universalSortableDateTime);case "y":return b.t(f.yearMonth)}}var e=
function(a){switch(1*a){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};return a?a.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(a){if("\\"===a.charAt(0))return a.replace("\\","");b.h=b.getHours;switch(a){case "hh":return c(13>b.h()?0===b.h()?12:b.h():b.h()-12);case "h":return 13>b.h()?0===b.h()?12:b.h():b.h()-12;case "HH":return c(b.h());case "H":return b.h();case "mm":return c(b.getMinutes());case "m":return b.getMinutes();
case "ss":return c(b.getSeconds());case "s":return b.getSeconds();case "yyyy":return c(b.getFullYear(),4);case "yy":return c(b.getFullYear());case "dddd":return d.dayNames[b.getDay()];case "ddd":return d.abbreviatedDayNames[b.getDay()];case "dd":return c(b.getDate());case "d":return b.getDate();case "MMMM":return d.monthNames[b.getMonth()];case "MMM":return d.abbreviatedMonthNames[b.getMonth()];case "MM":return c(b.getMonth()+1);case "M":return b.getMonth()+1;case "t":return 12>b.h()?d.amDesignator.substring(0,
1):d.pmDesignator.substring(0,1);case "tt":return 12>b.h()?d.amDesignator:d.pmDesignator;case "S":return e(b.getDate());default:return a}}):this._toString()}})();
(function(){var a=Date,b=a.prototype,d=a.CultureInfo,c=Number.prototype;b._orient=1;b._nth=null;b._is=!1;b._same=!1;b._isSecond=!1;c._dateElement="day";b.next=function(){this._orient=1;return this};a.next=function(){return a.today().next()};b.last=b.prev=b.previous=function(){this._orient=-1;return this};a.last=a.prev=a.previous=function(){return a.today().last()};b.is=function(){this._is=!0;return this};b.same=function(){this._same=!0;this._isSecond=!1;return this};b.today=function(){return this.same().day()};
b.weekday=function(){return this._is?(this._is=!1,!this.is().sat()&&!this.is().sun()):!1};b.at=function(b){return"string"===typeof b?a.parse(this.toString("d")+" "+b):this.set(b)};c.fromNow=c.after=function(a){var b={};b[this._dateElement]=this;return(a?a.clone():new Date).add(b)};c.ago=c.before=function(a){var b={};b[this._dateElement]=-1*this;return(a?a.clone():new Date).add(b)};var f="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),g="january february march april may june july august september october november december".split(/\s/),
m="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),l="Milliseconds Seconds Minutes Hours Date Week Month FullYear".split(/\s/),n="final first second third fourth fifth".split(/\s/);b.toObject=function(){for(var a={},b=0;b<m.length;b++)a[m[b].toLowerCase()]=this["get"+l[b]]();return a};a.fromObject=function(a){a.week=null;return Date.today().set(a)};for(var q=function(b){return function(){if(this._is)return this._is=!1,this.getDay()==b;if(null!==this._nth){this._isSecond&&this.addSeconds(-1*
this._orient);this._isSecond=!1;var c=this._nth;this._nth=null;var e=this.clone().moveToLastDayOfMonth();this.moveToNthOccurrence(b,c);if(this>e)throw new RangeError(a.getDayName(b)+" does not occur "+c+" times in the month of "+a.getMonthName(e.getMonth())+" "+e.getFullYear()+".");return this}return this.moveToDayOfWeek(b,this._orient)}},e=function(b){return function(){var c=a.today(),e=b-c.getDay();0===b&&1===d.firstDayOfWeek&&0!==c.getDay()&&(e+=7);return c.addDays(e)}},p=0;p<f.length;p++)a[f[p].toUpperCase()]=
a[f[p].toUpperCase().substring(0,3)]=p,a[f[p]]=a[f[p].substring(0,3)]=e(p),b[f[p]]=b[f[p].substring(0,3)]=q(p);f=function(a){return function(){return this._is?(this._is=!1,this.getMonth()===a):this.moveToMonth(a,this._orient)}};q=function(b){return function(){return a.today().set({month:b,day:1})}};for(e=0;e<g.length;e++)a[g[e].toUpperCase()]=a[g[e].toUpperCase().substring(0,3)]=e,a[g[e]]=a[g[e].substring(0,3)]=q(e),b[g[e]]=b[g[e].substring(0,3)]=f(e);f=function(a){return function(b){if(this._isSecond)return this._isSecond=
!1,this;if(this._same){this._same=this._is=!1;var c=this.toObject();b=(b||new Date).toObject();for(var e,d=a.toLowerCase(),f=m.length-1;-1<f;f--){e=m[f].toLowerCase();if(c[e]!=b[e])return!1;if(d==e)break}return!0}"s"!=a.substring(a.length-1)&&(a+="s");return this["add"+a](this._orient)}};q=function(a){return function(){this._dateElement=a;return this}};for(e=0;e<m.length;e++)g=m[e].toLowerCase(),b[g]=b[g+"s"]=f(m[e]),c[g]=c[g+"s"]=q(g);b._ss=f("Second");c=function(a){return function(b){if(this._same)return this._ss(b);
if(b||0===b)return this.moveToNthOccurrence(b,a);this._nth=a;return 2!==a||void 0!==b&&null!==b?this:(this._isSecond=!0,this.addSeconds(this._orient))}};for(g=0;g<n.length;g++)b[n[g]]=0===g?c(-1):c(g)})();
(function(){Date.Parsing={Exception:function(a){this.message="Parse error at '"+a.substring(0,10)+" ...'"}};for(var a=Date.Parsing,b=a.Operators={rtoken:function(b){return function(c){var d=c.match(b);if(d)return[d[0],c.substring(d[0].length)];throw new a.Exception(c);}},token:function(a){return function(a){return b.rtoken(new RegExp("^s*"+a+"s*"))(a)}},stoken:function(a){return b.rtoken(new RegExp("^"+a))},until:function(a){return function(b){for(var c=[],d=null;b.length;){try{d=a.call(this,b)}catch(q){c.push(d[0]);
b=d[1];continue}break}return[c,b]}},many:function(a){return function(b){for(var c=[],d=null;b.length;){try{d=a.call(this,b)}catch(q){break}c.push(d[0]);b=d[1]}return[c,b]}},optional:function(a){return function(b){var c=null;try{c=a.call(this,b)}catch(n){return[null,b]}return[c[0],c[1]]}},not:function(b){return function(c){try{b.call(this,c)}catch(l){return[null,c]}throw new a.Exception(c);}},ignore:function(a){return a?function(b){return[null,a.call(this,b)[1]]}:null},product:function(){for(var a=
arguments[0],c=Array.prototype.slice.call(arguments,1),d=[],f=0;f<a.length;f++)d.push(b.each(a[f],c));return d},cache:function(b){var c={},d=null;return function(f){try{d=c[f]=c[f]||b.call(this,f)}catch(q){d=c[f]=q}if(d instanceof a.Exception)throw d;return d}},any:function(){var b=arguments;return function(c){for(var d=null,f=0;f<b.length;f++)if(null!=b[f]){try{d=b[f].call(this,c)}catch(q){d=null}if(d)return d}throw new a.Exception(c);}},each:function(){var b=arguments;return function(c){for(var d=
[],f=null,g=0;g<b.length;g++)if(null!=b[g]){try{f=b[g].call(this,c)}catch(e){throw new a.Exception(c);}d.push(f[0]);c=f[1]}return[d,c]}},all:function(){var a=a;return a.each(a.optional(arguments))},sequence:function(c,d,f){d=d||b.rtoken(/^\s*/);f=f||null;return 1==c.length?c[0]:function(b){for(var g=null,e=null,l=[],m=0;m<c.length;m++){try{g=c[m].call(this,b)}catch(w){break}l.push(g[0]);try{e=d.call(this,g[1])}catch(w){e=null;break}b=e[1]}if(!g)throw new a.Exception(b);if(e)throw new a.Exception(e[1]);
if(f)try{g=f.call(this,g[1])}catch(w){throw new a.Exception(g[1]);}return[l,g?g[1]:b]}},between:function(a,c,d){d=d||a;var f=b.each(b.ignore(a),c,b.ignore(d));return function(a){a=f.call(this,a);return[[a[0][0],r[0][2]],a[1]]}},list:function(a,c,d){c=c||b.rtoken(/^\s*/);d=d||null;return a instanceof Array?b.each(b.product(a.slice(0,-1),b.ignore(c)),a.slice(-1),b.ignore(d)):b.each(b.many(b.each(a,b.ignore(c))),px,b.ignore(d))},set:function(c,d,f){d=d||b.rtoken(/^\s*/);f=f||null;return function(g){for(var l,
e=null,m,n=[[],g],w,y=0;y<c.length;y++){l=e=null;w=1==c.length;try{l=c[y].call(this,g)}catch(A){continue}m=[[l[0]],l[1]];if(0<l[1].length&&!w)try{e=d.call(this,l[1])}catch(A){w=!0}else w=!0;w||0!==e[1].length||(w=!0);if(!w){l=[];for(w=0;w<c.length;w++)y!=w&&l.push(c[w]);l=b.set(l,d).call(this,e[1]);0<l[0].length&&(m[0]=m[0].concat(l[0]),m[1]=l[1])}m[1].length<n[1].length&&(n=m);if(0===n[1].length)break}if(0===n[0].length)return n;if(f){try{e=f.call(this,n[1])}catch(A){throw new a.Exception(n[1]);
}n[1]=e[1]}return n}},forward:function(a,b){return function(c){return a[b].call(this,c)}},replace:function(a,b){return function(c){c=a.call(this,c);return[b,c[1]]}},process:function(a,b){return function(c){c=a.call(this,c);return[b.call(this,c[0]),c[1]]}},min:function(b,c){return function(d){var f=c.call(this,d);if(f[0].length<b)throw new a.Exception(d);return f}}},d=function(a){return function(){var b=null,c=[];1<arguments.length?b=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&
(b=arguments[0]);if(b)for(var d=b.shift();0<d.length;)return b.unshift(d[0]),c.push(a.apply(null,b)),b.shift(),c;else return a.apply(null,arguments)}},c="optional not ignore cache".split(/\s/),f=0;f<c.length;f++)b[c[f]]=d(b[c[f]]);d=function(a){return function(){return arguments[0]instanceof Array?a.apply(null,arguments[0]):a.apply(null,arguments)}};c="each any all".split(/\s/);for(f=0;f<c.length;f++)b[c[f]]=d(b[c[f]])})();
(function(){var a=Date,b=a.CultureInfo,d=function(a){for(var b=[],c=0;c<a.length;c++)a[c]instanceof Array?b=b.concat(d(a[c])):a[c]&&b.push(a[c]);return b};a.Grammar={};a.Translator={hour:function(a){return function(){this.hour=Number(a)}},minute:function(a){return function(){this.minute=Number(a)}},second:function(a){return function(){this.second=Number(a)}},meridian:function(a){return function(){this.meridian=a.slice(0,1).toLowerCase()}},timezone:function(a){return function(){var b=a.replace(/[^\d\+\-]/g,
"");b.length?this.timezoneOffset=Number(b):this.timezone=a.toLowerCase()}},day:function(a){var b=a[0];return function(){this.day=Number(b.match(/\d+/)[0])}},month:function(a){return function(){this.month=3==a.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(a)/4:Number(a)-1}},year:function(a){return function(){var c=Number(a);this.year=2<a.length?c:c+(c+2E3<b.twoDigitYearMax?2E3:1900)}},rday:function(a){return function(){switch(a){case "yesterday":this.days=-1;break;case "tomorrow":this.days=
1;break;case "today":this.days=0;break;case "now":this.days=0,this.now=!0}}},finishExact:function(b){b=b instanceof Array?b:[b];for(var c=0;c<b.length;c++)b[c]&&b[c].call(this);b=new Date;!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=b.getDate());this.year||(this.year=b.getFullYear());this.month||0===this.month||(this.month=b.getMonth());this.day||(this.day=1);this.hour||(this.hour=0);this.minute||(this.minute=0);this.second||(this.second=0);this.meridian&&this.hour&&("p"==
this.meridian&&12>this.hour?this.hour+=12:"a"==this.meridian&&12==this.hour&&(this.hour=0));if(this.day>a.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");b=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);this.timezone?b.set({timezone:this.timezone}):this.timezoneOffset&&b.set({timezoneOffset:this.timezoneOffset});return b},finish:function(b){b=b instanceof Array?d(b):[b];if(0===b.length)return null;for(var c=0;c<b.length;c++)"function"==
typeof b[c]&&b[c].call(this);b=a.today();if(!this.now||this.unit||this.operator)this.now&&(b=new Date);else return new Date;c=!!(this.days&&null!==this.days||this.orient||this.operator);var e="past"==this.orient||"subtract"==this.operator?-1:1;this.now||-1=="hour minute second".indexOf(this.unit)||b.setTimeToNow();!this.month&&0!==this.month||-1=="year day hour minute second".indexOf(this.unit)||(this.value=this.month+1,this.month=null,c=!0);if(!c&&this.weekday&&!this.day&&!this.days){var f=Date[this.weekday]();
this.day=f.getDate();this.month||(this.month=f.getMonth());this.year=f.getFullYear()}if(c&&this.weekday&&"month"!=this.unit){this.unit="day";f=a.getDayNumberFromName(this.weekday)-b.getDay();var g=7;this.days=f?(f+e*g)%g:e*g}this.month&&"day"==this.unit&&this.operator&&(this.value=this.month+1,this.month=null);null!=this.value&&null!=this.month&&null!=this.year&&(this.day=1*this.value);this.month&&!this.day&&this.value&&(b.set({day:1*this.value}),c||(this.day=1*this.value));this.month||!this.value||
"month"!=this.unit||this.now||(this.month=this.value,c=!0);c&&(this.month||0===this.month)&&"year"!=this.unit&&(this.unit="month",f=this.month-b.getMonth(),g=12,this.months=f?(f+e*g)%g:e*g,this.month=null);this.unit||(this.unit="day");if(!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"])this[this.unit+"s"]=this[this.unit+"s"]+("add"==this.operator?1:-1)+(this.value||0)*e;else if(null==this[this.unit+"s"]||null!=this.operator)this.value||(this.value=
1),this[this.unit+"s"]=this.value*e;this.meridian&&this.hour&&("p"==this.meridian&&12>this.hour?this.hour+=12:"a"==this.meridian&&12==this.hour&&(this.hour=0));!this.weekday||this.day||this.days||(f=Date[this.weekday](),this.day=f.getDate(),f.getMonth()!==b.getMonth()&&(this.month=f.getMonth()));!this.month&&0!==this.month||this.day||(this.day=1);if(!this.orient&&!this.operator&&"week"==this.unit&&this.value&&!this.day&&!this.month)return Date.today().setWeek(this.value);c&&this.timezone&&this.day&&
this.days&&(this.day=this.days);return c?b.add(this):b.set(this)}};var c=a.Parsing.Operators,f=a.Grammar,g=a.Translator;f.datePartDelimiter=c.rtoken(/^([\s\-\.\,\/\x27]+)/);f.timePartDelimiter=c.stoken(":");f.whiteSpace=c.rtoken(/^\s*/);f.generalDelimiter=c.rtoken(/^(([\s\,]|at|@|on)+)/);var m={};f.ctoken=function(a){var e=m[a];if(!e){e=b.regexPatterns;for(var d=a.split(/\s+/),f=[],g=0;g<d.length;g++)f.push(c.replace(c.rtoken(e[d[g]]),d[g]));e=m[a]=c.any.apply(null,f)}return e};f.ctoken2=function(a){return c.rtoken(b.regexPatterns[a])};
f.h=c.cache(c.process(c.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),g.hour));f.hh=c.cache(c.process(c.rtoken(/^(0[0-9]|1[0-2])/),g.hour));f.H=c.cache(c.process(c.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),g.hour));f.HH=c.cache(c.process(c.rtoken(/^([0-1][0-9]|2[0-3])/),g.hour));f.m=c.cache(c.process(c.rtoken(/^([0-5][0-9]|[0-9])/),g.minute));f.mm=c.cache(c.process(c.rtoken(/^[0-5][0-9]/),g.minute));f.s=c.cache(c.process(c.rtoken(/^([0-5][0-9]|[0-9])/),g.second));f.ss=c.cache(c.process(c.rtoken(/^[0-5][0-9]/),g.second));
f.hms=c.cache(c.sequence([f.H,f.m,f.s],f.timePartDelimiter));f.t=c.cache(c.process(f.ctoken2("shortMeridian"),g.meridian));f.tt=c.cache(c.process(f.ctoken2("longMeridian"),g.meridian));f.z=c.cache(c.process(c.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),g.timezone));f.zz=c.cache(c.process(c.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),g.timezone));f.zzz=c.cache(c.process(f.ctoken2("timezone"),g.timezone));f.timeSuffix=c.each(c.ignore(f.whiteSpace),c.set([f.tt,f.zzz]));f.time=c.each(c.optional(c.ignore(c.stoken("T"))),
f.hms,f.timeSuffix);f.d=c.cache(c.process(c.each(c.rtoken(/^([0-2]\d|3[0-1]|\d)/),c.optional(f.ctoken2("ordinalSuffix"))),g.day));f.dd=c.cache(c.process(c.each(c.rtoken(/^([0-2]\d|3[0-1])/),c.optional(f.ctoken2("ordinalSuffix"))),g.day));f.ddd=f.dddd=c.cache(c.process(f.ctoken("sun mon tue wed thu fri sat"),function(a){return function(){this.weekday=a}}));f.M=c.cache(c.process(c.rtoken(/^(1[0-2]|0\d|\d)/),g.month));f.MM=c.cache(c.process(c.rtoken(/^(1[0-2]|0\d)/),g.month));f.MMM=f.MMMM=c.cache(c.process(f.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),
g.month));f.y=c.cache(c.process(c.rtoken(/^(\d\d?)/),g.year));f.yy=c.cache(c.process(c.rtoken(/^(\d\d)/),g.year));f.yyy=c.cache(c.process(c.rtoken(/^(\d\d?\d?\d?)/),g.year));f.yyyy=c.cache(c.process(c.rtoken(/^(\d\d\d\d)/),g.year));var l=function(){return c.each(c.any.apply(null,arguments),c.not(f.ctoken2("timeContext")))};f.day=l(f.d,f.dd);f.month=l(f.M,f.MMM);f.year=l(f.yyyy,f.yy);f.orientation=c.process(f.ctoken("past future"),function(a){return function(){this.orient=a}});f.operator=c.process(f.ctoken("add subtract"),
function(a){return function(){this.operator=a}});f.rday=c.process(f.ctoken("yesterday tomorrow today now"),g.rday);f.unit=c.process(f.ctoken("second minute hour day week month year"),function(a){return function(){this.unit=a}});f.value=c.process(c.rtoken(/^\d\d?(st|nd|rd|th)?/),function(a){return function(){this.value=a.replace(/\D/g,"")}});f.expression=c.set([f.rday,f.operator,f.value,f.unit,f.orientation,f.ddd,f.MMM]);l=function(){return c.set(arguments,f.datePartDelimiter)};f.mdy=l(f.ddd,f.month,
f.day,f.year);f.ymd=l(f.ddd,f.year,f.month,f.day);f.dmy=l(f.ddd,f.day,f.month,f.year);f.date=function(a){return(f[b.dateElementOrder]||f.mdy).call(this,a)};f.format=c.process(c.many(c.any(c.process(c.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(b){if(f[b])return f[b];throw a.Parsing.Exception(b);}),c.process(c.rtoken(/^[^dMyhHmstz]+/),function(a){return c.ignore(c.stoken(a))}))),function(a){return c.process(c.each.apply(null,a),g.finishExact)});var n={},q=function(a){return n[a]=
n[a]||f.format(a)[0]};f.formats=function(a){if(a instanceof Array){for(var b=[],e=0;e<a.length;e++)b.push(q(a[e]));return c.any.apply(null,b)}return q(a)};f._formats=f.formats('"yyyy-MM-ddTHH:mm:ssZ";yyyy-MM-ddTHH:mm:ssZ;yyyy-MM-ddTHH:mm:ssz;yyyy-MM-ddTHH:mm:ss;yyyy-MM-ddTHH:mmZ;yyyy-MM-ddTHH:mmz;yyyy-MM-ddTHH:mm;ddd, MMM dd, yyyy H:mm:ss tt;ddd MMM d yyyy HH:mm:ss zzz;MMddyyyy;ddMMyyyy;Mddyyyy;ddMyyyy;Mdyyyy;dMyyyy;yyyy;Mdyy;dMyy;d'.split(";"));f._start=c.process(c.set([f.date,f.time,f.expression],
f.generalDelimiter,f.whiteSpace),g.finish);f.start=function(a){try{var b=f._formats.call({},a);if(0===b[1].length)return b}catch(t){}return f._start.call({},a)};a._parse=a.parse;a.parse=function(b){var c=null;if(!b)return null;if(b instanceof Date)return b;try{c=a.Grammar.start.call({},b.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(t){return null}return 0===c[1].length?c[0]:null};a.getParseFunction=function(b){var c=a.Grammar.formats(b);return function(a){var b=null;try{b=c.call({},a)}catch(y){return null}return 0===
b[1].length?b[0]:null}};a.parseExact=function(b,c){return a.getParseFunction(c)(b)}})();
var CHECKERS={validateByLength:function(a,b,d){var c=!0;if(a)a=a.trim();else return!0;switch(d){case "range":if(a<parseFloat(b[0],10)||a>parseFloat(b[1],10))c=!1;break;case "max":a>parseFloat(b[0],10)&&(c=!1);break;case "min":a<parseFloat(b[0],10)&&(c=!1);break;case "multipleOf":0!=a%parseInt(b[0],10)&&(c=!1);break;case "gt":a<=parseFloat(b[0],10)&&(c=!1);break;case "gte":a<parseFloat(b[0],10)&&(c=!1);break;case "lt":a>=parseFloat(b[0],10)&&(c=!1);break;case "lte":a>parseFloat(b[0],10)&&(c=!1);break;
case "rangelength":a=a.byteCount();if(a<parseFloat(b[0],10)||a>parseFloat(b[1],10))c=!1;break;case "maxlength":a.byteCount()>parseFloat(b[0],10)&&(c=!1);break;case "minlength":a.byteCount()<parseFloat(b[0],10)&&(c=!1);break;case "default":c=!1}return c},validateByCompare:function(a,b,d,c){var f=b,g=!0,m=function(a){var b=0;a=a.split("").reverse().join("");for(var c=a.length-1;0<=c;c--)b+=Math.pow(26,c)*(a.charCodeAt(c)-65+1);return b},l=function(a){for(var b="";0<a;){a--;var c=a%26;b=String.fromCharCode(c+
65)+b;a=(a-c)/26}return b};if("number"==d){if(16<a.length||16<b.length)return{msg_template:$.i18n.prop("num.of.digits.less.than.n",[16])};a=parseFloat(a,10);b=parseFloat(b,10)}else"date"===d?(a=Date.parse(a),b=Date.parse(b)):"alphabetic"==d&&(f=l(b),a=m(a));switch(c){case "gt":if(a<=b){g=!1;var n="value.must.greater"}break;case "gte":a<b&&(g=!1,n="value.must.greater.equal");break;case "eq":a!=b&&(g=!1,n="value.must.equal");break;case "ne":a==b&&(g=!1,n="value.must.not.equal");break;case "lte":a>b&&
(g=!1,n="value.must.less.equal");break;case "lt":a>=b&&(g=!1,n="value.must.less");break;case "mod":0!=a%b&&(g=!1,n="value.must.multiple.of");break;case "default":g=!1,n="unsupported.comparison.type"}return g||{msg_template:n,msg_params:[f]}}},VALIDATION_RULES={alphabetic:{check:function(a){return a?/^[a-zA-Z ]+$/.test(a):!0},msg_template:"enter.valid.alphabetic"},alphanumeric:{check:function(a){return a?/^[a-zA-Z0-9]+$/.test(a):!0},msg_template:"enter.valid.alphanumeric"},cardnumber:{check:function(a,
b){a=$.trim(a);var d={visa:/^4[0-9]{12}(?:[0-9]{3})?$/,master:/^5[1-5][0-9]{14}$/,diners:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,unionpay:/^(62|88)\d+$/,amex:/^3[47][0-9]{13}$/};b=b.filter("this != ''");if(0==b.length)return!0;for(var c=!1,f=0;f<b.length;f++)if(d[b[f].trim()].test(a)){c=!0;break}return c},msg_template:"incorrect.card.number"},commaSeparated4digit:{check:function(a){return a?/^[1-9]\d{0,3}(?:(?:,[1-9]\d{0,3})*)$/.test(a):!0},msg_template:"enter.comma.seperated.four.digit.numeric"},compare:{check:function(a,
b){if(!a)return!0;a=CHECKERS.validateByCompare(a,$("#"+b[0].trim()).val(),b[1].trim(),b[2].trim());return!0!==a?{msg_template:a.msg_template,msg_params:a.msg_params}:!0}},eq:{check:function(a,b){return(b=$("#"+b[0].trim()).val())&&!a?{msg_template:"field.required"}:a!=b?{msg_params:[b]}:!0},msg_template:"value.must.equal"},creditCardExpiryDate:{check:function(a,b){if(!a||!$("#"+b[0].trim()).val())return!0;var d=(new Date).getMonth()+1,c=(new Date).getFullYear().toString().substring(2,4);b=$("#"+b[0].trim()).val();
return b<c||a<d&&b<=c?{msg_template:"card.expired"}:!0}},creditcard:{check:function(a){if(/[^0-9-]+/.test(a))return!1;var b=0,d=!1;a=a.replace(/\D/g,"");for(var c=a.length-1;0<=c;c--){var f=a.charAt(c);f=parseInt(f,10);d&&9<(f*=2)&&(f-=9);b+=f;d=!d}return 0==b%10?!0:!1},msg_template:"enter.valid.creditcard"},cvv:{check:function(a){return a?2<a.length&&5>a.length&&/^\d+$/.test(a):!0},msg_template:"cvv.invalid"},date:{check:function(a,b){if(!a)return!0;var d="yyyy-MM-dd";b&&(d=b);this.msg_params=[d];
return!!Date.parseExact(a,d)},msg_template:"date.should.formatted"},digits:{check:function(a){return(a=$.trim(a))?16<a.length?(this.msg_template="",!1):/^\d+$/.test(a):!0},msg_template:"only.digits.allowed"},either_required:{check:function(a,b){var d=$("#"+b[0]).val();if(a||d)return!0;this.msg_params=[b[1],b[2]];return!1},msg_template:"either.required"},email:{check:function(a,b){return a?(new RegExp("^\\s*"+(b?'(((([^<>()[\\]\\\\.,;:\\s@"]+(\\.[^<>()[\\]\\\\.,;:\\s@"]+)*)|(".+"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,})))|([^<>,;]+\\s*<(([^<>()[\\]\\\\.,;:\\s@"]+(\\.[^<>()[\\]\\\\.,;:\\s@"]+)*)|(".+"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))>))':
'(((([^<>()[\\]\\\\.,;:\\s@"]+(\\.[^<>()[\\]\\\\.,;:\\s@"]+)*)|(".+"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,})))|([^<>,;]+\\s*<(([^<>()[\\]\\\\.,;:\\s@"]+(\\.[^<>()[\\]\\\\.,;:\\s@"]+)*)|(".+"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))>))([,;]\\s*(((([^<>()[\\]\\\\.,;:\\s@"]+(\\.[^<>()[\\]\\\\.,;:\\s@"]+)*)|(".+"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,})))|([^<>,;]+\\s*<(([^<>()[\\]\\\\.,;:\\s@"]+(\\.[^<>()[\\]\\\\.,;:\\s@"]+)*)|(".+"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))>)))*;?')+
"\\s*$")).test(a):!0},msg_template:"enter.valid.email"},single_email:{check:function(a){return a?VALIDATION_RULES.email.check(a,!0):!0},msg_template:"enter.valid.email"},empty:{check:function(a){return $.trim(a)?!1:!0},msg_template:"field.must.empty"},eval:{check:function(a,b){try{return eval(b[0])}catch(d){return!1}},msg_template:"entry.invalid"},"drop-file-required":{check:function(a,b,d){if(a)return!0;var c=d.attr("name");a=d.closest("form").data("form-extra-data");if(!a)return!1;if(window.File){if(a.value instanceof
File&&a.name==c)return!0;if($.isArray(a)){var f;a.every(function(){if(this.value instanceof window.File&&this.name==c)return f=this,!1});if(f)return!0}}return!1},msg_template:"no.file.selected"},"function":{check:function(a,b,d){try{return bm.prop(window,b[0]).call(d,a,VALIDATION_RULES["function"])}catch(c){return!1}},msg_template:"entry.invalid"},gt:{check:function(a,b){return!0!==CHECKERS.validateByLength(a,b,"gt")?{msg_params:b}:!0},msg_template:"value.must.greater"},gte:{check:function(a,b){return!0!==
CHECKERS.validateByLength(a,b,"gte")?{msg_params:b}:!0},msg_template:"value.must.greater.equal"},lt:{check:function(a,b){return!0!==CHECKERS.validateByLength(a,b,"lt")?{msg_params:b}:!0},msg_template:"value.must.less"},lte:{check:function(a,b){return!0!==CHECKERS.validateByLength(a,b,"lte")?{msg_params:b}:!0},msg_template:"value.must.less.equal"},hexColor:{check:function(a){if(a=$.trim(a))return/^#?[0-9a-fA-F]{6}$/.test(a)},msg_template:"invalid.hexadecimal.color"},hexDigit:{check:function(a){return(a=
$.trim(a))?/[0-9a-fA-F]$/.test(a):!0},msg_template:"invalid.hexadecimal.digit"},identifier:{check:function(a,b){return a?"multi"==b?/^[a-zA-Z_][a-zA-Z_0-9]*(\s+[a-zA-Z_][a-zA-Z_0-9]*)*$/.test(a):/^[a-zA-Z_][a-zA-Z_0-9]*$/.test(a):!0},msg_template:"only.alphanumeric.underscore.supported"},least_selection:{check:function(a,b,d){return!!d.find(":checked").length},msg_template:"least.option.must.select"},match:{check:function(a,b){return a&&!(new RegExp(b[0])).test(a)?{msg_template:"invalid.format.use.like",
msg_params:[b[1]]}:!0}},max:{check:function(a,b){return!0!==CHECKERS.validateByLength(a,b,"max")?{msg_params:b}:!0},msg_template:"value.must.less.equal"},maxlength:{check:function(a,b){return!0!==CHECKERS.validateByLength(a,b,"maxlength")?{msg_params:b}:!0},msg_template:"enter.no.more.characters"},maxprecision:{check:function(a,b){var d=1==b.length?void 0:b[0],c=1==b.length?b[0]:b[1];b=new RegExp("^(\\+|-)?\\d"+(d?"{0,"+d+"}":"*")+"(?:\\.\\d{0,"+c+"})?$");d?(this.msg_template="maximum.number.precision.allowed",
d=[d,c]):(this.msg_template="maximum.precision.allowed",d=[c]);return b.test(a)?!0:{msg_params:d}}},price:{check:function(a){return VALIDATION_RULES.maxprecision.check.apply(this,[a,[9,+app.maxPricePrecision]])}},min:{check:function(a,b){return!0!==CHECKERS.validateByLength(a,b,"min")?{msg_params:b}:!0},msg_template:"value.must.greater.equal"},minlength:{check:function(a,b){return!0!==CHECKERS.validateByLength(a,b,"minlength")?{msg_params:b}:!0},msg_template:"enter.least.characters"},multipleOf:{check:function(a,
b){return!0!==CHECKERS.validateByLength(a,b,"multipleOf")?{msg_params:b}:!0},msg_template:"value.must.multiple.of"},number:{check:function(a){return(a=$.trim(a))?/^(\+|-)?\d*(?:\.\d+)?$/.test(a):!0},msg_template:"enter.valid.number"},percent_number:{check:function(a){a=$.trim(a);return"%"==a?!1:a?/^(\+|-)?\d*(?:\.\d+)?%?$/.test(a):!0},msg_template:"enter.valid.number"},partial_url:{check:function(a){return(a=$.trim(a))?/^(((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)+)(:\d*)?))?(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a):
!0},msg_template:"enter.valid.url"},phone:{check:function(a){return(a=$.trim(a))?/^\+?[0-9\(\)\-\s]+$/.test(a):!0},msg_template:"phone.invalid"},range:{check:function(a,b){return!0!==CHECKERS.validateByLength(a,b,"range")?{msg_params:b}:!0},msg_template:"value.must.between"},rangelength:{check:function(a,b){return!0!==CHECKERS.validateByLength(a,b,"rangelength")?{msg_params:b}:!0},msg_template:"value.must.length.between"},required:{check:function(a){return $.trim(a)?!0:!1},msg_template:"field.required"},
restricted_chars:{check:function(a,b){var d=0;return a&&($.each(b,function(){d=a.indexOf(this);if(-1<d)return!1}),-1<d)?{msg_params:[b.join(",")]}:!0},msg_template:"characters.not.supported"},url:{check:function(a){return(a=$.trim(a))?/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)+)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a):
!0},msg_template:"enter.valid.url"},domain_name:{check:function(a){return a?null!=a.match(/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$/):!0},msg_template:"enter.valid.domain.name"},url_folder:{check:function(a){return a?/^(([a-z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+$/i.test(a):!0},msg_template:"enter.valid.url.path"},non_symbolic:{check:function(a){return a?/^( *[a-zA-Z0-9\-_]+)+$/.test(a):
!0},msg_template:"enter.valid.non.symbolic"},skip:{},skip_next:{},check:{},check_next:{},fail:{}},ValidationRule=function(){function a(a,d){for(var b=!0,f=d;b;){f=a.indexOf("]",f);if(-1==f)throw Error("No Param Terminator ']'");(b="]"==a.charAt(f+1))&&(f+=2)}return a.substring(d,f)}return{addRule:function(a,d){VALIDATION_RULES[a]=d},getRule:function(a){return VALIDATION_RULES[a]},createRules:function(b,d){d=d||0;var c=b.length;if(d>=c)return[];var f=b.indexOf(" ",d);-1==f&&(f=c);var g=b.indexOf("[",
d);-1==g&&(g=c);var m=b.indexOf("@",d);-1==m&&(m=c);var l=b.indexOf("}",d);-1==l&&(l=c);var n=b.indexOf("{",d);-1==n&&(n=c);f=b.substring(d,Math.min(g,m,f,l,n));if(""==f)return ValidationRule.createRules(b,d+1);var q=VALIDATION_RULES[f];if(null==q)throw Error("Invalid Rule Format/Name");var e=[];q={rule:q};e.push(q);var p=d+f.length;d=function(){for(;"@"==b.charAt(m);){a:{var a=b,c=m+1;var e={condition:{}};var d=a.charAt(c);if("i"==d)e.condition.type="if",c+=3;else if("v"==d){e.condition.type="if";
e.parsedIndex=c+6;e.condition.check_type="self";e.condition.selector=":visible";break a}else if("h"==d){e.condition.type="if";e.parsedIndex=c+5;e.condition.check_type="self";e.condition.selector=":hidden";break a}else e.condition.type="not",c+=4;if("g"==a.charAt(c)){c+=7;d=a.indexOf("}",c);if(-1==d)throw Error("Invalid Rule Format/Name");e.condition.check_type="global";e.condition.selector=a.substring(c,d)}else if("t"==a.charAt(c)){c+=5;d=a.indexOf("}",c);if(-1==d)throw Error("Invalid Rule Format/Name");
e.condition.check_type="this";e.condition.selector=a.substring(c,d)}else if("s"==a.charAt(c)){c+=5;d=a.indexOf("}",c);if(-1==d)throw Error("Invalid Rule Format/Name");e.condition.check_type="self";e.condition.selector=a.substring(c,d)}else{e.condition.check_type="rule";c+=5;d=a.indexOf("}",c+1);for(var f=a.indexOf("{",c+1);-1!=d&&-1!=f&&f<d;)d=a.indexOf("}",d+1),f=a.indexOf("{",f+1);if(-1==d)throw Error("Invalid Rule Format/Name");a=a.substring(c,d);e.condition.rules=ValidationRule.createRules(a)}e.parsedIndex=
d}q.condition?$.isArray(q.condition)?q.condition.push(e.condition):q.condition=[q.condition,e.condition]:q.condition=e.condition;m=e.parsedIndex+1}p=m};p==g&&g!=c?(n=a(b,g+1),p+=n.length+2,q.param=n.replace(/\]\]/g,"]").exSplit(),m==p&&g!=c&&d()):m==p&&n!=c&&d();p!=c&&" "==b.charAt(p)&&(c=ValidationRule.createRules(b,p+1),$.each(c,function(){e.push(this)}));return e}}}();
(function(){function a(b,c){for(var d=c.length,f=null,g=0;g<d;g++){var e=c[g];if("undefined"!=typeof e.error)return e.error;var m=!0;if(e.condition)for(var t=$.isArray(e.condition)?e.condition:[e.condition],w=t.length-1;-1<w;w--){var y=!0,A=t[w];switch(A.check_type){case "global":0==$(A.selector).length&&(y=!1);break;case "self":":blank"==A.selector?(y=b.val(),y=""==$.trim(y)):y=b.is(A.selector);break;case "this":y=0!=b.find(A.selector).length;break;case "rule":y=null==a(b,A.rules)}if("if"==A.type&&
!y||"not"==A.type&&y){m=!1;break}}t=e.rule;if(t==VALIDATION_RULES.skip)if(m)break;else continue;if(t==VALIDATION_RULES.skip_next)m&&g++;else{if(t==VALIDATION_RULES.check)if(m)continue;else break;if(t==VALIDATION_RULES.check_next)m||g++;else if(t==VALIDATION_RULES.fail){if(m)return(c=b.attr("message_params_"+g)||b.attr("message_params"))&&(c=c.split(" ")),{msg_template:b.attr("message_template_"+g)||b.attr("message_template")||"entry.invalid",msg_params:c||[],rule:t}}else if(m&&(e=e.param,e=t.check(b.val(),
e,b),!0!==e&&((f=b.attr("message_template_"+g)||b.attr("message_template"))||(f=e.msg_template||t.msg_template),f||(f=""),(m=(m=b.attr("message_params_"+g)||b.attr("message_params"))?m.exSplit(" "):e.msg_params||t.msg_params)||(m=[]),f={msg_template:f,msg_params:m,rule:t})),null!=f)break}}return f}var b={validate_on:{text:["blur"],password:["blur"],select:["change"],radio:["change"],file:["change"],checkbox:["change"],container:["change"]},validate_on_call_only:!1,clear_on_focus:!0,show_error:!0,
attribute_name:"validation",error_class:"validation-error",re_init_on_valid:!1,error_position:"after",error_parent_ref_class:void 0,show_error_close:!0,error_template:"<div class='errorlist'><span class='pointer'></span><span class='close-btn'></span><div class='message-block message-text'></div></div>",displayError:void 0},d=0,c=function(a,c){this.fields=[];this.elm=a;this.instance_count=d++;var f=a.config("validation");$.extend(!0,this,b,f,c);this.attribute_name=f.attr||this.attribute_name;this.attach(a.find("["+
this.attribute_name+"]"))};window.ValidationPanel=c;c.prototype={attach:function(a,b){var c=this;a.each(function(){var a=$(this);a.on("jqclean",function(){c.detach(a)});var d=new f(a,c,b);a.data("validator-filed-inst",d);c.fields.push(d)})},isValid:function(){$.each(this.fields,function(){this.validate()});var a=!0;$.each(this.fields,function(){if(!this.valid)return a=!1});return a},detach:function(a){a.length&&(a=a[0]);var b=-1;$.each(this.fields,function(c){if(this.elm[0]==a)return b=c,this.destroy(),
!1});-1<b&&this.fields.splice(b,1)},getValidatorRules:function(a){a.length&&(a=a[0]);var b;$.each(this.fields,function(){if(this.elm[0]==a)return b=this.validatorRules,!1});return b},addValidatorRule:function(a,b,c){a.length&&(a=a[0]);var d=!1;$.each(this.fields,function(){if(this.elm[0]==a){var f="string"==typeof b?ValidationRule.createRules(b):[{rule:{check:b,msg_template:c}}];var e=this;$.each(f,function(){e.validatorRules.push(this)});d=!0;return!1}});d||this.attach($(a),this)},destroy:function(){$.each(this.fields,
function(){this.destroy()});this.fields=[]},reInit:function(){this.destroy();this.attach(this.elm.find("["+this.attribute_name+"]"),this)},position:function(){this.fields.each(function(){this.valid||this.showError(this.error)})},state:function(){return this.fields.collect("valid").all()}};var f=function(a,b,c){this.elm=a;var f=a.config("validation");this.options=$.extend(!0,{},bm.omit(b,["fields","elm","instance_count"],!0),f,c);this.instance_count=d++;this.valid=!0;this.options.displayError&&(this.showError=
this.options.displayError);this.options.error_position=a.attr("error-position")||(b.elm?b.elm.attr("error-position"):void 0)||this.options.error_position;this.options.validate_on_call_only=a.attr("validate-on")?"call-only"==a.attr("validate-on"):"call-only"==this.options.validate_on||this.options.validate_on_call_only;if(this.options.attribute_name)if(a=a.attr(this.options.attribute_name),""==$.trim(a))this.validatorRules=[];else try{this.validatorRules=ValidationRule.createRules(a)}catch(q){this.validatorRules=
[{error:"invalid.rule.format.name"}];return}else this.validatorRules=[];this.options.detached||this.initEvents()};window.ValidationField={createDetachedField:function(a,c){c=$.extend({detached:!0},c);return new f(a,$.extend(!0,{},b,c))},validateAs:function(b,c){try{return a(b,ValidationRule.createRules(c))}catch(l){return{msg_template:$.i18n.prop("unable.validate"),msg_params:[],rule:void 0}}}};f.prototype={initEvents:function(){var a=this.elm,b=".validator_"+this.instance_count;a.off(b);var c=this;
a.on("validate"+b,function(){c.validate()});if(!this.options.validate_on_call_only){var d=function(a,b){var e=a.is("select")?"select":a.is("textarea")?"text":a.is("[type='file']")?"file":a.is("[type='text']")?"text":a.is("[type='password']")?"password":a.is("[type='radio']")?"radio":a.is("[type='checkbox']")?"checkbox":"container";var d=a.attr("validate-on");d=d?d.split(","):c.options.validate_on[e];$.isArray(d)||(d=[d]);$.each(d,function(){switch(""+this){case "immediate":a.on("ichange"+b,function(){c.validate()});
break;default:a.on(this+b,function(){c.validate()})}})};d(a,b);var f=this.elm.attr("depends");f&&(f=$(f),f.length&&(b=a.attr("id"),b||(b=bm.getUUID(),a.attr("id",b)),b=".validator_"+this.instance_count+"_"+b,a.off(b),d(f,b)))}this.options.clear_on_focus&&a.bind("focus"+b,function(){c.clear()})},validate:function(){function b(a){c.valid=!1;c.error=a;a.validator=c;!1!==c.elm.trigger("invalid",a)&&c.options.show_error&&c.showError(a)}var c=this,d=c.elm,f=c.validatorRules;if(!f)return!0;c.clear();try{var q=
a(d,f);null!=q?b(q):(c.valid=!0,c.elm.trigger("valid"))}catch(e){b({msg_template:e.message,msg_params:[],rule:void 0})}return c.valid},clear:function(){if(this.errorBlock){var a=this.elm.removeClass(this.options.error_class).attr("error-on");a?(a=$("#"+a),a.removeClass(this.options.error_class)):a=this.elm;if("inline"==this.options.error_position){var b=a;a.find(".inline-error-target").length&&(b=a.find(".inline-error-target"));if("password"==b.attr("type")){if(b=a[0].inlineErrorProxy)b.remove(),
delete a[0].inlineErrorProxy;a.css("visibility","visible")}else a=b.attr("value-cache"),b.val(a),b.removeAttr("value-cache")}this.errorBlock.siblings(".message-block").length?this.errorBlock.remove():(this.errorBlock.closest(".errorlist").remove(),this.elm.removeClass("error-field-error"));this.errorBlock=null;this.elm.trigger("clear-error")}},destroy:function(){this.clear();this.elm.off(".validator_"+this.instance_count)},showError:function(a){this.errorBlock&&this.clear();var b="function"==typeof this.options.error_template?
this.options.error_template.call(this,a):$(this.options.error_template);this.elm.addClass("error-field-error");var c=this.elm.addClass(this.options.error_class).attr("error-on");c?(c=$("#"+c),c.addClass(this.options.error_class)):c=this.elm;var d=b.find(".message-block"),f=d.is(".message-text")?d:d.find(".message-text");f.append($.i18n.prop(a.msg_template,a.msg_params));b.addClass(this.options.error_position);switch(this.options.error_position){case "inline":c.find(".inline-error-target").length&&
(c=c.find(".inline-error-target"));if("password"==c.attr("type")){var e=c.clone();e.attr("type","text");c.after(e);e.val(f.text()).addClass("inline-error");e.focus(function(){e.remove();c.css("visibility","visible")[0].focus();delete c[0].inlineErrorProxy}).css({position:"absolute"}).offset(c.offset());c.css("visibility","hidden");c[0].inlineErrorProxy=e}else a=c.val(),c.val(f.text()).addClass("inline-error"),c.attr("value-cache",a);break;case "after":f=c.next(".errorlist");f.length?f.find(".message-block:last").after(d):
c.after(b);break;case "before":f=c.prev(".errorlist");f.length?f.find(".message-block:last").after(d):c.before(b);break;case "parent-after":a=this.options.error_parent_ref_class?c.closest("."+this.options.error_parent_ref_class):c.parent();f=a.next(".errorlist");f.length?f.find(".message-block:last").after(d):a.after(b);break;case "parent-before":a=this.options.error_parent_ref_class?c.closest("."+this.options.error_parent_ref_class):c.parent();f=a.prev(".errorlist");f.length?f.find(".message-block:last").after(d):
a.before(b);break;case "none":break;default:switch(b.addClass("positioned-error"),a=this.options.error_position.substring(11),f=c.next(".errorlist"),f.length?f.find(".message-block:last").after(d):(c.after(b),f=b),a){case "up":f.position({my:"left bottom",at:"left+50 top-"+f.bottomRib(!0,!1,!1),of:c,collision:"none"});break;case "below":f.position({my:"left top",at:"left+50 bottom+"+f.topRib(!0,!1,!1),of:c,collision:"none"});break;case "right":f.position({my:"left top",at:"right+"+f.leftRib(!0,!1,
!1)+" top-"+.33*f.outerHeight(),of:c,collision:"none"});break;case "left":f.position({my:"right top",at:"left-"+f.leftRib(!0,!1,!1)+" top-"+.33*f.outerHeight(),of:c,collision:"none"})}}this.errorBlock=d;this.options.show_error_close?b.find(".close-btn").click(function(){b.hide()}):b.find(".close-btn").remove()},isValid:function(){this.validate();return this.valid}};$.extend($.fn,{attachValidator:function(a){return this.each(function(){var b=$(this),d=new c(b,a||{});b.data("validator-inst",d)})},valid:function(a){var b=
!0;this.each(function(){var c=$(this),d=c.data("validator-inst")||c.data("validator-filed-inst");if(d){if("string"==typeof a)return d[a]();d.re_init_on_valid&&d.reInit()}else c.attachValidator(a||{}),d=c.data("validator-inst");c=d.isValid();b=b&&c});return b},clearValidator:function(){this.each(function(){var a=$(this),b=a.data("validator-inst");b&&(b.destroy(),a.removeData("validator"))})},updateValidator:function(a){this.clearValidator();return this.attachValidator(a||{})},clearValidationMessage:function(a){this.find(".errorlist").remove();
this.find(".validation-error").removeClass("validation-error").removeClass("error-field-error")}});window.validation={setDefaults:function(a){$.extend(b,a,{validate_on:$.extend({},b.validate_on,a.validate_on)})}}})();
(function(){function a(a){var b=this,c=this.data("form-inst");c.submitButton||(c.submitButton=this.find("[type='submit'], .submit-button"),1<c.submitButton.length&&this.attr("class").split(" ").every(function(){var a=c.submitButton.filter("."+this+"-submit");if(a.length)return c.submitButton=a,!1}));c.disable_on_invalid=this.attr("disable-on-invalid")?"true"==this.attr("disable-on-invalid"):(a.hasOwnProperty("disable_on_invalid"),c.disable_on_invalid);$.each(f,function(){this.call(b,a)})}var b={preSubmit:void 0,
disable_on_submit:!0,disable_on_invalid:!0,text_change_on_submit:!0},d="very.weak weak better medium strong strongest".split(" "),c="very-weak weak better medium strong strongest".split(" "),f=$.form_care_functions={checkbox:function(){this.find("input:checkbox[name][uncheck-value]").pairuncheck()},auto_toggle:function(){bm.autoToggle&&bm.autoToggle(this)},textarea:function(){$.form_no_textarea_autosize||this.find("textarea:not('.no-auto-size')").autosize()},events:function(a){var b=this,c=a.elm;
b.is(c)&&this.bind("submit",function(){return browser.ie&&8==browser.version&&b.data("ie8-prevent-submit")?(b.removeData("ie8-prevent-submit"),!1):g.submit.call(a)});c.is("form")||(b.find("input, textarea").bind("keydown.key_return",function(){c.triggerHandler("submit");if(browser.ie&&8==browser.version){var a=c.closest("form");a.length&&a.data("ie8-prevent-submit",!0)}else return!1}),b.is(c)&&(a.submitButton.click(function(){b.triggerHandler("submit")}),b.find(".reset-button").click(function(){b.triggerHandler("reset")})))},
validation:function(a){var b=a.validation_config||{},c=this.attr("error-position");c?b.error_position=c:window.app&&app.is_front_end&&(c=this.attr("validation-config-key"))&&(c=app.config["validation_"+c+"_error_position"])&&(b.error_position=c);this.is(a.elm)?this.attachValidator(b):a.elm.obj(ValidationPanel).attach(this.find("[validation]"),b)},restrict:function(){this.find(":text[restrict]").each(function(){var a=$(this);a[a.attr("restrict")]()})},unique:function(){var a=this,b=this.attr("action")||
this.attr("unique-action");if(b){var c=b.lastIndexOf("/");b=b.substring(0,c)+"/";var d=this.find("input[name=id]").length,e=0;this.find(".unique").each(function(){var c=$(this);bm.unique({url:b+(c.attr("unique-action")||"isUnique"),restoreUrl:b+(c.attr("unique-restore")||"restoreFromTrash"),editMode:d,elm:c,form:a,uniqueFieldCount:e+=1,fieldError:!1,inTrash:!1})})}},focus_on_row:function(){this.find(".form-row > input").focus(function(){$(this).parent().addClass("active-row")}).blur(function(){$(this).parent().removeClass("active-row")})},
disable_on_invalid:function(a){if(a.disable_on_invalid){var b=!1;this.find("[validation]").each(function(){var c=bm.getUUID();$(this).bind("invalid.form_js",function(d){if(d.target==d.currentTarget){g.lock.call(a,c);if(!b&&(d=$(this),window.app&&!app.is_front_end)){var e=d.parents(".scrollable.vertical");e.length&&e.scrollTo(d,{offsetTop:"180"})}b=!0}}).bind("remove.form_js clear-error.form_js",function(d){d.target==d.currentTarget&&(g.unlock.call(a,c),b=!1)})})}},password_strength_meter:function(){var a=
this.find(".password-strength-meter");$.each(a,function(a,b){$(b).on("keyup",function(){var a=$(b).val(),e=0;6<a.length&&e++;a.match(/[a-z]/)&&a.match(/[A-Z]/)&&e++;a.match(/\d+/)&&e++;a.match(/.[!,@,#,$,%,^,&,*,?,_,~,-,(,)]/)&&e++;12<a.length&&e++;var f=$(b).siblings();$.each(f,function(a,b){if($(b).hasClass("password-meter-wrap"))return g=$(b),!1});if(!g){var g=$("<span class='password-meter-wrap'></span>");$(b).after(g)}f=g.find(".password-description");0==f.length&&g.append("<div class='password-description'></div>");
f.text($.i18n.prop(d[e]));0==a.length&&f.text("");f=g.find(".password-strength-bar");0==f.length&&g.append("<div class='password-strength-bar'></div>");f.removeClass();f.addClass("password-strength-bar "+c[e]);0==a.length&&f.removeClass()})})},abn_input_formatting:function(){var a=this.find(".abn-validation");a.on({keypress:function(a){var b=a.which;if(!(48<=b&&57>=b))return a.preventDefault(),!1},keyup:function(b){var c=b.which;b=a.val();var d="";if(!(37<=c&&40>=c)&&8!=c&&(b=b.replace(/\s+/g,""),
2<b.length)){for(c=0;c<b.length;c++)2==c?d+=" ":5==c?d+=" ":8==c&&(d+=" "),d+=b[c];a.val(d)}}})}},g={append:function(a){var b=this;$.each(f,function(){this.call(a,b)})},lock:function(a){this.lock||(this.lock={});this.lock[a]=!0;this.submitButton&&this.submitButton.attr("disabled","disabled");this.elm.trigger("lock")},unlock:function(a){this.lock&&this.lock[a]&&delete this.lock[a];$.isEmptyObject(this.lock)&&(this.submitButton&&this.submitButton.removeAttr("disabled"),this.elm.trigger("unlock"))},
prop:function(a,b){return bm.prop(this,a,b)},force_submit:function(a){var b=this,c=bm.getUUID();this.elm.addClass("submitting");g.lock.call(this,c);this.disable_on_submit&&this.submitButton&&(this.text_change_on_submit&&b.submitButton.each(function(){var a=$(this),c=a.text();this.orgText=c;b.disable_button_text?a.text(b.disable_button_text):(c=c==$.i18n.prop("create")?$.i18n.prop("creating"):c==$.i18n.prop("update")?$.i18n.prop("updating"):$.i18n.prop("submitting"),a.text(c+" ..."))}),this.submitButton.attr("disabled",
"disabled"));var d=$.extend({},!0===this.ajax?{}:this.ajax);a=a||{};d.success&&a.success&&(a.success=a.success.blend(d.success));d.error&&a.error&&(a.error=a.error.blend(d.error));if(d.response||a.response)var e=function(){a.response&&a.response.apply(this,arguments);d.response&&d.response.apply(this,arguments)};d.complete&&a.complete&&(a.complete=a.complete.blend(d.complete));var f=$.extend({},d,a);this.elm.is("form")||(f.data=$.extend(this.elm.serializeObject(),f.data),!f.url&&f.controller&&(f.url=
app.baseUrl+f.controller+"/"+f.action));this.elm.ajaxSubmit($.extend(f,{response:function(a,d,f,l){b.elm.removeClass("submitting");g.unlock.call(b,c);"success"==a?b.elm.trigger("ajax-submit-success",[d,f,l]):b.elm.trigger("ajax-submit-error",[l,f,d]);b.disable_on_submit&&(b.text_change_on_submit&&b.submitButton.each(function(){$(this).text(this.orgText)}),b.submitButton.removeAttr("disabled","disabled"));e&&e.apply(b.elm,arguments)}}))},submit:function(a){if(!$.isEmptyObject(this.lock))return!1;try{if(!this.elm.valid())return a&&
a.invalid&&a.invalid.call(this.elm),!1;if(this.elm.attr("disabled"))return!1;var b=!0;if("function"===typeof this.preSubmit){a=a||(this.ajax?{}:null);if(a){var c=a.success;a.success=void 0}b=this.preSubmit.call(this.elm,a);a&&a.success&&c?a.success=a.success.blend(c):a&&c&&(a.success=c)}if(!1!==b&&this.ajax)return g.force_submit.call(this,a),!1;!1!==b&&this.disable_on_submit&&!this.ajax&&(this.onSubmitLockId=bm.getUUID(),g.lock.call(this,this.onSubmitLockId));return b}catch(q){return log(q.stack),
!1}},set_submit:function(a){this.submitButton=a}};$.fn.form=function(c){if("string"==typeof c){var d,f=Array.prototype.slice.call(arguments,1);this.each(function(){var a=$(this).data("form-inst");if(!a)return!0;d="function"==typeof g[c]?g[c].apply(a,f):a[c];if("undefined"!=typeof d)return!1});return"undefined"!=typeof d?d:this}this.each(function(){var d=$(this);if(!d.data("form-inst")){var e=$.extend({},b,c,{elm:d});d.data("form-inst",e);a.call(d,e)}});return this}})();
(function(){function a(){var a=this,b,d,m,l,n=this.mouseup_handler=function(){bm.enableTextSelection(this.ownerDocument);a.mouse_on=!1;if(a.dragging){a.dragging=!1;a.shim&&a.shim.remove();var b=$(this),c={elm:b};a.stop&&a.stop(c);bm.trigger(a,b,a.jevent_prefix,"stop",[c])}b=a.element[0].ownerDocument;b.removeEventListener("mouseup",a.mouseup_handler,!0);b.removeEventListener("mousemove",a.mousemove_handler,!0)},q=this.mousemove_handler=function(c){var e=c.pageY-b,f=c.pageX-m;if(a.mouse_on&&!a.dragging&&
(3<Math.abs(f)||3<Math.abs(e))){if(a.beforeStart){var g=a.beforeStart({elm:$(this)});if(!1===g)return g}a.options.shim&&(g=$("body > .iframe-shim"),g.length||(g=$("<div class='iframe-shim'></div>").appendTo(document.body)),a.shim=g.show());g=$(this);var n={elm:g,iX:m,iY:b,dX:0,dY:0,pX:c.pageX,pY:c.pageY};a.start&&a.start(n);bm.trigger(a,g,a.jevent_prefix,"start",[n]);a.dragging=!0}a.dragging&&(n={elm:$(this),iX:m,iY:b,dX:f,dY:e,dlX:c.pageX-l,dlY:c.pageY-d},a.move&&a.move(n),bm.trigger(a,$(this),a.jevent_prefix,
"move",[n]),d=c.pageY,l=c.pageX)};this.element.on("mousedown."+this.eventNamespace,this.mousedown_handler=function(c){if(!a.skip_elements||!a.skip_elements.is(c.target)&&!a.skip_elements.isParentOf(c.target)){a.options.disable_text_selection&&bm.disableTextSelection(this.ownerDocument);$(this).one("mouseup.prevent_selection",function(){bm.enableTextSelection(this.ownerDocument)});if(a.options.cancel){var e=$(c.target);if(e.is(a.options.cancel)||e.closest(a.options.cancel,a.element).length)return}d=
b=c.pageY;l=m=c.pageX;c=this.ownerDocument;c.addEventListener("mouseup",a.mouseup_handler=$.proxy(n,this),!0);c.addEventListener("mousemove",a.mousemove_handler=$.proxy(q,this),!0);a.mouse_on=!0}})}var b={disable_text_selection:!0,skip:void 0};bm.MOUSEHANDLER_INSTANCE_COUNT=1;bm.MouseHandler=function(c,d){this.hash=bm.MOUSEHANDLER_INSTANCE_COUNT;this.eventNamespace="mouse-handler-"+this.hash;this.element=c;this.options=$.extend({},b,d);this.options.skip&&(this.skip_elements=this.options.skip.jqObject);
a.apply(this)};var d=bm.MouseHandler.prototype;d.addElement=function(a){a.on("mousedown."+this.eventNamespace,this.mousedown_handler)};d.removeElement=function(a){a.off("mousedown."+this.eventNamespace)};d.destroy=function(){this.element.off("mousedown."+this.eventNamespace)};d.restore=function(){this.element.on("mousedown."+this.eventNamespace,this.mousedown_handler)}})();
(function(){var a={helper:"self",drop:void 0,axis:void 0,sort:void 0,sort_offset:{left:0,top:0},sort_area:void 0,sort_ignore_scroll:!1,containment:void 0,proxy:void 0,shim:!1,append_on_drop:!0,sortable_on_drop:!0,helper_position_adjust:!0,remove_helper_after_done:!0};bm.Draggable=function(b,c){bm.MouseHandler.apply(this,arguments);this.jevent_prefix="drag";$.extend(this.options,a,c);"static"==this.element.css("position")&&this.element.css({position:"relative"});this.element.addClass("bmui-draggable");
this.adjustOptions();this.temp={}};bm.jquerify("draggable",bm.Draggable);var b=bm.Draggable.inherit(bm.MouseHandler);b.adjustOptions=function(){this.adjustDropOption();this.adjustSortOption()};b.addElement=function(a){a.addClass("bmui-draggable");bm.Draggable._super.addElement.apply(this,arguments);this.element=this.element.add(a)};b.removeElement=function(a){a.removeClass("bmui-draggable");bm.Draggable._super.removeElement.apply(this,arguments);this.element=this.element.not(a)};b.adjustSortOption=
function(){this.sort=this.options.sort?this.options.sort instanceof bm.Sortable?this.options.sort:this.options.sort instanceof $?this.options.sort.obj(bm.Sortable):null:null};b.adjustDropOption=function(){if(this.options.drop){var a=this.options.drop;this.drop="string"==typeof a||a instanceof $?{element:a,intersect:100}:Object.create(this.options.drop);this.drop.intersect&&"string"!=typeof this.drop.intersect||(this.drop.intersect="fit"==this.drop.intersect?100:50)}else this.drop=void 0};b.getDropArea=
function(){var a=this.drop.area;return a?(a instanceof $&&(a=a.rect()),a):!1};b.getSortArea=function(){var a=this.options.sort_area;return a?(a instanceof $&&(a=a.rect()),a):!1};b._getProxy=function(){return this.options.proxy?this.options.proxy instanceof $?this.options.proxy:this.options.proxy(this.draggee):this.draggee};b._calculateContainment=function(){if(this.options.containment){var a=$(this.mobile[0].offsetParent),b=a.outerWidth(),f=a.outerHeight(),g=this.mobile.outerWidth(),m=this.mobile.outerHeight();
"offset"==this.options.containment?a=[0,0,0,0]:"parent"==this.options.containment?this.mobile.parent()[0]==a[0]?a=[0,0,0,0]:(a=a.position(),a=[a.left,b-a.left-g,a.top,f-a.top-m]):a=$.isFunction(this.options.containment)?this.options.containment.call(this,this.mobile):[this.options.containment.left,this.options.containment.right,this.options.containment.top,this.options.containment.bottom];this.containment=[[a[0],b-g-a[1]],[a[1],b-g-a[0]],[a[2],f-m-a[3]],[a[3],f-m-a[2]]]}else this.containment=void 0};
b.start=function(a){if("self"==this.options.helper||this.options.helper instanceof $||$.isFunction(this.options.helper))this.options.helper instanceof $?this.draggee=this.options.helper:$.isFunction(this.options.helper)?this.draggee=this.options.helper.call(this,a.elm):(this.draggee=a.elm,this.draggee_position=a.elm[0].style.position),this.draggee.parent().length||(a.elm.after(this.draggee),this.draggee.css({position:"absolute"}),this.remove_helper_after_done=!0),this.mobile=this._getProxy(),this.draggee.addClass("bmui-draggable-cloned-helper"),
"self"!=this.options.helper&&!1!==this.options.helper_position_adjust&&this.draggee.offset({left:a.pX-this.draggee.outerWidth()/2,top:a.pY-this.draggee.outerHeight()/2});else{this.remove_helper_after_done=!0;this.draggee=a.elm.clone();this.draggee.css({position:"absolute"}).removeClass("bmui-draggable").addClass("bmui-draggable-cloned-helper");var b=$(document.body);this.options.helper.parent&&(b=this.options.helper.parent instanceof $?this.options.helper.parent:"same"!=this.options.helper.parent?
$(this.options.helper.parent):a.elm.parent());this.draggee.appendTo(b);a=a.elm.offset();this.draggee.offset(this.options.helper.offset?{left:this.options.helper.offset.left+a.left,top:this.options.helper.offset.top+a.top}:a);this.mobile=this._getProxy()}this.positionReference=bm.positionReference(this.mobile);0!=(this.positionReference-1)%3?(a=this.mobile.css("left"),"auto"==a&&(a=0),this.startX=parseFloat(a)):this.startX=parseFloat(this.mobile.css("right"));0==(this.positionReference+1)%3&&(this.startX2=
parseFloat(this.mobile.css("right")));3>this.positionReference||5<this.positionReference?(a=this.mobile.css("top"),"auto"==a&&(a=0),this.startY=parseFloat(a)):this.startY=parseFloat(this.mobile.css("bottom"));5<this.positionReference&&(this.startY2=parseFloat(this.mobile.css("bottom")));this._initDrop();this._calculateContainment()};b.stop=function(a,b){this.draggee.removeClass("bmui-draggable-cloned-helper");if(this.dropee&&(this.dropee.removeClass("bmui-droppable-target bmui-droppable-active-target"),
this.drop_target)){b={drag:this.draggee,drop:this.drop_target};if(this.options.append_on_drop){this.drop_target.append(this.draggee);var c=this.draggee[0].style;if(this.draggee[0]==a.elm[0])c.position=this.draggee_position;else{c.position=a.elm[0].style.position||"";var d=$(this.draggee[0].offsetParent).offset();b.position={left:parseInt(c.left)-d.left-(this.drop.offset?this.drop.offset.left:0),top:parseInt(c.top)-d.top-(this.drop.offset?this.drop.offset.top:0)};c.left=c.top=""}}bm.trigger(this,a.elm,
"drag","drop",b);!this.options.append_on_drop&&this.remove_helper_after_done&&this.draggee.remove()}this.sort_target_on?(this.sort_target_on=!1,b=this.sort,b.draggable.options.stop.call(b.draggable,{elm:this.draggee},!0,!0),b.placeholder.replaceWith(this.draggee),this.draggee.css({position:"",left:"",top:"",right:"",bottom:""}),bm.trigger(this,a.elm,"drag","sort",{sort:this.draggee,obj:b}),"self"==this.options.helper&&(this.element=this.element.not(this.draggee),this.removeElement(this.draggee)),
this.options.sortable_on_drop&&b.addHandle(this.draggee)):this.drop_target||this.draggee[0]!=a.elm[0]&&!1!==this.options.remove_helper_after_done&&this.draggee.remove();this.drop_target=void 0};b._initDrop=function(){if(this.drop){var a=this.drop,b=a.element;a.element="string"==typeof b?this.dropee=$(b):this.dropee=b;this.dropee.addClass("bmui-droppable-target");this.dropee.length||(this.dropee=null)}else this.dropee=null};b._posInContainment=function(a,b){if(this.containment){a=this.containment[{left:0,
right:1,top:2,bottom:3}[a]];if(b<a[0])return a[0];if(b>a[1])return a[1]}return b};b.move=function(a){if(!this.options.axis||"x"==this.options.axis)switch(this.positionReference){case 2:case 5:case 8:this.mobile.css("right",this._posInContainment("right",this.startX2-a.dX));case 0:case 3:case 6:this.mobile.css("left",this._posInContainment("left",this.startX+a.dX));break;case 1:case 4:case 7:this.mobile.css("right",this._posInContainment("right",this.startX-a.dX))}if(!this.options.axis||"y"==this.options.axis)switch(this.positionReference){case 6:case 7:case 8:this.mobile.css("bottom",
this._posInContainment("bottom",this.startY2-a.dY));case 0:case 1:case 2:this.mobile.css("top",this._posInContainment("top",this.startY+a.dY));break;case 3:case 4:case 5:this.mobile.css("bottom",this._posInContainment("bottom",this.startY-a.dY))}var b;!this.sort_target_on&&this.dropee&&(b=this._dropIntersect());this.sort&&!b&&this._sortIntersect(a)};b._dropIntersect=function(){var a=this.drop;this.dropee.removeClass("bmui-droppable-active-target");this.drop_target=void 0;var b=this.draggee.rect(),
f=0,g,m=this.getDropArea();if(!(m&&50>bm.intersect(m,b))){var l=a.offset;l&&!a.ignore_scroll&&this.dropee[0].ownerDocument!=this.draggee[0].ownerDocument&&(a=bm.getTopScroller(this.dropee[0].ownerDocument),l=Object.create(l),l.left-=a.scrollLeft(),l.top-=a.scrollTop());this.dropee.each(function(){var a=$(this),c=a.rect(l);c=bm.intersect(c,b);c>f&&(f=c,g=a)});if(g&&f>=this.drop.intersect)return g.addClass("bmui-droppable-active-target"),this.drop_target=g,!0}};b._sortIntersect=function(a){if(this.sort.element.length){var b=
this.draggee.rect(),d=this.getSortArea();if(!(d&&50>bm.intersect(d,b))){var g=this.options.sort_offset;$.isFunction(g)&&(g=g(this.sort.element));g&&!this.options.sort_ignore_scroll&&this.sort.element[0].ownerDocument!=this.draggee[0].ownerDocument&&(d=bm.getTopScroller(this.sort.element[0].ownerDocument),g=Object.create(g),g.left-=d.scrollLeft(),g.top-=d.scrollTop());var m,l=0,n,q=this;this.sort.element.each(function(){var a=$(this),c=a.rect(g);if(m=bm.intersect(c,b)){if(q.sort_target_on)return!1;
l<m&&(l=m,n=a)}});if(m||l)return a={elm:a.elm,iX:a.iX+a.dX-a.dlX,iY:a.iY+a.dY-a.dlY,dX:0,dY:0,dlX:a.dlX,dlY:a.dlY},this.sort_target_on||(this.sort.draggable.draggee=this.draggee,this.sort.draggable.start(a,!0,n),this.sort_target_on=!0),this.sort.draggable.options.move.call(this.sort.draggable,a,!0,g),!0;this.sort_target_on&&(this.sort_target_on=!1,this.sort.draggable.options.stop.call(this.sort.draggable,{elm:a.elm},!0))}}};b.dropTarget=function(a){this.dropee&&(this.dropee.removeClass("bmui-droppable-target"),
this.dropee=null);this.options.drop=a;this.adjustDropOption();this._initDrop()};b.sortElement=function(a,b,f,g){a?(this.options.sort=a,this.options.sort_offset=b,this.options.sort_area=f,this.options.sort_ignore_scroll=g,this.adjustSortOption()):this.options.sort=this.sort=null};b.destroy=function(){this.element.removeClass("bmui-draggable");bm.MouseHandler.prototype.destroy.apply(this,arguments)};b.restore=function(){this.element.addClass("bmui-draggable");bm.MouseHandler.prototype.restore.apply(this,
arguments)}})();
(function(){var a={axis:void 0,placeholder:!0,placeholder_size:!1,offset:void 0,intersect:10,helper:"self",handle:void 0,shim:!1,helper_position_adjust:!0};bm.Sortable=function(b,c){var d=this;this.options=$.extend({},a,c);this.element=b;this.handles=this.createHandles();var g=!1;this.handles.is("tr")&&"self"==this.options.helper&&(g=!0,this.options.helper=function(a){var b=$("<table class='tr-sortable-proxy-table' style='table-layout: fixed; position: absolute;'></table>"),c=a.closest("table");c.after(b);
b.width(c.width());b.position({my:"left top",at:"left top",of:a});b.append(a);return b},this.options.helper_position_adjust=!1);b=this.draggable=new bm.Draggable(this.handles,{axis:this.options.axis,helper:this.options.helper,helper_position_adjust:this.options.helper_position_adjust,remove_helper_after_done:!g,stop:function(a,b,c){b?d.options.placeholder&&!c&&d.placeholder.remove():(d.options.placeholder&&(b=!0,d.options.beforeSort&&(b=d.options.beforeSort(d.placeholder,d.placeholder_target)),b?
g?(b=a.elm.closest("table"),d.placeholder.after(a.elm).remove(),b.remove()):d.placeholder.replaceWith(a.elm):d.placeholder.remove()),$.each(this.element_cache,function(b,c){a.elm[0].style[b]=c}),bm.trigger(d,a.elm,"sort","sort",{elm:a.elm,obj:d}),d.options.stop&&d.options.stop.call(d));d.placeholder_target&&d.placeholder_target.removeClass("bmui-sortable-active-target")},move:function(a,b,c){d.placeholderPosition(a,b,c);bm.trigger(d,a.elm,"sort","drag",{elm:a.elm,obj:d})},shim:this.options.shim});
b.jevent_prefix="sort";b.beforeStart=function(a,b){if(!b)return bm.trigger(d,a.elm,"sort","beforeStart",{elm:a.elm,obj:d})};b.start=function(a,b,c){g&&(d.elm_parent=a.elm.parent(),d.elm_index=a.elm.index());b||(this.element_cache={position:a.elm[0].style.position||"",left:a.elm[0].style.left||"",top:a.elm[0].style.top||"",right:a.elm[0].style.right||"",bottom:a.elm[0].style.bottom||""},bm.Draggable.prototype.start.apply(this,arguments));d.options.placeholder?(d.placeholder=g?$("<tr class='bmui-sortable-placeholder'><td colspan='"+
a.elm.find(">td").toArray().sum('+(this.getAttribute("colspan") || "1")')+"'></td></tr>"):$("<div class='bmui-sortable-placeholder'></div>"),g?0==d.elm_index?d.elm_parent.prepend(d.placeholder):d.elm_parent.children().eq(d.elm_index-1).after(d.placeholder):c?c.append(d.placeholder):a.elm.before(d.placeholder),d.options.placeholder_size&&(d.placeholder.outerWidth(a.elm.outerWidth()),d.placeholder.outerHeight(a.elm.outerHeight()))):d.placeholder=a.elm;d.placeholder_target=d.placeholder.parent().addClass("bmui-sortable-active-target");
d.draggee=this.draggee;d.candidate=a.elm;b||bm.trigger(d,a.elm,"sort","start",{elm:a.elm,obj:d})}};bm.jquerify("sortable",bm.Sortable);var b=bm.Sortable.prototype;b.placeholderPosition=function(a,b,f){var c=this.draggee.rect(),d=this.options,l,n,q=d.intersect||20;this.element.filter(":not(:has(>"+(this.options.handle||"")+":visible))").each(function(){var a=$(this),e=a.rect(b?f:d.offset);e=bm.intersect(e,c);e>q&&(l=a,n="append",q=e)});var e=(c.left+c.right)/2,p=(c.top+c.bottom)/2;this.handles.not(this.candidate).each(function(){var a=
$(this),g=a.rect(b?f:d.offset),m=bm.intersect(g,c);m>q&&(l=a,q=m,n=0>(g.right-g.left)*(p-g.bottom)-(g.top-g.bottom)*(e-g.left)?"before":"after")});n&&(l[n](this.placeholder),this.placeholder_target.is(this.placeholder.parent())||(this.placeholder_target.removeClass("bmui-sortable-active-target"),this.placeholder_target=this.placeholder.parent().addClass("bmui-sortable-active-target")))};b.extendObjElement=b.addElement=function(a){$.merge(this.element,a);a=this.createHandles(a);this.handles=this.handles.add(a);
this.draggable.addElement(a)};b.removeObjElement=b.removeElement=function(a){var b=this;a.each(function(){b.element.splice(b.element.index(this),1)});a=this.createHandles(a);this.handles=this.handles.not(a);this.draggable.removeElement(a)};b.addHandle=function(a){this.handles=this.handles.add(a);this.draggable.addElement(a)};b.createHandles=function(a){a=(a||this.element).children(":visible");return this.options.handle?a.filter(this.options.handle):a};b.destroy=function(){this.draggable.destroy()};
b.restore=function(){this.draggable.restore()}})();
(function(){var a={direction:["t","r","b","l"],reverse:void 0,containment:void 0,proxy:void 0,shim:!1,limit:void 0};bm.Resizable=function(b,c){this.options=$.extend({},a,c);this.element=b.addClass("bmui-resizable");this.initHandles()};var b=bm.Resizable.prototype;bm.jquerify("resizable",bm.Resizable);b._posInContainment=function(a,b){var c=b;if(this.containment){var d=this.containment[a];b<d[0]?c=d[0]:b>d[1]&&(c=d[1])}if(this.limit)if("width"==a||"height"==a){if(c<this.limit[0])return this.limit[0];
if(c>this.limit[1])return this.limit[1]}else{if(c<this.limit["min"+a+"point"])return this.limit["min"+a+"point"];if(c>this.limit["max"+a+"point"])return this.limit["max"+a+"point"]}return c};b._calculateContainment=function(a,b){this.containment=void 0;if(this.options.containment){var c=this.resize_element,d=$(c[0].offsetParent);if("x"==a){var m=d.outerWidth();var l=c.outerWidth();var n=["left","right","width"]}else m=d.outerHeight(),l=c.outerHeight(),n=["top","bottom","height"];"offset"==this.options.containment?
m=[0,0]:"parent"==this.options.containment?c.parent()[0]==d[0]?m=[0,0]:(d=d.position(),m=[d[n[0]],m-d[n[0]]-l]):m=$.isFunction(this.options.containment)?this.options.containment.call(this,c,a):[this.options.containment[n[0]],this.options.containment[n[1]]];if(!this.containment)switch(this.containment={},d=bm.positionReference(c),"x"==a?d%3:3>d?0:1){case 0:b?(this.containment[n[0]]=[m[0],this.startIX+l-10],this.containment[n[2]]=[10,this.startIX+l-m[0]]):this.containment[n[2]]=[10,l+parseFloat(c.pposition(n[1]))-
m[1]];break;case 1:b?this.containment[n[2]]=[10,l+parseFloat(c.pposition(n[0]))-m[0]]:(this.containment[n[1]]=[m[1],this.startDX+l-10],this.containment[n[2]]=[10,l+this.startDX-m[1]]);break;default:b?this.containment[n[0]]=[m[0],this.startIX+l-10]:this.containment[n[1]]=[m[1],this.startDX+l-10]}}this.limit=void 0;this.options.limit&&(c=this.resize_element,this.limit="x"==a?[this.options.limit[0],this.options.limit[1]]:[this.options.limit[2],this.options.limit[3]],b="x"==a?["left","right"]:["top",
"bottom"],m="x"==a?c.outerWidth():c.outerHeight(),a=parseFloat(c.pposition(b[0])),c=parseFloat(c.pposition(b[1])),void 0!=this.limit[0]&&(this.limit["max"+b[0]+"point"]=m-this.limit[0]+a,this.limit["max"+b[1]+"point"]=m-this.limit[0]+c),void 0!=this.limit[1]&&(this.limit["min"+b[0]+"point"]=m-this.limit[1]+a,this.limit["min"+b[1]+"point"]=m-this.limit[1]+c))};b.initHandles=function(){var a=this;this.options.direction.every(function(){var b=$("<div class='bmui-resize-handle'></div>");"r"==this?b.addClass("resize-right"):
"l"==this?b.addClass("resize-left"):"t"==this?b.addClass("resize-top"):b.addClass("resize-bottom");a.element.append(b)});var b=function(b,c){var d=b.elm.parent();a.reverse_element=void 0;a.resize_element=a.options.proxy?a.options.proxy instanceof $?a.options.proxy:a.options.proxy(this.draggee.closest(".bmui-resizable")):this.draggee.closest(".bmui-resizable");a.options.reverse&&(a.options.reverse instanceof $?a.reverse_element=a.options.reverse:$.isFunction(a.options.reverse)&&(a.reverse_element=
a.options.reverse(d)));bm.trigger(a,b.elm.parent(),"resize","prestart",$.extend({},b,{elm:b.elm.parent(),obj:a}));d="x"==c?this.draggee.is(".resize-left"):this.draggee.is(".resize-top");var f=a.resize_element.css("position");a.iproperty=void 0;a.dproperty=void 0;if("static"==f||"relative"==f)d?a.dproperty=a.riproperty="x"==c?"width":"height":a.rdproperty=a.iproperty="x"==c?"width":"height";else{f=function(b,e,d,f){b=bm.positionReference(b);switch("x"==c?b%3:3>b?0:1){case 0:f?(a[e]=g[0],a[d]=g[2]):
a[e]=g[2];break;case 1:f?a[d]=g[2]:(a[d]=g[1],a[e]=g[2]);break;default:f?a[e]=g[0]:a[d]=g[1]}};var g="x"==c?["left","right","width"]:["top","bottom","height"];f(a.resize_element,"iproperty","dproperty",d);a.reverse_element&&f(a.reverse_element,"riproperty","rdproperty",!d)}a.startIX=a.iproperty?parseFloat(a.resize_element.css(a.iproperty)):void 0;a.startDX=a.dproperty?parseFloat(a.resize_element.css(a.dproperty)):void 0;a.reverse_element&&(a.startRIX=a.riproperty?parseFloat(a.reverse_element.css(a.riproperty)):
void 0,a.startRDX=a.rdproperty?parseFloat(a.reverse_element.css(a.rdproperty)):void 0);a.temp=this.temp;this.mobile=a.resize_element;a._calculateContainment(c,d);bm.trigger(a,b.elm.parent(),"resize","start",$.extend({},b,{elm:b.elm.parent(),obj:a}))};this.x_draggable=new bm.Draggable(this.element.find(">.bmui-resize-handle.resize-left, >.bmui-resize-handle.resize-right"),{axis:"x",shim:this.options.shim,containment:this.options.containment,start:function(a){b.call(this,a,"x")}});this.y_draggable=
new bm.Draggable(this.element.find(">.bmui-resize-handle.resize-top, >.bmui-resize-handle.resize-bottom"),{axis:"y",shim:this.options.shim,containment:this.options.containment,start:function(a){b.call(this,a,"y")}});this.x_draggable.move=this.y_draggable.move=function(b){var c=b.elm.is(".resize-left, .resize-right")?b.dX:b.dY,d=a.startIX,f=a.startDX,n={};if(void 0!==d){d+=c;var q=a._posInContainment(a.iproperty,d);q!=d&&(c-=d-q);n[a.iproperty]=q;a.resize_element.css(a.iproperty,q)}void 0!==f&&(f-=
c,q=a._posInContainment(a.dproperty,f),q!=d&&(c+=f-q),n[a.dproperty]=q,a.resize_element.css(a.dproperty,q));a.reverse_element&&(d=a.startRIX,f=a.startRDX,void 0!==d&&a.reverse_element.css(a.riproperty,d+c),void 0!==f&&a.reverse_element.css(a.rdproperty,f-c));bm.trigger(a,b.elm.parent(),"resize","resize",$.extend({},b,{elm:b.elm.parent(),dims:n}))};this.x_draggable.element.add(this.y_draggable.element).on("drag:stop",function(b,c){bm.trigger(a,c.elm.parent(),"resize","stop",$.extend({},c,{elm:c.elm.parent()}))})};
b.destroy=function(){this.element.removeClass("bmui-resizable");this.x_draggable.destroy();this.x_draggable.element.remove();this.y_draggable.destroy();this.y_draggable.element.remove()}})();
(function(){function a(b,d){var c=this;b.children().each(function(){$(this).children("."+c.options.entry_class).attr("entry-level",d);a.bind(c)($(this).children("."+c.options.sub_entry_class),d+1)})}var b={level_depth:30,entry_class:"bmui-stl-entry",sub_entry_class:"bmui-stl-sub-container",entry_container_class:"bmui-stl-entry-container",shim:!1,placeholder_size:!0,intersect:60};bm.SortableTreeList=function(c,d){var f=this;this.options=$.extend({},b,d);this.element=c;this.handles=c.find("."+this.options.entry_class);
this._assignLevels();c=this.draggable=new bm.Draggable(this.handles,{helper:function(a){a=a.parent();var b=a.offset(),c=a.width(),d=a.height();a.css("position","absolute");a.offset(b);a.width(c);a.height(d);return a},remove_helper_after_done:!1,helper_position_adjust:!1,move:function(){f.placeholderPosition()},stop:function(b){f.placeholder.replaceWith(b.elm.parent());b.elm.parent().css(this.helper_cache);b.elm.attr("entry-level",f.set_level);a.bind(f)(b.elm.next(),f.set_level+1);bm.trigger(f,b.elm,
"stl","change",{item:b.elm,parent:f.getParent(b.elm)})},shim:this.options.shim});c.jevent_prefix="stl";c.start=function(a){var b=a.elm.parent();this.helper_cache={position:b[0].style.position||"",left:b[0].style.left||"",top:b[0].style.top||"",right:b[0].style.right||"",bottom:b[0].style.bottom||"",width:b[0].style.width||"",height:b[0].style.height||""};bm.Draggable.prototype.start.apply(this,arguments);f.placeholder=$("<div class='bmui-sortable-placeholder'></div>");b.before(f.placeholder);f.options.placeholder_size&&
(f.placeholder.outerWidth(b.outerWidth()),f.placeholder.outerHeight(b.outerHeight()));f.draggee=this.draggee;f.candidate=a.elm;f.level_0_x=f.element.offset().left;f.draggee_level=a.elm.attr("entry-level")}};bm.jquerify("sortable-tree-list",bm.SortableTreeList);var d=bm.SortableTreeList.prototype;d._assignLevels=function(){a.bind(this)(this.element,0)};d._setPlaceholderLevel=function(b){function c(c){var d=this.placeholder.next();for(d.is(this.draggee)&&(d=this.draggee.next());!d.length&&(this.placeholder.parent().parent().after(this.placeholder),
this.draggee.prev().length||this.draggee.next().length||(d=this.draggee.parent(),this.placeholder.after(this.draggee),this.draggee.attr("entry-level",c-1),a.bind(this)(this.draggee.next(),c),d.remove()),c--,d=this.placeholder.next(),b!=c););return c}var d=this.placeholder.prev();if(d.length){var m=+d.children("."+this.options.entry_class).attr("entry-level");if(b>m){m++;var l=d.children("."+this.options.sub_entry_class);l.length||(l=$("<div></div>"));l.addClass(this.options.sub_entry_class);d.append(l);
l.append(this.placeholder)}else b!=m&&(m=c.bind(this)(m));return m}d=this.placeholder.next();d=d.length?+d.children("."+this.options.entry_class).attr("entry-level"):+this.placeholder.parent().prev().attr("entry-level")+1;b<d&&(d=c.bind(this)(d));return d};d.placeholderPosition=function(){var a=this.candidate.rect(),b,d,m=(a.left+a.right)/2,l=(a.top+a.bottom)/2,n=this.options.intersect;this.handles.not(this.draggee.find(".bmui-stl-entry")).each(function(){var c=$(this),f=c.rect(),g=bm.intersect(f,
a);g>n&&(b=c,n=g,d=0>(f.right-f.left)*(l-f.bottom)-(f.top-f.bottom)*(m-f.left)?"before":"after")});if(d)if("after"==d&&b.next().is("."+this.options.sub_entry_class))b.next().prepend(this.placeholder);else b.parent()[d](this.placeholder);var q=Math.floor((this.draggee.offset().left-this.level_0_x)/this.options.level_depth);0>q&&(q=0);this.set_level=this._setPlaceholderLevel(q)};d.addHandle=function(a,b){this.handles=this.handles.add(a);this.draggable.addElement(a);$("<div></div>").addClass(this.options.entry_container_class).append(a);
this.setParent(a,b)};d.createHandles=function(a){a=(a||this.element).children(":visible");return this.options.handle?a.filter(this.options.handle):a};d.destroy=function(){this.draggable.destroy()};d.restore=function(){this.draggable.restore()};d.getParent=function(a){a=a.closest("."+this.options.sub_entry_class);return a.length?a.prev():$()};d.setParent=function(b,d){if(d&&d.length){var c=+d.attr("entry-level");var f=d.next();f.length||(f=$("<div></div>"),f.addClass(this.options.sub_entry_class),
d.after(f));d=f}else d=this.element,c=-1;if(!b.parent().parent().is(d)){var l;b.parent().next().length||b.parent().prev().length||(l=b.parent().parent());d.append(b.parent());l&&l.remove();b.attr("entry-level",c+1);a.bind(this)(b.next(),c+2)}};d.each=function(a){var b=this,c=function(d,f){var g;d.children().each(function(){var d=$(this).children("."+b.options.entry_class);if(!1===a(d,f?f.children("."+b.options.entry_class):void 0))return g=!1;d=$(this).children("."+b.options.sub_entry_class);if(d.length&&
(g=c(d),!1===g))return!1});return g};c(this.element)}})();
(function(a){"function"===typeof define&&define.amd?define(["jquery","jquery.ui.widget"],a):a(window.jQuery)})(function(a){a.support.fileInput=!(/(Android (1\.[0156]|2\.[01]))|(Windows Phone (OS 7|8\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1\.0|2\.[05]|3\.0))/.test(window.navigator.userAgent)||a('<input type="file">').prop("disabled"));a.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader);a.support.xhrFormDataFileUpload=!!window.FormData;a.support.blobSlice=
window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);var b={dropZone:a(document),pasteZone:a(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,
recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(b,d){b=this.messages[b]||b.toString();d&&a.each(d,function(a,c){b=b.replace("{"+a+"}",c)});return b},formData:function(a){return a.serializeArray()},add:function(b,d){if(b.isDefaultPrevented())return!1;(d.autoUpload||!1!==d.autoUpload&&a(this).fileupload("option","autoUpload"))&&d.process().done(function(){d.submit()})},processData:!1,contentType:!1,
cache:!1},d=function(c,d){this.element=c;this.options=a.extend({},b,d);this._create()};bm.jquerify("fileupload",d);d.prototype={_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:a.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.bitrate=this.loaded=0;this.getBitrate=function(a,b,d){var c=a-this.timestamp;if(!this.bitrate||
!d||c>d)this.bitrate=1E3/c*(b-this.loaded)*8,this.loaded=b,this.timestamp=a;return this.bitrate}},_isXHRUpload:function(b){return!b.forceIframeTransport&&(!b.multipart&&a.support.xhrFileUpload||a.support.xhrFormDataFileUpload)},_getFormData:function(b){if("function"===a.type(b.formData))return b.formData(b.form);if(a.isArray(b.formData))return b.formData;if("object"===a.type(b.formData)){var c=[];a.each(b.formData,function(a,b){c.push({name:a,value:b})});return c}return[]},_getTotal:function(b){var c=
0;a.each(b,function(a,b){c+=b.size||1});return c},_initProgressObject:function(b){var c={loaded:0,total:0,bitrate:0};b._progress?a.extend(b._progress,c):b._progress=c},_initResponseObject:function(a){var b;if(a._response)for(b in a._response)a._response.hasOwnProperty(b)&&delete a._response[b];else a._response={}},_onProgress:function(b,d){if(b.lengthComputable){var c=Date.now?Date.now():(new Date).getTime();if(!(d._time&&d.progressInterval&&c-d._time<d.progressInterval&&b.loaded!==b.total)){d._time=
c;var f=Math.floor(b.loaded/b.total*(d.chunkSize||d._progress.total))+(d.uploadedBytes||0);this._progress.loaded+=f-d._progress.loaded;this._progress.bitrate=this._bitrateTimer.getBitrate(c,this._progress.loaded,d.bitrateInterval);d._progress.loaded=d.loaded=f;d._progress.bitrate=d.bitrate=d._bitrateTimer.getBitrate(c,f,d.bitrateInterval);this._trigger("progress",a.Event("progress",{delegatedEvent:b}),d);this._trigger("progressall",a.Event("progressall",{delegatedEvent:b}),this._progress)}}},_initProgressListener:function(b){var c=
this,d=b.xhr?b.xhr():a.ajaxSettings.xhr();d.upload&&(a(d.upload).bind("progress",function(a){var d=a.originalEvent;a.lengthComputable=d.lengthComputable;a.loaded=d.loaded;a.total=d.total;c._onProgress(a,b)}),b.xhr=function(){return d})},_isInstanceOf:function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},_initXHRData:function(b){var c=this,d=b.files[0],m=b.multipart||!a.support.xhrFileUpload,l="array"===a.type(b.paramName)?b.paramName[0]:b.paramName;b.headers=a.extend({},b.headers);
b.contentRange&&(b.headers["Content-Range"]=b.contentRange);m&&!b.blob&&this._isInstanceOf("File",d)||(b.headers["Content-Disposition"]='attachment; filename="'+encodeURI(d.name)+'"');if(!m)b.contentType=d.type||"application/octet-stream",b.data=b.blob||d;else if(a.support.xhrFormDataFileUpload){if(b.postMessage){var n=this._getFormData(b);b.blob?n.push({name:l,value:b.blob}):a.each(b.files,function(c,e){n.push({name:"array"===a.type(b.paramName)&&b.paramName[c]||l,value:e})})}else c._isInstanceOf("FormData",
b.formData)?n=b.formData:(n=new FormData,a.each(this._getFormData(b),function(a,b){n.append(b.name,b.value)})),b.blob?n.append(l,b.blob,d.name):a.each(b.files,function(d,e){(c._isInstanceOf("File",e)||c._isInstanceOf("Blob",e))&&n.append("array"===a.type(b.paramName)&&b.paramName[d]||l,e,e.uploadName||e.name)});b.data=n}b.blob=null},_initIframeSettings:function(b){var c=a("<a></a>").prop("href",b.url).prop("host");b.dataType="iframe "+(b.dataType||"");b.formData=this._getFormData(b);b.redirect&&c&&
c!==location.host&&b.formData.push({name:b.redirectParamName||"redirect",value:b.redirect})},_initDataSettings:function(a){this._isXHRUpload(a)?(this._chunkedUpload(a,!0)||(a.data||this._initXHRData(a),this._initProgressListener(a)),a.postMessage&&(a.dataType="postmessage "+(a.dataType||""))):this._initIframeSettings(a)},_getParamName:function(b){var c=a(b.fileInput),d=b.paramName;d?a.isArray(d)||(d=[d]):(d=[],c.each(function(){var b=a(this),c=b.prop("name")||"files[]";for(b=(b.prop("files")||[1]).length;b;)d.push(c),
--b}),d.length||(d=[c.prop("name")||"files[]"]));return d},_initFormSettings:function(b){b.form&&b.form.length||(b.form=a(b.fileInput.prop("form")),b.form.length||(b.form=a(this.options.fileInput.prop("form"))));b.paramName=this._getParamName(b);b.url||(b.url=b.form.prop("action")||location.href);b.type=(b.type||"string"===a.type(b.form.prop("method"))&&b.form.prop("method")||"").toUpperCase();"POST"!==b.type&&"PUT"!==b.type&&"PATCH"!==b.type&&(b.type="POST");b.formAcceptCharset||(b.formAcceptCharset=
b.form.attr("accept-charset"))},_getAJAXSettings:function(b){b=a.extend({},this.options,b);this._initFormSettings(b);this._initDataSettings(b);return b},_getDeferredState:function(a){return a.state?a.state():a.isResolved()?"resolved":a.isRejected()?"rejected":"pending"},_enhancePromise:function(a){a.success=a.done;a.error=a.fail;a.complete=a.always;return a},_getXHRPromise:function(b,d,g){var c=a.Deferred(),f=c.promise();d=d||this.options.context||f;!0===b?c.resolveWith(d,g):!1===b&&c.rejectWith(d,
g);f.abort=c.promise;return this._enhancePromise(f)},_addConvenienceMethods:function(b,d){var c=this,f=function(b){return a.Deferred().resolveWith(c,b).promise()};d.process=function(b,g){if(b||g)d._processQueue=this._processQueue=(this._processQueue||f([this])).pipe(function(){return d.errorThrown?a.Deferred().rejectWith(c,[d]).promise():f(arguments)}).pipe(b,g);return this._processQueue||f([this])};d.submit=function(){"pending"!==this.state()&&(d.jqXHR=this.jqXHR=!1!==c._trigger("submit",a.Event("submit",
{delegatedEvent:b}),this)&&c._onSend(b,this));return this.jqXHR||c._getXHRPromise()};d.abort=function(){if(this.jqXHR)return this.jqXHR.abort();this.errorThrown="abort";c._trigger("fail",null,this);return c._getXHRPromise(!1)};d.state=function(){if(this.jqXHR)return c._getDeferredState(this.jqXHR);if(this._processQueue)return c._getDeferredState(this._processQueue)};d.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===c._getDeferredState(this._processQueue)};d.progress=function(){return this._progress};
d.response=function(){return this._response}},_getUploadedBytes:function(a){return(a=(a=(a=a.getResponseHeader("Range"))&&a.split("-"))&&1<a.length&&parseInt(a[1],10))&&a+1},_chunkedUpload:function(b,d){b.uploadedBytes=b.uploadedBytes||0;var c=this,f=b.files[0],l=f.size,n=b.uploadedBytes,q=b.maxChunkSize||l,e=this._blobSlice,p=a.Deferred(),t=p.promise(),w;if(!(this._isXHRUpload(b)&&e&&(n||q<l))||b.data)return!1;if(d)return!0;if(n>=l)return f.error=b.i18n("uploadedBytes"),this._getXHRPromise(!1,b.context,
[null,"error",f.error]);var y=function(){var d=a.extend({},b),g=d._progress.loaded;d.blob=e.call(f,n,n+q,f.type);d.chunkSize=d.blob.size;d.contentRange="bytes "+n+"-"+(n+d.chunkSize-1)+"/"+l;c._initXHRData(d);c._initProgressListener(d);w=(!1!==c._trigger("chunksend",null,d)&&bm.ajax(d)||c._getXHRPromise(!1,d.context)).done(function(e,f,m){n=c._getUploadedBytes(m)||n+d.chunkSize;g+d.chunkSize-d._progress.loaded&&c._onProgress(a.Event("progress",{lengthComputable:!0,loaded:n-d.uploadedBytes,total:n-
d.uploadedBytes}),d);b.uploadedBytes=d.uploadedBytes=n;d.result=e;d.textStatus=f;d.jqXHR=m;c._trigger("chunkdone",null,d);c._trigger("chunkalways",null,d);n<l?y():p.resolveWith(d.context,[e,f,m])}).fail(function(a,b,e){d.jqXHR=a;d.textStatus=b;d.errorThrown=e;c._trigger("chunkfail",null,d);c._trigger("chunkalways",null,d);p.rejectWith(d.context,[a,b,e])})};this._enhancePromise(t);t.abort=function(){return w.abort()};y();return t},_beforeSend:function(a,b){0===this._active&&(this._trigger("start"),
this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0);this._initResponseObject(b);this._initProgressObject(b);b._progress.loaded=b.loaded=b.uploadedBytes||0;b._progress.total=b.total=this._getTotal(b.files)||1;b._progress.bitrate=b.bitrate=0;this._active+=1;this._progress.loaded+=b.loaded;this._progress.total+=b.total},_onDone:function(b,d,g,m){var c=m._progress.total,f=m._response;m._progress.loaded<c&&this._onProgress(a.Event("progress",
{lengthComputable:!0,loaded:c,total:c}),m);f.result=m.result=b;f.textStatus=m.textStatus=d;f.jqXHR=m.jqXHR=g;this._trigger("done",null,m)},_onFail:function(a,b,d,m){var c=m._response;m.recalculateProgress&&(this._progress.loaded-=m._progress.loaded,this._progress.total-=m._progress.total);c.jqXHR=m.jqXHR=a;c.textStatus=m.textStatus=b;c.errorThrown=m.errorThrown=d;this._trigger("fail",null,m)},_onAlways:function(a,b,d,m){this._trigger("always",null,m)},_onSend:function(b,d){d.submit||this._addConvenienceMethods(b,
d);var c=this,f,l,n=c._getAJAXSettings(d),q=function(){c._sending+=1;n._bitrateTimer=new c._BitrateTimer;return f=f||((l||!1===c._trigger("send",a.Event("send",{delegatedEvent:b}),n))&&c._getXHRPromise(!1,n.context,l)||c._chunkedUpload(n)||bm.ajax(n)).done(function(a,b,e){c._onDone(a,b,e,n)}).fail(function(a,b,e){c._onFail(a,b,e,n)}).always(function(a,b,e){c._onAlways(a,b,e,n);--c._sending;--c._active;if(n.limitConcurrentUploads&&n.limitConcurrentUploads>c._sending)for(a=c._slots.shift();a;){if("pending"===
c._getDeferredState(a)){a.resolve();break}a=c._slots.shift()}0===c._active&&c._trigger("stop")})};this._beforeSend(b,n);if(this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending){if(1<this.options.limitConcurrentUploads){var e=a.Deferred();this._slots.push(e);d=e.pipe(q)}else d=this._sequence=this._sequence.pipe(q,q);d.abort=function(){l=[void 0,"abort","abort"];return f?f.abort():(e&&e.rejectWith(n.context,l),q())};return this._enhancePromise(d)}return q()},
_onAdd:function(b,d){var c=this,f=!0,l=a.extend({},this.options,d),n=d.files,q=n.length,e=l.limitMultiFileUploads,p=l.limitMultiFileUploadSize,t=l.limitMultiFileUploadSizeOverhead,w=0,y=this._getParamName(l),A=0;!p||q&&void 0!==n[0].size||(p=void 0);if((l.singleFileUploads||e||p)&&this._isXHRUpload(l))if(l.singleFileUploads||p||!e)if(!l.singleFileUploads&&p){var x=[];var z=[];for(l=0;l<q;l+=1)if(w+=n[l].size+t,l+1===q||w+n[l+1].size+t>p||e&&l+1-A>=e)x.push(n.slice(A,l+1)),w=y.slice(A,l+1),w.length||
(w=y),z.push(w),A=l+1,w=0}else z=y;else for(x=[],z=[],l=0;l<q;l+=e)x.push(n.slice(l,l+e)),w=y.slice(l,l+e),w.length||(w=y),z.push(w);else x=[n],z=[y];d.originalFiles=n;a.each(x||n,function(e,g){var l=a.extend({},d);l.files=x?g:[g];l.paramName=z[e];c._initResponseObject(l);c._initProgressObject(l);c._addConvenienceMethods(b,l);return f=c._trigger("add",a.Event("add",{delegatedEvent:b}),l)});return f},_replaceFileInput:function(b){var c=b.clone(!0);a("<form></form>").append(c)[0].reset();b.after(c).detach();
a.cleanData(b.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(a,d){return d===b[0]?c[0]:d});b[0]===this.element[0]&&(this.element=c)},_handleFileTreeEntry:function(b,d){var c=this,f=a.Deferred(),l=function(a){a&&!a.entry&&(a.entry=b);f.resolve([a])};d=d||"";if(b.isFile)b._file?(b._file.relativePath=d,f.resolve(b._file)):b.file(function(a){a.relativePath=d;f.resolve(a)},l);else if(b.isDirectory){var n=b.createReader();n.readEntries(function(a){c._handleFileTreeEntries(a,
d+b.name+"/").done(function(a){f.resolve(a)}).fail(l)},l)}else f.resolve([]);return f.promise()},_handleFileTreeEntries:function(b,d){var c=this;return a.when.apply(a,a.map(b,function(a){return c._handleFileTreeEntry(a,d)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(b){b=b||{};var c=b.items;return c&&c.length&&(c[0].webkitGetAsEntry||c[0].getAsEntry)?this._handleFileTreeEntries(a.map(c,function(a){var b;if(a.webkitGetAsEntry){if(b=a.webkitGetAsEntry())b._file=
a.getAsFile();return b}return a.getAsEntry()})):a.Deferred().resolve(a.makeArray(b.files)).promise()},_getSingleFileInputFiles:function(b){b=a(b);var c=b.prop("webkitEntries")||b.prop("entries");if(c&&c.length)return this._handleFileTreeEntries(c);c=a.makeArray(b.prop("files"));if(c.length)void 0===c[0].name&&c[0].fileName&&a.each(c,function(a,b){b.name=b.fileName;b.size=b.fileSize});else{b=b.prop("value");if(!b)return a.Deferred().resolve([]).promise();c=[{name:b.replace(/^.*\\/,"")}]}return a.Deferred().resolve(c).promise()},
_getFileInputFiles:function(b){return b instanceof a&&1!==b.length?a.when.apply(a,a.map(b,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(b)},_onChange:function(b){var c=this,d={fileInput:a(b.target),form:a(b.target.form)};this._getFileInputFiles(d.fileInput).always(function(f){d.files=f;c.options.replaceFileInput&&c._replaceFileInput(d.fileInput);!1!==c._trigger("change",a.Event("change",{delegatedEvent:b}),d)&&c._onAdd(b,
d)})},_onPaste:function(b){var c=b.originalEvent&&b.originalEvent.clipboardData&&b.originalEvent.clipboardData.items,d={files:[]};c&&c.length&&(a.each(c,function(a,b){(a=b.getAsFile&&b.getAsFile())&&d.files.push(a)}),!1!==this._trigger("paste",a.Event("paste",{delegatedEvent:b}),d)&&this._onAdd(b,d))},_onDrop:function(b){b.stopPropagation();b.preventDefault();b.dataTransfer=b.originalEvent&&b.originalEvent.dataTransfer;var c=this,d=b.dataTransfer,m={};d&&d.files&&d.files.length&&this._getDroppedFiles(d).always(function(d){m.files=
d;!1!==c._trigger("drop",a.Event("drop",{delegatedEvent:b}),m)&&c._onAdd(b,m)})},_onDragOver:function(b){b.stopPropagation();b.preventDefault();b.dataTransfer=b.originalEvent&&b.originalEvent.dataTransfer;var c=b.dataTransfer;c&&-1!==a.inArray("Files",c.types)&&!1!==this._trigger("dragover",a.Event("dragover",{delegatedEvent:b}))&&(c.dropEffect="copy")},_initEventHandlers:function(){var b=this;this._isXHRUpload(this.options)&&(this.options.dropZone.on({dragover:this._onDragOver.bind(this),drop:this._onDrop.bind(this),
dragenter:function(a){a.stopPropagation();a.preventDefault();b._trigger("dragenter",a);return!1},dragleave:function(a){a.stopPropagation();a.preventDefault();b._trigger("dragleave",a);return!1}}),this.options.pasteZone.on({paste:this._onPaste.bind(this)}));if(a.support.fileInput)this.options.fileInput.on({change:this._onChange.bind(this)})},_destroyEventHandlers:function(){this.options.dropZone.off("dragover drop");this.options.pasteZone.off("paste");this.options.fileInput.off("change")},_setOption:function(b,
d){var c=-1!==a.inArray(b,this._specialOptions);c&&this._destroyEventHandlers();this._super(b,d);c&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var b=this.options;void 0===b.fileInput?b.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):b.fileInput instanceof a||(b.fileInput=a(b.fileInput));b.dropZone instanceof a||(b.dropZone=a(b.dropZone));b.pasteZone instanceof a||(b.pasteZone=a(b.pasteZone))},_getRegExp:function(a){a=
a.split("/");var b=a.pop();a.shift();return new RegExp(a.join("/"),b)},_isRegExpOption:function(b,d){return"url"!==b&&"string"===a.type(d)&&/^\/.*\/[igm]{0,3}$/.test(d)},_initDataAttributes:function(){var b=this,d=this.options,g=a(this.element[0].cloneNode(!1));a.each(g.data(),function(a,c){var f="data-"+a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();g.attr(f)&&(b._isRegExpOption(a,c)&&(c=b._getRegExp(c)),d[a]=c)})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=
[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},_trigger:function(b,d,g){var c,f=this.options[b];g=g||{};d=a.Event(d);d.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase();d.target=this.element[0];if(b=d.originalEvent)for(c in b)c in d||(d[c]=b[c]);this.element.trigger(d,g);return!(a.isFunction(f)&&!1===f.apply(this.element[0],[d].concat(g))||d.isDefaultPrevented())},active:function(){return this._active},
progress:function(){return this._progress},add:function(b){var c=this;b&&!this.options.disabled&&(b.fileInput&&!b.files?this._getFileInputFiles(b.fileInput).always(function(a){b.files=a;c._onAdd(null,b)}):(b.files=a.makeArray(b.files),this._onAdd(null,b)))},send:function(b){if(b&&!this.options.disabled){if(b.fileInput&&!b.files){var c=this,d=a.Deferred(),m=d.promise(),l,n;m.abort=function(){n=!0;if(l)return l.abort();d.reject(null,"abort","abort");return m};this._getFileInputFiles(b.fileInput).always(function(a){n||
(a.length?(b.files=a,l=c._onSend(null,b).then(function(a,b,c){d.resolve(a,b,c)},function(a,b,c){d.reject(a,b,c)})):d.reject())});return this._enhancePromise(m)}b.files=a.makeArray(b.files);if(b.files.length)return this._onSend(null,b)}return this._getXHRPromise(!1,b&&b.context)}}});
(function(){function a(a){d=[];$.each(a,function(a,c){a=new b(c.token,c.name,{});var f=StatusBarManager.allocate(c.token,"task-status",c.detail_url?function(){c.detail_viewer&&(c.detail_viewer=eval(c.detail_viewer));bm.taskPopup(c.detail_url,c,{width:800,clazz:"task-popup "+c.name.sanitize()})}:null);a.fetchStatus();f.set(a.dom);a.statusBlock=f;a.progress.render();d[c.token]=a});return d}var b=function(a,b,d){this.token=a;this.name=b;this.statusBlock=d;this.dom=$("<span class='"+a+"'><label class='task-label'>"+
this.name+"</label><span class='task-progress-bar'></span></span>");this.progress=new ProgressBar(this.dom.find(".task-progress-bar"));this.progress.render()};b.prototype.fetchStatus=function(){var a=this,b=function(){bm.ajax({url:app.baseUrl+"task/progressCount",data:{token:a.token},success:function(c){a.progress.setPosition(c.done);100==c.done?(StatusBarManager.remove(a.token),delete d[a.token]):setTimeout(b,1E3)},error:function(){StatusBarManager.remove(a.token);delete d[a.token]}})};b()};var d=
[];window.TaskManager={init:function(){bm.ajax({url:app.baseUrl+"task/runningTasks",success:function(b){d=a(b)}})},createTask:function(a){var c=new b(a.token,a.name,{}),g=StatusBarManager.allocate(a.token,"task-status",a.detail_url?function(){bm.taskPopup(a.detail_url,a,{width:800,clazz:"task-popup "+a.name.sanitize()})}:null);c.fetchStatus();g.set(c.dom);c.statusBlock=g;return d[a.token]=c}}})();
$.extend(app,{global_event:$({}),ribbons:{web_design:[],web_content:[],web_commerce:[],web_marketing:[],administration:[],report:[]},root_layout:void 0,tabs:{},hook:{register:function(a,b){var d=site.registered_hooks[a];d||(d=site.registered_hooks[a]=[]);d.push(b)},fire:function(a,b,d){(a=site.registered_hooks[a])&&a.every(function(){b=this.apply(null,[b].concat(d))})}},navigation_item_ref_create_func:{}});
var ComponentManager=function(){var a,b,d={},c,f,g={click:function(a,b){b=b.attr("type");a=a.split(">");ComponentManager.openTab(ComponentManager.getRibbonData(app.ribbons[b],a[0]),null,a[1])},open:function(a){app.global_event.trigger("after-ribbon-render",[d[a.attr("type")]])}};return{getRibbonData:function(a,b){return a.find("this.ui_class == '"+b+"'")},showTabs:function(){var a=$(document.body);a.is(".dashboard-env")&&(a.replaceClass("dashboard-env","content-tabs-env"),c.css({left:"0"}))},showDashboard:function(){var a=
$(document.body);a.is(".content-tabs-env")&&(a.replaceClass("content-tabs-env","dashboard-env"),c.css({left:"100%"}),f.addClass("fade-in-up"),setTimeout(function(){f.removeClass("fade-in-up")},500))},openTab:function(a,b,d){var f=app.Tab.getTab("tab-"+a.ui_class);f?b?(f.setData(b),f.setActive()):d?(f.setActive(),b=app.Tab.changeView(f,a.ui_class.camelCase(!1),d,a.supers?a.supers[d]:void 0),a.processor=b.constructor):f.setActive():(f=a.processor,d&&(f=a.processor=a.processor._super.constructor[d],
a.supers&&(f._super.constructor.inherit(app[a.supers[d]]),f.inherit(f._super.constructor))),f=new f({id:"tab-"+a.ui_class}),f.render(b),f.on("close",function(){1==c.children().length&&ComponentManager.showDashboard()}),f.setActive());ComponentManager.showTabs()},init:function(){var m=$(".administrator");$("#top-component-bar");a=$(".top-component-bar .component");$("#status-bar");b=$("#workspace");var l=[{text:$.i18n.prop("visit.site"),ui_class:"visit-site",href:app.siteBaseUrl,target:"_blank"},{text:$.i18n.prop("help"),
ui_class:"help",href:"http://kb.webcommander.com/",target:"_blank"},{text:$.i18n.prop("my.account"),ui_class:"my-account",action:"my-account"},{text:$.i18n.prop("on.screen.help"),ui_class:"on-screen-help",action:"on-screen-help"},{text:$.i18n.prop("logout"),ui_class:"logout",href:app.baseUrl+"userAuthentication/logout"}],n=function(a,b,c){switch(a){case "on-screen-help":DashboardManager.onScreenHelp();break;case "my-account":ComponentManager.openTab({text:$.i18n.prop("my.account"),processor:app.tabs.myAccount,
ui_class:"my-account"});break;case "switch-instance":bm.ajax({controller:"dashboard",action:"instanceInfo",data:{instanceIdentity:c.instanceIdentity}}).done(function(a){bm.creteCookie("ckisession",a.ckisession);location.href=app.baseUrl+"userAuthentication/silentLogin?token="+a.token})}};bm.ajax({url:app.baseUrl+"user/getIsMatured",success:function(a){if(0==a.value)DashboardManager.onScreenHelp({getStart:function(a){setTimeout(function(){b.find(".getting-started-wizard").length&&b.find(".dashboard-toggle").trigger("click")},
a?a:3E3)}})}});var q=function(){bm.menu(l,m,null,n,"click",["right+13 bottom+5","right top"]).addClass("app-user-menu")};app.licenses?bm.ajax({controller:"dashboard",action:"allInstances"}).done(function(a){l.splice(l.length-1,0,{text:$.i18n.prop("switch.to"),ui_class:"disabled no-action-menu switch-to-instance"});a.every(function(){l.splice(l.length-1,0,{text:this.name,ui_class:"commander-instance "+(this.instanceIdentity==app.instanceIdentity?"current-instance disabled":""),action:"switch-instance",
data:this})});q()}):q();$("#status-bar .hotlink.settings").on("click",function(){var a={text:$.i18n.prop("settings"),processor:app.tabs.setting,ui_class:"settings"};ComponentManager.openTab(a)});DashboardManager.init();$.each(app.ribbons,function(b){var c=[];$.each(this,function(){var a={text:$.i18n.prop(this.text),ui_class:this.ui_class,data:this,license:this.license,permission:this.permission};this.views&&(a.sub=this.views);c.push(a)});var e=bm.menu(c,a.filter("[type='"+b+"']"),null,g,"click",["left bottom",
"left top+11"]);d[b]=e;e.addClass("ribbon-menu")});a.filter("[type='inst_plugin']").click(function(){bm.ajax({controller:"plugin",action:"installVisitorListing"}).done(function(){bm.notify("installed","success")})});a.filter(".dashboard").click(function(){ComponentManager.showDashboard()});c=b.children(".content-tabs-container");f=b.children(".dashboard-container")}}}();
$(function(){WizardManager().init(DashboardManager.postReportConfig);ComponentManager.init();app.global_event.on("operator-update",function(a,b){b==app.admin_id&&bm.ajax({url:app.baseUrl+"adminBase/loggedUserName",dataType:"html",success:function(a){$(".top-component-bar .admin-menu .user-name").html(a)}})});app.global_event.on("after-general-settings-update",function(a){bm.ajax({url:app.baseUrl+"adminBase/loadMaxPricePrecision",success:function(a){app.maxPricePrecision=a.maxPrecision}})});TaskManager.init();
$("#administrative-notification-wrapper").length&&DashboardManager.initializeAdministrativeNotification()});
var WizardManager=function(){var a=$("#workspace"),b={},d={},c,f=a.find(".dashlet-toggle-panel"),g=a.find(".getting-started-wizard");b.bindMiniHeader=function(){c.find(".wizard-tab-header .bmui-tab-header").each(function(a){$(this).append("<span class='step-icon'>"+(a+1)+"</span>")});g.addClass("wiz-mini-header")};b.unBindMiniHeader=function(){c.find(".wizard-tab-header .step-icon").remove();g.removeClass("wiz-mini-header")};d.activate=function(a){c.find(".bmui-tab-body-container .group-label").html(a.newTab.find(".title-block").html());
a=a.newPanel;a.children().length&&!a.find(".get-started-content").length&&(a.children().remove(),a.append(a.data("initialPanel")));b.unBindMiniHeader()};d.load=function(a){var c=a.panel;switch(a.index){case "storeDetails":b.storeDetails(c);break;case "email":b.email(c);break;case "product":b.product(c);break;case "page":b.page(c);break;case "design":b.design(c);break;case "tax":b.tax(c);break;case "shipping":b.shipping(c);break;case "paymentGateway":b.paymentGateway(c);break;case "launchStore":b.launchStore(c)}c.data("initialPanel",
c.find(".get-started-content"))};b.softDone=function(a){var b=c.obj().options,d=a?a:b.active;bm.ajax({url:app.baseUrl+"dashboard/softDone",data:{key:{storeDetails:"store_done",email:"email_done",product:"product_done",page:"page_done",design:"design_done",tax:"tax_done",shipping:"shipping_done",paymentGateway:"payment_done",launchStore:"launch_done"}[d]},success:function(a){a=c.find("[data-tabify-tab-id='"+d+"']");a.find(".tool-icon.done").length||(a.addClass("step-done"),a.append("<span class='tool-icon done'></span>"))}})};
b.attachForm=function(a,c,d){a.find(".get-started-content").detach();a.append(c);var f=$('<button type="button" class="cancel-button">'+$.i18n.prop("cancel")+"</button>"),e=c.find(".cancel-button");e.length?e.replaceWith(f):c.find(".submit-button").length?c.find(".submit-button").after(f):a.append($("<div class='button-line'></div>").append(f));f.on("click",function(){b.backToFront(a)});b.bindMiniHeader();c.is("form")&&(c.form({ajax:!0,preSubmit:function(e){$.extend(e,{success:function(){d&&d.success&&
d.success(c);b.softDone();b.backToFront(a)}});if(d&&d.preSubmit)return d.preSubmit(c)}}),f={inputClass:"medium"},a.is("#bmui-tab-launchStore")&&(f.stateLabel="state",f.stateName="billing.state"),bm.countryChange(c,f),bm.metaTagEditor(c.find("#bmui-tab-metatag")));c.updateUi()};b.backToFront=function(c){c.children().remove();c.append(c.data("initialPanel"));b.unBindMiniHeader();a.find(".dashboard-container").scrollTop(0)};b.storeDetails=function(a){a.find(".i-am-ready").on("click",function(){a.loader();
bm.ajax({url:app.baseUrl+"setting/loadStoreDetails",dataType:"html",complete:function(){a.loader(!1)},success:function(c){b.attachForm(a,$(c))}})})};b.email=function(a){a.find(".i-am-ready").on("click",function(){a.loader();bm.ajax({url:app.baseUrl+"setting/loadEmailForm",dataType:"html",complete:function(){a.loader(!1)},success:function(c){b.attachForm(a,$(c))}})})};b.product=function(a){a.find(".i-am-ready").on("click",function(){a.loader();bm.ajax({url:app.baseUrl+"productAdmin/loadProductProperties",
data:{isCombined:!1,target:"create",property:"basic"},dataType:"html",complete:function(){a.loader(!1)},success:function(c){b.attachForm(a,$(c))}})})};b.page=function(a){a.find(".i-am-ready").on("click",function(){a.loader();bm.ajax({url:app.baseUrl+"pageAdmin/edit",dataType:"html",complete:function(){a.loader(!1)},success:function(c){var d=app.tabs.page.prototype;c=$(c);d.editContentLoaded(c);b.attachForm(a,c,{preSubmit:function(a){return d.editFormBeforeSubmit(a)},success:function(a){d.editFormSuccess(a)}})}})})};
b.design=function(a){a.find(".i-am-ready").on("click",function(){a.loader();bm.ajax({url:app.baseUrl+"templateAdmin/reloadTemplate",data:{max:10,offset:0,wizard:!0},dataType:"html",complete:function(){a.loader(!1)},success:function(c){b.attachForm(a,$(c))}})})};b.tax=function(a){a.find(".i-am-ready").on("click",function(){a.loader();bm.ajax({url:app.baseUrl+"dashboard/loadReviewTax",dataType:"html",complete:function(){a.loader(!1)},success:function(c){b.attachForm(a,$(c))}})})};b.shipping=function(a){a.find(".i-am-ready").on("click",
function(){a.loader();bm.ajax({url:app.baseUrl+"shippingAdmin/loadRightShippingPanel",dataType:"html",complete:function(){a.loader(!1)},success:function(c){b.attachShipping(a,$(c))}})})};b.attachShipping=function(a,c){var d=a.find(".get-started-content"),f=$('<div class="button-line"><button type="button" class="save shipping-profile">'+$.i18n.prop("update")+'</button><button type="button" class="cancel-button">'+$.i18n.prop("cancel")+"</button></div>");c.append(f);f.find(".cancel-button").on("click",
function(){b.backToFront(a)});d.detach();a.append(c);c.addClass("right-panel");c.updateUi();b.bindMiniHeader();var e=$.extend({},app.tabs.shipping.prototype);e.body=a;e.attachRightPanel();f.find(".save").on("click",function(){e.saveShippingProfile(function(){b.softDone("shipping")})})};b.paymentGateway=function(a){a.find(".i-am-ready").on("click",function(){a.loader();bm.ajax({url:app.baseUrl+"paymentGateway/loadAppView",data:{wizard:!0},dataType:"html",complete:function(){a.loader(!1)},success:function(c){b.attachPaymentGateWay(a,
$(c))}})})};b.attachPaymentGateWay=function(a,c){var d=a.find(".get-started-content"),f=$('<div class="button-line"><button type="button" class="cancel-button">'+$.i18n.prop("cancel")+"</button></div>");c=c.add(f);f.on("click",".cancel-button",function(){b.backToFront(a)});d.detach();a.append(c);c.updateUi();b.bindMiniHeader();c={};var e=app.tabs.paymentGateway.prototype;c.init=function(){var b=this,c=this.tabulator=bm.table(a.find(".payment-gateway-table"),{url:app.baseUrl+"paymentGateway/loadAppView?wizard=true",
menu_entries:e.menu_entries,beforeReloadRequest:function(){$.extend(this.param,{wizard:!0});b.beforeReloadRequest(this.param)},afterLoad:function(){b.table.tscrollbar("content");b.afterTableReload&&b.afterTableReload()}});a.find(".toolbar-item.reload").on("click",function(){b.tabulator.reload()});c.body=a;c.clearDirty=function(){};c.createPanelTemplate=e.createPanelTemplate;c.renderCreatePanel=e.renderCreatePanel;c.configPaymentGateway=e.configPaymentGateway;c.onActionClick=e.onActionClick;b.beforeReloadRequest=
function(a){$.extend(a,{wizard:!0})};this.table=a.find(".payment-gateway-table table")};c.init()};b.launchStore=function(a){a.find(".i-am-ready").on("click",function(){a.loader();bm.ajax({url:app.baseUrl+"dashboard/loadPaymentForm",dataType:"html",complete:function(){a.loader(!1)},success:function(c){b.attachForm(a,$(c))}})})};b.initialize=function(){c=g.find(".bmui-tab").tabify(d);app.global_event.on("tax-profile-update tax-profile-deleted",function(a,c){1==c&&b.softDone("tax")})};return{init:function(c){if($(".get_started_wizard_passed").length){var d=
a.find(".favouriteReportChartOne, .favouriteReportChartTwo").addClass("no-record-chart");d.find(".chart-block").addClass("no-record-chart");var m=a.find(".dashlet-wrapper").addClass("wizard-env"),q=m.height();m.removeAttr("style");f.addClass("fade-in-up");b.initialize();a.find(".dashboard-toggle").click(function(){g.addClass("fade-in-up");var b=$(this).find(".title");a.find(".dashlet-toggle-panel, .getting-started-wizard").toggle();f.is(":visible")?(b.html($.i18n.prop("get.started")),m.removeClass("wizard-env").height(q),
b=d.find(".chart-block"),b.is(".no-record-chart")&&c&&(b.removeClass("no-record-chart"),c(d))):(m.addClass("wizard-env").removeAttr("style"),b.html($.i18n.prop("dashboard")))})}}}};
(function(){var a={},b=function(a,b,f){this.id=a;this.clazz=b;this.handler=f;this.render()};b.prototype.render=function(){var a=this.el=$("<span class='status-block'></span>");$("#status-bar").append(a);this.clazz&&a.addClass(this.clazz);this.handler&&a.click(this.handler)};b.prototype.set=function(a){this.el.html(a)};b.prototype.remove=function(){this.el.remove();delete a[this.id]};b.prototype.hide=function(){this.el.hide()};b.prototype.show=function(){this.el.show()};window.StatusBarManager={allocate:function(d,
c,f){return a[d]=new b(d,c,f)},get:function(b){return a[b]},set:function(b,c){a[b].set(c)},remove:function(b){(b=a[b])&&b.remove()},hide:function(b){a[b].hide()},show:function(b){a[b].show()}}})();app.widget={base:function(a){$.extend(this,a)}};var _w=app.widget.base.prototype;
_w.init=function(){function a(){b.confingPanel.slideUp(function(){c.removeClass("up").addClass("down")});$(document).off("mousedown.widget-config")}var b=this,d=function(){b.confingPanel.slideDown(function(){c.removeClass("down").addClass("up");$(document).on("mousedown.widget-config",function(c){b.confingPanel.isParentOf(c.target)||a()})})};b.confingPanel=this.content.find(".widget-config-panel").hide().on("invalid",function(){b.confingPanel.is(":hidden")&&d()});var c=b.content.find(".configure-btn").addClass("down").click(function(){b.confingPanel.is(":hidden")?
d():a()})};_w.getParams=function(){return this.confingPanel?JSON.stringify(this.confingPanel.serializeObject()):""};_w.updateCacheForShortConfig=function(a,b,d,c){a=JSON.parse(a);if(a.params){var f=JSON.parse(a.params);$.extend(f,b)}else f=b;d&&(b=f[d],a.widgetContent=[],delete f[d],b&&($.isArray(b)||(b=[b]),b.every(function(b){a.widgetContent[b]={widget:{sid:a.sid},type:c,contentId:+this}})));a.params=JSON.stringify(f);return JSON.stringify(a)};app.widget.breadcrumb=function(){};
app.widget.breadcrumb.no_config=!0;
(function(){var a=0;window.WCUIWidget=function(){};WCUIWidget.prototype={_createWidget:function(b,d){this.element=$(d);this.uuid=a++;this.eventNamespace="."+this.widgetName+this.uuid;this.bindings=$();this.hoverable=$();this.focusable=$();this.options=$.extend({},this.options,this._getCreateOptions(),b);this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();
this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(a,d){var b=a,f;if(0===arguments.length)return $.widget.extend({},
this.options);if("string"===typeof a){b={};var g=a.split(".");a=g.shift();if(g.length){var m=b[a]=$.widget.extend({},this.options[a]);for(f=0;f<g.length-1;f++)m[g[f]]=m[g[f]]||{},m=m[g[f]];a=g.pop();if(1===arguments.length)return void 0===m[a]?null:m[a];m[a]=d}else{if(1===arguments.length)return void 0===this.options[a]?null:this.options[a];b[a]=d}}this._setOptions(b);return this},_setOptions:function(a){for(var b in a)this._setOption(b,a[b]);return this},_setOption:function(a,d){this.options[a]=
d;"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!d),d&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")));return this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(a,d,c){var b,g=this;"boolean"!==typeof a&&(c=d,d=a,a=!1);c?(d=b=$(d),this.bindings=this.bindings.add(d)):(c=d,d=this.element,b=this.widget());$.each(c,function(c,f){function l(){if(a||
!0!==g.options.disabled&&!$(this).hasClass("ui-state-disabled"))return("string"===typeof f?g[f]:f).apply(g,arguments)}"string"!==typeof f&&(l.guid=f.guid=f.guid||l.guid||$.guid++);var m=c.match(/^([\w:-]*)\s*(.*)$/);c=m[1]+g.eventNamespace;(m=m[2])?b.delegate(m,c,l):d.bind(c,l)})},_off:function(a,d){d=(d||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;a.unbind(d).undelegate(d);this.bindings=$(this.bindings.not(a).get());this.focusable=$(this.focusable.not(a).get());this.hoverable=
$(this.hoverable.not(a).get())},_delay:function(a,d){var b=this;return setTimeout(function(){return("string"===typeof a?b[a]:a).apply(b,arguments)},d||0)},_hoverable:function(a){this.hoverable=this.hoverable.add(a);this._on(a,{mouseenter:function(a){$(a.currentTarget).addClass("ui-state-hover")},mouseleave:function(a){$(a.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(a){this.focusable=this.focusable.add(a);this._on(a,{focusin:function(a){$(a.currentTarget).addClass("ui-state-focus")},
focusout:function(a){$(a.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(a,d,c){var b,g=this.options[a];c=c||{};d=$.Event(d);d.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase();d.target=this.element[0];if(a=d.originalEvent)for(b in a)b in d||(d[b]=a[b]);this.element.trigger(d,c);return!($.isFunction(g)&&!1===g.apply(this.element[0],[d].concat(c))||d.isDefaultPrevented())}}})();
(function(){function a(a){var b=this;this.uuid=bm.getUUID();this.input=a;this.clazz=a.attr("class");if(this.auto="auto"==a.attr("submit"))this.submit_url=this.input.attr("ajax-url"),this.submit_data=this.input.attr("submit-data");(this.form=this.auto?null:this.input.closest("form"))&&!this.form.length&&(this.form=null);this.input.addClass("masked-file-input");this.wrapper=$("<div class='dropzone-wrapper'></div>");this.clazz&&this.wrapper.addClass(this.clazz);this.input.after(this.wrapper);if(window.FormData)this.dropZone=
$("<div class='dropzone'><span class='dropzone-text'></span></div>"),this.dropZone.find(".dropzone-text").text(this.dropText),this.wrapper.append(this.dropZone);else{this.dropZone=$("<button type='button' class='fake-file-chooser'></button>").text(this.chooserText);this.dropZone.wrap("<span class='input-wrapper-false-mask' style='display: inline-block;'></span>");this.wrapper.append(this.dropZone);this.dropZone.after(a);var c=a.width();this.dropZone.on("mousemove",function(b){a.offset({left:b.pageX-
c+5,top:b.pageY-5})});a.parent().width(this.dropZone.outerWidth()).height(this.dropZone.outerHeight());this.dropZone.off("click")}var e=this.input.attr("clazz");e&&this.dropZone.addClass(e);this.dropZone.click(function(){b.isDisabled||a.trigger("click")});if(e=a.attr("size-limit"))this.size_limit=+e;a.is("[validation]")&&!a.is("[error-on]")&&(e=bm.getUUID(),this.wrapper.attr("id",e),a.attr("error-on",e));this.initializeDrop()}function b(){}function d(b){var c=this;a.apply(this,arguments);if(this.viewer=
this.input.attr("previewer")){this.remove="true"==this.input.attr("remove-support");var e=this.input.attr("reset-support");this.reset=e?"true"==e:this.remove;this.viewer=this.input.parent().find("#"+this.viewer).length?this.input.parent().find("#"+this.viewer):$("#"+this.viewer);this.wrapper.addClass("single-file-with-preview")}else this.wrapper.addClass("single-file-without-preview"),"no"!==this.input.attr("text-helper")&&(this.fakeText=$("<input type='text' class='fake-chooser-text' readonly>"),
this.wrapper.append(this.fakeText));this.viewer&&(this.resetUrl=this.viewer?this.viewer.attr("src"):null,this.initializeResets());if(this.auto){if("false"!=b.attr("enable-remove-after-submit"))b.one("file-submit",function(a,b){b.resetUrl&&c.enableRemove()});if("true"==b.attr("reset-after-submit"))b.on("file-submit",function(){c.input.reset()})}}function c(a){this.fileType="video";this.dropText=a.attr("drop-text")||$.i18n.prop("drop.video.or.click");this.chooserText=a.attr("chooser-text")||$.i18n.prop("choose.video");
d.apply(this,arguments)}function f(a){this.fileType="image";this.dropText=a.attr("drop-text")||$.i18n.prop("drop.image.or.click");this.chooserText=a.attr("chooser-text")||$.i18n.prop("choose.image");d.apply(this,arguments)}function g(a){this.dropText=a.attr("drop-text")||$.i18n.prop("drop.file.or.click");this.chooserText=a.attr("chooser-text")||$.i18n.prop("choose.file");this.fileType=a.attr("file-type");d.apply(this,arguments)}function m(){a.apply(this,arguments);this.queue=this.form.find("#"+this.input.attr("queue"));
this.wrapper.addClass("multiple-file")}function l(a){this.fileType="video";this.dropText=a.attr("drop-text")||$.i18n.prop("drop.videos.or.click");m.apply(this,arguments)}function n(a){this.fileType="image";this.dropText=a.attr("drop-text")||$.i18n.prop("drop.images.or.click");this.chooserText=a.attr("chooser-text")||$.i18n.prop("choose.image");m.apply(this,arguments)}function q(a){this.dropText=a.attr("drop-text")||$.i18n.prop("drop.files.or.click");this.fileType=a.attr("file-type");m.apply(this,
arguments)}$.prototype.updateUi=function(){this.find("select:not([multiple], .raw), div.wcui-select.chosen").chosen();var a=this.find("select[multiple]:not(.raw)");a.not(".special-select-chosen").chosen();a.filter(".special-select-chosen").each(function(){var a=$(this);a.multispecialchosen(a.config("chosen"))});this.find("div.multitxtchosen").multitxtchosen({type:"multi"});this.find("input.multitxtchosen").multitxtchosen({type:"csv"});this.find("input.spinner").each(function(){var a=$(this),b={min:a.attr("min"),
max:a.attr("max")};a.trigger("onStepperBind",[b]);a.stepper(b)});this.find("paginator").paginator({next:$.i18n.prop("next"),prev:$.i18n.prop("prev"),first:"<<",last:">>"});this.find(".bmui-tab:not(.alone)").tabify({loader_template:"<span class='vertical-aligner'></span><span class='loader'></span>"});this.find("textarea.wceditor").each(function(){var a=$(this),b={callbacks:{focus:function(){var b=a.data("validator-filed-inst");b&&b.clear()},blur:function(){var b=a.data("validator-filed-inst");b&&
b.validate()},change:function(){a.trigger("change")}},imageUpload:app.baseUrl+"app/uploadWceditorImage?type=redactor",imageManagerJson:app.baseUrl+"app/wceditorImages",fileUpload:app.baseUrl+"app/uploadWceditorFile?type=redactor",fileManagerJson:app.baseUrl+"app/wceditorFiles",plugins:"fontcolor fontsize alignment inlinestyle properties table fullscreen video imagemanager definedlinks clips limiter textdirection filemanager".split(" ")};"super_simple"==a.attr("toolbar-type")?(b.plugins=["inlinestyle",
"definedlinks","limiter"],b.buttons=["format","inlinestyle","bold","italic","link"]):"simple"==a.attr("toolbar-type")&&(b.plugins="fontcolor fontsize alignment table video imagemanager definedlinks limiter filemanager properties fullscreen textdirection inlinestyle".split(" "),b.buttons="html format bold italic deleted lists image file link".split(" "));a.redactor(b)});this.find(".accordion-panel").accordion();this.find(".datefield-between").each(function(){var a=$(this);a.find(".datefield-from").date({direction:void 0,
show_select_today:!1,lang_clear_date:$.i18n.prop("clear"),pair:a.find(".datefield-to").date({direction:!0,show_select_today:!1,lang_clear_date:$.i18n.prop("clear")})})});this.find(".timefield-between").each(function(){var a=$(this);a.find(".timefield-from").date({direction:void 0,show_select_today:!1,lang_clear_date:$.i18n.prop("clear"),pair:a.find(".timefield-to").date({direction:!0,show_select_today:!1,lang_clear_date:$.i18n.prop("clear"),time:"HH:mm:ss"}),time:"HH:mm:ss"})});this.find(".datefield").each(function(){var a=
$(this);a.date({direction:a.attr("no-previous")?!0:a.attr("no-next")?!1:void 0,show_select_today:!1,lang_clear_date:$.i18n.prop("clear")})});this.find(".timefield").each(function(){var a=$(this);a.date({direction:a.attr("no-previous")?!0:a.attr("no-next")?!1:void 0,show_select_today:!1,lang_clear_date:$.i18n.prop("clear"),time:"HH:mm:ss"})});this.find("input[type='file']").file();this.find("input:checkbox").checkbox();this.find("input:radio").radio();app.is_front_end||this.find('[title][title!=""]').tooltipster({contentAsHTML:!0});
bm.cBaseDoc(this.find(".context-documentation"));this.find(".chart-block").chart();this.find("textarea, .redactor-layer").on("mousewheel",function(a,b){var c=$(this),e=c.scrollTop(),d=this.scrollHeight,f=c.innerHeight();c.scrollTop(e-40*b);e=c.scrollTop();0!=e&&e+f<d&&(a.originalEvent.ignoreSroll=!0)});return this};var e={state:function(a){if(a)switch(a){case "checked":1!=this.state&&p.state.call(this,1);break;case "unchecked":4!=this.state&&p.state.call(this,4);break;case "partial":if(1==this.state||
4==this.state)1==this.state?p.state.call(this,2):4==this.state?p.state.call(this,3):""}else return 1==this.state?"checked":4==this.state?"unchecked":"partial"},enable:function(a){a?(this.el.removeAttr("disabled","disabled"),this.removeClass("disabled")):(this.addClass("disabled"),this.el.attr("disabled","disabled"))}},p={state:function(a){this.removeClass("checked partial unchecked");switch(a){case 1:this.el[0].checked=!0;this.addClass("checked");break;case 2:case 3:this.addClass("partial");break;
case 4:this.el[0].checked=!1,this.addClass("unchecked")}this.state=a}},t=$.prototype.prop;$.prototype.prop=function(a,b){return"checked"==a&&void 0!=b?this.each(function(){var c=$(this),d=c.data("wcui-checkbox");d?e.state.call(d,b?"checked":!1===b?"unchecked":void 0):t.apply(c,[a,b])}):t.apply(this,arguments)};$.prototype.checkbox=function(a){if(!this.length||$(this).hasClass("skip-wcui"))return this;if(a){var b,c=Array.prototype.splice.call(arguments,1);this.each(function(){var d=$(this).data("wcui-checkbox");
if(!d)throw $.error(a+" is being called before initialization");b=e[a].apply(d,c);return void 0==b});return void 0==b?this:b}return this.each(function(){var a=$(this);if("none"!=a.css("display")){var b=a.data("wcui-checkbox");if(!b){var c="";a.is(".single")?c="single":a.is(".multiple")&&(c="multiple");c=$("<span class='wcui-checkbox "+c+"'></span>");b=$.extend({},{el:a},c);a.data("wcui-checkbox",b);a.after(c).hide();a.is("[disabled]")&&c.addClass("disabled");a.is("[title]")&&c.attr("title",a.attr("title"));
this.checked?p.state.call(b,1):p.state.call(b,4);c.bind("click",function(){if(!a.is("[disabled]")){switch(b.state){case 1:p.state.call(b,4);break;case 2:p.state.call(b,4);break;case 3:p.state.call(b,1);break;case 4:p.state.call(b,1)}a.triggerWithPropagation("change")}})}}})};var w={state:function(a){this.removeClass("checked unchecked");switch(a){case 1:this.el[0].checked=!0;this.addClass("checked");break;case 2:this.addClass("unchecked")}this.state=a},clear_others:function(){var a=this.group;a&&
$.each(a,function(){if(this.el[0].checked)return w.state.call(this.el.data("wcui-radio"),2),!1})}},y={check:function(){1!=this.state&&(w.clear_others.call(this),w.state.call(this,1))},val:function(a){var b=this.group;if("undefined"!=typeof a){var c;$.each(b||[this],function(){if(this.el.val()==a)return c=this,!1});if(!c)return!1;y.check.call(c);return!0}var e;$.each(b||[this],function(){if(this.el[0].checked)return e=this.el.val(),!1});return e},state:w.state};$.prototype.radio=function(a){if(!this.length)return this;
if(a){var b,c=Array.prototype.splice.call(arguments,1);this.each(function(){var e=$(this).data("wcui-radio");if(!e)throw $.error(a+" is being called before initialization");b=y[a].apply(e,c);return void 0==b});return void 0==b?this:b}var e={};return this.each(function(){var a=$(this),b=a.data("wcui-radio");if(!b){var c=$("<span class='wcui-radio'></span>");"none"==a.css("display")&&c.hide();var d=a.attr("name");b=$.extend({},{el:a},c);if(d){var f=e[d];f||(f=[],e[d]=f);b.group=f;f.push(b)}a.data("wcui-radio",
b);a.after(c).hide();a.is("[disabled]")&&c.addClass("disabled");this.checked?w.state.call(b,1):w.state.call(b,2);c.bind("click",function(){1==b.state||a.is("[disabled]")||(y.check.call(b),a.triggerWithPropagation("change"))})}})};a.prototype.preAdd=function(){};a.prototype.onAdd=function(){};a.prototype.onVerifyError=function(){};a.prototype.resetFile=function(){};a.prototype.initializeDrop=function(){var a,b=this;this.dropZone.fileupload({dropZone:this.dropZone,fileInput:this.input,pasteZone:null,
replaceFileInput:!1,dataType:"json",autoUpload:!1,add:function(c,e){if(c.delegatedEvent.timeStamp!=a){b.preAdd(e);var d=!1;$.each(e.originalFiles,function(){b.verify(this)&&(d=!0,b.onAdd(c,this),b.input.trigger("file-add",[this]),b.auto&&(b.isDisabled=!0,$(b.dropZone).fileupload("send",{files:[this],formData:{id:b.submit_data},url:b.submit_url,success:function(a){b.isDisabled=!1;a.resetUrl&&(b.resetUrl=a.resetUrl);b.input.trigger("file-submit",[a])},error:function(){b.isDisabled=!1;b.reset=!1;b.resetFile()}}),
b.remove="true"==b.input.attr("remove-support")))});"drop"==c.delegatedEvent.type&&d&&b.input.trigger("change",e);a=c.delegatedEvent.timeStamp}},dragenter:function(){b.dropZone.addClass("drag-over")},dragleave:function(){b.dropZone.removeClass("drag-over")},drop:function(){b.dropZone.removeClass("drag-over")}})};a.prototype.verify=function(a){var b=null;if(window.File){this.size_limit&&a.size>this.size_limit&&(b=$.i18n.prop("size.limit.exceeded",[this.size_limit.toByteNotation()]));var c=a.type?a.type:
a.name.substring(a.name.lastIndexOf(".")+1,a.name.length);!b&&this.fileType&&((new RegExp(this.fileType)).test(c)||(b=$.i18n.prop("file.type.unsupported")));if(b&&!1===this.onVerifyError(b,a))return!1}return b?!1:!0};a.prototype.cacheFile=function(a){a={name:this.input.attr("name"),value:a};a.value.formData=a;if(this.form){var b=this.caches;b||(b=this.caches=[]);b.push(a);(b=this.form.data("form-extra-data"))||this.form.data("form-extra-data",b=[]);b.push(a)}};a.prototype.updateCache=function(a){this.caches&&
this.removeCache();this.cacheFile(a)};a.prototype.removeCache=function(a){if(this.form){var b=this.form.data("form-extra-data");b&&(a?(b.remove(a),this.caches.remove(a)):(this.caches.every(function(){b.remove(this)}),this.caches=[]))}};b.prototype.preview=function(a,b){if(window.FileReader){var c=new FileReader;c.onload=function(a){b.attr("src",a.target.result)};c.readAsDataURL(a)}};d.inherit(a);d.prototype.initializeResets=function(){var a=this;this.removeButton=$("<span class='tool-icon remove image-remove'></span>");
this.remove||this.removeButton.hide();this.viewer.after(this.removeButton);this.removeCheck=$("<input type='checkbox' class='single' value='yes'>");this.removeCheck.attr("name",this.input.attr("remove-option-name"));this.wrapper.prepend(this.removeCheck.hide());this.removeButton.on("click",function(){a.removeFile()});this.reset&&(a=this,this.resetUrl=this.viewer?this.viewer.attr("src"):null,this.resetButton=$("<span class='tool-icon reset image-reset'></span>").hide(),this.remove?this.removeButton.after(this.resetButton):
this.viewer.after(this.resetButton),this.resetButton.on("click",function(){a.resetFile()}))};d.prototype.clearFile=function(a){this.wrapper.hasClass("file-added")&&(!1!==a&&this.input.reset(),this.fakeText&&this.fakeText.val(""),this.removeCache(),this.wrapper.removeClass("file-added"))};d.prototype.enableReset=function(){this.reset&&this.resetButton.show()};d.prototype.enableRemove=function(){this.remove&&this.removeButton.show()};d.prototype.removeFile=function(){var a=this;this.viewer.hide();this.removeButton.hide();
this.removeCheck[0].checked=!0;this.clearFile();this.input.trigger("file-remove");this.enableReset();this.auto&&(this.disabled=!0,bm.ajax({url:app.baseUrl+this.submit_url,data:{id:this.submit_data,"remove-image":"true"},success:function(){a.resetUrl=""},error:function(){a.resetFile()},complete:function(){a.disabled=!1}}))};d.prototype.preAdd=function(){a.prototype.preAdd.apply(this,arguments);this.clearFile(!1)};d.prototype.onAdd=function(b,c){a.prototype.onAdd.apply(this,arguments);this.wrapper.addClass("file-added");
this.fakeText&&this.fakeText.val(c.name);"drop"==b.delegatedEvent.type&&(this.updateCache(c),this.input.reset());this.enableRemove()};d.prototype.onVerifyError=function(b){a.prototype.onVerifyError.apply(this,arguments);bm.notify(b,"alert");this.input.reset();this.input.trigger("file-reset");return!1};d.prototype.resetFile=function(){this.removeCheck[0].checked=!1;this.enableRemove();this.clearFile();this.input.trigger("file-reset");this.reset&&this.resetButton.hide()};c.inherit(d);f.inherit(d,b);
f.prototype.onVerifyError=function(a){d.prototype.onVerifyError.apply(this,arguments);this.reset&&this.resetFile();return!1};f.prototype.resetFile=function(){this.resetUrl?(this.viewer.show(),this.viewer[0].src=this.resetUrl):this.viewer.hide();d.prototype.resetFile.apply(this,arguments)};f.prototype.onAdd=function(a,b){d.prototype.onAdd.apply(this,arguments);this.viewer.show();this.preview(b,this.viewer);this.enableReset()};g.inherit(d);g.prototype.onAdd=function(a,b){d.prototype.onAdd.apply(this,
arguments);if(this.viewer){this.viewer.show();var c;this.viewer.attr("class").split(" ").every(function(){if(this.startsWith("type-"))return c=this,!1});this.viewer.removeClass(""+c).addClass("type-"+bm.fileExtension(b.name));this.enableReset()}};g.prototype.resetFile=function(){if(this.resetUrl){this.viewer.show();var a;this.viewer.attr("class").split(" ").every(function(){if(this.startsWith("type-"))return a=this,!1});this.viewer.removeClass(""+a).addClass("type-"+bm.fileExtension(this.resetUrl));
this.viewer.attr("src",this.resetUrl)}else this.viewer&&this.viewer.hide();d.prototype.resetFile.apply(this,arguments)};m.inherit(a);m.prototype.onVerifyError=function(b,c){a.prototype.onVerifyError.apply(this,arguments);var e=$("<div class='file-selection-queue error-queue'><span class='file-name'></span><span class='tool-icon remove file-remove'></span></div>");e.find(".file-name").text(b+" : ("+c.name+")");this.initializeQueue(e,c)};m.prototype.preAdd=function(){a.prototype.preAdd.apply(this,arguments);
this.input.reset()};m.prototype.onAdd=function(b,c){a.prototype.onAdd.apply(this,arguments);var e=$("<div class='file-selection-queue'><span class='file-name'></span><span class='tool-icon remove file-remove'></span></div>");e.find(".file-name").text(c.name+"  ("+c.size.toByteNotation()+")");this.cacheFile(c);this.initializeQueue(e,c);return e};m.prototype.initializeQueue=function(a,b){var c=this;a.data("file",b);this.queue.append(a);a.find(".file-remove").click(function(){a.remove();b.formData&&
c.removeCache(b.formData)})};l.inherit(m);n.inherit(m,b);n.prototype.onAdd=function(a,b){var c=m.prototype.onAdd.apply(this,arguments),e=$("<img class='queue-image-preview'>");c.prepend(e);this.preview(b,e)};q.inherit(m);$.prototype.file=function(){if(!this.length)return this;this.each(function(){var a=$(this),b=a.attr("file-type"),e=a.attr("multiple");"image"==b?e?new n(a):new f(a):"video"==b?e?new l(a):new c(a):e?new q(a):new g(a)})};var A=["151,205,187","151,187,205","205,151,187"];$.prototype.chart=
function(a,b){this.length&&this.each(function(){var c=$(this);if(!c.is(".no-record-chart")){if(a){var e=c.data("wcui-chart");c.html("<canvas></canvas>");var d=c.children()[0].getContext("2d"),f=b.capitalize();d=(new Chart(d))[f](e.data,e.options)}else{f=c.children();c.html("<canvas></canvas>");d=c.children()[0].getContext("2d");var g=$.extend([],{labels:[],datasets:[]}),l=f.filter("label").each(function(){g.labels.push($(this).text())}).length;e=f.filter("div.dataset");var m=e.length,n=f.filter("div.data");
e.each(function(a){var b=A[a],c=[];g.datasets.push({label:$(this).text(),fillColor:"rgba("+b+",0.2)",strokeColor:"rgba("+b+",1)",pointColor:"rgba("+b+",1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba("+b+",1)",data:c});for(b=0;b<l;b++)c[b]=+n.eq(b*m+a).text();if(1==m)for(b=0;b<l;b++){a=Math.floor(210*Math.random()+20);var e=Math.floor(210*Math.random()+20),d=Math.floor(210*Math.random()+20);g.push({value:c[b],color:"rgba("+a+","+e+","+d+",1)",highlight:"rgba("+(a+
10)+","+(e+10)+","+(d+10)+",1)",label:g.labels[b]})}});e={responsive:!0,multiTooltipTemplate:"<%if (datasetLabel){%><%=datasetLabel%>: <%}%> <%= value %>",maintainAspectRatio:!1};f=c.attr("chart-type").capitalize();d=(new Chart(d))[f](g,e);c.data("wcui-chart",{data:g,options:e})}if("Pie"==f||"Doughnut"==f)d=d.generateLegend(),c.append(d)}})};$.prototype.scrollTo=function(a,b,c){if(a){"function"==typeof b&&2==arguments.length&&(c=b,b=a);var e=$.extend({scrollTarget:a,offsetTop:50,duration:500,easing:"swing"},
b),d=e.scrollTarget;return this.each(function(){var a=$(this),b="number"==typeof d?d:d.offset().top+a.scrollTop()-parseInt(e.offsetTop);a.animate({scrollTop:b},parseInt(e.duration),e.easing,function(){"function"==typeof c&&c.call(this)})})}};$.prototype.refreshTooltip=function(a){this.is(".tooltipstered")&&this.tooltipster("destroy").attr("title",$.i18n.prop(a)).tooltipster();return this}})();$.paginator_config={el:void 0,onPageClick:void 0,next:"",prev:"",first:"",last:""};
var Paginator=function(a,b){this.showPages=7;a=$(a);$.extend(this,$.paginator_config,b);b=parseInt(a.attr("total"),10);b=0<b?b:0;var d=parseInt(a.attr("max"),10),c=parseInt(a.attr("offset"),10);c=Math.floor((0<c?c:0)/d)+1;var f=a.attr("pages");f&&(this.showPages=parseInt(f,10));this.el=$("<span></span>");this.el.attr("class",a.attr("class"));a.replaceWith(this.el);this.el.addClass(this.className||"pagination");this.el.data(a.data());this.el.data("wcui-pagination",this);this.update(b,d,c)},_p=Paginator.prototype;
(function(){function a(b){this.el.empty();if(!1!==this.first){var d=$('<span page="1" class="first '+(1==this.currentPage?"disabled":"")+'"></span>');d.text(this.first);this.el.append(d)}if(!1!==this.prev){var c=$('<span page="'+(this.currentPage-1)+'" class="prev '+(1==this.currentPage?"disabled":"")+'"></span>');c.text(this.prev);this.el.append(c)}b||(this.currentPage<this.startpage&&(this.startpage=this.currentPage,this.endpage=this.startpage+this.showPages-1),this.currentPage>this.endpage&&(this.endpage=
this.currentPage,this.startpage=this.endpage-this.showPages+1));1!=this.startpage&&this.el.append('<span class="prev-more" page="prev-pages">...</span>');for(b=this.startpage;b<=this.endpage;b++)b==this.currentPage?this.el.append('<span page="'+b+'" class="page-number current">'+b+"</span>"):this.el.append('<span page="'+b+'" class="page-number">'+b+"</span>");this.endpage!=this.pageCount&&this.el.append('<span class="next-more" page="next-pages">...</span>');if(!1!==this.next){var f=$('<span page="'+
(this.currentPage+1)+'" class="next '+(this.currentPage==this.pageCount?"disabled":"")+'"></span>');f.text(this.next);this.el.append(f)}if(!1!==this.last){var g=$('<span page="'+this.pageCount+'" class="last '+(this.currentPage==this.pageCount?"disabled":"")+'"></span>');g.text(this.last);this.el.append(g)}this.el.find("span").click(this,function(b){if(!$(this).hasClass("current")&&!$(this).hasClass("disabled")){b=b.data;var l=$(this).attr("page");if("prev-pages"==l)b.startpage=b.startpage>b.showPages?
b.startpage-b.showPages:1,b.endpage=b.pageCount<b.showPages+1?b.pageCount:b.startpage+(b.showPages-1),a.call(b,!0);else if("next-pages"==l)b.startpage=b.startpage+(b.showPages-1)<b.pageCount?b.startpage+b.showPages:b.startpage,b.startpage=b.startpage+(b.showPages-1)>b.pageCount?b.pageCount-(b.showPages-1):b.startpage,b.endpage=b.pageCount<b.showPages+1?b.pageCount:b.startpage+(b.showPages-1),a.call(b,!0);else{l=parseInt(l,10);b.currentPage=l;if($(this).hasClass("page-number")){$(this).siblings(".current").removeClass("current");
$(this).addClass("current");f&&(f[(l==b.pageCount?"add":"remove")+"Class"]("disabled"),f.attr("page",""+(b.currentPage+1)));if(g)g[(l==b.pageCount?"add":"remove")+"Class"]("disabled");c&&(c[(1==l?"add":"remove")+"Class"]("disabled"),c.attr("page",""+(b.currentPage-1)));if(d)d[(1==l?"add":"remove")+"Class"]("disabled")}else a.call(b);b.onPageClick&&b.onPageClick.call(b.el,l)}}})}_p.update=function(b,d,c){var f=this.el;"number"==typeof b&&(this.total=0<b?b:0);"number"==typeof d&&(this.all=-1==d,this.itemsPerPage=
1<d?d:-1==d?this.total:1);this.pageCount=this.all?0==this.total?0:1:Math.ceil(this.total/this.itemsPerPage);this.currentPage="number"==typeof c?1<c?c<=this.pageCount?c:this.pageCount:1:1<this.currentPage?this.currentPage<=this.pageCount?this.currentPage:this.pageCount:1;2>this.pageCount?f.empty():(b=Math.ceil(this.showPages/2),this.startpage=c>b&&this.pageCount>this.showPages?c-(b-1):1,this.startpage=this.startpage+(this.showPages-1)>this.pageCount&&1!=this.startpage?this.pageCount-(this.showPages-
1):this.startpage,this.endpage=this.pageCount<this.showPages+1?this.pageCount:this.startpage+(this.showPages-1),a.call(this))}})();_p.getPageCount=function(){return this.pageCount};_p.getCurrentPage=function(){return this.currentPage};_p.setCurrentPage=function(a,b){"undefined"!=typeof a&&(1>a&&(a=1),this.currentPage!=a||b)&&(this.update(void 0,void 0,a),this.onPageClick.call(this.el,this.currentPage))};_p.getTotal=function(){return this.total};
_p.setTotal=function(a){"undefined"!=typeof a&&this.update(a,void 0,void 0)};_p.getItemsPerPage=function(){return this.itemsPerPage};_p.setItemsPerPage=function(a){"undefined"!=typeof a&&this.update(void 0,a,void 0)};$.prototype.paginator=function(a){return this.length?this.each(function(){new Paginator(this,a)}):this};
var ACCORDION_DEFAULTS={multiple:!1,all_close:!1},Accordion=function(a,b){this.container=a;a.addClass("accordion-panel");this.options=$.extend({},ACCORDION_DEFAULTS,b);var d=this;a.find(".label-bar").click(function(){var a=$(this),b=$.Event("beforeexpand");d.container.trigger(b,[d.container.find(".accordion-item.expanded"),a.next()]);b.isDefaultPrevented()||(d.options.all_close&&a.hasClass("expanded")?d.collapse(a):d.expand(a))}).each(function(){d.collapse($(this),!0)});$.each(b.expanded||[],function(){a.find(".label-bar").eq(+this-
1).trigger("click")});this.options.all_close||a.find(".label-bar.expanded").length||d.expand(a.find(".label-bar:first"))},childAccordion=function(a,b){this.container=a;a.addClass("accordion-panel");this.options=$.extend(!0,{},ACCORDION_DEFAULTS,b);var d=this;a.find(".child.label-bar").click(function(){var a=$(this),b=$.Event("beforeexpand");d.container.trigger(b,[d.container.find(".accordion-item.expanded"),a.next()]);b.isDefaultPrevented()||(d.options.all_close&&a.hasClass("expanded")?d.collapse(a):
d.expand(a))}).each(function(){d.collapse($(this),!0)});$.each(b.expanded||[],function(){a.find(".child.label-bar").eq(+this-1).trigger("click")});this.options.all_close||a.find(".child.label-bar.expanded").length||d.expand(a.find(".child.label-bar:first"))};
(function(){$.extend(Accordion.prototype,{collapse:function(a,b){if(!a.hasClass("expanded")||b||this.options.all_close||1!=this.container.find(".label-bar.expanded").length)a.removeClass("expanded").addClass("collapsed"),a.next().removeClass("expanded").addClass("collapsed"),bm.trigger(this,this.container,"accordion","collapse",[this.container.find(".accordion-item.expanded"),a.next()])},expand:function(a,b){if(!this.options.multiple){var d=this.container.find(".label-bar.expanded");d.length&&this.collapse(d,
!0)}a=this.bar(a);a.removeClass("collapsed").addClass("expanded");a.next().removeClass("collapsed").addClass("expanded");if(a.attr("item-url")&&!a.data("load")){this.container.trigger("start-load",[a.next()]);var c=this;d=a.attr("item-url");bm.ajax({url:app.baseUrl+d,dataType:"html",data:b?b.params:{},success:function(d){a.next().html(d);a.data("load","done");b&&b.success instanceof Function&&b.success(d);c.container.trigger("load",[a.next()]);bm.trigger(c,c.container,"accordion","load",[c.container.find(".accordion-item.expanded"),
a.next()])},error:function(d,g,m){b&&b.error instanceof Function&&b.error(d,g,m);c.container.trigger("error",[a.next(),d,g,m])}})}bm.trigger(this,this.container,"accordion","expand",[this.container.find(".accordion-item.expanded"),a.next()])},current:function(){return this.container.find(".accordion-item.expanded")},item:function(a){var b=a.closest(".label-bar",this.container);return b.length?b.next():a.closest(".accordion-item",this.container)},next:function(a){return a.is(".accordion-item")?a.next().next():
this.current().next().next()},bar:function(a){if(a instanceof Number||"number"==typeof a)a=this.container.find(".label-bar:eq('"+a+"')");else if(a instanceof String||"string"==typeof a)a=this.container.find(".label-bar."+a);a.is(".accordion-item")&&(a=a.prev());return a},clearState:function(a){if(a=this.item(a))a.html(""),a.prev().removeData("load")},reload:function(a,b){a=this.bar(a);this.clearState(a);this.expand(a,b)}});$.extend(childAccordion.prototype,{collapse:function(a,b){if(!a.hasClass("expanded")||
b||this.options.all_close||1!=this.container.find(".child.label-bar.expanded").length)a.removeClass("expanded").addClass("collapsed"),a.next().removeClass("expanded").addClass("collapsed"),bm.trigger(this,this.container,"childAccordion","collapse",[this.container.find(".accordion-item.expanded"),a.next()])},expand:function(a,b){if(!this.options.multiple){var d=this.container.find(".child.label-bar.expanded");d.length&&this.collapse(d,!0)}a=this.bar(a);a.removeClass("collapsed").addClass("expanded");
a.next().removeClass("collapsed").addClass("expanded");if(a.attr("item-url")&&!a.data("load")){this.container.trigger("start-load",[a.next()]);var c=this;d=a.attr("item-url");bm.ajax({url:app.baseUrl+d,dataType:"html",data:b?b.params:{},success:function(d){a.next().html(d);a.data("load","done");b&&b.success instanceof Function&&b.success(d);c.container.trigger("load",[a.next()]);bm.trigger(c,c.container,"childAccordion","load",[c.container.find(".child.label-bar.expanded"),a.next()])},error:function(d,
g,m){b&&b.error instanceof Function&&b.error(d,g,m);c.container.trigger("error",[a.next(),d,g,m])}})}bm.trigger(this,this.container,"childAccordion","expand",[this.container.find(".accordion-item.expanded"),a.next()])},current:function(){return this.container.find(".accordion-item.expanded")},item:function(a){var b=a.closest(".child.label-bar",this.container);return b.length?b.next():a.closest(".accordion-item",this.container)},next:function(a){return a.is(".accordion-item")?a.next().next():this.current().next().next()},
bar:function(a){if(a instanceof Number||"number"==typeof a)a=this.container.find(".child.label-bar:eq('"+a+"')");else if(a instanceof String||"string"==typeof a)a=this.container.find(".child.label-bar."+a);a.is(".accordion-item")&&(a=a.prev());return a},clearState:function(a){if(a=this.item(a))a.html(""),a.prev().removeData("load")},reload:function(a,b){a=this.bar(a);this.clearState(a);this.expand(a,b)}});bm.jquerify("accordion",Accordion);bm.jquerify("childAccordion",childAccordion)})();
var _u=app.tab_utils={};
_u.searchEvent=function(){function a(a,b,f){var c=this;this.tab=a;this.searchTool=b;this.options=f;var d=b.find(".search-form"),l=$('<span class="remove-search" title="'+$.i18n.prop("remove.search")+'">').tooltipster();d.prepend(l);a.simpleSearchText?l.show():l.hide();l.on("click",function(){c.clearSimpleSearchFilters();a.reload.apply(a,f.reload_args)});d.form({preSubmit:function(){var b=$(this).find(".search-text").val();c.clearAdvanceSearchFilters();a.simpleSearchText=b;$(this).find(".search-text").val(b);
a.reload.apply(a,f.reload_args);return!1}});b.find(".add-filter").on("click",function(){c.showAdvanceSearchPopup()});b.find(".remove-filter").on("click",function(){$(this).hasClass("disabled")||(a.advanceSearchFilter=!1,b.find(".remove-filter").addClass("disabled"),a.reload.apply(a,f.reload_args))})}var b=a.prototype;b.showAdvanceSearchPopup=function(){var a=this,b=a.tab;bm.editPopup(b.advanceSearchUrl,$.i18n.prop("advanced.search"),b.advanceSearchTitle,{searchText:b.simpleSearchText},{width:b.advance_search_popup_width||
480,clazz:b.advance_search_popup_clazz||"",events:{content_loaded:function(){this.countryChange=bm.countryChange(this,{inputClass:"medium",stateLabel:"state",stateName:"state",noSelection:$.i18n.prop("all.states")});app.global_event.trigger("advanced-filter-loaded",[this])}},beforeSubmit:function(c,d,m){a.clearSimpleSearchFilters();b.advanceSearchFilter=c.serializeObject();m.close();a.searchTool.find(".search-text").val("");a.searchTool.find(".remove-filter").removeClass("disabled");b.reload.apply(b,
a.options.reload_args);return!1}})};b.clearSimpleSearchFilters=function(){this.tab.simpleSearchText="";this.searchTool.find(".search-text").val("");"function"==typeof this.tab.clearFilters&&this.tab.clearFilters.call(this.tab)};b.clearAdvanceSearchFilters=function(){this.tab.advanceSearchFilter=!1;this.searchTool.find(".remove-filter").addClass("disabled")};return{init:function(b,c,f){return new a(b,c,f||{})}}}();
(function(){function a(){var a=-1,b=this;$.each(m,function(c){if(this.id==b.id)return a=c,!1});return a}function b(a){var b=this;a.bind("click."+this.id,function(a){$(a.target).is(".close")?b.close(1):b.setActive()});a.find(".title").tooltipster()}function d(a){this.body.addClass("tab-loading").append('<span class="loader"></span>');var b=this;bm.ajax({url:this.ajax_url,dataType:"html",data:this.ajax_data instanceof Function?this.ajax_data(a):this.ajax_data,response:function(){b.body.removeClass("tab-loading")},
success:function(c){b.body.removeClass("tab-loading");b.body.html(c);b.body.updateUi();b.init(a)},error:function(a,c,d){b.body.removeClass("tab-loading");b.body.html(d).addClass("ajax-loading-error");b.header.addClass("ajax-loading-error");b.error&&b.error()}})}var c,f,g,m=[];window.ptp=m;$(function(){c=$("#tab-header-line");c=c.find(".one-line-scroll-content").scrollbar({show_vertical:!1,show_horizontal:!0,use_bar:!1,visible_on:"auto",horizontal:{handle:{left:c.find(".left-scroller"),right:c.find(".right-scroller")}}});
$(window).resize(function(){c.scrollbar("update",!0)});g=$("#workspace .content-tabs-container")});app.Tab=function(a){a&&(this.icon=!0,$.extend(this,a),this.tip||(this.tip=this.text),this.events=$({}),this.body&&this.header&&(this.body.empty(),this.body.data("tab-inst",this)),this._create_forms={},this.dirty=!1)};app.Tab.changeView=function(a,c,e,d){a.trigger("before-change-view",[e]);var g=app.tabs[c].prototype;!d||app.tabs[c][e].prototype instanceof app[d]&&g instanceof app[d]||(app.tabs[c].inherit(app[d]),
app.tabs[c][e].inherit(app.tabs[c]));e=app.tabs[c][e];app.tabs[c].ribbon_data&&(app.tabs[c].ribbon_data.processor=e);app.global_event.off("."+a.id);a.off("."+a.id);c=void 0;a.hasOwnProperty("dirty")&&a.dirty&&(a.clearDirty(),c=!0);e=new e($.extend(a.constructor_args?a.constructor_args[0]:{},{header:a.header,body:a.body,data:a.data}));a.header.find("*").addBack().off();d=a.header.find(".title");d.tooltipster("destroy");d.text(e.text).attr("title",bm.htmlEncode(e.tip));b.call(e,e.header);app.Tab.eventCopy(a,
e);f==a&&(f=e);e.render();c&&e.hasOwnProperty("dirty")&&(e.unsaved=!0);return e};var l=app.Tab.prototype;l.reload=function(a){this.body.addClass("tab-loading").append('<span class="loader"></span>');var b=this;bm.ajax({url:this.ajax_url,dataType:"html",data:this.ajax_data instanceof Function?this.ajax_data(a):this.ajax_data,response:function(){b.body.removeClass("tab-loading")},success:function(c){b.body.html(c);b.body.updateUi();b.clearDirty();b.reinit(a)}})};l.reload.virtual=!0;l.reinit=function(){function a(a){if(b.onActionMenuOpen)b.onActionMenuOpen(this,
a)}var b=this,c=this.body.find(".toolbar"),d=c.find(".action-menu");d.length&&(b.action_menu=bm.menu(b.action_menu_entries,d,null,{click:$.proxy(b,"onActionMenuClick"),open:a,hide:$.proxy(b,"onActionMenuHide")},"click",["right bottom+7","right top"]));d=c.find(".create.menu");d.length&&(b.create_menu=bm.menu(b.create_menu_entries,d,null,{click:$.proxy(b,"onCreateMenuClick"),open:a,hide:$.proxy(b,"onActionMenuHide")},"click",["right bottom+7","right top"]));c=c.find(".switch-menu");c.length&&(b.switch_menu=
bm.menu(b.switch_menu_entries,c,null,{click:$.proxy(b,"onSwitchMenuClick"),open:a,hide:$.proxy(b,"onActionMenuHide")},"click",["right bottom+7","right top"]));this.body.find(".header .toolbar-item.reload").click(function(){b.reload()});this.body.addClass(this.ui_class)};l.getTitle=function(){return this.text};l.setTitle=function(a){this.text=a;this.header.find(".title").text(this.text)};l.setName=function(a){this.name=a;a=this.header.find(".entity-name");a.length||(this.header.find(".title").append(" - <span class='entity-name'></span>"),
a=this.header.find(".entity-name"));a.text(this.name)};l.setData=function(){throw $.error("Data setting not supported in this tab");};l.setData.virtual=!0;l.render=function(a){this.trigger("render");if(this.header){var f=this.header.find(".title").text(this.text);c.scrollbar("update",!0);this.body.attr("class",this.ui_body_class||"");f.tooltipster("content",this.tip)}this.isRendered()||(f="",this.icon&&(f="<span class='icon'></span>"),f=$('<span class="tab-header '+this.ui_class+'">'+f+'<span class="title"></span><span class="close">&nbsp;</span></span>'),
f.find(".title").text(this.text).attr("title",bm.htmlEncode(this.tip)),b.call(this,f),c.append(f),this.header=f,c.scrollbar("update",!0),this.id||(this.id=bm.getUUID()),this.body=$('<div id="'+this.id+'"></div>'),this.ui_body_class&&this.body.addClass(this.ui_body_class),g.append(this.body.hide()));this.body.data("tab-inst",this);this.body.addClass("app-tab-container");this.name&&(this.header.find(".title").append(" - <span class='entity-name'></span>"),this.header.find(".entity-name").text(this.name));
this.ajax_url?d.call(this,a):"function"==typeof this.init&&this.init(a)};l.on_global=function(a,b){a=$.isArray(a)?a.join("."+this.id+" ")+"."+this.id:a+"."+this.id;app.global_event.on(a,b)};l.one_global=function(a,b){a=$.isArray(a)?a.join("."+this.id+" ")+"."+this.id:a+"."+this.id;app.global_event.one(a,b)};l.off_global=function(a){a=a+"."+this.id;app.global_event.off(a)};l.getId=function(){return this.id};l.updateTitle=function(a){this.header.find("a.title").html(a)};l.updateTip=function(a){this.header.attr("title",
a)};l.on=function(){arguments[1]=$.proxy(arguments[1],this);$.fn.on.apply(this.events,arguments);return this};l.one=function(){arguments[1]=$.proxy(arguments[1],this);$.fn.one.apply(this.events,arguments);return this};l.off=function(){$.fn.off.apply(this.events,arguments);return this};l.trigger=function(){return $.fn.trigger.apply(this.events,arguments)};l.setActive=function(){if(f==this)return!1;if(f){if(!1===this.trigger("beforeDeactive"))return!1;f.header.removeClass("current");f.body.hide();f.trigger("deActive");
f=null}this.header.addClass("current");this.body.show();var b=a.call(this);-1<b&&m.splice(b,1);m.push(this);f=this;var d=this.header.position().left;b=c.scrollLeft();0>d?c.animate({scrollLeft:b+d-100},200):(d+=this.header.outerWidth(!0),d>c.width()&&c.animate({scrollLeft:d-c.width()+b+100},200));this.trigger("active")};l.isRendered=function(){return!!this.header};l.init=function(){this.unsaved&&this.setDirty();this.reinit();this.on("close",function(){this.off()})};l.confirmCloseIfDirty=function(a){var b=
this;return this.dirty?(bm.confirm($.i18n.prop("there.unsaved.content.wanna.save"),function(){b.save(function(){b.close(a)})},function(){b.clearDirty();b.close(a)},function(){}),!1):!0};l.close=function(b){if(this.confirmCloseIfDirty(b)){if(-1!=b&&!this.isRendered()||-1!=b&&!1===this.trigger("beforeClose",[b]))return!1;app.global_event.off("."+this.id);$(window).off("."+this.id);this.header.remove();c.scrollbar("update",!0);this.body.remove();this.header=null;this.trigger("close",[b]);$.each(this._create_forms,
function(a,b){b&&b.trigger("close")});b=a.call(this);-1<b&&m.splice(b,1);f==this&&(f=null,(b=m[m.length-1])&&b.setActive());this.isClosed=!0;this.off();return!0}return!1};l.save=function(a){var b=this;$.each(b._create_forms,function(c,d){d&&d.form("submit",{success:function(){b.clearDirty();a()}})})};l.isActive=function(){return this.header.is(".current")};l.createPanelTemplate=$('<div class="embedded-edit-form-panel create-panel fade-in-up"><div class="header"><span class="header-title"></span><span class="toolbar toolbar-right"><span class="tool-group toolbar-btn save">'+
$.i18n.prop("save")+'</span><span class="tool-group toolbar-btn cancel">'+$.i18n.prop("cancel")+'</span></span></div><div class="body"></div></div>');l.clearDirty=function(){this.dirty=!1;this.header.find(".dirty-mark").remove();this.trigger("dirty",[!1])};l.setDirty=function(){this.dirty||(this.dirty=!0,this.header.find(".title").before("<sup class='dirty-mark'>* </sup>"),this.trigger("dirty",[!0]))};l.isDirty=function(){return this.dirty};l.renderCreatePanel=function(a,b,c,d,f){function e(){f.auto_clear_dirty&&
l.clearDirty();l._create_forms[n].trigger("close");p.remove();l.body.addClass("fade-in-down");setTimeout(function(){l.body.removeClass("fade-in-down")},700);delete l._create_forms[n]}function g(a){p.find(".body").html(a);p.find(".header .header-title").html(b);l.body.append(p);f.scrollable&&p.find(".body").scrollbar();q(p);p.close=p.closePanel=e}var l=this,m=f.content_loaded,n=bm.getUUID(),p=f.createPanelTemplate?f.createPanelTemplate:l.createPanelTemplate.clone();l.body.loader();b='<span class="title">'+
b+"</span>";b=c?b+' - <span class="emphasized"> '+bm.htmlEncode(c)+"</span>":b;f=$.extend({},{auto_clear_dirty:!0,auto_close_on_success:!0,disable_on_submit:!0,disable_on_invalid:!0,disable_button_text:void 0,submit_n_cancle:!0,modify_ui:!0,scrollable:!0},f);var q=function(a){a.updateUi();var b=f.ajax&&f.ajax.success||f.success,c=a.find("form").not(".search-form"),d=c.find(".submit-button");0<c.length&&c.attr("class").split(" ").every(function(){var a=d.filter("."+this+"-submit");if(a.length)return d=
a,!1});l._create_forms||(l._create_forms={});l._create_forms[n]=c;var g=p.find(".toolbar-btn.save");f.toolbar_btn_text&&g.text(f.toolbar_btn_text);c=c.form({submitButton:g.add(d),ajax:null==a.find(".edit-popup-form").attr("no-ajax"),disable_on_submit:f.disable_on_submit,disable_on_invalid:f.disable_on_invalid,disable_button_text:f.disable_button_text,preSubmit:function(d){$.extend(d,{response:f.response,error:f.error},f.ajax,{success:function(){f.auto_close_on_success&&e();b&&b.apply(this,arguments)}});
if(f.beforeSubmit)return f.beforeSubmit.call(a,c,d?d.data=d.data||{}:null,p)}});a.submit=function(){c.form("submit")};c.find("[default-focus]").focus();var q=c.find(".bmui-tab:first");if(q.length)q.find("input,textarea,select").on("invalid",function(a,b){q.tabify("activate",b.validator.elm)});f.submit_n_cancle&&(a.find(".header .cancel,.cancel-button").click(function(){e()}),a.find(".header .save").on("click",function(){a.submit()}));a.on("content-change",function(a,b,d){b&&c.obj(ValidationPanel).attach(b.filter("[validation]").add(b.find("[validation]")));
d&&c.obj(ValidationPanel).detach(d.filter("[validation]").add(d.find("[validation]")))});c.on("trash-restore",function(){e()});m&&(a.find(".bmui-tab.create-edit-panel").length?m.apply(a,[p]):m.apply(a,[c,p]));c.on("change",function(){l.setDirty()})};void 0==a?(g(f.content),this.body.loader(!1)):bm.ajax({url:a,data:d,dataType:"html",success:function(a){a=$(a);g(a)},error:function(a,b,c){bm.notify(c.textify(),"error")},complete:function(){l.body.loader(!1)}})};app.Tab.getTab=function(a){return g.find("> #"+
a).obj(app.Tab)};app.Tab.eventCopy=function(a,b){a.events.copyEvents(b.events)}})();
(function(){function a(){var a=this;app.tab_utils.searchEvent.init(a,a.body);0<this.body.find("table.content .select-column :checkbox").length&&(bm.tableCheckAll(this.body.find("table"),function(){a.body.find(".action-header").show()},function(){a.body.find(".action-header").show()},function(){a.body.find(".action-header").hide()}),this.body.find(".action-header .action-on-selection").change(function(){var b=a.getSelectedEntities(),c=$(this).val();a.onSelectedActionClick(c,b);$(this).chosen("val",
"")}))}app.SingleTableView=function(){};var b=app.SingleTableView.prototype;b.getSelectedEntities=function(){var a=[];this.body.find("td.select-column :checkbox:checked, td.select-column :radio:checked").each(function(){a.push($(this).config("entity"))});return a};b.init=function(){var b=this;this.table=this.body.find(this.isNonTable?">.app-tab-content-container>.body":">.app-tab-content-container>table");var d=this.body.addClass("table-view");this.tabulator=bm.table(d,$.extend({url:this.ajax_url,
isNonTable:b.isNonTable,menu_entries:this.menu_entries,beforeReloadRequest:function(){b.beforeReloadRequest&&b.beforeReloadRequest(this.param)},afterLoad:function(){b.body.find(".action-header:visible").hide();b.table.tscrollbar("content");b.simpleSearchText?b.body.find(".search-form .remove-search").show():b.body.find(".search-form .remove-search").hide();b.afterTableReload&&b.afterTableReload()},afterCellEdit:this.afterCellEdit?$.proxy(this.afterCellEdit,this):null,selectableCellSelect:this.selectableCellSelect,
afterCellSelect:this.afterCellSelect?$.proxy(this.afterCellSelect,this):null,beforeCellSelect:this.beforeCellSelect?$.proxy(this.beforeCellSelect,this):null},this.sortable?{sortable:this.sortable.list,sorted:this.sortable.sorted,sortedDir:this.sortable.dir}:{}));this.tabulator.onMenuOpen=$.proxy(this.onMenuOpen,this);this.tabulator.onActionClick=$.proxy(this.onActionClick,this);this.table.tscrollbar();a.call(this)};b.reload=function(){this.tabulator.reload()};b.reload.override=!0;b.beforeReloadRequest=
function(a){var b={searchText:this.simpleSearchText};!1!==this.advanceSearchFilter&&(b=this.advanceSearchFilter);$.extend(a,b)};b.destroy=function(){};app.SingleTableTab=function(){d.constructor.apply(this,arguments)};app.SingleTableTab.inherit(app.Tab,app.SingleTableView);var d=app.SingleTableTab._super})();
(function(){function a(){this.on("before-change-view."+this.id,function(){this.resize_disabled||this.scroller.draggable("destroy")});this.attachModernUiPanel()}app.TwoPanelResizeable=function(){b.constructor.apply(this,arguments)};app.TwoPanelResizeable.inherit(app.Tab);var b=app.TwoPanelResizeable._super;var d=app.TwoPanelResizeable.prototype;d.attachModernUiPanel=function(){bm.attachModernUiPanel.call(this)};d.init=function(){function c(){m.css({flexBasis:bm.innerWidth(m,d.left)})}var d=this,g;
this.scroller=this.body.find(".wcui-resizable-layout-scroller");var m=this.body.find(".left-panel");b.init.call(this);this.body.find(".app-tab-content-container").addClass("two-panel-resizable"+(this.resize_disabled?" without-resize-bar":""));c();this.left_boundary||(this.left_boundary=[100,Number.MAX_VALUE]);this.right_boundary||(this.right_boundary=[100,Number.MAX_VALUE]);this.shim_required&&(this.shim=$("<div class='iframe-shim'></div>").appendTo(document.body).hide());if(!this.resize_disabled){var l=
function(){var a=d.body.width(),b=d.scroller.position().left;d.scroller.draggable("option","containment",[Math.max(b-d.left+d.left_boundary[0],b+a-d.left-d.right_boundary[1]),0,Math.min(b-d.left+d.left_boundary[1],b+a-d.left-d.right_boundary[0]),0])};this.scroller.draggable({axis:"x",containment:[0,0,0,0],start:function(a,b){g=b.position.left;d.shim_reqired&&d.shim.show()},drag:function(a,b){a=b.position.left-g;g=b.position.left;d.left+=a;c()},stop:function(){d.shim_required&&d.shim.hide()}});this.scroller.css({left:m.position().left+
m.outerWidth()});$(window).on("resize."+this.id,function(){l()});l()}a.call(this)};d.close=function(){if(this.confirmCloseIfDirty()){try{this.resize_disabled||this.scroller.draggable("destroy")}catch(c){}return b.close.call(this)}return!1}})();
(function(){function a(a,b){var c=this,d=b.panel,f=b.tab,g=b.index;d.isDirty=!1;d.reload=function(b){d.clearDirty();var c=bm.path(f.attr("data-tabify-url"));b&&$.extend(c.query,b);c=f[0].load_url=c.full();b?a.tabify("reload",g,c):a.tabify("reload",g)};d.setDirty=function(){c.notEditable||d.isDirty||(d.isDirty=!0,f.find(".title").before("<sup class='dirty-mark'>* </sup>"),c.setDirty())};d.clearDirty=function(){if(d.isDirty){d.isDirty=!1;f.find(".dirty-mark").remove();var a=!1;$.each(c.panels,function(b,
c){a=a||c.isDirty});a||c.clearDirty()}};d.change(function(a){c.notEditable||a.ignore||a.originalEvent&&a.originalEvent.ignore||d.setDirty()});return d}function b(a){var b=this.tab_objs[a.index],c=a.panel.tool;if(c){app.tab_utils.searchEvent.init(b,c);var d=a.panel;0<d.find("table.content .select-column :checkbox").length&&(bm.tableCheckAll(d.find("table"),function(){c.find(".action-header").show()},function(){c.find(".action-header").show()},function(){c.find(".action-header").hide()}),c.find(".action-header .action-on-selection").change(function(){var a=
[];d.find("td.select-column :checkbox:checked").each(function(){a.push($(this).config("entity").id)});var c=$(this).val();b.onSelectedActionClick(c,a);$(this).chosen("val","")}))}}app.MultiTab=function(){this.panels={};this.tabs={};this.tab_objs={};d.constructor.apply(this,arguments)};app.MultiTab.inherit(app.Tab);var d=app.MultiTab._super;var c=app.MultiTab.prototype;c.save=function(a){function b(b){c.isDirty()?b.next():a&&a()}var c=this;bm.iterate(this.panels,function(a,d){var f=this;f.isDirty?
f.save?f.save(function(){b(a)}):f.find("form").form("submit",{ajax:{show_success_status:!1},success:function(){f.clearDirty();b(a)},error:function(){c.setActiveTab(d)},invalid:function(){c.setActiveTab(d);f.find("form").valid("position")}}):b(a)})};c.render=function(a){if(a&&a.active){var b=bm.path(this.ajax_url);b.query.active=a.active;this.ajax_url=b.full()}d.render.apply(this,arguments)};c.setActiveTab=function(a){this.body.find(".bmui-tab").tabify("activate",a)};c.setData=function(a){a&&a.active&&
this.setActiveTab(a.active)};c.init=function(){var c=this;d.init.apply(this,arguments);var g=this.toolbar=this.body.find(".multi-tab-shared-header, .header"),m=g.find(".header-title"),l=g.find(".toolbar-right"),n=this.body.find(".bmui-tab-header-container"),q=this.body.find(".bmui-tab-body-container"),e=this.body.find(".bmui-tab");this.body.find(".toolbar .save-all").on("click",function(){c.isDirty()?c.save(function(){c.close()}):c.close()});this.body.find(".toolbar .cancel").on("click",function(){c.close(1)});
e.on("tab:load",function(d,f){c.tabs[f.index]=f.panel;c.panels[f.index]=a.call(c,e,f);f.panel.tool&&f.panel.tool.remove();d=f.panel.find(".toolbar-share");var n=d.find(".header-title"),p=d.find(".toolbar.toolbar-right").clone();n.length&&(f.panel.headerTitle=n.text());p&&(l.length?(p.removeClass("toolbar-right"),p.is(".before")?l.prepend(p):l.append(p)):g.append(p),p.updateUi(),f.panel.tool=p,p.find(".reload").on("click",function(){f.panel.reload()}),d.remove());if(c.onContentLoad)c.onContentLoad(f,
c.panels[f.index]);Object.keys(c.tab_objs).length&&b.call(c,f);c.afterTableReload&&c.afterTableReload(f,c.panels[f.index]);f.panel.reload=function(){var a=f.tab;a[0].load_url=a.attr("url");e.tabify("reload",f.index);f.panel.find(".toolbar-share").remove()};f.panel.headerTitle?m.text(f.panel.headerTitle):m.text(f.tab.text().trim());f.panel.find(".table-view").on("tabulator-load-success",function(a,b){b.find(".header-title").length&&(f.panel.headerTitle=b.find(".header-title").text(),m.text(f.panel.headerTitle))})}).on("tab:error",
function(a,b){if(c.onContentError)c.onContentError(b)}).on("tab:activate",function(a,b){b.oldPanel.tool&&b.oldPanel.tool.chide();(a=b.newPanel.tool)&&a.cshow();c.currentPanel=b.newPanel;if(c.onTabActive)c.onTabActive(b);b.newPanel.headerTitle?m.text(b.newPanel.headerTitle):b.tab&&m.text(b.tab.text().trim())});this.targetTab&&this.setActiveTab(this.targetTab);n=n.add(q);this.disableScroll||n.scrollbar({vertical:{offset:-2}})};c.reload=function(){var a=this.body.find(".bmui-tab");this.tab_objs[a.tabify("option",
"active")].reload()}})();
(function(){function a(a,b,d){function c(){function a(a){x.removeClass("updating").loader(!1);a=$.extend(L,e.treeOptions,{children:a});w.beforeBuildTree&&w.beforeBuildTree(a);x.tree(a);b.length&&x.tree("inst").setCanonicalActive(b,{fail:function(){x.tree("inst").activateKey("0",G)}},G);B=!0;G=!1;x.scrollbar({vertical:{offset:8}});x.loader(!1)}var b=[0];B&&(b=x.tree("inst").getCanonicalActive(),x.tree("destroy"),B=!1);x.loader();if(w.onLazyRead)w.onLazyRead(function(b){a(b)});else bm.ajax({url:w.tree_node_load_url,
response:function(){x.removeClass("updating").loader(!1)},success:function(b){a(b)}})}function f(){e.param={max:y.all?-1:y.itemsPerPage,offset:(y.currentPage-1)*y.itemsPerPage};0!=p&&(e.param.id=p);"undefined"!=typeof t&&(e.param.type=t);e.sortable&&e.sorted&&$.extend(d.param,{sort:e.sortable[e.sorted],dir:"down"==e.sortedDir?"desc":"asc"});e.beforeReloadRequest&&e.beforeReloadRequest();A.loader();bm.ajax({url:e.url+(e.appendUrl||""),type:e.type,data:e.param,dataType:"html",success:q,response:function(){A.removeClass("updating");
A.loader(!1)},complete:function(){e.afterLoad&&e.afterLoad()}})}function g(){A.scrollbar({vertical:{offset:4}})}function q(b){b=$(b);A.html(b.find(".body").html()).updateUi();a.find(".header .title").replaceWith(b.find(".header .title"));var c=b.find("paginator");b=+c.attr("total");var d=+c.attr("max");c=+c.attr("offset");y.update(b,d,Math.floor(c/d)+1);g()}var e={url:"",appendUrl:null,type:"get",treeOptions:{},parent_key:"id"},p=0,t,w=this,y=a.find(".pagination").obj(),A=a.find(".body"),x=b.find(".body"),
z=$.extend({},{paginator:y,reload:function(a){a?(A.scrollbar("destroy"),y.onPageClick(y.getCurrentPage())):(x.scrollbar("destroy"),c())},setParent:function(a,b){p=a;"undefined"!=typeof b&&(t=b);y.setCurrentPage(0);this.reload(!0)},getCurrentParent:function(){return p}}),D=!1;z.menu=bm.menu(d.menu_entries,A,".float-menu-navigator",{open:function(a){if(a.parent().is(".grid-item")){a=a.parent();a.addClass("float-menu-opened");D=!1;var b=a.config("content"),c=b.type||w.tree_node_type;if(z.onMenuOpen)z.onMenuOpen(c,
b,a)}},hide:function(a){a=D?a.parent(".tree-node"):a.parent(".grid-item");a.removeClass("float-menu-opened")},click:function(a,b,c){if(D){var d=L.treeObj.data;c=void 0}else d=c.parent(".grid-item").config("content");z.onActionClick(a,b,d,c)},multitype:!0},"click",["center bottom","right+21 top+2"]);var B=!1,G=!0,L={auto_load_lazy_nodes:!0,tree_root_data:w.root_node_name?{id:0,name:w.root_node_name,type:"grand-root",icon:!1}:void 0,load_url:w.tree_node_load_url,node_type:w.tree_node_type,type_prop:w.tree_node_type_prop,
onRender:function(a,b){var c=$(b);b=$('<span class="float-menu-navigator"></span>');b.on("click",function(b){c.addClass("float-menu-opened");var d=a.data.type||w.tree_node_type;D=!0;L.treeObj=a;z.menu[d].show($(this),b);if(z.onMenuOpen)z.onMenuOpen(d,a.data,a);return!1});c.is(".grand-root")?L.grand_root_context&&c.append(b):c.append(b)},onActivate:function(a){z.setParent(a.data[e.parent_key],a.data.type)}};w.tree_options&&$.extend(L,w.tree_options);w.tree_disabled||c();$.extend(e,d);a.find(".per-page-count").change(function(a,
b,c){y.update(void 0,+c,1);f()});y&&(y.onPageClick=f);g();return z}app.ExplorerPanelTab=function(){d.constructor.apply(this,arguments)};var b=app.ExplorerPanelTab.inherit(app.TwoPanelResizeable);var d=app.ExplorerPanelTab._super;b.left=300;b.left_boundary=[300,800];b.right_boundary=[300,Number.MAX_VALUE];b.treeOptions={};b.init=function(){var b=this;d.init.call(this);this.treePanel=this.body.find(".left-panel");this.gridPanel=this.body.find(".right-panel");this.paginator=this.body.find(".right-panel>.footer>.pagination").obj();
this.explorer=a.call(this,this.gridPanel,this.treePanel,{url:this.explorer_url,parent_key:this.parent_key,menu_entries:this.menu_entries,treeOptions:b.tree_options,tree_disabled:b.tree_disabled?b.tree_disabled:!1,beforeReloadRequest:function(){b.beforeReloadRequest&&b.beforeReloadRequest(this.param)},afterLoad:function(){b.simpleSearchText?b.body.find(".search-form .remove-search").show():b.body.find(".search-form .remove-search").hide();b.afterTableReload&&b.afterTableReload()}});this.explorer.onMenuOpen=
this.onMenuOpen?$.proxy(this.onMenuOpen,this):null;this.explorer.onActionClick=this.onActionClick?$.proxy(this.onActionClick,this):null;this.explorer.onMoveTreeNode=this.onMoveTreeNode?$.proxy(this.onMoveTreeNode,this):null;app.tab_utils.searchEvent.init(b,b.body,{reload_args:[!0]})};b.reload=function(a){this.explorer.reload(a)};b.beforeReloadRequest=function(a){var b={searchText:this.simpleSearchText};!1!==this.advanceSearchFilter&&(b=this.advanceSearchFilter);$.extend(a,b)}})();
(function(){app.MultiSectionView=function(){};var a=app.MultiSectionView.prototype;a.sectionList={};a.init=function(){var a=this;$.each(this.sectionList,function(b,d){if(a["init"+b.capitalize()+"Section"])a["init"+b.capitalize()+"Section"](a.body.find("[section='"+b+"']"))})};a.reload=function(a){var b=this,d=b.body.find("[section='"+a+"']");d.loader();var g={url:b.sectionList[a].ajax_url,data:{},dataType:"html",success:function(c){d.html(c);b["init"+a.capitalize()+"Section"](d);if(b["after"+a.capitalize()+
"SectionReload"])b["after"+a.capitalize()+"SectionReload"]();d.loader(!1)}};if(b["before"+a.capitalize()+"SectionReload"])b["before"+a.capitalize()+"SectionReload"](g);bm.ajax(g)};app.MultiSectionTab=function(){app.MultiSectionTab._super.constructor.apply(this,arguments)};a=app.MultiSectionTab.inherit(app.Tab,app.MultiSectionView);var b=app.MultiSectionTab._super;a.reload=function(a){void 0==a&&b.reload.apply(this);app.MultiSectionView.prototype.reload.apply(this,arguments)}})();
(function(){app.TwoPanelExplorerTab=function(a){app.TwoPanelExplorerTab._super.constructor.apply(this,arguments)};_t=app.TwoPanelExplorerTab.inherit(app.Tab);_t.init=function(){var a=this.leftPanel=this.body.find(".left-panel");this.right_panel_views||(this.right_panel_views={"default":{ajax_url:this.right_panel_url}});this.current_right_panel_view||(this.current_right_panel_view="default");this.body.find(".app-tab-content-container").addClass("two-panel-explorer");this.initLeftPanel(a)};_t.initLeftPanel=
function(a){var b=this;b.body.find(".header .entity-count").replaceWith(a.find(".entity-count"));a.find(".body").scrollbar({vertical:{offset:-3}});b.initRootSelector(a);bm.menu(b.menu_entries,a.find(".float-menu-navigator"),null,{open:function(a){a.parents(".explorer-item").addClass("float-menu-opened")},hide:function(a){a.parents(".explorer-item").removeClass("float-menu-opened")},click:function(a,c){c=c.closest(".explorer-item").config("entity");b.onActionClick(a,c)}},"click",["center bottom","right+22 top+7"]);
a.find(".explorer-item").on("click",function(){var d=$(this);d.config("entity");a.find(".explorer-item.selected").removeClass("selected");d.addClass("selected");b.changeRightPanelView("default")});bm.instantSearch(a,a.find(".search-form"),".explorer-item",".title")};_t.initRootSelector=function(a){var b=this;a=a.find(".root-selector");if(0!==a.length){a=a.data("wcuiChosen");var d="<span class='actions'>";b.root_selector_menu_entries.forEach(function(a){d+='<span class="tool-icon '+a.ui_class+'" action="'+
a.action+'"></span>'});d+="</span>";a.results_data.forEach(function(a){a.html='<span class="text">'+a.html+"</span>"+d});var c=a.result_select;a.result_select=function(a){var d=$(a.target);if(d.is(".tool-icon")){var f=this.results_data[this.result_highlight.data("optionArrayIndex")];b.onRootSelectorActionClick(d.attr("action"),f);this.results_hide()}else return c.call(this,arguments)}}};_t.initRightPanel=function(a){var b=this.right_panel_views[this.current_right_panel_view],d=b.processor;d&&(this.right_view_processor=
new d(a,this,b.ajax_url))};_t.reloadRightPanel=function(){var a=this,b=this.body.find(".right-panel"),d={},c=this.leftPanel.find(".explorer-item.selected");0<c.length&&(d=c.config("entity"));b.loader();a.beforeRightPanelReload&&a.beforeRightPanelReload(d);bm.ajax({url:app.baseUrl+a.right_panel_views[a.current_right_panel_view].ajax_url,data:d,dataType:"html",success:function(c){c=$(c).updateUi();b.replaceWith(c);a.initRightPanel(c)}})};_t.changeRightPanelView=function(a){this.current_right_panel_view=
a;this.reloadRightPanel()};_t.reloadLeftPanel=function(){var a=this,b=this.leftPanel,d=b.find(".explorer-item.selected");b.loader();d={selected:d.attr("entity-id")};a.beforeLeftPanelReload&&a.beforeLeftPanelReload(d);bm.ajax({url:app.baseUrl+a.left_panel_url,dataType:"html",data:d,success:function(c){c=$(c).updateUi();b.replaceWith(c);a.leftPanel=c;a.initLeftPanel(c);a.afterReloadLeftPanel()}})};_t.afterReloadLeftPanel=function(){this.reloadRightPanel()};_t.reload=function(a){a?this.reloadRightPanel():
this.reloadLeftPanel()}})();
var POPUP_STATICS={z_index:{active:8E3,modal_base:3E3,no_modal:1E3,always_up:5E4},active_stack:[],next_instance_identifier:1,modal_mask:void 0,minimized_placeholder:void 0},_popup_defaults={clazz:"",minimized_clazz:"",animation_clazz:"",closing_animation_clazz:"",closing_animation_duration:300,show_title:!0,title:null,minimized_title:null,draggable:!1,drag_handle:".title-bar",drag_cancel:":input",disable_text_selection:!1,resizable:!1,maximizable:!1,minimizable:!1,modal:!0,show_close:!0,masking:!0,
close_on_mask_click:!1,close_on_blur:!1,close_on_escape:!0,auto_close:!1,reset_close_timer_on_hover:!0,width:"auto",max_width:null,height:"auto",top:null,left:null,ui_position:null,is_fixed:!1,is_center:!0,is_always_up:!1,always_up_z_index:void 0,auto_active:!0,auto_active_on_focus:!0,ajax_url:void 0,ajax_caller:bm.ajax,ajax_settings:{},on_load_loader:!0,content:"",content_clazz:"",template:'<div>\r\n        <div class="title-bar">\r\n            <span class="title"></span>\r\n            <span class="window-corner-toolbar">\r\n                <span class="minimize"></span>\r\n                <span class="maximize"></span>\r\n                <span class="close"></span>\r\n            </span>\r\n        </div>\r\n        <div class="content"></div>\r\n    </div>',
minimized_content:"",minimized_template:'<div>\r\n        <span class="title"></span>\r\n        <span class="content"></span>\r\n    </div>',parent:void 0,events:{beforeClose:void 0,close:void 0,beforeMinimize:void 0,minimize:void 0,beforeRestore:void 0,restore:void 0,maximize:void 0,beforeMaximize:void 0,render:void 0,beforeRender:void 0,beforeInactive:void 0,inactive:void 0,beforeActive:void 0,active:void 0,content_loaded:void 0}},POPUP=function(a){$.extend(this,_popup_defaults,a);this.instance_identifier=
POPUP_STATICS.next_instance_identifier++;this.z_index=this.is_always_up?this.always_up_z_index||POPUP_STATICS.z_index.always_up:this.modal?POPUP_STATICS.z_index.modal_base+=10:POPUP_STATICS.z_index.no_modal;this.is_active=this.is_rendered=!1;this.event_handlers=$({});this.parent&&this.parent.addChild(this);this.createPopup();this.render();this.auto_active&&this.setActive()};_p=POPUP.prototype;
_p.addChild=function(a){this.childs||(this.childs=[]);this.childs.push(a);var b=this;a.on("close",function(){var a=b.childs.indexOf(this);b.childs.splice(a,1)})};_p.one=function(a,b){this.event_handlers.one(a,$.proxy(b,this.el))};_p.on=function(a,b){this.event_handlers.on(a,$.proxy(b,this.el))};_p.off=function(a){this.event_handlers.off(a)};
_p.trigger=function(a,b){b||(b=[this]);var d;this.events[a]&&(d=this.events[a].apply(this.el,b));!1!==d&&(d=this.event_handlers.trigger(a,b));return!1!==d?this.el.trigger("wcui-popup-"+a,b):!1};_p.render=function(){this.trigger("beforeRender");this.setMask();this.setContent();this.bindEvents();this.trigger("render");this.is_rendered=!0};
_p.createPopup=function(){this.el||(this.el=$(this.template));this.content_clazz&&this.el.find(">.content").addClass(this.content_clazz);this.el.css({position:this.is_fixed?"fixed":"absolute",left:this.left||-1E4,top:this.top||-1E4,width:this.width,maxWidth:this.max_width,height:this.height,zIndex:this.z_index}).appendTo(this.parent?this.parent.el:document.body);this.el.addClass(this.clazz+" popup "+this.animation_clazz);this.show_title||(this.show_close||this.maximizable||this.minimizable?this.el.find(".title-bar").removeClass("title-bar").addClass("no-title-bar"):
this.el.find(".title-bar").remove());this.show_close||this.el.find("span.close").remove();this.maximizable||this.el.find("span.maximize").remove();this.minimizable||this.el.find("span.minimize").remove();this.show_title&&this.title&&this.el.find(".title").html(this.title);this.el.attr("id","popup-"+this.instance_identifier);this.el.attr("tabindex","-1")};
_p.setMask=function(){if(this.modal){POPUP_STATICS.modal_mask||(POPUP_STATICS.modal_mask=$("<div></div>").appendTo(document.body));var a=["popup-mask"];this.clazz.split(" ").every(function(){$.trim(this)&&a.push(this+"-mask")});POPUP_STATICS.modal_mask.attr("class",a.join(" ")).css({zIndex:this.z_index-5}).show()}};_p.hideMask=function(){this.modal&&1<=POPUP_STATICS.active_stack.count("this.modal && !this.is_hidden")&&POPUP_STATICS.modal_mask.hide()};
_p.setContent=function(a){var b=this,d=this.el.find(".content:first");d.length||(d=this.el);if(a||!this.ajax_url)(a=a||this.content)&&d.html(a),this.position(),b.trigger("content_loaded");else{this.el.addClass("ajax-loading");this.on_load_loader&&d.html('<span class="loader"></span>');if(!this.is_rendered){var c=this.width;"auto"==c&&(c=300);var f=this.height;"auto"==f&&(f=300);this.position(void 0,c,f)}this.ajax_caller($.extend({url:this.ajax_url,dataType:"html",response:function(){b.el.removeClass("ajax-loading")},
success:function(a){d.html(a);b.trigger("ajax_loaded");"auto"==b.width&&b.el.width("auto");"auto"==b.height&&b.el.height("auto");b.position();b.trigger("content_loaded")},error:function(c,f,l){b.el.addClass("http-"+c.status+"-error");a=$("<div class='ajax-loading-error'></div>").append(l);d.html(a);b.trigger("content_loading_error")}},this.ajax_settings))}};
_p.position=function(a,b,d){var c=-2E3>this.el.offset().left?"css":"animate";if(a)this.el[c](a);else if(!this.ui_position||this.left||this.top)if(this.is_center){var f=$(window).height();a=$(window).width();var g=d||this.el.outerHeight(),m=b||this.el.outerWidth();a=this.left||a/2-m/2;f=this.top||f/2-g/2;this.is_fixed||(g=$(window).scrollTop(),m=$(window).scrollLeft(),a+=m,f+=g);a={left:Math.max(20,a),top:Math.max(20,f)};b&&(a.width=b);d&&(a.height=d);this.el[c](a)}else this.el[c]({left:this.left||
100,top:this.top||100,width:b||this.width,height:d||this.height});else{a=this.ui_position;if(!a.using&&"animate"==c){var l=this;a=$.extend({},a,{using:function(a){l.el.animate(a)}})}this.el.position(a)}};
_p.setActive=function(){if(!this.is_active){var a=this;if(0<POPUP_STATICS.active_stack.length){var b=!0;this.masking&&(b=POPUP_STATICS.active_stack[POPUP_STATICS.active_stack.length-1].setInactive());if(!1===b)return}this.trigger("beforeActive");this.el.find(".inactive-mask").hide();a.el.removeClass("inactive");setTimeout(function(){a.el.addClass("active")},200);this.el.css({zIndex:Math.max(this.z_index,POPUP_STATICS.z_index.active)});b=POPUP_STATICS.active_stack.find(this.instance_identifier+" == this.instance_identifier");
-1<b&&POPUP_STATICS.active_stack.splice(b,1);POPUP_STATICS.active_stack.push(this);this.trigger("active");this.is_active=!0;for(b=this;!b.modal&&b.parent;)b=b.parent;b.modal&&b.setMask();this.el.focus()}};
_p.setInactive=function(){if(this.is_active){if(!1===this.trigger("beforeInactive"))return!1;var a=this;this.el.removeClass("active").addClass("inactive");this.el.css({zIndex:this.z_index});var b=this.el.find(".inactive-mask");b.length||(b=$("<div class='inactive-mask'></div>").appendTo(this.el),b.on("mousedown",function(){a.setActive()}));b.show();this.trigger("inactive");this.is_active=!1;this.hideMask()}};
_p.bindEvents=function(){var a=this;this.el.find(".close").click(function(){a.close(1)});!0===this.close_on_mask_click&&POPUP_STATICS.modal_mask&&POPUP_STATICS.modal_mask.bind("click.popup-mask-click-"+this.instance_identifier).click(function(){a.is_active&&a.close(1)});!0===this.close_on_blur&&$(document).bind("mousedown.popup-out-click-"+this.instance_identifier,function(b){var c=a.el;c.is(b.target)||0!==c.has(b.target).length||a.is_active&&a.close(1)});this.close_on_escape&&$(document).bind("keyup.key_esc.popup-escape-"+
this.instance_identifier,function(){a.is_active&&a.close(1)});this.auto_close&&(this.resetCloseTimer(),this.reset_close_timer_on_hover&&this.el.hover(function(){a.clearCloseTimer()},function(){a.resetCloseTimer()}));this.auto_active_on_focus&&this.el.bind("focus",function(){a.setActive()});if(this.draggable){a=this;var b="*"==this.drag_handle?this.el:this.el.find(this.drag_handle),d=this.el.offset(),c=b.offset(),f=c.top-d.top,g=c.left-d.left;this.el.draggable({handle:"*"==this.drag_handle?void 0:
b,cancel:this.drag_cancel,disable_text_selection:this.disable_text_selection,stop:function(){var c=b.offset(),d=!1;c.left<-1*b.outerWidth()+50&&(c.left=5,d=!0);c.top<-1*b.outerHeight()+50&&(c.top=5,d=!0);d&&a.el.offset({left:c.left-g,top:c.top-f})},start:function(){a.animation_clazz&&a.el.removeClass(a.animation_clazz)}})}};_p.clearCloseTimer=function(){this.auto_close_timer&&(clearTimeout(this.auto_close_timer),this.auto_close_timer=null)};
_p.resetCloseTimer=function(){this.clearCloseTimer();var a=this;this.auto_close_timer=setTimeout(function(){a.auto_close_timer=null;a.close(0)},this.auto_close)};
_p.unbindEvents=function(){!0===this.close_on_mask_click&&POPUP_STATICS.modal_mask&&POPUP_STATICS.modal_mask.unbind("click.popup-mask-click-"+this.instance_identifier);!0===this.close_on_blur&&$(document).unbind("mousedown.popup-out-click-"+this.instance_identifier);this.close_on_escape&&$(document).unbind("keyup.key_esc.popup-escape-"+this.instance_identifier);this.clearCloseTimer()};
(function(){function a(){if(this.is_active&&POPUP_STATICS.active_stack.length)for(var a;;)if(a=POPUP_STATICS.active_stack[POPUP_STATICS.active_stack.length-1])if(a.is_closed||a.is_hidden)POPUP_STATICS.active_stack.pop();else{a.setActive();break}else break}_p.close=function(b){var d=this;!1!==this.trigger("beforeClose",[b])&&(this.unbindEvents(),this.closing_animation_clazz?(this.el.removeClass("active").removeClass(this.animation_clazz).addClass(this.closing_animation_clazz),setTimeout(function(){d.el.remove()},
this.closing_animation_duration)):this.el.remove(),this.hideMask(),this.is_active&&POPUP_STATICS.active_stack.pop(),this.is_closed=!0,a.call(this),this.trigger("close",[b]))};_p.hide=function(){this.el.hide();this.hideMask();this.is_hidden=!0}})();_p.show=function(){this.el.show();this.setActive();this.is_hidden=!1};_p.getDom=function(){return this.el};
$.prototype.popup=function(a){var b=this.data("popup-inst");if("string"==typeof a&&b)return $.isFunction(b[a])?b[a](Array.prototype.splice.call(arguments,1)):b[a];b||(b=new POPUP($.extend({},a,{el:this})),this.data("popup-inst",b));return this};
(function(){var a={active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,disabled:[],load_on_activate:!1,all_deactivable:!1,ajax_caller:bm.ajax,loader_template:"",content_on_load_error:"",beforeActivate:null,beforeLoad:null,load:null,loadError:null,hashnavigation:!1},b=0,d=function(c,d){d=this.options=$.extend({},a,d);this.running=!1;this.element=c;this.bindings=$();this.hoverable=$();this.focusable=$();this._handlers={};this.eventNamespace="tabs-"+b++;this.element.toggleClass("bmui-tab-collapsible",
d.collapsible).delegate(".bmui-tab-header","focus."+this.eventNamespace,function(){$(this).closest(".bmui-tab-header").is(".bmui-state-disabled")&&this.blur()});this._processTabs();d.disabled=$.unique(d.disabled.concat($.map(this.tabs.filter("[data-tabify-disabled], .bmui-state-disabled"),function(a){return a.index})));d.active=this._initialActive();this.active=this.options.active?this._findTab(d.active):$();this._refresh();this.active.length&&this._load(d.active);var f=this;if(this.options.hashnavigation)$(window).on("hashchange",
function(){var a=window.location.hash;if(a&&(a=a.substring(1),!0!==f.options.disabled)){if(f.options.disabled&&f.options.disabled.contains(a)){var b=f.getTabIndex(a)-1;for(a=void 0;0<=b;b--){var c=f.tabs.eq(b)[0].index;if(!f.options.disabled.contains(c)){a=c;break}}a&&(b=bm.path(location),b.fragment=a,history.pushState("tabify","expected tab disabled",b.full))}else f._getTab(a).length||(a=void 0);a&&f.activate(a)}})};d.prototype={activate:function(a,b){(a=this._findTab(a))&&a[0]!==this.active[0]&&
(a.length||(a=this.active),this._eventHandler({target:a,currentTarget:a,preventDefault:$.noop,silent:b}))},add:function(a){if(a.template instanceof $){var b=a.template;var c=this.tabs.index(b)}else b=$(a.template||'<div> \r\n                    <span class="icon"></span>   \r\n                    <span class="title"></span> \r\n                    <span class="close"></span>   \r\n                </div>'),a.title&&b.find(".title").text(a.title),a.tip&&b.attr("title",a.tip),a.close_on_header||b.find(".close").remove(),
a.icon_on_header||b.find(".icon").remove(),b.addClass("bmui-tab-header "+(a.clazz||"")),a.load_url&&b.attr("data-tabify-url",a.load_url),a.index||(a.index=(new Date).getTime()),b.attr("data-tabify-tab-id",a.index),a.after?(c=this._findTab(a.after))&&c.length?(c.after(b),c=this.tabs.index(c)+1):(this.headercontainer.append(b),c=this.tabs.length):a.before?(c=this._findTab(a.before))&&c.length?(c.before(b),c=this.tabs.index(c)):(this.headercontainer.prepend(b),c=0):(this.headercontainer.append(b),c=
this.tabs.length-1);a.panel&&a.panel.length?(a.panel.addClass("bmui-tab-panel"),b[0].panel=a.panel,a.panel.parent().length||this.panelcontainer.append(b[0].panel)):(b[0].panel=$("<div class='bmui-tab-panel' id='bmui-tab-"+a.index+"'></div>"),this.panelcontainer.append(b[0].panel));Array.prototype.splice.call(this.tabs,c,0,b[0]);this._processTab(b[0]);this._refresh();a.active&&this._setOption("active",b[0].index);return{tab:b,panel:b[0].panel,index:b[0].index}},destroy:function(){this._destroy();this.element.unbind("."+
this.eventNamespace).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind("."+this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled bmui-state-disabled");this.bindings.unbind("."+this.eventNamespace);this.hoverable.removeClass("bmui-state-hover");this.focusable.removeClass("bmui-state-focus")},disable:function(a){if(a)!0===this.options.disabled&&(this.options.disabled=[]),this.tabs.filter("[data-tabify-tab-id='"+a+
"']").length&&!this.options.disabled.contains(a)&&(this.options.disabled.push(a),this._setupDisabled());else return this._setOptions({disabled:!0})},each:function(a){this.tabs.each(function(b,c){a.call({tab:$(c),panel:c.panel,index:c.index},b)});return this},enable:function(a){if(a)!1!==this.options.disabled&&this.tabs.filter("[data-tabify-tab-id='"+a+"']").length&&this.options.disabled.contains(a)&&(this.options.disabled.remove(a),this._setupDisabled());else return this._setOptions({disabled:!1})},
getActive:function(){return this.active?this.active.attr("data-tabify-tab-id"):null},getTabHash:function(a){return{tab:this.tabs.filter("[data-tabify-tab-id='"+a+"']"),panel:this.element.find(this._sanitizeSelector("#bmui-tab-"+a))}},getTabIndex:function(a){return this._getTabIndex(this._getTab(a))},hasIndex:function(a){return(a=this._findTab(a))&&a.length},isContentLoaded:function(a){return!this._findTab(a).nat.load_url},option:function(a,b){var c=a,d;if("string"===typeof a){c={};var f=a.split(".");
a=f.shift();if(f.length){var n=c[a]=$.extend({},this.options[a]);for(d=0;d<f.length-1;d++)n[f[d]]=n[f[d]]||{},n=n[f[d]];a=f.pop();if(1===arguments.length)return void 0===n[a]?null:n[a];n[a]=b}else{if(1===arguments.length)return void 0===this.options[a]?null:this.options[a];c[a]=b}}this._setOptions(c)},remove:function(a){if((a=this._findTab(a))&&a.length){var b=this._getPanelForTab(a),c=this.tabs.index(a),d=this.panels.index(b);Array.prototype.splice.call(this.tabs,c,1);Array.prototype.splice.call(this.panels,
d,1);this.options.all_deactivable||this.active[0]!=a[0]||(d=this.tabs.eq(c),d.length||(d=this.tabs.eq(c-1)),d.length&&this._setOption("active",d[0].index));a.add(b).remove()}},refresh:function(){var a=this.options;a.disabled=$.map(this.tabs.filter(".bmui-state-disabled"),function(a){return a.index});this._processTabs();!1!==a.active&&this.tabs.length?this.active.length&&!$.contains(this.tabs[0],this.active[0])?this.tabs.length===a.disabled.length?(a.active=!1,this.active=$()):this.activate(this._findNextTab(this.tabs.index(a.active)-
1,!1)):a.active=-1<this.tabs.index(this.active)?this.active:null:(a.active=!1,this.active=$());this._refresh()},reload:function(a,b){a=this._findTab(a);a.addClass("reloading");a[0].load_url=b||a.attr("data-tabify-url");this.active[0]==a[0]&&this._eventHandler({target:a,currentTarget:a,preventDefault:$.noop})},_ajaxSettings:function(a,b,d){var c=this;return{url:a.load_url,dataType:"html",beforeSend:function(a,b){return bm.trigger(c,c.element,"tab","beforeLoadRequestSend",[$.extend({jqXHR:a,ajaxSettings:b},
d)])}}},_findNextTab:function(a,b){function c(){a>d&&(a=0);0>a&&(a=d);return a}for(var d=this.tabs.length-1;-1!==$.inArray(c(),this.options.disabled);)a=b?a+1:a-1;return a},_createPanel:function(a){return $("<div>").attr("id","bmui-tab-"+a).addClass("bmui-tab-panel").data("bmui-tab-destroy",!0)},_delay:function(a,b){var c=this;return setTimeout(function(){return("string"===typeof a?c[a]:a).apply(c,arguments)},b||0)},_destroy:function(){this.xhr&&this.xhr.abort();this.element.removeClass("bmui-tab bmui-tab-collapsible");
this.headercontainer.removeClass("bmui-tab-header-container").removeAttr("role");this.tabs.add(this.panels).each(function(){$.data(this,"bmui-tab-destroy")?$(this).remove():$(this).removeClass("bmui-state-default bmui-state-active bmui-state-disabled bmui-corner-top bmui-corner-bottom bmui-widget-content bmui-tab-active bmui-tab-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")});
this.tabs.each(function(){var a=$(this),b=a.data("bmui-tab-aria-controls");b?a.attr("aria-controls",b).removeData("bmui-tab-aria-controls"):a.removeAttr("aria-controls")});this.panels.removeClass("bmui-state-visible");"content"!==this.options.heightStyle&&this.panels.css("height","")},_focusable:function(a){this.focusable=this.focusable.add(a);a.on("focusin."+this.eventNamespace,function(a){$(a.currentTarget).addClass("bmui-state-focus")});a.on("focusout."+this.eventNamespace,function(a){$(a.currentTarget).removeClass("bmui-state-focus")})},
_focusNextTab:function(a,b){a=this._findNextTab(a,b);this.tabs.eq(a).focus();return a},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):$()}},_getHederContainer:function(){var a=this.options.header_container?this.options.header_container instanceof $?this.options.header_container:this.element.find(this.options.header_container):this.element.find("> .bmui-tab-header-container");a.length||(a=this.element);return a},_getPanelContainer:function(){return this.options.bodies_container?
this.options.bodies_container instanceof $?this.options.bodies_container:this.element.find(this.options.bodies_container):this.element.find("> .bmui-tab-body-container")},_getPanelForTab:function(a){if(!a||!a.length)return null;if(a[0].panel)return a[0].panel;a=a.attr("data-aria-controls");return this.panelcontainer.find("> "+this._sanitizeSelector("#bmui-tab-"+a))},_getTab:function(a){return this.tabs.filter("[data-tabify-tab-id='"+a+"']")},_getTabIndex:function(a){return a.length?this.tabs.index(a):
-1},_handlePageNav:function(a){if(a.altKey&&a.keyCode===browser.key.PAGE_UP)return this.activate(this._focusNextTab(this.tabs.index(this.active)-1,!1)),!0;if(a.altKey&&a.keyCode===browser.key.PAGE_DOWN)return this.activate(this._focusNextTab(this.tabs.index(this.active)+1,!0)),!0},_hoverable:function(a){this.hoverable=this.hoverable.add(a);a.on("mouseenter."+this.eventNamespace,function(a){$(a.currentTarget).addClass("bmui-state-hover")});a.on("mouseleave."+this.eventNamespace,function(a){$(a.currentTarget).removeClass("bmui-state-hover")})},
_eventHandler:function(a){var b=this.options,c=this.active,d=$(a.currentTarget),l=d.closest(".bmui-tab-header"),n=l[0]===c[0],q=n&&b.collapsible,e=q?$():this._getPanelForTab(l),p=c.length?this._getPanelForTab(c):$();c={oldIndex:c.length?c[0].index:-1,oldTab:c,oldPanel:p,newIndex:q?"":l[0].index,newTab:q?$():l,newPanel:e};if(a.silent||!(l.hasClass("bmui-state-disabled")||l.hasClass("bmui-tab-loading")||this.running||n&&!b.collapsible&&!d.hasClass("reloading")||!1===bm.trigger(this,this.element,"tab",
"beforeActivate",[c])))b.active=q?!1:l[0].index,this.active=n&&!d.hasClass("reloading")?$():l,d.removeClass("reloading"),this.xhr&&this.xhr.abort(),p.length||e.length||$.error("jQuery UI Tabs: Mismatching fragment identifier."),e.length&&this._load(l,a),this._toggle(a,c)},_findTab:function(a){if("number"==typeof a)return this.tabs.eq(a);if("string"===typeof a||a instanceof String)return this.tabs.filter("[data-tabify-tab-id='"+a+"']");if(a instanceof $){var b=a.closest(".bmui-tab-header",this.element);
b=b.length?b:a.closest(".bmui-tab-panel",this.element);if(b.length){var c;this.tabs.each(function(){if(b[0]==this||b[0]==this.panel[0])return c=$(this),!1});if(c)return c}}return a||null},_initialActive:function(){var a=this.options.active,b=location.hash.substring(1);if(!a&&b)if(this.options.disabled.contains(b))for(var d=this.getTabIndex(b)-1;0<=d;d--){var m=this.tabs.eq(d)[0].index;if(!this.options.disabled.contains(m)){a=m;d=bm.path(location);d.fragment=a;history.pushState("tabify","expected tab disabled",
d.full);break}}else this.tabs.each(function(c,d){if($(d).attr("aria-controls")===b)return a=d.index,!1});a||(d=this.tabs.filter(".bmui-tab-active"),d.length&&(a=d[0].index));a||(a=this.tabs.length?this.tabs[0].index:null);return a},_load:function(a,b){var c=this,d=this._findTab(a),f=this._getPanelForTab(d),n={index:d[0].index,tab:d,panel:f};if(d[0].load_url){this.options.loader_template&&f.append(this.options.loader_template);var q=this._ajaxSettings(d[0],b,n);bm.trigger(c,c.element,"tab","beforeLoad",
[$.extend(q,n)]);(this.xhr=this.options.ajax_caller(q))&&"canceled"!==this.xhr.statusText&&(d.addClass("bmui-tab-loading"),f.addClass("bmui-tab-loading"),f.attr("aria-busy","true"),this.xhr.always(function(){setTimeout(function(){"abort"===status&&c.panels.stop(!1,!0);d.addClass("bmui-tab-loading-error");d.removeClass("bmui-tab-loading");f.removeClass("bmui-tab-loading");f.removeAttr("aria-busy")},1)}).done(function(a){setTimeout(function(){f.html(a).updateUi();bm.handleUrlNavigation(q.url,f);bm.trigger(c,
c.element,"tab","load",[n]);c.options.load_on_activate||(d[0].load_url=null)},1)}).fail(function(a,b,d){setTimeout(function(){f.html(c.options.content_on_load_error||(app.production?"":d));bm.trigger(c,c.element,"tab","error",[n])},1)}).always(function(a){setTimeout(function(){a===c.xhr&&delete c.xhr},1)}))}},_panelKeydown:function(a){this._handlePageNav(a)||a.ctrlKey&&a.keyCode===browser.key.UP&&this.active.focus()},_processTab:function(a){var b,c,d=$(a).attr("id"),l=$(a).attr("aria-controls");a.load_url=
$(a).attr("data-tabify-url");a.index=b=$(a).attr("data-tabify-tab-id");a.index||(a.index=b="index-"+bm.getUUID(),$(a).attr("data-tabify-tab-id",b));a.panel=c=a.panel||this.panelcontainer.find("> #bmui-tab-"+b);c.length||(c=this._createPanel(b),c.appendTo(this.panelcontainer),c.attr("aria-live","polite"),a.panel=c);this.panels=this.panels.add(c);a=$(a);l&&a.data("bmui-tab-aria-controls",l);a.attr({"aria-controls":b,"aria-labelledby":d});c.attr("aria-labelledby",d)},_processTabs:function(){var a=this;
this.headercontainer=this._getHederContainer().attr("role","tablist");this.panelcontainer=this._getPanelContainer();this.tabs=this.headercontainer.find("> .bmui-tab-header-group > .bmui-tab-group-headers > .bmui-tab-header, > .bmui-tab-header").addClass("bmui-state-default").attr({role:"tab",tabIndex:-1});this.panels=$();this.tabs.each(function(b,c){a._processTab(c)});this.panels.addClass("bmui-tab-panel").attr("role","tabpanel")},_refresh:function(){this._setupDisabled();this._setupEvents(this.options.event);
this._setupHeightStyle(this.options.heightStyle);this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1});this.panels.not(this._getPanelForTab(this.active)).removeClass("bmui-state-visible").attr({"aria-expanded":"false","aria-hidden":"true"});if(this.active.length){this.active.addClass("bmui-tab-active bmui-state-active").attr({"aria-selected":"true",tabIndex:0});if(this.options.hashnavigation&&location.hash!="#"+this.active[0].index){var a=bm.path(location);a.fragment=this.active[0].index;
history.pushState("tabify",a.fragment+"tab activated",a.full)}this._getPanelForTab(this.active).addClass("bmui-state-visible").attr({"aria-expanded":"true","aria-hidden":"false"})}else this.tabs.eq(0).attr("tabIndex",0)},_sanitizeSelector:function(a){return a?a.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},_setOption:function(a,b){this.options[a]=b;"disabled"===a&&this._setupDisabled();if("active"===a)this.activate(b);else if("disabled"===a)this._setupDisabled(b);else return"collapsible"===
a&&(this.element.toggleClass("bmui-tab-collapsible",b),b||!1!==this.options.active||this.activate(0)),"event"===a&&this._setupEvents(b),"heightStyle"===a&&this._setupHeightStyle(b),this},_setOptions:function(a){for(var b in a)this._setOption(b,a[b]);return this},_setupDisabled:function(a){a="undefined"==typeof a?this.options.disabled:a;var b=$(),c=$();!0===a?b=this.tabs:!1===a?c=this.tabs:this.tabs.each(function(d){-1<$.inArray(this.index,a)||-1<$.inArray(d,a)?b=b.add($(this)):c=c.add($(this))});
b.addClass("bmui-state-disabled").attr("aria-disabled","true");c.removeClass("bmui-state-disabled").removeAttr("aria-disabled");this.options.disabled=b.length?b.length==this.tabs.length?!0:a:!1},_setupEvents:function(a){var b=this,c={keydown:$.proxy(this._tabKeydown,this)};a&&$.each(a.split(" "),function(a,d){c[d]=$.proxy(b._eventHandler,b)});$.extend(this._handlers,c);this.tabs.add(this.panels).off("."+this.eventNamespace);this.tabs.find(".close").off("."+this.eventNamespace).on("click."+this.eventNamespace,
function(){var a=$(this).closest(".bmui-tab-header"),c=b._getPanelForTab(a),d=a[0].index;!1!==bm.trigger(b,b.element,"tab","beforeRemove",[{tab:a,panel:c,index:d}])&&(b.remove(d),bm.trigger(b,b.element,"tab","remove",[{tab:a,panel:c,index:d}]))});this.panels.on("keydown."+this.eventNamespace,$.proxy(this._panelKeydown,this));this._setupTabEvents(this.tabs)},_setupHeightStyle:function(a){var b=this.element.parent();if("fill"===a){var c=b.height();c-=this.element.outerHeight()-this.element.height();
this.element.siblings(":visible").each(function(){var a=$(this),b=a.css("position");"absolute"!==b&&"fixed"!==b&&(c-=a.outerHeight(!0))});this.element.children().not(this.panels).each(function(){c-=$(this).outerHeight(!0)});this.panels.each(function(){$(this).height(Math.max(0,c-$(this).innerHeight()+$(this).height()))}).css("overflow","auto")}else"auto"===a&&(c=0,this.panels.each(function(){c=Math.max(c,$(this).height("").height())}).height(c))},_setupTabEvents:function(a){var b=this;$.each(this._handlers,
function(c,d){a.on(c+"."+b.eventNamespace,$.proxy(d,b))});this._focusable(a);this._hoverable(a)},_tabKeydown:function(a){var b=$(this[0].document.activeElement).closest(".bmui-tab-header"),c=this.tabs.index(b),d=!0;if(!this._handlePageNav(a)){switch(a.keyCode){case browser.key.RIGHT:case browser.key.DOWN:c++;break;case browser.key.UP:case browser.key.LEFT:d=!1;c--;break;case browser.key.END:c=this.tabs.length-1;break;case browser.key.HOME:c=0;break;case browser.key.SPACE:a.preventDefault();clearTimeout(this.activating);
this.activate(c);return;case browser.key.ENTER:a.preventDefault();clearTimeout(this.activating);this.activate(c===this.tabs.index(this.active)?!1:c);return;default:return}clearTimeout(this.activating);c=this._focusNextTab(c,d);if(!a.ctrlKey){b.attr("aria-selected","false");var l=this.tabs.eq(c).attr("aria-selected","true");this.activating=this._delay(function(){this.option("active",l[0].index)},this.delay)}}},_toggle:function(a,b){var c=b.newPanel,d=b.oldPanel;this.running=!0;b.oldTab.closest(".bmui-tab-header").removeClass("bmui-tab-active bmui-state-active");
d.removeClass("bmui-state-visible");b.newTab.closest(".bmui-tab-header").addClass("bmui-tab-active bmui-state-active");if(this.options.hashnavigation&&location.hash!="#"+b.newTab[0].index){var f=bm.path(location);f.fragment=b.newTab[0].index;history.pushState("tabify",f.fragment+"tab activated",f.full)}c.addClass("bmui-state-visible");this.running=!1;a.silent||bm.trigger(this,this.element,"tab","activate",[b]);d.attr({"aria-expanded":"false","aria-hidden":"true"});b.oldTab.attr("aria-selected","false");
c.length&&d.length?b.oldTab.attr("tabIndex",-1):c.length&&this.tabs.filter(function(){return 0===$(this).attr("tabIndex")}).attr("tabIndex",-1);c.attr({"aria-expanded":"true","aria-hidden":"false"});b.newTab.attr({"aria-selected":"true",tabIndex:0})}};bm.jquerify("tabify",d)})();
bm.ui_updaters&&bm.ui_updaters.push(function(){this.find(".bmui-tab").tabify({loader_template:'<div class="mask-overlay"><span class="loader"></span></div>'}).on("tab:beforeLoad",function(a,b){b.panel.addClass("masked-div")}).on("tab:load tab:error",function(a,b){b.panel.removeClass("masked-div")})});var getWcuiTreePersistData=null,DTNodeStatus_Error=-1,DTNodeStatus_Loading=1,DTNodeStatus_Ok=0;$.wcui_tree_parallel_max_load=10;
(function(a){var b={create:function(){return function(){this.initialize.apply(this,arguments)}}},d=b.create();d.prototype={initialize:function(b,c,d){this.parent=b;this.tree=c;"string"===typeof d&&(d={title:d});c._nodeCount++;this.data=a.extend({},g.nodedatadefaults,d);this.key=""+(void 0==d[c.options.key_prop]?c._nodeCount:d[c.options.key_prop]);this.childList=this.node=this.span=this.el=null;this.isHighlighted=this.bSelected=this.bExpanded=this.hasSubSel=this._isLoading=!1},toString:function(){return"WcuiTreeNode<"+
this.key+">: '"+this.data[this.options.title_prop]+"'"},toDict:function(b,c){var d=a.extend({},this.data);d.activate=this.tree.activeNode===this;d.focus=this.tree.focusNode===this;d.expand=this.bExpanded;d.select=this.bSelected;c&&c(d);if(b&&this.childList){d.children=[];b=0;for(var f=this.childList.length;b<f;b++)d.children.push(this.childList[b].toDict(!0,c))}else delete d.children;return d},redraw:function(){this.is_rendered&&this.render(!1)},fromDict:function(b){var c=b.children;void 0===c?(this.data=
a.extend(this.data,b),this.render()):(b=a.extend({},b),b.children=void 0,this.data=a.extend(this.data,b),this.removeChildren(),this.addChild(c))},_getInnerHtml:function(){var a=this.tree,b=a.options,c=a.cache,d=this.getLevel(),e=this.data,f="";d<b.minExpandLevel?1<d&&(f+=c.tagConnector):f=!1!==this.hasChildren()?f+c.tagExpander:f+c.tagConnector;b.checkbox&&!0!==e.hideCheckbox&&!e.isStatusNode&&(f+=c.tagCheckbox);e.icon?(c="/"===e.icon.charAt(0)?e.icon:b.imagePath+e.icon,f+="<img src='"+c+"' alt='' />"):
!1!==e.icon&&(f=e.iconClass?f+("<span class=' "+e.iconClass+"'></span>"):f+c.tagNodeIcon);c="";b.onCustomRender&&(c=b.onCustomRender.call(a,this)||"");c||(a=e.tooltip?' title="'+e.tooltip.replace(/\"/g,"&quot;")+'"':"",c=e.href||"#",c=b.noLink||e.noLink?'<span style="display:inline-block;" class="'+b.classNames.title+'"'+a+">"+e[b.title_prop]+"</span>":'<a href="'+c+'" class="'+b.classNames.title+'"'+a+">"+e[b.title_prop]+"</a>");return f+c},_fixOrder:function(){var a=this.childList;if(a&&this.node)for(var b=
this.node.firstChild,c=0,d=a.length-1;c<d;c++){var e=a[c],f=b.dtnode;e!==f?this.node.insertBefore(e.el,f.el):b=b.nextSibling}},_createEl:function(){var a=this.tree.options,b=this.data,c=this.isLastSibling(),d=a.classNames,e=this.tree;this.el||(this.el=document.createElement("div"),this.el.className=d.nodeContainer+(c?" "+d.lastsib:""),this.el.dtnode=this,this.key&&(this.el.id=a.idPrefix+this.tree.uuid+"-"+this.key),this.span=document.createElement("span"),this.span.className=d.title,this.el.appendChild(this.span));
this.span.innerHTML=this._getInnerHtml();var f=[];f.push(d.node);b.isFolder&&f.push(d.folder);a.type_prop&&b[a.type_prop]?f.push(b[a.type_prop]):a.node_type&&f.push(a.node_type);this.bExpanded&&f.push(d.expanded);!1!==this.hasChildren()&&(f.push(d.hasChildren),null===this.childList&&(b.isLazy=!0));b.isLazy&&null===this.childList&&f.push(d.lazy);c&&f.push(d.lastsib);this.bSelected&&f.push(d.selected);this.hasSubSel&&f.push(d.partsel);e.activeNode===this&&f.push(d.active);b.clazz&&f.push(b.clazz);this.isHighlighted&&
f.push(d.highlighted);f.push(d.combinedExpanderPrefix+(this.bExpanded?"e":"c")+(b.isLazy&&null===this.childList?"d":"")+(c?"l":""));f.push(d.combinedIconPrefix+(this.bExpanded?"e":"c")+(b.isFolder?"f":""));this.span.className=f.join(" ");!this.is_rendered&&a.onCreate&&a.onCreate.call(e,this,this.span);a.onRender&&a.onRender.call(e,this,this.span)},render:function(b){var c=this.parent,d=this.tree.options,f=d.classNames;if(c||this.node)c&&(this._createEl(),this.is_rendered||(c.node||c._createNode(),
c.node.appendChild(this.el)));else{this.node=document.createElement("div");this.node.className="wcui-tree";if(d.tree_root_data){this._createEl();var e=this.node;this.node=document.createElement("div");a(e).append(this.el);a(this.el).append(this.node)}else this.el=this.key=this.span=null;this.node.className=1<d.minExpandLevel?this.node.className+(" "+f.container+" "+f.noConnector):this.node.className+(" "+f.container)}if(this.bExpanded&&this.childList){f=0;for(e=this.childList.length;f<e;f++)this.childList[f].render(!1);
this._fixOrder()}this.node&&(f="none"===this.node.style.display,e=!!this.bExpanded,b&&d.fx&&f===e?(b=d.fx.duration||200,a(this.node).animate(d.fx,b)):this.node.style.display=this.bExpanded||!c?"":"none");this.is_rendered=!0},getKeyPath:function(a){var b=[];this.visitParents(function(a){a.parent&&b.unshift(a.key)},!a);return"/"+b.join(this.tree.options.keyPathSeparator)},getParent:function(){return this.parent},getChildren:function(){if(void 0!==this.hasChildren())return this.childList},hasChildren:function(){if(this.data.isLazy){if(null===
this.childList||void 0===this.childList)return;if(0===this.childList.length)return!1;if(1===this.childList.length&&this.childList[0].isStatusNode())return}return this.childList?!0:!!this.data[this.tree.options.has_child_prop]},isFirstSibling:function(){var a=this.parent;return!a||a.childList[0]===this},isLastSibling:function(){var a=this.parent;return!a||a.childList[a.childList.length-1]===this},isLoading:function(){return!!this._isLoading},getPrevSibling:function(){if(!this.parent)return null;for(var a=
this.parent.childList,b=1,c=a.length;b<c;b++)if(a[b]===this)return a[b-1];return null},getNextSibling:function(){if(!this.parent)return null;for(var a=this.parent.childList,b=0,c=a.length-1;b<c;b++)if(a[b]===this)return a[b+1];return null},isStatusNode:function(){return!0===this.data.isStatusNode},isChildOf:function(a){return this.parent&&this.parent===a},isDescendantOf:function(a){if(!a)return!1;for(var b=this.parent;b;){if(b===a)return!0;b=b.parent}return!1},countChildren:function(){var a=this.childList;
if(!a)return 0;for(var b=a.length,c=0,d=b;c<d;c++)b+=a[c].countChildren();return b},sortChildren:function(a,b){var c=this.childList;if(c){a=a||function(a,b){a=a.data[opts.title_prop].toLowerCase();b=b.data[opts.title_prop].toLowerCase();return a===b?0:a>b?1:-1};c.sort(a);if(b)for(var d=0,e=c.length;d<e;d++)c[d].childList&&c[d].sortChildren(a,"$norender$");"$norender$"!==b&&this.render()}},_setStatusNode:function(a){var b=this.childList?this.childList[0]:null;if(a)b?(a.isStatusNode=!0,a[this.tree.options.key_prop]=
"_statusNode",b.data=a,b.render()):(a.isStatusNode=!0,a[this.tree.options.key_prop]="_statusNode",this.addChild(a));else if(b&&b.isStatusNode()){try{this.node&&(this.node.removeChild(b.el),b.el=null)}catch(n){}1===this.childList.length?this.childList=[]:this.childList.shift()}},setLazyNodeStatus:function(b,c){var d=c&&c.tooltip?c.tooltip:null;c=c&&c.info?" ("+c.info+")":"";switch(b){case DTNodeStatus_Ok:this._setStatusNode(null);a(this.span).removeClass(this.tree.options.classNames.nodeLoading);this._isLoading=
!1;this.tree.options.autoFocus&&(this===this.tree.tnRoot&&this.childList&&0<this.childList.length?this.childList[0].focus():this.focus());break;case DTNodeStatus_Loading:this._isLoading=!0;a(this.span).addClass(this.tree.options.classNames.nodeLoading);this.parent||this._setStatusNode({title:this.tree.options.strings.loading+c,tooltip:d,clazz:this.tree.options.classNames.nodeWait});break;case DTNodeStatus_Error:this._isLoading=!1;this._setStatusNode({title:this.tree.options.strings.loadError+c,tooltip:d,
clazz:this.tree.options.classNames.nodeError});break;default:throw"Bad LazyNodeStatus: '"+b+"'.";}},_parentList:function(a,b){var c=[];for(b=b?this:this.parent;b;)(a||b.parent)&&c.unshift(b),b=b.parent;return c},getLevel:function(){for(var a=0,b=this.parent;b;)a++,b=b.parent;return a},_getTypeForOuterNodeEvent:function(a){var b=this.tree.options.classNames,c=a.target;if(0>c.className.indexOf(b.node))return null;var d=a.pageX-c.offsetLeft;a=a.pageY-c.offsetTop;for(var e=0,f=c.childNodes.length;e<f;e++){var g=
c.childNodes[e],m=g.offsetLeft-c.offsetLeft,y=g.offsetTop-c.offsetTop,A=g.clientWidth,x=g.clientHeight;if(d>=m&&d<=m+A&&a>=y&&a<=y+x){if(g.className==b.title)return"title";if(g.className==b.expander)return"expander";if(g.className==b.checkbox)return"checkbox";if(g.className==b.nodeIcon)return"icon"}}return"prefix"},getEventTargetType:function(a){var b=a&&a.target?a.target.className:"",c=this.tree.options.classNames;return b===c.title?"title":b===c.expander?"expander":b===c.checkbox?"checkbox":b===
c.nodeIcon?"icon":b===c.empty||b===c.vline||b===c.connector?"prefix":0<=b.indexOf(c.node)?this._getTypeForOuterNodeEvent(a):null},isVisible:function(){for(var a=this._parentList(!0,!1),b=0,c=a.length;b<c;b++)if(!a[b].bExpanded)return!1;return!0},makeVisible:function(){for(var a=this._parentList(!0,!1),b=0,c=a.length;b<c;b++)a[b]._expand(!0)},focus:function(){this.makeVisible();try{a(this.span).find(">a").focus()}catch(m){}},isFocused:function(){return this.tree.tnFocused===this},_activate:function(b,
c){var d=this.tree.options;if(!(this.data.isStatusNode||c&&d.onQueryActivate&&!1===d.onQueryActivate.call(this.tree,b,this)))if(b){if(this.tree.activeNode){if(this.tree.activeNode===this)return;this.tree.activeNode.deactivate()}d.activeVisible&&this.makeVisible();this.tree.activeNode=this;d.persist&&a.cookie(d.cookieId+"-active",this.key,d.cookie);this.tree.persistence.activeKey=this.key;a(this.span).addClass(d.classNames.active);c&&d.onActivate&&d.onActivate.call(this.tree,this)}else this.tree.activeNode!==
this||d.onQueryActivate&&!1===d.onQueryActivate.call(this.tree,!1,this)||(a(this.span).removeClass(d.classNames.active),d.persist&&a.cookie(d.cookieId+"-active","",d.cookie),this.tree.persistence.activeKey=null,this.tree.activeNode=null,c&&d.onDeactivate&&d.onDeactivate.call(this.tree,this))},mark:function(b){var c=this.tree.options;!1!==b?(this.makeVisible(),b=a(this.span),b.hasClass(c.classNames.marked)||(this.tree.markedNode&&this.tree.markedNode.mark(!1),b.addClass(c.classNames.marked),this.isMarkedNode=
!0,this.tree.markedNode=this)):(b=a(this.span),this.isMarkedNode=!1,b.removeClass(c.classNames.marked),this.tree.markedNode=null)},_createNode:function(){var a=this.tree.options,b=a.classNames;this.node=document.createElement("div");this.node.style.display="none";this.el.appendChild(this.node);a.minExpandLevel>this.getLevel()?this.node.className=b.container+" "+b.noConnector:this.node.className=b.container},activate:function(a){this._activate(!0,!a)},_highlight:function(b){var c=this.tree.options,
d=a(this.span);b?d.hasClass(c.classNames.highlighted)||(d.addClass(c.classNames.highlighted),this.isHighlighted=!0,this.tree.hilightedNodes.push(this)):(this.isHighlighted=!1,d.removeClass(c.classNames.highlighted),this.tree.hilightedNodes.remove(this))},highlight:function(a){!1===a?this._highlight(!1):this._highlight(!0)},deactivate:function(a){this._activate(!1,!a)},isActive:function(){return this.tree.activeNode===this},_userActivate:function(){var a=!0,b=!1;if(this.data.isFolder)switch(this.tree.options.clickFolderMode){case 2:a=
!1;b=!0;break;case 3:a=b=!0}null===this.parent&&(b=!1);b&&(this.toggleExpand(),this.focus());a&&this.activate()},_setSubSel:function(b){b?(this.hasSubSel=!0,a(this.span).addClass(this.tree.options.classNames.partsel)):(this.hasSubSel=!1,a(this.span).removeClass(this.tree.options.classNames.partsel))},_updatePartSelectionState:function(){if(!this.hasChildren()){var a=this.bSelected&&!this.data.unselectable&&!this.data.isStatusNode;this._setSubSel(!1);return a}var b,c=this.childList,d=!0,e=!0;a=0;for(b=
c.length;a<b;a++){var f=c[a]._updatePartSelectionState();!1!==f&&(e=!1);!0!==f&&(d=!1)}a=d?!0:e?!1:void 0;this._setSubSel(void 0===a);this.bSelected=!0===a;return a},_fixSelectionState:function(){var a,b;if(this.bSelected)for(this.visit(function(a){a.parent._setSubSel(!0);a.data.unselectable||a._select(!0,!1,!1)}),a=this.parent;a;){a._setSubSel(!0);var c=!0;var d=0;for(b=a.childList.length;d<b;d++){var e=a.childList[d];if(!e.bSelected&&!e.data.isStatusNode&&!e.data.unselectable){c=!1;break}}c&&a._select(!0,
!1,!1);a=a.parent}else for(this._setSubSel(!1),this.visit(function(a){a._setSubSel(!1);a._select(!1,!1,!1)}),a=this.parent;a;){a._select(!1,!1,!1);c=!1;d=0;for(b=a.childList.length;d<b;d++)if(a.childList[d].bSelected||a.childList[d].hasSubSel){c=!0;break}a._setSubSel(c);a=a.parent}},_select:function(b,c,d){var f=this.tree.options;this.data.isStatusNode||this.bSelected===b||c&&f.onQuerySelect&&!1===f.onQuerySelect.call(this.tree,b,this)||(1==f.selectMode&&b&&this.tree.visit(function(a){if(a.bSelected)return a._select(!1,
!1,!1),!1}),(this.bSelected=b)?(f.persist&&this.tree.persistence.addSelect(this.key),a(this.span).addClass(f.classNames.selected),d&&3===f.selectMode&&this._fixSelectionState(),c&&f.onSelect&&f.onSelect.call(this.tree,!0,this)):(f.persist&&this.tree.persistence.clearSelect(this.key),a(this.span).removeClass(f.classNames.selected),d&&3===f.selectMode&&this._fixSelectionState(),c&&f.onSelect&&f.onSelect.call(this.tree,!1,this)))},select:function(a){return this.data.unselectable?this.bSelected:this._select(!1!==
a,!0,!0)},toggleSelect:function(){return this.select(!this.bSelected)},isSelected:function(){return this.bSelected},isLazy:function(){return!!this.data.isLazy},_loadContent:function(a,b,c){b=b||{};try{var d=this.tree.options;this.setLazyNodeStatus(DTNodeStatus_Loading);d.onLazyRead?!0===d.onLazyRead.call(this.tree,this,b)&&(this.setLazyNodeStatus(DTNodeStatus_Ok),b.done&&b.done()):(this.data.load_url||d.load_url)&&this.appendAjax({renderChilds:a,url:this.data.load_url||d.load_url,data:{key:this.key},
success:b.done,error:b.fail},c)}catch(e){this.setLazyNodeStatus(DTNodeStatus_Error,{tooltip:""+e}),b.fail&&b.fail()}},_expand:function(a,b){if(this.bExpanded!==a){var c=this.tree.options;if(a||!(this.getLevel()<c.minExpandLevel))if(!c.onQueryExpand||!1!==c.onQueryExpand.call(this.tree,a,this)){this.bExpanded=a;c.persist&&(a?this.tree.persistence.addExpand(this.key):this.tree.persistence.clearExpand(this.key));this.render(!(this.data.isLazy&&null===this.childList)&&!this._isLoading&&!b);if(this.bExpanded&&
this.parent&&c.autoCollapse){b=this._parentList(!1,!0);for(var d=0,e=b.length;d<e;d++)b[d].collapseSiblings()}c.activeVisible&&this.tree.activeNode&&!this.tree.activeNode.isVisible()&&this.tree.activeNode.deactivate();a&&this.data.isLazy&&null===this.childList&&!this._isLoading?this._loadContent(void 0,void 0,!0):c.onExpand&&c.onExpand.call(this.tree,a,this)}}},isExpanded:function(){return this.bExpanded},expand:function(a){a=!1!==a;!this.childList&&!this.data.isLazy&&a||null===this.parent&&!a||this._expand(a)},
scheduleAction:function(a,b){this.tree.timer&&clearTimeout(this.tree.timer);var c=this;switch(a){case "cancel":break;case "expand":this.tree.timer=setTimeout(function(){c.expand(!0)},b);break;case "activate":this.tree.timer=setTimeout(function(){c.activate()},b);break;default:throw"Invalid mode "+a;}},toggleExpand:function(){this.expand(!this.bExpanded)},collapseSiblings:function(){if(null!==this.parent)for(var a=this.parent.childList,b=0,c=a.length;b<c;b++)a[b]!==this&&a[b].bExpanded&&a[b]._expand(!1)},
_onClick:function(a){a=this.getEventTargetType(a);if("expander"===a)this.toggleExpand(),this.focus();else if("checkbox"===a)this.toggleSelect(),this.focus();else if(this._userActivate(),a=this.span.getElementsByTagName("a"),a[0])browser.ie&&9>browser.version||a[0].focus();else return!0},_onKeydown:function(a){var b=!0,c;switch(a.which){case 107:case 187:this.bExpanded||this.toggleExpand();break;case 109:case 189:this.bExpanded&&this.toggleExpand();break;case 32:this._userActivate();break;case 8:this.parent&&
this.parent.focus();break;case 37:this.bExpanded?(this.toggleExpand(),this.focus()):this.parent&&this.parent.parent&&this.parent.focus();break;case 39:this.bExpanded||!this.childList&&!this.data.isLazy?this.childList&&this.childList[0].focus():(this.toggleExpand(),this.focus());break;case 38:for(c=this.getPrevSibling();c&&c.bExpanded&&c.childList;)c=c.childList[c.childList.length-1];!c&&this.parent&&this.parent.parent&&(c=this.parent);c&&c.focus();break;case 40:if(this.bExpanded&&this.childList)c=
this.childList[0];else for(var d=this._parentList(!1,!0),e=d.length-1;0<=e&&!(c=d[e].getNextSibling());e--);c&&c.focus();break;default:b=!1}b&&a.preventDefault()},_onFocus:function(b){var c=this.tree.options;if("blur"==b.type||"focusout"==b.type)c.onBlur&&c.onBlur.call(this.tree,this),this.tree.tnFocused&&a(this.tree.tnFocused.span).removeClass(c.classNames.focused),this.tree.tnFocused=null,c.persist&&a.cookie(c.cookieId+"-focus","",c.cookie);else if("focus"==b.type||"focusin"==b.type)this.tree.tnFocused&&
this.tree.tnFocused!==this&&a(this.tree.tnFocused.span).removeClass(c.classNames.focused),this.tree.tnFocused=this,c.onFocus&&c.onFocus.call(this.tree,this),a(this.tree.tnFocused.span).addClass(c.classNames.focused),c.persist&&a.cookie(c.cookieId+"-focus",this.key,c.cookie)},visit:function(a,b){var c=!0;if(!0===b&&(c=a(this),!1===c||"skip"==c))return c;if(this.childList){b=0;for(var d=this.childList.length;b<d&&(c=this.childList[b].visit(a,!0),!1!==c);b++);}return c},visitParents:function(a,b){if(b&&
!1===a(this))return!1;for(b=this.parent;b;){if(!1===a(b))return!1;b=b.parent}return!0},remove:function(){if(this===this.tree.root)throw"Cannot remove system root";return this.parent.removeChild(this)},removeChild:function(a){var b=this.childList;if(1==b.length){if(a!==b[0])throw"removeChild: invalid child";return this.removeChildren()}a===this.tree.activeNode&&a.deactivate();this.tree.options.persist&&(a.bSelected&&this.tree.persistence.clearSelect(a.key),a.bExpanded&&this.tree.persistence.clearExpand(a.key));
a.removeChildren(!0);this.node&&this.node.removeChild(a.el);for(var c=0,d=b.length;c<d;c++)if(b[c]===a){this.childList.splice(c,1);break}},removeChildren:function(b,c){var d=this.tree,f=this.childList;if(f){for(var e=0,g=f.length;e<g;e++){var l=f[e];l!==d.activeNode||c||l.deactivate();this.tree.options.persist&&!c&&(l.bSelected&&this.tree.persistence.clearSelect(l.key),l.bExpanded&&this.tree.persistence.clearExpand(l.key));l.removeChildren(!0,c);this.node&&a("div."+this.tree.options.classNames.nodeContainer,
a(this.node)).remove()}this.childList=null}b||(this._isLoading=!1,this.render())},setTitle:function(a){this.fromDict({title:a})},reloadChildren:function(a){if(null===this.parent)throw"Use tree.reload() instead";if(!this.data.isLazy)throw"node.reloadChildren() requires lazy nodes.";if(a){var b=this,c="nodeLoaded.tree."+this.tree.$tree.attr("id")+"."+this.key;this.tree.$tree.bind(c,function(d,e,f){b.tree.$tree.unbind(c);if(e!==b)throw"got invalid load event";a.call(b.tree,e,f)})}this.removeChildren();
this._loadContent()},_loadKeyPath:function(a,b){var c=this.tree;if(""===a)throw"Key path must not be empty";var d=a.split(c.options.keyPathSeparator);if(""===d[0])throw"Key path must be relative (don't start with '/')";a=d.shift();if(this.childList)for(var e=0,f=this.childList.length;e<f;e++){var g=this.childList[e];if(g.key===a){0===d.length?b.call(c,g,"ok"):!g.data.isLazy||null!==g.childList&&void 0!==g.childList?(b.call(c,g,"loaded"),g._loadKeyPath(d.join(c.options.keyPathSeparator),b)):g.reloadChildren(function(a,
e){e?(b.call(c,g,"loaded"),a._loadKeyPath(d.join(c.options.keyPathSeparator),b)):b.call(c,g,"error")});return}}b.call(c,void 0,"notfound",a,0===d.length)},resetLazy:function(){if(null===this.parent)throw"Use tree.reload() instead";if(!this.data.isLazy)throw"node.resetLazy() requires lazy nodes.";this.expand(!1);this.removeChildren()},_addChildNode:function(b,c){var d=this.tree,f=d.options,e=d.persistence;b.parent=this;null===this.childList?this.childList=[]:c||0<this.childList.length&&a(this.childList[this.childList.length-
1].span).removeClass(f.classNames.lastsib);if(c){c=a.inArray(c,this.childList);if(0>c)throw"<beforeNode> must be a child of <this>";this.childList.splice(c,0,b)}else this.childList.push(b);c=d.isInitializing();f.persist&&e.cookiesFound&&c?(e.activeKey===b.key&&(d.activeNode=b),e.focusedKey===b.key&&(d.focusNode=b),b.bExpanded=0<=a.inArray(b.key,e.expandedKeyList),b.bSelected=0<=a.inArray(b.key,e.selectedKeyList)):(b.data.activate&&(d.activeNode=b,f.persist&&(e.activeKey=b.key)),b.data.focus&&(d.focusNode=
b,f.persist&&(e.focusedKey=b.key)),b.bExpanded=!0===b.data.expand,b.bExpanded&&f.persist&&e.addExpand(b.key),b.bSelected=!0===b.data.select,b.bSelected&&f.persist&&e.addSelect(b.key));f.minExpandLevel>=b.getLevel()&&(this.bExpanded=!0);if(b.bSelected&&3==f.selectMode)for(f=this;f;)f.hasSubSel||f._setSubSel(!0),f=f.parent;d.bEnableUpdate&&this.render();return b},addChild:function(a,b,c){void 0===c&&(c=!0);if("string"==typeof a)throw"Invalid data type for "+a;if(a&&0!==a.length){if(a instanceof d)return[this._addChildNode(a,
b)];a.length||(a=[a]);for(var f=this.tree.enableUpdate(!1),e=[],g=0,l=a.length;g<l;g++){var m=a[g],n=this._addChildNode(new d(this,this.tree,m),b);e.push(n);m.children&&n.addChild(m.children)}c?this.tree.enableUpdate(f):this.tree.bEnableUpdate=f;return e}},appendAjax:function(b,c){function d(){var a=this._ajax_options,d=a.success,e=a.error;a.success=d?function(){d.apply(this,arguments);b.success.apply(this,arguments)}:b.success;a.error=e?function(){e.apply(this,arguments);b.error.apply(this,arguments)}:
b.error;if(c){var f=this.key;(a=this.tree.wcui_tree_queue_manager.index(function(){return f==this.key}))&&this.tree.wcui_tree_queue_manager.top(a)}}function f(){var c=this;this.setLazyNodeStatus(DTNodeStatus_Loading);var d="nodeLoaded.tree."+this.tree.$tree.attr("id")+"."+this.key,e=a.extend({},this.tree.options.ajaxDefaults,this._ajax_options,{response:function(){delete c._ajax_options},success:function(f,g){c.tree.wcui_tree_queue_manager.dec();var l=c.tree.phase;c.tree.phase="init";e.postProcess?
f=e.postProcess.call(this,f,this.dataType):f&&f.hasOwnProperty("d")&&(f="string"==typeof f.d?a.parseJSON(f.d):f.d);if(!a.isArray(f)||0!==f.length){var m=c.addChild(f,null,b.renderChilds);c.tree.options.auto_load_lazy_nodes&&a.each(m,function(){this.needLazyCall()&&this._loadContent(!1)})}c.redraw();c.tree.phase="postInit";c.tree.$tree.trigger(d,[c,!0]);c.tree.phase=l;!1!==b.renderChilds&&c.setLazyNodeStatus(DTNodeStatus_Ok);b.success&&b.success.call(e,c,f,g)},error:function(a,f,g){c.tree.wcui_tree_queue_manager.dec();
c.tree.$tree.trigger(d,[c,!1]);c.setLazyNodeStatus(DTNodeStatus_Error,{info:f,tooltip:""+g});b.error&&b.error.call(e,c,a,f,g)},complete:function(){c.tree._xhrs.splice(c.tree._xhrs.indexOf(c._xhr),1);0==c.tree._xhrs.length&&delete c.tree._xhrs}});this.tree._xhrs||(this.tree._xhrs=[]);this._xhr=this.tree.options.ajax_caller(e);this.tree._xhrs.push(this._xhr)}if(this._ajax_options)d.call(this);else{this._ajax_options=b;var e={key:this.key,_this:this,caller:f};this.tree.wcui_tree_queue_manager.push(e,
c);this.tree.wcui_tree_queue_manager.hasFreeSlot()&&(e=this.tree.wcui_tree_queue_manager.pop(),this.tree.wcui_tree_queue_manager.inc(),f.call(e._this))}},move:function(b,c){if(this!==b){if(!this.parent)throw"Cannot move system root";if(void 0===c||"over"==c)c="child";var d=this.parent,f="child"===c?b:b.parent;if(f.isDescendantOf(this))throw"Cannot move a node to it's own descendant";if(1==this.parent.childList.length)this.parent.childList=this.parent.data.isLazy?[]:null,this.parent.bExpanded=!1;else{var e=
a.inArray(this,this.parent.childList);if(0>e)throw"Internal error";this.parent.childList.splice(e,1)}this.parent.node&&this.parent.node.removeChild(this.el);this.parent=f;if(f.hasChildren())switch(c){case "child":f.childList.push(this);break;case "before":e=a.inArray(b,f.childList);if(0>e)throw"Internal error";f.childList.splice(e,0,this);break;case "after":e=a.inArray(b,f.childList);if(0>e)throw"Internal error";f.childList.splice(e+1,0,this);break;default:throw"Invalid mode "+c;}else f.childList=
[this];f.node||f._createNode();this.el&&f.node.appendChild(this.el);if(this.tree!==b.tree)throw this.visit(function(a){a.tree=b.tree},null,!0),"Not yet implemented.";d.isDescendantOf(f)||d.render();f.isDescendantOf(d)||f.render()}},needLazyCall:function(){return(this.data.isLazy||!1!==this.hasChildren())&&null===this.childList}};var c=b.create();c._getTreePersistData=function(a,b){a=new c(a,b);a.read();return a.toDict()};getWcuiTreePersistData=c._getTreePersistData;c.prototype={initialize:function(b,
c){void 0===b&&(b=g.prototype.options.cookieId);c=a.extend({},g.prototype.options.cookie,c);this.cookieId=b;this.cookieOpts=c;this.cookiesFound=void 0;this.selectedKeyList=this.expandedKeyList=this.focusedKey=this.activeKey=null},read:function(){this.cookiesFound=!1;var b=a.cookie(this.cookieId+"-active");this.activeKey=null===b?"":b;null!==b&&(this.cookiesFound=!0);b=a.cookie(this.cookieId+"-focus");this.focusedKey=null===b?"":b;null!==b&&(this.cookiesFound=!0);b=a.cookie(this.cookieId+"-expand");
this.expandedKeyList=null===b?[]:b.split(",");null!==b&&(this.cookiesFound=!0);b=a.cookie(this.cookieId+"-select");this.selectedKeyList=null===b?[]:b.split(",");null!==b&&(this.cookiesFound=!0)},write:function(){a.cookie(this.cookieId+"-active",null===this.activeKey?"":this.activeKey,this.cookieOpts);a.cookie(this.cookieId+"-focus",null===this.focusedKey?"":this.focusedKey,this.cookieOpts);a.cookie(this.cookieId+"-expand",null===this.expandedKeyList?"":this.expandedKeyList.join(","),this.cookieOpts);
a.cookie(this.cookieId+"-select",null===this.selectedKeyList?"":this.selectedKeyList.join(","),this.cookieOpts)},addExpand:function(b){0>a.inArray(b,this.expandedKeyList)&&(this.expandedKeyList.push(b),a.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts))},clearExpand:function(b){b=a.inArray(b,this.expandedKeyList);0<=b&&(this.expandedKeyList.splice(b,1),a.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts))},addSelect:function(b){0>a.inArray(b,
this.selectedKeyList)&&(this.selectedKeyList.push(b),a.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts))},clearSelect:function(b){b=a.inArray(b,this.selectedKeyList);0<=b&&(this.selectedKeyList.splice(b,1),a.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts))},isReloading:function(){return!0===this.cookiesFound},toDict:function(){return{cookiesFound:this.cookiesFound,activeKey:this.activeKey,focusedKey:this.activeKey,expandedKeyList:this.expandedKeyList,
selectedKeyList:this.selectedKeyList}}};var f=b.create();f.version="$Version: 1.2.4$";f.prototype={initialize:function(b){var c=this;this.phase="init";this.$widget=b;this.options=b.options;this.$tree=b.element;this.timer=null;this.divTree=this.$tree.get(0);this.wcui_tree_queue_manager=QueueManager(a.wcui_tree_parallel_max_load,function(a){c.wcui_tree_queue_manager.inc();a.caller.call(a._this)})},_load:function(b){var f=this.options;this.bEnableUpdate=!0;this._nodeCount=1;this.activeNode=null;this.hilightedNodes=
[];this.focusNode=null;1>f.minExpandLevel&&(f.minExpandLevel=1);f.classNames!==g.prototype.options.classNames&&(f.classNames=a.extend({},g.prototype.prototype.options.classNames,f.classNames));f.ajaxDefaults!==g.prototype.options.ajaxDefaults&&(f.ajaxDefaults=a.extend({},g.prototype.options.ajaxDefaults,f.ajaxDefaults));f.dnd!==g.prototype.options.dnd&&(f.dnd=a.extend({},g.prototype.options.dnd,f.dnd));f.imagePath||a("script").each(function(){if(0<=this.src.search(/.*tree[^\/]*\.js$/i))return 0<=
this.src.indexOf("/")?f.imagePath=this.src.slice(0,this.src.lastIndexOf("/"))+"/skin/":f.imagePath="skin/",!1});this.persistence=new c(f.cookieId,f.cookie);f.persist&&(a.cookie||a.error("Please include jquery.cookie.js to use persistence."),this.persistence.read());this.cache={tagEmpty:"<span class='"+f.classNames.empty+"'></span>",tagVline:"<span class='"+f.classNames.vline+"'></span>",tagExpander:"<span class='"+f.classNames.expander+"'></span>",tagConnector:"<span class='"+f.classNames.connector+
"'></span>",tagNodeIcon:"<span class='"+f.classNames.nodeIcon+"'></span>",tagCheckbox:"<span class='"+f.classNames.checkbox+"'></span>"};(f.children||f.initAjax&&f.initAjax.url||f.initId)&&a(this.divTree).empty();var m=this.$tree.find(">div."+f.classNames.container+":first").hide();this.tnRoot=new d(null,this,f.tree_root_data||{});this.tnRoot.bExpanded=!0;this.tnRoot.render();this.divTree.appendChild(f.tree_root_data?a(this.tnRoot.node).closest(".wcui-tree")[0]:this.tnRoot.node);var q=this.tnRoot,
e=f.persist&&this.persistence.isReloading(),p=!1,t=this.enableUpdate(!1);f.children?q.addChild(f.children):f.initAjax&&f.initAjax.url?(p=!0,q.data.isLazy=!0,this._reloadAjax(b)):f.initId?this._createFromTag(q,a("#"+f.initId)):(this._createFromTag(q,m),m.remove());this._checkConsistency();p||3!=f.selectMode||q._updatePartSelectionState();this.enableUpdate(t);this.$widget.bind();this.phase="postInit";f.persist&&this.persistence.write();this.focusNode&&this.focusNode.isVisible()&&this.focusNode.focus();
f.auto_load_lazy_nodes&&a.each(this.tnRoot.childList||[],function(){this.needLazyCall()&&this._loadContent(!1)});p||(f.onPostInit&&f.onPostInit.call(this,e,!1),b&&b.call(this,"ok"));this.phase="idle"},_reloadAjax:function(b){var c=this.options;if(!c.initAjax||!c.initAjax.url)throw"tree.reload() requires 'initAjax' mode.";var d=this.persistence,f=a.extend({},c.initAjax);f.addActiveKey&&(f.data.activeKey=d.activeKey);f.addFocusedKey&&(f.data.focusedKey=d.focusedKey);f.addExpandedKeyList&&(f.data.expandedKeyList=
d.expandedKeyList.join(","));f.addSelectedKeyList&&(f.data.selectedKeyList=d.selectedKeyList.join(","));var e=d.isReloading();f.success=function(a,d,f){3==c.selectMode&&a.tree.tnRoot._updatePartSelectionState();c.onPostInit&&c.onPostInit.call(a.tree,e,!1);b&&b.call(a.tree,"ok")};f.error=function(a,d,f,g){c.onPostInit&&c.onPostInit.call(a.tree,e,!0,d,f,g);b&&b.call(a.tree,"error",d,f,g)};this.tnRoot.appendAjax(f)},toString:function(){return"WcuiTree '"+this.$tree.attr("id")+"'"},toDict:function(){return this.tnRoot.toDict(!0)},
serializeArray:function(a){a=this.getSelectedNodes(a);for(var b=this.$tree.attr("name")||this.$tree.attr("id"),c=[],d=0,e=a.length;d<e;d++)c.push({name:b,value:a[d].key});return c},getPersistData:function(){return this.persistence.toDict()},isInitializing:function(){return"init"==this.phase||"postInit"==this.phase},isReloading:function(){return("init"==this.phase||"postInit"==this.phase)&&this.options.persist&&this.persistence.cookiesFound},isUserEvent:function(){return"userEvent"==this.phase},redraw:function(){this.tnRoot.redraw()},
reload:function(a){this._load(a)},getRoot:function(){return this.tnRoot},enable:function(){this.$widget.enable()},disable:function(){this.$widget.disable()},getNodeByKey:function(a){var b=a.startsWith(this.options.idPrefix)?a:this.options.idPrefix+this.uuid+"-"+a;if(b=document.getElementById(b))return b.dtnode?b.dtnode:null;var c=null;this.visit(function(b){if(b.key===a)return c=b,!1},!0);return c},getActiveNode:function(){return this.activeNode},reactivate:function(a){var b=this.activeNode;b&&(this.activeNode=
null,b.activate(),a&&b.focus())},getSelectedNodes:function(a){var b=[];this.tnRoot.visit(function(c){if(c.bSelected&&(b.push(c),!0===a))return"skip"});return b},removeHilightedNodes:function(){this.hilightedNodes.slice(0).every(function(a){this.highlight(!1)})},activateKey:function(a,b){a=null===a?null:this.getNodeByKey(a);if(!a)return this.activeNode&&this.activeNode.deactivate(b),this.activeNode=null;a.focus();a.activate(b);return a},loadKeyPath:function(a,b){a=a.split(this.options.keyPathSeparator);
""===a[0]&&a.shift();a[0]==this.tnRoot.key&&a.shift();a=a.join(this.options.keyPathSeparator);return this.tnRoot._loadKeyPath(a,b)},selectKey:function(a,b){a=this.getNodeByKey(a);if(!a)return null;a.select(b);return a},enableUpdate:function(a,b){if(this.bEnableUpdate==a)return a;(this.bEnableUpdate=a)&&(b||this.tnRoot).redraw();return!a},count:function(){return this.tnRoot.countChildren()},visit:function(a,b){return this.tnRoot.visit(a,b)},_createFromTag:function(b,c){var d=this;c.find(">div."+this.options.classNames.nodeContainer).each(function(){var c=
a(this),e=c.find(">span:first"),f=c.find(">a:first"),g=null,l=null;if(e.length)e=e.html();else if(f.length){e=f.html();g=f.attr("href");l=f.attr("target");var m=f.attr("title")}else e=c.html(),f=e.search(/<div/i),e=0<=f?a.trim(e.substring(0,f)):a.trim(e);m={title:e,tooltip:m,isFolder:c.hasClass("folder"),isLazy:c.hasClass("lazy"),expand:c.hasClass("expanded"),select:c.hasClass("selected"),activate:c.hasClass("active"),focus:c.hasClass("focused"),noLink:c.hasClass("noLink")};g&&(m.href=g,m.target=
l);c.attr("title")&&(m.tooltip=c.attr("title"));c.attr("id")&&(m[d.tree.options.key_prop]=""+c.attr("id"));if(c.attr("data")&&(g=a.trim(c.attr("data")))){"{"!=g.charAt(0)&&(g="{"+g+"}");try{a.extend(m,eval("("+g+")"))}catch(A){throw"Error parsing node data: "+A+"\ndata:\n'"+g+"'";}}g=b.addChild(m);c=c.find(">div."+opts.classNames.container+":first");c.length&&d._createFromTag(g.length?g[0]:null,c)})},_checkConsistency:function(){},_setDndStatus:function(b,c,d,f,e){b=b?a(b.span):null;c=a(c.span);this.$dndMarker||
(this.$dndMarker=a("<div id='tree-drop-marker'></div>").hide().css({"z-index":1E3}).prependTo(a(this.divTree).parent()));if("after"===f||"before"===f||"over"===f){switch(f){case "before":this.$dndMarker.removeClass("tree-drop-after tree-drop-over");this.$dndMarker.addClass("tree-drop-before");var g="0 -8";break;case "after":this.$dndMarker.removeClass("tree-drop-before tree-drop-over");this.$dndMarker.addClass("tree-drop-after");g="0 8";break;default:this.$dndMarker.removeClass("tree-drop-after tree-drop-before"),
this.$dndMarker.addClass("tree-drop-over"),c.addClass("tree-drop-target"),g="8 0"}this.$dndMarker.show().position({my:"left top",at:"left top",of:c,offset:g})}else c.removeClass("tree-drop-target"),this.$dndMarker.hide();"after"===f?c.addClass("tree-drop-after"):c.removeClass("tree-drop-after");"before"===f?c.addClass("tree-drop-before"):c.removeClass("tree-drop-before");!0===e?(b&&b.addClass("tree-drop-accept"),c.addClass("tree-drop-accept"),d.addClass("tree-drop-accept")):(b&&b.removeClass("tree-drop-accept"),
c.removeClass("tree-drop-accept"),d.removeClass("tree-drop-accept"));!1===e?(b&&b.addClass("tree-drop-reject"),c.addClass("tree-drop-reject"),d.addClass("tree-drop-reject")):(b&&b.removeClass("tree-drop-reject"),c.removeClass("tree-drop-reject"),d.removeClass("tree-drop-reject"))},_onDragEvent:function(b,c,d,f,e,g){var l=this.options,m=this.options.dnd,n=null,p=a(c.span);switch(b){case "helper":d=a("<div class='tree-drag-helper'><span class='tree-drag-helper-img' /></div>").append(a(f.target).closest("."+
l.classNames.title).clone());d.data("dtSourceNode",c);n=d;break;case "start":n=!0;c.isStatusNode()?n=!1:m.onDragStart&&(n=m.onDragStart(c));!1===n?(e.helper.trigger("mouseup"),e.helper.hide()):p.addClass("tree-drag-source");break;case "enter":m.onDragEnter?(n=m.onDragEnter(c,d),n={over:!0===n||"over"===n||0<=a.inArray("over",n),before:!0===n||"before"===n||0<=a.inArray("before",n),after:!0===n||"after"===n||0<=a.inArray("after",n)}):n={over:!0,before:!0,after:!0};e.helper.data("enterResponse",n);
break;case "over":g=e.helper.data("enterResponse");b=null;!1!==g&&("string"===typeof g?b=g:(l=p.offset(),f=f.pageY-l.top,p.width(),p=f/p.height(),g.after&&.75<p?b="after":!g.over&&g.after&&.5<p?b="after":g.before&&.25>=p?b="before":!g.over&&g.before&&.5>=p?b="before":g.over&&(b="over"),m.preventVoidMoves&&(c===d?b=null:"before"===b&&d&&c===d.getNextSibling()?b=null:"after"===b&&d&&c===d.getPrevSibling()?b=null:"over"===b&&d&&d.parent===c&&d.isLastSibling()&&(b=null)),e.helper.data("hitMode",b)));
"over"===b&&m.autoExpandMS&&!1!==c.hasChildren()&&!c.bExpanded&&c.scheduleAction("expand",m.autoExpandMS);if(b)if(m.onDragOver){if(n=m.onDragOver(c,d,b),"over"===n||"before"===n||"after"===n)b=n}else n=c==d||c.isDescendantOf(d)?!1:b;this._setDndStatus(d,c,e.helper,b,!1!==n&&null!==b);break;case "drop":p=e.helper.hasClass("tree-drop-reject");if((b=e.helper.data("hitMode"))&&m.onDrop&&!p)m.onDrop(c,d,b,e,g);break;case "leave":c.scheduleAction("cancel");e.helper.data("enterResponse",null);e.helper.data("hitMode",
null);this._setDndStatus(d,c,e.helper,"out",void 0);if(m.onDragLeave)m.onDragLeave(c,d);break;case "stop":p.removeClass("tree-drag-source");if(m.onDragStop)m.onDragStop(c);break;default:throw"Unsupported drag event: "+b;}return n},cancelDrag:function(){var b=a.ui.ddmanager.current;b&&b.cancel()},getCanonicalActive:function(){var a=this.getActiveNode(),b=[];if(a)for(b.push(a.key);a.parent;)a=a.parent,b.push(a.key);return b},setCanonicalActive:function(b,c,d){2==arguments.length&&"boolean"==typeof c&&
(d=c,c={});c=c||{};var f=b.length;if(b||f){var e={childList:[this.tnRoot]},g,l=f-1,m=function(){var f=b[l];g=null;a.each(e.childList||[],function(){if(f==this.key)return g=this,!1});g?(e=g,l--,-1==l?(e.activate(d),c.done&&c.done()):e.needLazyCall()?e._loadContent(!1,{done:m,fail:c.fail},!0):m()):c.fail&&c.fail()};m()}else c.fail&&c.fail()}};var g=function(){this.widgetName="wcTree";this.widgetFullName="wcuiTreeWidget"};g.inherit(WCUIWidget);g.prototype._create=function(a,b){this.eventNamespace="."+
this.widgetName+this.uuid;this.options.event+=".tree";this.tree=new f(this);this.tree.uuid=this.uuid;this.tree._load()};g.prototype.bind=function(){var b="tree_"+this.uuid;this.element.off("."+b);var c="click."+b+" dblclick."+b;this.options.keyboard&&(c+=" keypress."+this.uuid+" keydown."+this.uuid);var d=this.tree,f=d.options;this.element.on(c,function(a){var b=g.getNode(a.target);if(!b)return!0;var c=d.phase;d.phase="userEvent";try{switch(a.type){case "click":return f.onClick&&!1===f.onClick.call(d,
b,a)?!1:b._onClick(a);case "dblclick":if(f.onDblClick&&!1===f.onDblClick.call(d,b,a))return!1;case "keydown":return f.onKeydown&&!1===f.onKeydown.call(d,b,a)?!1:b._onKeydown(a);case "keypress":if(f.onKeypress&&!1===f.onKeypress.call(d,b,a))return!1}}finally{d.phase=c}});this.element.on("focus."+b+" blur."+b,function(b){b=a.event.fix(b||window.event);var c=g.getNode(b.target);return c?c._onFocus(b):!1});this.element.on("contextmenu."+b,"."+this.tree.options.classNames.title,function(a){var b=g.getNode(a.target);
if(f.onContextMenu)return f.onContextMenu.call(b.tree,b,a),!1});f.afterLoad&&f.afterLoad(this.element.find(".tree-container"),g)};g.prototype.unbind=function(){this.element.unbind(".tree_"+this.uuid)};g.prototype.enable=function(){this.bind();WCUIWidget.enable.apply(this,arguments)};g.prototype.disable=function(){this.element.off(".tree_"+this.uuid);WCUIWidget.disable.apply(this,arguments)};g.prototype.inst=function(){return this.tree};g.prototype._destroy=function(){this.tree.wcui_tree_queue_manager.clear();
this.unbind();if(this.tree._xhrs){var b=[];a.each(this.tree._xhrs,function(){b.push(this)});a.each(b,function(){this.abort()});delete this.tree._xhrs}};a.fn.tree=function(b){var c=arguments,d;a.each(this,function(){var f=a(this),e=f.data("wcuiTreeWidget");"string"==typeof b&&e?d=e[b].apply(e,Array.prototype.splice.call(c,1)):e||(e=new g,e._createWidget(b,f),f.data("wcuiTreeWidget",e))});return d?d:this};g.prototype.version="$Version: 1.2.4$";g.getNode=function(a){if(a instanceof d)return a;for(void 0!==
a.selector&&(a=a[0]);a;){if(a.dtnode)return a.dtnode;a=a.parentNode}return null};g.getPersistData=c._getTreePersistData;g.prototype.options={title:"WcuiTree",minExpandLevel:1,imagePath:null,children:null,initId:null,initAjax:null,autoFocus:!0,keyboard:!0,persist:!1,autoCollapse:!1,clickFolderMode:3,activeVisible:!0,checkbox:!1,selectMode:1,fx:null,noLink:!0,onClick:null,onDblClick:null,onKeydown:null,onKeypress:null,onFocus:null,onBlur:null,onQueryActivate:null,onQuerySelect:null,onQueryExpand:null,
onPostInit:null,onActivate:null,onDeactivate:null,onSelect:null,onExpand:null,onLazyRead:null,onCustomRender:null,onCreate:null,onRender:null,postProcess:null,dnd:{onDragStart:null,onDragStop:null,autoExpandMS:1E3,preventVoidMoves:!0,onDragEnter:null,onDragOver:null,onDrop:null,onDragLeave:null},ajaxDefaults:{cache:!1,timeout:0,dataType:"json"},strings:{loading:"Loading&#8230;",loadError:"Load error!"},idPrefix:"tree-id-",keyPathSeparator:"/",cookieId:"tree",cookie:{expires:null},classNames:{container:"tree-container",
nodeContainer:"tree-node-container",node:"tree-node",folder:"tree-folder",empty:"tree-empty",vline:"tree-vline",expander:"tree-expander",connector:"tree-connector",checkbox:"tree-checkbox",nodeIcon:"tree-icon",title:"tree-title",noConnector:"tree-no-connector",nodeError:"tree-statusnode-error",nodeWait:"tree-statusnode-wait",hidden:"tree-hidden",combinedExpanderPrefix:"tree-exp-",combinedIconPrefix:"tree-ico-",nodeLoading:"tree-loading",hasChildren:"tree-has-children",active:"tree-active",selected:"tree-selected",
expanded:"tree-expanded",lazy:"tree-lazy",focused:"tree-focused",partsel:"tree-partsel",lastsib:"tree-lastsib",highlighted:"highlighted",marked:"marked"},debugLevel:1,title_prop:"name",has_child_prop:"hasChild",type_prop:"type",node_type:void 0,load_url:void 0,key_prop:"id",auto_load_lazy_nodes:!1,ajax_caller:bm.ajax};g.nodedatadefaults={title:null,key:null,isFolder:!1,isLazy:!1,tooltip:null,href:null,icon:null,clazz:null,noLink:!0,activate:!1,focus:!1,expand:!1,select:!1,hideCheckbox:!1,unselectable:!1,
children:null}})(jQuery);
(function(a){if("object"==typeof exports&&"object"==typeof module)module.exports=a();else{if("function"==typeof define&&define.amd)return define([],a);this.CodeMirror=a()}})(function(){function a(c,d){if(!(this instanceof a))return new a(c,d);this.options=d=d||{};Tc(Bf,d,!1);w(d);var e=d.value;"string"==typeof e&&(e=new tb(e,d.mode));this.doc=e;var f=this.display=new b(c,e);f.wrapper.CodeMirror=this;q(this);l(this);d.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");d.autofocus&&
!ke&&lb(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new td};Fa&&11>Pa&&setTimeout(zb(wb,this,!0),20);Ac(this);af||(Cf(),af=!0);var g=this;Ta(this,function(){g.curOp.forceUpdate=!0;Ye(g,e);d.autofocus&&!ke||Wb()==f.input?setTimeout(zb(Ic,g),20):Jc(g);for(var a in Lc)if(Lc.hasOwnProperty(a))Lc[a](g,d[a],bf);D(g);for(a=0;a<le.length;++a)le[a](g)})}function b(a,b){var c=this.input=ja("textarea",null,
null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none");hb?c.style.width="1000px":c.setAttribute("wrap","off");cd&&(c.style.border="1px solid black");c.setAttribute("autocorrect","off");c.setAttribute("autocapitalize","off");c.setAttribute("spellcheck","false");this.inputDiv=ja("div",[c],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");this.scrollbarH=ja("div",[ja("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");this.scrollbarV=
ja("div",[ja("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar");this.scrollbarFiller=ja("div",null,"CodeMirror-scrollbar-filler");this.gutterFiller=ja("div",null,"CodeMirror-gutter-filler");this.lineDiv=ja("div",null,"CodeMirror-code");this.selectionDiv=ja("div",null,null,"position: relative; z-index: 1");this.cursorDiv=ja("div",null,"CodeMirror-cursors");this.measure=ja("div",null,"CodeMirror-measure");this.lineMeasure=ja("div",null,"CodeMirror-measure");this.lineSpace=ja("div",[this.measure,
this.lineMeasure,this.selectionDiv,this.cursorDiv,this.lineDiv],null,"position: relative; outline: none");this.mover=ja("div",[ja("div",[this.lineSpace],"CodeMirror-lines")],null,"position: relative");this.sizer=ja("div",[this.mover],"CodeMirror-sizer");this.heightForcer=ja("div",null,null,"position: absolute; height: "+Cb+"px; width: 1px;");this.gutters=ja("div",null,"CodeMirror-gutters");this.lineGutter=null;this.scroller=ja("div",[this.sizer,this.heightForcer,this.gutters],"CodeMirror-scroll");
this.scroller.setAttribute("tabIndex","-1");this.wrapper=ja("div",[this.inputDiv,this.scrollbarH,this.scrollbarV,this.scrollbarFiller,this.gutterFiller,this.scroller],"CodeMirror");Fa&&8>Pa&&(this.gutters.style.zIndex=-1,this.scroller.style.paddingRight=0);cd&&(c.style.width="0px");hb||(this.scroller.draggable=!0);me&&(this.inputDiv.style.height="1px",this.inputDiv.style.position="absolute");Fa&&8>Pa&&(this.scrollbarH.style.minHeight=this.scrollbarV.style.minWidth="18px");a.appendChild?a.appendChild(this.wrapper):
a(this.wrapper);this.viewFrom=this.viewTo=b.first;this.view=[];this.externalMeasured=null;this.lastSizeC=this.viewOffset=0;this.lineNumWidth=this.lineNumInnerWidth=this.lineNumChars=this.updateLineNumbers=null;this.prevInput="";this.pollingFast=this.alignWidgets=!1;this.poll=new td;this.cachedCharWidth=this.cachedTextHeight=this.cachedPaddingH=null;this.inaccurateSelection=!1;this.maxLine=null;this.maxLineLength=0;this.maxLineChanged=!1;this.wheelDX=this.wheelDY=this.wheelStartX=this.wheelStartY=
null;this.shift=!1;this.selForContextMenu=null}function d(b){b.doc.mode=a.getMode(b.options,b.doc.modeOption);c(b)}function c(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null)});a.doc.frontier=a.doc.first;Ea(a,100);a.state.modeGen++;a.curOp&&Ia(a)}function f(a){var b=ib(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/sb(a.display)-3);return function(e){if(ic(a.doc,e))return 0;var f=0;if(e.widgets)for(var g=0;g<e.widgets.length;g++)e.widgets[g].height&&
(f+=e.widgets[g].height);return c?f+(Math.ceil(e.text.length/d)||1)*b:f+b}}function g(a){var b=a.doc,c=f(a);b.iter(function(a){var b=c(a);b!=a.height&&Jb(a,b)})}function m(a){var b=Qb[a.options.keyMap].style;a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(b?" cm-keymap-"+b:"")}function l(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-");Ha(a)}function n(a){q(a);Ia(a);setTimeout(function(){z(a)},
20)}function q(a){var b=a.display.gutters,c=a.options.gutters;jc(b);for(var d=0;d<c.length;++d){var f=c[d],g=b.appendChild(ja("div",null,"CodeMirror-gutter "+f));"CodeMirror-linenumbers"==f&&(a.display.lineGutter=g,g.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=d?"":"none";e(a)}function e(a){var b=a.display.gutters.offsetWidth;a.display.sizer.style.marginLeft=b+"px";a.display.scrollbarH.style.left=a.options.fixedGutter?b+"px":0}function p(a){if(0==a.height)return 0;for(var b=a.text.length,
c,d=a;c=lc(d,!0);)c=c.find(0,!0),d=c.from.line,b+=c.from.ch-c.to.ch;for(d=a;c=lc(d,!1);)c=c.find(0,!0),b-=d.text.length-c.from.ch,d=c.to.line,b+=d.text.length-c.to.ch;return b}function t(a){var b=a.display;a=a.doc;b.maxLine=na(a,a.first);b.maxLineLength=p(b.maxLine);b.maxLineChanged=!0;a.iter(function(a){var c=p(a);c>b.maxLineLength&&(b.maxLineLength=c,b.maxLine=a)})}function w(a){var b=fb(a.gutters,"CodeMirror-linenumbers");-1==b&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):
-1<b&&!a.lineNumbers&&(a.gutters=a.gutters.slice(0),a.gutters.splice(b,1))}function y(a){var b=a.display.scroller;return{clientHeight:b.clientHeight,barHeight:a.display.scrollbarV.clientHeight,scrollWidth:b.scrollWidth,clientWidth:b.clientWidth,hScrollbarTakesSpace:a.display.scroller.clientHeight-a.display.wrapper.clientHeight<Cb-3,barWidth:a.display.scrollbarH.clientWidth,docHeight:Math.round(a.doc.height+wa(a.display))}}function A(a,b){b||(b=y(a));var c=a.display,d=Df(c.measure),e=b.docHeight+Cb,
f=b.scrollWidth>b.clientWidth;f&&b.scrollWidth<=b.clientWidth+1&&0<d&&!b.hScrollbarTakesSpace&&(f=!1);var g=e>b.clientHeight;g?(c.scrollbarV.style.display="block",c.scrollbarV.style.bottom=f?d+"px":"0",c.scrollbarV.firstChild.style.height=Math.max(0,e-b.clientHeight+(b.barHeight||c.scrollbarV.clientHeight))+"px"):(c.scrollbarV.style.display="",c.scrollbarV.firstChild.style.height="0");f?(c.scrollbarH.style.display="block",c.scrollbarH.style.right=g?d+"px":"0",c.scrollbarH.firstChild.style.width=b.scrollWidth-
b.clientWidth+(b.barWidth||c.scrollbarH.clientWidth)+"px"):(c.scrollbarH.style.display="",c.scrollbarH.firstChild.style.width="0");f&&g?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=c.scrollbarFiller.style.width=d+"px"):c.scrollbarFiller.style.display="";f&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(c.gutterFiller.style.display="block",c.gutterFiller.style.height=d+"px",c.gutterFiller.style.width=c.gutters.offsetWidth+"px"):c.gutterFiller.style.display=
"";!a.state.checkedOverlayScrollbar&&0<b.clientHeight&&(0===d&&(c.scrollbarV.style.minWidth=c.scrollbarH.style.minHeight=Db&&!Ef?"12px":"18px",b=function(b){(b.target||b.srcElement)!=c.scrollbarV&&(b.target||b.srcElement)!=c.scrollbarH&&Ra(a,Zc)(b)},xa(c.scrollbarV,"mousedown",b),xa(c.scrollbarH,"mousedown",b)),a.state.checkedOverlayScrollbar=!0)}function x(a,b,c){var d=c&&null!=c.top?Math.max(0,c.top):a.scroller.scrollTop;d=Math.floor(d-a.lineSpace.offsetTop);var e=c&&null!=c.bottom?c.bottom:d+a.wrapper.clientHeight;
d=mc(b,d);e=mc(b,e);if(c&&c.ensure){var f=c.ensure.from.line;c=c.ensure.to.line;if(f<d)return{from:f,to:mc(b,Kb(na(b,f))+a.wrapper.clientHeight)};if(Math.min(c,b.lastLine())>=e)return{from:mc(b,Kb(na(b,c))-a.wrapper.clientHeight),to:c}}return{from:d,to:Math.max(e,d+1)}}function z(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var d=G(b)-b.scroller.scrollLeft+a.doc.scrollLeft,e=b.gutters.offsetWidth,f=d+"px",g=0;g<c.length;g++)if(!c[g].hidden){a.options.fixedGutter&&
c[g].gutter&&(c[g].gutter.style.left=f);var l=c[g].alignable;if(l)for(var F=0;F<l.length;F++)l[F].style.left=f}a.options.fixedGutter&&(b.gutters.style.left=d+e+"px")}}function D(a){if(!a.options.lineNumbers)return!1;var b=a.doc;b=B(a.options,b.first+b.size-1);var c=a.display;if(b.length!=c.lineNumChars){var d=c.measure.appendChild(ja("div",[ja("div",b)],"CodeMirror-linenumber CodeMirror-gutter-elt")),f=d.firstChild.offsetWidth;d=d.offsetWidth-f;c.lineGutter.style.width="";c.lineNumInnerWidth=Math.max(f,
c.lineGutter.offsetWidth-d);c.lineNumWidth=c.lineNumInnerWidth+d;c.lineNumChars=c.lineNumInnerWidth?b.length:-1;c.lineGutter.style.width=c.lineNumWidth+"px";e(a);return!0}return!1}function B(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}function G(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function L(a,b,c){var d=a.display;this.viewport=b;this.visible=x(d,a.doc,b);this.editorIsHidden=!d.wrapper.offsetWidth;this.wrapperHeight=d.wrapper.clientHeight;
this.oldViewFrom=d.viewFrom;this.oldViewTo=d.viewTo;this.oldScrollerWidth=d.scroller.clientWidth;this.force=c;this.dims=ea(a)}function J(a,b){var c=a.display,d=a.doc;if(b.editorIsHidden)return za(a),!1;if(!b.force&&b.visible.from>=c.viewFrom&&b.visible.to<=c.viewTo&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo)&&0==Yc(a))return!1;D(a)&&(za(a),b.dims=ea(a));var e=d.first+d.size,f=Math.max(b.visible.from-a.options.viewportMargin,d.first),g=Math.min(e,b.visible.to+a.options.viewportMargin);
c.viewFrom<f&&20>f-c.viewFrom&&(f=Math.max(d.first,c.viewFrom));c.viewTo>g&&20>c.viewTo-g&&(g=Math.min(e,c.viewTo));bc&&(f=ae(a.doc,f),g=Te(a.doc,g));d=f!=c.viewFrom||g!=c.viewTo||c.lastSizeC!=b.wrapperHeight;e=a.display;0==e.view.length||f>=e.viewTo||g<=e.viewFrom?(e.view=kb(a,f,g),e.viewFrom=f):(e.viewFrom>f?e.view=kb(a,f,e.viewFrom).concat(e.view):e.viewFrom<f&&(e.view=e.view.slice(Bb(a,f))),e.viewFrom=f,e.viewTo<g?e.view=e.view.concat(kb(a,e.viewTo,g)):e.viewTo>g&&(e.view=e.view.slice(0,Bb(a,
g))));e.viewTo=g;c.viewOffset=Kb(na(a.doc,c.viewFrom));a.display.mover.style.top=c.viewOffset+"px";g=Yc(a);if(!d&&0==g&&!b.force&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo))return!1;f=Wb();4<g&&(c.lineDiv.style.display="none");Y(a,c.updateLineNumbers,b.dims);4<g&&(c.lineDiv.style.display="");f&&Wb()!=f&&f.offsetHeight&&f.focus();jc(c.cursorDiv);jc(c.selectionDiv);d&&(c.lastSizeC=b.wrapperHeight,Ea(a,400));c.updateLineNumbers=null;return!0}function P(a,b){for(var c=b.viewport,d=!0;;d=
!1){if(!d||!a.options.lineWrapping||b.oldScrollerWidth==a.display.scroller.clientWidth)if(c&&null!=c.top&&(c={top:Math.min(a.doc.height+wa(a.display)-Cb-a.display.scroller.clientHeight,c.top)}),b.visible=x(a.display,a.doc,c),b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo)break;if(!J(a,b))break;M(a);d=y(a);u(a);da(a,d);A(a,d)}bb(a,"update",a);a.display.viewFrom==b.oldViewFrom&&a.display.viewTo==b.oldViewTo||bb(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo)}function fa(a,
b){b=new L(a,b);J(a,b)&&(M(a),P(a,b),b=y(a),u(a),da(a,b),A(a,b))}function da(a,b){a.display.sizer.style.minHeight=a.display.heightForcer.style.top=b.docHeight+"px";a.display.gutters.style.height=Math.max(b.docHeight,b.clientHeight-Cb)+"px"}function M(a){a=a.display;for(var b=a.lineDiv.offsetTop,c=0;c<a.view.length;c++){var d=a.view[c];if(!d.hidden){if(Fa&&8>Pa){var e=d.node.offsetTop+d.node.offsetHeight;var f=e-b;b=e}else f=d.node.getBoundingClientRect(),f=f.bottom-f.top;e=d.line.height-f;2>f&&(f=
ib(a));if(.001<e||-.001>e)if(Jb(d.line,f),V(d.line),d.rest)for(f=0;f<d.rest.length;f++)V(d.rest[f])}}}function V(a){if(a.widgets)for(var b=0;b<a.widgets.length;++b)a.widgets[b].height=a.widgets[b].node.offsetHeight}function ea(a){for(var b=a.display,c={},d={},e=b.gutters.firstChild,f=0;e;e=e.nextSibling,++f)c[a.options.gutters[f]]=e.offsetLeft,d[a.options.gutters[f]]=e.offsetWidth;return{fixedPos:G(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}
function Y(a,b,c){function d(b){var c=b.nextSibling;hb&&Db&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b);return c}var e=a.display,f=a.options.lineNumbers,g=e.lineDiv,l=g.firstChild,F=e.view;e=e.viewFrom;for(var m=0;m<F.length;m++){var T=F[m];if(!T.hidden)if(T.node){for(;l!=T.node;)l=d(l);l=f&&null!=b&&b<=e&&T.lineNumber;T.changes&&(-1<fb(T.changes,"gutter")&&(l=!1),pa(a,T,e,c));l&&(jc(T.lineNumber),T.lineNumber.appendChild(document.createTextNode(B(a.options,
e))));l=T.node.nextSibling}else{var n=H(a,T,e,c);g.insertBefore(n,l)}e+=T.size}for(;l;)l=d(l)}function pa(a,b,c,d){for(var e=0;e<b.changes.length;e++){var f=b.changes[e];if("text"==f){f=b;var g=f.text.className,l=Z(a,f);f.text==f.node&&(f.node=l.pre);f.text.parentNode.replaceChild(l.pre,f.text);f.text=l.pre;l.bgClass!=f.bgClass||l.textClass!=f.textClass?(f.bgClass=l.bgClass,f.textClass=l.textClass,S(f)):g&&(f.text.className=g)}else if("gutter"==f)K(a,b,c,d);else if("class"==f)S(b);else if("widget"==
f){g=b;l=d;g.alignable&&(g.alignable=null);for(var F=g.node.firstChild;F;F=f)f=F.nextSibling,"CodeMirror-linewidget"==F.className&&g.node.removeChild(F);E(g,l)}}b.changes=null}function N(a){a.node==a.text&&(a.node=ja("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),Fa&&8>Pa&&(a.node.style.zIndex=2));return a.node}function Z(a,b){var c=a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=null,
b.measure=c.measure,c.built):Xe(a,b)}function S(a){var b=a.bgClass?a.bgClass+" "+(a.line.bgClass||""):a.line.bgClass;b&&(b+=" CodeMirror-linebackground");if(a.background)b?a.background.className=b:(a.background.parentNode.removeChild(a.background),a.background=null);else if(b){var c=N(a);a.background=c.insertBefore(ja("div",null,b),c.firstChild)}a.line.wrapClass?N(a).className=a.line.wrapClass:a.node!=a.text&&(a.node.className="");a.text.className=(a.textClass?a.textClass+" "+(a.line.textClass||""):
a.line.textClass)||""}function K(a,b,c,d){b.gutter&&(b.node.removeChild(b.gutter),b.gutter=null);var e=b.line.gutterMarkers;if(a.options.lineNumbers||e){var f=N(b);f=b.gutter=f.insertBefore(ja("div",null,"CodeMirror-gutter-wrapper","position: absolute; left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px"),b.text);!a.options.lineNumbers||e&&e["CodeMirror-linenumbers"]||(b.lineNumber=f.appendChild(ja("div",B(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+d.gutterLeft["CodeMirror-linenumbers"]+
"px; width: "+a.display.lineNumInnerWidth+"px")));if(e)for(b=0;b<a.options.gutters.length;++b){c=a.options.gutters[b];var g=e.hasOwnProperty(c)&&e[c];g&&f.appendChild(ja("div",[g],"CodeMirror-gutter-elt","left: "+d.gutterLeft[c]+"px; width: "+d.gutterWidth[c]+"px"))}}}function H(a,b,c,d){var e=Z(a,b);b.text=b.node=e.pre;e.bgClass&&(b.bgClass=e.bgClass);e.textClass&&(b.textClass=e.textClass);S(b);K(a,b,c,d);E(b,d);return b.node}function E(a,b){ra(a.line,a,b,!0);if(a.rest)for(var c=0;c<a.rest.length;c++)ra(a.rest[c],
a,b,!1)}function ra(a,b,c,d){if(a.widgets){var e=N(b),f=0;for(a=a.widgets;f<a.length;++f){var g=a[f],l=ja("div",[g.node],"CodeMirror-linewidget");g.handleMouseEvents||(l.ignoreEvents=!0);var m=g,F=l,T=c;if(m.noHScroll){(b.alignable||(b.alignable=[])).push(F);var n=T.wrapperWidth;F.style.left=T.fixedPos+"px";m.coverGutter||(n-=T.gutterTotalWidth,F.style.paddingLeft=T.gutterTotalWidth+"px");F.style.width=n+"px"}m.coverGutter&&(F.style.zIndex=5,F.style.position="relative",m.noHScroll||(F.style.marginLeft=
-T.gutterTotalWidth+"px"));d&&g.above?e.insertBefore(l,b.gutter||b.text):e.appendChild(l);bb(g,"redraw")}}}function X(a){return U(a.line,a.ch)}function I(a,b){return 0>Aa(a,b)?b:a}function sa(a,b){return 0>Aa(a,b)?a:b}function ma(a,b){this.ranges=a;this.primIndex=b}function Q(a,b){this.anchor=a;this.head=b}function R(a,b){b=a[b];a.sort(function(a,b){return Aa(a.from(),b.from())});b=fb(a,b);for(var c=1;c<a.length;c++){var d=a[c],e=a[c-1];if(0<=Aa(e.to(),d.from())){var f=sa(e.from(),d.from()),g=I(e.to(),
d.to());d=e.empty()?d.from()==d.head:e.from()==e.head;c<=b&&--b;a.splice(--c,2,new Q(d?g:f,d?f:g))}}return new ma(a,b)}function ua(a,b){return new ma([new Q(a,b||a)],0)}function C(a,b){if(b.line<a.first)return U(a.first,0);var c=a.first+a.size-1;if(b.line>c)return U(c,na(a,c).text.length);a=na(a,b.line).text.length;c=b.ch;b=null==c||c>a?U(b.line,a):0>c?U(b.line,0):b;return b}function W(a,b){return b>=a.first&&b<a.first+a.size}function O(a,b,c,d){return a.cm&&a.cm.display.shift||a.extend?(a=b.anchor,
d&&(b=0>Aa(c,a),b!=0>Aa(d,a)?(a=c,c=d):b!=0>Aa(c,d)&&(c=d)),new Q(a,c)):new Q(d||c,c)}function Ba(a,b,c,d){Ca(a,new ma([O(a,a.sel.primary(),b,c)],0),d)}function ca(a,b,c){for(var d=[],e=0;e<a.sel.ranges.length;e++)d[e]=O(a,a.sel.ranges[e],b[e],null);b=R(d,a.sel.primIndex);Ca(a,b,c)}function Ja(a,b,c,d){var e=a.sel.ranges.slice(0);e[b]=c;Ca(a,R(e,a.sel.primIndex),d)}function qa(a,b){var c={ranges:b.ranges,update:function(b){this.ranges=[];for(var c=0;c<b.length;c++)this.ranges[c]=new Q(C(a,b[c].anchor),
C(a,b[c].head))}};db(a,"beforeSelectionChange",a,c);a.cm&&db(a.cm,"beforeSelectionChange",a.cm,c);return c.ranges!=b.ranges?R(c.ranges,c.ranges.length-1):b}function Ua(a,b,c){var d=a.history.done,e=Oa(d);e&&e.ranges?(d[d.length-1]=b,Ga(a,b,c)):Ca(a,b,c)}function Ca(a,b,c){Ga(a,b,c);b=a.sel;var d=a.cm?a.cm.curOp.id:NaN,e=a.history,f=c&&c.origin,g;if(!(g=d==e.lastSelOp)&&(g=f&&e.lastSelOrigin==f)&&!(g=e.lastModTime==e.lastSelTime&&e.lastOrigin==f)){g=Oa(e.done);var l=f.charAt(0);g="*"==l||"+"==l&&g.ranges.length==
b.ranges.length&&g.somethingSelected()==b.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}g?e.done[e.done.length-1]=b:yd(b,e.done);e.lastSelTime=+new Date;e.lastSelOrigin=f;e.lastSelOp=d;c&&!1!==c.clearRedo&&He(e.undone)}function Ga(a,b,c){if(yb(a,"beforeSelectionChange")||a.cm&&yb(a.cm,"beforeSelectionChange"))b=qa(a,b);var d=c&&c.bias||(0>Aa(b.primary().head,a.sel.primary().head)?-1:1);Da(a,ia(a,b,d,!0));c&&!1===c.scroll||!a.cm||ac(a.cm)}function Da(a,
b){b.equals(a.sel)||(a.sel=b,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,Xd(a.cm)),bb(a,"cursorActivity",a))}function Ma(a){Da(a,ia(a,a.sel,null,!1),cc)}function ia(a,b,c,d){for(var e,f=0;f<b.ranges.length;f++){var g=b.ranges[f],l=Ka(a,g.anchor,c,d),m=Ka(a,g.head,c,d);if(e||l!=g.anchor||m!=g.head)e||(e=b.ranges.slice(0,f)),e[f]=new Q(l,m)}return e?R(e,b.primIndex):b}function Ka(a,b,c,d){var e=!1,f=b,g=c||1;a.cantEdit=!1;a:for(;;){var l=na(a,f.line);if(l.markedSpans)for(var m=0;m<
l.markedSpans.length;++m){var F=l.markedSpans[m],n=F.marker;if((null==F.from||(n.inclusiveLeft?F.from<=f.ch:F.from<f.ch))&&(null==F.to||(n.inclusiveRight?F.to>=f.ch:F.to>f.ch))){if(d&&(db(n,"beforeCursorEnter"),n.explicitlyCleared))if(l.markedSpans){--m;continue}else break;if(n.atomic){m=n.find(0>g?-1:1);if(0==Aa(m,f)&&(m.ch+=g,0>m.ch?m=m.line>a.first?C(a,U(m.line-1)):null:m.ch>l.text.length&&(m=m.line<a.first+a.size-1?U(m.line+1,0):null),!m)){if(e){if(!d)return Ka(a,b,c,!0);a.cantEdit=!0;return U(a.first,
0)}e=!0;m=b;g=-g}f=m;continue a}}}return f}}function ab(a){for(var b=a.display,c=a.doc,d={},e=d.cursors=document.createDocumentFragment(),f=d.selection=document.createDocumentFragment(),g=0;g<c.sel.ranges.length;g++){var l=c.sel.ranges[g],m=l.empty();if(m||a.options.showCursorWhenSelecting){var F=a,n=e,p=ba(F,l.head,"div",null,null,!F.options.singleCursorHeightPerLine),q=n.appendChild(ja("div","\u00a0","CodeMirror-cursor"));q.style.left=p.left+"px";q.style.top=p.top+"px";q.style.height=Math.max(0,
p.bottom-p.top)*F.options.cursorHeight+"px";p.other&&(F=n.appendChild(ja("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor")),F.style.display="",F.style.left=p.other.left+"px",F.style.top=p.other.top+"px",F.style.height=.85*(p.other.bottom-p.other.top)+"px")}m||ya(a,l,f)}a.options.moveInputWithCursor&&(a=ba(a,c.sel.primary().head,"div"),c=b.wrapper.getBoundingClientRect(),e=b.lineDiv.getBoundingClientRect(),d.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,a.top+e.top-c.top)),d.teLeft=
Math.max(0,Math.min(b.wrapper.clientWidth-10,a.left+e.left-c.left)));return d}function oa(a,b){Ab(a.display.cursorDiv,b.cursors);Ab(a.display.selectionDiv,b.selection);null!=b.teTop&&(a.display.inputDiv.style.top=b.teTop+"px",a.display.inputDiv.style.left=b.teLeft+"px")}function u(a){oa(a,ab(a))}function ya(a,b,c){function d(a,b,c,d){0>b&&(b=0);b=Math.round(b);d=Math.round(d);l.appendChild(ja("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==c?n-a:
c)+"px; height: "+(d-b)+"px"))}function e(b,c,e){var f=na(g,b),l=f.text.length,m,T;Hf(Lb(f),c||0,null==e?l:e,function(g,p,q){var ha=ub(a,U(b,g),"div",f,"left"),t;if(g==p){var va=ha;q=t=ha.left}else va=ub(a,U(b,p-1),"div",f,"right"),"rtl"==q&&(q=ha,ha=va,va=q),q=ha.left,t=va.right;null==c&&0==g&&(q=F);3<va.top-ha.top&&(d(q,ha.top,null,ha.bottom),q=F,ha.bottom<va.top&&d(q,ha.bottom,null,va.top));null==e&&p==l&&(t=n);if(!m||ha.top<m.top||ha.top==m.top&&ha.left<m.left)m=ha;if(!T||va.bottom>T.bottom||
va.bottom==T.bottom&&va.right>T.right)T=va;q<F+1&&(q=F);d(q,va.top,t-q,va.bottom)});return{start:m,end:T}}var f=a.display,g=a.doc,l=document.createDocumentFragment(),m=cb(a.display),F=m.left,n=f.lineSpace.offsetWidth-m.right;f=b.from();b=b.to();if(f.line==b.line)e(f.line,f.ch,b.ch);else{var T=na(g,f.line);m=na(g,b.line);m=Ib(T)==Ib(m);f=e(f.line,f.ch,m?T.text.length+1:null).end;b=e(b.line,m?0:null,b.ch).start;m&&(f.top<b.top-2?(d(f.right,f.top,null,f.bottom),d(F,b.top,b.left,b.bottom)):d(f.right,
f.top,b.left-f.right,f.bottom));f.bottom<b.top&&d(F,f.bottom,null,b.top)}c.appendChild(l)}function mb(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility="";0<a.options.cursorBlinkRate?b.blinker=setInterval(function(){b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate):0>a.options.cursorBlinkRate&&(b.cursorDiv.style.visibility="hidden")}}function Ea(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.viewTo&&a.state.highlight.set(b,
zb(eb,a))}function eb(a){var b=a.doc;b.frontier<b.first&&(b.frontier=b.first);if(!(b.frontier>=a.display.viewTo)){var c=+new Date+a.options.workTime,d=dd(b.mode,La(a,b.frontier)),e=[];b.iter(b.frontier,Math.min(b.first+b.size,a.display.viewTo+500),function(f){if(b.frontier>=a.display.viewFrom){var g=f.styles,l=Fe(a,f,d,!0);f.styles=l.styles;var m=f.styleClasses;(l=l.classes)?f.styleClasses=l:m&&(f.styleClasses=null);m=!g||g.length!=f.styles.length||m!=l&&(!m||!l||m.bgClass!=l.bgClass||m.textClass!=
l.textClass);for(l=0;!m&&l<g.length;++l)m=g[l]!=f.styles[l];m&&e.push(b.frontier);f.stateAfter=dd(b.mode,d)}else Zd(a,f.text,d),f.stateAfter=0==b.frontier%5?dd(b.mode,d):null;++b.frontier;if(+new Date>c)return Ea(a,a.options.workDelay),!0});e.length&&Ta(a,function(){for(var b=0;b<e.length;b++)Xa(a,e[b],"text")})}}function ka(a,b,c){for(var d,e,f=a.doc,g=c?-1:b-(a.doc.mode.innerMode?1E3:100);b>g;--b){if(b<=f.first)return f.first;var l=na(f,b-1);if(l.stateAfter&&(!c||b<=f.frontier))return b;l=Eb(l.text,
null,a.options.tabSize);if(null==e||d>l)e=b-1,d=l}return e}function La(a,b,c){var d=a.doc,e=a.display;if(!d.mode.startState)return!0;var f=ka(a,b,c),g=f>d.first&&na(d,f-1).stateAfter;g=g?dd(d.mode,g):If(d.mode);d.iter(f,b,function(c){Zd(a,c.text,g);c.stateAfter=f==b-1||0==f%5||f>=e.viewFrom&&f<e.viewTo?dd(d.mode,g):null;++f});c&&(d.frontier=f);return g}function wa(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function cb(a){if(a.cachedPaddingH)return a.cachedPaddingH;var b=Ab(a.measure,
ja("pre","x"));b=window.getComputedStyle?window.getComputedStyle(b):b.currentStyle;b={left:parseInt(b.paddingLeft),right:parseInt(b.paddingRight)};isNaN(b.left)||isNaN(b.right)||(a.cachedPaddingH=b);return b}function jb(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[Bb(a,b)];if((a=a.display.externalMeasured)&&b>=a.lineN&&b<a.lineN+a.size)return a}function qb(a,b){var c=Va(b),d=jb(a,c);d&&!d.text?d=null:d&&d.changes&&pa(a,d,c,ea(a));if(!d){var e=Ib(b);d=Va(e);e=a.display.externalMeasured=
new rb(a.doc,e,d);e.lineN=d;d=e.built=Xe(a,e);e.text=d.pre;Ab(a.display.lineMeasure,d.pre);d=e}a:if(a=d,a.line==b)c={map:a.measure.map,cache:a.measure.cache};else{for(e=0;e<a.rest.length;e++)if(a.rest[e]==b){c={map:a.measure.maps[e],cache:a.measure.caches[e]};break a}for(e=0;e<a.rest.length;e++)if(Va(a.rest[e])>c){c={map:a.measure.maps[e],cache:a.measure.caches[e],before:!0};break a}c=void 0}return{line:b,view:d,rect:null,map:c.map,cache:c.cache,before:c.before,hasHeights:!1}}function nb(a,b,c,d,
e){b.before&&(c=-1);var f=c+(d||"");if(b.cache.hasOwnProperty(f))a=b.cache[f];else{b.rect||(b.rect=b.view.text.getBoundingClientRect());if(!b.hasHeights){var g=b.view,l=b.rect,m=a.options.lineWrapping,F=m&&a.display.scroller.clientWidth;if(!g.measure.heights||m&&g.measure.width!=F){var n=g.measure.heights=[];if(m)for(g.measure.width=F,g=g.text.firstChild.getClientRects(),m=0;m<g.length-1;m++){F=g[m];var p=g[m+1];2<Math.abs(F.bottom-p.bottom)&&n.push((F.bottom+p.top)/2-l.top)}n.push(l.bottom-l.top)}b.hasHeights=
!0}l=d;n=b.map;for(d=0;d<n.length;d+=3){var T=n[d],q=n[d+1];if(c<T){var ha=0;var t=1;var w="left"}else if(c<q)ha=c-T,t=ha+1;else if(d==n.length-3||c==q&&n[d+3]>c)t=q-T,ha=t-1,c>=q&&(w="right");if(null!=ha){var va=n[d+2];T==q&&l==(va.insertLeft?"left":"right")&&(w=l);if("left"==l&&0==ha)for(;d&&n[d-2]==n[d-3]&&n[d-1].insertLeft;)va=n[(d-=3)+2],w="left";if("right"==l&&ha==q-T)for(;d<n.length-3&&n[d+3]==n[d+4]&&!n[d+5].insertLeft;)va=n[(d+=3)+2],w="right";break}}if(3==va.nodeType)for(;;){for(;ha&&Uc(b.line.text.charAt(T+
ha));)--ha;for(;T+t<q&&Uc(b.line.text.charAt(T+t));)++t;if(Fa&&9>Pa&&0==ha&&t==q-T)c=va.parentNode.getBoundingClientRect();else if(Fa&&a.options.lineWrapping){var vb=ed(va,ha,t).getClientRects();c=vb.length?vb["right"==l?vb.length-1:0]:ne}else c=ed(va,ha,t).getBoundingClientRect()||ne;if(c.left||c.right||0==ha)break;t=ha;--ha;w="right"}else 0<ha&&(w=l="right"),c=a.options.lineWrapping&&1<(vb=va.getClientRects()).length?vb["right"==l?vb.length-1:0]:va.getBoundingClientRect();!(Fa&&9>Pa)||ha||c&&(c.left||
c.right)||(c=(va=va.parentNode.getClientRects()[0])?{left:va.left,right:va.left+sb(a.display),top:va.top,bottom:va.bottom}:ne);Fa&&11>Pa&&(va=c,(ha=!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI)||(null!=oe?ha=oe:(T=Ab(a.display.measure,ja("span","x")),ha=T.getBoundingClientRect(),T=ed(T,0,1).getBoundingClientRect(),ha=oe=1<Math.abs(ha.left-T.left)),ha=!ha),ha?c=va:(ha=screen.logicalXDPI/screen.deviceXDPI,T=screen.logicalYDPI/screen.deviceYDPI,c={left:va.left*ha,right:va.right*
ha,top:va.top*T,bottom:va.bottom*T}));va=c.top-b.rect.top;ha=c.bottom-b.rect.top;T=(va+ha)/2;q=b.view.measure.heights;for(d=0;d<q.length-1&&!(T<q[d]);d++);w={left:("right"==w?c.right:c.left)-b.rect.left,right:("left"==w?c.left:c.right)-b.rect.left,top:d?q[d-1]:0,bottom:q[d]};c.left||c.right||(w.bogus=!0);a.options.singleCursorHeightPerLine||(w.rtop=va,w.rbottom=ha);a=w;a.bogus||(b.cache[f]=a)}return{left:a.left,right:a.right,top:e?a.rtop:a.top,bottom:e?a.rbottom:a.bottom}}function Ob(a){if(a.measure&&
(a.measure.cache={},a.measure.heights=null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]={}}function gb(a){a.display.externalMeasure=null;jc(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++)Ob(a.display.view[b])}function Ha(a){gb(a);a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null;a.options.lineWrapping||(a.display.maxLineChanged=!0);a.display.lineNumChars=null}function Wa(a,b,c,d){if(b.widgets)for(var e=0;e<b.widgets.length;++e)if(b.widgets[e].above){var f=
Rc(b.widgets[e]);c.top+=f;c.bottom+=f}if("line"==d)return c;d||(d="local");b=Kb(b);b="local"==d?b+a.display.lineSpace.offsetTop:b-a.display.viewOffset;if("page"==d||"window"==d)a=a.display.lineSpace.getBoundingClientRect(),b+=a.top+("window"==d?0:window.pageYOffset||(document.documentElement||document.body).scrollTop),d=a.left+("window"==d?0:window.pageXOffset||(document.documentElement||document.body).scrollLeft),c.left+=d,c.right+=d;c.top+=b;c.bottom+=b;return c}function aa(a,b,c){if("div"==c)return b;
var d=b.left;b=b.top;"page"==c?(d-=window.pageXOffset||(document.documentElement||document.body).scrollLeft,b-=window.pageYOffset||(document.documentElement||document.body).scrollTop):"local"!=c&&c||(c=a.display.sizer.getBoundingClientRect(),d+=c.left,b+=c.top);a=a.display.lineSpace.getBoundingClientRect();return{left:d-a.left,top:b-a.top}}function ub(a,b,c,d,e){d||(d=na(a.doc,b.line));var f=d;b=b.ch;d=nb(a,qb(a,d),b,e);return Wa(a,f,d,c)}function ba(a,b,c,d,e,f){function g(b,g){b=nb(a,e,b,g?"right":
"left",f);g?b.left=b.right:b.right=b.left;return Wa(a,d,b,c)}function l(a,b){var c=m[b],d=c.level%2;a==pe(c)&&b&&c.level<m[b-1].level?(c=m[--b],a=qe(c)-(c.level%2?0:1),d=!0):a==qe(c)&&b<m.length-1&&c.level<m[b+1].level&&(c=m[++b],a=pe(c)-c.level%2,d=!1);return d&&a==c.to&&a>c.from?g(a-1):g(a,d)}d=d||na(a.doc,b.line);e||(e=qb(a,d));var m=Lb(d);b=b.ch;if(!m)return g(b);var F=re(m,b);F=l(b,F);null!=fd&&(F.other=l(b,fd));return F}function Sa(a,b){var c=0;b=C(a.doc,b);a.options.lineWrapping||(c=sb(a.display)*
b.ch);b=na(a.doc,b.line);a=Kb(b)+a.display.lineSpace.offsetTop;return{left:c,right:c,top:a,bottom:a+b.height}}function la(a,b,c,d){a=U(a,b);a.xRel=d;c&&(a.outside=!0);return a}function Qa(a,b,c){var d=a.doc;c+=a.display.viewOffset;if(0>c)return la(d.first,0,!0,-1);var e=mc(d,c),f=d.first+d.size-1;if(e>f)return la(d.first+d.size-1,na(d,f).text.length,!0,1);0>b&&(b=0);for(d=na(d,e);;)if(e=gc(a,d,e,b,c),f=(d=lc(d,!1))&&d.find(0,!0),d&&(e.ch>f.from.ch||e.ch==f.from.ch&&0<e.xRel))e=Va(d=f.to.line);else return e}
function gc(a,b,c,d,e){function f(d){d=ba(a,U(c,d),"line",b,F);l=!0;if(g>d.bottom)return d.left-m;if(g<d.top)return d.left+m;l=!1;return d.left}var g=e-Kb(b),l=!1,m=2*a.display.wrapper.clientWidth,F=qb(a,b),n=Lb(b),p=b.text.length;e=Id(b);var T=Jd(b),q=f(e),ha=l,t=f(T),w=l;if(d>t)return la(c,T,w,1);for(;;){if(n?T==e||T==se(b,e,1):1>=T-e){n=d<q||d-q<=t-d?e:T;for(d-=n==e?q:t;Uc(b.text.charAt(n));)++n;return la(c,n,n==e?ha:w,-1>d?-1:1<d?1:0)}var va=Math.ceil(p/2),vb=e+va;if(n){vb=e;for(var K=0;K<va;++K)vb=
se(b,vb,1)}K=f(vb);if(K>d){T=vb;t=K;if(w=l)t+=1E3;p=va}else e=vb,q=K,ha=l,p-=va}}function ib(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==qc){qc=ja("pre");for(var b=0;49>b;++b)qc.appendChild(document.createTextNode("x")),qc.appendChild(ja("br"));qc.appendChild(document.createTextNode("x"))}Ab(a.measure,qc);b=qc.offsetHeight/50;3<b&&(a.cachedTextHeight=b);jc(a.measure);return b||1}function sb(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=ja("span","xxxxxxxxxx"),
c=ja("pre",[b]);Ab(a.measure,c);b=b.getBoundingClientRect();b=(b.right-b.left)/10;2<b&&(a.cachedCharWidth=b);return b||10}function $a(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,id:++Jf};Mc?Mc.ops.push(a.curOp):a.curOp.ownsGroup=Mc={ops:[a.curOp],delayedCallbacks:[]}}function Ya(a){if(a=a.curOp.ownsGroup)try{var b=
a.delayedCallbacks,c=0;do{for(;c<b.length;c++)b[c]();for(var d=0;d<a.ops.length;d++){var e=a.ops[d];if(e.cursorActivityHandlers)for(;e.cursorActivityCalled<e.cursorActivityHandlers.length;)e.cursorActivityHandlers[e.cursorActivityCalled++](e.cm)}}while(c<b.length)}finally{Mc=null;for(b=0;b<a.ops.length;b++)a.ops[b].cm.curOp=null;a=a.ops;for(b=0;b<a.length;b++)e=a[b],c=e.cm,d=c.display,e.updateMaxLine&&t(c),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<
d.viewFrom||e.scrollToPos.to.line>=d.viewTo)||d.maxLineChanged&&c.options.lineWrapping,e.update=e.mustUpdate&&new L(c,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate);for(b=0;b<a.length;b++)e=a[b],e.updatedDisplay=e.mustUpdate&&J(e.cm,e.update);for(b=0;b<a.length;b++){e=a[b];c=e.cm;d=c.display;e.updatedDisplay&&M(c);e.barMeasure=y(c);if(d.maxLineChanged&&!c.options.lineWrapping){var f=d.maxLine.text.length;f=nb(c,qb(c,d.maxLine),f,void 0);e.adjustWidthTo=f.left+3;e.maxScrollLeft=
Math.max(0,d.sizer.offsetLeft+e.adjustWidthTo+Cb-d.scroller.clientWidth)}if(e.updatedDisplay||e.selectionChanged)e.newSelectionNodes=ab(c)}for(b=0;b<a.length;b++)e=a[b],c=e.cm,null!=e.adjustWidthTo&&(c.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<c.doc.scrollLeft&&xb(c,Math.min(c.display.scroller.scrollLeft,e.maxScrollLeft),!0),c.display.maxLineChanged=!1),e.newSelectionNodes&&oa(c,e.newSelectionNodes),e.updatedDisplay&&da(c,e.barMeasure),(e.updatedDisplay||e.startHeight!=c.doc.height)&&
A(c,e.barMeasure),e.selectionChanged&&mb(c),c.state.focused&&e.updateInput&&wb(c,e.typing);for(b=0;b<a.length;b++){e=a[b];c=e.cm;d=c.display;f=c.doc;null!=e.adjustWidthTo&&1<Math.abs(e.barMeasure.scrollWidth-c.display.scroller.scrollWidth)&&A(c);e.updatedDisplay&&P(c,e.update);null==d.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(d.wheelStartX=d.wheelStartY=null);null!=e.scrollTop&&d.scroller.scrollTop!=e.scrollTop&&(d.scroller.scrollTop=d.scrollbarV.scrollTop=f.scrollTop=Math.max(0,
Math.min(d.scroller.scrollHeight-d.scroller.clientHeight,e.scrollTop)));null!=e.scrollLeft&&d.scroller.scrollLeft!=e.scrollLeft&&(d.scroller.scrollLeft=d.scrollbarH.scrollLeft=f.scrollLeft=Math.max(0,Math.min(d.scroller.scrollWidth-d.scroller.clientWidth,e.scrollLeft)),z(c));if(e.scrollToPos){a:{var g=C(f,e.scrollToPos.from);var l=C(f,e.scrollToPos.to),m=e.scrollToPos.margin;for(null==m&&(m=0);;){var F=!1,n=ba(c,g),p=l&&l!=g?ba(c,l):n;p=pc(c,Math.min(n.left,p.left),Math.min(n.top,p.top)-m,Math.max(n.left,
p.left),Math.max(n.bottom,p.bottom)+m);var q=c.doc.scrollTop,w=c.doc.scrollLeft;null!=p.scrollTop&&(oc(c,p.scrollTop),1<Math.abs(c.doc.scrollTop-q)&&(F=!0));null!=p.scrollLeft&&(xb(c,p.scrollLeft),1<Math.abs(c.doc.scrollLeft-w)&&(F=!0));if(!F){g=n;break a}}}e.scrollToPos.isCursor&&c.state.focused&&(l=g,m=c.display,F=m.sizer.getBoundingClientRect(),g=null,0>l.top+F.top?g=!0:l.bottom+F.top>(window.innerHeight||document.documentElement.clientHeight)&&(g=!1),null==g||Kf||(l=ja("div","\u200b",null,"position: absolute; top: "+
(l.top-m.viewOffset-c.display.lineSpace.offsetTop)+"px; height: "+(l.bottom-l.top+Cb)+"px; left: "+l.left+"px; width: 2px;"),c.display.lineSpace.appendChild(l),l.scrollIntoView(g),c.display.lineSpace.removeChild(l)))}g=e.maybeHiddenMarkers;l=e.maybeUnhiddenMarkers;if(g)for(m=0;m<g.length;++m)g[m].lines.length||db(g[m],"hide");if(l)for(m=0;m<l.length;++m)l[m].lines.length&&db(l[m],"unhide");d.wrapper.offsetHeight&&(f.scrollTop=c.display.scroller.scrollTop);e.updatedDisplay&&hb&&(c.options.lineWrapping&&
(d=e.barMeasure,c.display.sizer.offsetWidth+c.display.gutters.offsetWidth<c.display.scroller.clientWidth-1&&(c.display.sizer.style.minHeight=c.display.heightForcer.style.top="0px",c.display.gutters.style.height=d.docHeight+"px")),e.barMeasure.scrollWidth>e.barMeasure.clientWidth&&e.barMeasure.scrollWidth<e.barMeasure.clientWidth+1&&!(c.display.scroller.clientHeight-c.display.wrapper.clientHeight<Cb-3)&&A(c));e.changeObjs&&db(c,"changes",c,e.changeObjs)}}}function Ta(a,b){if(a.curOp)return b();$a(a);
try{return b()}finally{Ya(a)}}function Ra(a,b){return function(){if(a.curOp)return b.apply(a,arguments);$a(a);try{return b.apply(a,arguments)}finally{Ya(a)}}}function Na(a){return function(){if(this.curOp)return a.apply(this,arguments);$a(this);try{return a.apply(this,arguments)}finally{Ya(this)}}}function Za(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);$a(b);try{return a.apply(this,arguments)}finally{Ya(b)}}}function rb(a,b,c){for(var d=this.line=b,e;d=lc(d,!1);)d=
d.find(1,!0).line,(e||(e=[])).push(d);this.size=(this.rest=e)?Va(Oa(this.rest))-c+1:1;this.node=this.text=null;this.hidden=ic(a,b)}function kb(a,b,c){var d=[],e;for(e=b;e<c;)b=new rb(a.doc,na(a.doc,e),e),e+=b.size,d.push(b);return d}function Ia(a,b,c,d){null==b&&(b=a.doc.first);null==c&&(c=a.doc.first+a.doc.size);d||(d=0);var e=a.display;d&&c<e.viewTo&&(null==e.updateLineNumbers||e.updateLineNumbers>b)&&(e.updateLineNumbers=b);a.curOp.viewChanged=!0;if(b>=e.viewTo)bc&&ae(a.doc,b)<e.viewTo&&za(a);
else if(c<=e.viewFrom)bc&&Te(a.doc,c+d)>e.viewFrom?za(a):(e.viewFrom+=d,e.viewTo+=d);else if(b<=e.viewFrom&&c>=e.viewTo)za(a);else if(b<=e.viewFrom){var f=Ec(a,c,c+d,1);f?(e.view=e.view.slice(f.index),e.viewFrom=f.lineN,e.viewTo+=d):za(a)}else if(c>=e.viewTo)(f=Ec(a,b,b,-1))?(e.view=e.view.slice(0,f.index),e.viewTo=f.lineN):za(a);else{f=Ec(a,b,b,-1);var g=Ec(a,c,c+d,1);f&&g?(e.view=e.view.slice(0,f.index).concat(kb(a,f.lineN,g.lineN)).concat(e.view.slice(g.index)),e.viewTo+=d):za(a)}if(a=e.externalMeasured)c<
a.lineN?a.lineN+=d:b<a.lineN+a.size&&(e.externalMeasured=null)}function Xa(a,b,c){a.curOp.viewChanged=!0;var d=a.display,e=a.display.externalMeasured;e&&b>=e.lineN&&b<e.lineN+e.size&&(d.externalMeasured=null);b<d.viewFrom||b>=d.viewTo||(a=d.view[Bb(a,b)],null!=a.node&&(a=a.changes||(a.changes=[]),-1==fb(a,c)&&a.push(c)))}function za(a){a.display.viewFrom=a.display.viewTo=a.doc.first;a.display.view=[];a.display.viewOffset=0}function Bb(a,b){if(b>=a.display.viewTo)return null;b-=a.display.viewFrom;
if(0>b)return null;a=a.display.view;for(var c=0;c<a.length;c++)if(b-=a[c].size,0>b)return c}function Ec(a,b,c,d){var e=Bb(a,b),f=a.display.view;if(!bc||c==a.doc.first+a.doc.size)return{index:e,lineN:c};for(var g=0,l=a.display.viewFrom;g<e;g++)l+=f[g].size;if(l!=b){if(0<d){if(e==f.length-1)return null;b=l+f[e].size-b;e++}else b=l-b;c+=b}for(;ae(a.doc,c)!=c;){if(e==(0>d?0:f.length-1))return null;c+=d*f[e-(0>d?1:0)].size;e+=d}return{index:e,lineN:c}}function Yc(a){a=a.display.view;for(var b=0,c=0;c<
a.length;c++){var d=a[c];d.hidden||d.node&&!d.changes||++b}return b}function Fc(a){a.display.pollingFast||a.display.poll.set(a.options.pollInterval,function(){Oc(a);a.state.focused&&Fc(a)})}function nc(a){function b(){Oc(a)||c?(a.display.pollingFast=!1,Fc(a)):(c=!0,a.display.poll.set(60,b))}var c=!1;a.display.pollingFast=!0;a.display.poll.set(20,b)}function Oc(a){var b=a.display.input,c=a.display.prevInput,d=a.doc;if(!a.state.focused||Lf(b)&&!c||Sb(a)||a.options.disableInput)return!1;a.state.pasteIncoming&&
a.state.fakedLastChar&&(b.value=b.value.substring(0,b.value.length-1),a.state.fakedLastChar=!1);var e=b.value;if(e==c&&!a.somethingSelected())return!1;if(Fa&&9<=Pa&&a.display.inputHasSelection===e||Db&&/[\uf700-\uf7ff]/.test(e))return wb(a),!1;var f=!a.curOp;f&&$a(a);a.display.shift=!1;8203!=e.charCodeAt(0)||d.sel!=a.display.selForContextMenu||c||(c="\u200b");for(var g=0,l=Math.min(c.length,e.length);g<l&&c.charCodeAt(g)==e.charCodeAt(g);)++g;l=e.slice(g);var m=rc(l),F=null;a.state.pasteIncoming&&
1<d.sel.ranges.length&&(sc&&sc.join("\n")==l?F=0==d.sel.ranges.length%sc.length&&Qc(sc,rc):m.length==d.sel.ranges.length&&(F=Qc(m,function(a){return[a]})));for(var n=d.sel.ranges.length-1;0<=n;n--){var p=d.sel.ranges[n],q=p.from(),t=p.to();g<c.length?q=U(q.line,q.ch-(c.length-g)):a.state.overwrite&&p.empty()&&!a.state.pasteIncoming&&(t=U(t.line,Math.min(na(d,t.line).text.length,t.ch+Oa(m).length)));var w=a.curOp.updateInput;t={from:q,to:t,text:F?F[n%F.length]:m,origin:a.state.pasteIncoming?"paste":
a.state.cutIncoming?"cut":"+input"};Zb(a.doc,t);bb(a,"inputRead",a,t);if(l&&!a.state.pasteIncoming&&a.options.electricChars&&a.options.smartIndent&&100>p.head.ch&&(!n||d.sel.ranges[n-1].head.line!=p.head.line))if(q=a.getModeAt(p.head),q.electricChars)for(t=0;t<q.electricChars.length;t++){if(-1<l.indexOf(q.electricChars.charAt(t))){pb(a,p.head.line,"smart");break}}else q.electricInput&&(t=dc(t),q.electricInput.test(na(d,t.line).text.slice(0,t.ch))&&pb(a,p.head.line,"smart"))}ac(a);a.curOp.updateInput=
w;a.curOp.typing=!0;1E3<e.length||-1<e.indexOf("\n")?b.value=a.display.prevInput="":a.display.prevInput=e;f&&Ya(a);a.state.pasteIncoming=a.state.cutIncoming=!1;return!0}function wb(a,b){var c=a.doc;if(a.somethingSelected()){a.display.prevInput="";var d=c.sel.primary();var e=(d=cf&&(100<d.to().line-d.from().line||1E3<(e=a.getSelection()).length))?"-":e||a.getSelection();a.display.input.value=e;a.state.focused&&gd(a.display.input);Fa&&9<=Pa&&(a.display.inputHasSelection=e)}else b||(a.display.prevInput=
a.display.input.value="",Fa&&9<=Pa&&(a.display.inputHasSelection=null));a.display.inaccurateSelection=d}function lb(a){"nocursor"==a.options.readOnly||ke&&Wb()==a.display.input||a.display.input.focus()}function Bc(a){a.state.focused||(lb(a),Ic(a))}function Sb(a){return a.options.readOnly||a.doc.cantEdit}function Ac(a){function b(){a.state.focused&&setTimeout(zb(lb,a),0)}function c(b){Hb(a,b)||te(b)}function d(b){if(a.somethingSelected())sc=a.getSelections(),e.inaccurateSelection&&(e.prevInput="",
e.inaccurateSelection=!1,e.input.value=sc.join("\n"),gd(e.input));else{for(var c=[],d=[],f=0;f<a.doc.sel.ranges.length;f++){var g=a.doc.sel.ranges[f].head.line;g={anchor:U(g,0),head:U(g+1,0)};d.push(g);c.push(a.getRange(g.anchor,g.head))}"cut"==b.type?a.setSelections(d,null,cc):(e.prevInput="",e.input.value=c.join("\n"),gd(e.input));sc=c}"cut"==b.type&&(a.state.cutIncoming=!0)}var e=a.display;xa(e.scroller,"mousedown",Ra(a,Zc));Fa&&11>Pa?xa(e.scroller,"dblclick",Ra(a,function(b){if(!Hb(a,b)){var c=
Xb(a,b);!c||Tb(a,b,"gutterClick",!0,bb)||Mb(a.display,b)||(ob(b),b=xc(a,c),Ba(a.doc,b.anchor,b.head))}})):xa(e.scroller,"dblclick",function(b){Hb(a,b)||ob(b)});xa(e.lineSpace,"selectstart",function(a){Mb(e,a)||ob(a)});ue||xa(e.scroller,"contextmenu",function(b){Ed(a,b)});xa(e.scroller,"scroll",function(){e.scroller.clientHeight&&(oc(a,e.scroller.scrollTop),xb(a,e.scroller.scrollLeft,!0),db(a,"scroll",a))});xa(e.scrollbarV,"scroll",function(){e.scroller.clientHeight&&oc(a,e.scrollbarV.scrollTop)});
xa(e.scrollbarH,"scroll",function(){e.scroller.clientHeight&&xb(a,e.scrollbarH.scrollLeft)});xa(e.scroller,"mousewheel",function(b){zd(a,b)});xa(e.scroller,"DOMMouseScroll",function(b){zd(a,b)});xa(e.scrollbarH,"mousedown",b);xa(e.scrollbarV,"mousedown",b);xa(e.wrapper,"scroll",function(){e.wrapper.scrollTop=e.wrapper.scrollLeft=0});xa(e.input,"keyup",function(b){Hc.call(a,b)});xa(e.input,"input",function(){Fa&&9<=Pa&&a.display.inputHasSelection&&(a.display.inputHasSelection=null);nc(a)});xa(e.input,
"keydown",Ra(a,Yb));xa(e.input,"keypress",Ra(a,sd));xa(e.input,"focus",zb(Ic,a));xa(e.input,"blur",zb(Jc,a));a.options.dragDrop&&(xa(e.scroller,"dragstart",function(b){if(Fa&&(!a.state.draggingText||100>+new Date-df))te(b);else if(!Hb(a,b)&&!Mb(a.display,b)&&(b.dataTransfer.setData("Text",a.getSelection()),b.dataTransfer.setDragImage&&!ef)){var c=ja("img",null,null,"position: fixed; left: 0; top: 0;");c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";Fb&&(c.width=
c.height=1,a.display.wrapper.appendChild(c),c._top=c.offsetTop);b.dataTransfer.setDragImage(c,0,0);Fb&&c.parentNode.removeChild(c)}}),xa(e.scroller,"dragenter",c),xa(e.scroller,"dragover",c),xa(e.scroller,"drop",Ra(a,he)));xa(e.scroller,"paste",function(b){Mb(e,b)||(a.state.pasteIncoming=!0,lb(a),nc(a))});xa(e.input,"paste",function(){if(hb&&!a.state.fakedLastChar&&!(200>new Date-a.state.lastMiddleDown)){var b=e.input.selectionStart,c=e.input.selectionEnd;e.input.value+="$";e.input.selectionEnd=c;
e.input.selectionStart=b;a.state.fakedLastChar=!0}a.state.pasteIncoming=!0;nc(a)});xa(e.input,"cut",d);xa(e.input,"copy",d);me&&xa(e.sizer,"mouseup",function(){Wb()==e.input&&e.input.blur();lb(a)})}function ge(a){var b=a.display;b.cachedCharWidth=b.cachedTextHeight=b.cachedPaddingH=null;a.setSize()}function Mb(a,b){for(b=b.target||b.srcElement;b!=a.wrapper;b=b.parentNode)if(!b||b.ignoreEvents||b.parentNode==a.sizer&&b!=a.mover)return!0}function Xb(a,b,c,d){var e=a.display;if(!c&&(c=b.target||b.srcElement,
c==e.scrollbarH||c==e.scrollbarV||c==e.scrollbarFiller||c==e.gutterFiller))return null;e=e.lineSpace.getBoundingClientRect();try{var f=b.clientX-e.left;var g=b.clientY-e.top}catch(Ff){return null}b=Qa(a,f,g);var l;d&&1==b.xRel&&(l=na(a.doc,b.line).text).length==b.ch&&(d=Eb(l,l.length,a.options.tabSize)-l.length,b=U(b.line,Math.max(0,Math.round((f-cb(a.display).left)/sb(a.display))-d)));return b}function Zc(a){if(!Hb(this,a)){var b=this.display;b.shift=a.shiftKey;if(Mb(b,a))hb||(b.scroller.draggable=
!1,setTimeout(function(){b.scroller.draggable=!0},100));else if(!Tb(this,a,"gutterClick",!0,bb)){var c=Xb(this,a);window.focus();switch(Ge(a)){case 1:c?rd(this,a,c):(a.target||a.srcElement)==b.scroller&&ob(a);break;case 2:hb&&(this.state.lastMiddleDown=+new Date);c&&Ba(this.doc,c);setTimeout(zb(lb,this),20);ob(a);break;case 3:ue&&Ed(this,a)}}}}function rd(a,b,c){setTimeout(zb(Bc,a),0);var d=+new Date;if(Kd&&Kd.time>d-400&&0==Aa(Kd.pos,c))var e="triple";else Ld&&Ld.time>d-400&&0==Aa(Ld.pos,c)?(e="double",
Kd={time:d,pos:c}):(e="single",Ld={time:d,pos:c});d=a.doc.sel;var f=Db?b.metaKey:b.ctrlKey;a.options.dragDrop&&Mf&&!Sb(a)&&"single"==e&&-1<d.contains(c)&&d.somethingSelected()?qd(a,b,c,f):Ub(a,b,c,e,f)}function qd(a,b,c,d){var e=a.display,f=Ra(a,function(g){hb&&(e.scroller.draggable=!1);a.state.draggingText=!1;Rb(document,"mouseup",f);Rb(e.scroller,"drop",f);10>Math.abs(b.clientX-g.clientX)+Math.abs(b.clientY-g.clientY)&&(ob(g),d||Ba(a.doc,c),lb(a),Fa&&9==Pa&&setTimeout(function(){document.body.focus();
lb(a)},20))});hb&&(e.scroller.draggable=!0);a.state.draggingText=f;e.scroller.dragDrop&&e.scroller.dragDrop();xa(document,"mouseup",f);xa(e.scroller,"drop",f)}function Ub(a,b,c,d,e){function f(b){if(0!=Aa(T,b))if(T=b,"rect"==d){var e=[],f=a.options.tabSize,g=Eb(na(F,c.line).text,c.ch,f),l=Eb(na(F,b.line).text,b.ch,f),m=Math.min(g,l);g=Math.max(g,l);l=Math.min(c.line,b.line);for(var t=Math.min(a.lastLine(),Math.max(c.line,b.line));l<=t;l++){var ha=na(F,l).text,w=Ce(ha,m,f);m==g?e.push(new Q(U(l,w),
U(l,w))):ha.length>w&&e.push(new Q(U(l,w),U(l,Ce(ha,g,f))))}e.length||e.push(new Q(c,c));Ca(F,R(n.ranges.slice(0,p).concat(e),p),{origin:"*mouse",scroll:!1});a.scrollIntoView(b)}else e=q,f=e.anchor,m=b,"single"!=d&&(b="double"==d?xc(a,b):new Q(U(b.line,0),C(F,U(b.line+1,0))),0<Aa(b.anchor,f)?(m=b.head,f=sa(e.from(),b.anchor)):(m=b.anchor,f=I(e.to(),b.head))),e=n.ranges.slice(0),e[p]=new Q(C(F,f),m),Ca(F,R(e,p),ve)}function g(b){var c=++ha,e=Xb(a,b,!0,"rect"==d);if(e)if(0!=Aa(e,T)){Bc(a);f(e);var l=
x(m,F);(e.line>=l.to||e.line<l.from)&&setTimeout(Ra(a,function(){ha==c&&g(b)}),150)}else{var n=b.clientY<t.top?-20:b.clientY>t.bottom?20:0;n&&setTimeout(Ra(a,function(){ha==c&&(m.scroller.scrollTop+=n,g(b))}),50)}}function l(b){ha=Infinity;ob(b);lb(a);Rb(document,"mousemove",w);Rb(document,"mouseup",K);F.history.lastSelOrigin=null}var m=a.display,F=a.doc;ob(b);var n=F.sel;if(e&&!b.shiftKey){var p=F.sel.contains(c);var q=-1<p?F.sel.ranges[p]:new Q(c,c)}else q=F.sel.primary();b.altKey?(d="rect",e||
(q=new Q(c,c)),c=Xb(a,b,!0,!0),p=-1):"double"==d?(b=xc(a,c),q=a.display.shift||F.extend?O(F,q,b.anchor,b.head):b):"triple"==d?(b=new Q(U(c.line,0),C(F,U(c.line+1,0))),q=a.display.shift||F.extend?O(F,q,b.anchor,b.head):b):q=O(F,q,c);e?-1<p?Ja(F,p,q,ve):(p=F.sel.ranges.length,Ca(F,R(F.sel.ranges.concat([q]),p),{scroll:!1,origin:"*mouse"})):(p=0,Ca(F,new ma([q],0),ve),n=F.sel);var T=c,t=m.wrapper.getBoundingClientRect(),ha=0,w=Ra(a,function(a){Ge(a)?g(a):l(a)}),K=Ra(a,l);xa(document,"mousemove",w);xa(document,
"mouseup",K)}function Tb(a,b,c,d,e){try{var f=b.clientX,g=b.clientY}catch(Gf){return!1}if(f>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;d&&ob(b);d=a.display;var l=d.lineDiv.getBoundingClientRect();if(g>l.bottom||!yb(a,c))return fe(b);g-=l.top-d.viewOffset;for(l=0;l<a.options.gutters.length;++l){var m=d.gutters.childNodes[l];if(m&&m.getBoundingClientRect().right>=f)return f=mc(a.doc,g),e(a,c,a,f,a.options.gutters[l],b),fe(b)}}function he(a){var b=this;if(!Hb(b,a)&&!Mb(b.display,
a)){ob(a);Fa&&(df=+new Date);var c=Xb(b,a,!0),d=a.dataTransfer.files;if(c&&!Sb(b))if(d&&d.length&&window.FileReader&&window.File){var e=d.length,f=Array(e),g=0;a=function(a,d){var l=new FileReader;l.onload=Ra(b,function(){f[d]=l.result;if(++g==e){c=C(b.doc,c);var a={from:c,to:c,text:rc(f.join("\n")),origin:"paste"};Zb(b.doc,a);Ua(b.doc,ua(c,dc(a)))}});l.readAsText(a)};for(var l=0;l<e;++l)a(d[l],l)}else if(b.state.draggingText&&-1<b.doc.sel.contains(c))b.state.draggingText(a),setTimeout(zb(lb,b),20);
else try{if(f=a.dataTransfer.getData("Text")){if(b.state.draggingText&&(Db?!a.metaKey:!a.ctrlKey))var m=b.listSelections();Ga(b.doc,ua(c,c));if(m)for(l=0;l<m.length;++l)Nb(b.doc,"",m[l].anchor,m[l].head,"drag");b.replaceSelection(f,"around","paste");lb(b)}}catch(Gf){}}}function oc(a,b){2>Math.abs(a.doc.scrollTop-b)||(a.doc.scrollTop=b,hd||fa(a,{top:b}),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=b),a.display.scrollbarV.scrollTop!=b&&(a.display.scrollbarV.scrollTop=b),hd&&fa(a),
Ea(a,100))}function xb(a,b,c){(c?b==a.doc.scrollLeft:2>Math.abs(a.doc.scrollLeft-b))||(b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),a.doc.scrollLeft=b,z(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbarH.scrollLeft!=b&&(a.display.scrollbarH.scrollLeft=b))}function zd(a,b){var c=b.wheelDeltaX,d=b.wheelDeltaY;null==c&&b.detail&&b.axis==b.HORIZONTAL_AXIS&&(c=b.detail);null==d&&b.detail&&b.axis==b.VERTICAL_AXIS?d=b.detail:null==d&&
(d=b.wheelDelta);var e=a.display,f=e.scroller;if(c&&f.scrollWidth>f.clientWidth||d&&f.scrollHeight>f.clientHeight){if(d&&Db&&hb){var g=b.target,l=e.view;a:for(;g!=f;g=g.parentNode)for(var m=0;m<l.length;m++)if(l[m].node==g){a.display.currentWheelTarget=g;break a}}!c||hd||Fb||null==Gb?(d&&null!=Gb&&(b=d*Gb,g=a.doc.scrollTop,l=g+e.wrapper.clientHeight,0>b?g=Math.max(0,g+b-50):l=Math.min(a.doc.height,l+b+50),fa(a,{top:g,bottom:l})),20>Md&&(null==e.wheelStartX?(e.wheelStartX=f.scrollLeft,e.wheelStartY=
f.scrollTop,e.wheelDX=c,e.wheelDY=d,setTimeout(function(){if(null!=e.wheelStartX){var a=f.scrollLeft-e.wheelStartX,b=f.scrollTop-e.wheelStartY;a=b&&e.wheelDY&&b/e.wheelDY||a&&e.wheelDX&&a/e.wheelDX;e.wheelStartX=e.wheelStartY=null;a&&(Gb=(Gb*Md+a)/(Md+1),++Md)}},200)):(e.wheelDX+=c,e.wheelDY+=d))):(d&&oc(a,Math.max(0,Math.min(f.scrollTop+d*Gb,f.scrollHeight-f.clientHeight))),xb(a,Math.max(0,Math.min(f.scrollLeft+c*Gb,f.scrollWidth-f.clientWidth))),ob(b),e.wheelStartX=null)}}function Gc(a,b,c){if("string"==
typeof b&&(b=Nd[b],!b))return!1;a.display.pollingFast&&Oc(a)&&(a.display.pollingFast=!1);var d=a.display.shift,e=!1;try{Sb(a)&&(a.state.suppressEdits=!0),c&&(a.display.shift=!1),e=b(a)!=ff}finally{a.display.shift=d,a.state.suppressEdits=!1}return e}function Ad(a){var b=a.state.keyMaps.slice(0);a.options.extraKeys&&b.push(a.options.extraKeys);b.push(a.options.keyMap);return b}function Bd(a,b){var c=Nc(a.options.keyMap),d=c.auto;clearTimeout(gf);d&&!Nf(b)&&(gf=setTimeout(function(){Nc(a.options.keyMap)==
c&&(a.options.keyMap=d.call?d.call(null,a):d,m(a))},50));var e=Of(b,!0),f=!1;if(!e)return!1;f=Ad(a);if(f=b.shiftKey?Od("Shift-"+e,f,function(b){return Gc(a,b,!0)})||Od(e,f,function(b){if("string"==typeof b?/^go[A-Z]/.test(b):b.motion)return Gc(a,b)}):Od(e,f,function(b){return Gc(a,b)}))ob(b),mb(a),bb(a,"keyHandled",a,e,b);return f}function Cd(a,b,c){var d=Od("'"+c+"'",Ad(a),function(b){return Gc(a,b,!0)});d&&(ob(b),mb(a),bb(a,"keyHandled",a,"'"+c+"'",b));return d}function Yb(a){Bc(this);if(!Hb(this,
a)){Fa&&11>Pa&&27==a.keyCode&&(a.returnValue=!1);var b=a.keyCode;this.display.shift=16==b||a.shiftKey;var c=Bd(this,a);Fb&&(we=c?b:null,!c&&88==b&&!cf&&(Db?a.metaKey:a.ctrlKey)&&this.replaceSelection("",null,"cut"));18!=b||/\bCodeMirror-crosshair\b/.test(this.display.lineDiv.className)||Dd(this)}}function Dd(a){function b(a){18!=a.keyCode&&a.altKey||(vd(c,"CodeMirror-crosshair"),Rb(document,"keyup",b),Rb(document,"mouseover",b))}var c=a.display.lineDiv;Pd(c,"CodeMirror-crosshair");xa(document,"keyup",
b);xa(document,"mouseover",b)}function Hc(a){16==a.keyCode&&(this.doc.sel.shift=!1);Hb(this,a)}function sd(a){if(!(Hb(this,a)||a.ctrlKey&&!a.altKey||Db&&a.metaKey)){var b=a.keyCode,c=a.charCode;Fb&&b==we?(we=null,ob(a)):(Fb&&(!a.which||10>a.which)||me)&&Bd(this,a)||(b=String.fromCharCode(null==c?b:c),Cd(this,a,b)||(Fa&&9<=Pa&&(this.display.inputHasSelection=null),nc(this)))}}function Ic(a){"nocursor"!=a.options.readOnly&&(a.state.focused||(db(a,"focus",a),a.state.focused=!0,Pd(a.display.wrapper,"CodeMirror-focused"),
a.curOp||a.display.selForContextMenu==a.doc.sel||(wb(a),hb&&setTimeout(zb(wb,a,!0),0))),Fc(a),mb(a))}function Jc(a){a.state.focused&&(db(a,"blur",a),a.state.focused=!1,vd(a.display.wrapper,"CodeMirror-focused"));clearInterval(a.display.blinker);setTimeout(function(){a.state.focused||(a.display.shift=!1)},150)}function Ed(a,b){function c(){if(null!=e.input.selectionStart){var b=a.somethingSelected(),c=e.input.value="\u200b"+(b?e.input.value:"");e.prevInput=b?"":"\u200b";e.input.selectionStart=1;e.input.selectionEnd=
c.length;e.selForContextMenu=a.doc.sel}}function d(){e.inputDiv.style.position="relative";e.input.style.cssText=l;Fa&&9>Pa&&(e.scrollbarV.scrollTop=e.scroller.scrollTop=g);Fc(a);if(null!=e.input.selectionStart){(!Fa||Fa&&9>Pa)&&c();var b=0,d=function(){e.selForContextMenu==a.doc.sel&&0==e.input.selectionStart?Ra(a,Nd.selectAll)(a):10>b++?e.detectingSelectAll=setTimeout(d,500):wb(a)};e.detectingSelectAll=setTimeout(d,200)}}if(!Hb(a,b,"contextmenu")){var e=a.display;if(!Mb(e,b)&&!ie(a,b)){var f=Xb(a,
b),g=e.scroller.scrollTop;if(f&&!Fb){a.options.resetSelectionOnContextMenu&&-1==a.doc.sel.contains(f)&&Ra(a,Ca)(a.doc,ua(f),cc);var l=e.input.style.cssText;e.inputDiv.style.position="absolute";e.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(b.clientY-5)+"px; left: "+(b.clientX-5)+"px; z-index: 1000; background: "+(Fa?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";if(hb)var m=
window.scrollY;lb(a);hb&&window.scrollTo(null,m);wb(a);a.somethingSelected()||(e.input.value=e.prevInput=" ");e.selForContextMenu=a.doc.sel;clearTimeout(e.detectingSelectAll);Fa&&9<=Pa&&c();if(ue){te(b);var F=function(){Rb(window,"mouseup",F);setTimeout(d,20)};xa(window,"mouseup",F)}else setTimeout(d,50)}}}}function ie(a,b){return yb(a,"gutterContextMenu")?Tb(a,b,"gutterContextMenu",!1,db):!1}function Fd(a,b){if(0>Aa(a,b.from))return a;if(0>=Aa(a,b.to))return dc(b);var c=a.line+b.text.length-(b.to.line-
b.from.line)-1,d=a.ch;a.line==b.to.line&&(d+=dc(b).ch-b.to.ch);return U(c,d)}function $c(a,b){for(var c=[],d=0;d<a.sel.ranges.length;d++){var e=a.sel.ranges[d];c.push(new Q(Fd(e.anchor,b),Fd(e.head,b)))}return R(c,a.sel.primIndex)}function Gd(a,b,c){return a.line==b.line?U(c.line,a.ch-b.ch+c.ch):U(c.line+(a.line-b.line),a.ch)}function Hd(a,b,c){b={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,cancel:function(){this.canceled=!0}};c&&(b.update=function(b,c,d,e){b&&(this.from=C(a,b));c&&
(this.to=C(a,c));d&&(this.text=d);void 0!==e&&(this.origin=e)});db(a,"beforeChange",a,b);a.cm&&db(a.cm,"beforeChange",a.cm,b);return b.canceled?null:{from:b.from,to:b.to,text:b.text,origin:b.origin}}function Zb(a,b,c){if(a.cm){if(!a.cm.curOp)return Ra(a.cm,Zb)(a,b,c);if(a.cm.state.suppressEdits)return}if(yb(a,"beforeChange")||a.cm&&yb(a.cm,"beforeChange"))if(b=Hd(a,b,!0),!b)return;if(c=hf&&!c&&yf(a,b.from,b.to))for(var d=c.length-1;0<=d;--d)ad(a,{from:c[d].from,to:c[d].to,text:d?[""]:b.text});else ad(a,
b)}function ad(a,b){if(1!=b.text.length||""!=b.text[0]||0!=Aa(b.from,b.to)){var c=$c(a,b);Ke(a,b,c,a.cm?a.cm.curOp.id:NaN);Pb(a,b,c,Wd(a,b));var d=[];kc(a,function(a,c){c||-1!=fb(d,a.history)||(Ie(a.history,b),d.push(a.history));Pb(a,b,null,Wd(a,b))})}}function Vb(a,b,c){if(!a.cm||!a.cm.state.suppressEdits){for(var d=a.history,e,f=a.sel,g="undo"==b?d.done:d.undone,l="undo"==b?d.undone:d.done,m=0;m<g.length&&(e=g[m],c?!e.ranges||e.equals(a.sel):e.ranges);m++);if(m!=g.length){for(d.lastOrigin=d.lastSelOrigin=
null;;)if(e=g.pop(),e.ranges){yd(e,l);if(c&&!e.equals(a.sel)){Ca(a,e,{clearRedo:!1});return}f=e}else break;c=[];yd(f,l);l.push({changes:c,generation:d.generation});d.generation=e.generation||++d.maxGeneration;d=yb(a,"beforeChange")||a.cm&&yb(a.cm,"beforeChange");for(m=e.changes.length-1;0<=m;--m){var F=e.changes[m];F.origin=b;if(d&&!Hd(a,F,!1)){g.length=0;break}c.push(ee(a,F));f=m?$c(a,F):Oa(g);Pb(a,F,f,Pe(a,F));!m&&a.cm&&a.cm.scrollIntoView({from:F.from,to:dc(F)});var n=[];kc(a,function(a,b){b||
-1!=fb(n,a.history)||(Ie(a.history,F),n.push(a.history));Pb(a,F,null,Pe(a,F))})}}}}function bd(a,b){if(0!=b&&(a.first+=b,a.sel=new ma(Qc(a.sel.ranges,function(a){return new Q(U(a.anchor.line+b,a.anchor.ch),U(a.head.line+b,a.head.ch))}),a.sel.primIndex),a.cm)){Ia(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,d=c.viewFrom;d<c.viewTo;d++)Xa(a.cm,d,"gutter")}}function Pb(a,b,c,d){if(a.cm&&!a.cm.curOp)return Ra(a.cm,Pb)(a,b,c,d);if(b.to.line<a.first)bd(a,b.text.length-1-(b.to.line-b.from.line));else if(!(b.from.line>
a.lastLine())){if(b.from.line<a.first){var e=b.text.length-1-(a.first-b.from.line);bd(a,e);b={from:U(a.first,0),to:U(b.to.line+e,b.to.ch),text:[Oa(b.text)],origin:b.origin}}e=a.lastLine();b.to.line>e&&(b={from:b.from,to:U(e,na(a,e).text.length),text:[b.text[0]],origin:b.origin});b.removed=Xc(a,b.from,b.to);c||(c=$c(a,b));a.cm?je(a.cm,b,d):ce(a,b,d);Ga(a,c,cc)}}function je(a,b,c){var d=a.doc,e=a.display,g=b.from,l=b.to,m=!1,n=g.line;a.options.lineWrapping||(n=Va(Ib(na(d,g.line))),d.iter(n,l.line+1,
function(a){if(a==e.maxLine)return m=!0}));-1<d.sel.contains(b.from,b.to)&&Xd(a);ce(d,b,c,f(a));a.options.lineWrapping||(d.iter(n,g.line+b.text.length,function(a){var b=p(a);b>e.maxLineLength&&(e.maxLine=a,e.maxLineLength=b,e.maxLineChanged=!0,m=!1)}),m&&(a.curOp.updateMaxLine=!0));d.frontier=Math.min(d.frontier,g.line);Ea(a,400);c=b.text.length-(l.line-g.line)-1;g.line!=l.line||1!=b.text.length||Re(a.doc,b)?Ia(a,g.line,l.line+1,c):Xa(a,g.line,"text");c=yb(a,"changes");if((d=yb(a,"change"))||c)b=
{from:g,to:l,text:b.text,removed:b.removed,origin:b.origin},d&&bb(a,"change",a,b),c&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(b);a.display.selForContextMenu=null}function Nb(a,b,c,d,e){d||(d=c);if(0>Aa(d,c)){var f=d;d=c;c=f}"string"==typeof b&&(b=rc(b));Zb(a,{from:c,to:d,text:b,origin:e})}function pc(a,b,c,d,e){var f=a.display,g=ib(a.display);0>c&&(c=0);var l=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:f.scroller.scrollTop,m=f.scroller.clientHeight-Cb,n={};e-c>m&&(e=c+m);var F=a.doc.height+
wa(f);c<l?n.scrollTop=c<g?0:c:e>l+m&&(e=Math.min(c,(e>F-g?F:e)-m),e!=l&&(n.scrollTop=e));a=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:f.scroller.scrollLeft;f=f.scroller.clientWidth-Cb-f.gutters.offsetWidth;(l=d-b>f)&&(d=c+m);10>b?n.scrollLeft=0:b<a?n.scrollLeft=Math.max(0,b-(l?0:10)):d>f+a-3&&(n.scrollLeft=d+(l?0:10)-f);return n}function $b(a,b,c){null==b&&null==c||Kc(a);null!=b&&(a.curOp.scrollLeft=(null==a.curOp.scrollLeft?a.doc.scrollLeft:a.curOp.scrollLeft)+b);null!=c&&(a.curOp.scrollTop=
(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+c)}function ac(a){Kc(a);var b=a.getCursor(),c=b,d=b;a.options.lineWrapping||(c=b.ch?U(b.line,b.ch-1):b,d=U(b.line,b.ch+1));a.curOp.scrollToPos={from:c,to:d,margin:a.options.cursorScrollMargin,isCursor:!0}}function Kc(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=Sa(a,b.from),d=Sa(a,b.to);b=pc(a,Math.min(c.left,d.left),Math.min(c.top,d.top)-b.margin,Math.max(c.right,d.right),Math.max(c.bottom,d.bottom)+b.margin);a.scrollTo(b.scrollLeft,
b.scrollTop)}}function pb(a,b,c,d){var e=a.doc,f;null==c&&(c="add");"smart"==c&&(e.mode.indent?f=La(a,b):c="prev");var g=a.options.tabSize,l=na(e,b),m=Eb(l.text,null,g);l.stateAfter&&(l.stateAfter=null);var n=l.text.match(/^\s*/)[0];if(!d&&!/\S/.test(l.text)){var F=0;c="not"}else if("smart"==c&&(F=e.mode.indent(f,l.text.slice(n.length),l.text),F==ff||150<F)){if(!d)return;c="prev"}"prev"==c?F=b>e.first?Eb(na(e,b-1).text,null,g):0:"add"==c?F=m+a.options.indentUnit:"subtract"==c?F=m-a.options.indentUnit:
"number"==typeof c&&(F=m+c);F=Math.max(0,F);c="";d=0;if(a.options.indentWithTabs)for(a=Math.floor(F/g);a;--a)d+=g,c+="\t";d<F&&(c+=De(F-d));if(c!=n)Nb(e,c,U(b,0),U(b,n.length),"+input");else for(a=0;a<e.sel.ranges.length;a++)if(g=e.sel.ranges[a],g.head.line==b&&g.head.ch<n.length){d=U(b,n.length);Ja(e,a,new Q(d,d));break}l.stateAfter=null}function pd(a,b,c,d){var e=b,f=b;"number"==typeof b?f=na(a,Math.max(a.first,Math.min(b,a.first+a.size-1))):e=Va(b);if(null==e)return null;d(f,e)&&a.cm&&Xa(a.cm,
e,c);return f}function fc(a,b){for(var c=a.doc.sel.ranges,d=[],e=0;e<c.length;e++){for(var f=b(c[e]);d.length&&0>=Aa(f.from,Oa(d).to);){var g=d.pop();if(0>Aa(g.from,f.from)){f.from=g.from;break}}d.push(f)}Ta(a,function(){for(var b=d.length-1;0<=b;b--)Nb(a.doc,"",d[b].from,d[b].to,"+delete");ac(a)})}function Ud(a,b,c,d,e){function f(b){var d=(e?se:jf)(n,l,c,!0);if(null==d){if(b=!b)b=g+c,b<a.first||b>=a.first+a.size?b=F=!1:(g=b,b=n=na(a,b));if(b)l=e?(0>c?Jd:Id)(n):0>c?n.text.length:0;else return F=
!1}else l=d;return!0}var g=b.line,l=b.ch,m=c,n=na(a,g),F=!0;if("char"==d)f();else if("column"==d)f(!0);else if("word"==d||"group"==d){var p=null;d="group"==d;b=a.cm&&a.cm.getHelper(b,"wordChars");for(var q=!0;!(0>c)||f(!q);q=!1){var T=n.text.charAt(l)||"\n";T=ud(T,b)?"w":d&&"\n"==T?"n":!d||/\s/.test(T)?null:"p";!d||q||T||(T="s");if(p&&p!=T){0>c&&(c=1,f());break}T&&(p=T);if(0<c&&!f(!q))break}}m=Ka(a,U(g,l),m,!0);F||(m.hitSide=!0);return m}function Vd(a,b,c,d){var e=a.doc,f=b.left,g;for("page"==d?g=
b.top+c*(Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight)-(0>c?1.5:.5)*ib(a.display)):"line"==d&&(g=0<c?b.bottom+3:b.top-3);;){b=Qa(a,f,g);if(!b.outside)break;if(0>c?0>=g:g>=e.height){b.hitSide=!0;break}g+=5*c}return b}function xc(a,b){var c=na(a.doc,b.line).text,d=b.ch,e=b.ch;if(c){var f=a.getHelper(b,"wordChars");(0>b.xRel||e==c.length)&&d?--d:++e;a=c.charAt(d);for(a=ud(a,f)?function(a){return ud(a,f)}:/\s/.test(a)?function(a){return/\s/.test(a)}:
function(a){return!/\s/.test(a)&&!ud(a)};0<d&&a(c.charAt(d-1));)--d;for(;e<c.length&&a(c.charAt(e));)++e}return new Q(U(b.line,d),U(b.line,e))}function ta(b,c,d,e){a.defaults[b]=c;d&&(Lc[b]=e?function(a,b,c){c!=bf&&d(a,b,c)}:d)}function Nc(a){return"string"==typeof a?Qb[a]:a}function yc(a,b,c,d,e){if(d&&d.shared)return sf(a,b,c,d,e);if(a.cm&&!a.cm.curOp)return Ra(a.cm,yc)(a,b,c,d,e);var f=new tc(a,e);e=Aa(b,c);d&&Tc(d,f,!1);if(0<e||0==e&&!1!==f.clearWhenEmpty)return f;f.replacedWith&&(f.collapsed=
!0,f.widgetNode=ja("span",[f.replacedWith],"CodeMirror-widget"),d.handleMouseEvents||(f.widgetNode.ignoreEvents=!0),d.insertLeft&&(f.widgetNode.insertLeft=!0));if(f.collapsed){if(Dc(a,b.line,b,c,f)||b.line!=c.line&&Dc(a,c.line,b,c,f))throw Error("Inserting collapsed marker partially overlapping an existing one");bc=!0}f.addToHistory&&Ke(a,{from:b,to:c,origin:"markText"},a.sel,NaN);var g=b.line,l=a.cm,m;a.iter(g,c.line+1,function(a){l&&f.collapsed&&!l.options.lineWrapping&&Ib(a)==l.display.maxLine&&
(m=!0);f.collapsed&&g!=b.line&&Jb(a,0);var d=new zc(f,g==b.line?b.ch:null,g==c.line?c.ch:null);a.markedSpans=a.markedSpans?a.markedSpans.concat([d]):[d];d.marker.attachLine(a);++g});f.collapsed&&a.iter(b.line,c.line+1,function(b){ic(a,b)&&Jb(b,0)});f.clearOnEnter&&xa(f,"beforeCursorEnter",function(){f.clear()});f.readOnly&&(hf=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory());f.collapsed&&(f.id=++Pf,f.atomic=!0);if(l){m&&(l.curOp.updateMaxLine=!0);if(f.collapsed)Ia(l,b.line,c.line+
1);else if(f.className||f.title||f.startStyle||f.endStyle)for(d=b.line;d<=c.line;d++)Xa(l,d,"text");f.atomic&&Ma(l.doc);bb(l,"markerAdded",l,f)}return f}function sf(a,b,c,d,e){d=Tc(d);d.shared=!1;var f=[yc(a,b,c,d,e)],g=f[0],l=d.widgetNode;kc(a,function(a){l&&(d.widgetNode=l.cloneNode(!0));f.push(yc(a,C(a,b),C(a,c),d,e));for(var m=0;m<a.linked.length;++m)if(a.linked[m].isParent)return;g=Oa(f)});return new Qd(f,g)}function Be(a){return a.findMarks(U(a.first,0),a.clipPos(U(a.lastLine())),function(a){return a.parent})}
function tf(a){for(var b=0;b<a.length;b++){var c=a[b],d=[c.primary.doc];kc(c.primary.doc,function(a){d.push(a)});for(var e=0;e<c.markers.length;e++){var f=c.markers[e];-1==fb(d,f.doc)&&(f.parent=null,c.markers.splice(e--,1))}}}function zc(a,b,c){this.marker=a;this.from=b;this.to=c}function Pc(a,b){if(a)for(var c=0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function Wd(a,b){var c=W(a,b.from.line)&&na(a,b.from.line).markedSpans,d=W(a,b.to.line)&&na(a,b.to.line).markedSpans;if(!c&&!d)return null;
a=b.from.ch;var e=b.to.ch,f=0==Aa(b.from,b.to);if(c)for(var g=0,l;g<c.length;++g){var m=c[g],n=m.marker;if(null==m.from||(n.inclusiveLeft?m.from<=a:m.from<a)||!(m.from!=a||"bookmark"!=n.type||f&&m.marker.insertLeft)){var p=null==m.to||(n.inclusiveRight?m.to>=a:m.to>a);(l||(l=[])).push(new zc(n,m.from,p?null:m.to))}}c=l;var F;if(d)for(l=0;l<d.length;++l)if(g=d[l],m=g.marker,null==g.to||(m.inclusiveRight?g.to>=e:g.to>e)||g.from==e&&"bookmark"==m.type&&(!f||g.marker.insertLeft))n=null==g.from||(m.inclusiveLeft?
g.from<=e:g.from<e),(F||(F=[])).push(new zc(m,n?null:g.from-e,null==g.to?null:g.to-e));e=1==b.text.length;f=Oa(b.text).length+(e?a:0);if(c)for(d=0;d<c.length;++d)if(l=c[d],null==l.to)(g=Pc(F,l.marker),g)?e&&(l.to=null==g.to?null:g.to+f):l.to=a;if(F)for(d=0;d<F.length;++d)l=F[d],null!=l.to&&(l.to+=f),null==l.from?(g=Pc(c,l.marker),g||(l.from=f,e&&(c||(c=[])).push(l))):(l.from+=f,e&&(c||(c=[])).push(l));c&&(c=Oe(c));F&&F!=c&&(F=Oe(F));a=[c];if(!e){b=b.text.length-2;var q;if(0<b&&c)for(d=0;d<c.length;++d)null==
c[d].to&&(q||(q=[])).push(new zc(c[d].marker,null,null));for(d=0;d<b;++d)a.push(q);a.push(F)}return a}function Oe(a){for(var b=0;b<a.length;++b){var c=a[b];null!=c.from&&c.from==c.to&&!1!==c.marker.clearWhenEmpty&&a.splice(b--,1)}return a.length?a:null}function Pe(a,b){var c;if(c=b["spans_"+a.id]){for(var d=0,e=[];d<b.text.length;++d)e.push(wf(c[d]));c=e}else c=null;a=Wd(a,b);if(!c)return a;if(!a)return c;for(b=0;b<c.length;++b)if(d=c[b],e=a[b],d&&e){var f=0;a:for(;f<e.length;++f){for(var g=e[f],
l=0;l<d.length;++l)if(d[l].marker==g.marker)continue a;d.push(g)}}else e&&(c[b]=e);return c}function yf(a,b,c){var d=null;a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||d&&-1!=fb(d,c)||(d||(d=[])).push(c)}});if(!d)return null;a=[{from:b,to:c}];for(b=0;b<d.length;++b){c=d[b];for(var e=c.find(0),f=0;f<a.length;++f){var g=a[f];if(!(0>Aa(g.to,e.from)||0<Aa(g.from,e.to))){var l=[f,1],m=Aa(g.from,e.from),n=Aa(g.to,e.to);
(0>m||!c.inclusiveLeft&&!m)&&l.push({from:g.from,to:e.from});(0<n||!c.inclusiveRight&&!n)&&l.push({from:e.to,to:g.to});a.splice.apply(a,l);f+=l.length-1}}}return a}function Vc(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function Qe(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function Se(a,b){var c=a.lines.length-b.lines.length;if(0!=c)return c;c=a.find();var d=b.find(),e=Aa(c.from,d.from)||(a.inclusiveLeft?
-1:0)-(b.inclusiveLeft?-1:0);return e?-e:(c=Aa(c.to,d.to)||(a.inclusiveRight?1:0)-(b.inclusiveRight?1:0))?c:b.id-a.id}function lc(a,b){a=bc&&a.markedSpans;if(a)for(var c,d=0;d<a.length;++d)if(c=a[d],c.marker.collapsed&&null==(b?c.from:c.to)&&(!e||0>Se(e,c.marker)))var e=c.marker;return e}function Dc(a,b,c,d,e){a=na(a,b);if(a=bc&&a.markedSpans)for(b=0;b<a.length;++b){var f=a[b];if(f.marker.collapsed){var g=f.marker.find(0),l=Aa(g.from,c)||(f.marker.inclusiveLeft?-1:0)-(e.inclusiveLeft?-1:0),m=Aa(g.to,
d)||(f.marker.inclusiveRight?1:0)-(e.inclusiveRight?1:0);if(!(0<=l&&0>=m||0>=l&&0<=m)&&(0>=l&&(0<Aa(g.to,c)||f.marker.inclusiveRight&&e.inclusiveLeft)||0<=l&&(0>Aa(g.from,d)||f.marker.inclusiveLeft&&e.inclusiveRight)))return!0}}}function Ib(a){for(var b;b=lc(a,!0);)a=b.find(-1,!0).line;return a}function ae(a,b){a=na(a,b);var c=Ib(a);return a==c?b:Va(c)}function Te(a,b){if(b>a.lastLine())return b;var c=na(a,b);if(!ic(a,c))return b;for(;a=lc(c,!1);)c=a.find(1,!0).line;return Va(c)+1}function ic(a,b){var c=
bc&&b.markedSpans;if(c)for(var d,e=0;e<c.length;++e)if(d=c[e],d.marker.collapsed&&(null==d.from||!d.marker.widgetNode&&0==d.from&&d.marker.inclusiveLeft&&be(a,b,d)))return!0}function be(a,b,c){if(null==c.to)return b=c.marker.find(1,!0),be(a,b.line,Pc(b.line.markedSpans,c.marker));if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var d,e=0;e<b.markedSpans.length;++e)if(d=b.markedSpans[e],d.marker.collapsed&&!d.marker.widgetNode&&d.from==c.to&&(null==d.to||d.to!=c.from)&&(d.marker.inclusiveLeft||
c.marker.inclusiveRight)&&be(a,b,d))return!0}function Rc(a){if(null!=a.height)return a.height;a:{var b=document.body;var c=a.node;if(b.contains)b=b.contains(c);else{for(;c=c.parentNode;)if(c==b){b=!0;break a}b=void 0}}b||(b="position: relative;",a.coverGutter&&(b+="margin-left: -"+a.cm.getGutterElement().offsetWidth+"px;"),Ab(a.cm.display.measure,ja("div",[a.node],null,b)));return a.height=a.node.offsetHeight}function vf(a,b,c,d){var e=new Rd(a,c,d);e.noHScroll&&(a.display.alignWidgets=!0);pd(a.doc,
b,"widget",function(b){var c=b.widgets||(b.widgets=[]);null==e.insertAt?c.push(e):c.splice(Math.min(c.length-1,Math.max(0,e.insertAt)),0,e);e.line=b;ic(a.doc,b)||(c=Kb(b)<a.doc.scrollTop,Jb(b,b.height+Rc(e)),c&&$b(a,null,e.height),a.curOp.forceUpdate=!0);return!0});return e}function Ue(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:(new RegExp("(?:^|s)"+c[2]+"(?:$|s)")).test(b[d])||
(b[d]+=" "+c[2])}return a}function Ve(b,c){if(b.blankLine)return b.blankLine(c);if(b.innerMode&&(b=a.innerMode(b,c),b.mode.blankLine))return b.mode.blankLine(b.state)}function Yd(a,b,c){for(var d=0;10>d;d++){var e=a.token(b,c);if(b.pos>b.start)return e}throw Error("Mode "+a.name+" failed to advance stream.");}function Je(b,c,d,e,f,g,l){var m=d.flattenSpans;null==m&&(m=b.options.flattenSpans);var n=0,p=null,q=new Sd(c,b.options.tabSize);for(""==c&&Ue(Ve(d,e),g);!q.eol();){if(q.pos>b.options.maxHighlightLength){m=
!1;l&&Zd(b,c,e,q.pos);q.pos=c.length;var F=null}else F=Ue(Yd(d,q,e),g);if(b.options.addModeClass){var t=a.innerMode(d,e).mode.name;t&&(F="m-"+(F?t+" "+F:t))}m&&p==F||(n<q.start&&f(q.start,p),n=q.start,p=F);q.start=q.pos}for(;n<q.pos;)b=Math.min(q.pos,n+5E4),f(b,p),n=b}function Fe(a,b,c,d){var e=[a.state.modeGen],f={};Je(a,b.text,a.doc.mode,c,function(a,b){e.push(a,b)},f,d);for(c=0;c<a.state.overlays.length;++c){var g=a.state.overlays[c],l=1,m=0;Je(a,b.text,g.mode,!0,function(a,b){for(var c=l;m<a;){var d=
e[l];d>a&&e.splice(l,1,a,e[l+1],d);l+=2;m=Math.min(a,d)}if(b)if(g.opaque)e.splice(c,l-c,a,"cm-overlay "+b),l=c+2;else for(;c<l;c+=2)a=e[c+1],e[c+1]=(a?a+" ":"")+"cm-overlay "+b},f)}return{styles:e,classes:f.bgClass||f.textClass?f:null}}function Ne(a,b){b.styles&&b.styles[0]==a.state.modeGen||(a=Fe(a,b,b.stateAfter=La(a,Va(b))),b.styles=a.styles,a.classes?b.styleClasses=a.classes:b.styleClasses&&(b.styleClasses=null));return b.styles}function Zd(a,b,c,d){var e=a.doc.mode,f=new Sd(b,a.options.tabSize);
f.start=f.pos=d||0;for(""==b&&Ve(e,c);!f.eol()&&f.pos<=a.options.maxHighlightLength;)Yd(e,f,c),f.start=f.pos}function We(a,b){if(!a||/^\s*$/.test(a))return null;b=b.addModeClass?Qf:Rf;return b[a]||(b[a]=a.replace(/\S+/g,"cm-$&"))}function Xe(a,b){var c=ja("span",null,null,hb?"padding-right: .1px":null);c={pre:ja("pre",[c]),content:c,col:0,pos:0,cm:a};b.measure={};for(var d=0;d<=(b.rest?b.rest.length:0);d++){var e=d?b.rest[d-1]:b.line,f;c.pos=0;c.addToken=uf;(Fa||hb)&&a.getOption("lineWrapping")&&
(c.addToken=zf(c.addToken));if(null!=xe)var g=xe;else{g=Ab(a.display.measure,document.createTextNode("A\u062eA"));var l=ed(g,0,1).getBoundingClientRect();g=l.left==l.right?!1:xe=3>ed(g,1,2).getBoundingClientRect().right-l.right}g&&(f=Lb(e))&&(c.addToken=Af(c.addToken,f));c.map=[];a:{var m=l=g=void 0,n=void 0,p=void 0,q=void 0,F=c,t=Ne(a,e),w=e.markedSpans,T=e.text,K=0;if(w){var x=T.length,y=0;E=1;for(var A="",u=0;;){if(u==y){p=n=m=l="";g=null;u=Infinity;for(var z=[],B=0;B<w.length;++B){var D=w[B],
H=D.marker;D.from<=y&&(null==D.to||D.to>y)?(null!=D.to&&u>D.to&&(u=D.to,n=""),H.className&&(p+=" "+H.className),H.startStyle&&D.from==y&&(m+=" "+H.startStyle),H.endStyle&&D.to==u&&(n+=" "+H.endStyle),H.title&&!l&&(l=H.title),H.collapsed&&(!g||0>Se(g.marker,H))&&(g=D)):D.from>y&&u>D.from&&(u=D.from);"bookmark"==H.type&&D.from==y&&H.widgetNode&&z.push(H)}if(g&&(g.from||0)==y&&(wd(F,(null==g.to?x+1:g.to)-y,g.marker,null==g.from),null==g.to))break a;if(!g&&z.length)for(B=0;B<z.length;++B)wd(F,0,z[B])}if(y>=
x)break;for(z=Math.min(x,u);;){if(A){B=y+A.length;g||(D=B>z?A.slice(0,z-y):A,F.addToken(F,D,q?q+p:p,m,y+D.length==u?n:"",l));if(B>=z){A=A.slice(z-y);y=z;break}y=B;m=""}A=T.slice(K,K=t[E++]);q=We(t[E++],F.cm.options)}}}else for(var E=1;E<t.length;E+=2)F.addToken(F,T.slice(K,K=t[E]),We(t[E+1],F.cm.options))}e.styleClasses&&(e.styleClasses.bgClass&&(c.bgClass=ye(e.styleClasses.bgClass,c.bgClass||"")),e.styleClasses.textClass&&(c.textClass=ye(e.styleClasses.textClass,c.textClass||"")));0==c.map.length&&
c.map.push(0,0,c.content.appendChild(Sf(a.display.measure)));0==d?(b.measure.map=c.map,b.measure.cache={}):((b.measure.maps||(b.measure.maps=[])).push(c.map),(b.measure.caches||(b.measure.caches=[])).push({}))}db(a,"renderLine",a,b.line,c.pre);c.pre.className&&(c.textClass=ye(c.pre.className,c.textClass||""));return c}function uf(a,b,c,d,e,f){if(b){var g=a.cm.options.specialChars,l=!1;if(g.test(b)){F=document.createDocumentFragment();for(var m=0;;){g.lastIndex=m;var n=g.exec(b),p=n?n.index-m:b.length-
m;if(p){var q=document.createTextNode(b.slice(m,m+p));Fa&&9>Pa?F.appendChild(ja("span",[q])):F.appendChild(q);a.map.push(a.pos,a.pos+p,q);a.col+=p;a.pos+=p}if(!n)break;m+=p+1;"\t"==n[0]?(q=a.cm.options.tabSize,n=q-a.col%q,q=F.appendChild(ja("span",De(n),"cm-tab")),a.col+=n):(q=a.cm.options.specialCharPlaceholder(n[0]),Fa&&9>Pa?F.appendChild(ja("span",[q])):F.appendChild(q),a.col+=1);a.map.push(a.pos,a.pos+1,q);a.pos++}}else{a.col+=b.length;var F=document.createTextNode(b);a.map.push(a.pos,a.pos+b.length,
F);Fa&&9>Pa&&(l=!0);a.pos+=b.length}if(c||d||e||l)return b=c||"",d&&(b+=d),e&&(b+=e),d=ja("span",[F],b),f&&(d.title=f),a.content.appendChild(d);a.content.appendChild(F)}}function zf(a){function b(a){for(var b=" ",c=0;c<a.length-2;++c)b+=c%2?" ":"\u00a0";return b+" "}return function(c,d,e,f,g,l){a(c,d.replace(/ {3,}/g,b),e,f,g,l)}}function Af(a,b){return function(c,d,e,f,g,l){e=e?e+" cm-force-border":"cm-force-border";for(var m=c.pos,n=m+d.length;;){for(var p=0;p<b.length;p++){var q=b[p];if(q.to>m&&
q.from<=m)break}if(q.to>=n)return a(c,d,e,f,g,l);a(c,d.slice(0,q.to-m),e,f,null,l);f=null;d=d.slice(q.to-m);m=q.to}}}function wd(a,b,c,d){if(c=!d&&c.widgetNode)a.map.push(a.pos,a.pos+b,c),a.content.appendChild(c);a.pos+=b}function Re(a,b){return 0==b.from.ch&&0==b.to.ch&&""==Oa(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function ce(a,b,c,d){function e(a,c,e){a.text=c;a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null);null!=a.order&&(a.order=null);Vc(a);Qe(a,e);c=d?d(a):1;c!=a.height&&
Jb(a,c);bb(a,"change",a,b)}var f=b.from,g=b.to,l=b.text,m=na(a,f.line),n=na(a,g.line),p=Oa(l),q=c?c[l.length-1]:null,F=g.line-f.line;if(Re(a,b)){for(var t=0,w=[];t<l.length-1;++t)w.push(new uc(l[t],c?c[t]:null,d));e(n,n.text,q);F&&a.remove(f.line,F);w.length&&a.insert(f.line,w)}else if(m==n)if(1==l.length)e(m,m.text.slice(0,f.ch)+p+m.text.slice(g.ch),q);else{w=[];for(t=1;t<l.length-1;++t)w.push(new uc(l[t],c?c[t]:null,d));w.push(new uc(p+m.text.slice(g.ch),q,d));e(m,m.text.slice(0,f.ch)+l[0],c?c[0]:
null);a.insert(f.line+1,w)}else if(1==l.length)e(m,m.text.slice(0,f.ch)+l[0]+n.text.slice(g.ch),c?c[0]:null),a.remove(f.line+1,F);else{e(m,m.text.slice(0,f.ch)+l[0],c?c[0]:null);e(n,p+n.text.slice(g.ch),q);t=1;for(w=[];t<l.length-1;++t)w.push(new uc(l[t],c?c[t]:null,d));1<F&&a.remove(f.line+1,F-1);a.insert(f.line+1,w)}bb(a,"change",a,b)}function Sc(a){this.lines=a;this.parent=null;for(var b=0,c=0;b<a.length;++b)a[b].parent=this,c+=a[b].height;this.height=c}function Wc(a){this.children=a;for(var b=
0,c=0,d=0;d<a.length;++d){var e=a[d];b+=e.chunkSize();c+=e.height;e.parent=this}this.size=b;this.height=c;this.parent=null}function kc(a,b,c){function d(a,e,f){if(a.linked)for(var g=0;g<a.linked.length;++g){var l=a.linked[g];if(l.doc!=e){var m=f&&l.sharedHist;if(!c||m)b(l.doc,m),d(l.doc,a,m)}}}d(a,null,!0)}function Ye(a,b){if(b.cm)throw Error("This document is already in use.");a.doc=b;b.cm=a;g(a);d(a);a.options.lineWrapping||t(a);a.options.mode=b.modeOption;Ia(a)}function na(a,b){b-=a.first;if(0>
b||b>=a.size)throw Error("There is no line "+(b+a.first)+" in the document.");for(;!a.lines;)for(var c=0;;++c){var d=a.children[c],e=d.chunkSize();if(b<e){a=d;break}b-=e}return a.lines[b]}function Xc(a,b,c){var d=[],e=b.line;a.iter(b.line,c.line+1,function(a){a=a.text;e==c.line&&(a=a.slice(0,c.ch));e==b.line&&(a=a.slice(b.ch));d.push(a);++e});return d}function de(a,b,c){var d=[];a.iter(b,c,function(a){d.push(a.text)});return d}function Jb(a,b){if(b-=a.height)for(;a;a=a.parent)a.height+=b}function Va(a){if(null==
a.parent)return null;var b=a.parent;a=fb(b.lines,a);for(var c=b.parent;c;b=c,c=c.parent)for(var d=0;c.children[d]!=b;++d)a+=c.children[d].chunkSize();return a+b.first}function mc(a,b){var c=a.first;a:do{for(var d=0;d<a.children.length;++d){var e=a.children[d],f=e.height;if(b<f){a=e;continue a}b-=f;c+=e.chunkSize()}return c}while(!a.lines);for(d=0;d<a.lines.length;++d){e=a.lines[d].height;if(b<e)break;b-=e}return c+d}function Kb(a){a=Ib(a);for(var b=0,c=a.parent,d=0;d<c.lines.length;++d){var e=c.lines[d];
if(e==a)break;else b+=e.height}for(a=c.parent;a;c=a,a=c.parent)for(d=0;d<a.children.length&&(e=a.children[d],e!=c);++d)b+=e.height;return b}function Lb(a){var b=a.order;null==b&&(b=a.order=Tf(a.text));return b}function xd(a){this.done=[];this.undone=[];this.undoDepth=Infinity;this.lastModTime=this.lastSelTime=0;this.lastOrigin=this.lastSelOrigin=this.lastOp=this.lastSelOp=null;this.generation=this.maxGeneration=a||1}function ee(a,b){var c={from:X(b.from),to:dc(b),text:Xc(a,b.from,b.to)};Ze(a,c,b.from.line,
b.to.line+1);kc(a,function(a){Ze(a,c,b.from.line,b.to.line+1)},!0);return c}function He(a){for(;a.length;)if(Oa(a).ranges)a.pop();else break}function Ke(a,b,c,d){var e=a.history;e.undone.length=0;var f=+new Date,g;if(g=e.lastOp==d||e.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&e.lastModTime>f-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0))){if(e.lastOp==d){He(e.done);var l=Oa(e.done)}else e.done.length&&!Oa(e.done).ranges?l=Oa(e.done):1<e.done.length&&!e.done[e.done.length-
2].ranges?(e.done.pop(),l=Oa(e.done)):l=void 0;g=l}if(g){var m=Oa(l.changes);0==Aa(b.from,b.to)&&0==Aa(b.from,m.to)?m.to=dc(b):l.changes.push(ee(a,b))}else for((l=Oa(e.done))&&l.ranges||yd(a.sel,e.done),l={changes:[ee(a,b)],generation:e.generation},e.done.push(l);e.done.length>e.undoDepth;)e.done.shift(),e.done[0].ranges||e.done.shift();e.done.push(c);e.generation=++e.maxGeneration;e.lastModTime=e.lastSelTime=f;e.lastOp=e.lastSelOp=d;e.lastOrigin=e.lastSelOrigin=b.origin;m||db(a,"historyAdded")}function yd(a,
b){var c=Oa(b);c&&c.ranges&&c.equals(a)||b.push(a)}function Ze(a,b,c,d){var e=b["spans_"+a.id],f=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((e||(e=b["spans_"+a.id]={}))[f]=c.markedSpans);++f})}function wf(a){if(!a)return null;for(var b=0,c;b<a.length;++b)a[b].marker.explicitlyCleared?c||(c=a.slice(0,b)):c&&c.push(a[b]);return c?c.length?c:null:a}function Cc(a,b,c){for(var d=0,e=[];d<a.length;++d){var f=a[d];if(f.ranges)e.push(c?ma.prototype.deepCopy.call(f):
f);else{f=f.changes;var g=[];e.push({changes:g});for(var l=0;l<f.length;++l){var m=f[l],n;g.push({from:m.from,to:m.to,text:m.text});if(b)for(var p in m)(n=p.match(/^spans_(\d+)$/))&&-1<fb(b,Number(n[1]))&&(Oa(g)[p]=m[p],delete m[p])}}}return e}function $e(a,b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function Le(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e],g=!0;if(f.ranges){f.copied||(f=a[e]=f.deepCopy(),f.copied=!0);for(var l=0;l<f.ranges.length;l++)$e(f.ranges[l].anchor,b,c,d),$e(f.ranges[l].head,
b,c,d)}else{for(l=0;l<f.changes.length;++l){var m=f.changes[l];if(c<m.from.line)m.from=U(m.from.line+d,m.from.ch),m.to=U(m.to.line+d,m.to.ch);else if(b<=m.to.line){g=!1;break}}g||(a.splice(0,e+1),e=0)}}}function Ie(a,b){var c=b.from.line,d=b.to.line;b=b.text.length-(d-c)-1;Le(a.done,c,d,b);Le(a.undone,c,d,b)}function fe(a){return null!=a.defaultPrevented?a.defaultPrevented:0==a.returnValue}function Ge(a){var b=a.which;null==b&&(a.button&1?b=1:a.button&2?b=3:a.button&4&&(b=2));Db&&a.ctrlKey&&1==b&&
(b=3);return b}function bb(a,b){function c(a){return function(){a.apply(null,e)}}var d=a._handlers&&a._handlers[b];if(d){var e=Array.prototype.slice.call(arguments,2);if(Mc)var f=Mc.delayedCallbacks;else jd?f=jd:(f=jd=[],setTimeout(xf,0));for(var g=0;g<d.length;++g)f.push(c(d[g]))}}function xf(){var a=jd;jd=null;for(var b=0;b<a.length;++b)a[b]()}function Hb(a,b,c){db(a,c||b.type,a,b);return fe(b)||b.codemirrorIgnore}function Xd(a){var b=a._handlers&&a._handlers.cursorActivity;if(b){a=a.curOp.cursorActivityHandlers||
(a.curOp.cursorActivityHandlers=[]);for(var c=0;c<b.length;++c)-1==fb(a,b[c])&&a.push(b[c])}}function yb(a,b){return(a=a._handlers&&a._handlers[b])&&0<a.length}function hc(a){a.prototype.on=function(a,b){xa(this,a,b)};a.prototype.off=function(a,b){Rb(this,a,b)}}function td(){this.id=null}function Ce(a,b,c){for(var d=0,e=0;;){var f=a.indexOf("\t",d);-1==f&&(f=a.length);var g=f-d;if(f==a.length||e+g>=b)return d+Math.min(g,b-e);e+=f-d;e+=c-e%c;d=f+1;if(e>=b)return d}}function De(a){for(;Td.length<=a;)Td.push(Oa(Td)+
" ");return Td[a]}function Oa(a){return a[a.length-1]}function fb(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return c;return-1}function Qc(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=b(a[d],d);return c}function Ee(a,b){if(Object.create)a=Object.create(a);else{var c=function(){};c.prototype=a;a=new c}b&&Tc(b,a);return a}function Tc(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||!1===c&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}function zb(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,
b)}}function ud(a,b){return b?-1<b.source.indexOf("\\w")&&kf(a)?!0:b.test(a):kf(a)}function Me(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function Uc(a){return 768<=a.charCodeAt(0)&&Uf.test(a)}function ja(a,b,c,d){a=document.createElement(a);c&&(a.className=c);d&&(a.style.cssText=d);if("string"==typeof b)a.appendChild(document.createTextNode(b));else if(b)for(c=0;c<b.length;++c)a.appendChild(b[c]);return a}function jc(a){for(var b=a.childNodes.length;0<b;--b)a.removeChild(a.firstChild);
return a}function Ab(a,b){return jc(a).appendChild(b)}function Wb(){return document.activeElement}function $d(a){return new RegExp("\\b"+a+"\\b\\s*")}function vd(a,b){b=$d(b);b.test(a.className)&&(a.className=a.className.replace(b,""))}function Pd(a,b){$d(b).test(a.className)||(a.className+=" "+b)}function ye(a,b){a=a.split(" ");for(var c=0;c<a.length;c++)a[c]&&!$d(a[c]).test(b)&&(b+=" "+a[c]);return b}function lf(a){if(document.body.getElementsByClassName)for(var b=document.body.getElementsByClassName("CodeMirror"),
c=0;c<b.length;c++){var d=b[c].CodeMirror;d&&a(d)}}function Cf(){var a;xa(window,"resize",function(){null==a&&(a=setTimeout(function(){kd=a=null;lf(ge)},100))});xa(window,"blur",function(){lf(Jc)})}function Df(a){if(null!=kd)return kd;var b=ja("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");Ab(a,b);b.offsetWidth&&(kd=b.offsetHeight-b.clientHeight);return kd||0}function Sf(a){if(null==ze){var b=ja("span","\u200b");Ab(a,ja("span",[b,document.createTextNode("x")]));0!=a.firstChild.offsetHeight&&
(ze=1>=b.offsetWidth&&2<b.offsetHeight&&!(Fa&&8>Pa))}return ze?ja("span","\u200b"):ja("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px")}function Hf(a,b,c,d){if(!a)return d(b,c,"ltr");for(var e=!1,f=0;f<a.length;++f){var g=a[f];if(g.from<c&&g.to>b||b==c&&g.to==b)d(Math.max(g.from,b),Math.min(g.to,c),1==g.level?"rtl":"ltr"),e=!0}e||d(b,c,"ltr")}function pe(a){return a.level%2?a.to:a.from}function qe(a){return a.level%2?a.from:a.to}function Id(a){return(a=Lb(a))?pe(a[0]):
0}function Jd(a){var b=Lb(a);return b?qe(Oa(b)):a.text.length}function mf(a,b){var c=na(a.doc,b);a=Ib(c);a!=c&&(b=Va(a));a=(c=Lb(a))?c[0].level%2?Jd(a):Id(a):0;return U(b,a)}function nf(a,b){var c=mf(a,b.line);a=na(a.doc,c.line);var d=Lb(a);return d&&0!=d[0].level?c:(a=Math.max(0,a.text.search(/\S/)),U(c.line,b.line==c.line&&b.ch<=a&&b.ch?0:a))}function re(a,b){fd=null;for(var c=0,d;c<a.length;++c){var e=a[c];if(e.from<b&&e.to>b)return c;if(e.from==b||e.to==b)if(null==d)d=c;else{b=e.level;var f=a[d].level;
a=a[0].level;a=b==a?!0:f==a?!1:b<f;if(a)return e.from!=e.to&&(fd=d),c;e.from!=e.to&&(fd=c);break}}return d}function Ae(a,b,c,d){if(!d)return b+c;do b+=c;while(0<b&&Uc(a.text.charAt(b)));return b}function se(a,b,c,d){var e=Lb(a);if(!e)return jf(a,b,c,d);var f=re(e,b),g=e[f];for(b=Ae(a,b,g.level%2?-c:c,d);;){if(b>g.from&&b<g.to)return b;if(b==g.from||b==g.to){if(re(e,b)==f)return b;g=e[f+c];return 0<c==g.level%2?g.to:g.from}g=e[f+=c];if(!g)return null;b=0<c==g.level%2?Ae(a,g.to,-1,d):Ae(a,g.from,1,
d)}}function jf(a,b,c,d){b+=c;if(d)for(;0<b&&Uc(a.text.charAt(b));)b+=c;return 0>b||b>a.text.length?null:b}var hd=/gecko\/\d/i.test(navigator.userAgent),of=/MSIE \d/.test(navigator.userAgent),pf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Fa=of||pf,Pa=Fa&&(of?document.documentMode||6:pf[1]),hb=/WebKit\//.test(navigator.userAgent),Vf=hb&&/Qt\/\d+\.\d+/.test(navigator.userAgent),Wf=/Chrome\//.test(navigator.userAgent),Fb=/Opera\//.test(navigator.userAgent),ef=/Apple Computer/.test(navigator.vendor),
me=/KHTML\//.test(navigator.userAgent),Ef=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Kf=/PhantomJS/.test(navigator.userAgent),cd=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),ke=cd||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),Db=cd||/Mac/.test(navigator.platform),Xf=/win/i.test(navigator.platform),vc=Fb&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);vc&&(vc=Number(vc[1]));vc&&15<=vc&&(Fb=!1,hb=!0);var qf=
Db&&(Vf||Fb&&(null==vc||12.11>vc)),ue=hd||Fa&&9<=Pa,hf=!1,bc=!1,U=a.Pos=function(a,b){if(!(this instanceof U))return new U(a,b);this.line=a;this.ch=b},Aa=a.cmpPos=function(a,b){return a.line-b.line||a.ch-b.ch};ma.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=a.ranges[b];if(0!=Aa(c.anchor,d.anchor)||0!=Aa(c.head,
d.head))return!1}return!0},deepCopy:function(){for(var a=[],b=0;b<this.ranges.length;b++)a[b]=new Q(X(this.ranges[b].anchor),X(this.ranges[b].head));return new ma(a,this.primIndex)},somethingSelected:function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1},contains:function(a,b){b||(b=a);for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c];if(0<=Aa(b,d.from())&&0>=Aa(a,d.to()))return c}return-1}};Q.prototype={from:function(){return sa(this.anchor,this.head)},
to:function(){return I(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var ne={left:0,right:0,top:0,bottom:0},qc,Mc=null,Jf=0,sc=null,Ld,Kd,df=0,Md=0,Gb=null;Fa?Gb=-.53:hd?Gb=15:Wf?Gb=-.7:ef&&(Gb=-1/3);var gf,we=null,dc=a.changeEnd=function(a){return a.text?U(a.from.line+a.text.length-1,Oa(a.text).length+(1==a.text.length?a.from.ch:0)):a.to};a.prototype={constructor:a,focus:function(){window.focus();lb(this);nc(this)},setOption:function(a,
b){var c=this.options,d=c[a];if(c[a]!=b||"mode"==a)c[a]=b,Lc.hasOwnProperty(a)&&Ra(this,Lc[a])(this,b,d)},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](a)},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||"string"!=typeof b[c]&&b[c].name==a)return b.splice(c,1),!0},addOverlay:Na(function(b,c){var d=b.token?b:a.getMode(this.options,b);if(d.startState)throw Error("Overlays may not be stateful.");
this.state.overlays.push({mode:d,modeSpec:b,opaque:c&&c.opaque});this.state.modeGen++;Ia(this)}),removeOverlay:Na(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;if(d==a||"string"==typeof a&&d.name==a){b.splice(c,1);this.state.modeGen++;Ia(this);break}}}),indentLine:Na(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract");W(this.doc,a)&&pb(this,a,b,c)}),indentSelection:Na(function(a){for(var b=
this.doc.sel.ranges,c=-1,d=0;d<b.length;d++){var e=b[d];if(e.empty())e.head.line>c&&(pb(this,e.head.line,a,!0),c=e.head.line,d==this.doc.sel.primIndex&&ac(this));else{var f=e.from();e=e.to();var g=Math.max(c,f.line);c=Math.min(this.lastLine(),e.line-(e.ch?0:1))+1;for(e=g;e<c;++e)pb(this,e,a);e=this.doc.sel.ranges;0==f.ch&&b.length==e.length&&0<e[d].from().ch&&Ja(this.doc,d,new Q(f,e[d].to()),cc)}}}),getTokenAt:function(a,b){var c=this.doc;a=C(c,a);b=La(this,a.line,b);var d=this.doc.mode;c=na(c,a.line);
for(c=new Sd(c.text,this.options.tabSize);c.pos<a.ch&&!c.eol();){c.start=c.pos;var e=Yd(d,c,b)}return{start:c.start,end:c.pos,string:c.current(),type:e||null,state:b}},getTokenTypeAt:function(a){a=C(this.doc,a);var b=Ne(this,na(this.doc,a.line)),c=0,d=(b.length-1)/2;a=a.ch;if(0==a)b=b[2];else for(;;){var e=c+d>>1;if((e?b[2*e-1]:0)>=a)d=e;else if(b[2*e+1]<a)c=e+1;else{b=b[2*e+2];break}}c=b?b.indexOf("cm-overlay "):-1;return 0>c?b:0==c?null:b.slice(0,c-1)},getModeAt:function(b){var c=this.doc.mode;
return c.innerMode?a.innerMode(c,this.getTokenAt(b).state).mode:c},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var c=[];if(!wc.hasOwnProperty(b))return wc;var d=wc[b];a=this.getModeAt(a);if("string"==typeof a[b])d[a[b]]&&c.push(d[a[b]]);else if(a[b])for(var e=0;e<a[b].length;e++){var f=d[a[b][e]];f&&c.push(f)}else a.helperType&&d[a.helperType]?c.push(d[a.helperType]):d[a.name]&&c.push(d[a.name]);for(e=0;e<d._global.length;e++)b=d._global[e],b.pred(a,this)&&-1==
fb(c,b.val)&&c.push(b.val);return c},getStateAfter:function(a,b){var c=this.doc;a=Math.max(c.first,Math.min(null==a?c.first+c.size-1:a,c.first+c.size-1));return La(this,a+1,b)},cursorCoords:function(a,b){var c=this.doc.sel.primary();a=null==a?c.head:"object"==typeof a?C(this.doc,a):a?c.from():c.to();return ba(this,a,b||"page")},charCoords:function(a,b){return ub(this,C(this.doc,a),b||"page")},coordsChar:function(a,b){a=aa(this,a,b||"page");return Qa(this,a.left,a.top)},lineAtHeight:function(a,b){a=
aa(this,{top:a,left:0},b||"page").top;return mc(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b){var c=!1,d=this.doc.first+this.doc.size-1;a<this.doc.first?a=this.doc.first:a>d&&(a=d,c=!0);a=na(this.doc,a);return Wa(this,a,{top:0,left:0},b||"page").top+(c?this.doc.height-Kb(a):0)},defaultTextHeight:function(){return ib(this.display)},defaultCharWidth:function(){return sb(this.display)},setGutterMarker:Na(function(a,b,c){return pd(this.doc,a,"gutter",function(a){var d=a.gutterMarkers||
(a.gutterMarkers={});d[b]=c;!c&&Me(d)&&(a.gutterMarkers=null);return!0})}),clearGutter:Na(function(a){var b=this,c=b.doc,d=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,Xa(b,d,"gutter"),Me(c.gutterMarkers)&&(c.gutterMarkers=null));++d})}),addLineWidget:Na(function(a,b,c){return vf(this,a,b,c)}),removeLineWidget:function(a){a.clear()},lineInfo:function(a){if("number"==typeof a){if(!W(this.doc,a))return null;var b=a;a=na(this.doc,a);if(!a)return null}else if(b=
Va(a),null==b)return null;return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,d,e){var f=this.display;a=ba(this,C(this.doc,a));var g=a.bottom,l=a.left;b.style.position="absolute";f.sizer.appendChild(b);if("over"==d)g=a.top;else if("above"==d||"near"==d){var m=Math.max(f.wrapper.clientHeight,this.doc.height),
n=Math.max(f.sizer.clientWidth,f.lineSpace.clientWidth);("above"==d||a.bottom+b.offsetHeight>m)&&a.top>b.offsetHeight?g=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=m&&(g=a.bottom);l+b.offsetWidth>n&&(l=n-b.offsetWidth)}b.style.top=g+"px";b.style.left=b.style.right="";"right"==e?(l=f.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==e?l=0:"middle"==e&&(l=(f.sizer.clientWidth-b.offsetWidth)/2),b.style.left=l+"px");c&&(a=pc(this,l,g,l+b.offsetWidth,g+b.offsetHeight),null!=a.scrollTop&&
oc(this,a.scrollTop),null!=a.scrollLeft&&xb(this,a.scrollLeft))},triggerOnKeyDown:Na(Yb),triggerOnKeyPress:Na(sd),triggerOnKeyUp:Hc,execCommand:function(a){if(Nd.hasOwnProperty(a))return Nd[a](this)},findPosH:function(a,b,c,d){var e=1;0>b&&(e=-1,b=-b);var f=0;for(a=C(this.doc,a);f<b&&(a=Ud(this.doc,a,e,c,d),!a.hitSide);++f);return a},moveH:Na(function(a,b){var c=this;c.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?Ud(c.doc,d.head,a,b,c.options.rtlMoveVisually):0>a?
d.from():d.to()},ld)}),deleteH:Na(function(a,b){var c=this.doc;this.doc.sel.somethingSelected()?c.replaceSelection("",null,"+delete"):fc(this,function(d){var e=Ud(c,d.head,a,b,!1);return 0>a?{from:e,to:d.head}:{from:d.head,to:e}})}),findPosV:function(a,b,c,d){var e=1;0>b&&(e=-1,b=-b);var f=0;for(a=C(this.doc,a);f<b&&(a=ba(this,a,"div"),null==d?d=a.left:a.left=d,a=Vd(this,a,e,c),!a.hitSide);++f);return a},moveV:Na(function(a,b){var c=this,d=this.doc,e=[],f=!c.display.shift&&!d.extend&&d.sel.somethingSelected();
d.extendSelectionsBy(function(g){if(f)return 0>a?g.from():g.to();var l=ba(c,g.head,"div");null!=g.goalColumn&&(l.left=g.goalColumn);e.push(l.left);var m=Vd(c,l,a,b);"page"==b&&g==d.sel.primary()&&$b(c,null,ub(c,m,"div").top-l.top);return m},ld);if(e.length)for(var g=0;g<d.sel.ranges.length;g++)d.sel.ranges[g].goalColumn=e[g]}),toggleOverwrite:function(a){if(null==a||a!=this.state.overwrite)(this.state.overwrite=!this.state.overwrite)?Pd(this.display.cursorDiv,"CodeMirror-overwrite"):vd(this.display.cursorDiv,
"CodeMirror-overwrite"),db(this,"overwriteToggle",this,this.state.overwrite)},hasFocus:function(){return Wb()==this.display.input},scrollTo:Na(function(a,b){null==a&&null==b||Kc(this);null!=a&&(this.curOp.scrollLeft=a);null!=b&&(this.curOp.scrollTop=b)}),getScrollInfo:function(){var a=this.display.scroller,b=Cb;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-b,width:a.scrollWidth-b,clientHeight:a.clientHeight-b,clientWidth:a.clientWidth-b}},scrollIntoView:Na(function(a,b){null==a?(a=
{from:this.doc.sel.primary().head,to:null},null==b&&(b=this.options.cursorScrollMargin)):"number"==typeof a?a={from:U(a,0),to:null}:null==a.from&&(a={from:a,to:null});a.to||(a.to=a.from);a.margin=b||0;null!=a.from.line?(Kc(this),this.curOp.scrollToPos=a):(a=pc(this,Math.min(a.from.left,a.to.left),Math.min(a.from.top,a.to.top)-a.margin,Math.max(a.from.right,a.to.right),Math.max(a.from.bottom,a.to.bottom)+a.margin),this.scrollTo(a.scrollLeft,a.scrollTop))}),setSize:Na(function(a,b){function c(a){return"number"==
typeof a||/^\d+$/.test(String(a))?a+"px":a}var d=this;null!=a&&(d.display.wrapper.style.width=c(a));null!=b&&(d.display.wrapper.style.height=c(b));d.options.lineWrapping&&gb(this);var e=d.display.viewFrom;d.doc.iter(e,d.display.viewTo,function(a){if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].noHScroll){Xa(d,e,"widget");break}++e});d.curOp.forceUpdate=!0;db(d,"refresh",this)}),operation:function(a){return Ta(this,a)},refresh:Na(function(){var a=this.display.cachedTextHeight;Ia(this);
this.curOp.forceUpdate=!0;Ha(this);this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop);e(this);(null==a||.5<Math.abs(a-ib(this.display)))&&g(this);db(this,"refresh",this)}),swapDoc:Na(function(a){var b=this.doc;b.cm=null;Ye(this,a);Ha(this);wb(this);this.scrollTo(a.scrollLeft,a.scrollTop);bb(this,"swapDoc",this,b);return b}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};
hc(a);var Bf=a.defaults={},Lc=a.optionHandlers={},bf=a.Init={toString:function(){return"CodeMirror.Init"}};ta("value","",function(a,b){a.setValue(b)},!0);ta("mode",null,function(a,b){a.doc.modeOption=b;d(a)},!0);ta("indentUnit",2,d,!0);ta("indentWithTabs",!1);ta("smartIndent",!0);ta("tabSize",4,function(a){c(a);Ha(a);Ia(a)},!0);ta("specialChars",/[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g,function(a,b){a.options.specialChars=new RegExp(b.source+(b.test("\t")?"":"|\t"),"g");a.refresh()},
!0);ta("specialCharPlaceholder",function(a){var b=ja("span","\u2022","cm-invalidchar");b.title="\\u"+a.charCodeAt(0).toString(16);return b},function(a){a.refresh()},!0);ta("electricChars",!0);ta("rtlMoveVisually",!Xf);ta("wholeLineUpdateBefore",!0);ta("theme","default",function(a){l(a);n(a)},!0);ta("keyMap","default",m);ta("extraKeys",null);ta("lineWrapping",!1,function(a){a.options.lineWrapping?(Pd(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth=""):(vd(a.display.wrapper,"CodeMirror-wrap"),
t(a));g(a);Ia(a);Ha(a);setTimeout(function(){A(a)},100)},!0);ta("gutters",[],function(a){w(a.options);n(a)},!0);ta("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?G(a.display)+"px":"0";a.refresh()},!0);ta("coverGutterNextToScrollbar",!1,A,!0);ta("lineNumbers",!1,function(a){w(a.options);n(a)},!0);ta("firstLineNumber",1,n,!0);ta("lineNumberFormatter",function(a){return a},n,!0);ta("showCursorWhenSelecting",!1,u,!0);ta("resetSelectionOnContextMenu",!0);ta("readOnly",!1,function(a,b){"nocursor"==
b?(Jc(a),a.display.input.blur(),a.display.disabled=!0):(a.display.disabled=!1,b||wb(a))});ta("disableInput",!1,function(a,b){b||wb(a)},!0);ta("dragDrop",!0);ta("cursorBlinkRate",530);ta("cursorScrollMargin",0);ta("cursorHeight",1,u,!0);ta("singleCursorHeightPerLine",!0,u,!0);ta("workTime",100);ta("workDelay",100);ta("flattenSpans",!0,c,!0);ta("addModeClass",!1,c,!0);ta("pollInterval",100);ta("undoDepth",200,function(a,b){a.doc.history.undoDepth=b});ta("historyEventDelay",1250);ta("viewportMargin",
10,function(a){a.refresh()},!0);ta("maxHighlightLength",1E4,c,!0);ta("moveInputWithCursor",!0,function(a,b){b||(a.display.inputDiv.style.top=a.display.inputDiv.style.left=0)});ta("tabindex",null,function(a,b){a.display.input.tabIndex=b||""});ta("autofocus",null);var rf=a.modes={},md=a.mimeModes={};a.defineMode=function(b,c){a.defaults.mode||"null"==b||(a.defaults.mode=b);if(2<arguments.length){c.dependencies=[];for(var d=2;d<arguments.length;++d)c.dependencies.push(arguments[d])}rf[b]=c};a.defineMIME=
function(a,b){md[a]=b};a.resolveMode=function(b){if("string"==typeof b&&md.hasOwnProperty(b))b=md[b];else if(b&&"string"==typeof b.name&&md.hasOwnProperty(b.name)){var c=md[b.name];"string"==typeof c&&(c={name:c});b=Ee(c,b);b.name=c.name}else if("string"==typeof b&&/^[\w\-]+\/[\w\-]+\+xml$/.test(b))return a.resolveMode("application/xml");return"string"==typeof b?{name:b}:b||{name:"null"}};a.getMode=function(b,c){c=a.resolveMode(c);var d=rf[c.name];if(!d)return a.getMode(b,"text/plain");b=d(b,c);if(nd.hasOwnProperty(c.name)){d=
nd[c.name];for(var e in d)d.hasOwnProperty(e)&&(b.hasOwnProperty(e)&&(b["_"+e]=b[e]),b[e]=d[e])}b.name=c.name;c.helperType&&(b.helperType=c.helperType);if(c.modeProps)for(e in c.modeProps)b[e]=c.modeProps[e];return b};a.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}});a.defineMIME("text/plain","null");var nd=a.modeExtensions={};a.extendMode=function(a,b){a=nd.hasOwnProperty(a)?nd[a]:nd[a]={};Tc(b,a)};a.defineExtension=function(b,c){a.prototype[b]=c};a.defineDocExtension=function(a,
b){tb.prototype[a]=b};a.defineOption=ta;var le=[];a.defineInitHook=function(a){le.push(a)};var wc=a.helpers={};a.registerHelper=function(b,c,d){wc.hasOwnProperty(b)||(wc[b]=a[b]={_global:[]});wc[b][c]=d};a.registerGlobalHelper=function(b,c,d,e){a.registerHelper(b,c,e);wc[b]._global.push({pred:d,val:e})};var dd=a.copyState=function(a,b){if(!0===b)return b;if(a.copyState)return a.copyState(b);a={};for(var c in b){var d=b[c];d instanceof Array&&(d=d.concat([]));a[c]=d}return a},If=a.startState=function(a,
b,c){return a.startState?a.startState(b,c):!0};a.innerMode=function(a,b){for(;a.innerMode;){var c=a.innerMode(b);if(!c||c.mode==a)break;b=c.state;a=c.mode}return c||{mode:a,state:b}};var Nd=a.commands={selectAll:function(a){a.setSelection(U(a.firstLine(),0),U(a.lastLine()),cc)},singleSelection:function(a){a.setSelection(a.getCursor("anchor"),a.getCursor("head"),cc)},killLine:function(a){fc(a,function(b){if(b.empty()){var c=na(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?
{from:b.head,to:U(b.head.line+1,0)}:{from:b.head,to:U(b.head.line,c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){fc(a,function(b){return{from:U(b.from().line,0),to:C(a.doc,U(b.to().line+1,0))}})},delLineLeft:function(a){fc(a,function(a){return{from:U(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){fc(a,function(b){var c=a.charCoords(b.head,"div").top+5;return{from:a.coordsChar({left:0,top:c},"div"),to:b.from()}})},delWrappedLineRight:function(a){fc(a,function(b){var c=
a.charCoords(b.head,"div").top+5;c=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div");return{from:b.from(),to:c}})},undo:function(a){a.undo()},redo:function(a){a.redo()},undoSelection:function(a){a.undoSelection()},redoSelection:function(a){a.redoSelection()},goDocStart:function(a){a.extendSelection(U(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(U(a.lastLine()))},goLineStart:function(a){a.extendSelectionsBy(function(b){return mf(a,b.head.line)},{origin:"+move",bias:1})},
goLineStartSmart:function(a){a.extendSelectionsBy(function(b){return nf(a,b.head)},{origin:"+move",bias:1})},goLineEnd:function(a){a.extendSelectionsBy(function(b){b=b.head.line;for(var c,d=na(a.doc,b);c=lc(d,!1);)d=c.find(1,!0).line,b=null;c=(c=Lb(d))?c[0].level%2?Id(d):Jd(d):d.text.length;return U(null==b?Va(d):b,c)},{origin:"+move",bias:-1})},goLineRight:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:b},
"div")},ld)},goLineLeft:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:0,top:b},"div")},ld)},goLineLeftSmart:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5;c=a.coordsChar({left:0,top:c},"div");return c.ch<a.getLine(c.line).search(/\S/)?nf(a,b.head):c},ld)},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,
"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},
delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,"group")},delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("\t")},insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,e=0;e<c.length;e++){var f=c[e].from();f=Eb(a.getLine(f.line),f.ch,d);b.push(Array(d-
f%d+1).join(" "))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){Ta(a,function(){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++){var e=b[d].head,f=na(a.doc,e.line).text;if(f)if(e.ch==f.length&&(e=new U(e.line,e.ch-1)),0<e.ch)e=new U(e.line,e.ch+1),a.replaceRange(f.charAt(e.ch-1)+f.charAt(e.ch-2),U(e.line,e.ch-2),e,"+transpose");else if(e.line>a.doc.first){var g=na(a.doc,e.line-1).text;g&&a.replaceRange(f.charAt(0)+
"\n"+g.charAt(g.length-1),U(e.line-1,g.length-1),U(e.line,1),"+transpose")}c.push(new Q(e,e))}a.setSelections(c)})},newlineAndIndent:function(a){Ta(a,function(){for(var b=a.listSelections().length,c=0;c<b;c++){var d=a.listSelections()[c];a.replaceRange("\n",d.anchor,d.head,"+input");a.indentLine(d.from().line+1,null,!0);ac(a)}})},toggleOverwrite:function(a){a.toggleOverwrite()}},Qb=a.keyMap={};Qb.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",
PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"};Qb.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart",
"Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"};Qb.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart",
"Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection",
"Shift-Cmd-U":"redoSelection",fallthrough:["basic","emacsy"]};Qb.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"};Qb["default"]=Db?Qb.macDefault:Qb.pcDefault;var Od=a.lookupKey=
function(a,b,c){function d(b){b=Nc(b);var e=b[a];if(!1===e)return"stop";if(null!=e&&c(e))return!0;if(b.nofallthrough)return"stop";b=b.fallthrough;if(null==b)return!1;if("[object Array]"!=Object.prototype.toString.call(b))return d(b);for(e=0;e<b.length;++e){var f=d(b[e]);if(f)return f}return!1}for(var e=0;e<b.length;++e){var f=d(b[e]);if(f)return"stop"!=f}},Nf=a.isModifierKey=function(a){a=ec[a.keyCode];return"Ctrl"==a||"Alt"==a||"Shift"==a||"Mod"==a},Of=a.keyName=function(a,b){if(Fb&&34==a.keyCode&&
a["char"])return!1;var c=ec[a.keyCode];if(null==c||a.altGraphKey)return!1;a.altKey&&(c="Alt-"+c);if(qf?a.metaKey:a.ctrlKey)c="Ctrl-"+c;if(qf?a.ctrlKey:a.metaKey)c="Cmd-"+c;!b&&a.shiftKey&&(c="Shift-"+c);return c};a.fromTextArea=function(b,c){function d(){b.value=m.getValue()}c||(c={});c.value=b.value;!c.tabindex&&b.tabindex&&(c.tabindex=b.tabindex);!c.placeholder&&b.placeholder&&(c.placeholder=b.placeholder);if(null==c.autofocus){var e=Wb();c.autofocus=e==b||null!=b.getAttribute("autofocus")&&e==
document.body}if(b.form&&(xa(b.form,"submit",d),!c.leaveSubmitMethodAlone)){var f=b.form,g=f.submit;try{var l=f.submit=function(){d();f.submit=g;f.submit();f.submit=l}}catch(Ff){}}b.style.display="none";var m=a(function(a){b.parentNode.insertBefore(a,b.nextSibling)},c);m.save=d;m.getTextArea=function(){return b};m.toTextArea=function(){d();b.parentNode.removeChild(m.getWrapperElement());b.style.display="";b.form&&(Rb(b.form,"submit",d),"function"==typeof b.form.submit&&(b.form.submit=g))};return m};
var Sd=a.StringStream=function(a,b){this.pos=this.start=0;this.string=a;this.tabSize=b||8;this.lineStart=this.lastColumnPos=this.lastColumnValue=0};Sd.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(a){var b=this.string.charAt(this.pos);if("string"==typeof a?b==a:b&&(a.test?a.test(b):
a(b)))return++this.pos,b},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){a=this.string.indexOf(a,this.pos);if(-1<a)return this.pos=a,!0},backUp:function(a){this.pos-=a},column:function(){this.lastColumnPos<this.start&&(this.lastColumnValue=Eb(this.string,this.start,this.tabSize,this.lastColumnPos,
this.lastColumnValue),this.lastColumnPos=this.start);return this.lastColumnValue-(this.lineStart?Eb(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return Eb(this.string,null,this.tabSize)-(this.lineStart?Eb(this.string,this.lineStart,this.tabSize):0)},match:function(a,b,c){if("string"==typeof a){var d=function(a){return c?a.toLowerCase():a},e=this.string.substr(this.pos,a.length);if(d(e)==d(a))return!1!==b&&(this.pos+=a.length),!0}else{if((a=this.string.slice(this.pos).match(a))&&
0<a.index)return null;a&&!1!==b&&(this.pos+=a[0].length);return a}},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}}};var tc=a.TextMarker=function(a,b){this.lines=[];this.type=b;this.doc=a};hc(tc);tc.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;b&&$a(a);if(yb(this,"clear")){var c=this.find();c&&bb(this,"clear",c.from,c.to)}for(var d=c=null,e=0;e<this.lines.length;++e){var f=
this.lines[e],g=Pc(f.markedSpans,this);a&&!this.collapsed?Xa(a,Va(f),"text"):a&&(null!=g.to&&(d=Va(f)),null!=g.from&&(c=Va(f)));for(var l=f,m=void 0,n=f.markedSpans,q=g,t=0;t<n.length;++t)n[t]!=q&&(m||(m=[])).push(n[t]);l.markedSpans=m;null==g.from&&this.collapsed&&!ic(this.doc,f)&&a&&Jb(f,ib(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(e=0;e<this.lines.length;++e)f=Ib(this.lines[e]),g=p(f),g>a.display.maxLineLength&&(a.display.maxLine=f,a.display.maxLineLength=g,a.display.maxLineChanged=
!0);null!=c&&a&&this.collapsed&&Ia(a,c,d+1);this.lines.length=0;this.explicitlyCleared=!0;this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&Ma(a.doc));a&&bb(a,"markerCleared",a,this);b&&Ya(a);this.parent&&this.parent.clear()}};tc.prototype.find=function(a,b){null==a&&"bookmark"==this.type&&(a=1);for(var c,d,e=0;e<this.lines.length;++e){var f=this.lines[e],g=Pc(f.markedSpans,this);if(null!=g.from&&(c=U(b?f:Va(f),g.from),-1==a))return c;if(null!=g.to&&(d=U(b?f:Va(f),g.to),1==a))return d}return c&&
{from:c,to:d}};tc.prototype.changed=function(){var a=this.find(-1,!0),b=this,c=this.doc.cm;a&&c&&Ta(c,function(){var d=a.line,e=Va(a.line);if(e=jb(c,e))Ob(e),c.curOp.selectionChanged=c.curOp.forceUpdate=!0;c.curOp.updateMaxLine=!0;ic(b.doc,d)||null==b.height||(e=b.height,b.height=null,(e=Rc(b)-e)&&Jb(d,d.height+e))})};tc.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=fb(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=
[])).push(this)}this.lines.push(a)};tc.prototype.detachLine=function(a){this.lines.splice(fb(this.lines,a),1);!this.lines.length&&this.doc.cm&&(a=this.doc.cm.curOp,(a.maybeHiddenMarkers||(a.maybeHiddenMarkers=[])).push(this))};var Pf=0,Qd=a.SharedTextMarker=function(a,b){this.markers=a;this.primary=b;for(b=0;b<a.length;++b)a[b].parent=this};hc(Qd);Qd.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();bb(this,
"clear")}};Qd.prototype.find=function(a,b){return this.primary.find(a,b)};var Rd=a.LineWidget=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.cm=a;this.node=b};hc(Rd);Rd.prototype.clear=function(){var a=this.cm,b=this.line.widgets,c=this.line,d=Va(c);if(null!=d&&b){for(var e=0;e<b.length;++e)b[e]==this&&b.splice(e--,1);b.length||(c.widgets=null);var f=Rc(this);Ta(a,function(){var b=-f;Kb(c)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&$b(a,null,b);Xa(a,d,"widget");Jb(c,
Math.max(0,c.height-f))})}};Rd.prototype.changed=function(){var a=this.height,b=this.cm,c=this.line;this.height=null;var d=Rc(this)-a;d&&Ta(b,function(){b.curOp.forceUpdate=!0;Kb(c)<(b.curOp&&b.curOp.scrollTop||b.doc.scrollTop)&&$b(b,null,d);Jb(c,c.height+d)})};var uc=a.Line=function(a,b,c){this.text=a;Qe(this,b);this.height=c?c(this):1};hc(uc);uc.prototype.lineNo=function(){return Va(this)};var Rf={},Qf={};Sc.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=
a,d=a+b;c<d;++c){var e=this.lines[c];this.height-=e.height;var f=e;f.parent=null;Vc(f);bb(e,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,b,c){this.height+=c;this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(a=0;a<b.length;++a)b[a].parent=this},iterN:function(a,b,c){for(b=a+b;a<b;++a)if(c(this.lines[a]))return!0}};Wc.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=
0;c<this.children.length;++c){var d=this.children[c],e=d.chunkSize();if(a<e){var f=Math.min(b,e-a),g=d.height;d.removeInner(a,f);this.height-=g-d.height;e==f&&(this.children.splice(c--,1),d.parent=null);if(0==(b-=f))break;a=0}else a-=e}25>this.size-b&&(1<this.children.length||!(this.children[0]instanceof Sc))&&(a=[],this.collapse(a),this.children=[new Sc(a)],this.children[0].parent=this)},collapse:function(a){for(var b=0;b<this.children.length;++b)this.children[b].collapse(a)},insertInner:function(a,
b,c){this.size+=b.length;this.height+=c;for(var d=0;d<this.children.length;++d){var e=this.children[d],f=e.chunkSize();if(a<=f){e.insertInner(a,b,c);if(e.lines&&50<e.lines.length){for(;50<e.lines.length;)a=e.lines.splice(e.lines.length-25,25),a=new Sc(a),e.height-=a.height,this.children.splice(d+1,0,a),a.parent=this;this.maybeSpill()}break}a-=f}},maybeSpill:function(){if(!(10>=this.children.length)){var a=this;do{var b=a.children.splice(a.children.length-5,5);b=new Wc(b);if(a.parent){a.size-=b.size;
a.height-=b.height;var c=fb(a.parent.children,a);a.parent.children.splice(c+1,0,b)}else c=new Wc(a.children),c.parent=a,a.children=[c,b],a=c;b.parent=a.parent}while(10<a.children.length);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var d=0;d<this.children.length;++d){var e=this.children[d],f=e.chunkSize();if(a<f){f=Math.min(b,f-a);if(e.iterN(a,f,c))return!0;if(0==(b-=f))break;a=0}else a-=f}}};var Yf=0,tb=a.Doc=function(a,b,c){if(!(this instanceof tb))return new tb(a,b,c);null==c&&(c=0);Wc.call(this,
[new Sc([new uc("",null)])]);this.first=c;this.scrollTop=this.scrollLeft=0;this.cantEdit=!1;this.cleanGeneration=1;this.frontier=c;c=U(c,0);this.sel=ua(c);this.history=new xd(null);this.id=++Yf;this.modeOption=b;"string"==typeof a&&(a=rc(a));ce(this,{from:c,to:c,text:a});Ca(this,ua(c),cc)};tb.prototype=Ee(Wc.prototype,{constructor:tb,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0;d<b.length;++d)c+=b[d].height;
this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=de(this,this.first,this.first+this.size);return!1===a?b:b.join(a||"\n")},setValue:Za(function(a){var b=U(this.first,0),c=this.first+this.size-1;Zb(this,{from:b,to:U(c,na(this,c).text.length),text:rc(a),origin:"setValue"},!0);Ca(this,ua(b))}),replaceRange:function(a,b,c,d){b=C(this,b);c=c?C(this,c):b;Nb(this,a,b,c,d)},getRange:function(a,b,c){a=Xc(this,C(this,a),C(this,b));return!1===
c?a:a.join(c||"\n")},getLine:function(a){return(a=this.getLineHandle(a))&&a.text},getLineHandle:function(a){if(W(this,a))return na(this,a)},getLineNumber:function(a){return Va(a)},getLineHandleVisualStart:function(a){"number"==typeof a&&(a=na(this,a));return Ib(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return C(this,a)},getCursor:function(a){var b=this.sel.primary();return null==a||"head"==
a?b.head:"anchor"==a?b.anchor:"end"==a||"to"==a||!1===a?b.to():b.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Za(function(a,b,c){a=C(this,"number"==typeof a?U(a,b||0):a);Ca(this,ua(a,null),c)}),setSelection:Za(function(a,b,c){var d=C(this,a);a=C(this,b||a);Ca(this,ua(d,a),c)}),extendSelection:Za(function(a,b,c){Ba(this,C(this,a),b&&C(this,b),c)}),extendSelections:Za(function(a,b){b=[];for(var c=0;c<a.length;c++)b[c]=
C(this,a[c]);ca(this,b)}),extendSelectionsBy:Za(function(a,b){ca(this,Qc(this.sel.ranges,a),b)}),setSelections:Za(function(a,b,c){if(a.length){for(var d=0,e=[];d<a.length;d++)e[d]=new Q(C(this,a[d].anchor),C(this,a[d].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex));Ca(this,R(e,b),c)}}),addSelection:Za(function(a,b,c){var d=this.sel.ranges.slice(0);d.push(new Q(C(this,a),C(this,b||a)));Ca(this,R(d,d.length-1),c)}),getSelection:function(a){for(var b=this.sel.ranges,c,d=0;d<b.length;d++){var e=
Xc(this,b[d].from(),b[d].to());c=c?c.concat(e):e}return!1===a?c:c.join(a||"\n")},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;d<c.length;d++){var e=Xc(this,c[d].from(),c[d].to());!1!==a&&(e=e.join(a||"\n"));b[d]=e}return b},replaceSelection:function(a,b,c){for(var d=[],e=0;e<this.sel.ranges.length;e++)d[e]=a;this.replaceSelections(d,b,c||"+input")},replaceSelections:Za(function(a,b,c){for(var d=[],e=this.sel,f=0;f<e.ranges.length;f++){var g=e.ranges[f];d[f]={from:g.from(),to:g.to(),
text:rc(a[f]),origin:c}}if(f=b&&"end"!=b){f=[];c=a=U(this.first,0);for(e=0;e<d.length;e++){var l=d[e];g=Gd(l.from,a,c);var m=Gd(dc(l),a,c);a=l.to;c=m;"around"==b?(l=this.sel.ranges[e],l=0>Aa(l.head,l.anchor),f[e]=new Q(l?m:g,l?g:m)):f[e]=new Q(g,g)}f=new ma(f,this.sel.primIndex)}b=f;for(f=d.length-1;0<=f;f--)Zb(this,d[f]);b?Ua(this,b):this.cm&&ac(this.cm)}),undo:Za(function(){Vb(this,"undo")}),redo:Za(function(){Vb(this,"redo")}),undoSelection:Za(function(){Vb(this,"undo",!0)}),redoSelection:Za(function(){Vb(this,
"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,b=0,c=0,d=0;d<a.done.length;d++)a.done[d].ranges||++b;for(d=0;d<a.undone.length;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=new xd(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=
null);return this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:Cc(this.history.done),undone:Cc(this.history.undone)}},setHistory:function(a){var b=this.history=new xd(this.history.maxGeneration);b.done=Cc(a.done.slice(0),null,!0);b.undone=Cc(a.undone.slice(0),null,!0)},addLineClass:Za(function(a,b,c){return pd(this,a,"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"wrapClass";if(a[d]){if((new RegExp("(?:^|\\s)"+
c+"(?:$|\\s)")).test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:Za(function(a,b,c){return pd(this,a,"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"wrapClass",e=a[d];if(e)if(null==c)a[d]=null;else{var f=e.match(new RegExp("(?:^|\\s+)"+c+"(?:$|\\s+)"));if(!f)return!1;var g=f.index+f[0].length;a[d]=e.slice(0,f.index)+(f.index&&g!=e.length?" ":"")+e.slice(g)||null}else return!1;return!0})}),markText:function(a,b,c){return yc(this,C(this,a),C(this,b),
c,"range")},setBookmark:function(a,b){b={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared};a=C(this,a);return yc(this,a,a,b,"bookmark")},findMarksAt:function(a){a=C(this,a);var b=[],c=na(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var e=c[d];(null==e.from||e.from<=a.ch)&&(null==e.to||e.to>=a.ch)&&b.push(e.marker.parent||e.marker)}return b},findMarks:function(a,b,c){a=C(this,a);b=C(this,b);var d=[],e=a.line;this.iter(a.line,
b.line+1,function(f){if(f=f.markedSpans)for(var g=0;g<f.length;g++){var l=f[g];e==a.line&&a.ch>l.to||null==l.from&&e!=a.line||e==b.line&&l.from>b.ch||c&&!c(l.marker)||d.push(l.marker.parent||l.marker)}++e});return d},getAllMarks:function(){var a=[];this.iter(function(b){if(b=b.markedSpans)for(var c=0;c<b.length;++c)null!=b[c].from&&a.push(b[c].marker)});return a},posFromIndex:function(a){var b,c=this.first;this.iter(function(d){d=d.text.length+1;if(d>a)return b=a,!0;a-=d;++c});return C(this,U(c,b))},
indexFromPos:function(a){a=C(this,a);var b=a.ch;if(a.line<this.first||0>a.ch)return 0;this.iter(this.first,a.line,function(a){b+=a.text.length+1});return b},copy:function(a){var b=new tb(de(this,this.first,this.first+this.size),this.modeOption,this.first);b.scrollTop=this.scrollTop;b.scrollLeft=this.scrollLeft;b.sel=this.sel;b.extend=!1;a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory()));return b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;
null!=a.from&&a.from>b&&(b=a.from);null!=a.to&&a.to<c&&(c=a.to);b=new tb(de(this,b,c),a.mode||this.modeOption,b);a.sharedHist&&(b.history=this.history);(this.linked||(this.linked=[])).push({doc:b,sharedHist:a.sharedHist});b.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}];a=Be(this);for(c=0;c<a.length;c++){var d=a[c],e=d.find(),f=b.clipPos(e.from);e=b.clipPos(e.to);Aa(f,e)&&(f=yc(b,f,e,d.primary,d.primary.type),d.markers.push(f),f.parent=d)}return b},unlinkDoc:function(b){b instanceof a&&(b=
b.doc);if(this.linked)for(var c=0;c<this.linked.length;++c)if(this.linked[c].doc==b){this.linked.splice(c,1);b.unlinkDoc(this);tf(Be(this));break}if(b.history==this.history){var d=[b.id];kc(b,function(a){d.push(a.id)},!0);b.history=new xd(null);b.history.done=Cc(this.history.done,d);b.history.undone=Cc(this.history.undone,d)}},iterLinkedDocs:function(a){kc(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm}});tb.prototype.eachLine=tb.prototype.iter;var Zf=["iter","insert",
"remove","copy","getEditor"],od;for(od in tb.prototype)tb.prototype.hasOwnProperty(od)&&0>fb(Zf,od)&&(a.prototype[od]=function(a){return function(){return a.apply(this.doc,arguments)}}(tb.prototype[od]));hc(tb);var ob=a.e_preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},ag=a.e_stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},te=a.e_stop=function(a){ob(a);ag(a)},xa=a.on=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):
a.attachEvent?a.attachEvent("on"+b,c):(a=a._handlers||(a._handlers={}),(a[b]||(a[b]=[])).push(c))},Rb=a.off=function(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else if(a=a._handlers&&a._handlers[b])for(b=0;b<a.length;++b)if(a[b]==c){a.splice(b,1);break}},db=a.signal=function(a,b){var c=a._handlers&&a._handlers[b];if(c)for(var d=Array.prototype.slice.call(arguments,2),e=0;e<c.length;++e)c[e].apply(null,d)},jd=null,Cb=30,ff=a.Pass={toString:function(){return"CodeMirror.Pass"}},
cc={scroll:!1},ve={origin:"*mouse"},ld={origin:"+move"};td.prototype.set=function(a,b){clearTimeout(this.id);this.id=setTimeout(b,a)};var Eb=a.countColumn=function(a,b,c,d,e){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));d=d||0;for(e=e||0;;){var f=a.indexOf("\t",d);if(0>f||f>=b)return e+(b-d);e+=f-d;e+=c-e%c;d=f+1}},Td=[""],gd=function(a){a.select()};cd?gd=function(a){a.selectionStart=0;a.selectionEnd=a.value.length}:Fa&&(gd=function(a){try{a.select()}catch(T){}});[].indexOf&&(fb=function(a,
b){return a.indexOf(b)});[].map&&(Qc=function(a,b){return a.map(b)});var bg=/[\u00df\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,kf=a.isWordChar=function(a){return/\w/.test(a)||"\u0080"<a&&(a.toUpperCase()!=a.toLowerCase()||bg.test(a))},Uf=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;
var ed=document.createRange?function(a,b,c){var d=document.createRange();d.setEnd(a,c);d.setStart(a,b);return d}:function(a,b,c){var d=document.body.createTextRange();d.moveToElementText(a.parentNode);d.collapse(!0);d.moveEnd("character",c);d.moveStart("character",b);return d};Fa&&11>Pa&&(Wb=function(){try{return document.activeElement}catch(F){return document.body}});var af=!1,Mf=function(){if(Fa&&9>Pa)return!1;var a=ja("div");return"draggable"in a||"dragDrop"in a}(),kd,ze,xe,rc=a.splitLines=3!=
"\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;b<=d;){var e=a.indexOf("\n",b);-1==e&&(e=a.length);var f=a.slice(b,"\r"==a.charAt(e-1)?e-1:e),g=f.indexOf("\r");-1!=g?(c.push(f.slice(0,g)),b+=g+1):(c.push(f),b=e+1)}return c}:function(a){return a.split(/\r\n?|\n/)},Lf=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(T){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(ha){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",
b):!1},cf=function(){var a=ja("div");if("oncopy"in a)return!0;a.setAttribute("oncopy","return;");return"function"==typeof a.oncopy}(),oe=null,ec={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",
191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};a.keyNames=ec;(function(){for(var a=0;10>a;a++)ec[a+48]=ec[a+96]=String(a);for(a=65;90>=a;a++)ec[a]=String.fromCharCode(a);for(a=1;12>=a;a++)ec[a+111]=ec[a+63235]="F"+a})();var fd,Tf=function(){function a(a){return 247>=a?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(a):
1424<=a&&1524>=a?"R":1536<=a&&1773>=a?"rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm".charAt(a-1536):1774<=a&&2220>=a?"r":8192<=a&&8203>=a?"w":8204==a?"b":"L"}function b(a,b,c){this.level=a;this.from=b;this.to=c}var c=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,d=/[stwN]/,e=/[LRr]/,f=/[Lb1n]/,g=/[1n]/;return function(l){if(!c.test(l))return!1;
for(var m=l.length,n=[],p=0,q;p<m;++p)n.push(a(l.charCodeAt(p)));p=0;for(var t="L";p<m;++p)q=n[p],"m"==q?n[p]=t:t=q;p=0;for(t="L";p<m;++p)q=n[p],"1"==q&&"r"==t?n[p]="n":e.test(q)&&(t=q,"r"==q&&(n[p]="R"));p=1;for(t=n[0];p<m-1;++p)q=n[p],"+"==q&&"1"==t&&"1"==n[p+1]?n[p]="1":","!=q||t!=n[p+1]||"1"!=t&&"n"!=t||(n[p]=t),t=q;for(p=0;p<m;++p)if(q=n[p],","==q)n[p]="N";else if("%"==q){for(t=p+1;t<m&&"%"==n[t];++t);var w=p&&"!"==n[p-1]||t<m&&"1"==n[t]?"1":"N";for(q=p;q<t;++q)n[q]=w;p=t-1}p=0;for(t="L";p<m;++p)q=
n[p],"L"==t&&"1"==q?n[p]="L":e.test(q)&&(t=q);for(p=0;p<m;++p)if(d.test(n[p])){for(t=p+1;t<m&&d.test(n[t]);++t);q="L"==(t<m?n[t]:"L");w="L"==(p?n[p-1]:"L")||q?"L":"R";for(q=p;q<t;++q)n[q]=w;p=t-1}t=[];var K;for(p=0;p<m;)if(f.test(n[p])){q=p;for(++p;p<m&&f.test(n[p]);++p);t.push(new b(0,q,p))}else{var y=p;w=t.length;for(++p;p<m&&"L"!=n[p];++p);for(q=y;q<p;)if(g.test(n[q])){y<q&&t.splice(w,0,new b(1,y,q));y=q;for(++q;q<p&&g.test(n[q]);++q);t.splice(w,0,new b(2,y,q));y=q}else++q;y<p&&t.splice(w,0,new b(1,
y,p))}1==t[0].level&&(K=l.match(/^\s+/))&&(t[0].from=K[0].length,t.unshift(new b(0,0,K[0].length)));1==Oa(t).level&&(K=l.match(/\s+$/))&&(Oa(t).to-=K[0].length,t.push(new b(0,m-K[0].length,m)));t[0].level!=Oa(t).level&&t.push(new b(t[0].level,m,m));return t}}();a.version="4.5.0";return a});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require(app.baseUrl+"js/codemirror-editor/lib/codemirror")):"function"==typeof define&&define.amd?define([app.baseUrl+"js/codemirror-editor/lib/codemirror"],a):a(CodeMirror)})(function(a){function b(a,b){this.cm=a;this.options=this.buildOptions(b);this.widget=this.onClose=null}function d(a,b){function c(a,c){var e="string"!=typeof c?function(a){return c(a,b)}:d.hasOwnProperty(c)?d[c]:c;f[a]=e}var d={Up:function(){b.moveFocus(-1)},Down:function(){b.moveFocus(1)},
PageUp:function(){b.moveFocus(-b.menuSize()+1,!0)},PageDown:function(){b.moveFocus(b.menuSize()-1,!0)},Home:function(){b.setFocus(0)},End:function(){b.setFocus(b.length-1)},Enter:b.pick,Tab:b.pick,Esc:b.close},e=a.options.customKeys,f=e?{}:d;if(e)for(var g in e)e.hasOwnProperty(g)&&c(g,e[g]);if(a=a.options.extraKeys)for(g in a)a.hasOwnProperty(g)&&c(g,a[g]);return f}function c(a,b){for(;b&&b!=a;){if("LI"===b.nodeName.toUpperCase()&&b.parentNode==a)return b;b=b.parentNode}}function f(b,f){this.completion=
b;this.data=f;var g=this,l=b.cm,e=this.hints=document.createElement("ul");e.className="CodeMirror-hints";this.selectedHint=f.selectedHint||0;for(var m=f.list,t=0;t<m.length;++t){var w=e.appendChild(document.createElement("li")),y=m[t],A="CodeMirror-hint"+(t!=this.selectedHint?"":" CodeMirror-hint-active");null!=y.className&&(A=y.className+" "+A);w.className=A;y.render?y.render(w,f,y):w.appendChild(document.createTextNode(y.displayText||("string"==typeof y?y:y.text)));w.hintId=t}t=l.cursorCoords(b.options.alignWithWord?
f.from:null);var x=t.left,z=t.bottom,D=!0;e.style.left=x+"px";e.style.top=z+"px";w=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);A=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(b.options.container||document.body).appendChild(e);y=e.getBoundingClientRect();if(0<y.bottom-A){var B=y.bottom-y.top;0<t.top-(t.bottom-y.top)-B?(e.style.top=(z=t.top-B)+"px",D=!1):B>A&&(e.style.height=A-5+"px",e.style.top=(z=t.bottom-
y.top)+"px",A=l.getCursor(),f.from.ch!=A.ch&&(t=l.cursorCoords(A),e.style.left=(x=t.left)+"px",y=e.getBoundingClientRect()))}A=y.left-w;0<A&&(y.right-y.left>w&&(e.style.width=w-5+"px",A-=y.right-y.left-w),e.style.left=(x=t.left-A)+"px");l.addKeyMap(this.keyMap=d(b,{moveFocus:function(a,b){g.changeActive(g.selectedHint+a,b)},setFocus:function(a){g.changeActive(a)},menuSize:function(){return g.screenAmount()},length:m.length,close:function(){b.close()},pick:function(){g.pick()},data:f}));if(b.options.closeOnUnfocus){var G;
l.on("blur",this.onBlur=function(){G=setTimeout(function(){b.close()},100)});l.on("focus",this.onFocus=function(){clearTimeout(G)})}var L=l.getScrollInfo();l.on("scroll",this.onScroll=function(){var a=l.getScrollInfo(),c=l.getWrapperElement().getBoundingClientRect(),d=z+L.top-a.top,f=d-(window.pageYOffset||(document.documentElement||document.body).scrollTop);D||(f+=e.offsetHeight);if(f<=c.top||f>=c.bottom)return b.close();e.style.top=d+"px";e.style.left=x+L.left-a.left+"px"});a.on(e,"dblclick",function(a){(a=
c(e,a.target||a.srcElement))&&null!=a.hintId&&(g.changeActive(a.hintId),g.pick())});a.on(e,"click",function(a){(a=c(e,a.target||a.srcElement))&&null!=a.hintId&&(g.changeActive(a.hintId),b.options.completeOnSingleClick&&g.pick())});a.on(e,"mousedown",function(){setTimeout(function(){l.focus()},20)});a.signal(f,"select",m[0],e.firstChild);return!0}a.showHint=function(a,b,c){if(!b)return a.showHint(c);c&&c.async&&(b.async=!0);b={hint:b};if(c)for(var d in c)b[d]=c[d];return a.showHint(b)};a.defineExtension("showHint",
function(c){if(!(1<this.listSelections().length||this.somethingSelected())){this.state.completionActive&&this.state.completionActive.close();var d=this.state.completionActive=new b(this,c);if(c=d.options.hint)if(a.signal(this,"startCompletion",this),c.async)c(this,function(a){d.showHints(a)},d.options);else return d.showHints(c(this,d.options))}});b.prototype={close:function(){if(this.active()){this.cm.state.completionActive=null;this.widget&&this.widget.close();if(this.onClose)this.onClose();a.signal(this.cm,
"endCompletion",this.cm)}},active:function(){return this.cm.state.completionActive==this},pick:function(b,c){c=b.list[c];c.hint?c.hint(this.cm,b,c):this.cm.replaceRange("string"==typeof c?c:c.text,c.from||b.from,c.to||b.to,"complete");a.signal(b,"pick",c);this.close()},showHints:function(a){if(!a||!a.list.length||!this.active())return this.close();this.options.completeSingle&&1==a.list.length?this.pick(a,0):this.showWidget(a)},showWidget:function(b){function c(){w||(w=!0,t.close(),t.cm.off("cursorActivity",
e),b&&a.signal(b,"close"))}function d(){if(!w){a.signal(b,"update");var c=t.options.hint;c.async?c(t.cm,g,t.options):g(c(t.cm,t.options))}}function g(a){b=a;if(!w){if(!b||!b.list.length)return c();t.widget&&t.widget.close();t.widget=new f(t,b)}}function e(){m&&(D(m),m=0);var a=t.cm.getCursor(),b=t.cm.getLine(a.line);a.line!=A.line||b.length-a.ch!=x-A.ch||a.ch<A.ch||t.cm.somethingSelected()||a.ch&&y.test(b.charAt(a.ch-1))?t.close():(m=z(d),t.widget&&t.widget.close())}this.widget=new f(this,b);a.signal(b,
"shown");var m=0,t=this,w,y=this.options.closeCharacters,A=this.cm.getCursor(),x=this.cm.getLine(A.line).length,z=window.requestAnimationFrame||function(a){return setTimeout(a,1E3/60)},D=window.cancelAnimationFrame||clearTimeout;this.cm.on("cursorActivity",e);this.onClose=c},buildOptions:function(a){var b=this.cm.options.hintOptions,c={},d;for(d in g)c[d]=g[d];if(b)for(d in b)void 0!==b[d]&&(c[d]=b[d]);if(a)for(d in a)void 0!==a[d]&&(c[d]=a[d]);return c}};f.prototype={close:function(){if(this.completion.widget==
this){this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var a=this.completion.cm;this.completion.options.closeOnUnfocus&&(a.off("blur",this.onBlur),a.off("focus",this.onFocus));a.off("scroll",this.onScroll)}},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(b,c){b>=this.data.list.length?b=c?this.data.list.length-1:0:0>b&&(b=c?0:this.data.list.length-1);this.selectedHint!=b&&(c=this.hints.childNodes[this.selectedHint],
c.className=c.className.replace(" CodeMirror-hint-active",""),c=this.hints.childNodes[this.selectedHint=b],c.className+=" CodeMirror-hint-active",c.offsetTop<this.hints.scrollTop?this.hints.scrollTop=c.offsetTop-3:c.offsetTop+c.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=c.offsetTop+c.offsetHeight-this.hints.clientHeight+3),a.signal(this.data,"select",this.data.list[this.selectedHint],c))},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||
1}};a.registerHelper("hint","auto",function(b,c){var d=b.getHelpers(b.getCursor(),"hint");if(d.length)for(var f=0;f<d.length;f++){var e=d[f](b,c);if(e&&e.list.length)return e}else if(d=b.getHelper(b.getCursor(),"hintWords")){if(d)return a.hint.fromList(b,{words:d})}else if(a.hint.anyword)return a.hint.anyword(b,c)});a.registerHelper("hint","fromList",function(b,c){var d=b.getCursor();b=b.getTokenAt(d);for(var f=[],e=0;e<c.words.length;e++){var g=c.words[e];g.slice(0,b.string.length)==b.string&&f.push(g)}if(f.length)return{list:f,
from:a.Pos(d.line,b.start),to:a.Pos(d.line,b.end)}});a.commands.autocomplete=a.showHint;var g={hint:a.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!1,container:null,customKeys:null,extraKeys:null};a.defineOption("hintOptions",null)});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require(app.baseUrl+"js/codemirror-editor/lib/codemirror"),require(app.baseUrl+"js/codemirror-editor/mode/css/css")):"function"==typeof define&&define.amd?define([app.baseUrl+"js/codemirror-editor/lib/codemirror",app.baseUrl+"js/codemirror-editor/mode/css/css"],a):a(CodeMirror)})(function(a){var b={link:1,visited:1,active:1,hover:1,focus:1,"first-letter":1,"first-line":1,"first-child":1,before:1,after:1,lang:1};a.registerHelper("hint",
"css",function(d){function c(a){for(var b in a)l&&0!=b.lastIndexOf(l,0)||e.push(b)}var f=d.getCursor(),g=d.getTokenAt(f),m=a.innerMode(d.getMode(),g.state);if("css"==m.mode.name){var l=g.string;d=g.start;var n=g.end;/[^\w$_-]/.test(l)&&(l="",d=n=f.ch);var q=a.resolveMode("text/css"),e=[];m=m.state.state;if("pseudo"==m||"variable-3"==g.type)c(b);else if("block"==m||"maybeprop"==m)c(q.propertyKeywords);else if("prop"==m||"parens"==m||"at"==m||"params"==m)c(q.valueKeywords),c(q.colorKeywords);else if("media"==
m||"media_parens"==m)c(q.mediaTypes),c(q.mediaFeatures);if(e.length)return{list:e,from:a.Pos(f.line,d),to:a.Pos(f.line,n)}}})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require(app.baseUrl+"js/codemirror-editor/lib/codemirror")):"function"==typeof define&&define.amd?define([app.baseUrl+"js/codemirror-editor/lib/codemirror"],a):a(CodeMirror)})(function(a){function b(a,b){for(var c=0,d=a.length;c<d;++c)b(a[c])}function d(b,c,d,e){var l=b.getCursor(),m=d(b,l),n=m;if(!/\b(?:string|comment)\b/.test(m.type)){m.state=a.innerMode(b.getMode(),m.state).state;for(/^[\w$_]*$/.test(m.string)||(m=n={start:l.ch,end:l.ch,
string:"",state:m.state,type:"."==m.string?"property":null});"property"==n.type;){n=d(b,g(l.line,n.start));if("."!=n.string)return;n=d(b,g(l.line,n.start));if(!p)var p=[];p.push(n)}return{list:f(m,p,c,e),from:g(l.line,m.start),to:g(l.line,m.end)}}}function c(a,b){a=a.getTokenAt(b);b.ch==a.start+1&&"."==a.string.charAt(0)?(a.end=a.start,a.string=".",a.type="property"):/^\.[\w$_]*$/.test(a.string)&&(a.type="property",a.start++,a.string=a.string.replace(/\./,""));return a}function f(a,c,d,e){function f(a){var b;
if(b=0==a.lastIndexOf(q,0)){a:if(Array.prototype.indexOf)b=-1!=p.indexOf(a);else{for(b=p.length;b--;)if(p[b]===a){b=!0;break a}b=!1}b=!b}b&&p.push(a)}function g(a){"string"==typeof a?b(m,f):a instanceof Array?b(l,f):a instanceof Function&&b(n,f);for(var c in a)f(c)}var p=[],q=a.string;if(c&&c.length){a=c.pop();var t;a.type&&0===a.type.indexOf("variable")?(e&&e.additionalContext&&(t=e.additionalContext[a.string]),e&&!1===e.useGlobalScope||(t=t||window[a.string])):"string"==a.type?t="":"atom"==a.type?
t=1:"function"==a.type&&(null==window.jQuery||"$"!=a.string&&"jQuery"!=a.string||"function"!=typeof window.jQuery?null!=window._&&"_"==a.string&&"function"==typeof window._&&(t=window._()):t=window.jQuery());for(;null!=t&&c.length;)t=t[c.pop().string];null!=t&&g(t)}else{for(c=a.state.localVars;c;c=c.next)f(c.name);for(c=a.state.globalVars;c;c=c.next)f(c.name);e&&!1===e.useGlobalScope||g(window);b(d,f)}return p}var g=a.Pos;a.registerHelper("hint","javascript",function(a,b){return d(a,q,function(a,
b){return a.getTokenAt(b)},b)});a.registerHelper("hint","coffeescript",function(a,b){return d(a,e,c,b)});var m="charAt charCodeAt indexOf lastIndexOf substring substr slice trim trimLeft trimRight toUpperCase toLowerCase split concat match replace search".split(" "),l="length concat join splice push pop shift unshift slice reverse sort indexOf lastIndexOf every some filter forEach map reduce reduceRight ".split(" "),n=["prototype","apply","call","bind"],q="break case catch continue debugger default delete do else false finally for function if in instanceof new null return switch throw true try typeof var void while with".split(" "),
e="and break catch class continue delete do else extends false finally for if in instanceof isnt new no not null of off on or return switch then throw true try typeof until void while with yes".split(" ")});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require(app.baseUrl+"js/codemirror-editor/lib/codemirror")):"function"==typeof define&&define.amd?define([app.baseUrl+"js/codemirror-editor/lib/codemirror"],a):a(CodeMirror)})(function(a){function b(a,b,d){a=a.getWrapperElement().appendChild(document.createElement("div"));a.className=d?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top";"string"==typeof b?a.innerHTML=b:a.appendChild(b);return a}function d(a,
b){a.state.currentNotificationClose&&a.state.currentNotificationClose();a.state.currentNotificationClose=b}a.defineExtension("openDialog",function(c,f,g){function m(a){if("string"==typeof a)e.value=a;else if(!n&&(n=!0,l.parentNode.removeChild(l),q.focus(),g.onClose))g.onClose(l)}g||(g={});d(this,null);var l=b(this,c,g.bottom),n=!1,q=this,e=l.getElementsByTagName("input")[0];if(e){g.value&&(e.value=g.value);if(g.onInput)a.on(e,"input",function(a){g.onInput(a,e.value,m)});if(g.onKeyUp)a.on(e,"keyup",
function(a){g.onKeyUp(a,e.value,m)});a.on(e,"keydown",function(b){if(!(g&&g.onKeyDown&&g.onKeyDown(b,e.value,m))){if(27==b.keyCode||!1!==g.closeOnEnter&&13==b.keyCode)e.blur(),a.e_stop(b),m();13==b.keyCode&&f(e.value)}});if(!1!==g.closeOnBlur)a.on(e,"blur",m);e.focus()}else if(c=l.getElementsByTagName("button")[0]){a.on(c,"click",function(){m();q.focus()});if(!1!==g.closeOnBlur)a.on(c,"blur",m);c.focus()}return m});a.defineExtension("openConfirm",function(c,f,g){function m(){n||(n=!0,l.parentNode.removeChild(l),
q.focus())}d(this,null);var l=b(this,c,g&&g.bottom);c=l.getElementsByTagName("button");var n=!1,q=this,e=1;c[0].focus();for(g=0;g<c.length;++g){var p=c[g];(function(b){a.on(p,"click",function(c){a.e_preventDefault(c);m();b&&b(q)})})(f[g]);a.on(p,"blur",function(){--e;setTimeout(function(){0>=e&&m()},200)});a.on(p,"focus",function(){++e})}});a.defineExtension("openNotification",function(c,f){function g(){l||(l=!0,clearTimeout(n),m.parentNode.removeChild(m))}d(this,g);var m=b(this,c,f&&f.bottom);c=
f&&(void 0===f.duration?5E3:f.duration);var l=!1,n;a.on(m,"click",function(b){a.e_preventDefault(b);g()});c&&(n=setTimeout(g,f.duration))})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require(app.baseUrl+"js/codemirror-editor/lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define([app.baseUrl+"js/codemirror-editor/lib/codemirror","./searchcursor","../dialog/dialog"],a):a(CodeMirror)})(function(a){function b(a,b){"string"==typeof a?a=new RegExp(a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),b?"gi":"g"):a.global||(a=new RegExp(a.source,a.ignoreCase?
"gi":"g"));return{token:function(b){a.lastIndex=b.pos;var c=a.exec(b.string);if(c&&c.index==b.pos)return b.pos+=c[0].length,"searching";c?b.pos=c.index:b.skipToEnd()}}}function d(){this.overlay=this.posFrom=this.posTo=this.query=null}function c(a){return a.state.search||(a.state.search=new d)}function f(a){return"string"==typeof a&&a==a.toLowerCase()}function g(a,b,c){return a.getSearchCursor(b,c,f(b))}function m(a,b,c,d,e){a.openDialog?a.openDialog(b,e,{value:d}):e(prompt(c,d))}function l(a,b,c,
d){if(a.openConfirm)a.openConfirm(b,d);else if(confirm(c))d[0]()}function n(a){var b=a.match(/^\/(.*)\/([a-z]*)$/);b?(a=new RegExp(b[1],-1==b[2].indexOf("i")?"":"i"),a.test("")&&(a=/x^/)):""==a&&(a=/x^/);return a}function q(a,b){if(c(a).query)return p(a,b);m(a,'Search: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>',"Search for:",a.getSelection(),function(c){e(a,c,b)})}function e(a,
d,e){var g=c(a);a.operation(function(){d&&!g.query&&(g.query=n(d),a.removeOverlay(g.overlay,f(g.query)),g.overlay=b(g.query,f(g.query)),a.addOverlay(g.overlay),g.posFrom=g.posTo=a.getCursor(),p(a,e))})}function p(b,d){b.operation(function(){var e=c(b),f=g(b,e.query,d?e.posFrom:e.posTo);if(!f.find(d)&&(f=g(b,e.query,d?a.Pos(b.lastLine()):a.Pos(b.firstLine(),0)),!f.find(d)))return;b.setSelection(f.from(),f.to());b.scrollIntoView({from:f.from(),to:f.to()});e.posFrom=f.from();e.posTo=f.to()})}function t(a){a.operation(function(){var b=
c(a);b.query&&(b.query=null,a.removeOverlay(b.overlay))})}function w(a,b){a.getOption("readOnly")||m(a,'Replace: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>',"Replace:",a.getSelection(),function(c){c&&(c=n(c),m(a,'With: <input type="text" style="width: 10em" class="CodeMirror-search-field"/>',"Replace with:","",function(d){if(b)a.operation(function(){for(var b=g(a,c);b.findNext();)if("string"!=
typeof c){var e=a.getRange(b.from(),b.to()).match(c);b.replace(d.replace(/\$(\d)/g,function(a,b){return e[b]}))}else b.replace(d)});else{t(a);var e=g(a,c,a.getCursor()),f=function(){var b=e.from(),d;if(!(d=e.findNext())&&(e=g(a,c),!(d=e.findNext())||b&&e.from().line==b.line&&e.from().ch==b.ch))return;a.setSelection(e.from(),e.to());a.scrollIntoView({from:e.from(),to:e.to()});l(a,"Replace? <button>Yes</button> <button>No</button> <button>Stop</button>","Replace?",[function(){m(d)},f])},m=function(a){e.replace("string"==
typeof c?d:d.replace(/\$(\d)/g,function(b,c){return a[c]}));f()};f()}}))})}a.commands.find=function(a){t(a);q(a)};a.commands.findNext=q;a.commands.findPrev=function(a){q(a,!0)};a.commands.clearSearch=t;a.commands.replace=w;a.commands.replaceAll=function(a){w(a,!0)};a.commands.findAll=e});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require(app.baseUrl+"js/codemirror-editor/lib/codemirror")):"function"==typeof define&&define.amd?define([app.baseUrl+"js/codemirror-editor/lib/codemirror"],a):a(CodeMirror)})(function(a){function b(a,b,m,l){this.atOccurrence=!1;this.doc=a;null==l&&"string"==typeof b&&(l=!1);m=m?a.clipPos(m):c(0,0);this.pos={from:m,to:m};if("string"!=typeof b)b.global||(b=new RegExp(b.source,b.ignoreCase?"ig":"g")),this.matches=function(d,e){if(d){b.lastIndex=
0;d=a.getLine(e.line).slice(0,e.ch);for(var f=0,g,l;;){b.lastIndex=f;f=b.exec(d);if(!f)break;g=f;l=g.index;f=g.index+(g[0].length||1);if(f==d.length)break}(f=g&&g[0].length||0)||(0==l&&0==d.length?g=void 0:l!=a.getLine(e.line).length&&f++)}else b.lastIndex=e.ch,d=a.getLine(e.line),f=(g=b.exec(d))&&g[0].length||0,l=g&&g.index,l+f==d.length||f||(f=1);if(g&&f)return{from:c(e.line,l),to:c(e.line,l+f),match:g}};else{var f=b;l&&(b=b.toLowerCase());var g=l?function(a){return a.toLowerCase()}:function(a){return a},
e=b.split("\n");if(1==e.length)this.matches=b.length?function(e,l){if(e){e=a.getLine(l.line).slice(0,l.ch);var m=g(e),n=m.lastIndexOf(b);if(-1<n)return n=d(e,m,n),{from:c(l.line,n),to:c(l.line,n+f.length)}}else if(e=a.getLine(l.line).slice(l.ch),m=g(e),n=m.indexOf(b),-1<n)return n=d(e,m,n)+l.ch,{from:c(l.line,n),to:c(l.line,n+f.length)}}:function(){};else{var p=f.split("\n");this.matches=function(b,d){var f=e.length-1;if(b){if(!(d.line-(e.length-1)<a.firstLine()||g(a.getLine(d.line).slice(0,p[f].length))!=
e[e.length-1])){b=c(d.line,p[f].length);d=d.line-1;for(var l=f-1;1<=l;--l,--d)if(e[l]!=g(a.getLine(d)))return;l=a.getLine(d);var m=l.length-p[0].length;return g(l.slice(m))!=e[0]?void 0:{from:c(d,m),to:b}}}else if(!(d.line+(e.length-1)>a.lastLine())&&(l=a.getLine(d.line),m=l.length-p[0].length,g(l.slice(m))==e[0])){b=c(d.line,m);d=d.line+1;for(l=1;l<f;++l,++d)if(e[l]!=g(a.getLine(d)))return;return g(a.getLine(d).slice(0,p[f].length))!=e[f]?void 0:{from:b,to:c(d,p[f].length)}}}}}}function d(a,b,c){if(a.length==
b.length)return c;for(b=Math.min(c,a.length);;){var d=a.slice(0,b).toLowerCase().length;if(d<c)++b;else if(d>c)--b;else return b}}var c=a.Pos;b.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(a){function b(a){a=c(a,0);d.pos={from:a,to:a};return d.atOccurrence=!1}for(var d=this,f=this.doc.clipPos(a?this.pos.from:this.pos.to);;){if(this.pos=this.matches(a,f))return this.atOccurrence=!0,this.pos.match||!0;if(a){if(!f.line)return b(0);f=
c(f.line-1,this.doc.getLine(f.line-1).length)}else{var n=this.doc.lineCount();if(f.line==n-1)return b(n);f=c(f.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(b){this.atOccurrence&&(b=a.splitLines(b),this.doc.replaceRange(b,this.pos.from,this.pos.to),this.pos.to=c(this.pos.from.line+b.length-1,b[b.length-1].length+(1==b.length?this.pos.from.ch:0)))}};a.defineExtension("getSearchCursor",function(a,c,d){return new b(this.doc,
a,c,d)});a.defineDocExtension("getSearchCursor",function(a,c,d){return new b(this,a,c,d)});a.defineExtension("selectMatches",function(b,c){var d=[];for(b=this.getSearchCursor(b,this.getCursor("from"),c);b.findNext()&&!(0<a.cmpPos(b.to(),this.getCursor("to")));)d.push({anchor:b.from(),head:b.to()});d.length&&this.setSelections(d,0)})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require(app.baseUrl+"js/codemirror-editor/lib/codemirror")):"function"==typeof define&&define.amd?define([app.baseUrl+"js/codemirror-editor/lib/codemirror"],a):a(CodeMirror)})(function(a){function b(a){"object"==typeof a&&(this.minChars=a.minChars,this.style=a.style,this.showToken=a.showToken,this.delay=a.delay);null==this.style&&(this.style="matchhighlight");null==this.minChars&&(this.minChars=2);null==this.delay&&(this.delay=100);
this.overlay=this.timeout=null}function d(a){var b=a.state.matchHighlighter;clearTimeout(b.timeout);b.timeout=setTimeout(function(){c(a)},b.delay)}function c(a){a.operation(function(){var b=a.state.matchHighlighter;b.overlay&&(a.removeOverlay(b.overlay),b.overlay=null);if(!a.somethingSelected()&&b.showToken){for(var c=!0===b.showToken?/[\w$]/:b.showToken,d=a.getCursor(),g=a.getLine(d.line),e=d=d.ch;d&&c.test(g.charAt(d-1));)--d;for(;e<g.length&&c.test(g.charAt(e));)++e;d<e&&a.addOverlay(b.overlay=
f(g.slice(d,e),c,b.style))}else c=a.getCursor("from"),g=a.getCursor("to"),c.line==g.line&&(c=a.getRange(c,g).replace(/^\s+|\s+$/g,""),c.length>=b.minChars&&a.addOverlay(b.overlay=f(c,!1,b.style)))})}function f(a,b,c){return{token:function(d){var f;if(f=d.match(a))(f=!b)||(f=(!d.start||!b.test(d.string.charAt(d.start-1)))&&(d.pos==d.string.length||!b.test(d.string.charAt(d.pos))));if(f)return c;d.next();d.skipTo(a.charAt(0))||d.skipToEnd()}}}a.defineOption("highlightSelectionMatches",!1,function(f,
m,l){l&&l!=a.Init&&((l=f.state.matchHighlighter.overlay)&&f.removeOverlay(l),clearTimeout(f.state.matchHighlighter.timeout),f.state.matchHighlighter=null,f.off("cursorActivity",d));m&&(f.state.matchHighlighter=new b(m),c(f),f.on("cursorActivity",d))})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require(app.baseUrl+"js/codemirror-editor/lib/codemirror")):"function"==typeof define&&define.amd?define([app.baseUrl+"js/codemirror-editor/lib/codemirror"],a):a(CodeMirror)})(function(a){function b(a,b){a=a.getRange(m(b.line,b.ch-1),m(b.line,b.ch+1));return 2==a.length?a:null}function d(b,c,d){var e=b.getLine(c.line),f=b.getTokenAt(c);if(/\bstring2?\b/.test(f.type))return!1;d=new a.StringStream(e.slice(0,c.ch)+d+e.slice(c.ch),4);for(d.pos=
d.start=f.start;;){e=b.getMode().token(d,f.state);if(d.pos>=c.ch+1)return/\bstring2?\b/.test(e);d.start=d.pos}}function c(c){for(var f={name:"autoCloseBrackets",Backspace:function(d){if(d.getOption("disableInput"))return a.Pass;for(var e=d.listSelections(),f=0;f<e.length;f++){if(!e[f].empty())return a.Pass;var g=b(d,e[f].head);if(!g||0!=c.indexOf(g)%2)return a.Pass}for(f=e.length-1;0<=f;f--)g=e[f].head,d.replaceRange("",m(g.line,g.ch-1),m(g.line,g.ch+1))}},l="",e=0;e<c.length;e+=2)(function(b,c){b!=
c&&(l+=c);f["'"+b+"'"]=function(e){if(e.getOption("disableInput"))return a.Pass;for(var f=e.listSelections(),n,p,q=0;q<f.length;q++){var t=f[q],w=t.head;p=e.getRange(w,m(w.line,w.ch+1));if(t.empty())if(b==c&&p==c)p=e.getRange(w,m(w.line,w.ch+3))==b+b+b?"skipThree":"skip";else if(b==c&&1<w.ch&&e.getRange(m(w.line,w.ch-2),w)==b+b&&(2>=w.ch||e.getRange(m(w.line,w.ch-3),m(w.line,w.ch-2))!=b))p="addFour";else if('"'==b||"'"==b)if(!a.isWordChar(p)&&d(e,w,b))p="both";else return a.Pass;else if(e.getLine(w.line).length==
w.ch||0<=l.indexOf(p)||g.test(p))p="both";else return a.Pass;else p="surround";if(!n)n=p;else if(n!=p)return a.Pass}e.operation(function(){if("skip"==n)e.execCommand("goCharRight");else if("skipThree"==n)for(var a=0;3>a;a++)e.execCommand("goCharRight");else if("surround"==n){var d=e.getSelections();for(a=0;a<d.length;a++)d[a]=b+d[a]+c;e.replaceSelections(d,"around")}else"both"==n?(e.replaceSelection(b+c,null),e.execCommand("goCharLeft")):"addFour"==n&&(e.replaceSelection(b+b+b+b,"before"),e.execCommand("goCharRight"))})};
b!=c&&(f["'"+c+"'"]=function(b){for(var d=b.listSelections(),e=0;e<d.length;e++){var f=d[e];if(!f.empty()||b.getRange(f.head,m(f.head.line,f.head.ch+1))!=c)return a.Pass}b.execCommand("goCharRight")})})(c.charAt(e),c.charAt(e+1));return f}function f(c){return function(d){if(d.getOption("disableInput"))return a.Pass;for(var f=d.listSelections(),e=0;e<f.length;e++){if(!f[e].empty())return a.Pass;var g=b(d,f[e].head);if(!g||0!=c.indexOf(g)%2)return a.Pass}d.operation(function(){d.replaceSelection("\n\n",
null);d.execCommand("goCharLeft");f=d.listSelections();for(var a=0;a<f.length;a++){var b=f[a].head.line;d.indentLine(b,null,!0);d.indentLine(b+1,null,!0)}})}}var g=/\s/,m=a.Pos;a.defineOption("autoCloseBrackets",!1,function(b,d,g){g!=a.Init&&g&&b.removeKeyMap("autoCloseBrackets");if(d){var e="()[]{}''\"\"";g="[]{}";"string"==typeof d?e=d:"object"==typeof d&&(null!=d.pairs&&(e=d.pairs),null!=d.explode&&(g=d.explode));d=c(e);g&&(d.Enter=f(g));b.addKeyMap(d)}})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})(function(a){function b(a,b,c,f){var e=a.getLineHandle(b.line),g=b.ch-1;e=0<=g&&l[e.text.charAt(g)]||l[e.text.charAt(++g)];if(!e)return null;var n=">"==e.charAt(1)?1:-1;if(c&&0<n!=(g==b.ch))return null;c=a.getTokenTypeAt(m(b.line,g+1));a=d(a,m(b.line,g+(0<n?1:0)),n,c||null,f);return null==a?null:{from:m(b.line,g),
to:a&&a.pos,match:a&&a.ch==e.charAt(0),forward:0<n}}function d(a,b,c,d,f){var e=f&&f.maxScanLineLength||1E4,g=f&&f.maxScanLines||1E3,n=[];f=f&&f.bracketRegex?f.bracketRegex:/[(){}[\]]/;g=0<c?Math.min(b.line+g,a.lastLine()+1):Math.max(a.firstLine()-1,b.line-g);for(var p=b.line;p!=g;p+=c){var q=a.getLine(p);if(q){var t=0<c?0:q.length-1,w=0<c?q.length:-1;if(!(q.length>e))for(p==b.line&&(t=b.ch-(0>c?1:0));t!=w;t+=c){var L=q.charAt(t);if(f.test(L)&&(void 0===d||a.getTokenTypeAt(m(p,t+1))==d))if(">"==l[L].charAt(1)==
0<c)n.push(L);else if(n.length)n.pop();else return{pos:m(p,t),ch:L}}}}return p-c==(0<c?a.lastLine():a.firstLine())?!1:null}function c(a,c,d){for(var e=a.state.matchBrackets.maxHighlightLineLength||1E3,f=[],l=a.listSelections(),n=0;n<l.length;n++){var p=l[n].empty()&&b(a,l[n].head,!1,d);if(p&&a.getLine(p.from.line).length<=e){var q=p.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";f.push(a.markText(p.from,m(p.from.line,p.from.ch+1),{className:q}));p.to&&a.getLine(p.to.line).length<=
e&&f.push(a.markText(p.to,m(p.to.line,p.to.ch+1),{className:q}))}}if(f.length)if(g&&a.state.focused&&a.display.input.focus(),d=function(){a.operation(function(){for(var a=0;a<f.length;a++)f[a].clear()})},c)setTimeout(d,800);else return d}function f(a){a.operation(function(){n&&(n(),n=null);n=c(a,!1,a.state.matchBrackets)})}var g=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||8>document.documentMode),m=a.Pos,l={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},n=null;a.defineOption("matchBrackets",
!1,function(b,c,d){d&&d!=a.Init&&b.off("cursorActivity",f);c&&(b.state.matchBrackets="object"==typeof c?c:{},b.on("cursorActivity",f))});a.defineExtension("matchBrackets",function(){c(this,!0)});a.defineExtension("findMatchingBracket",function(a,c,d){return b(this,a,c,d)});a.defineExtension("scanForBracket",function(a,b,c,f){return d(this,a,b,c,f)})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require(app.baseUrl+"js/codemirror-editor/lib/codemirror")):"function"==typeof define&&define.amd?define([app.baseUrl+"js/codemirror-editor/lib/codemirror"],a):a(CodeMirror)})(function(a){a.overlayMode=function(b,d,c){return{startState:function(){return{base:a.startState(b),overlay:a.startState(d),basePos:0,baseCur:null,overlayPos:0,overlayCur:null,lineSeen:null}},copyState:function(c){return{base:a.copyState(b,c.base),overlay:a.copyState(d,
c.overlay),basePos:c.basePos,baseCur:null,overlayPos:c.overlayPos,overlayCur:null}},token:function(a,g){if(a.sol()||a.string!=g.lineSeen||Math.min(g.basePos,g.overlayPos)<a.start)g.lineSeen=a.string,g.basePos=g.overlayPos=a.start;a.start==g.basePos&&(g.baseCur=b.token(a,g.base),g.basePos=a.pos);a.start==g.overlayPos&&(a.pos=a.start,g.overlayCur=d.token(a,g.overlay),g.overlayPos=a.pos);a.pos=Math.min(g.basePos,g.overlayPos);return null==g.overlayCur?g.baseCur:null!=g.baseCur&&g.overlay.combineTokens||
c&&null==g.overlay.combineTokens?g.baseCur+" "+g.overlayCur:g.overlayCur},indent:b.indent&&function(a,c){return b.indent(a.base,c)},electricChars:b.electricChars,innerMode:function(a){return{state:a.base,mode:b}},blankLine:function(a){b.blankLine&&b.blankLine(a.base);d.blankLine&&d.blankLine(a.overlay)}}}});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require(app.baseUrl+"js/codemirror-editor/lib/codemirror")):"function"==typeof define&&define.amd?define([app.baseUrl+"js/codemirror-editor/lib/codemirror"],a):a(CodeMirror)})(function(a){function b(a){for(var b={},c=0;c<a.length;++c)b[a[c]]=!0;return b}function d(a,b){for(var c=!1,d;null!=(d=a.next());){if(c&&"/"==d){b.tokenize=null;break}c="*"==d}return["comment","comment"]}function c(a,b){a.skipTo("--\x3e")?(a.match("--\x3e"),b.tokenize=
null):a.skipToEnd();return["comment","comment"]}a.defineMode("css",function(b,c){function d(a,b){X=b;return a}function e(a,b){var c=a.next();if(w[c]){var e=w[c](a,b);if(!1!==e)return e}if("@"==c)return a.eatWhile(/[\w\\\-]/),d("def",a.current());if("="==c||("~"==c||"|"==c)&&a.eat("="))return d(null,"compare");if('"'==c||"'"==c)return b.tokenize=f(c),b.tokenize(a,b);if("#"==c)return a.eatWhile(/[\w\\\-]/),d("atom","hash");if("!"==c)return a.match(/^\s*\w*/),d("keyword","important");if(/\d/.test(c)||
"."==c&&a.eat(/\d/))return a.eatWhile(/[\w.%]/),d("number","unit");if("-"===c){if(/[\d.]/.test(a.peek()))return a.eatWhile(/[\w.%]/),d("number","unit");if(a.match(/^\w+-/))return d("meta","meta")}else return/[,+>*\/]/.test(c)?d(null,"select-op"):"."==c&&a.match(/^-?[_a-z][_a-z0-9-]*/i)?d("qualifier","qualifier"):/[:;{}\[\]\(\)]/.test(c)?d(null,c):"u"==c&&a.match("rl(")?(a.backUp(1),b.tokenize=g,d("property","word")):/[\w\\\-]/.test(c)?(a.eatWhile(/[\w\\\-]/),d("property","word")):d(null,null)}function f(a){return function(b,
c){for(var e=!1,f;null!=(f=b.next());){if(f==a&&!e){")"==a&&b.backUp(1);break}e=!e&&"\\"==f}if(f==a||!e&&")"!=a)c.tokenize=null;return d("string","string")}}function g(a,b){a.next();a.match(/\s*[\"\')]/,!1)?b.tokenize=null:b.tokenize=f(")");return d(null,"(")}function l(a,b,c){this.type=a;this.indent=b;this.prev=c}function m(a,b,c){a.context=new l(c,b.indentation()+t,a.context);return c}function n(a){a.context=a.context.prev;return a.context.type}function p(a,b,c,d){for(d=d||1;0<d;d--)c.context=c.context.prev;
return sa[c.context.type](a,b,c)}function q(a){a=a.current().toLowerCase();I=H.hasOwnProperty(a)?"atom":K.hasOwnProperty(a)?"keyword":"variable"}c.propertyKeywords||(c=a.resolveMode("text/css"));var t=b.indentUnit,w=c.tokenHooks,x=c.mediaTypes||{},A=c.mediaFeatures||{},y=c.propertyKeywords||{},z=c.nonStandardPropertyKeywords||{},K=c.colorKeywords||{},H=c.valueKeywords||{},E=c.fontProperties||{},D=c.allowNested,X,I,sa={top:function(a,b,c){if("{"==a)return m(c,b,"block");if("}"==a&&c.context.prev)return n(c);
if("@media"==a)return m(c,b,"media");if("@font-face"==a)return"font_face_before";if(/^@(-(moz|ms|o|webkit)-)?keyframes$/.test(a))return"keyframes";if(a&&"@"==a.charAt(0))return m(c,b,"at");if("hash"==a)I="builtin";else if("word"==a)I="tag";else{if("variable-definition"==a)return"maybeprop";if("interpolation"==a)return m(c,b,"interpolation");if(":"==a)return"pseudo";if(D&&"("==a)return m(c,b,"parens")}return c.context.type},block:function(a,b,c){if("word"==a){a=b.current().toLowerCase();if(y.hasOwnProperty(a))return I=
"property","maybeprop";if(z.hasOwnProperty(a))return I="string-2","maybeprop";if(D)return I=b.match(/^\s*:/,!1)?"property":"tag","block";I+=" error";return"maybeprop"}if("meta"==a)return"block";if(D||"hash"!=a&&"qualifier"!=a)return sa.top(a,b,c);I="error";return"block"},maybeprop:function(a,b,c){return":"==a?m(c,b,"prop"):sa[c.context.type](a,b,c)},prop:function(a,b,c){if(";"==a)return n(c);if("{"==a&&D)return m(c,b,"propBlock");if("}"==a||"{"==a)return p(a,b,c);if("("==a)return m(c,b,"parens");
if("hash"==a&&!/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(b.current()))I+=" error";else if("word"==a)q(b);else if("interpolation"==a)return m(c,b,"interpolation");return"prop"},propBlock:function(a,b,c){return"}"==a?n(c):"word"==a?(I="property","maybeprop"):c.context.type},parens:function(a,b,c){if("{"==a||"}"==a)return p(a,b,c);if(")"==a)return n(c);if("("==a)return m(c,b,"parens");"word"==a&&q(b);return"parens"},pseudo:function(a,b,c){return"word"==a?(I="variable-3",c.context.type):sa[c.context.type](a,
b,c)},media:function(a,b,c){if("("==a)return m(c,b,"media_parens");if("}"==a)return p(a,b,c);if("{"==a)return n(c)&&m(c,b,D?"block":"top");"word"==a&&(a=b.current().toLowerCase(),I="only"==a||"not"==a||"and"==a?"keyword":x.hasOwnProperty(a)?"attribute":A.hasOwnProperty(a)?"property":"error");return c.context.type},media_parens:function(a,b,c){return")"==a?n(c):"{"==a||"}"==a?p(a,b,c,2):sa.media(a,b,c)},font_face_before:function(a,b,c){return"{"==a?m(c,b,"font_face"):sa[c.context.type](a,b,c)},font_face:function(a,
b,c){return"}"==a?n(c):"word"==a?(I=E.hasOwnProperty(b.current().toLowerCase())?"property":"error","maybeprop"):"font_face"},keyframes:function(a,b,c){return"word"==a?(I="variable","keyframes"):"{"==a?m(c,b,"top"):sa[c.context.type](a,b,c)},at:function(a,b,c){if(";"==a)return n(c);if("{"==a||"}"==a)return p(a,b,c);"word"==a?I="tag":"hash"==a&&(I="builtin");return"at"},interpolation:function(a,b,c){if("}"==a)return n(c);if("{"==a||";"==a)return p(a,b,c);"variable"!=a&&(I="error");return"interpolation"}};
return{startState:function(a){return{tokenize:null,state:"top",context:new l("top",a||0,null)}},token:function(a,b){if(!b.tokenize&&a.eatSpace())return null;var c=(b.tokenize||e)(a,b);c&&"object"==typeof c&&(X=c[1],c=c[0]);I=c;b.state=sa[b.state](X,a,b);return I},indent:function(a,b){a=a.context;b=b&&b.charAt(0);var c=a.indent;"prop"!=a.type||"}"!=b&&")"!=b||(a=a.prev);!a.prev||("}"!=b||"block"!=a.type&&"top"!=a.type&&"interpolation"!=a.type&&"font_face"!=a.type)&&(")"!=b||"parens"!=a.type&&"media_parens"!=
a.type)&&("{"!=b||"at"!=a.type&&"media"!=a.type)||(c=a.indent-t);return c},electricChars:"}",blockCommentStart:"/*",blockCommentEnd:"*/",fold:"brace"}});var f="all aural braille handheld print projection screen tty tv embossed".split(" "),g=b(f),m="width min-width max-width height min-height max-height device-width min-device-width max-device-width device-height min-device-height max-device-height aspect-ratio min-aspect-ratio max-aspect-ratio device-aspect-ratio min-device-aspect-ratio max-device-aspect-ratio color min-color max-color color-index min-color-index max-color-index monochrome min-monochrome max-monochrome resolution min-resolution max-resolution scan grid".split(" "),
l=b(m),n="align-content align-items align-self alignment-adjust alignment-baseline anchor-point animation animation-delay animation-direction animation-duration animation-fill-mode animation-iteration-count animation-name animation-play-state animation-timing-function appearance azimuth backface-visibility background background-attachment background-clip background-color background-image background-origin background-position background-repeat background-size baseline-shift binding bleed bookmark-label bookmark-level bookmark-state bookmark-target border border-bottom border-bottom-color border-bottom-left-radius border-bottom-right-radius border-bottom-style border-bottom-width border-collapse border-color border-image border-image-outset border-image-repeat border-image-slice border-image-source border-image-width border-left border-left-color border-left-style border-left-width border-radius border-right border-right-color border-right-style border-right-width border-spacing border-style border-top border-top-color border-top-left-radius border-top-right-radius border-top-style border-top-width border-width bottom box-decoration-break box-shadow box-sizing break-after break-before break-inside caption-side clear clip color color-profile column-count column-fill column-gap column-rule column-rule-color column-rule-style column-rule-width column-span column-width columns content counter-increment counter-reset crop cue cue-after cue-before cursor direction display dominant-baseline drop-initial-after-adjust drop-initial-after-align drop-initial-before-adjust drop-initial-before-align drop-initial-size drop-initial-value elevation empty-cells fit fit-position flex flex-basis flex-direction flex-flow flex-grow flex-shrink flex-wrap float float-offset flow-from flow-into font font-feature-settings font-family font-kerning font-language-override font-size font-size-adjust font-stretch font-style font-synthesis font-variant font-variant-alternates font-variant-caps font-variant-east-asian font-variant-ligatures font-variant-numeric font-variant-position font-weight grid grid-area grid-auto-columns grid-auto-flow grid-auto-position grid-auto-rows grid-column grid-column-end grid-column-start grid-row grid-row-end grid-row-start grid-template grid-template-areas grid-template-columns grid-template-rows hanging-punctuation height hyphens icon image-orientation image-rendering image-resolution inline-box-align justify-content left letter-spacing line-break line-height line-stacking line-stacking-ruby line-stacking-shift line-stacking-strategy list-style list-style-image list-style-position list-style-type margin margin-bottom margin-left margin-right margin-top marker-offset marks marquee-direction marquee-loop marquee-play-count marquee-speed marquee-style max-height max-width min-height min-width move-to nav-down nav-index nav-left nav-right nav-up object-fit object-position opacity order orphans outline outline-color outline-offset outline-style outline-width overflow overflow-style overflow-wrap overflow-x overflow-y padding padding-bottom padding-left padding-right padding-top page page-break-after page-break-before page-break-inside page-policy pause pause-after pause-before perspective perspective-origin pitch pitch-range play-during position presentation-level punctuation-trim quotes region-break-after region-break-before region-break-inside region-fragment rendering-intent resize rest rest-after rest-before richness right rotation rotation-point ruby-align ruby-overhang ruby-position ruby-span shape-image-threshold shape-inside shape-margin shape-outside size speak speak-as speak-header speak-numeral speak-punctuation speech-rate stress string-set tab-size table-layout target target-name target-new target-position text-align text-align-last text-decoration text-decoration-color text-decoration-line text-decoration-skip text-decoration-style text-emphasis text-emphasis-color text-emphasis-position text-emphasis-style text-height text-indent text-justify text-outline text-overflow text-shadow text-size-adjust text-space-collapse text-transform text-underline-position text-wrap top transform transform-origin transform-style transition transition-delay transition-duration transition-property transition-timing-function unicode-bidi vertical-align visibility voice-balance voice-duration voice-family voice-pitch voice-range voice-rate voice-stress voice-volume volume white-space widows width word-break word-spacing word-wrap z-index clip-path clip-rule mask enable-background filter flood-color flood-opacity lighting-color stop-color stop-opacity pointer-events color-interpolation color-interpolation-filters color-rendering fill fill-opacity fill-rule image-rendering marker marker-end marker-mid marker-start shape-rendering stroke stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-rendering baseline-shift dominant-baseline glyph-orientation-horizontal glyph-orientation-vertical text-anchor writing-mode".split(" "),
q=b(n),e="scrollbar-arrow-color scrollbar-base-color scrollbar-dark-shadow-color scrollbar-face-color scrollbar-highlight-color scrollbar-shadow-color scrollbar-3d-light-color scrollbar-track-color shape-inside searchfield-cancel-button searchfield-decoration searchfield-results-button searchfield-results-decoration zoom".split(" "),p=b(e),t="aliceblue antiquewhite aqua aquamarine azure beige bisque black blanchedalmond blue blueviolet brown burlywood cadetblue chartreuse chocolate coral cornflowerblue cornsilk crimson cyan darkblue darkcyan darkgoldenrod darkgray darkgreen darkkhaki darkmagenta darkolivegreen darkorange darkorchid darkred darksalmon darkseagreen darkslateblue darkslategray darkturquoise darkviolet deeppink deepskyblue dimgray dodgerblue firebrick floralwhite forestgreen fuchsia gainsboro ghostwhite gold goldenrod gray grey green greenyellow honeydew hotpink indianred indigo ivory khaki lavender lavenderblush lawngreen lemonchiffon lightblue lightcoral lightcyan lightgoldenrodyellow lightgray lightgreen lightpink lightsalmon lightseagreen lightskyblue lightslategray lightsteelblue lightyellow lime limegreen linen magenta maroon mediumaquamarine mediumblue mediumorchid mediumpurple mediumseagreen mediumslateblue mediumspringgreen mediumturquoise mediumvioletred midnightblue mintcream mistyrose moccasin navajowhite navy oldlace olive olivedrab orange orangered orchid palegoldenrod palegreen paleturquoise palevioletred papayawhip peachpuff peru pink plum powderblue purple rebeccapurple red rosybrown royalblue saddlebrown salmon sandybrown seagreen seashell sienna silver skyblue slateblue slategray snow springgreen steelblue tan teal thistle tomato turquoise violet wheat white whitesmoke yellow yellowgreen".split(" "),
w=b(t),y="above absolute activeborder activecaption afar after-white-space ahead alias all all-scroll alternate always amharic amharic-abegede antialiased appworkspace arabic-indic armenian asterisks auto avoid avoid-column avoid-page avoid-region background backwards baseline below bidi-override binary bengali blink block block-axis bold bolder border border-box both bottom break break-all break-word button button-bevel buttonface buttonhighlight buttonshadow buttontext cambodian capitalize caps-lock-indicator caption captiontext caret cell center checkbox circle cjk-earthly-branch cjk-heavenly-stem cjk-ideographic clear clip close-quote col-resize collapse column compact condensed contain content content-box context-menu continuous copy cover crop cross crosshair currentcolor cursive dashed decimal decimal-leading-zero default default-button destination-atop destination-in destination-out destination-over devanagari disc discard document dot-dash dot-dot-dash dotted double down e-resize ease ease-in ease-in-out ease-out element ellipse ellipsis embed end ethiopic ethiopic-abegede ethiopic-abegede-am-et ethiopic-abegede-gez ethiopic-abegede-ti-er ethiopic-abegede-ti-et ethiopic-halehame-aa-er ethiopic-halehame-aa-et ethiopic-halehame-am-et ethiopic-halehame-gez ethiopic-halehame-om-et ethiopic-halehame-sid-et ethiopic-halehame-so-et ethiopic-halehame-ti-er ethiopic-halehame-ti-et ethiopic-halehame-tig ew-resize expanded extra-condensed extra-expanded fantasy fast fill fixed flat footnotes forwards from geometricPrecision georgian graytext groove gujarati gurmukhi hand hangul hangul-consonant hebrew help hidden hide higher highlight highlighttext hiragana hiragana-iroha horizontal hsl hsla icon ignore inactiveborder inactivecaption inactivecaptiontext infinite infobackground infotext inherit initial inline inline-axis inline-block inline-table inset inside intrinsic invert italic justify kannada katakana katakana-iroha keep-all khmer landscape lao large larger left level lighter line-through linear lines list-item listbox listitem local logical loud lower lower-alpha lower-armenian lower-greek lower-hexadecimal lower-latin lower-norwegian lower-roman lowercase ltr malayalam match media-controls-background media-current-time-display media-fullscreen-button media-mute-button media-play-button media-return-to-realtime-button media-rewind-button media-seek-back-button media-seek-forward-button media-slider media-sliderthumb media-time-remaining-display media-volume-slider media-volume-slider-container media-volume-sliderthumb medium menu menulist menulist-button menulist-text menulist-textfield menutext message-box middle min-intrinsic mix mongolian monospace move multiple myanmar n-resize narrower ne-resize nesw-resize no-close-quote no-drop no-open-quote no-repeat none normal not-allowed nowrap ns-resize nw-resize nwse-resize oblique octal open-quote optimizeLegibility optimizeSpeed oriya oromo outset outside outside-shape overlay overline padding padding-box painted page paused persian plus-darker plus-lighter pointer polygon portrait pre pre-line pre-wrap preserve-3d progress push-button radio read-only read-write read-write-plaintext-only rectangle region relative repeat repeat-x repeat-y reset reverse rgb rgba ridge right round row-resize rtl run-in running s-resize sans-serif scroll scrollbar se-resize searchfield searchfield-cancel-button searchfield-decoration searchfield-results-button searchfield-results-decoration semi-condensed semi-expanded separate serif show sidama single skip-white-space slide slider-horizontal slider-vertical sliderthumb-horizontal sliderthumb-vertical slow small small-caps small-caption smaller solid somali source-atop source-in source-out source-over space square square-button start static status-bar stretch stroke sub subpixel-antialiased super sw-resize table table-caption table-cell table-column table-column-group table-footer-group table-header-group table-row table-row-group telugu text text-bottom text-top textarea textfield thai thick thin threeddarkshadow threedface threedhighlight threedlightshadow threedshadow tibetan tigre tigrinya-er tigrinya-er-abegede tigrinya-et tigrinya-et-abegede to top transparent ultra-condensed ultra-expanded underline up upper-alpha upper-armenian upper-greek upper-hexadecimal upper-latin upper-norwegian upper-roman uppercase urdu url vertical vertical-text visible visibleFill visiblePainted visibleStroke visual w-resize wait wave wider window windowframe windowtext x-large x-small xor xx-large xx-small".split(" "),
A=b(y),x=b("font-family src unicode-range font-variant font-feature-settings font-stretch font-weight font-style".split(" "));f=f.concat(m).concat(n).concat(e).concat(t).concat(y);a.registerHelper("hintWords","css",f);a.defineMIME("text/css",{mediaTypes:g,mediaFeatures:l,propertyKeywords:q,nonStandardPropertyKeywords:p,colorKeywords:w,valueKeywords:A,fontProperties:x,tokenHooks:{"<":function(a,b){if(!a.match("!--"))return!1;b.tokenize=c;return c(a,b)},"/":function(a,b){if(!a.eat("*"))return!1;b.tokenize=
d;return d(a,b)}},name:"css"});a.defineMIME("text/x-scss",{mediaTypes:g,mediaFeatures:l,propertyKeywords:q,nonStandardPropertyKeywords:p,colorKeywords:w,valueKeywords:A,fontProperties:x,allowNested:!0,tokenHooks:{"/":function(a,b){return a.eat("/")?(a.skipToEnd(),["comment","comment"]):a.eat("*")?(b.tokenize=d,d(a,b)):["operator","operator"]},":":function(a){return a.match(/\s*\{/)?[null,"{"]:!1},$:function(a){a.match(/^[\w-]+/);return a.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2",
"variable"]},"#":function(a){return a.eat("{")?[null,"interpolation"]:!1}},name:"css",helperType:"scss"});a.defineMIME("text/x-less",{mediaTypes:g,mediaFeatures:l,propertyKeywords:q,nonStandardPropertyKeywords:p,colorKeywords:w,valueKeywords:A,fontProperties:x,allowNested:!0,tokenHooks:{"/":function(a,b){return a.eat("/")?(a.skipToEnd(),["comment","comment"]):a.eat("*")?(b.tokenize=d,d(a,b)):["operator","operator"]},"@":function(a){if(a.match(/^(charset|document|font-face|import|(-(moz|ms|o|webkit)-)?keyframes|media|namespace|page|supports)\b/,
!1))return!1;a.eatWhile(/[\w\\\-]/);return a.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"]},"&":function(){return["atom","atom"]}},name:"css",helperType:"less"})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require(app.baseUrl+"js/codemirror-editor/lib/codemirror")):"function"==typeof define&&define.amd?define([app.baseUrl+"js/codemirror-editor/lib/codemirror"],a):a(CodeMirror)})(function(a){a.defineMode("javascript",function(b,d){function c(a,b,c){gb=a;Ha=c;return b}function f(a,b){var d=a.next();if('"'==d||"'"==d)return b.tokenize=g(d),b.tokenize(a,b);if("."==d&&a.match(/^\d+(?:[eE][+\-]?\d+)?/))return c("number","number");if("."==d&&
a.match(".."))return c("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(d))return c(d);if("="==d&&a.eat(">"))return c("=>","operator");if("0"==d&&a.eat(/x/i))return a.eatWhile(/[\da-f]/i),c("number","number");if(/\d/.test(d))return a.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),c("number","number");if("/"==d){if(a.eat("*"))return b.tokenize=m,m(a,b);if(a.eat("/"))return a.skipToEnd(),c("comment","comment");if("operator"==b.lastType||"keyword c"==b.lastType||"sof"==b.lastType||/^[\[{}\(,;:]$/.test(b.lastType)){a:for(var e=
b=!1;null!=(d=a.next());){if(!b){if("/"==d&&!e)break a;"["==d?e=!0:e&&"]"==d&&(e=!1)}b=!b&&"\\"==d}a.eatWhile(/[gimy]/);return c("regexp","string-2")}a.eatWhile(nb);return c("operator","operator",a.current())}if("`"==d)return b.tokenize=l,l(a,b);if("#"==d)return a.skipToEnd(),c("error","error");if(nb.test(d))return a.eatWhile(nb),c("operator","operator",a.current());if(jb.test(d))return a.eatWhile(jb),a=a.current(),(d=qb.propertyIsEnumerable(a)&&qb[a])&&"."!=b.lastType?c(d.type,d.style,a):c("variable",
"variable",a)}function g(a){return function(b,d){var e=!1,g;if(La&&"@"==b.peek()&&b.match(Ob))return d.tokenize=f,c("jsonld-keyword","meta");for(;null!=(g=b.next())&&(g!=a||e);)e=!e&&"\\"==g;e||(d.tokenize=f);return c("string","string")}}function m(a,b){for(var d=!1,e;e=a.next();){if("/"==e&&d){b.tokenize=f;break}d="*"==e}return c("comment","comment")}function l(a,b){for(var d=!1,e;null!=(e=a.next());){if(!d&&("`"==e||"$"==e&&a.eat("{"))){b.tokenize=f;break}d=!d&&"\\"==e}return c("quasi","string-2",
a.current())}function n(a,b){b.fatArrowAt&&(b.fatArrowAt=null);var c=a.string.indexOf("=>",a.start);if(!(0>c)){var d=0,e=!1;for(--c;0<=c;--c){var f=a.string.charAt(c),g="([{}])".indexOf(f);if(0<=g&&3>g){if(!d){++c;break}if(0==--d)break}else if(3<=g&&6>g)++d;else if(jb.test(f))e=!0;else if(e&&!d){++c;break}}e&&!d&&(b.fatArrowAt=c)}}function q(a,b,c,d,e,f){this.indented=a;this.column=b;this.type=c;this.prev=e;this.info=f;null!=d&&(this.align=d)}function e(){for(var a=arguments.length-1;0<=a;a--)aa.cc.push(arguments[a])}
function p(){e.apply(null,arguments);return!0}function t(a){function b(b){for(;b;b=b.next)if(b.name==a)return!0;return!1}var c=aa.state;c.context?(aa.marked="def",b(c.localVars)||(c.localVars={name:a,next:c.localVars})):!b(c.globalVars)&&d.globalVars&&(c.globalVars={name:a,next:c.globalVars})}function w(){aa.state.context={prev:aa.state.context,vars:aa.state.localVars};aa.state.localVars=ub}function y(){aa.state.localVars=aa.state.context.vars;aa.state.context=aa.state.context.prev}function A(a,b){var c=
function(){var c=aa.state,d=c.indented;if("stat"==c.lexical.type)d=c.lexical.indented;else for(var e=c.lexical;e&&")"==e.type&&e.align;e=e.prev)d=e.indented;c.lexical=new q(d,aa.stream.column(),a,null,c.lexical,b)};c.lex=!0;return c}function x(){var a=aa.state;a.lexical.prev&&(")"==a.lexical.type&&(a.indented=a.lexical.indented),a.lexical=a.lexical.prev)}function z(a){function b(c){return c==a?p():";"==a?e():p(b)}return b}function D(a,b){return"var"==a?p(A("vardef",b.length),sa,z(";"),x):"keyword a"==
a?p(A("form"),B,D,x):"keyword b"==a?p(A("form"),D,x):"{"==a?p(A("}"),ra,x):";"==a?p():"if"==a?("else"==aa.state.lexical.info&&aa.state.cc[aa.state.cc.length-1]==x&&aa.state.cc.pop()(),p(A("form"),B,D,x,C)):"function"==a?p(qa):"for"==a?p(A("form"),W,D,x):"variable"==a?p(A("stat"),pa):"switch"==a?p(A("form"),B,A("}","switch"),z("{"),ra,x,x):"case"==a?p(B,z(":")):"default"==a?p(z(":")):"catch"==a?p(A("form"),w,z("("),Ua,z(")"),D,x,y):"module"==a?p(A("form"),w,ia,y,x):"class"==a?p(A("form"),Ca,x):"export"==
a?p(A("form"),Ka,x):"import"==a?p(A("form"),ab,x):e(A("stat"),B,z(";"),x)}function B(a){return L(a,!1)}function G(a){return L(a,!0)}function L(a,b){if(aa.state.fatArrowAt==aa.stream.start){var c=b?Y:ea;if("("==a)return p(w,A(")"),H(ma,")"),x,z("=>"),c,y);if("variable"==a)return e(w,ma,z("=>"),c,y)}c=b?da:fa;return Wa.hasOwnProperty(a)?p(c):"function"==a?p(qa,c):"keyword c"==a?p(b?P:J):"("==a?p(A(")"),J,Ea,z(")"),x,c):"operator"==a||"spread"==a?p(b?G:B):"["==a?p(A("]"),ya,x,c):"{"==a?E(Z,"}",null,
c):"quasi"==a?e(M,c):p()}function J(a){return a.match(/[;\}\)\],]/)?e():e(B)}function P(a){return a.match(/[;\}\)\],]/)?e():e(G)}function fa(a,b){return","==a?p(B):da(a,b,!1)}function da(a,b,c){var d=0==c?fa:da,f=0==c?B:G;if("=>"==b)return p(w,c?Y:ea,y);if("operator"==a)return/\+\+|--/.test(b)?p(d):"?"==b?p(B,z(":"),f):p(f);if("quasi"==a)return e(M,d);if(";"!=a){if("("==a)return E(G,")","call",d);if("."==a)return p(N,d);if("["==a)return p(A("]"),J,z("]"),x,d)}}function M(a,b){return"quasi"!=a?e():
"${"!=b.slice(b.length-2)?p(M):p(B,V)}function V(a){if("}"==a)return aa.marked="string-2",aa.state.tokenize=l,p(M)}function ea(a){n(aa.stream,aa.state);return"{"==a?e(D):e(B)}function Y(a){n(aa.stream,aa.state);return"{"==a?e(D):e(G)}function pa(a){return":"==a?p(x,D):e(fa,z(";"),x)}function N(a){if("variable"==a)return aa.marked="property",p()}function Z(a,b){if("variable"==a||"keyword"==aa.style)return aa.marked="property","get"==b||"set"==b?p(S):p(K);if("number"==a||"string"==a)return aa.marked=
La?"property":aa.style+" property",p(K);if("jsonld-keyword"==a)return p(K);if("["==a)return p(B,z("]"),K)}function S(a){if("variable"!=a)return e(K);aa.marked="property";return p(qa)}function K(a){if(":"==a)return p(G);if("("==a)return e(qa)}function H(a,b){function c(d){return","==d?(d=aa.state.lexical,"call"==d.info&&(d.pos=(d.pos||0)+1),p(a,c)):d==b?p():p(z(b))}return function(d){return d==b?p():e(a,c)}}function E(a,b,c){for(var d=3;d<arguments.length;d++)aa.cc.push(arguments[d]);return p(A(b,
c),H(a,b),x)}function ra(a){return"}"==a?p():e(D,ra)}function X(a){if(cb&&":"==a)return p(I)}function I(a){if("variable"==a)return aa.marked="variable-3",p()}function sa(){return e(ma,X,R,ua)}function ma(a,b){if("variable"==a)return t(b),p();if("["==a)return E(ma,"]");if("{"==a)return E(Q,"}")}function Q(a,b){if("variable"==a&&!aa.stream.match(/^\s*:/,!1))return t(b),p(R);"variable"==a&&(aa.marked="property");return p(z(":"),ma,R)}function R(a,b){if("="==b)return p(G)}function ua(a){if(","==a)return p(sa)}
function C(a,b){if("keyword b"==a&&"else"==b)return p(A("form","else"),D,x)}function W(a){if("("==a)return p(A(")"),O,z(")"),x)}function O(a){return"var"==a?p(sa,z(";"),ca):";"==a?p(ca):"variable"==a?p(Ba):e(B,z(";"),ca)}function Ba(a,b){return"in"==b||"of"==b?(aa.marked="keyword",p(B)):p(fa,ca)}function ca(a,b){return";"==a?p(Ja):"in"==b||"of"==b?(aa.marked="keyword",p(B)):e(B,z(";"),Ja)}function Ja(a){")"!=a&&p(B)}function qa(a,b){if("*"==b)return aa.marked="keyword",p(qa);if("variable"==a)return t(b),
p(qa);if("("==a)return p(w,A(")"),H(Ua,")"),x,D,y)}function Ua(a){return"spread"==a?p(Ua):e(ma,X)}function Ca(a,b){if("variable"==a)return t(b),p(Ga)}function Ga(a,b){if("extends"==b)return p(B,Ga);if("{"==a)return p(A("}"),Da,x)}function Da(a,b){if("variable"==a||"keyword"==aa.style)return aa.marked="property","get"==b||"set"==b?p(Ma,qa,Da):p(qa,Da);if("*"==b)return aa.marked="keyword",p(Da);if(";"==a)return p(Da);if("}"==a)return p()}function Ma(a){if("variable"!=a)return e();aa.marked="property";
return p()}function ia(a,b){if("string"==a)return p(D);if("variable"==a)return t(b),p(u)}function Ka(a,b){return"*"==b?(aa.marked="keyword",p(u,z(";"))):"default"==b?(aa.marked="keyword",p(B,z(";"))):e(D)}function ab(a){return"string"==a?p():e(oa,u)}function oa(a,b){if("{"==a)return E(oa,"}");"variable"==a&&t(b);return p()}function u(a,b){if("from"==b)return aa.marked="keyword",p(B)}function ya(a){return"]"==a?p():e(G,mb)}function mb(a){return"for"==a?e(Ea,z("]")):","==a?p(H(G,"]")):e(H(G,"]"))}function Ea(a){if("for"==
a)return p(W,Ea);if("if"==a)return p(B,Ea)}var eb=b.indentUnit,ka=d.statementIndent,La=d.jsonld,wa=d.json||La,cb=d.typescript,jb=d.wordCharacters||/[\w$]/,qb=function(){function a(a){return{type:a,style:"keyword"}}var b=a("keyword a"),c=a("keyword b"),d=a("keyword c"),e=a("operator"),f={type:"atom",style:"atom"};b={"if":a("if"),"while":b,"with":b,"else":c,"do":c,"try":c,"finally":c,"return":d,"break":d,"continue":d,"new":d,"delete":d,"throw":d,"debugger":d,"var":a("var"),"const":a("var"),let:a("var"),
"function":a("function"),"catch":a("catch"),"for":a("for"),"switch":a("switch"),"case":a("case"),"default":a("default"),"in":e,"typeof":e,"instanceof":e,"true":f,"false":f,"null":f,undefined:f,NaN:f,Infinity:f,"this":a("this"),module:a("module"),"class":a("class"),"super":a("atom"),yield:d,"export":a("export"),"import":a("import"),"extends":d};if(cb){c={type:"variable",style:"variable-3"};c={"interface":a("interface"),"extends":a("extends"),constructor:a("constructor"),"public":a("public"),"private":a("private"),
"protected":a("protected"),"static":a("static"),string:c,number:c,bool:c,any:c};for(var g in c)b[g]=c[g]}return b}(),nb=/[+\-*&%=<>!?|~^]/,Ob=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/,gb,Ha,Wa={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,"this":!0,"jsonld-keyword":!0},aa={state:null,column:null,marked:null,cc:null},ub={name:"this",next:{name:"arguments"}};x.lex=!0;return{startState:function(a){a={tokenize:f,lastType:"sof",cc:[],lexical:new q((a||
0)-eb,0,"block",!1),localVars:d.localVars,context:d.localVars&&{vars:d.localVars},indented:0};d.globalVars&&"object"==typeof d.globalVars&&(a.globalVars=d.globalVars);return a},token:function(a,b){a.sol()&&(b.lexical.hasOwnProperty("align")||(b.lexical.align=!1),b.indented=a.indentation(),n(a,b));if(b.tokenize!=m&&a.eatSpace())return null;var c=b.tokenize(a,b);if("comment"==gb)return c;b.lastType="operator"!=gb||"++"!=Ha&&"--"!=Ha?gb:"incdec";a:{var d=gb,e=Ha,f=b.cc;aa.state=b;aa.stream=a;aa.marked=
null;aa.cc=f;aa.style=c;b.lexical.hasOwnProperty("align")||(b.lexical.align=!0);for(;;)if((f.length?f.pop():wa?B:D)(d,e)){for(;f.length&&f[f.length-1].lex;)f.pop()();if(aa.marked){c=aa.marked;break a}if(a="variable"==d)b:{for(a=b.localVars;a;a=a.next)if(a.name==e){a=!0;break b}for(b=b.context;b;b=b.prev)for(a=b.vars;a;a=a.next)if(a.name==e){a=!0;break b}a=void 0}if(a){c="variable-2";break a}break a}}return c},indent:function(b,c){if(b.tokenize==m)return a.Pass;if(b.tokenize!=f)return 0;var e=c&&c.charAt(0),
g=b.lexical;if(!/^\s*else\b/.test(c))for(var l=b.cc.length-1;0<=l;--l){var n=b.cc[l];if(n==x)g=g.prev;else if(n!=C)break}"stat"==g.type&&"}"==e&&(g=g.prev);ka&&")"==g.type&&"stat"==g.prev.type&&(g=g.prev);l=g.type;n=e==l;return"vardef"==l?g.indented+("operator"==b.lastType||","==b.lastType?g.info+1:0):"form"==l&&"{"==e?g.indented:"form"==l?g.indented+eb:"stat"==l?g.indented+("operator"==b.lastType||","==b.lastType?ka||eb:0):"switch"!=g.info||n||0==d.doubleIndentSwitch?g.align?g.column+(n?0:1):g.indented+
(n?0:eb):g.indented+(/^(?:case|default)\b/.test(c)?eb:2*eb)},electricChars:":{}",blockCommentStart:wa?null:"/*",blockCommentEnd:wa?null:"*/",lineComment:wa?null:"//",fold:"brace",helperType:wa?"json":"javascript",jsonldMode:La,jsonMode:wa}});a.registerHelper("wordChars","javascript",/[\w$]/);a.defineMIME("text/javascript","javascript");a.defineMIME("text/ecmascript","javascript");a.defineMIME("application/javascript","javascript");a.defineMIME("application/x-javascript","javascript");a.defineMIME("application/ecmascript",
"javascript");a.defineMIME("application/json",{name:"javascript",json:!0});a.defineMIME("application/x-json",{name:"javascript",json:!0});a.defineMIME("application/ld+json",{name:"javascript",jsonld:!0});a.defineMIME("text/typescript",{name:"javascript",typescript:!0});a.defineMIME("application/typescript",{name:"javascript",typescript:!0})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require(app.baseUrl+"js/codemirror-editor/lib/codemirror")):"function"==typeof define&&define.amd?define([app.baseUrl+"js/codemirror-editor/lib/codemirror"],a):a(CodeMirror)})(function(a){a.defineMode("xml",function(b,d){function c(a,b){function c(c){b.tokenize=c;return c(a,b)}var d=a.next();if("<"==d){if(a.eat("!"))return a.eat("[")?a.match("CDATA[")?c(m("atom","]]\x3e")):null:a.match("--")?c(m("comment","--\x3e")):a.match("DOCTYPE",
!0,!0)?(a.eatWhile(/[\w\._\-]/),c(l(1))):null;if(a.eat("?"))return a.eatWhile(/[\w\._\-]/),b.tokenize=m("meta","?>"),"meta";da=a.eat("/")?"closeTag":"openTag";b.tokenize=f;return"tag bracket"}if("&"==d)return(a.eat("#")?a.eat("x")?a.eatWhile(/[a-fA-F\d]/)&&a.eat(";"):a.eatWhile(/[\d]/)&&a.eat(";"):a.eatWhile(/[\w\.\-:]/)&&a.eat(";"))?"atom":"error";a.eatWhile(/[^&<]/);return null}function f(a,b){var d=a.next();if(">"==d||"/"==d&&a.eat(">"))return b.tokenize=c,da=">"==d?"endTag":"selfcloseTag","tag bracket";
if("="==d)return da="equals",null;if("<"==d)return b.tokenize=c,b.state=p,b.tagName=b.tagStart=null,(a=b.tokenize(a,b))?a+" tag error":"tag error";if(/[\'\"]/.test(d))return b.tokenize=g(d),b.stringStartCol=a.column(),b.tokenize(a,b);a.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/);return"word"}function g(a){var b=function(b,c){for(;!b.eol();)if(b.next()==a){c.tokenize=f;break}return"string"};b.isInAttribute=!0;return b}function m(a,b){return function(d,e){for(;!d.eol();){if(d.match(b)){e.tokenize=
c;break}d.next()}return a}}function l(a){return function(b,d){for(var e;null!=(e=b.next());){if("<"==e)return d.tokenize=l(a+1),d.tokenize(b,d);if(">"==e)if(1==a){d.tokenize=c;break}else return d.tokenize=l(a-1),d.tokenize(b,d)}return"meta"}}function n(a,b,c){this.prev=a.context;this.tagName=b;this.indent=a.indented;this.startOfLine=c;if(P.doNotIndent.hasOwnProperty(b)||a.context&&a.context.noIndent)this.noIndent=!0}function q(a){a.context&&(a.context=a.context.prev)}function e(a,b){for(var c;a.context;){c=
a.context.tagName;if(!P.contextGrabbers.hasOwnProperty(c)||!P.contextGrabbers[c].hasOwnProperty(b))break;q(a)}}function p(a,b,c){return"openTag"==a?(c.tagStart=b.column(),t):"closeTag"==a?w:p}function t(a,b,c){if("word"==a)return c.tagName=b.current(),M="tag",x;M="error";return t}function w(a,b,c){if("word"==a){a=b.current();c.context&&c.context.tagName!=a&&P.implicitlyClosed.hasOwnProperty(c.context.tagName)&&q(c);if(c.context&&c.context.tagName==a)return M="tag",y;M="tag error";return A}M="error";
return A}function y(a,b,c){if("endTag"!=a)return M="error",y;q(c);return p}function A(a,b,c){M="error";return y(a,b,c)}function x(a,b,c){if("word"==a)return M="attribute",z;if("endTag"==a||"selfcloseTag"==a){b=c.tagName;var d=c.tagStart;c.tagName=c.tagStart=null;"selfcloseTag"==a||P.autoSelfClosers.hasOwnProperty(b)?e(c,b):(e(c,b),c.context=new n(c,b,d==c.indented));return p}M="error";return x}function z(a,b,c){if("equals"==a)return D;P.allowMissing||(M="error");return x(a,b,c)}function D(a,b,c){if("string"==
a)return B;if("word"==a&&P.allowUnquoted)return M="string",x;M="error";return x(a,b,c)}function B(a,b,c){return"string"==a?B:x(a,b,c)}var G=b.indentUnit,L=d.multilineTagIndentFactor||1,J=d.multilineTagIndentPastTag;null==J&&(J=!0);var P=d.htmlMode?{autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,
th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},
allowUnquoted:!0,allowMissing:!0,caseFold:!0}:{autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,caseFold:!1},fa=d.alignCDATA,da,M;return{startState:function(){return{tokenize:c,state:p,indented:0,tagName:null,tagStart:null,context:null}},token:function(a,b){!b.tagName&&a.sol()&&(b.indented=a.indentation());if(a.eatSpace())return null;da=null;var c=b.tokenize(a,b);(c||da)&&"comment"!=c&&(M=null,b.state=b.state(da||c,a,b),M&&(c="error"==M?c+" error":
M));return c},indent:function(b,d,e){var g=b.context;if(b.tokenize.isInAttribute)return b.tagStart==b.indented?b.stringStartCol+1:b.indented+G;if(g&&g.noIndent)return a.Pass;if(b.tokenize!=f&&b.tokenize!=c)return e?e.match(/^(\s*)/)[0].length:0;if(b.tagName)return J?b.tagStart+b.tagName.length+2:b.tagStart+G*L;if(fa&&/<!\[CDATA\[/.test(d))return 0;if((b=d&&/^<(\/)?([\w_:\.-]*)/.exec(d))&&b[1])for(;g;)if(g.tagName==b[2]){g=g.prev;break}else if(P.implicitlyClosed.hasOwnProperty(g.tagName))g=g.prev;
else break;else if(b)for(;g;)if((d=P.contextGrabbers[g.tagName])&&d.hasOwnProperty(b[2]))g=g.prev;else break;for(;g&&!g.startOfLine;)g=g.prev;return g?g.indent+G:0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"\x3c!--",blockCommentEnd:"--\x3e",configuration:d.htmlMode?"html":"xml",helperType:d.htmlMode?"html":"xml"}});a.defineMIME("text/xml","xml");a.defineMIME("application/xml","xml");a.mimeModes.hasOwnProperty("text/html")||a.defineMIME("text/html",{name:"xml",htmlMode:!0})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require(app.baseUrl+"js/codemirror-editor/lib/codemirror"),require(app.baseUrl+"js/codemirror-editor/mode/xml/xml"),require(app.baseUrl+"js/codemirror-editor/mode/javascript/javascript"),require(app.baseUrl+"js/codemirror-editor/mode/css/css")):"function"==typeof define&&define.amd?define([app.baseUrl+"js/codemirror-editor/lib/codemirror",app.baseUrl+"js/codemirror-editor/mode/xml/xml",app.baseUrl+"js/codemirror-editor/mode/javascript/javascript",
app.baseUrl+"js/codemirror-editor/mode/css/css"],a):a(CodeMirror)})(function(a){a.defineMode("htmlmixed",function(b,d){function c(a,b){var c=b.htmlState.tagName,d=l.token(a,b.htmlState);if("script"==c&&/\btag\b/.test(d)&&">"==a.current())for((a=(a=a.string.slice(Math.max(0,a.pos-100),a.pos).match(/\btype\s*=\s*("[^"]+"|'[^']+'|\S+)[^<]*$/i))?a[1]:"")&&/[\"\']/.test(a.charAt(0))&&(a=a.slice(1,a.length-1)),c=0;c<q.length;++c){var e=q[c];if("string"==typeof e.matches?a==e.matches:e.matches.test(a)){e.mode&&
(b.token=g,b.localMode=e.mode,b.localState=e.mode.startState&&e.mode.startState(l.indent(b.htmlState,"")));break}}else"style"==c&&/\btag\b/.test(d)&&">"==a.current()&&(b.token=m,b.localMode=n,b.localState=n.startState(l.indent(b.htmlState,"")));return d}function f(a,b,c){var d=a.current(),e=d.search(b);-1<e?a.backUp(d.length-e):d.match(/<\/?$/)&&(a.backUp(d.length),a.match(b,!1)||a.match(d));return c}function g(a,b){return a.match(/^<\/\s*script\s*>/i,!1)?(b.token=c,b.localState=b.localMode=null,
c(a,b)):f(a,/<\/\s*script\s*>/,b.localMode.token(a,b.localState))}function m(a,b){return a.match(/^<\/\s*style\s*>/i,!1)?(b.token=c,b.localState=b.localMode=null,c(a,b)):f(a,/<\/\s*style\s*>/,n.token(a,b.localState))}var l=a.getMode(b,{name:"xml",htmlMode:!0,multilineTagIndentFactor:d.multilineTagIndentFactor,multilineTagIndentPastTag:d.multilineTagIndentPastTag}),n=a.getMode(b,"css"),q=[];d=d&&d.scriptTypes;q.push({matches:/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^$/i,mode:a.getMode(b,
"javascript")});if(d)for(var e=0;e<d.length;++e){var p=d[e];q.push({matches:p.matches,mode:p.mode&&a.getMode(b,p.mode)})}q.push({matches:/./,mode:a.getMode(b,"text/plain")});return{startState:function(){var a=l.startState();return{token:c,localMode:null,localState:null,htmlState:a}},copyState:function(b){if(b.localState)var c=a.copyState(b.localMode,b.localState);return{token:b.token,localMode:b.localMode,localState:c,htmlState:a.copyState(l,b.htmlState)}},token:function(a,b){return b.token(a,b)},
indent:function(b,c){return!b.localMode||/^\s*<\//.test(c)?l.indent(b.htmlState,c):b.localMode.indent?b.localMode.indent(b.localState,c):a.Pass},innerMode:function(a){return{state:a.localState||a.htmlState,mode:a.localMode||l}}}},"xml","javascript","css");a.defineMIME("text/html","htmlmixed")});
(function(a,b,d){function c(b,c){this.bodyOverflowX;this.callbacks={hide:[],show:[]};this.checkInterval=null;this.Content;this.$el=a(b);this.$elProxy;this.elProxyPosition;this.enabled=!0;this.options=a.extend({},m,c);this.mouseIsOverProxy=!1;this.namespace="tooltipster-"+Math.round(1E5*Math.random());this.Status="hidden";this.timerShow=this.timerHide=null;this.$tooltip;this.options.iconTheme=this.options.iconTheme.replace(".","");this.options.theme=this.options.theme.replace(".","");this._init()}
function f(b,c){var d=!0;a.each(b,function(a,e){if("undefined"===typeof c[a]||b[a]!==c[a])return d=!1});return d}function g(){var a=(d.body||d.documentElement).style,b="transition";if("string"==typeof a[b])return!0;v=["Moz","Webkit","Khtml","O","ms"];b=b.charAt(0).toUpperCase()+b.substr(1);for(var c=0;c<v.length;c++)if("string"==typeof a[v[c]+b])return!0;return!1}var m={animation:"fade",arrow:!0,arrowColor:"",autoClose:!0,content:null,contentAsHTML:!1,contentCloning:!0,debug:!0,delay:200,minWidth:0,
maxWidth:null,functionInit:function(a,b){},functionBefore:function(a,b){b()},functionReady:function(a,b){},functionAfter:function(a){},hideOnClick:!1,icon:"(?)",iconCloning:!0,iconDesktop:!1,iconTouch:!1,iconTheme:"tooltipster-icon",interactive:!1,interactiveTolerance:350,multiple:!1,offsetX:0,offsetY:0,onlyOne:!1,position:"top",positionTracker:!1,positionTrackerCallback:function(a){"hover"==this.option("trigger")&&this.option("autoClose")&&this.hide()},restoration:"current",speed:350,timer:0,theme:"tooltipster-default",
touchDevices:!0,trigger:"hover",updateAnimation:!0};c.prototype={_init:function(){var b=this;if(d.querySelector){var c=null;void 0===b.$el.data("tooltipster-initialTitle")&&(c=b.$el.attr("title"),void 0===c&&(c=null),b.$el.data("tooltipster-initialTitle",c));null!==b.options.content?b._content_set(b.options.content):b._content_set(c);c=b.options.functionInit.call(b.$el,b.$el,b.Content);"undefined"!==typeof c&&b._content_set(c);b.$el.removeAttr("title").addClass("tooltipstered");!l&&b.options.iconDesktop||
l&&b.options.iconTouch?("string"===typeof b.options.icon?(b.$elProxy=a('<span class="'+b.options.iconTheme+'"></span>'),b.$elProxy.text(b.options.icon)):b.$elProxy=b.options.iconCloning?b.options.icon.clone(!0):b.options.icon,b.$elProxy.insertAfter(b.$el)):b.$elProxy=b.$el;if("hover"==b.options.trigger){if(b.$elProxy.on("mouseenter."+b.namespace,function(){if(n||!l||b.options.touchDevices)b.mouseIsOverProxy=!0,b._show()}).on("mouseleave."+b.namespace,function(){if(n||!l||b.options.touchDevices)b.mouseIsOverProxy=
!1}),l&&b.options.touchDevices)b.$elProxy.on("touchstart."+b.namespace,function(){b._showNow()})}else if("click"==b.options.trigger)b.$elProxy.on("click."+b.namespace,function(){(n||!l||b.options.touchDevices)&&b._show()})}},_show:function(){var a=this;"shown"!=a.Status&&"appearing"!=a.Status&&(a.options.delay?a.timerShow=setTimeout(function(){("click"==a.options.trigger||"hover"==a.options.trigger&&a.mouseIsOverProxy)&&a._showNow()},a.options.delay):a._showNow())},_showNow:function(c){var d=this;
d.options.functionBefore.call(d.$el,d.$el,function(){if(d.enabled&&null!==d.Content){c&&d.callbacks.show.push(c);d.callbacks.hide=[];clearTimeout(d.timerShow);d.timerShow=null;clearTimeout(d.timerHide);d.timerHide=null;d.options.onlyOne&&a(".tooltipstered").not(d.$el).each(function(b,c){var d=a(c);b=d.data("tooltipster-ns");a.each(b,function(a,b){a=d.data(b);b=a.status();var c=a.option("autoClose");"hidden"!==b&&"disappearing"!==b&&c&&a.hide()})});var e=function(){d.Status="shown";a.each(d.callbacks.show,
function(a,b){b.call(d.$el)});d.callbacks.show=[]};if("hidden"!==d.Status){var f=0;"disappearing"===d.Status?(d.Status="appearing",g()?(d.$tooltip.clearQueue().removeClass("tooltipster-dying").addClass("tooltipster-"+d.options.animation+"-show"),0<d.options.speed&&d.$tooltip.delay(d.options.speed),d.$tooltip.queue(e)):d.$tooltip.stop().fadeIn(e)):"shown"===d.Status&&e()}else{d.Status="appearing";f=d.options.speed;d.bodyOverflowX=a("body").css("overflow-x");a("body").css("overflow-x","hidden");var m=
"tooltipster-"+d.options.animation;d.$tooltip=a('<div class="tooltipster-base '+d.options.theme+'" style="'+(d.options.minWidth?"min-width:"+Math.round(d.options.minWidth)+"px;":"")+" "+(d.options.maxWidth?"max-width:"+Math.round(d.options.maxWidth)+"px;":"")+" "+(d.options.interactive?"pointer-events: auto;":"")+" "+("-webkit-transition-duration: "+d.options.speed+"ms; -webkit-animation-duration: "+d.options.speed+"ms; -moz-transition-duration: "+d.options.speed+"ms; -moz-animation-duration: "+d.options.speed+
"ms; -o-transition-duration: "+d.options.speed+"ms; -o-animation-duration: "+d.options.speed+"ms; -ms-transition-duration: "+d.options.speed+"ms; -ms-animation-duration: "+d.options.speed+"ms; transition-duration: "+d.options.speed+"ms; animation-duration: "+d.options.speed+"ms;")+'"><div class="tooltipster-content"></div></div>');g()&&d.$tooltip.addClass(m);d._content_insert();d.$tooltip.appendTo("body");d.reposition();d.options.functionReady.call(d.$el,d.$el,d.$tooltip);g()?(d.$tooltip.addClass(m+
"-show"),0<d.options.speed&&d.$tooltip.delay(d.options.speed),d.$tooltip.queue(e)):d.$tooltip.css("display","none").fadeIn(d.options.speed,e);d._interval_set();a(b).on("scroll."+d.namespace+" resize."+d.namespace,function(){d.reposition()});if(d.options.autoClose)if(a("body").off("."+d.namespace),"hover"==d.options.trigger){l&&setTimeout(function(){a("body").on("touchstart."+d.namespace,function(){d.hide()})},0);if(d.options.interactive){if(l)d.$tooltip.on("touchstart."+d.namespace,function(a){a.stopPropagation()});
var n=null;d.$elProxy.add(d.$tooltip).on("mouseleave."+d.namespace+"-autoClose",function(){clearTimeout(n);n=setTimeout(function(){d.hide()},d.options.interactiveTolerance)}).on("mouseenter."+d.namespace+"-autoClose",function(){clearTimeout(n)})}else d.$elProxy.on("mouseleave."+d.namespace+"-autoClose",function(){d.hide()});if(d.options.hideOnClick)d.$elProxy.on("click."+d.namespace+"-autoClose",function(){d.hide()})}else if("click"==d.options.trigger&&(setTimeout(function(){a("body").on("click."+
d.namespace+" touchstart."+d.namespace,function(){d.hide()})},0),d.options.interactive))d.$tooltip.on("click."+d.namespace+" touchstart."+d.namespace,function(a){a.stopPropagation()})}0<d.options.timer&&(d.timerHide=setTimeout(function(){d.timerHide=null;d.hide()},d.options.timer+f))}})},_interval_set:function(){var b=this;b.checkInterval=setInterval(function(){if(0===a("body").find(b.$el).length||0===a("body").find(b.$elProxy).length||"hidden"==b.Status||0===a("body").find(b.$tooltip).length)"shown"!=
b.Status&&"appearing"!=b.Status||b.hide(),b._interval_cancel();else if(b.options.positionTracker){var c=b._repositionInfo(b.$elProxy),d=!1;f(c.dimension,b.elProxyPosition.dimension)&&("fixed"===b.$elProxy.css("position")?f(c.position,b.elProxyPosition.position)&&(d=!0):f(c.offset,b.elProxyPosition.offset)&&(d=!0));d||(b.reposition(),b.options.positionTrackerCallback.call(b,b.$el))}},200)},_interval_cancel:function(){clearInterval(this.checkInterval);this.checkInterval=null},_content_set:function(a){"object"===
typeof a&&null!==a&&this.options.contentCloning&&(a=a.clone(!0));this.Content=a},_content_insert:function(){var a=this.$tooltip.find(".tooltipster-content");"string"!==typeof this.Content||this.options.contentAsHTML?a.empty().append(this.Content):a.text(this.Content)},_update:function(a){var b=this;b._content_set(a);null!==b.Content?"hidden"!==b.Status&&(b._content_insert(),b.reposition(),b.options.updateAnimation&&(g()?(b.$tooltip.css({width:"","-webkit-transition":"all "+b.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms",
"-moz-transition":"all "+b.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-o-transition":"all "+b.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-ms-transition":"all "+b.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms",transition:"all "+b.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms"}).addClass("tooltipster-content-changing"),setTimeout(function(){"hidden"!=b.Status&&(b.$tooltip.removeClass("tooltipster-content-changing"),setTimeout(function(){"hidden"!==
b.Status&&b.$tooltip.css({"-webkit-transition":b.options.speed+"ms","-moz-transition":b.options.speed+"ms","-o-transition":b.options.speed+"ms","-ms-transition":b.options.speed+"ms",transition:b.options.speed+"ms"})},b.options.speed))},b.options.speed)):b.$tooltip.fadeTo(b.options.speed,.5,function(){"hidden"!=b.Status&&b.$tooltip.fadeTo(b.options.speed,1)}))):b.hide()},_repositionInfo:function(a){return{dimension:{height:a.outerHeight(!1),width:a.outerWidth(!1)},offset:a.offset(),position:{left:parseInt(a.css("left")),
top:parseInt(a.css("top"))}}},hide:function(c){var d=this;c&&d.callbacks.hide.push(c);d.callbacks.show=[];clearTimeout(d.timerShow);d.timerShow=null;clearTimeout(d.timerHide);d.timerHide=null;var f=function(){a.each(d.callbacks.hide,function(a,b){b.call(d.$el)});d.callbacks.hide=[]};"shown"==d.Status||"appearing"==d.Status?(d.Status="disappearing",c=function(){d.Status="hidden";"object"==typeof d.Content&&null!==d.Content&&d.Content.detach();d.$tooltip.remove();d.$tooltip=null;a(b).off("."+d.namespace);
a("body").off("."+d.namespace).css("overflow-x",d.bodyOverflowX);a("body").off("."+d.namespace);d.$elProxy.off("."+d.namespace+"-autoClose");d.options.functionAfter.call(d.$el,d.$el);f()},g()?(d.$tooltip.clearQueue().removeClass("tooltipster-"+d.options.animation+"-show").addClass("tooltipster-dying"),0<d.options.speed&&d.$tooltip.delay(d.options.speed),d.$tooltip.queue(c)):d.$tooltip.stop().fadeOut(d.options.speed,c)):"hidden"==d.Status&&f();return d},show:function(a){this._showNow(a);return this},
update:function(a){return this.content(a)},content:function(a){if("undefined"===typeof a)return this.Content;this._update(a);return this},reposition:function(){if(0!==a("body").find(this.$tooltip).length){var c=function(c,d){0>l.offset.top-a(b).scrollTop()-n-ea-12&&-1<d.indexOf("top")&&(Y=c);l.offset.top+l.dimension.height+n+12+ea>a(b).scrollTop()+a(b).height()&&-1<d.indexOf("bottom")&&(Y=c,V=l.offset.top-n-ea-12)},d=function(){var c=a(b).scrollLeft();0>M-c&&(f=M-c,M=c);M+m-c>g&&(f=M-(g+c-m),M=g+
c-m)};this.$tooltip.css("width","");this.elProxyPosition=this._repositionInfo(this.$elProxy);var f=null,g=a(b).width(),l=this.elProxyPosition,m=this.$tooltip.outerWidth(!1);this.$tooltip.innerWidth();var n=this.$tooltip.outerHeight(!1);if(this.$elProxy.is("area")){var x=this.$elProxy.attr("shape"),z=this.$elProxy.parent().attr("name"),D=a('img[usemap="#'+z+'"]');z=D.offset().left;var B=D.offset().top,G=void 0!==this.$elProxy.attr("coords")?this.$elProxy.attr("coords").split(","):void 0;if("circle"==
x)x=parseInt(G[0]),D=parseInt(G[1]),G=parseInt(G[2]),l.dimension.height=2*G,l.dimension.width=2*G,l.offset.top=B+D-G,l.offset.left=z+x-G;else if("rect"==x){x=parseInt(G[0]);D=parseInt(G[1]);var L=parseInt(G[2]);G=parseInt(G[3]);l.dimension.height=G-D;l.dimension.width=L-x;l.offset.top=B+D;l.offset.left=z+x}else if("poly"==x){for(var J=L=D=x=0,P="even",fa=0;fa<G.length;fa++){var da=parseInt(G[fa]);"even"==P?(da>L&&(L=da,0===fa&&(x=L)),da<x&&(x=da),P="odd"):(da>J&&(J=da,1==fa&&(D=J)),da<D&&(D=da),P=
"even")}l.dimension.height=J-D;l.dimension.width=L-x;l.offset.top=B+D;l.offset.left=z+x}else l.dimension.height=D.outerHeight(!1),l.dimension.width=D.outerWidth(!1),l.offset.top=B,l.offset.left=z}var M=0,V=B=0,ea=parseInt(this.options.offsetY);z=parseInt(this.options.offsetX);var Y=this.options.position;"top"==Y&&(B=l.offset.left+m-(l.offset.left+l.dimension.width),M=l.offset.left+z-B/2,V=l.offset.top-n-ea-12,d(),c("bottom","top"));"top-left"==Y&&(M=l.offset.left+z,V=l.offset.top-n-ea-12,d(),c("bottom-left",
"top-left"));"top-right"==Y&&(M=l.offset.left+l.dimension.width+z-m,V=l.offset.top-n-ea-12,d(),c("bottom-right","top-right"));"bottom"==Y&&(B=l.offset.left+m-(l.offset.left+l.dimension.width),M=l.offset.left-B/2+z,V=l.offset.top+l.dimension.height+ea+12,d(),c("top","bottom"));"bottom-left"==Y&&(M=l.offset.left+z,V=l.offset.top+l.dimension.height+ea+12,d(),c("top-left","bottom-left"));"bottom-right"==Y&&(M=l.offset.left+l.dimension.width+z-m,V=l.offset.top+l.dimension.height+ea+12,d(),c("top-right",
"bottom-right"));"left"==Y&&(M=l.offset.left-z-m-12,B=l.offset.left+z+l.dimension.width+12,c=l.offset.top+n-(l.offset.top+l.dimension.height),V=l.offset.top-c/2-ea,0>M&&B+m>g?(c=2*parseFloat(this.$tooltip.css("border-width")),d=m+M-c,this.$tooltip.css("width",d+"px"),n=this.$tooltip.outerHeight(!1),M=l.offset.left-z-d-12-c,c=l.offset.top+n-(l.offset.top+l.dimension.height),V=l.offset.top-c/2-ea):0>M&&(M=l.offset.left+z+l.dimension.width+12,f="left"));"right"==Y&&(M=l.offset.left+z+l.dimension.width+
12,B=l.offset.left-z-m-12,c=l.offset.top+n-(l.offset.top+l.dimension.height),V=l.offset.top-c/2-ea,M+m>g&&0>B?(c=2*parseFloat(this.$tooltip.css("border-width")),this.$tooltip.css("width",g-M-c+"px"),n=this.$tooltip.outerHeight(!1),c=l.offset.top+n-(l.offset.top+l.dimension.height),V=l.offset.top-c/2-ea):M+m>g&&(M=l.offset.left-z-m-12,f="right"));this.options.arrow&&(c="tooltipster-arrow-"+Y,d=1>this.options.arrowColor.length?this.$tooltip.css("background-color"):this.options.arrowColor,f?"left"==
f?(c="tooltipster-arrow-right",f=""):"right"==f?(c="tooltipster-arrow-left",f=""):f="left:"+Math.round(f)+"px;":f="","top"==Y||"top-left"==Y||"top-right"==Y?(z=parseFloat(this.$tooltip.css("border-bottom-width")),B=this.$tooltip.css("border-bottom-color")):"bottom"==Y||"bottom-left"==Y||"bottom-right"==Y?(z=parseFloat(this.$tooltip.css("border-top-width")),B=this.$tooltip.css("border-top-color")):"left"==Y?(z=parseFloat(this.$tooltip.css("border-right-width")),B=this.$tooltip.css("border-right-color")):
"right"==Y?(z=parseFloat(this.$tooltip.css("border-left-width")),B=this.$tooltip.css("border-left-color")):(z=parseFloat(this.$tooltip.css("border-bottom-width")),B=this.$tooltip.css("border-bottom-color")),1<z&&z++,G="",0!==z&&(G="",B="border-color: "+B+";",-1!==c.indexOf("bottom")?G="margin-top: -"+Math.round(z)+"px;":-1!==c.indexOf("top")?G="margin-bottom: -"+Math.round(z)+"px;":-1!==c.indexOf("left")?G="margin-right: -"+Math.round(z)+"px;":-1!==c.indexOf("right")&&(G="margin-left: -"+Math.round(z)+
"px;"),G='<span class="tooltipster-arrow-border" style="'+G+" "+B+';"></span>'),this.$tooltip.find(".tooltipster-arrow").remove(),this.$tooltip.append('<div class="'+c+' tooltipster-arrow" style="'+f+'">'+G+'<span style="border-color:'+d+';"></span></div>'));this.$tooltip.css({top:Math.round(V)+"px",left:Math.round(M)+"px"})}return this},enable:function(){this.enabled=!0;return this},disable:function(){this.hide();this.enabled=!1;return this},destroy:function(){var b=this;b.hide();b.$el[0]!==b.$elProxy[0]&&
b.$elProxy.remove();b.$el.removeData(b.namespace).off("."+b.namespace);var c=b.$el.data("tooltipster-ns");1===c.length?(c=null,"previous"===b.options.restoration?c=b.$el.data("tooltipster-initialTitle"):"current"===b.options.restoration&&(c="string"===typeof b.Content?b.Content:a("<div></div>").append(b.Content).html()),c&&b.$el.attr("title",c),b.$el.removeClass("tooltipstered").removeData("tooltipster-ns").removeData("tooltipster-initialTitle")):(c=a.grep(c,function(a,c){return a!==b.namespace}),
b.$el.data("tooltipster-ns",c));return b},elementIcon:function(){return this.$el[0]!==this.$elProxy[0]?this.$elProxy[0]:void 0},elementTooltip:function(){return this.$tooltip?this.$tooltip[0]:void 0},option:function(a,b){if("undefined"==typeof b)return this.options[a];this.options[a]=b;return this},status:function(){return this.Status}};a.fn.tooltipster=function(){var b=arguments;if(0===this.length){if("string"===typeof b[0]){var d=!0;switch(b[0]){case "setDefaults":a.extend(m,b[1]);break;default:d=
!1}return d?!0:this}return this}if("string"===typeof b[0]){var f="#*$~&";this.each(function(){var c=a(this).data("tooltipster-ns");if(c=c?a(this).data(c[0]):null){if("function"===typeof c[b[0]])var d=c[b[0]](b[1],b[2]);else throw Error('Unknown method .tooltipster("'+b[0]+'")');if(d!==c)return f=d,!1}else throw Error("You called Tooltipster's \""+b[0]+'" method on an uninitialized element');});return"#*$~&"!==f?f:this}var g=[],l=(d=b[0]&&"undefined"!==typeof b[0].multiple)&&b[0].multiple||!d&&m.multiple,
n=(d=b[0]&&"undefined"!==typeof b[0].debug)&&b[0].debug||!d&&m.debug;this.each(function(){var d=!1,e=a(this).data("tooltipster-ns"),f=null;e?l?d=!0:n&&console.log('Tooltipster: one or more tooltips are already attached to this element: ignoring. Use the "multiple" option to attach more tooltips.'):d=!0;d&&(f=new c(this,b[0]),e||(e=[]),e.push(f.namespace),a(this).data("tooltipster-ns",e),a(this).data(f.namespace,f));g.push(f)});return l?g:this};var l=!!("ontouchstart"in b),n=!1;a("body").one("mousemove",
function(){n=!0})})(jQuery,window,document);
var loggable=function(a,b,d){b=b||"";var c="undefined"!==typeof d?d:!0;prefix=b?b+": ":"";a.log=function(a){return function(){c&&"undefined"!==typeof console&&arguments.length&&(arguments[0]=a+arguments[0])}}(prefix);return a},xmlEditor=function(){function a(b,c){c(b);for(b=b.firstChild;b;)a(b,c),b=b.nextSibling}function b(a){a=a.closest("li.node").attr("nodeIndex");return m[a]}function d(a){var b=[];do b.push(a.nodeName);while((a=a.parentNode)&&"#document"!==a.nodeName.toLowerCase());return b.reverse().join(" > ").toLowerCase()}
function c(a){return $(a).contents().filter(function(){return("#text"==this.nodeName&&"3"==this.nodeType||"4"==this.nodeType)&&""!==$.trim(this.nodeValue.replace("\n",""))})}function f(a){var b=c(a);return a&&8===a.nodeType?a.nodeValue:b[0]?$.trim(b[0].textContent):""}function g(){l.trigger("beforeToggleNode");var a=$(this);a.find(">ul").toggle("normal");a.hasClass("collapsable")?a.removeClass("collapsable").addClass("expandable"):a.removeClass("expandable").addClass("collapsable");l.trigger("afterToggleNode")}
var m=[],l=$({}),n={removeAttrConfirm:$.i18n.prop("are.you.sure.delete.attr.value"),invalidAttrName:$.i18n.prop("the.attr.is.invalid"),invalidNodeName:$.i18n.prop("the.node.is.invalid"),noTextValue:$.i18n.prop("no.text.value.click.to.edit"),removeNodeSuccess:$.i18n.prop("node.remove.success"),removeNodeConfirm:$.i18n.prop("are.you.sure.remove.this.node"),xmlLoadProblem:$.i18n.prop("there.was.a.problem.loading.xml.file")},q={xml:{},$container:$(document.body),log:function(){},assignEditHandlers:function(){this.$container.delegate("span.nodeName",
"click",function(){var a=$(this),c=b(a);q.editNode(a,c,a.text())}).delegate("div.hitarea","click",function(){g.apply($(this).parent().get(0))}).delegate("p.nodeValue","click",function(){var a=$(this),c=b(a);q.editValue(a,c,f(c))}).delegate("a.addChild","click",function(a){a.preventDefault();a=$(this);var c=b(a);q.createChild(a,c)}).delegate("span.attrValue","click",function(){var a=$(this),c=b(a);q.editAttribute(a,c,a.attr("name"),a.text())}).delegate("button.addAttr","click",function(a){a.preventDefault();
a=$(this);var c=b(a);q.createAttribute(a,c)}).delegate("button.killNode","click",function(a){a.preventDefault();a=$(this);var c=b(a);q.removeNode(a,c)}).delegate("button.icon","mouseover",function(){$(this).css({opacity:1})}).delegate("button.icon","mouseout",function(){$(this).css({opacity:.5})}).delegate("li.node","mouseover",function(){var a=$(this);a=b(a);$("#nodePath").text(d(a))}).delegate("li.node","mouseout",function(){$("#nodePath").empty()})},getNewNodeHTML:function(a,b,c){var d=m.length-
1,e=f(a);if(a.attributes){var g="<span class='nodeAttrs'>";for(var l=a.attributes.length,p=0;p<l;p++)g+="<span class='singleAttr'>"+a.attributes[p].name+"=\"<span class='attrValue' name='"+a.attributes[p].name+"'>"+(""===a.attributes[p].value?"&nbsp;":a.attributes[p].value)+'</span>"</span>';g+="<button class='addAttr icon'/></span>"}else g="";e=e?e:"<span class='noValue'>"+n.noTextValue+"</span>";nodeHtml="";return nodeHtml=8===a.nodeType?'<li class="node comment '+b+(c?" last":"")+'" nodeIndex="'+
d+'"><div class="hitarea'+(c?" last":"")+'"/><span class="nodeName">comment</span><button class="killNode icon"/><ul class="nodeCore"><li class="last"><p class="nodeValue">'+e+"</p></li></ul></li>":'<li class="node '+a.nodeName+" "+b+(c?" last":"")+'" nodeIndex="'+d+'"><div class="hitarea'+(c?" last":"")+'"/><span class="nodeName">'+a.nodeName+"</span>"+g+'<button class="killNode icon"/><ul class="nodeCore"><li><p class="nodeValue">'+e+'</p></li><li class="last"><a href="#" class="addChild">add child</a></li></ul></li>'},
renderAsHTML:function(){var b=q.$container.empty(),c,d=[],f=0;l.trigger("beforeHtmlRendered");m=[];a(q.xml,function(a){if(1===a.nodeType||8===a.nodeType){m.push(a);var e=$(a).prev(),g=a;do g=g.nextSibling;while(g&&1!==g.nodeType);g=q.getNewNodeHTML(a,"expandable",!g);g=$(g);q.log(a.nodeName,f);e.length?(q.log("appending to prev sibling's parent"),b=d[e.attr("parentRefIndex")],e.removeAttr("parentRefIndex"),$(a).attr("parentRefIndex",f),d[f]=b,f++,c=g,b.append(g)):(q.log("appending new child"),c&&
(b=c,c=!1),e=$("<ul class='children'></ul>").append(g),b.append(e),8!==a.nodeType&&(b=g,$(a).attr("parentRefIndex",f),d[f]=e,f++))}});$("*",q.xml).removeAttr("parentRefIndex");q.assignEditHandlers();$("button.icon").css({opacity:.5});l.trigger("afterHtmlRendered")},setNodeValue:function(a,b){var d=c(a);d.get(0)?d.get(0).nodeValue=b:a.textContent=b},createChild:function(a,b){function c(){var c=e.val();try{var g=b.appendChild(q.xml.createElement(c));m.push(g)}catch(B){return bm.notify(n.invalidNodeName,
"error"),e.val("").focus(),!1}g=$(q.getNewNodeHTML(g,"expandable",!0));c=d.closest("li.node");var p=c.find("ul.children");p.length?(p.find(">li.last").removeClass("last").find(">div.last").removeClass("last"),g.appendTo(p)):(c.append("<ul class='children'></ul>"),c.find(">ul.children").append(g));g.find(">span.nodeName").css({backgroundColor:"#fffc00"}).animate({backgroundColor:"#ffffff"},1500);g.find("button.icon").css({opacity:.5});e.remove();f.remove();$cancel.remove();a.show();l.trigger("contentChanged")}
var d=a.parent(),e=$("<input type='text' value='' class='newChild'/>"),f=$("<button class='submit'>Create Node</button>").click(c);$cancel=$("<button class='killChild cancel'>Cancel</button>").click(function(){$(this).remove();f.remove();e.remove();a.show()});a.hide();e.bind("keydown",function(a){13!=a.keyCode&&27!=a.keyCode||c()});d.append(e).append(f).append($cancel)},getXmlAsString:function(){return"undefined"!==typeof XMLSerializer?(new window.XMLSerializer).serializeToString(q.xml):q.xml.xml},
getXmlDOMFromString:function(a){if(jQuery)return $.parseXML(a);throw Error("No XML parser available");},createAttribute:function(a,b){function c(){var c=f.val(),m=g.val();try{$(b).attr(c,m)}catch(L){return bm.notify(n.invalidAttrName,"error"),f.val("").focus(),!1}e.remove();$("<span class='singleAttr'>"+c+"=\"<span class='attrValue' name='"+c+"'>"+(""===m?"&nbsp;":m)+'</span>"</span>').insertBefore(a);d.find("span.attrValue:last").click(function(a){a.stopPropagation();q.editAttribute($(this),b,c,
m)});a.show();l.trigger("contentChanged")}var d=a.parent(),e=$("<form></form>"),f=$("<input type='text' class='newAttrName'  name='attrName'  value=''/>"),g=$("<input type='text' class='newAttrValue' name='attrValue' value=''/>"),m=$("<button>Create Attribute</button>"),p=$("<button class='cancel'>Cancel</button>");e.submit(function(){return!1}).append(f).append("<span class='equals'>=</span>").append(g).append(m).append(p);a.hide();d.append(e);e.find("input").click(function(a){a.stopPropagation()});
e.find("input.newAttrName").bind("keydown",function(a){if(13==a.keyCode||27==a.keyCode)return!1});e.find("input.newAttrValue").bind("keydown",function(a){13!=a.keyCode&&27!=a.keyCode||c()});f.focus();m.click(function(a){a.stopPropagation();a.preventDefault();c()});p.click(function(b){b.stopPropagation();b.preventDefault();e.remove();a.show()})},editAttribute:function(a,b,c,d){function e(){d=g.val();$(b).attr(c,d);g.remove();m.remove();""===d&&(d="&nbsp;");a.html(d).show();l.trigger("contentChanged")}
var f=parseInt(a.width())+30,g=$("<input type='text' name='' value='"+d+"' style='width:"+f+"px;'/>"),m=$("<button class='killAttr icon'/>").click(function(a){a.stopPropagation();var d=$(this);bm.confirm(n.removeAttrConfirm,function(){$(b).removeAttr(c);d.parent().remove();l.trigger("contentChanged")},function(){})});a.hide().after(g);a.parent().append(m);g.get(0).focus();var p=!1;m.mousedown(function(){p=!0});g.bind("keydown",function(a){13!=a.keyCode&&27!=a.keyCode||e()}).bind("focusout",function(){p||
e();p=!1}).click(function(a){a.stopPropagation()})},editValue:function(a,b,c){var d=$("<textarea>"+c+"</textarea>"),e=$("<button class='cancel' style='float:left;'>Cancel</button>"),f=$("<button class='submit' style='float:right;'>Set Text Value</button>"),g=$("<div class='editTextValueButtons'></div>").append(e).append(f);a.hide().parent().append(d).append(g);d.get(0).focus();f.click(function(){c=d.val();q.setNodeValue(b,c);a.text(c).show().parent().find("textarea, div.editTextValueButtons").remove();
l.trigger("contentChanged")});e.click(function(){a.show().parent().find("textarea, div.editTextValueButtons").remove()})},editNode:function(a,b,c){function d(){value=e.val();e.remove();if(value!==c&&value){var b=a.parent("."+c);b.removeClass(c).addClass(value);b=m[parseInt(b.attr("nodeindex"))];$(b).changeTag(value);a.html(value).show();l.trigger("contentChanged")}else a.show()}b=parseInt(a.width())+30;var e=$("<input type='text' class='nodeName' name='' value='"+c+"' style='width:"+b+"px;'/>");a.hide().after(e);
e.get(0).focus();e.bind("keydown",function(a){13!=a.keyCode&&27!=a.keyCode||d()}).bind("focusout",function(){d()}).click(function(a){a.stopPropagation()})},removeNode:function(a,b){bm.confirm(n.removeNodeConfirm,function(){$(b).remove();var c=a.parent().prev();c.length&&(c.addClass("last"),c.find(">div.hitarea").addClass("last"));a.parent().remove();bm.notify(n.removeNodeSuccess,"success");l.trigger("contentChanged");return!0},function(){});return!1},loadXmlFromFile:function(a,b,c){q.$container=$(b);
$.ajax({type:"GET",async:!1,url:a,dataType:"xml",error:function(){bm.notify(n.xmlLoadProblem,"error")},success:function(a){q.xml=a;c()}})},loadXmlFromString:function(a,b,c){q.$container=b;try{q.xml=q.getXmlDOMFromString(a)}catch(w){bm.notify($.i18n.prop("invalid.xml.document"),"error")}c()},renderTree:function(){q.renderAsHTML();q.$container.find("ul:first").addClass("treeview")},on:function(a,b,c){l.bind(a,b,c)}};return loggable(q,"xmlEditor")};
if(!GLR){var GLR=function(){if("undefined"==typeof $)throw Error("jQuery must be available.");if(!window.console){var a="log debug info warn error assert dir dirxml group groupEnd time timeEnd count trace profile profileEnd".split(" ");window.console={};for(var b=0;b<a.length;b++)window.console[a[b]]=function(){}}var d=[],c=[],f={require:function(){for(var a,b,c=0,n=arguments.length;c<n;c++)a="/"!=arguments[c].charAt(0)?"js/ext/GLR/"+arguments[c]:arguments[c],b=eval(f.string.getPathInfo(a).file),
-1==$.inArray(a,d)&&"object"!=typeof b&&($.ajax({type:"GET",url:a,dataType:"script",async:!1,cache:!0}),d.push(a))},applyCSS:function(){for(var a,b=0,d=arguments.length;b<d;b++)a="/"!=arguments[b].charAt(0)?"js/ext/GLR/css/"+arguments[b]:arguments[b],-1==$.inArray(a,c)&&($("<link rel='stylesheet' type='text/css' href='"+a+"'/>").appendTo("head"),c.push(a))},beget:function(a){if("object"==typeof a&&null!==a){var b=function(){};b.prototype=a;return new b}throw Error("GLR.beget() was called with an invalid or null argument. (Object expected)");
},string:{isEmpty:function(a){if("string"===typeof a)return!/\w+/.test(a)},isNumeric:function(a){if("string"===typeof a)return/^((-)?([0-9]*)((\.{0,1})([0-9]+))?$)/.test(a)},isValidEmail:function(a){return/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(a)},stripHtml:function(a){return a.replace(/(<([^>]+)>)/ig,"")},getPathInfo:function(a){a=a.match(/(.*)[\/\\]([^\/\\]+)\.\w+$/);return{path:a[1],file:a[2]}}},browser:{isWin:-1!=window.navigator.platform.toLowerCase().indexOf("win")?1:0,isMac:-1!=
window.navigator.platform.toLowerCase().indexOf("mac")?1:0},win:{getWidth:function(){return $.browser.safari?document.documentElement.clientWidth:$(window).width()},getHeight:function(){return $.browser.safari?document.documentElement.clientHeight:$(window).height()}},removeFilter:function(a){$.browser.msie&&a.style.removeAttribute("filter")}};return f}();jQuery.fn.extend({resizeEnd:function(a){$(this).resize(function(){var b=a.toString();$.browser.msie||$.browser.safari?(GLR.resizeTimeout||(GLR.resizeTimeout=
{}),null!==GLR.resizeTimeout[b]&&clearTimeout(GLR.resizeTimeout[b]),GLR.resizeTimeout[b]=setTimeout(a,300)):a()})}})}
(function(){var a=this,b=a.Chart,d=function(a){this.canvas=a.canvas;this.ctx=a;this.width=a.canvas.width;this.height=a.canvas.height;return this.aspectRatio=this.width/this.height,c.retinaScale(this),this};d.defaults={global:{animation:!0,animationSteps:60,animationEasing:"easeOutQuart",showScale:!0,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!0,scaleLabel:"<%=value%>",scaleIntegersOnly:!0,scaleBeginAtZero:!1,
scaleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",responsive:!1,maintainAspectRatio:!0,showTooltips:!0,tooltipEvents:["mousemove","touchstart","touchmove","mouseout"],tooltipFillColor:"rgba(0,0,0,0.8)",tooltipFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipFontSize:14,tooltipFontStyle:"normal",tooltipFontColor:"#fff",tooltipTitleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipTitleFontSize:14,
tooltipTitleFontStyle:"bold",tooltipTitleFontColor:"#fff",tooltipYPadding:6,tooltipXPadding:6,tooltipCaretSize:8,tooltipCornerRadius:6,tooltipXOffset:10,tooltipTemplate:"<%if (label){%><%=label%>: <%}%><%= value %>",multiTooltipTemplate:"<%= value %>",multiTooltipKeyBackground:"#fff",onAnimationProgress:function(){},onAnimationComplete:function(){}}};d.types={};var c=d.helpers={},f=c.each=function(a,b,c){var d=Array.prototype.slice.call(arguments,3);if(a)if(a.length===+a.length){var e;for(e=0;e<a.length;e++)b.apply(c,
[a[e],e].concat(d))}else for(e in a)b.apply(c,[a[e],e].concat(d))},g=c.clone=function(a){var b={};return f(a,function(c,d){a.hasOwnProperty(d)&&(b[d]=c)}),b},m=c.extend=function(a){return f(Array.prototype.slice.call(arguments,1),function(b){f(b,function(c,d){b.hasOwnProperty(d)&&(a[d]=c)})}),a},l=c.merge=function(){var a=Array.prototype.slice.call(arguments,0);return a.unshift({}),m.apply(null,a)},n=c.indexOf=function(a,b){if(Array.prototype.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(a[c]===
b)return c;return-1},q=(c.where=function(a,b){var d=[];return c.each(a,function(a){b(a)&&d.push(a)}),d},c.findNextWhere=function(a,b,c){c||(c=-1);for(c+=1;c<a.length;c++){var d=a[c];if(b(d))return d}},c.findPreviousWhere=function(a,b,c){c||(c=a.length);for(--c;0<=c;c--){var d=a[c];if(b(d))return d}},c.inherits=function(a){var b=this,c=a&&a.hasOwnProperty("constructor")?a.constructor:function(){return b.apply(this,arguments)},d=function(){this.constructor=c};return d.prototype=b.prototype,c.prototype=
new d,c.extend=q,a&&m(c.prototype,a),c.__super__=b.prototype,c}),e=c.noop=function(){},p=c.uid=function(){var a=0;return function(){return"chart-"+a++}}(),t=c.warn=function(a){window.console&&"function"==typeof window.console.warn&&console.warn(a)},w=c.amd="function"==typeof a.define&&a.define.amd,y=c.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},A=c.max=function(a){return Math.max.apply(Math,a)},x=c.min=function(a){return Math.min.apply(Math,a)},z=(c.cap=function(a,b,c){if(y(b)){if(a>
b)return b}else if(y(c)&&c>a)return c;return a},c.getDecimalPlaces=function(a){return 0!==a%1&&y(a)?a.toString().split(".")[1].length:0}),D=c.radians=function(a){return Math.PI/180*a},B=(c.getAngleFromPoint=function(a,b){var c=b.x-a.x;a=b.y-a.y;b=Math.sqrt(c*c+a*a);var d=2*Math.PI+Math.atan2(a,c);return 0>c&&0>a&&(d+=2*Math.PI),{angle:d,distance:b}},c.aliasPixel=function(a){return 0===a%2?0:.5}),G=(c.splineCurve=function(a,b,c,d){var e=Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)),f=Math.sqrt(Math.pow(c.x-
b.x,2)+Math.pow(c.y-b.y,2)),g=d*e/(e+f);d=d*f/(e+f);return{inner:{x:b.x-g*(c.x-a.x),y:b.y-g*(c.y-a.y)},outer:{x:b.x+d*(c.x-a.x),y:b.y+d*(c.y-a.y)}}},c.calculateOrderOfMagnitude=function(a){return Math.floor(Math.log(a)/Math.LN10)}),L=(c.calculateScaleRange=function(a,b,c,d,e){b=Math.floor(b/(1.5*c));c=2>=b;var f=A(a),g=x(a);f===g&&(f+=.5,.5<=g&&!d?g-=.5:f+=.5);a=G(Math.abs(f-g));d=d?0:Math.floor(g/(1*Math.pow(10,a)))*Math.pow(10,a);f=Math.ceil(f/(1*Math.pow(10,a)))*Math.pow(10,a)-d;g=Math.pow(10,
a);for(var l=Math.round(f/g);(l>b||b>2*l)&&!c;)if(l>b)g*=2,l=Math.round(f/g),0!==l%1&&(c=!0);else{if(e&&0<=a&&0!==g/2%1)break;g/=2;l=Math.round(f/g)}return c&&(l=2,g=f/l),{steps:l,stepValue:g,min:d,max:d+l*g}},c.template=function(a,b){if(a instanceof Function)return a(b);var c={};a=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+
"');}return p.join('');"):c[a]=c[a];return b?a(b):a}),J=(c.generateLabels=function(a,b,c,d){var e=Array(b);return labelTemplateString&&f(e,function(b,f){e[f]=L(a,{value:c+d*(f+1)})}),e},c.easingEffects={linear:function(a){return a},easeInQuad:function(a){return a*a},easeOutQuad:function(a){return-1*a*(a-2)},easeInOutQuad:function(a){return 1>(a/=.5)?.5*a*a:-.5*(--a*(a-2)-1)},easeInCubic:function(a){return a*a*a},easeOutCubic:function(a){return 1*((a=a/1-1)*a*a+1)},easeInOutCubic:function(a){return 1>
(a/=.5)?.5*a*a*a:.5*((a-=2)*a*a+2)},easeInQuart:function(a){return a*a*a*a},easeOutQuart:function(a){return-1*((a=a/1-1)*a*a*a-1)},easeInOutQuart:function(a){return 1>(a/=.5)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)},easeInQuint:function(a){return 1*(a/=1)*a*a*a*a},easeOutQuint:function(a){return 1*((a=a/1-1)*a*a*a*a+1)},easeInOutQuint:function(a){return 1>(a/=.5)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)},easeInSine:function(a){return-1*Math.cos(a/1*(Math.PI/2))+1},easeOutSine:function(a){return 1*Math.sin(a/1*
(Math.PI/2))},easeInOutSine:function(a){return-.5*(Math.cos(Math.PI*a/1)-1)},easeInExpo:function(a){return 0===a?1:1*Math.pow(2,10*(a/1-1))},easeOutExpo:function(a){return 1===a?1:1*(-Math.pow(2,-10*a/1)+1)},easeInOutExpo:function(a){return 0===a?0:1===a?1:1>(a/=.5)?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},easeInCirc:function(a){return 1<=a?a:-1*(Math.sqrt(1-(a/=1)*a)-1)},easeOutCirc:function(a){return 1*Math.sqrt(1-(a=a/1-1)*a)},easeInOutCirc:function(a){return 1>(a/=.5)?-.5*(Math.sqrt(1-
a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},easeInElastic:function(a){var b=1.70158,c=0,d=1;return 0===a?0:1==(a/=1)?1:(c||(c=.3),d<Math.abs(1)?(d=1,b=c/4):b=c/(2*Math.PI)*Math.asin(1/d),-(d*Math.pow(2,10*--a)*Math.sin(2*(1*a-b)*Math.PI/c)))},easeOutElastic:function(a){var b=1.70158,c=0,d=1;return 0===a?0:1==(a/=1)?1:(c||(c=.3),d<Math.abs(1)?(d=1,b=c/4):b=c/(2*Math.PI)*Math.asin(1/d),d*Math.pow(2,-10*a)*Math.sin(2*(1*a-b)*Math.PI/c)+1)},easeInOutElastic:function(a){var b=1.70158,c=0,d=1;return 0===a?0:
2==(a/=.5)?1:(c||(c=.3*1.5),d<Math.abs(1)?(d=1,b=c/4):b=c/(2*Math.PI)*Math.asin(1/d),1>a?-.5*d*Math.pow(2,10*--a)*Math.sin(2*(1*a-b)*Math.PI/c):d*Math.pow(2,-10*--a)*Math.sin(2*(1*a-b)*Math.PI/c)*.5+1)},easeInBack:function(a){return 1*(a/=1)*a*(2.70158*a-1.70158)},easeOutBack:function(a){return 1*((a=a/1-1)*a*(2.70158*a+1.70158)+1)},easeInOutBack:function(a){var b=1.70158;return 1>(a/=.5)?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},easeInBounce:function(a){return 1-J.easeOutBounce(1-
a)},easeOutBounce:function(a){return(a/=1)<1/2.75?7.5625*a*a:2/2.75>a?1*(7.5625*(a-=1.5/2.75)*a+.75):2.5/2.75>a?1*(7.5625*(a-=2.25/2.75)*a+.9375):1*(7.5625*(a-=2.625/2.75)*a+.984375)},easeInOutBounce:function(a){return.5>a?.5*J.easeInBounce(2*a):.5*J.easeOutBounce(2*a-1)+.5}}),P=c.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,
1E3/60)}}(),fa=(c.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(a){return window.clearTimeout(a,1E3/60)}}(),c.animationLoop=function(a,b,c,d,e,f){var g=0,l=J[c]||J.linear,m=function(){g++;var c=g/b,n=l(c);a.call(f,n,c,g);d.call(f,n,c);b>g?f.animationFrame=P(m):e.apply(f)};P(m)},c.getRelativePosition=function(a){var b,c,d=a.originalEvent||a;a=(a.currentTarget||
a.srcElement).getBoundingClientRect();return d.touches?(b=d.touches[0].clientX-a.left,c=d.touches[0].clientY-a.top):(b=d.clientX-a.left,c=d.clientY-a.top),{x:b,y:c}},c.addEvent=function(a,b,c){a.addEventListener?a.addEventListener(b,c):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}),da=c.removeEvent=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=e},M=(c.bindEvents=function(a,b,c){a.events||(a.events={});f(b,function(b){a.events[b]=
function(){c.apply(a,arguments)};fa(a.chart.canvas,b,a.events[b])})},c.unbindEvents=function(a,b){f(b,function(b,c){da(a.chart.canvas,c,b)})}),V=c.getMaximumWidth=function(a){return $(a.parentNode).width()},ea=c.getMaximumHeight=function(a){return $(a.parentNode).height()},Y=(c.getMaximumSize=c.getMaximumWidth,c.retinaScale=function(a){var b=a.ctx,c=a.canvas.width;a=a.canvas.height;window.devicePixelRatio&&(b.canvas.style.width=c+"px",b.canvas.style.height=a+"px",b.canvas.height=a*window.devicePixelRatio,
b.canvas.width=c*window.devicePixelRatio,b.scale(window.devicePixelRatio,window.devicePixelRatio))}),pa=c.clear=function(a){a.ctx.clearRect(0,0,a.width,a.height)},N=c.fontString=function(a,b,c){return b+" "+a+"px "+c},Z=c.longestText=function(a,b,c){a.font=b;var d=0;return f(c,function(b){b=a.measureText(b).width;d=b>d?b:d}),d},S=c.drawRoundedRectangle=function(a,b,c,d,e,f){a.beginPath();a.moveTo(b+f,c);a.lineTo(b+d-f,c);a.quadraticCurveTo(b+d,c,b+d,c+f);a.lineTo(b+d,c+e-f);a.quadraticCurveTo(b+d,
c+e,b+d-f,c+e);a.lineTo(b+f,c+e);a.quadraticCurveTo(b,c+e,b,c+e-f);a.lineTo(b,c+f);a.quadraticCurveTo(b,c,b+f,c);a.closePath()};d.instances={};d.Type=function(a,b,c){this.options=b;this.chart=c;this.id=p();d.instances[this.id]=this;b.responsive&&this.resize();this.initialize.call(this,a)};m(d.Type.prototype,{initialize:function(){return this},clear:function(){return pa(this.chart),this},stop:function(){return c.cancelAnimFrame.call(a,this.animationFrame),this},resize:function(a){this.stop();var b=
this.chart.canvas,c=V(this.chart.canvas),d=this.options.maintainAspectRatio?c/this.chart.aspectRatio:ea(this.chart.canvas);return b.width=this.chart.width=c,b.height=this.chart.height=d,Y(this.chart),"function"==typeof a&&a.apply(this,Array.prototype.slice.call(arguments,1)),this},reflow:e,render:function(a){return a&&this.reflow(),this.options.animation&&!a?c.animationLoop(this.draw,this.options.animationSteps,this.options.animationEasing,this.options.onAnimationProgress,this.options.onAnimationComplete,
this):(this.draw(),this.options.onAnimationComplete.call(this)),this},generateLegend:function(){return L(this.options.legendTemplate,this)},destroy:function(){this.clear();M(this,this.events);delete d.instances[this.id]},showTooltip:function(a,b){"undefined"==typeof this.activeElements&&(this.activeElements=[]);if(function(a){var b=!1;return a.length!==this.activeElements.length?b=!0:(f(a,function(a,c){a!==this.activeElements[c]&&(b=!0)},this),b)}.call(this,a)||b){if(this.activeElements=a,this.draw(),
0<a.length)if(this.datasets&&1<this.datasets.length){var e,g;for(b=this.datasets.length-1;0<=b&&(e=this.datasets[b].points||this.datasets[b].bars||this.datasets[b].segments,g=n(e,a[0]),-1===g);b--);var l=[],m=[];e=function(){var a,b,d,e,f,n=[],p=[],q=[];return c.each(this.datasets,function(b){a=b.points||b.bars||b.segments;a[g]&&a[g].hasValue()&&n.push(a[g])}),c.each(n,function(a){p.push(a.x);q.push(a.y);l.push(c.template(this.options.multiTooltipTemplate,a));m.push({fill:a._saved.fillColor||a.fillColor,
stroke:a._saved.strokeColor||a.strokeColor})},this),f=x(q),d=A(q),e=x(p),b=A(p),{x:e>this.chart.width/2?e:b,y:(f+d)/2}}.call(this,g);(new d.MultiTooltip({x:e.x,y:e.y,xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,xOffset:this.options.tooltipXOffset,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,titleTextColor:this.options.tooltipTitleFontColor,
titleFontFamily:this.options.tooltipTitleFontFamily,titleFontStyle:this.options.tooltipTitleFontStyle,titleFontSize:this.options.tooltipTitleFontSize,cornerRadius:this.options.tooltipCornerRadius,labels:l,legendColors:m,legendColorBackground:this.options.multiTooltipKeyBackground,title:a[0].label,chart:this.chart,ctx:this.chart.ctx})).draw()}else f(a,function(a){var b=a.tooltipPosition();(new d.Tooltip({x:Math.round(b.x),y:Math.round(b.y),xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,
fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,caretHeight:this.options.tooltipCaretSize,cornerRadius:this.options.tooltipCornerRadius,text:L(this.options.tooltipTemplate,a),chart:this.chart})).draw()},this);return this}},toBase64Image:function(){return this.chart.canvas.toDataURL.apply(this.chart.canvas,arguments)}});d.Type.extend=function(a){var b=
this,c=function(){return b.apply(this,arguments)};if(c.prototype=g(b.prototype),m(c.prototype,a),c.extend=d.Type.extend,a.name||b.prototype.name){var e=a.name||b.prototype.name,f=d.defaults[b.prototype.name]?g(d.defaults[b.prototype.name]):{};d.defaults[e]=m(f,a.defaults);d.types[e]=c;d.prototype[e]=function(a,b){b=l(d.defaults.global,d.defaults[e],b||{});return new c(a,b,this)}}else t("Name not provided for this chart, so it hasn't been registered");return b};d.Element=function(a){m(this,a);this.initialize.apply(this,
arguments);this.save()};m(d.Element.prototype,{initialize:function(){},restore:function(a){return a?f(a,function(a){this[a]=this._saved[a]},this):m(this,this._saved),this},save:function(){return this._saved=g(this),delete this._saved._saved,this},update:function(a){return f(a,function(a,b){this._saved[b]=this[b];this[b]=a},this),this},transition:function(a,b){return f(a,function(a,c){this[c]=(a-this._saved[c])*b+this._saved[c]},this),this},tooltipPosition:function(){return{x:this.x,y:this.y}},hasValue:function(){return y(this.value)}});
d.Element.extend=q;d.Point=d.Element.extend({display:!0,inRange:function(a,b){return Math.pow(a-this.x,2)+Math.pow(b-this.y,2)<Math.pow(this.hitDetectionRadius+this.radius,2)},draw:function(){if(this.display){var a=this.ctx;a.beginPath();a.arc(this.x,this.y,this.radius,0,2*Math.PI);a.closePath();a.strokeStyle=this.strokeColor;a.lineWidth=this.strokeWidth;a.fillStyle=this.fillColor;a.fill();a.stroke()}}});d.Arc=d.Element.extend({inRange:function(a,b){a=c.getAngleFromPoint(this,{x:a,y:b});b=a.distance>=
this.innerRadius&&a.distance<=this.outerRadius;return a.angle>=this.startAngle&&a.angle<=this.endAngle&&b},tooltipPosition:function(){var a=this.startAngle+(this.endAngle-this.startAngle)/2,b=(this.outerRadius-this.innerRadius)/2+this.innerRadius;return{x:this.x+Math.cos(a)*b,y:this.y+Math.sin(a)*b}},draw:function(a){a=this.ctx;a.beginPath();a.arc(this.x,this.y,this.outerRadius,this.startAngle,this.endAngle);a.arc(this.x,this.y,this.innerRadius,this.endAngle,this.startAngle,!0);a.closePath();a.strokeStyle=
this.strokeColor;a.lineWidth=this.strokeWidth;a.fillStyle=this.fillColor;a.fill();a.lineJoin="bevel";this.showStroke&&a.stroke()}});d.Rectangle=d.Element.extend({draw:function(){var a=this.ctx,b=this.width/2,c=this.x-b;b=this.x+b;var d=this.base-(this.base-this.y),e=this.strokeWidth/2;this.showStroke&&(c+=e,b-=e,d+=e);a.beginPath();a.fillStyle=this.fillColor;a.strokeStyle=this.strokeColor;a.lineWidth=this.strokeWidth;a.moveTo(c,this.base);a.lineTo(c,d);a.lineTo(b,d);a.lineTo(b,this.base);a.fill();
this.showStroke&&a.stroke()},height:function(){return this.base-this.y},inRange:function(a,b){return a>=this.x-this.width/2&&a<=this.x+this.width/2&&b>=this.y&&b<=this.base}});d.Tooltip=d.Element.extend({draw:function(){var a=this.chart.ctx;a.font=N(this.fontSize,this.fontStyle,this.fontFamily);this.xAlign="center";this.yAlign="above";var b=a.measureText(this.text).width+2*this.xPadding,c=this.fontSize+2*this.yPadding,d=c+this.caretHeight+2;this.x+b/2>this.chart.width?this.xAlign="left":0>this.x-
b/2&&(this.xAlign="right");0>this.y-d&&(this.yAlign="below");var e=this.x-b/2;d=this.y-d;switch(a.fillStyle=this.fillColor,this.yAlign){case "above":a.beginPath();a.moveTo(this.x,this.y-2);a.lineTo(this.x+this.caretHeight,this.y-(2+this.caretHeight));a.lineTo(this.x-this.caretHeight,this.y-(2+this.caretHeight));a.closePath();a.fill();break;case "below":d=this.y+2+this.caretHeight,a.beginPath(),a.moveTo(this.x,this.y+2),a.lineTo(this.x+this.caretHeight,this.y+2+this.caretHeight),a.lineTo(this.x-this.caretHeight,
this.y+2+this.caretHeight),a.closePath(),a.fill()}switch(this.xAlign){case "left":e=this.x-b+(this.cornerRadius+this.caretHeight);break;case "right":e=this.x-(this.cornerRadius+this.caretHeight)}S(a,e,d,b,c,this.cornerRadius);a.fill();a.fillStyle=this.textColor;a.textAlign="center";a.textBaseline="middle";a.fillText(this.text,e+b/2,d+c/2)}});d.MultiTooltip=d.Element.extend({initialize:function(){this.font=N(this.fontSize,this.fontStyle,this.fontFamily);this.titleFont=N(this.titleFontSize,this.titleFontStyle,
this.titleFontFamily);this.height=this.labels.length*this.fontSize+this.fontSize/2*(this.labels.length-1)+2*this.yPadding+1.5*this.titleFontSize;this.ctx.font=this.titleFont;var a=this.ctx.measureText(this.title).width,b=Z(this.ctx,this.font,this.labels)+this.fontSize+3;this.width=A([b,a])+2*this.xPadding;a=this.height/2;0>this.y-a?this.y=a:this.y+a>this.chart.height&&(this.y=this.chart.height-a);this.x>this.chart.width/2?this.x-=this.xOffset+this.width:this.x+=this.xOffset},getLineHeight:function(a){var b=
this.y-this.height/2+this.yPadding;return 0===a?b+this.titleFontSize/2:b+(1.5*this.fontSize*(a-1)+this.fontSize/2)+1.5*this.titleFontSize},draw:function(){S(this.ctx,this.x,this.y-this.height/2,this.width,this.height,this.cornerRadius);var a=this.ctx;a.fillStyle=this.fillColor;a.fill();a.closePath();a.textAlign="left";a.textBaseline="middle";a.fillStyle=this.titleTextColor;a.font=this.titleFont;a.fillText(this.title,this.x+this.xPadding,this.getLineHeight(0));a.font=this.font;c.each(this.labels,function(b,
c){a.fillStyle=this.textColor;a.fillText(b,this.x+this.xPadding+this.fontSize+3,this.getLineHeight(c+1));a.fillStyle=this.legendColorBackground;a.fillRect(this.x+this.xPadding,this.getLineHeight(c+1)-this.fontSize/2,this.fontSize,this.fontSize);a.fillStyle=this.legendColors[c].fill;a.fillRect(this.x+this.xPadding,this.getLineHeight(c+1)-this.fontSize/2,this.fontSize,this.fontSize)},this)}});d.Scale=d.Element.extend({initialize:function(){this.fit()},buildYLabels:function(){this.yLabels=[];for(var a=
z(this.stepValue),b=0;b<=this.steps;b++)this.yLabels.push(L(this.templateString,{value:(this.min+b*this.stepValue).toFixed(a)}));this.yLabelWidth=this.display&&this.showLabels?Z(this.ctx,this.font,this.yLabels):0},addXLabel:function(a){this.xLabels.push(a);this.valuesCount++;this.fit()},removeXLabel:function(){this.xLabels.shift();this.valuesCount--;this.fit()},fit:function(){this.startPoint=this.display?this.fontSize:0;this.endPoint=this.display?this.height-1.5*this.fontSize-5:this.height;this.startPoint+=
this.padding;this.endPoint-=this.padding;var a=this.endPoint-this.startPoint;this.calculateYRange(a);this.buildYLabels();for(this.calculateXLabelRotation();a>this.endPoint-this.startPoint;){a=this.endPoint-this.startPoint;var b=this.yLabelWidth;this.calculateYRange(a);this.buildYLabels();b<this.yLabelWidth&&this.calculateXLabelRotation()}},calculateXLabelRotation:function(){this.ctx.font=this.font;var a=this.ctx.measureText(this.xLabels[0]).width;if(this.xScalePaddingRight=this.ctx.measureText(this.xLabels[this.xLabels.length-
1]).width/2+3,this.xScalePaddingLeft=a/2>this.yLabelWidth+10?a/2:this.yLabelWidth+10,this.xLabelRotation=0,this.display){var b=Z(this.ctx,this.font,this.xLabels);this.xLabelWidth=b;for(var c=Math.floor(this.calculateX(1)-this.calculateX(0))-6;this.xLabelWidth>c&&0===this.xLabelRotation||this.xLabelWidth>c&&90>=this.xLabelRotation&&0<this.xLabelRotation;){var d=Math.cos(D(this.xLabelRotation));var e=d*a;e+this.fontSize/2>this.yLabelWidth+8&&(this.xScalePaddingLeft=e+this.fontSize/2);this.xScalePaddingRight=
this.fontSize/2;this.xLabelRotation++;this.xLabelWidth=d*b}0<this.xLabelRotation&&(this.endPoint-=Math.sin(D(this.xLabelRotation))*b+3)}else this.xLabelWidth=0,this.xScalePaddingLeft=this.xScalePaddingRight=this.padding},calculateYRange:e,drawingArea:function(){return this.startPoint-this.endPoint},calculateY:function(a){var b=this.drawingArea()/(this.min-this.max);return this.endPoint-b*(a-this.min)},calculateX:function(a){var b=(0<this.xLabelRotation,this.width-(this.xScalePaddingLeft+this.xScalePaddingRight))/
(this.valuesCount-(this.offsetGridLines?0:1));a=b*a+this.xScalePaddingLeft;return this.offsetGridLines&&(a+=b/2),Math.round(a)},update:function(a){c.extend(this,a);this.fit()},draw:function(){var a=this.ctx,b=(this.endPoint-this.startPoint)/this.steps,d=Math.round(this.xScalePaddingLeft);this.display&&(a.fillStyle=this.textColor,a.font=this.font,f(this.yLabels,function(e,f){var g=this.endPoint-b*f,l=Math.round(g);a.textAlign="right";a.textBaseline="middle";this.showLabels&&a.fillText(e,d-10,g);a.beginPath();
0<f?(a.lineWidth=this.gridLineWidth,a.strokeStyle=this.gridLineColor):(a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor);l+=c.aliasPixel(a.lineWidth);a.moveTo(d,l);a.lineTo(this.width,l);a.stroke();a.closePath();a.lineWidth=this.lineWidth;a.strokeStyle=this.lineColor;a.beginPath();a.moveTo(d-5,l);a.lineTo(d,l);a.stroke();a.closePath()},this),f(this.xLabels,function(b,c){var d=this.calculateX(c)+B(this.lineWidth),e=this.calculateX(c-(this.offsetGridLines?.5:0))+B(this.lineWidth),f=0<this.xLabelRotation;
a.beginPath();0<c?(a.lineWidth=this.gridLineWidth,a.strokeStyle=this.gridLineColor):(a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor);a.moveTo(e,this.endPoint);a.lineTo(e,this.startPoint-3);a.stroke();a.closePath();a.lineWidth=this.lineWidth;a.strokeStyle=this.lineColor;a.beginPath();a.moveTo(e,this.endPoint);a.lineTo(e,this.endPoint+5);a.stroke();a.closePath();a.save();a.translate(d,f?this.endPoint+12:this.endPoint+8);a.rotate(-1*D(this.xLabelRotation));a.font=this.font;a.textAlign=f?"right":
"center";a.textBaseline=f?"middle":"top";a.fillText(b,0,0);a.restore()},this))}});d.RadialScale=d.Element.extend({initialize:function(){this.size=x([this.height,this.width]);this.drawingArea=this.display?this.size/2-(this.fontSize/2+this.backdropPaddingY):this.size/2},calculateCenterOffset:function(a){return this.drawingArea/(this.max-this.min)*(a-this.min)},update:function(){this.lineArc?this.drawingArea=this.display?this.size/2-(this.fontSize/2+this.backdropPaddingY):this.size/2:this.setScaleSize();
this.buildYLabels()},buildYLabels:function(){this.yLabels=[];for(var a=z(this.stepValue),b=0;b<=this.steps;b++)this.yLabels.push(L(this.templateString,{value:(this.min+b*this.stepValue).toFixed(a)}))},getCircumference:function(){return 2*Math.PI/this.valuesCount},setScaleSize:function(){var a,b,c,d,e=x([this.height/2-this.pointLabelFontSize-5,this.width/2]);var f=this.width;var g=0;this.ctx.font=N(this.pointLabelFontSize,this.pointLabelFontStyle,this.pointLabelFontFamily);for(a=0;a<this.valuesCount;a++){var l=
this.getPointPosition(a,e);var m=this.ctx.measureText(L(this.templateString,{value:this.labels[a]})).width+5;0===a||a===this.valuesCount/2?(b=m/2,l.x+b>f&&(f=l.x+b,c=a),l.x-b<g&&(g=l.x-b,d=a)):a<this.valuesCount/2?l.x+m>f&&(f=l.x+m,c=a):a>this.valuesCount/2&&l.x-m<g&&(g=l.x-m,d=a)}l=g;f=Math.ceil(f-this.width);c=this.getIndexAngle(c);d=this.getIndexAngle(d);c=f/Math.sin(c+Math.PI/2);d=l/Math.sin(d+Math.PI/2);c=y(c)?c:0;d=y(d)?d:0;this.drawingArea=e-(d+c)/2;this.setCenterPoint(d,c)},setCenterPoint:function(a,
b){this.xCenter=(a+this.drawingArea+(this.width-b-this.drawingArea))/2;this.yCenter=this.height/2},getIndexAngle:function(a){return 2*Math.PI/this.valuesCount*a-Math.PI/2},getPointPosition:function(a,b){a=this.getIndexAngle(a);return{x:Math.cos(a)*b+this.xCenter,y:Math.sin(a)*b+this.yCenter}},draw:function(){if(this.display){var a=this.ctx;if(f(this.yLabels,function(b,c){if(0<c){var d=this.drawingArea/this.steps*c;var e=this.yCenter-d;if(0<this.lineWidth){if(a.strokeStyle=this.lineColor,a.lineWidth=
this.lineWidth,this.lineArc)a.beginPath(),a.arc(this.xCenter,this.yCenter,d,0,2*Math.PI);else{a.beginPath();for(var f=0;f<this.valuesCount;f++)d=this.getPointPosition(f,this.calculateCenterOffset(this.min+c*this.stepValue)),0===f?a.moveTo(d.x,d.y):a.lineTo(d.x,d.y)}a.closePath();a.stroke()}if(this.showLabels){if(a.font=N(this.fontSize,this.fontStyle,this.fontFamily),this.showLabelBackdrop)c=a.measureText(b).width,a.fillStyle=this.backdropColor,a.fillRect(this.xCenter-c/2-this.backdropPaddingX,e-this.fontSize/
2-this.backdropPaddingY,c+2*this.backdropPaddingX,this.fontSize+2*this.backdropPaddingY);a.textAlign="center";a.textBaseline="middle";a.fillStyle=this.fontColor;a.fillText(b,this.xCenter,e)}}},this),!this.lineArc){a.lineWidth=this.angleLineWidth;a.strokeStyle=this.angleLineColor;for(var b=this.valuesCount-1;0<=b;b--){if(0<this.angleLineWidth){var c=this.getPointPosition(b,this.calculateCenterOffset(this.max));a.beginPath();a.moveTo(this.xCenter,this.yCenter);a.lineTo(c.x,c.y);a.stroke();a.closePath()}c=
this.getPointPosition(b,this.calculateCenterOffset(this.max)+5);a.font=N(this.pointLabelFontSize,this.pointLabelFontStyle,this.pointLabelFontFamily);a.fillStyle=this.pointLabelFontColor;var d=this.labels.length,e=this.labels.length/2,g=e/2,l=g>b||b>d-g;d=b===g||b===d-g;a.textAlign=0===b?"center":b===e?"center":e>b?"left":"right";a.textBaseline=d?"middle":l?"bottom":"top";a.fillText(this.labels[b],c.x,c.y)}}}}});c.addEvent(window,"resize",function(){var a;return function(){clearTimeout(a);a=setTimeout(function(){f(d.instances,
function(a){a.options.responsive&&a.resize(a.render,!0)})},50)}}());w?define(function(){return d}):"object"==typeof module&&module.exports&&(module.exports=d);a.Chart=d;d.noConflict=function(){return a.Chart=b,d}}).call(this);
(function(){var a=this.Chart,b=a.helpers;a.Type.extend({name:"Bar",defaults:{scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'},initialize:function(d){var c=
this.options;this.ScaleClass=a.Scale.extend({offsetGridLines:!0,calculateBarX:function(a,b,d){var f=this.calculateBaseWidth();d=this.calculateX(d)-f/2;a=this.calculateBarWidth(a);return d+a*b+b*c.barDatasetSpacing+a/2},calculateBaseWidth:function(){return this.calculateX(1)-this.calculateX(0)-2*c.barValueSpacing},calculateBarWidth:function(a){return(this.calculateBaseWidth()-(a-1)*c.barDatasetSpacing)/a}});this.datasets=[];this.options.showTooltips&&b.bindEvents(this,this.options.tooltipEvents,function(a){a=
"mouseout"!==a.type?this.getBarsAtEvent(a):[];this.eachBars(function(a){a.restore(["fillColor","strokeColor"])});b.each(a,function(a){a.fillColor=a.highlightFill;a.strokeColor=a.highlightStroke});this.showTooltip(a)});this.BarClass=a.Rectangle.extend({strokeWidth:this.options.barStrokeWidth,showStroke:this.options.barShowStroke,ctx:this.chart.ctx});b.each(d.datasets,function(a){var c={label:a.label||null,fillColor:a.fillColor,strokeColor:a.strokeColor,bars:[]};this.datasets.push(c);b.each(a.data,
function(b,f){c.bars.push(new this.BarClass({value:b,label:d.labels[f],datasetLabel:a.label,strokeColor:a.strokeColor,fillColor:a.fillColor,highlightFill:a.highlightFill||a.fillColor,highlightStroke:a.highlightStroke||a.strokeColor}))},this)},this);this.buildScale(d.labels);this.BarClass.prototype.base=this.scale.endPoint;this.eachBars(function(a,c,d){b.extend(a,{width:this.scale.calculateBarWidth(this.datasets.length),x:this.scale.calculateBarX(this.datasets.length,d,c),y:this.scale.endPoint});a.save()},
this);this.render()},update:function(){this.scale.update();b.each(this.activeElements,function(a){a.restore(["fillColor","strokeColor"])});this.eachBars(function(a){a.save()});this.render()},eachBars:function(a){b.each(this.datasets,function(c,d){b.each(c.bars,a,this,d)},this)},getBarsAtEvent:function(a){var c,d=[];a=b.getRelativePosition(a);for(var g=function(a){d.push(a.bars[c])},m=0;m<this.datasets.length;m++)for(c=0;c<this.datasets[m].bars.length;c++)if(this.datasets[m].bars[c].inRange(a.x,a.y))return b.each(this.datasets,
g),d;return d},buildScale:function(a){var c=this,d=function(){var a=[];return c.eachBars(function(b){a.push(b.value)}),a};a={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:a.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(a){a=
b.calculateScaleRange(d(),a,this.fontSize,this.beginAtZero,this.integersOnly);b.extend(this,a)},xLabels:a,font:b.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.barShowStroke?
this.options.barStrokeWidth:0,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&b.extend(a,{calculateYRange:b.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth});this.scale=new this.ScaleClass(a)},addData:function(a,c){b.each(a,function(a,b){this.datasets[b].bars.push(new this.BarClass({value:a,label:c,x:this.scale.calculateBarX(this.datasets.length,
b,this.scale.valuesCount+1),y:this.scale.endPoint,width:this.scale.calculateBarWidth(this.datasets.length),base:this.scale.endPoint,strokeColor:this.datasets[b].strokeColor,fillColor:this.datasets[b].fillColor}))},this);this.scale.addXLabel(c);this.update()},removeData:function(){this.scale.removeXLabel();b.each(this.datasets,function(a){a.bars.shift()},this);this.update()},reflow:function(){b.extend(this.BarClass.prototype,{y:this.scale.endPoint,base:this.scale.endPoint});var a=b.extend({height:this.chart.height,
width:this.chart.width});this.scale.update(a)},draw:function(a){var c=a||1;this.clear();this.chart.ctx;this.scale.draw(c);b.each(this.datasets,function(a,d){b.each(a.bars,function(a,b){a.hasValue()&&(a.base=this.scale.endPoint,a.transition({x:this.scale.calculateBarX(this.datasets.length,d,b),y:this.scale.calculateY(a.value),width:this.scale.calculateBarWidth(this.datasets.length)},c).draw())},this)},this)}})}).call(this);
(function(){var a=this.Chart,b=a.helpers,d={segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'};a.Type.extend({name:"Doughnut",defaults:d,
initialize:function(c){this.segments=[];this.outerRadius=(b.min([this.chart.width,this.chart.height])-this.options.segmentStrokeWidth/2)/2;this.SegmentArc=a.Arc.extend({ctx:this.chart.ctx,x:this.chart.width/2,y:this.chart.height/2});this.options.showTooltips&&b.bindEvents(this,this.options.tooltipEvents,function(a){a="mouseout"!==a.type?this.getSegmentsAtEvent(a):[];b.each(this.segments,function(a){a.restore(["fillColor"])});b.each(a,function(a){a.fillColor=a.highlightColor});this.showTooltip(a)});
this.calculateTotal(c);b.each(c,function(a,b){this.addData(a,b,!0)},this);this.render()},getSegmentsAtEvent:function(a){var c=[],d=b.getRelativePosition(a);return b.each(this.segments,function(a){a.inRange(d.x,d.y)&&c.push(a)},this),c},addData:function(a,b,d){this.segments.splice(b||this.segments.length,0,new this.SegmentArc({value:a.value,outerRadius:this.options.animateScale?0:this.outerRadius,innerRadius:this.options.animateScale?0:this.outerRadius/100*this.options.percentageInnerCutout,fillColor:a.color,
highlightColor:a.highlight||a.color,showStroke:this.options.segmentShowStroke,strokeWidth:this.options.segmentStrokeWidth,strokeColor:this.options.segmentStrokeColor,startAngle:1.5*Math.PI,circumference:this.options.animateRotate?0:this.calculateCircumference(a.value),label:a.label}));d||(this.reflow(),this.update())},calculateCircumference:function(a){return a/this.total*Math.PI*2},calculateTotal:function(a){this.total=0;b.each(a,function(a){this.total+=a.value},this)},update:function(){this.calculateTotal(this.segments);
b.each(this.activeElements,function(a){a.restore(["fillColor"])});b.each(this.segments,function(a){a.save()});this.render()},removeData:function(a){a=b.isNumber(a)?a:this.segments.length-1;this.segments.splice(a,1);this.reflow();this.update()},reflow:function(){b.extend(this.SegmentArc.prototype,{x:this.chart.width/2,y:this.chart.height/2});this.outerRadius=(b.min([this.chart.width,this.chart.height])-this.options.segmentStrokeWidth/2)/2;b.each(this.segments,function(a){a.update({outerRadius:this.outerRadius,
innerRadius:this.outerRadius/100*this.options.percentageInnerCutout})},this)},draw:function(a){var c=a?a:1;this.clear();b.each(this.segments,function(a,b){a.transition({circumference:this.calculateCircumference(a.value),outerRadius:this.outerRadius,innerRadius:this.outerRadius/100*this.options.percentageInnerCutout},c);a.endAngle=a.startAngle+a.circumference;a.draw();0===b&&(a.startAngle=1.5*Math.PI);b<this.segments.length-1&&(this.segments[b+1].startAngle=a.endAngle)},this)}});a.types.Doughnut.extend({name:"Pie",
defaults:b.merge(d,{percentageInnerCutout:0})})}).call(this);
(function(){var a=this.Chart,b=a.helpers;a.Type.extend({name:"Line",defaults:{scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'},initialize:function(d){this.PointClass=
a.Point.extend({strokeWidth:this.options.pointDotStrokeWidth,radius:this.options.pointDotRadius,display:this.options.pointDot,hitDetectionRadius:this.options.pointHitDetectionRadius,ctx:this.chart.ctx,inRange:function(a){return Math.pow(a-this.x,2)<Math.pow(this.radius+this.hitDetectionRadius,2)}});this.datasets=[];this.options.showTooltips&&b.bindEvents(this,this.options.tooltipEvents,function(a){a="mouseout"!==a.type?this.getPointsAtEvent(a):[];this.eachPoints(function(a){a.restore(["fillColor",
"strokeColor"])});b.each(a,function(a){a.fillColor=a.highlightFill;a.strokeColor=a.highlightStroke});this.showTooltip(a)});b.each(d.datasets,function(a){var c={label:a.label||null,fillColor:a.fillColor,strokeColor:a.strokeColor,pointColor:a.pointColor,pointStrokeColor:a.pointStrokeColor,points:[]};this.datasets.push(c);b.each(a.data,function(b,f){c.points.push(new this.PointClass({value:b,label:d.labels[f],datasetLabel:a.label,strokeColor:a.pointStrokeColor,fillColor:a.pointColor,highlightFill:a.pointHighlightFill||
a.pointColor,highlightStroke:a.pointHighlightStroke||a.pointStrokeColor}))},this);this.buildScale(d.labels);this.eachPoints(function(a,c){b.extend(a,{x:this.scale.calculateX(c),y:this.scale.endPoint});a.save()},this)},this);this.render()},update:function(){this.scale.update();b.each(this.activeElements,function(a){a.restore(["fillColor","strokeColor"])});this.eachPoints(function(a){a.save()});this.render()},eachPoints:function(a){b.each(this.datasets,function(c){b.each(c.points,a,this)},this)},getPointsAtEvent:function(a){var c=
[],d=b.getRelativePosition(a);return b.each(this.datasets,function(a){b.each(a.points,function(a){a.inRange(d.x,d.y)&&c.push(a)})},this),c},buildScale:function(d){var c=this,f=function(){var a=[];return c.eachPoints(function(b){a.push(b.value)}),a};d={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,
valuesCount:d.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(a){a=b.calculateScaleRange(f(),a,this.fontSize,this.beginAtZero,this.integersOnly);b.extend(this,a)},xLabels:d,font:b.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,
gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.pointDotRadius+this.options.pointDotStrokeWidth,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&b.extend(d,{calculateYRange:b.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth});
this.scale=new a.Scale(d)},addData:function(a,c){b.each(a,function(a,b){this.datasets[b].points.push(new this.PointClass({value:a,label:c,x:this.scale.calculateX(this.scale.valuesCount+1),y:this.scale.endPoint,strokeColor:this.datasets[b].pointStrokeColor,fillColor:this.datasets[b].pointColor}))},this);this.scale.addXLabel(c);this.update()},removeData:function(){this.scale.removeXLabel();b.each(this.datasets,function(a){a.points.shift()},this);this.update()},reflow:function(){var a=b.extend({height:this.chart.height,
width:this.chart.width});this.scale.update(a)},draw:function(a){var c=a||1;this.clear();var d=this.chart.ctx,g=function(a){return null!==a.value},m=function(a,c,d){return b.findNextWhere(c,g,d)||a},l=function(a,c,d){return b.findPreviousWhere(c,g,d)||a};this.scale.draw(c);b.each(this.datasets,function(a){var f=b.where(a.points,g);b.each(a.points,function(a,b){a.hasValue()&&a.transition({y:this.scale.calculateY(a.value),x:this.scale.calculateX(b)},c)},this);this.options.bezierCurve&&b.each(f,function(a,
c){var d=0<c&&c<f.length-1?this.options.bezierCurveTension:0;a.controlPoints=b.splineCurve(l(a,f,c),a,m(a,f,c),d);a.controlPoints.outer.y>this.scale.endPoint?a.controlPoints.outer.y=this.scale.endPoint:a.controlPoints.outer.y<this.scale.startPoint&&(a.controlPoints.outer.y=this.scale.startPoint);a.controlPoints.inner.y>this.scale.endPoint?a.controlPoints.inner.y=this.scale.endPoint:a.controlPoints.inner.y<this.scale.startPoint&&(a.controlPoints.inner.y=this.scale.startPoint)},this);d.lineWidth=this.options.datasetStrokeWidth;
d.strokeStyle=a.strokeColor;d.beginPath();b.each(f,function(a,b){0===b?d.moveTo(a.x,a.y):this.options.bezierCurve?(b=l(a,f,b),d.bezierCurveTo(b.controlPoints.outer.x,b.controlPoints.outer.y,a.controlPoints.inner.x,a.controlPoints.inner.y,a.x,a.y)):d.lineTo(a.x,a.y)},this);d.stroke();this.options.datasetFill&&0<f.length&&(d.lineTo(f[f.length-1].x,this.scale.endPoint),d.lineTo(f[0].x,this.scale.endPoint),d.fillStyle=a.fillColor,d.closePath(),d.fill());b.each(f,function(a){a.draw()})},this)}})}).call(this);
(function(){var a=this.Chart,b=a.helpers;a.Type.extend({name:"PolarArea",defaults:{scaleShowLabelBackdrop:!0,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBeginAtZero:!0,scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,scaleShowLine:!0,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'},
initialize:function(d){this.segments=[];this.SegmentArc=a.Arc.extend({showStroke:this.options.segmentShowStroke,strokeWidth:this.options.segmentStrokeWidth,strokeColor:this.options.segmentStrokeColor,ctx:this.chart.ctx,innerRadius:0,x:this.chart.width/2,y:this.chart.height/2});this.scale=new a.RadialScale({display:this.options.showScale,fontStyle:this.options.scaleFontStyle,fontSize:this.options.scaleFontSize,fontFamily:this.options.scaleFontFamily,fontColor:this.options.scaleFontColor,showLabels:this.options.scaleShowLabels,
showLabelBackdrop:this.options.scaleShowLabelBackdrop,backdropColor:this.options.scaleBackdropColor,backdropPaddingY:this.options.scaleBackdropPaddingY,backdropPaddingX:this.options.scaleBackdropPaddingX,lineWidth:this.options.scaleShowLine?this.options.scaleLineWidth:0,lineColor:this.options.scaleLineColor,lineArc:!0,width:this.chart.width,height:this.chart.height,xCenter:this.chart.width/2,yCenter:this.chart.height/2,ctx:this.chart.ctx,templateString:this.options.scaleLabel,valuesCount:d.length});
this.updateScaleRange(d);this.scale.update();b.each(d,function(a,b){this.addData(a,b,!0)},this);this.options.showTooltips&&b.bindEvents(this,this.options.tooltipEvents,function(a){a="mouseout"!==a.type?this.getSegmentsAtEvent(a):[];b.each(this.segments,function(a){a.restore(["fillColor"])});b.each(a,function(a){a.fillColor=a.highlightColor});this.showTooltip(a)});this.render()},getSegmentsAtEvent:function(a){var c=[],d=b.getRelativePosition(a);return b.each(this.segments,function(a){a.inRange(d.x,
d.y)&&c.push(a)},this),c},addData:function(a,b,f){this.segments.splice(b||this.segments.length,0,new this.SegmentArc({fillColor:a.color,highlightColor:a.highlight||a.color,label:a.label,value:a.value,outerRadius:this.options.animateScale?0:this.scale.calculateCenterOffset(a.value),circumference:this.options.animateRotate?0:this.scale.getCircumference(),startAngle:1.5*Math.PI}));f||(this.reflow(),this.update())},removeData:function(a){a=b.isNumber(a)?a:this.segments.length-1;this.segments.splice(a,
1);this.reflow();this.update()},calculateTotal:function(a){this.total=0;b.each(a,function(a){this.total+=a.value},this);this.scale.valuesCount=this.segments.length},updateScaleRange:function(a){var c=[];b.each(a,function(a){c.push(a.value)});a=this.options.scaleOverride?{steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}:b.calculateScaleRange(c,b.min([this.chart.width,
this.chart.height])/2,this.options.scaleFontSize,this.options.scaleBeginAtZero,this.options.scaleIntegersOnly);b.extend(this.scale,a,{size:b.min([this.chart.width,this.chart.height]),xCenter:this.chart.width/2,yCenter:this.chart.height/2})},update:function(){this.calculateTotal(this.segments);b.each(this.segments,function(a){a.save()});this.render()},reflow:function(){b.extend(this.SegmentArc.prototype,{x:this.chart.width/2,y:this.chart.height/2});this.updateScaleRange(this.segments);this.scale.update();
b.extend(this.scale,{xCenter:this.chart.width/2,yCenter:this.chart.height/2});b.each(this.segments,function(a){a.update({outerRadius:this.scale.calculateCenterOffset(a.value)})},this)},draw:function(a){var c=a||1;this.clear();b.each(this.segments,function(a,b){a.transition({circumference:this.scale.getCircumference(),outerRadius:this.scale.calculateCenterOffset(a.value)},c);a.endAngle=a.startAngle+a.circumference;0===b&&(a.startAngle=1.5*Math.PI);b<this.segments.length-1&&(this.segments[b+1].startAngle=
a.endAngle);a.draw()},this);this.scale.draw()}})}).call(this);
(function(){var a=this.Chart,b=a.helpers;a.Type.extend({name:"Radar",defaults:{scaleShowLine:!0,angleShowLineOut:!0,scaleShowLabels:!1,scaleBeginAtZero:!0,angleLineColor:"rgba(0,0,0,.1)",angleLineWidth:1,pointLabelFontFamily:"'Arial'",pointLabelFontStyle:"normal",pointLabelFontSize:10,pointLabelFontColor:"#666",pointDot:!0,pointDotRadius:3,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'},
initialize:function(d){this.PointClass=a.Point.extend({strokeWidth:this.options.pointDotStrokeWidth,radius:this.options.pointDotRadius,display:this.options.pointDot,hitDetectionRadius:this.options.pointHitDetectionRadius,ctx:this.chart.ctx});this.datasets=[];this.buildScale(d);this.options.showTooltips&&b.bindEvents(this,this.options.tooltipEvents,function(a){a="mouseout"!==a.type?this.getPointsAtEvent(a):[];this.eachPoints(function(a){a.restore(["fillColor","strokeColor"])});b.each(a,function(a){a.fillColor=
a.highlightFill;a.strokeColor=a.highlightStroke});this.showTooltip(a)});b.each(d.datasets,function(a){var c={label:a.label||null,fillColor:a.fillColor,strokeColor:a.strokeColor,pointColor:a.pointColor,pointStrokeColor:a.pointStrokeColor,points:[]};this.datasets.push(c);b.each(a.data,function(b,f){var g;this.scale.animation||(g=this.scale.getPointPosition(f,this.scale.calculateCenterOffset(b)));c.points.push(new this.PointClass({value:b,label:d.labels[f],datasetLabel:a.label,x:this.options.animation?
this.scale.xCenter:g.x,y:this.options.animation?this.scale.yCenter:g.y,strokeColor:a.pointStrokeColor,fillColor:a.pointColor,highlightFill:a.pointHighlightFill||a.pointColor,highlightStroke:a.pointHighlightStroke||a.pointStrokeColor}))},this)},this);this.render()},eachPoints:function(a){b.each(this.datasets,function(c){b.each(c.points,a,this)},this)},getPointsAtEvent:function(a){a=b.getRelativePosition(a);a=b.getAngleFromPoint({x:this.scale.xCenter,y:this.scale.yCenter},a);var c=Math.round((a.angle-
1.5*Math.PI)/(2*Math.PI/this.scale.valuesCount)),d=[];return(c>=this.scale.valuesCount||0>c)&&(c=0),a.distance<=this.scale.drawingArea&&b.each(this.datasets,function(a){d.push(a.points[c])}),d},buildScale:function(b){this.scale=new a.RadialScale({display:this.options.showScale,fontStyle:this.options.scaleFontStyle,fontSize:this.options.scaleFontSize,fontFamily:this.options.scaleFontFamily,fontColor:this.options.scaleFontColor,showLabels:this.options.scaleShowLabels,showLabelBackdrop:this.options.scaleShowLabelBackdrop,
backdropColor:this.options.scaleBackdropColor,backdropPaddingY:this.options.scaleBackdropPaddingY,backdropPaddingX:this.options.scaleBackdropPaddingX,lineWidth:this.options.scaleShowLine?this.options.scaleLineWidth:0,lineColor:this.options.scaleLineColor,angleLineColor:this.options.angleLineColor,angleLineWidth:this.options.angleShowLineOut?this.options.angleLineWidth:0,pointLabelFontColor:this.options.pointLabelFontColor,pointLabelFontSize:this.options.pointLabelFontSize,pointLabelFontFamily:this.options.pointLabelFontFamily,
pointLabelFontStyle:this.options.pointLabelFontStyle,height:this.chart.height,width:this.chart.width,xCenter:this.chart.width/2,yCenter:this.chart.height/2,ctx:this.chart.ctx,templateString:this.options.scaleLabel,labels:b.labels,valuesCount:b.datasets[0].data.length});this.scale.setScaleSize();this.updateScaleRange(b.datasets);this.scale.buildYLabels()},updateScaleRange:function(a){var c=function(){var c=[];return b.each(a,function(a){a.data?c=c.concat(a.data):b.each(a.points,function(a){c.push(a.value)})}),
c}();c=this.options.scaleOverride?{steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}:b.calculateScaleRange(c,b.min([this.chart.width,this.chart.height])/2,this.options.scaleFontSize,this.options.scaleBeginAtZero,this.options.scaleIntegersOnly);b.extend(this.scale,c)},addData:function(a,c){this.scale.valuesCount++;b.each(a,function(a,b){var d=this.scale.getPointPosition(this.scale.valuesCount,
this.scale.calculateCenterOffset(a));this.datasets[b].points.push(new this.PointClass({value:a,label:c,x:d.x,y:d.y,strokeColor:this.datasets[b].pointStrokeColor,fillColor:this.datasets[b].pointColor}))},this);this.scale.labels.push(c);this.reflow();this.update()},removeData:function(){this.scale.valuesCount--;this.scale.labels.shift();b.each(this.datasets,function(a){a.points.shift()},this);this.reflow();this.update()},update:function(){this.eachPoints(function(a){a.save()});this.reflow();this.render()},
reflow:function(){b.extend(this.scale,{width:this.chart.width,height:this.chart.height,size:b.min([this.chart.width,this.chart.height]),xCenter:this.chart.width/2,yCenter:this.chart.height/2});this.updateScaleRange(this.datasets);this.scale.setScaleSize();this.scale.buildYLabels()},draw:function(a){var c=a||1,d=this.chart.ctx;this.clear();this.scale.draw();b.each(this.datasets,function(a){b.each(a.points,function(a,b){a.hasValue()&&a.transition(this.scale.getPointPosition(b,this.scale.calculateCenterOffset(a.value)),
c)},this);d.lineWidth=this.options.datasetStrokeWidth;d.strokeStyle=a.strokeColor;d.beginPath();b.each(a.points,function(a,b){0===b?d.moveTo(a.x,a.y):d.lineTo(a.x,a.y)},this);d.closePath();d.stroke();d.fillStyle=a.fillColor;d.fill();b.each(a.points,function(a){a.hasValue()&&a.draw()})},this)}})}).call(this);
bm.onReady(app.tabs,"setting",function(){app.tabs.setting.application=function(a,b,f){this.tool=a.tool;this.body=a;this.appTab=b;this.ajax_url=f};var a=app.tabs.setting.application.inherit(app.SingleTableView),b=app.tabs.setting.application._super;a.init=function(){var a=this;b.init.call(this);this.tool.find(".reload").click(function(){a.reload()});this.tool.find(".create").on("click",function(){a.edit()})};a.sortable={};a.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("delete"),
ui_class:"delete"}];a.onActionClick=function(a,b){switch(a){case "edit":this.edit(b.id);break;case "delete":this.delete(b.id,b.name)}};a.edit=function(a){var b=this,d=a?$.i18n.prop("edit.application"):$.i18n.prop("create.application");this.appTab.renderCreatePanel(app.baseUrl+"application/edit",d,null,{id:a},{success:function(){b.reload()}})};a.delete=function(a,b){var c=this;bm.remove("oAuthClient","OAuthClient",$.i18n.prop("confirm.delete.application",[b]),app.baseUrl+"application/delete",a,{success:function(){c.reload()}})};
app.tabs.setting.prototype.initApplicationSettings=function(a){(new app.tabs.setting.application(a.panel,this,app.baseUrl+"application/list")).init()}});
$(function(){function a(a,b){bm.floatingPanel(b,app.baseUrl+"currencyAdmin/addCurrencyPopup",{},{width:350,position_collison:"none",events:{content_loaded:function(b){function c(){d.loader();bm.ajax({url:app.baseUrl+"currencyAdmin/addCurrencyPopup",data:{searchText:d.find(".search-currency .search-text").val()},dataType:"html",response:function(){d.loader(!1)},success:function(a){d.find("table").replaceWith(a.jqObject.find("table"))}})}var d=b.el;d.updateUi();d.on("click",".select-currency",function(){var c=
$.extend({invoke:!0},$(this).data());bm.ajax({url:app.baseUrl+"currencyAdmin/changeInvocation",data:c,success:function(){b.close();a.reload()}})});d.find(".search-currency .icon-search").click(function(){c()}).prev("input").keypress(function(a){13==a.which&&(a.preventDefault(),c())});d.on("click",".cancel-button",function(){b.close()})}}})}function b(a,b){bm.confirm($.i18n.prop("confirm.remove",["currency",b.name]),function(){bm.ajax({url:app.baseUrl+"currencyAdmin/changeInvocation",data:b,success:function(){a.reload()}})},
function(){})}bm.onReady(app.tabs,"setting",function(){app.tabs.setting.prototype.initCurrencyExtension=function(d){var c=this,f=app.tabs.currency.prototype,g=d.panel.find("form"),m=g.find(".currency-section");c.on_global("currency-update",function(){d.panel.reload()});var l=bm.table(m,{url:app.baseUrl+"currencyAdmin/loadCurrencyForSettings",sortable:{0:"name"},sorted:"0",sortedDir:"up",menu_entries:[{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"},{text:$.i18n.prop("remove"),ui_class:"remove",
action:"remove"},{text:$.i18n.prop("set.base.currency"),ui_class:"set-base-currency",action:"set-base-currency"}]});l.onActionClick=function(a,d,e){switch(a){case "edit":f.editCurrency.call(c,d.id,d.name);break;case "remove":b(l,d);break;case "set-base-currency":f.setBaseCurrency.call(c,d.id,d.name)}};m.on("click",".add-currency",function(){a(l,this.jqObject)});bm.menu([{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"}],g.find(".base-currency-section"),".action-navigator",{click:function(a,
b){a=b.config("entity");f.editCurrency.call(c,a.id,a.name)}},"click",["right+10 bottom+5","right top"])}})});app.tabs.customer=function(){this.constructor_args=arguments;this.text=$.i18n.prop("customers");this.tip=$.i18n.prop("manage.customers");this.ui_class="customers";app.tabs.customer._super.constructor.apply(this,arguments)};var _cust=app.tabs.customer.inherit(app.SingleTableTab);
(function(){function a(){var a=this;this.on_global("customer-restore",function(){a.reload()});this.on("close",function(){app.tabs.customer.tab=null})}_cust.init=function(){var b=this;app.tabs.customer._super.init.call(this);app.tabs.customer.tab=this;a.call(this);app.global_event.on("customer-update",function(){b.reload()})};app.global_event.on("after-ribbon-render",function(a,d){app.isPermitted("customer.view.list")?d.enable("customer"):d.disable("customer")})})();
_cust.onSwitchMenuClick=function(a){app.Tab.changeView(this,"customer",a,"explorer"==a?"ExplorerPanelTab":"SingleTableTab")};_cust.onActionMenuClick=function(a){switch(a){case "import-customer":this.initCustomerImport();break;case "export-customer":this.exportCustomer();break;case "create-customer-group":this.createCustomerGroup()}};app.tabs.customer.customers=function(){app.tabs.customer.customers._super.constructor.apply(this,arguments)};
app.ribbons.administration.push(app.tabs.customer.ribbon_data={text:$.i18n.prop("customer"),ui_class:"customer",processor:app.tabs.customer.customers,views:[{ui_class:"customerGroups",text:$.i18n.prop("customer.group")}]});_c=app.tabs.customer.customers.inherit(app.tabs.customer);_c.ajax_url=app.baseUrl+"customerAdmin/loadAppView";_c.advanceSearchUrl=app.baseUrl+"customerAdmin/advanceFilter";_c.advanceSearchTitle=$.i18n.prop("customer");_c.advance_search_popup_width=600;
(function(){_c.init=function(){var a=this;this.body.find(".toolbar .create").on("click",function(){a.createCustomer()});app.tabs.customer.customers._super.init.apply(this,arguments)}})();_c.switch_menu_entries=[{text:$.i18n.prop("customer.group.list"),ui_class:"view-switch customer-group list-view",action:"customerGroups"}];
_c.action_menu_entries=[{text:$.i18n.prop("import.customer"),ui_class:"import-customer",action:"import-customer"},{text:$.i18n.prop("export.customer"),ui_class:"export-customer",action:"export-customer"}];_c.sortable={list:{1:"firstName",2:"lastName",3:"userName",4:"storeCredit",6:"created"},sorted:"1",dir:"up"};
_c.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("adjust.store.credit"),ui_class:"adjust-store-credit"},{text:$.i18n.prop("store.credit.history"),ui_class:"store-credit-history"},{text:$.i18n.prop("reset.password"),ui_class:"reset-password"},{text:$.i18n.prop("remove"),ui_class:"remove"}];
_c.onMenuOpen=function(a){app.checkPermission(this.tabulator.menu,[{key:"customer.edit.properties",class:"edit"},{key:"customer.adjust.store.credit",class:"adjust-store-credit"},{key:"customer.view.store.credit.history",class:"store-credit-history"},{key:"customer.remove",class:"remove"}])};_c.onSelectedActionClick=function(a,b){switch(a){case "remove":this.deleteSelectedCustomers(b.collect("id"));break;case "bulkEdit":this.bulkEdit(b.collect("id"))}};
_c.onActionClick=function(a,b){switch(a){case "edit":this.editCustomer(b.id,b.name);break;case "adjust-store-credit":this.adjustStoreCredit(b.id,b.name);break;case "store-credit-history":this.storeCreditHistory(b.id,b.name);break;case "reset-password":this.resetPassword(b.id,b.name);break;case "remove":this.deleteCustomer(b.id,b.name)}};
_c.createCustomer=function(a){var b=$.i18n.prop("create.customer");a=$.extend({success:function(){app.global_event.trigger("customer-create");app.tabs.customer.tab&&app.tabs.customer.tab.reload()},content_loaded:function(a){this.countryChange=bm.countryChange(a,{stateName:"state.id"});bm.initCityValidator(a.find("[name=postCode]"),null,"state.id")}},a);this.renderCreatePanel(app.baseUrl+"customerAdmin/create",b,"",{},a)};_c.viewCustomer=function(a){bm.viewPopup(app.baseUrl+"customerAdmin/view",{id:a})};
_c.editCustomer=function(a,b){var d=this;this.renderCreatePanel(app.baseUrl+"customerAdmin/create",$.i18n.prop("edit.customer"),b,{id:a},{success:function(){d.reload()},content_loaded:function(a){this.countryChange=bm.countryChange($(this),{stateName:"state.id"});bm.initCityValidator(a.find("[name=postCode]"),null,"state.id")}})};_c.adjustStoreCredit=function(a,b){var d=this;bm.editPopup(app.baseUrl+"customerAdmin/loadStoreCredit",$.i18n.prop("adjust.store.credit"),b,{id:a},{success:function(){d.reload()}})};
_c.storeCreditHistory=function(a,b){var d=app.baseUrl+"customerAdmin/loadStoreCreditHistory";bm.editPopup(d,$.i18n.prop("store.credit.history"),b,{id:a},{width:850,success:function(){},events:{content_loaded:function(){var b=$(this),f=function(){var c=b.find(".pagination").obj();c&&(c.onPageClick=function(c){bm.ajax({url:d,data:{id:a,offset:5*(c-1)},dataType:"html",success:function(a){$(b.find(".table-view")).html($(a)).updateUi();f()}})})};f()}}})};
_c.resetPassword=function(a,b){bm.editPopup(app.baseUrl+"customerAdmin/resetPassPopup",$.i18n.prop("reset.password"),b,{id:a})};_c.deleteCustomer=function(a,b){var d=this;bm.remove("customer","Customer",$.i18n.prop("confirm.delete.customer",[b]),app.baseUrl+"customerAdmin/delete",a,{success:function(){app.global_event.trigger("delete-customer",[a]);d.reload()}})};
_c.deleteSelectedCustomers=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.customer"),function(){bm.ajax({url:app.baseUrl+"customerAdmin/deleteSelected",data:{ids:a},success:function(){b.reload();app.global_event.trigger("delete-customer",[a]);app.global_event.trigger("send-trash",["customer",a]);b.body.find(".action-header").hide()}})},function(){})};
_c.bulkEdit=function(a){var b=app.Tab.getTab("tab-customer-bulk-editor");b?bm.notify($.i18n.prop("customer.bulk.editor.open.already"),"alert"):(b=new app.tabs.customerBulkEditor({customerIds:a,id:"tab-customer-bulk-editor"}),b.render(),b.setActive())};
_c.exportCustomer=function(){var a={};this.advanceSearchFilter?a.filter=JSON.stringify(this.advanceSearchFilter):this.simpleSearchText&&(a.filter='{"searchText": "'+this.simpleSearchText+'"}');bm.editPopup(app.baseUrl+"customerExportImport/initExport",$.i18n.prop("export.customer"),void 0,a,{width:420,events:{content_loaded:function(a){}},beforeSubmit:function(a,d,c){setTimeout(function(){c.close()},2E3)}})};
_c.initCustomerImport=function(){bm.editPopup(app.baseUrl+"customerExportImport/uploadImportFile",$.i18n.prop("import.customer"),"",{},{success:function(a){a={token:a.token,name:a.name,detail_url:app.baseUrl+"customerExportImport/progressView",detail_status_url:app.baseUrl+"customerExportImport/progressStatus",detail_viewer:app.tabs.customer.import_status_viewer};TaskManager.createTask(a);bm.taskPopup(app.baseUrl+"customerExportImport/progressView",a,{width:800,top:100})}})};
app.tabs.customer.import_status_viewer={init:function(a){a=a.getDom();this.totalProgressBar=new ProgressBar(a.find(".progress"));this.totalProgressBar.render()},update:function(a,b){var d=a.getDom();this.totalProgressBar.setPosition(b.totalProgress);d.find(".progress-count").text(b.totalProgress+"%");d.find(".record-complete").text(b.complete);d.find(".record-total").text(b.totalRecord);d.find(".success-count").text(b.successCount);d.find(".warning-count").text(b.warningCount);d.find(".error-count").text(b.errorCount);
"aborted"==b.status&&(d.find(".import-aborted").show(),d.find(".progress .progress-bar .completed").addClass(b.status));if(100==b.totalProgress){var c=app.Tab.getTab("tab-customer");c&&c.reload();this.activeLogSummaryLink(d,b.token);d.find(".content").append('<div class="button-line"><button type="button" class="button close-button">'+$.i18n.prop("close")+'</button> &nbsp; <a type="button" target="_blank" class="button download-button" href="'+app.baseUrl+"customerExportImport/download?token="+b.token+
'">'+$.i18n.prop("download")+"</a></div>");d.find(".close-button").click(function(){a.close()})}},activeLogSummaryLink:function(a,b){var d=this;a.find(".success-count").addClass("link").click(function(){d.fetchLogSummary(a,b,"success")});a.find(".warning-count").addClass("link").click(function(){d.fetchLogSummary(a,b,"warning")});a.find(".error-count").addClass("link").click(function(){d.fetchLogSummary(a,b,"error")})},fetchLogSummary:function(a,b,d){bm.ajax({url:app.baseUrl+"customerExportImport/"+
d+"LogSummary",dataType:"html",data:{token:b},success:function(b){a.find(".log-summary").html(b).updateUi();a.find(".log-summary").find("table").parent().scrollbar({vertical:{offset:0,step:"auto"}})}})}};app.tabs.customer.customerGroups=function(){app.tabs.customer.customerGroups._super.constructor.apply(this,arguments)};var _g=app.tabs.customer.customerGroups.inherit(app.tabs.customer);
(function(){_g.init=function(){var a=this;this.body.find(".toolbar .create").on("click",function(){a.createCustomerGroup()});app.tabs.customer.customerGroups._super.init.apply(this,arguments)}})();_g.ajax_url=app.baseUrl+"customerGroup/loadAppView";_g.advanceSearchUrl=app.baseUrl+"customerGroup/advanceFilter";_g.advanceSearchTitle=$.i18n.prop("customer.group");_g.switch_menu_entries=[{text:$.i18n.prop("customer.list"),ui_class:"view-switch customers list-view",action:"customers"}];
_g.sortable={list:{1:"name",4:"created"},sorted:"2",dir:"up"};_g.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("remove"),ui_class:"remove"}];_g.onSelectedActionClick=function(a,b){switch(a){case "assign_customer":this.assignCustomer(b);break;case "status":this.changeStatus(b);break;case "remove":this.deleteSelectedCustomerGroups(b.collect("id"))}};
_g.onActionClick=function(a,b){switch(a){case "edit":this.editCustomerGroup(b.id,b.name);break;case "remove":this.deleteCustomerGroup(b.id,b.name)}};
_g.editCustomerGroup=function(a,b){var d=this,c=a?$.i18n.prop("edit.customer.group"):$.i18n.prop("create.customer.group");this.renderCreatePanel(app.baseUrl+"customerGroup/create",c,b,{id:a},{width:850,content_loaded:function(){var a=bm.twoSideSelection(this,10,"customer","customerAdmin/loadCustomerForMultiSelect",{view:!1,edit:!1,"column-sort":!1},["customer"],{resetRightPanel:!1}),b=$('<span class="tool-icon remove-search" style="display: none"></span>'),c=this.find("input.search-text"),d=this.find(".search-form");
d.prepend(b);a.beforeLoadTableContent=function(a){var d={searchText:c.val()};$.extend(a,d);c.val()?b.show():b.hide()};this.find("select[name='selection-type']").change(function(){"customer"==this.value?a.setUrl("customerAdmin/loadCustomerForMultiSelect","customer",{view:!1,edit:!1,"column-sort":!0},["customer"]):a.setUrl("customerGroup/loadCustomerGroupForMultiSelect","customer-group",{view:!1,edit:!1,"column-sort":!0},["customerGroup"])});d.form({disable_on_submit:!1,preSubmit:function(){a.reload();
return!1}});b.on("click",function(){c.val("");a.reload()})},success:function(){d.reload()}})};_g.createCustomerGroup=_g.editCustomerGroup;_g.deleteCustomerGroup=function(a,b){var d=this;bm.remove("customer-group","Customer Group",$.i18n.prop("confirm.delete.customer.group",[b]),app.baseUrl+"customerGroup/delete",a,{is_final:!0,success:function(){d.reload()}})};
_g.deleteSelectedCustomerGroups=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.customer.group"),function(){bm.ajax({url:app.baseUrl+"customerGroup/deleteSelected",data:{ids:a},success:function(){b.reload();b.body.find(".action-header").hide()}})},function(){})};
_g.changeStatus=function(a){var b=this;bm.editPopup(app.baseUrl+"customerGroup/loadStatusOption",$.i18n.prop("status"),null,{},{width:600,events:{content_loaded:function(){var b=$(this),c=a.collect("id");$.each(c,function(a,c){b.find(".edit-popup-form").append('<input type="hidden" name="id" value="'+c+'">')})}},success:function(){b.reload()}})};
_g.assignCustomer=function(a){var b=this;bm.editPopup(app.baseUrl+"customerGroup/loadCustomerOption",$.i18n.prop("assign.customer"),null,{},{width:600,events:{content_loaded:function(){var b=$(this),c=a.collect("id");$.each(c,function(a,c){b.find(".edit-popup-form").append('<input type="hidden" name="id" value="'+c+'">')});var f=bm.twoSideSelection(this,10,"customer","customerAdmin/loadCustomerForMultiSelect",{view:!1,edit:!1,"column-sort":!1},["customer"]),g=$('<span class="tool-icon remove-search" style="display: none"></span>'),
m=this.find("input.search-text");c=this.find(".search-form");c.prepend(g);f.beforeLoadTableContent=function(a){var b={searchText:m.val()};$.extend(a,b);m.val()?g.show():g.hide()};this.find("select[name='selection-type']").change(function(){"customer"==this.value?f.setUrl("customerAdmin/loadCustomerForMultiSelect","customer",{view:!1,edit:!1,"column-sort":!0},["customer"]):f.setUrl("customerGroup/loadCustomerGroupForMultiSelect","customer-group",{view:!1,edit:!1,"column-sort":!0},["customerGroup"])});
c.form({disable_on_submit:!1,preSubmit:function(){f.reload();return!1}});g.on("click",function(){m.val("");f.reload()})}},success:function(){b.reload()}})};
var DashboardManager={init:function(){var a=this,b=this.workspace=$("#workspace"),d=this.dashboardContainer=b.find(".dashboard-container");b.find(".dashlet-wrapper").on("click",".dashlet-ribbon",function(){ComponentManager.openTab(ComponentManager.getRibbonData(app.ribbons[$(this).attr("tabId")],$(this).attr("ui_class")))});d.updateUi();d.scrollbar();d.find(".dashlet.latestStat .customer-data-table").scrollbar();b.on("click",".header > .icon, .dashlet-ribbon > .icon",function(){var a=$(this).attr("data-name");
if("quickReport"==a)a=b.find(".dashlet-quick-report"),DashboardManager.quickReportConfig(a);else if("webCommerce"==a)a=b.find(".dashlet-webcommerce"),DashboardManager.webCommerceConfig(a);else if("webContentAndDesign"==a)a=b.find(".dashlet-web-content-design"),DashboardManager.webContentAndDesignConfig(a);else if("administrationAndMarketing"==a)a=b.find(".dashlet-administration-webmarketing"),DashboardManager.administrationAndMarketingConfig(a);else if("latestStat"==a)a=b.find(".dashlet-latest-statistics").closest(".dashlet"),
DashboardManager.latestReoprtConfig(a),a.updateUi();else if("favouriteReportChartOne"==a||"favouriteReportChartTwo"==a){a=$(this).attr("dashlet-id");var d=$(this).closest(".dashlet");DashboardManager.favouriteReportConfig($.i18n.prop("config.favourite.report"),d,a)}});app.global_event.on("order-create order-status-change payment-added payment-refunded customer-create delete-customer",function(){a.reloadQuickReport()});b.find(".favouriteReportChartOne, .favouriteReportChartTwo")},postReportConfig:function(a){a.find(".chart-block").chart()},
quickReportConfig:function(a){DashboardManager.configDashlet([],$.i18n.prop("config.quick.report"),a,"quickReport","dashboard/quickReport",function(){return 5!=this.find(":checked").length?(bm.notify($.i18n.prop("please.select.five.elements"),"alert"),!1):!0})},reloadQuickReport:function(){var a=this;bm.ajax({url:app.baseUrl+"dashboard/quickReport",dataType:"html",success:function(b){a.dashboardContainer.find(".dashlet-quick-report").replaceWith(b)}})},webCommerceConfig:function(a){var b=[];app.ribbons.web_commerce.every(function(){var a=
{};a.uiClass=this.ui_class;a.tabId="web_commerce";b.push(JSON.stringify(a))});DashboardManager.configDashlet(b,$.i18n.prop("config.web.commerce"),a,"webCommerce","dashboard/webCommerce")},webContentAndDesignConfig:function(a){var b=[];app.ribbons.web_content.every(function(){var a={};a.uiClass=this.ui_class;a.tabId="web_content";b.push(JSON.stringify(a))});app.ribbons.web_design.every(function(){var a={};a.uiClass=this.ui_class;a.tabId="web_design";b.push(JSON.stringify(a))});DashboardManager.configDashlet(b,
$.i18n.prop("config.web.content.and.design"),a,"webContentAndDesign","dashboard/webContentAndDesign")},administrationAndMarketingConfig:function(a){var b=[];app.ribbons.administration.every(function(){var a={};a.uiClass=this.ui_class;a.tabId="administration";b.push(JSON.stringify(a))});app.ribbons.web_marketing.every(function(){var a={};a.uiClass=this.ui_class;a.tabId="web_marketing";b.push(JSON.stringify(a))});DashboardManager.configDashlet(b,$.i18n.prop("config.administration.and.web.marketing"),
a,"administrationAndMarketing","dashboard/administrationAndMarketing")},configDashlet:function(a,b,d,c,f,g){bm.editPopup(app.baseUrl+"dashboard/configPopUp",b,"",{ribbons:a,configType:c},{width:400,beforeSubmit:g?g:function(){return 6!=this.find(":checked").length?(bm.notify($.i18n.prop("please.select.six.elements"),"alert"),!1):!0},success:function(){d.loader();bm.ajax({url:app.baseUrl+f,dataType:"html",data:{configType:c},success:function(a){d.replaceWith(a);d.loader(!1)}})}})},latestReoprtConfig:function(a){bm.editPopup(app.baseUrl+
"dashboard/configLatestTablePopUp",$.i18n.prop("config.latest.table"),"",{},{width:400,success:function(){a.loader();bm.ajax({url:app.baseUrl+"dashboard/latestStatUpdate",dataType:"html",success:function(b){a.replaceWith(b);a.find(".content").scrollbar();a.loader(!1)}})}})},favouriteReportConfig:function(a,b,d){bm.editPopup(app.baseUrl+"dashboard/configFavouriteReportPopUp",a,"",{dashletId:d},{width:400,success:function(){b.loader();bm.ajax({controller:"commanderReporting",action:"renderFavouriteReportChart",
dataType:"html",data:{dashlet:d},success:function(a){b.find(".dashlet-favourite-report").replaceWith(a);b.loader(!1);DashboardManager.postReportConfig(b)}})}})},onScreenHelp:function(a){ComponentManager.showDashboard();var b=$("#workspace");b.find(".getting-started-wizard").is(":visible")&&b.find(".dashboard-toggle").trigger("click");var d=$("#top-component-bar"),c=[];c[0]=b.find(".dashboard-container").find(".dashboard-toggle").find(".title");c[1]=d.find(".component-navigators").find(".administration");
c[2]=b.find(".webContentAndDesign").find(".header .icon");c[3]=d.find(".component-navigators").find(".web-content");c[4]=d.find(".component-navigators").find(".web-commerce");c[5]=d.find(".component-navigators").find(".web-design");c[6]=d.find(".administrator");c[7]=d.find(".administrator");return bm.customTooltip(app.baseUrl+"dashboard/loadOnScreenHelp",1,c,"100","-100",a)},initializeAdministrativeNotification:function(){var a=$("#administrative-notification-wrapper");a.find(".close").length?a.scrollbar("update"):
($("<span class='tool-icon close'></span>").appendTo(a).click(function(){a.remove()}),a.scrollbar({}))}};app.tabs.enterpriseReporting=function(a){this.text=$.i18n.prop("advanced.analytics");this.tip=$.i18n.prop("manage.advance.analytics");this.ui_class="advanced-analytics";this.ajax_url=app.baseUrl+"commanderReporting/loadAppView";this.filter={duration:"today"};arguments.callee._super.constructor.apply(this,arguments)};var _e=app.tabs.enterpriseReporting.inherit(app.Tab);
_e.onSwitchMenuClick=function(a){app.Tab.changeView(this,"enterpriseReporting",a)};app.tabs.enterpriseReporting.landing=function(){arguments.callee._super.constructor.apply(this,arguments)};_e.reinit=function(){this.body.find(".app-tab-content-container").scrollbar({vertical:{offset:-5}});app.tabs.enterpriseReporting._super.reinit.apply(this,arguments)};var _l=app.tabs.enterpriseReporting.landing.inherit(app.tabs.enterpriseReporting);
_l.init=function(){var a=this;this.body.find(".report-navigator .report-icon, .report-navigator .title").click(function(){app.Tab.changeView(a,"enterpriseReporting",$(this).closest(".report-navigator").attr("view-type"))});app.tabs.enterpriseReporting.landing._super.init.apply(this,arguments)};
app.ribbons.report.push({text:$.i18n.prop("advanced.analytics"),processor:app.tabs.enterpriseReporting.landing,ui_class:"advanced-analytics",views:[{ui_class:"real_time",text:$.i18n.prop("realtime.analytics")},{ui_class:"products",text:$.i18n.prop("products")},{ui_class:"orders",text:$.i18n.prop("orders")},{ui_class:"payments",text:$.i18n.prop("payments")},{ui_class:"taxes",text:$.i18n.prop("taxes")}]});
app.tabs.enterpriseReporting.real_time=function(){arguments.callee._super.constructor.apply(this,arguments);this.ajax_url=app.baseUrl+"commanderReporting/loadRealTimeView"};_r=app.tabs.enterpriseReporting.real_time.inherit(app.tabs.enterpriseReporting);_r.reinit=function(){var a=this;this.body.find(".header .toolbar .filter-report").change(function(){a.ajax_data={hour:this.value};a.reload()});app.tabs.enterpriseReporting.real_time._super.reinit.apply(this,arguments)};
_r.switch_menu_entries=[{text:$.i18n.prop("product.report"),ui_class:"view-switch product-report",action:"products"},{text:$.i18n.prop("order.report"),ui_class:"view-switch order-report",action:"orders"},{text:$.i18n.prop("payment.report"),ui_class:"view-switch payment-report",action:"payments"},{text:$.i18n.prop("tax.report"),ui_class:"view-switch tax-report",action:"taxes"}];app.tabs.enterpriseReporting.commonView=function(){arguments.callee._super.constructor.apply(this,arguments)};_c=app.tabs.enterpriseReporting.commonView.inherit(app.tabs.enterpriseReporting);
_c.reinit=function(){var a=this;app.tabs.enterpriseReporting.commonView._super.reinit.call(a);a.body.find(".header .tool-group .add-favourite").click(function(){bm.editPopup(app.baseUrl+"commanderReporting/addToFavourite",$.i18n.prop("save.report.as"),void 0,void 0,{events:{content_loaded:function(b,d){d.append($("<input type='hidden' name='filters'>").val(JSON.stringify(a.ajax_data)));d.append($("<input type='hidden' name='type'>").val(a.type))}},success:function(){app.global_event.trigger("favourite-report-created")},
width:850})});a.body.find(".header .tool-group .favourite").click(function(){var a=app.Tab.getTab("tab-favourite-reports");a||(a=new app.tabs.favouriteReport({id:"tab-favourite-reports"}),a.render());a.setActive()});a.body.find(".header .tool-group .export").click(function(){bm.editPopup(app.baseUrl+"commanderReporting/export",$.i18n.prop("export.your.report"),name,{id:id},{success:function(){a.reload()},width:850})});a.body.find(".header .toolbar .date-filter").change(function(){a.ajax_data=$.extend(a.ajax_data,
{duration:this.value,xyz:"dfgsdgfs",start:void 0,end:void 0});"custom.date.range"==this.value?a.body.find(".header .toolbar .datefield-between").show():a.reload()});a.body.find(".header .toolbar .report-type").change(function(){a.ajax_data=$.extend(a.ajax_data,{reportCode:this.value,xaxis:null,yaxis:null});a.reload()});a.body.find(".header .toolbar .date-range-apply").click(function(){var b=a.body.find(".header .toolbar .datefield-from").val(),d=a.body.find(".header .toolbar .datefield-to").val();
b&&d&&d>b&&(a.ajax_data=$.extend(a.ajax_data,{duration:"custom.date.range",start:b,end:d}),a.reload())});a.body.find(".app-tab-content-container .chart-option").click(function(){var b=bm.floatingPanel($(this),app.baseUrl+a.chartOptionUrl,a.ajax_data,{width:550,height:290,clazz:"advanced-analytics-chart-options"});b.getDom().change(function(d){var c=$(d.target);d=c.attr("name");c=c.val();a.ajax_data=a.ajax_data||{};a.ajax_data[d]=c;b.dirty=!0});b.on("close",function(){b.dirty&&a.reload()})});a.body.find(".app-tab-content-container .table-filter").click(function(){bm.floatingPanel($(this),
app.baseUrl+a.tableFilterUrl,a.ajax_data,{width:500,clazz:"advanced-analytics-filter-options",events:{content_loaded:function(b){var d=$(this);d.updateUi();d.change(function(c){var d=$(c.target);c=d.attr("name");d=d.val();a.ajax_data=a.ajax_data||{};a.ajax_data[c]=d;b.dirty=!0}).find(".submit-button").on("click",function(){b.close()});b.on("close",function(){b.dirty&&a.reload()})}},position_collison:"none"})})};
app.tabs.enterpriseReporting.products=function(){arguments.callee._super.constructor.apply(this,arguments);this.ajax_url=app.baseUrl+"commanderReporting/loadProductReport";this.type="product"};var _pr=app.tabs.enterpriseReporting.products.inherit(app.tabs.enterpriseReporting.commonView);
_pr.switch_menu_entries=[{text:$.i18n.prop("real.time.report"),ui_class:"view-switch real-time-report",action:"real_time"},{text:$.i18n.prop("order.report"),ui_class:"view-switch order-report",action:"orders"},{text:$.i18n.prop("tax.report"),ui_class:"view-switch tax-report",action:"taxes"},{text:$.i18n.prop("payment.report"),ui_class:"view-switch payment-report",action:"payments"}];_pr.chartOptionUrl="commanderReporting/loadChartOptionForProduct";_pr.tableFilterUrl="commanderReporting/loadFilterForProduct";
app.tabs.enterpriseReporting.orders=function(){arguments.callee._super.constructor.apply(this,arguments);this.ajax_url=app.baseUrl+"commanderReporting/loadOrderReport";this.type="order"};var _o=app.tabs.enterpriseReporting.orders.inherit(app.tabs.enterpriseReporting.commonView);
_o.switch_menu_entries=[{text:$.i18n.prop("real.time.report"),ui_class:"view-switch real-time-report",action:"real_time"},{text:$.i18n.prop("payment.report"),ui_class:"view-switch payment-report",action:"payments"},{text:$.i18n.prop("tax.report"),ui_class:"view-switch tax-report",action:"taxes"},{text:$.i18n.prop("product.report"),ui_class:"view-switch product-report",action:"products"}];_o.chartOptionUrl="commanderReporting/loadChartOptionForOrder";_o.tableFilterUrl="commanderReporting/loadFilterForOrder";
_o.printOrder=function(a){a={id:a};bm.editPopup(app.baseUrl+"commanderReporting/print",$.i18n.prop("order.report"),name,a,{width:750,events:{content_loaded:function(){var a=$("<span class='print-order-image print-button'></span><iframe scrolling='no' style='width: 100%; border: none; overflow: hidden' class='printBody'></iframe>"),d=this.find(".content").html();this.find(".content").html(a);var c=a.filter(".printBody")[0].contentWindow;c.document.open();c.document.write(d);c.document.write("<script type='text/javascript'>function printMe() {window.print();}\x3c/script>");
c.document.close();var f=$(c.document.body);d=f.outerHeight(!0);a.filter(".printBody").css("height",d);this.find(".print-button").click(function(){c.focus();c.printMe()});setTimeout(function(){var b=f.outerHeight(!0);a.filter(".printBody").css("height",b)},1E3)}}})};app.tabs.enterpriseReporting.payments=function(){arguments.callee._super.constructor.apply(this,arguments);this.ajax_url=app.baseUrl+"commanderReporting/loadPaymentReport";this.type="payment"};var _pa=app.tabs.enterpriseReporting.payments.inherit(app.tabs.enterpriseReporting.commonView);
_pa.switch_menu_entries=[{text:$.i18n.prop("real.time.report"),ui_class:"view-switch real-time-report",action:"real_time"},{text:$.i18n.prop("order.report"),ui_class:"view-switch order-report",action:"orders"},{text:$.i18n.prop("tax.report"),ui_class:"view-switch tax-report",action:"taxes"},{text:$.i18n.prop("product.report"),ui_class:"view-switch product-report",action:"products"}];_pa.chartOptionUrl="commanderReporting/loadChartOptionForPayment";_pa.tableFilterUrl="commanderReporting/loadFilterForPayment";
app.tabs.enterpriseReporting.taxes=function(){arguments.callee._super.constructor.apply(this,arguments);this.ajax_url=app.baseUrl+"commanderReporting/loadTaxReport";this.type="tax"};var _t=app.tabs.enterpriseReporting.taxes.inherit(app.tabs.enterpriseReporting.commonView);
_t.switch_menu_entries=[{text:$.i18n.prop("real.time.report"),ui_class:"view-switch real-time-report",action:"real_time"},{text:$.i18n.prop("order.report"),ui_class:"view-switch order-report",action:"orders"},{text:$.i18n.prop("payment.report"),ui_class:"view-switch payment-report",action:"payments"},{text:$.i18n.prop("product.report"),ui_class:"view-switch product-report",action:"products"}];_t.chartOptionUrl="commanderReporting/loadChartOptionForTax";_t.tableFilterUrl="commanderReporting/loadFilterForTax";
app.tabs.favouriteReport=function(a){this.text=$.i18n.prop("favourite.reports");this.tip=$.i18n.prop("list.manage.favourite.reports");this.ui_class="favourite-reports";this.ajax_url=app.baseUrl+"commanderReporting/loadFavouriteAppView";arguments.callee._super.constructor.apply(this,arguments)};var _f=app.tabs.favouriteReport.inherit(app.SingleTableTab);_f.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("remove"),ui_class:"delete"},{text:$.i18n.prop("load"),ui_class:"load"}];
_f.init=function(){var a=this;this.on_global("favourite-report-created",function(){a.reload()});app.tabs.favouriteReport._super.init.apply(this,arguments)};_f.onActionClick=function(a,b){switch(a){case "edit":this.rename(b.id,b.name);break;case "delete":this.deleteReport(b.id,b.name);break;case "load":this.load(b.filters,b.type)}};_f.rename=function(a,b){var d=this;bm.editPopup(app.baseUrl+"commanderReporting/addToFavourite",$.i18n.prop("rename.report"),b,{id:a},{success:function(){d.reload()},width:850})};
_f.deleteReport=function(a,b){var d=this;bm.remove("report",$.i18n.prop("favourite.report"),$.i18n.prop("confirm.delete.report",[b]),app.baseUrl+"commanderReporting/deleteReport",a,{success:function(){d.reload()}})};
_f.load=function(a,b){a=JSON.parse(a);b="tax"==b?"taxes":b+"s";var d=app.Tab.getTab("tab-advanced-analytics");d?(d.setActive(),d.ajax_data=a,d instanceof app.tabs.enterpriseReporting[b]?d.reload():(d.constructor_args=[{ajax_data:a}],app.Tab.changeView(d,"enterpriseReporting",b))):(a.type||(d=new app.tabs.enterpriseReporting[b]({ajax_data:a}),d.render()),d.setActive())};
app.tabs.manageContent=function(){app.tabs.manageContent._super.constructor.apply(this,arguments);this.constructor_args=arguments;this.tip=this.name=this.text="Manage";this.ui_class="my-account-content";this.ui_body_class="manage-my-account-content";$.extend(this,{ajax_url:"myAccount/loadManageAction"})};var _mc=app.tabs.manageContent.inherit(app.Tab);(function(){_mc.init=function(){app.tabs.manageContent._super.init.call(this)}})();
app.tabs.messageSource=function(a){this.text=$.i18n.prop("message.source");this.tip=$.i18n.prop("manage.message.source");this.ui_class="message-source";this.ajax_url=app.baseUrl+"messageSource/loadAppView";app.tabs.messageSource._super.constructor.apply(this,arguments)};app.ribbons.administration.push({text:$.i18n.prop("message.source"),processor:app.tabs.messageSource,ui_class:"message-source"});app.tabs.messageSource.inherit(app.SingleTableTab);var _ms=app.tabs.messageSource.prototype;
_ms.errorHighlight=function(a,b){bm.notify(b,"alert");a.addClass("error-highlight");setTimeout(function(){a.removeClass("error-highlight")},3E3)};
_ms.attachTypeTableEvents=function(a){var b=this;a.find(".add-row").on("click",function(){if(a.valid({show_error:!1})){var d=a.find("[name=key]").val(),c=a.find("[name=message]").val();d?c?b.save(null,d,c):b.errorHighlight(a.find("[name=message]"),$.i18n.prop("this.field.is.required")):b.errorHighlight(a.find("[name=key]"),$.i18n.prop("this.field.is.required"))}});a.on("invalid",function(a,c){b.errorHighlight(c.validator.elm,$.i18n.prop(c.msg_template,c.msg_params))});a.on("keypress",function(b){13==
b.which&&a.find(".add-row").trigger("click")})};_ms.attachEvents=function(){var a=this;this.attachTypeTableEvents(this.body.find("tr.last-row"));this.body.find("span.tool-icon.remove").on("click",function(){var b=$(this).closest("tr").find(".key").text().trim();a.remove($(this).attr("entity-id"),b)})};
_ms.afterCellEdit=function(a,b,d){var c=a.parent(),f=c.attr("entity-id"),g=c.find("td.key .value").text();c=c.find("td.message .value").text();if(!b)return this.errorHighlight(a.find("input"),$.i18n.prop("this.field.is.required")),!1;if(200<b.length)return this.errorHighlight(a.find("input"),$.i18n.prop("enter.no.more.characters",[200])),!1;this.save(f,g,c,function(){a.find(".value").text(d)})};
(function(){_ms.init=function(){var a=this;app.tabs.messageSource._super.init.call(this);a.attachEvents();a.localeSelector=a.body.find("select[name=locale]");a.localeSelector.on("change",function(){a.reload()})}})();_ms.save=function(a,b,d,c){var f=this;a={id:a,key:b,message:d,locale:f.localeSelector.val()};bm.ajax({url:app.baseUrl+"messageSource/save",data:a,success:function(a){f.reload()},error:function(){c&&c()}})};
_ms.remove=function(a,b){var d=this;bm.confirm($.i18n.prop("do.you.want.to.remove.message",[b]),function(){bm.ajax({url:app.baseUrl+"messageSource/remove",data:{id:a},success:function(a){d.reload()}})},function(){})};_ms.afterTableReload=function(){this.attachEvents()};_ms.beforeReloadRequest=function(a){app.tabs.messageSource._super.beforeReloadRequest.call(this,a);a.locale=this.localeSelector.val()};
app.tabs.myAccount=function(){this.constructor_args=arguments;this.text=$.i18n.prop("my.account");this.tip=$.i18n.prop("my.account");this.ui_class="my-account";app.tabs.myAccount._super.constructor.apply(this,arguments);this.ajax_url=app.baseUrl+"myAccount/loadAppView"};_m=app.tabs.myAccount.inherit(app.MultiTab);_m.init=function(){app.tabs.myAccount._super.init.call(this)};
_m.onContentLoad=function(a){"function"==typeof app.tabs.myAccount.tabInitFunctions[a.index]&&app.tabs.myAccount.tabInitFunctions[a.index].call(this,a.panel,a.tab)};_m.notEditable=!0;app.tabs.myAccount.tabInitFunctions={};app.tabs.myAccount.tabInitFunctions.manage=function(a){new app.tabs.myAccount.manage(this,a)};
app.tabs.myAccount.manage=function(a,b){this.parentTab=a;this.body=b;this.tool=b.tool;var d=[{text:$.i18n.prop("Manage"),ui_class:"edit",action:"manage"}];$.each(b,function(a,b){this.tabulator=bm.table($(b),$.extend({menu_entries:d}));this.tabulator.onActionClick=function(a,b){switch(a){case "manage":editContent()}}})};editContent=function(){var a=app.Tab.getTab("my-account-content");a||(a=new app.tabs.manageContent({id:"my-account-content"}),a.render());a.setActive()};
app.tabs.myAccount.tabInitFunctions.accountDetails=function(a){(new app.tabs.myAccount.accountDetails(this,a)).init()};app.tabs.myAccount.accountDetails=function(a,b){this.parentTab=a;this.body=b;this.tool=b.tool;this.sectionList={info:{ajax_url:app.baseUrl+"myAccount/accountInfo"},websiteDetails:{ajax_url:app.baseUrl+"myAccount/websiteDetails"},billingAddress:{ajax_url:app.baseUrl+"myAccount/billingAddress"}}};var _ad=app.tabs.myAccount.accountDetails.inherit(app.MultiSectionView);
_ad.initInfoSection=function(a){var b=this;a.find(".edit-info").on("click",function(){b.editAccountInfo()})};_ad.editAccountInfo=function(){var a=this;this.parentTab.renderCreatePanel(app.baseUrl+"myAccount/accountInfoEdit",$.i18n.prop("edit.account.details"),null,{},{success:function(){a.reload("info")}})};app.tabs.myAccount.tabInitFunctions.purchaseHistory=function(a){(new app.tabs.myAccount.purchaseHistory(this,a)).init()};
(function(){app.tabs.myAccount.purchaseHistory=function(a,b){this.parentTab=a;this.body=b;this.tool=b.tool;this.ajax_url=app.baseUrl+"myAccount/loadPurchaseHistory"};app.tabs.myAccount.purchaseHistory.inherit(app.SingleTableView)})();app.tabs.myAccount.tabInitFunctions.invoice=function(a){(new app.tabs.myAccount.invoice(this,a)).init()};(function(){app.tabs.myAccount.invoice=function(a,b){this.parentTab=a;this.body=b;this.tool=b.tool;this.ajax_url=app.baseUrl+"myAccount/loadInvoice"};app.tabs.myAccount.invoice.inherit(app.SingleTableView)})();
app.tabs.myAccount.tabInitFunctions.subscription=function(a){var b=this;a.find(".content").scrollbar();a.find(".purchase-package").on("click",function(){var a=$(this);b.purchase(a.attr("package-id"),a.siblings(".name").text())})};_m.purchase=function(a,b){var d=this;bm.editPopup(app.baseUrl+"myAccount/cardInfoPopup",$.i18n.prop("purchase.package"),b,{packageId:a},{success:function(){bm.confirm($.i18n.prop("have.to.reload.changes.effective"),function(){window.location.href=app.baseUrl+"admin"},function(){d.reload("packageDetails")})}})};
app.tabs.myAccount.tabInitFunctions.customerSupport=function(a){(new app.tabs.myAccount.customerSupport(this,a)).init()};
(function(){function a(a){return $('<form class="create-edit-form" action="'+app.baseUrl+a+'" method="post"><div class="form-row"><textarea name="message" validation="required" class="wceditor" toolbar-type="super_simple"></textarea></div><div class="form-row btn-row"><button type="submit">Submit</button></div></form>')}function b(){var a=this;this.body.find(".reply-message").on("click",function(){var b=$(this).parents(".message-thread");a.reply(b)});this.body.find(".expander").on("click",function(){$(this).parents(".message-thread").toggleClass("expanded")})}
app.tabs.myAccount.customerSupport=function(a,b){this.parentTab=a;this.body=b;this.tool=b.tool;this.ajax_url=app.baseUrl+"myAccount/loadCustomerSupport"};var d=app.tabs.myAccount.customerSupport.inherit(app.SingleTableView),c=app.tabs.myAccount.customerSupport._super;d.isNonTable=!0;d.afterTableReload=b;d.init=function(){var a=this;c.init.apply(this,arguments);this.body.find(".create-new-message").on("click",function(){a.create()});b.call(this)};d.create=function(){if(!this.createForm){var b=this,
c=a("myAccount/addSupportMessage");b.body.find(".body").prepend(c.updateUi());this.createForm=c;c.form({ajax:{success:function(){c.remove();b.createForm=null;b.reload()}}})}};d.reply=function(b){if(!(0<b.find(".create-edit-form").length)){var c=this,d=a("myAccount/addSupportMessageReply");b.find(".message-replies").append(d.updateUi());d.form({preSubmit:function(a){a.data={messageId:b.attr("message-id")}},ajax:{success:function(){d.remove();c.reload()}}})}}})();
app.tabs.myAccount.tabInitFunctions.customProject=function(a){(new app.tabs.myAccount.customProject(this,a)).init()};
(function(){function a(){var a=this;this.body.find(".manage-project").on("click",function(){a.manage($(this).attr("project-id"))})}app.tabs.myAccount.customProject=function(a,b){this.parentTab=a;this.body=b;this.tool=b.tool;this.ajax_url=app.baseUrl+"myAccount/loadCustomProject"};var b=app.tabs.myAccount.customProject.inherit(app.SingleTableView),d=app.tabs.myAccount.customProject._super;b.init=function(){d.init.apply(this,arguments);var b=this;this.body.find(".create-new-project").on("click",function(){b.save()});
this.parentTab.on_global("custom-project-create",function(){b.reload()});a.call(this)};b.afterTableReload=function(){a.call(this)};b.save=function(){bm.ajax({url:app.baseUrl+"myAccount/saveCustomProject",success:function(){app.global_event.trigger("custom-project-create")}})};b.manage=function(a){(new app.editCustomProject(this.parentTab,a)).init()}})();app.editCustomProject=function(a,b){this.itemTab=a;this.projectId=b;app.editCustomProject._super.constructor.call(this,arguments)};_e=app.editCustomProject.inherit(app.MultiTab);
_e.notEditable=!0;var _super=app.editCustomProject._super;
_e.init=function(){var a=this;a.itemTab.renderCreatePanel(app.baseUrl+"myAccount/loadCustomProjectEditor",null,null,{projectId:a.projectId},{createPanelTemplate:$('<div class="embedded-edit-form-panel create-panel"><div class="header"><span class="toolbar toolbar-right"><span class="tool-group toolbar-btn cancel">'+$.i18n.prop("close")+'</span></span></div><div class="body"></div></div>'),ajax:{show_success_status:!1},submit_n_cancle:!1,content_loaded:function(b){a.body=this;a.header=this.find(".header");
_super.init.apply(a,arguments)}})};_e.onContentLoad=function(a){"function"==typeof app.editCustomProject.tabInitFunctions[a.index]&&app.editCustomProject.tabInitFunctions[a.index].call(this,a.panel,a.tab)};var initFunctions=app.editCustomProject.tabInitFunctions={};initFunctions.overview=function(a){a.find("td.action-column .approve").on("click",function(){var a=$(this);a.is(".approved")||bm.ajax({url:app.baseUrl+"myAccount/approveProjectMilestone",data:{id:a.attr("entity-id")},success:function(){a.addClass("approved").removeClass("approve")}})})};
initFunctions.projectDetails=function(a){var b=a.find("[name=detailsId]").val();a.find(".add-file").on("click",function(){bm.editPopup(app.baseUrl+"myAccount/editProjectDetailsFile",$.i18n.prop("add.file"),null,{detailsId:b},{success:function(b){a.find("files").append('<span class="file '+b.ext+'">'+b.name+"</span>")}})})};
initFunctions.projectFiles=function(a){var b=a.find("[name=projectId]").val();a.find(".add-file").on("click",function(){bm.editPopup(app.baseUrl+"myAccount/editProjectProjectFiles",$.i18n.prop("add.files"),null,{projectId:b},{success:function(b){a.reload()}})})};initFunctions.projectMessages=function(a){(new app.editCustomProject.ProjectMessages(this,a)).init()};
(function(){function a(a){return $('<form class="create-edit-form" action="'+app.baseUrl+a+'" method="post"><div class="form-row"><textarea name="message" validation="required" class="wceditor" toolbar-type="super_simple"></textarea></div><div class="form-row btn-row"><button type="submit">Submit</button></div></form>')}function b(){var a=this;this.body.find(".reply-message").on("click",function(){var b=$(this).parents(".message-thread");a.reply(b)});this.body.find(".expander").on("click",function(){$(this).parents(".message-thread").toggleClass("expanded")})}
app.editCustomProject.ProjectMessages=function(a,b){this.parentTab=a;this.projectId=a.projectId;this.body=b;this.tool=b.tool;this.ajax_url=app.baseUrl+"myAccount/loadCustomProjectProperties?property=projectMessages&id="+this.projectId};var d=app.editCustomProject.ProjectMessages.inherit(app.SingleTableView),c=app.editCustomProject.ProjectMessages._super;d.isNonTable=!0;d.afterTableReload=b;d.init=function(){var a=this;c.init.apply(this,arguments);this.body.find(".create-new-message").on("click",function(){a.create()});
b.call(this)};d.create=function(){if(!this.createForm){var b=this,c=a("myAccount/addProjectMessage");b.body.find(".body").prepend(c.updateUi());this.createForm=c;c.form({preSubmit:function(a){a.data={projectId:b.projectId}},ajax:{success:function(){c.remove();b.createForm=null;b.reload()}}})}};d.reply=function(b){if(!(0<b.find(".create-edit-form").length)){var c=this,d=a("myAccount/addProjectMessageReply");b.find(".message-replies").append(d.updateUi());d.form({preSubmit:function(a){a.data={messageId:b.attr("message-id"),
projectId:c.projectId}},ajax:{success:function(){d.remove();c.reload()}}})}}})();
(function(){function a(a){var b=a.find(".name-column"),c=$('<input class="name" type="text">');a.find(".tool-icon").on("click",function(){var e=$(this);switch(e.attr("action")){case "add":d(a);break;case "remove":a.parent().remove();break;case "edit":e.is(".apply")?""==c.val().trim()?(c.addClass("error-input"),setTimeout(function(){c.removeClass("error-input")},5E3)):(b.text(c.val().trim()),e.removeClass("apply").addClass("edit")):(b.html(c),e.removeClass("edit").addClass("apply"))}})}function b(b,
c){var d=$('<div class="bmui-stl-entry"><div class="table-actions action-column"></div><div class="name-column"></div></div>'),f="";g.forEach(function(a){f+='<span class="tool-icon '+a+'" title="'+$.i18n.prop(a)+'" action="'+a+'"></span>'});d.find(".action-column").html(f);d.find(".name-column").text(b);m.sortableTreeList("addHandle",d,c);a(d)}function d(a){var c=$('<div class="bmui-stl-entry"><div class="table-actions action-column"></div><div class="name-column"></div></div>'),d=$('<input class="name" type="text">');
c.find(".action-column").html('<span class="tool-icon apply" title="Remove"></span><span class="tool-icon remove" title="Remove"></span>');c.addClass("new-node-creator-row").find(".name-column").html(d);a?a.parent().append(c):m.append(c);c.find(".apply").on("click",function(){""==d.val().trim()?(d.addClass("error-input"),setTimeout(function(){d.removeClass("error-input")},5E3)):(c.remove(),b(d.val(),a))});c.find(".remove").on("click",function(){c.remove()})}function c(a){var b=[];a=a.find(">.bmui-stl-entry-container");
a.length&&a.each(function(){var a=$(this),d=a.find(">.bmui-stl-sub-container");a=a.find(">.bmui-stl-entry > .name-column");b.push({name:a.text().trim(),children:c(d)})});return b}function f(a){var b=JSON.stringify(c(m));bm.ajax({url:app.baseUrl+"myAccount/saveProjectSitemap",data:{sitemap:b,projectId:l},success:function(){a()}})}var g=["add","edit","remove"],m=null,l;initFunctions.sitemap=function(a){l=this.projectId;a.save=f;a.find(".save").on("click",function(){f(function(){a.clearDirty()})});m=
a.find(".scroll-item-wrapper");m.sortableTreeList({change:function(b){a.setDirty()}});a.find(".create-new").on("click",function(){d()})}})();
app.tabs.plugin=function(a){this.constructor_args=arguments;this.text=$.i18n.prop("plugin");this.tip=$.i18n.prop("manage.plugins");this.ui_class="plugin";app.tabs.plugin._super.constructor.apply(this,arguments);this.sectionList={myPackage:{ajax_url:app.baseUrl+"plugin/myPackagePlugins"},allPackage:{ajax_url:app.baseUrl+"plugin/allPackagePlugins"}};this.ajax_url=app.baseUrl+"plugin/loadAppView"};_p=app.tabs.plugin.inherit(app.MultiSectionTab);
app.ribbons.administration.push({text:$.i18n.prop("plugin"),processor:app.tabs.plugin,ui_class:"plugin"});_p.init=function(){app.tabs.plugin._super.init.call(this)};app.global_event.on("after-ribbon-render",function(a,b){app.isPermitted("plugin.view.list")?b.enable("plugin"):b.disable("plugin")});
_p.initMyPackageSection=function(a){function b(){var a=c.val();d.myPackPlugins.each(function(){var b=$(this);b.find(".name").text().trim().match(new RegExp(a,"i"))?b.show():b.hide()})}var d=this;d.myPackPlugins=a.find(".plugin");a.find(".content").scrollbar();a.find("button.install").on("click",function(){var a=$(this);d.install(a.attr("plugin-id"),a.siblings(".name").text())});a.find("button.uninstall").on("click",function(){var a=$(this);d.uninstall({id:a.attr("plugin-id"),name:a.siblings(".name").text()})});
var c=a.find(".search-text");c.ichange(800,function(){b()});a.find(".search-form").form({preSubmit:function(){b();return!1}})};_p.initAllPackageSection=function(a){var b=this;a.find(".tab-body .plugins").scrollbar();a.find(".update-package").on("click",function(){var a=$(this);b.upgradeDowngrade(a.attr("pack-id"),a.is(".upgrade-package"))});a.find("#bmui-tab-additional-plugins button.install").on("click",function(){var a=$(this);b.install(a.attr("plugin-id"),a.siblings(".name").text())})};
app.tabs.plugin.reloadAfterRestart=function(a){function b(d){try{bm.ajax({url:app.baseUrl+"app/isRestarted",data:{time:a},success:function(a){a.isRestarted?d():setTimeout(function(){b(d)},1E4)},error:function(){setTimeout(function(){b(d)},1E4)}})}catch(c){setTimeout(function(){b(d)},1E4)}}$("body").loader();b(function(){$("body").loader(!1);window.location.reload()})};
_p.uninstall=function(a){function b(c){bm.ajax({url:app.baseUrl+"plugin/uninstall",data:{id:a.id,uninstall_dependent:c},success:function(){"true"==app.isSoftInstallUninstallEnable?bm.confirm($.i18n.prop("server.restart.required"),[{clazz:"restart",text:"restart",handler:function(){bm.ajax({url:app.baseUrl+"plugin/restart",data:{reason:"After uninstall plugin "+a.name},success:function(a){app.tabs.plugin.reloadAfterRestart.call(d,(new Date).getTime())}})}},{clazz:"no",text:"no",handler:function(){}}]):
bm.confirm($.i18n.prop("have.to.reload.changes.effective"),function(){window.location.href=app.baseUrl+"admin"},function(){d.reload("myPackage")})},error:function(c,d,m){"yes"==m.dependents&&bm.confirm($.i18n.prop("plugin.have.dependent.plugins",[a.name]),function(){b("yes")},function(){})}})}var d=this;bm.confirm($.i18n.prop("confirm.uninstall.plugin",[a.name]),b,function(){})};
_p.install=function(a,b){var d=this;bm.confirm($.i18n.prop("confirm.install.plugin",[b]),function(){var c=bm.waitPopup();bm.ajax({url:app.baseUrl+"plugin/install",data:{identifier:a,name:b},success:function(){c.close();bm.confirm($.i18n.prop("have.to.reload.changes.effective"),function(){window.location.href=app.baseUrl+"admin"},function(){d.reload("myPackage")})},complete:function(){c.close()}})},function(){})};
_p.upgradeDowngrade=function(a,b,d){ComponentManager.openTab({text:$.i18n.prop("my.account"),processor:app.tabs.myAccount,ui_class:"my-account"})};app.tabs.role=function(a){this.text=$.i18n.prop("roles");this.tip=$.i18n.prop("manage.roles");this.ui_class="role";this.ajax_url=app.baseUrl+"role/loadAppView";app.tabs.role._super.constructor.apply(this,arguments)};app.ribbons.administration.push({text:$.i18n.prop("role"),processor:app.tabs.role,ui_class:"role",license:CONSTANTS.LICENSES.ACL});app.tabs.role.inherit(app.SingleTableTab);
_r=app.tabs.role.prototype;_r.advanceSearchUrl=app.baseUrl+"role/advanceFilter";_r.advanceSearchTitle=$.i18n.prop("role");_r.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("manage.operators"),ui_class:"manage-operators"},{text:$.i18n.prop("manage.permissions"),ui_class:"manage-permissions",license:CONSTANTS.LICENSES.ACL},{text:$.i18n.prop("remove"),ui_class:"remove"}];
(function(){function a(){var a=this;this.on("close",function(){app.tabs.role.tab=null});this.body.find(".toolbar .create").on("click",function(){a.createRole()})}_r.init=function(){app.tabs.role._super.init.call(this);app.tabs.role.tab=this;a.call(this)};app.global_event.on("after-ribbon-render",function(a,d){app.isPermitted("role.view.list",{})?d.enable("role"):d.disable("role")})})();_r.sortable={list:{1:"name",3:"created",4:"updated"},sorted:"1",dir:"up"};
_r.onMenuOpen=function(a){var b=this.tabulator.menu,d=[{key:"role.edit.permission",class:"manage-permissions"}];a=(""+a.config("entity").name).toLowerCase();var c=b.find(".menu-item.edit, .menu-item.remove");a.match(/^(admin|moderator|basic operator)$/)?c.addClass("disabled"):(c.removeClass("disabled"),app.checkPermission(b,d))};_r.onActionMenuOpen=function(a){app.checkPermission(a,[{key:"role.create",class:"create-role"}])};
_r.onActionClick=function(a,b){switch(a){case "edit":this.editRole(b.id,b.name);break;case "remove":this.deleteRole(b.id,b.name);break;case "manage-operators":this.manageUsers(b.id,b.name);break;case "manage-permissions":this.managePermissions(b.id,b.name)}};_r.viewRole=function(a){bm.viewPopup(app.baseUrl+"role/view",{id:a})};_r.deleteRole=function(a,b){var d=this;bm.remove("role","role",$.i18n.prop("confirm.delete.role",[b]),app.baseUrl+"role/delete",a,{is_final:!0,success:function(){d.reload()}})};
_r.editRole=function(a,b){var d=this,c=a?$.i18n.prop("edit.role"):$.i18n.prop("create.role");this.renderCreatePanel(app.baseUrl+"role/edit",c,b,{id:a},{success:function(){d.reload();app.global_event.trigger("role-update",[a])}})};_r.manageUsers=function(a,b){bm.editPopup(app.baseUrl+"role/manageUsers",$.i18n.prop("manage.operators"),b,{id:a},{})};_r.managePermissions=function(a,b){bm.permissionPopup($.i18n.prop("manage.permissions"),b,{id:a,for:"role"})};
_r.onSelectedActionClick=function(a,b){switch(a){case "manage_permission":this.managePermissions(b.collect("id"));break;case "delete":this.deleteSelectedRoles(b.collect("id"))}};_r.deleteSelectedRoles=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.roles"),function(){bm.ajax({url:app.baseUrl+"role/deleteSelected",data:{ids:a},success:function(){b.reload()}})},function(){})};
_r.createRole=function(){var a=this;this.renderCreatePanel(app.baseUrl+"role/create",$.i18n.prop("create.role"),"",{},{success:function(){a.reload();app.global_event.trigger("role-create")}})};
(function(){app.tabs.setting=function(a){this.text=$.i18n.prop("settings");this.tip=$.i18n.prop("manage.settings");this.ui_class="settings";this.ajax_url=app.baseUrl+"setting/loadAppView";app.tabs.setting._super.constructor.apply(this,arguments)};app.ribbons.administration.push({text:$.i18n.prop("settings"),processor:app.tabs.setting,ui_class:"settings"});app.tabs.setting.inherit(app.MultiTab);var a=app.tabs.setting.prototype;a.init=function(){function a(){b.body.find(".bmui-tab.left-side-header .bmui-tab-header").each(function(){var a=
$(this);a.find(".title").text().trim().match(new RegExp(g.val(),"i"))?a.show():a.hide()})}var b=this;app.tabs.setting._super.init.apply(this,arguments);var f=this.body.find(".bmui-tab.left-side-header .search-form"),g=f.find("input");g.ichange(700,function(){a()}).focus();f.form({preSubmit:function(){a();return!1}})};var b;a.initProductImageSettings=function(a){var b=a.panel.find("form#frmProductImageSetting");b.find(".use-original").on("change.disableInputs",function(){$(this).prop("checked")?$(this).closest(".double-input-row").find("input:text").attr("disabled",
"disabled").addClass("disabled"):$(this).closest(".double-input-row").find("input:text").removeAttr("disabled").removeClass("disabled")});b.find(".use-original").trigger("change.disableInputs");a.success=function(){app.global_event.trigger("product-image-change")}};a.initGeneralSettings=function(a){var b=a.panel.find("form#generalSettingsForm");this.countryChange=bm.countryChange(b,{inputClass:"medium"});b.find(".display-captcha-setting").on("change",function(){var a=b.find(".display-captcha-type");
$(this).is(":checked")?a.show():a.hide()});this.on_global(["page-create","page-update","send-trash","page-restore"],function(){bm.ajax({url:app.baseUrl+"setting/loadUpdatedPageSelects",dataType:"json",show_response_status:!1,success:function(a){function c(b,c){var d=$(a.select);b.html(d.html());b.chosen();b.chosen("val",c)}c(b.find("select[name='general.page404']"),a.page404);c(b.find("select[name='general.page403']"),a.page403)}})});a.success=function(){a.panel.reload({cachesToClear:["favicon"]})}};
a.initDefaultImagesSettings=function(a){a.panel.find(".reset-to-default .reset-icon").click(function(){var b=$(this),d=b.parents(".form-section-container");d.find(".image-preview").attr("src",app.baseUrl+"setting/loadDefaultImage?type="+b.attr("reset-type")+"&_="+(new Date).getTime());d.find(".reset-image").val("1");a.panel.setDirty()});a.panel.find("input[name^=defaultImages]").on("change",function(){$(this).siblings(".reset-to-default").find(".reset-image").val("0")});a.success=function(b){b.cachesToClear.iterate(function(c,
d){$('<img src="'+this+'">').clearCache(function(){d==b.cachesToClear.length-1&&(a.panel.reload(),app.global_event.trigger("default-image-update"));c.next()})})}};a.initTaxAndCurrencySettings=function(a){var b=a.panel.find("form"),d=b.find("[name='tax.configuration_type']");d.val();b.find(".customize-tax.active").on("click",function(){ComponentManager.openTab(ComponentManager.getRibbonData(app.ribbons.web_commerce,"tax"))});this.on_global(["tax-profile-create","tax-profile-update","tax-profile-delete"],
function(){b.find(".tax-profile-selector").each(function(){bm.updateDomainSelector($(this),"webcommerce.TaxProfile")})});a.success=function(){app.taxConfigType=d.val();a.panel.reload({cachesToClear:["favicon"]})};this.initCurrencyExtension.apply(this,arguments)};a.initShippingSettings=function(a){var b=this,d=a.panel.find("form");b.bindClassMenuEntries(d);this.on_global(["shipping-profile-create","shipping-profile-update","shipping-profile-delete"],function(){d.find(".shipping-profile-selector").each(function(){bm.updateDomainSelector($(this),
"webcommerce.ShippingProfile")})});d.find(".add-new-button").on("click",function(){$(this).hide();d.find(".form-row .submit-button").hide();b.addEditShippingClass(d)})};a.bindClassMenuEntries=function(a){var b=this,d=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("remove"),ui_class:"remove"},{text:$.i18n.prop("make.default"),ui_class:"make_default"}];bm.menu(d,a,".shipping-class-actions",{click:function(c,d){d=d.closest(".shipping-class-item");switch(c){case "edit":b.addEditShippingClass(a,
d);break;case "remove":b.removeClass(a,d);break;case "make_default":b.makeDefaultClass(a,d)}}},"click",["center bottom","right+22 top+7"])};a.removeClass=function(a,b){if(1==a.find(".shipping-class-row").length||b.is(".default"))bm.notify($.i18n.prop("default.class.can.not.be.deleted"),"alert");else{a=b.find(".name").text();var c=b.attr("class-id");bm.remove("shippingClass","Shipping Class",$.i18n.prop("confirm.remove.shipping.class",[a]),app.baseUrl+"shippingAdmin/deleteShippingClass",c,{success:function(){b.remove()},
is_final:!0})}};a.makeDefaultClass=function(a,b){bm.ajax({url:app.baseUrl+"setting/saveConfigurations",data:{type:"shipping","shipping.default_shipping_class":b.attr("class-id")},success:function(){a.find(".shipping-class-item.default").removeClass("default");b.addClass("default")}})};a.addEditShippingClass=function(a,b){var c=this,d=a.find(".shipping-class-form-template").clone().addClass("add-new-class-row create-edit-form").removeClass("shipping-class-form-template").show();a.find(".add-new-class-row").remove();
a.find(".shipping-data").show();b?(b.find(".shipping-data").hide(),d.find("input.id").val(b.attr("class-id")),b.append(d),d=b.find(".add-new-class-row"),d.find(".class-name").val(b.find(".name").text()),d.find(".class-description").val(b.find(".description").text()),d.find(".submit-button").text($.i18n.prop("update")),d.attr("class-id",b.attr("class-id"))):(a.find(".shipping-classes").append(d),b=a.find(".add-new-class-row"));a.find(".add-new-class-row").form();b.find(".submit-button").on("click",
function(d){c.submitShippingClassForm(a,b);d.preventDefault()});b.find(".cancel-button").on("click",function(){this.closest(".add-new-class-row").remove();a.find(".shipping-data").show();a.find(".add-new-button").show();a.find(".form-row .submit-button").show()})};a.submitShippingClassForm=function(a,b){var c=this,d=b.find(".class-name").val(),m=b.find(".class-description").val(),l=b.attr("class-id");b.valid()&&bm.ajax({url:app.baseUrl+"shippingAdmin/saveShippingClass",data:{id:l,name:d,description:m},
success:function(f){a.find(".shipping-data").show();l?(b.find(".shipping-data").find(".name").text(d),b.find(".shipping-data").find(".description").text(m)):(f='<div class="shipping-class-item" class-id="'+f.id+'"><div class="shipping-data"><span class="shipping-class-actions"></span><div class="name">'+d+'</div><div class="description">'+m+"</div></div></div>",a.find(".shipping-classes").append(f),c.bindClassMenuEntries(a));a.find(".add-new-class-row").remove();a.find(".add-new-button").show();a.find(".form-row .submit-button").show()}})};
a.initShippingApiSettings=function(a){function b(a){a.closest(".form-row").find(".algorithm-note").remove();a.closest(".form-row").append('<span class="algorithm-note">'+$.i18n.prop(a.val().toLowerCase().replaceAll("_",".")+".algorithm.note")+"</span>")}a=a.panel.find("form");a.find(".packing-algorithm").change(function(){b($(this))});b(a.find(".packing-algorithm"))};a.initCustomerRegistrationSettings=function(a){var b=a.panel.find("form.fields-setting");this.formFieldsSetting(b);this.restore(a.panel,
"restoreCustomerRegistrationSettings")};a.initBillingAddressSettings=function(a){var b=a.panel.find("form.fields-setting");this.formFieldsSetting(b);this.restore(a.panel,"restoreBillingAddressSettings")};a.initShippingAddressSettings=function(a){var b=a.panel.find("form.fields-setting");this.formFieldsSetting(b);this.restore(a.panel,"restoreShippingAddressSettings")};a.initCustomerProfilePageSettings=function(a){var b=this;b.customerProfileFieldsInlineChangeOnHover();a.panel.find(".label-bar").unbind();
a.panel.find(".accordion-panel").accordion({all_close:!0});a.panel.find(".child.label-bar").unbind();a.panel.find(".accordion-panel.child").childAccordion({all_close:!0});a.panel.find(".abandoned_cart_settings").on("click",function(){ComponentManager.openTab(ComponentManager.getRibbonData(app.ribbons.administration,"settings"),{active:"abandoned_cart"})});a.panel.find(".gift_card_settings").on("click",function(){ComponentManager.openTab(ComponentManager.getRibbonData(app.ribbons.administration,"settings"),
{active:"giftCard"})});a.panel.find(".loyalty_point_settings").on("click",function(){ComponentManager.openTab(ComponentManager.getRibbonData(app.ribbons.administration,"settings"),{active:"loyaltyPoint"})});a.panel.find(".wallet-item").jqObject.off("click");a.panel.find(".label-bar").click(function(c){a.panel.find(".child.label-bar").unbind();c=c.target.nextElementSibling.jqObject;this.jqObject.is(".collapsed")?a.panel.find(".child.label-bar").unbind():(0==this.jqObject.next(".accordion-item").find(".no-item").length&&
a.panel.find(".accordion-panel.child").childAccordion({all_close:!0}),b.customerSettngsTabSortableOn(c),a.panel.find(".child.label-bar").click(function(c){a.panel.find(".child-child.configurable-row").unbind();c=c.target.nextElementSibling.jqObject;this.jqObject.is(".collapsed")?a.panel.find(".child-child.configurable-row").unbind():b.customerSettngsTabSortableOn(c)}))});a.panel.find(".wcui-checkbox ,.inline-editable").click(function(a){a.stopPropagation()});var d=a.panel.find("form.customer-profile-settings");
b.customerSettngsTabSortableOn(d);b.customerProfileFieldsInlineChangeSetting(d);b.restore(a.panel,"restoreCustomerProfileSetting")};a.customerProfileFieldsInlineChangeSetting=function(a){a.find(".inline-editable").editableOnHover().on("inlinechange",function(){var a=this.jqObject,b=a.text();a.parent().find(".label-customer-profile-settings").val(b)})};a.customerProfileFieldsInlineChangeOnHover=function(){$.extend($.prototype,{editableOnHover:function(){var a="<span class='tool-icon edit inline-edit' title='Edit'></span> ".jqObject,
b='<span class="tool-icon reset" title="Revert"></span>'.jqObject;this.each(function(){var c=this.jqObject;c.hover(function(){this.edit_off||(c.append(a),c.append(b),c.find(".reset").on("click",function(){var a=this.jqObject.closest(".inline-editable"),b=a.parent().find(".default_label").text();a.text(b);a.parent().find(".label-customer-profile-settings").val(b)}),c.find(".edit").on("click",function(){var b=this.jqObject.closest(".inline-editable"),c=b.attr("data-editable-type")||"text";a.detach();
b.nat.edit_off=!0;b.addClass("editting");bm["editInline"+c.capitalize()](b).always(function(){b.nat.edit_off=!1;b.removeClass("editting")});b.find(".reset").remove()}))},function(){this.edit_off||(a.detach(),b.detach())})});return this}})};a.customerSettngsTabSortableOn=function(a){var b,d;a.find(".scroll-item-wrapper").sortable({containment:"parent",placeholder:!0,placeholder_size:!0,axis:"y",beforeStart:function(a){var b=a.elm.is(".collapsed");a=0<a.elm.find(".inline-edit-input").length?!1:!0;if(!b||
!a)return!1},start:function(a){d=a.elm;b=a.elm.next("div")},stop:function(){var c=d.next(".accordion-item");this.jqObject[0].candidate.is(".no-item")||(0<c.length&&c.insertBefore(d),b.insertAfter(d));this.jqObject[0].candidate.is(".child-child")&&a.find("input:hidden.order-child-child").each(function(a,b){$(b).val(a+1)});this.jqObject[0].candidate.is(".child")?a.find("input:hidden.order-child").each(function(a,b){$(b).val(a+1)}):a.find("input:hidden.order").each(function(a,b){$(b).val(a+1)})}});a.find(".sortable-container").sortable({containment:"parent",
placeholder:"address-form-sort-placeholder",axis:"y",stop:function(){this.jqObject[0].candidate.is(".child-child")&&a.find("input:hidden.order-child-child").each(function(a,b){$(b).val(a+1)});this.jqObject[0].candidate.is(".child")?a.find("input:hidden.order-child").each(function(a,b){$(b).val(a+1)}):a.find("input:hidden.order").each(function(a,b){$(b).val(a+1)})}})};a.formFieldsSetting=function(a){a.find(".sortable-container").sortable({containment:"parent",placeholder:"address-form-sort-placeholder",
stop:function(){a.find("input:hidden.order").each(function(a,b){$(b).val(a+1)})}});a.find(".tool-icon").click(function(){var a=$(this),b=a.closest(".configurable-row");a.is(".add")?(a.removeClass("add").addClass("remove").closest(".inactive").removeClass("inactive").addClass("active"),b.find("input.active").val(1),b.find(".required[name]").checkbox("enable",!0)):a.is(".remove")&&(a.removeClass("remove").addClass("add").closest(".active").removeClass("active").addClass("inactive"),b.find("input.active").val(0),
b.find(".required[name]").checkbox("state","unchecked").checkbox("enable",!1))});a.find(".configurable-row input:checkbox").on("change",function(){var a=$(this),b=a.closest(".configurable-row");a.prop("checked")?(a.closest(".configurable-row").addClass("required"),b.find(".required").val(1)):(a.closest(".configurable-row").removeClass("required"),b.find(".required").val(0))})};a.restore=function(a,b){var c=this;a.tool.find(".reset-default").on("click",function(){bm.confirm($.i18n.prop("confirm.restore.setting"),
function(){bm.ajax({url:app.baseUrl+"setting/"+b,success:function(){c.body.find(".reset-default").closest(".remove-after-reload").remove();a.reload()}})},function(){})})};a.initStoreSettings=function(a){var b=a.panel.find("form");this.countryChange=bm.countryChange(b,{inputClass:"medium"});a.success=function(b){b.imageName?$('<img src="'+app.baseUrl+"resources/store/"+b.imageName+'"/>').clearCache(function(){a.panel.reload()}):a.panel.reload()}};a.initCategoryImageSettings=function(a){var b=a.panel.find("form#frmCategoryImageSetting");
b.find(".use-original").on("change.disableInputs",function(){$(this).prop("checked")?$(this).closest(".double-input-row").find("input:text").attr("disabled","disabled").addClass("disabled"):$(this).closest(".double-input-row").find("input:text").removeAttr("disabled").removeClass("disabled")});b.find(".use-original").trigger("change.disableInputs");a.success=function(){app.global_event.trigger("category-image-change")}};a.initEmailSettings=function(a){var c=this,d=a.panel.find(".accordion-panel"),
g=[{text:$.i18n.prop("view"),ui_class:"view",action:"view"},{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"}];$.each(d.find(".email-table"),function(a,b){this.tabulator=bm.table($(b),$.extend({menu_entries:g}));this.tabulator.onActionClick=function(a,b){switch(a){case "view":c.viewTemplate(b.id,b.name);break;case "edit":c.editTemplate(b.id,b.name)}}});this.viewTemplate=function(a,b){var d=$.i18n.prop("edit.template");new POPUP($.extend({title:d+(" - <span class='emphasized'>"+$.i18n.prop(b)+
"</span>"),ajax_url:app.baseUrl+"setting/viewTemplate",ajax_settings:{data:{id:a}},draggable:!0},{width:765},{clazz:"edit-popup",events:{content_loaded:function(d){this.updateUi();this.find("> .content").scrollbar({reduce_margin_from_offset:!1,vertical:{offset:20}});this.find(".edit-mail").click(function(){d.close();c.editTemplate(a,b)});this.find(".send-mail").click(function(){bm.editPopup(app.baseUrl+"setting/testMailView",$.i18n.prop("send.test.mail"),$.i18n.prop(b),{id:a})})}}}))};c.editTemplate=
function(c,f){var g,l;bm.editPopup(app.baseUrl+"setting/editTemplate",$.i18n.prop("edit.template"),$.i18n.prop(f),{id:c},{width:765,draggable:!1,success:function(){b=$(d.find(".expanded")).find("[name='labelBarIdentifier']").val();a.panel.reload()},events:{content_loaded:function(){var a=this;a.find(".reset").click(function(){bm.ajax({url:app.baseUrl+"templateAdmin/setDefaultContent",data:{id:c},success:function(b){a.find(".data-txt").val(b.contentTxt);a.find(".data-html").html(b.contentHtml);l&&
l.doc.setValue(b.contentHtml)}})});var b=a.on("tabs");g=a.find(".code-mirror-editor");b.on("tab:activate",function(a,b){"html"==b.newIndex&&(l||(l=g.htmlCodeEditor()))})}},beforeSubmit:function(a,b){l&&g.val(l.getValue())}})}};a.initWebtoolSettings=function(a){var b=this,d=a.panel;this.one("redirect-301-import-success",function(){d.reload()});b=this;var g=d.find(".seo-file-list");g.scrollbar({vertical:{height:150,offset:-2}});d.find(".seo-upload-container").on("file-submit",function(a,b){b.fileName&&
g.append('<div class="item"><div class="name">#FILENAME#</div><div class="action"><span class="tool-icon remove" file-name="#FILENAME#"></span></div></div>'.replaceAll("#FILENAME#",b.fileName))});g.delegate(".tool-icon.remove","click",function(){var a=$(this);bm.ajax({url:app.baseUrl+"setting/removeSeoFile",data:{fileName:a.attr("file-name")},success:function(){a.parents(".item").remove()}})});a={};a.action_menu_entries=[{text:$.i18n.prop("import.301.redirects"),ui_class:"import-urls import",action:"import"},
{text:$.i18n.prop("export.301.redirects"),ui_class:"export",action:"export"}];a.onActionMenuClick=function(a){switch(a){case "import":b.initRedirectImport();break;case "export":window.open(app.baseUrl+"redirect/export")}};bm.menu(a.action_menu_entries,b.toolbar.find(".action-tool"),null,{click:$.proxy(a,"onActionMenuClick")},"click",["right bottom+7","right top"]);d.tool.find(".toolbar-item.import-urls").on("click",function(){b.initRedirectImport()});d.find("[name=seoUpload], .redirects-301-container").on("change",
function(){return!1});this.init301Redirect(d.find(".redirects-301-container"));this.on_global("301-redirect-import",function(){var a=d.find(".redirects-301-container").loader();bm.ajax({url:app.baseUrl+"setting/load301Redirect",dataType:"html",success:function(c){a.replaceWith(c);b.init301Redirect(d.find(".redirects-301-container"))}})})};a.init301Redirect=function(a){function b(a,b,c,e,f){b==c?bm.notify($.i18n.prop("old.new.url.must.not.be.same"),"error"):bm.ajax({url:app.baseUrl+"redirect/mapping301Redirect",
type:"post",data:{id:a,oldUrl:b,newUrl:c},success:function(a){var b=a.id,c=a.oldUrl;a=a.newUrl;var e=n.find("tr[mapping-id="+b+"]");e.length?(e.find("td.old-url span.value").text(c),e.find("td.new-url span.value").text(a)):(b='<tr mapping-id="#ID#"><td class="old-url editable">#OLD#</td><td class="new-url editable">#NEW#</td><td><span class="tool-icon remove"></span></td></tr>'.replace("#ID#",b).replace("#OLD#",c).replace("#NEW#",a),b=$(b),l.before(b),d(b),l.find(".old-url").val(""),l.find(".new-url").val(""))},
error:function(){e&&e.find(".value").text(f)}})}function d(a){bm.makeTableCellEditable(a.find("td.editable"),function(a,c,d){var e=a.parent("tr");if(!c)return m(a.find("input")),bm.notify($.i18n.prop("value.must.not.be.empty"),"error"),!1;c=e.find("td.old-url span.value").text();var f=e.find("td.new-url span.value").text();if(c==f)return m(a.find("input")),bm.notify($.i18n.prop("old.new.url.must.not.be.same"),"error"),!1;c=e.attr("mapping-id");f=e.find("td.old-url span.value").text();e=e.find("td.new-url span.value").text();
b(c,f,e,a,d)});a.find("td span.remove").on("click",function(){g($(this).parents("tr"))})}function g(a){var b=a.attr("mapping-id");bm.ajax({url:app.baseUrl+"redirect/remove301Redirect",data:{mappingId:b},success:function(b){a.remove()}})}function m(a){a.addClass("error-highlight");setTimeout(function(){a.removeClass("error-highlight")},1E3)}var l=a.find("tr.last-row"),n=a.find("table.url-mappings"),q=a.find(".last-row.multi-conditions");q.attachValidator();var e=function(){if(q.valid()){var a=l.find(".new-url").val(),
c=l.find(".old-url").val();c?a?b(null,c,a):m(l.find(".new-url")):m(l.find(".old-url"))}};l.find("input").bind("keydown.key_return",e);l.find(".add-row").on("click",e);d(a)};a.initResponsiveSettings=function(a){a=a.panel;a.find(".resolutions-container").on("change",function(){return!1});this.initResponsiveResolutionPanel(a.find(".resolutions-container"))};a.initResponsiveResolutionPanel=function(a){function b(a,b,c,f,g){if(b&&c&&+b>+c)return bm.notify($.i18n.prop("min.width.must.less.than.max.width"),
"error"),!1;bm.ajax({url:app.baseUrl+"setting/saveResolution",type:"post",data:{id:a,maxWidth:c,minWidth:b},success:function(a){a=a.id;var e=n.find("tr[resolution-id="+a+"]");e.length?(e.find("td.old-url span.value").text(b),e.find("td.new-url span.value").text(c)):(a='<tr resolution-id="#ID#"><td class="min-width editable" restrict="numeric">#MIN#</td><td class="max-width editable" restrict="numeric">#MAX#</td><td><span class="tool-icon remove"></span></td></tr>'.replace("#ID#",a).replace("#MIN#",
b).replace("#MAX#",c),a=$(a),l.before(a),d(a),l.find(".min-width").val(""),l.find(".max-width").val(""))},error:function(){f&&f.find(".value").text(g)}})}function d(a){bm.makeTableCellEditable(a.find("td.editable"),function(a,c,d){var e=a.parent("tr");c=e.attr("resolution-id");var f=e.find("td.min-width span.value").text();e=e.find("td.max-width span.value").text();f||e?a=b(c,f,e,a,d):(m(a.find("input")),bm.notify($.i18n.prop("value.must.not.be.empty"),"error"),a=!1);return a});a.find("td span.remove").on("click",
function(){g($(this).parents("tr"))})}function g(a){var b=a.attr("resolution-id");bm.ajax({url:app.baseUrl+"setting/removeResolution",data:{id:b},success:function(b){a.remove()}})}function m(a){a.addClass("error-highlight");setTimeout(function(){a.removeClass("error-highlight")},1E3)}var l=a.find("tr.last-row"),n=a.find("table.resolutions"),q=function(){var a=l.find(".min-width").val(),c=l.find(".max-width").val();a||c?b(null,a,c):m(l.find(".max-width"))};l.find("input").bind("keydown.key_return",
q);l.find(".add-row").on("click",q);d(a);l.find("input").numeric()};a.onContentLoad=function(a){var b=a.index.capitalize();a.panel.find("form").form({ajax:{success:function(){a.panel.clearDirty();a.success&&a.success.apply(this,arguments);app.global_event.trigger("after-"+a.index+"-settings-update")}}});if(this["init"+b+"Settings"])this["init"+b+"Settings"](a)};a.initCheckoutPageSettings=function(a){var b=a.panel;b.find("[name='checkout_page.terms_and_condition_type']").on("change",function(){var a=
$(this).val();bm.ajax({url:app.baseUrl+"setting/loadReferenceSelectorBasedOnType",data:{type:a},dataType:"html",success:function(a){var c=b.find(".ref-selector-row");a=$(a);c.html(a.html());c.updateUi();a=b.find("form").obj(ValidationPanel);a.attach(c.find("[validation]"),a)}})});a.success=function(){app.global_event.trigger("checkout-settings-change")}};a.initBackupRestoreSettings=function(a){function b(){var a=$("body");bm.mask(a,m);bm.ajax({type:"post",url:app.baseUrl+"setting/backupRestore",data:{backup:!0},
dataType:"json",success:function(b){b=b.backup;l.chosen("add",{text:b.text,value:b.value});bm.unmask(a);bm.notify($.i18n.prop("backup.success"),"success")},error:function(){bm.unmask(a);bm.notify($.i18n.prop("backup.fail"),"error")}})}function d(a){bm.ajax({type:"post",url:app.baseUrl+"setting/backupRestore",data:{restorePoint:a},dataType:"json",success:function(a){function b(a){bm.ajax({url:app.baseUrl+"app/isRestarted",data:{time:c},success:function(c){c.isRestarted?a(!0):b(a,1E4)},error:function(){setTimeout(function(){b(a)},
1E4)}})}var c=(new Date).toGMTString();$("body").loader();b(function(a){$("body").loader(!1);a?(bm.notify($.i18n.prop("restore.success"),"success"),bm.alert($.i18n.prop("you.have.to.login.again"),"alert",function(){location.href=app.baseUrl+"admin"})):bm.notify($.i18n.prop("restore.fail"),"error")})},error:function(){bm.unmask(g);bm.notify($.i18n.prop("restore.fail"),"error")}})}var g=a.panel,m="<div class='div-mask'><span class='vertical-aligner'></span><span class='loader'></span>"+$.i18n.prop("backup.contents.and.configuration")+
"<div>";$.i18n.prop("restore.contents.and.configuration");var l=g.find("select[name=restorePoint]"),n=g.find(".submit-button.restore");l.val()||n.prop("disabled",!0);l.change(function(){$(this).val()?n.removeAttr("disabled"):n.prop("disabled",!0)});g.find(".submit-button.backup").on("click",function(){li;b()});n.on("click",function(){d(l.val())})};a.afterEmailReload=function(a){b&&(a.panel.find(".accordion-panel").find("."+b).trigger("click"),b=null)};a.afterTableReload=function(a){var b=a.index.capitalize();
if(this["after"+b+"Reload"])this["after"+b+"Reload"](a)};a.initTask=function(a,b,f){a={token:a,name:b,detail_url:app.baseUrl+"taskCommon/progressView",detail_status_url:app.baseUrl+"taskCommon/progressStatus",detail_viewer:app.tabs.setting.import_status_viewer};TaskManager.createTask(a);app.tabs.setting.success_event_name=f;bm.taskPopup(app.baseUrl+"taskCommon/progressView",a,{width:800})};a.initRedirectImport=function(){var a=this;bm.editPopup(app.baseUrl+"redirect/uploadImportFile",$.i18n.prop("import.301.redirect"),
"",{},{success:function(b){a.initTask(b.token,b.name,"redirect-301-import-success");app.global_event.fire("301-redirect-import")}})};a.initClearDisposable=function(){var a=this;bm.confirm($.i18n.prop("confirm.clear.disposable"),function(){bm.ajax({url:app.baseUrl+"setting/initClearDisposable",success:function(b){a.initTask(b.token,b.name)}})},function(){})};a.initAdministrationSettings=function(a){function b(){bm.confirm($.i18n.prop("have.to.reload.changes.effective"),function(){window.location.href=
app.baseUrl+"admin"})}var d=this;a=a.panel.find("form");a.find(".clear-disposable-items").on("click",function(){d.initClearDisposable()});a.find(".refresh-license-button").click(function(){bm.ajax({controller:"license",action:"refresh",success:function(a){if(a.notifications){var c=$("#administrative-notification-wrapper");c.length||(c=$("<div id='administrative-notification-wrapper'></div>").appendTo(document.body));a.notifications.every(function(){var a=$("<div class='administrative-notification'></div>").appendTo(c);
a.addClass("notification-"+this.type);$("<div class='title'></div>").appendTo(a).text($.i18n.prop(this.type));$("<div class='message'></div>").appendTo(a).text(this.message)});DashboardManager.initializeAdministrativeNotification();b()}}})});var g=a.form("prop","ajax.success");a.form("prop","ajax.success",g.blend(function(){b()}))};app.tabs.setting.import_status_viewer={init:function(a){a=a.getDom();this.totalProgressBar=new ProgressBar(a.find(".progress"));this.totalProgressBar.render()},update:function(a,
b){var c=a.getDom();this.totalProgressBar.setPosition(b.totalProgress);c.find(".progress-count").text(b.totalProgress+"%");c.find(".record-complete").text(b.complete);c.find(".record-total").text(b.totalRecord);c.find(".success-count").text(b.successCount);c.find(".warning-count").text(b.warningCount);c.find(".error-count").text(b.errorCount);"aborted"==b.status&&(c.find(".import-aborted").show(),c.find(".progress .progress-bar .completed").addClass(b.status));"complete"==b.status&&(this.activeLogSummaryLink(c,
b.token,b.cacheFile),c.find(".content").append('<div class="button-line"><button type="button" class="button close-button">'+$.i18n.prop("close")+'</button> &nbsp; <a type="button" target="_blank" class="button download-button" href="'+app.baseUrl+"taskCommon/download?token="+b.token+"&cacheFile="+b.cacheFile+'">'+$.i18n.prop("download")+"</a></div>"),c.find(".close-button").click(function(){a.close()}),app.global_event.trigger(app.tabs.setting.success_event_name),app.tabs.setting.success_event_name=
"")},activeLogSummaryLink:function(a,b,f){var c=this;a.find(".success-count").addClass("link").click(function(){c.fetchLogSummary(a,b,f,"success")});a.find(".warning-count").addClass("link").click(function(){c.fetchLogSummary(a,b,f,"warning")});a.find(".error-count").addClass("link").click(function(){c.fetchLogSummary(a,b,f,"error")})},fetchLogSummary:function(a,b,f,g){bm.ajax({url:app.baseUrl+"taskCommon/"+g+"LogSummary",dataType:"html",data:{token:b,cacheFile:f},success:function(b){a.find(".log-summary").html(b).updateUi()}})}}})();
app.tabs.sitemap={sitemap:function(){app.tabs.sitemap.sitemap._super.constructor.apply(this,arguments);this.text=$.i18n.prop("sitemap");this.tip=$.i18n.prop("manage.sitemap");this.ui_class="sitemap";this.ui_body_class="simple-tab"}};var _vsm=app.tabs.sitemap.sitemap.inherit(app.Tab);app.ribbons.web_marketing.push(app.tabs.sitemap.sitemap.ribbon_data={text:$.i18n.prop("sitemap"),ui_class:"sitemap",processor:app.tabs.sitemap.sitemap});_vsm.init=function(){app.tabs.sitemap.sitemap._super.init.call(this)};
_vsm.onActionMenuClick=function(a){"createSitemap"==a?(a=this.body.find(".tool-text").attr("sitemap"),this.createSitemap(a)):app.Tab.changeView(this,"sitemap",a)};_vsm.ajax_url=app.baseUrl+"siteMap/loadAppView";_vsm.action_menu_entries=[{text:$.i18n.prop("generate.sitemap"),ui_class:"generate-sitemap",action:"createSitemap"},{text:$.i18n.prop("edit.sitemap"),ui_class:"edit-sitemap",action:"editSitemap"}];
_vsm.siteMapCreatePopUp=function(){var a=this;bm.editPopup(app.baseUrl+"siteMap/showCreatePopUp",$.i18n.prop("generate.sitemap"),"",{},{width:250,events:{content_loaded:function(a){}},success:function(b){a.reload(b.xml)}})};_vsm.createSitemap=function(a){var b=this;"yes"==a?bm.confirm($.i18n.prop("existing.sitemap.override"),function(){b.siteMapCreatePopUp()},function(){}):b.siteMapCreatePopUp()};_vsm.reload=function(a){this.body.find(".sitemap-area").val(a)};
bm.onReady(app.tabs,"scriptEditor",function(){app.tabs.sitemap.editSitemap=function(){this.file={path:"siteMap/loadXml",name:"sitemap.xml",mode:"xml",loadUrl:"siteMap/loadXml",saveUrl:"siteMap/saveXml",method:"post"};app.tabs.sitemap.editSitemap._super.constructor.apply(this,arguments)};var a=app.tabs.sitemap.editSitemap.inherit(app.tabs.scriptEditor);(function(){a.init=function(){this.body.find(".toolbar-item.save").parent(".tool-group").after('<div class="tool-group"><span class="toolbar-item  switch-menu collapsed" title="'+
$.i18n.prop("switch.view")+'"><i></i></span></div>');app.tabs.sitemap.editSitemap._super.init.call(this)}})();a.switch_menu_entries=[{text:$.i18n.prop("view.mode"),ui_class:"view-sitemap",action:"sitemap"}];a.switchHandler=function(a){app.Tab.changeView(this,"sitemap",a)}});app.tabs.trash=function(){this.text=$.i18n.prop("trash");this.tip=$.i18n.prop("manage.trash");this.ui_class="trash";this.ajax_url=app.baseUrl+"trash/loadAppView";app.tabs.trash._super.constructor.apply(this,arguments)};
app.ribbons.administration.push({text:$.i18n.prop("trash"),processor:app.tabs.trash,ui_class:"trash"});app.tabs.trash.inherit(app.SingleTableTab);_t=app.tabs.trash.prototype;_t.advanceSearchUrl=app.baseUrl+"trash/advanceFilter";_t.advanceSearchTitle=$.i18n.prop("trash");_t.sortable={list:{2:"name",3:"created"},sorted:"2",dir:"up"};
_t.beforeReloadRequest=function(a){app.tabs.trash._super.beforeReloadRequest.call(this,a);var b=this.body.find("select.selected-domain");this.advanceSearchFilter&&$.extend(a,{advanceSearch:!0});a.advancedSearchDomain?($.extend(a,{selectedDomain:a.advancedSearchDomain}),b.val("").chosen()):$.extend(a,{selectedDomain:b.val()})};
(function(){function a(){var a=this;b=a.body.find(".selected-domain").val();this.body.find(".selected-domain").change(function(){b=a.body.find(".selected-domain").val();a.body.find(".tool-group.search-form").trigger("submit")});this.on_global("send-trash",function(c,d){(b.equals(d,!1)||""==b)&&a.reload()});this.on_global("trash-restore",function(c,d){(b.equals(d,!1)||""==b)&&a.reload()});this.on_global("trash-delete",function(c,d){d&&!b.equals(d,!1)&&""!=b||a.reload()});var c=this.body.find(".action-header select.action-on-selection");
["restore","remove"].every(function(){app.isPermitted("trash."+this,{})||c.chosen("disable",this.toString(),!0)})}var b;_t.init=function(){app.tabs.trash._super.init.call(this);a.call(this)};app.global_event.on("after-ribbon-render",function(a,b){app.isPermitted("trash.view.list")?b.enable("trash"):b.disable("trash")})})();
_t.restore=function(a,b,d,c){var f=this;bm.ajax({url:app.baseUrl+"trash/restore",data:{id:a,name:b,type:d,hasParent:c},success:function(){app.global_event.trigger(d.toLowerCase()+"-restore",[a]);f.reload()},error:function(c){bm.confirm($.i18n.prop("confirm.restore.category.has.parent"),function(){f.restore(a,b,d,!0)},function(){})}})};
_t.deleteEntity=function(a,b,d){var c=this;bm.confirm($.i18n.prop("confirm.delete.from.trash",[bm.htmlEncode(b),d]),function(){bm.ajax({url:app.baseUrl+"trash/delete",data:{id:a,name:b,type:d},success:function(){c.reload()}})},function(){})};_t.onActionClick=function(a,b){switch(a){case "restore":this.restore(b.id,b.name,b.type);break;case "delete":this.deleteEntity(b.id,b.name,b.type)}};
_t.menu_entries=[{text:$.i18n.prop("restore"),ui_class:"restore",action:"restore"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"delete"}];_t.onMenuOpen=function(){app.checkPermission(this.tabulator.menu,[{key:"trash.restore",class:"restore"},{key:"trash.remove",class:"delete"}])};
_t.restoreSelectedItems=function(a){var b=this;bm.ajax({url:app.baseUrl+"trash/restoreSelectedItems",data:{ids:a.collect("id"),types:a.collect("type")},success:function(){var d={};$.each(a,function(){(d[this.type.toLowerCase()]||(d[this.type.toLowerCase()]=[])).push(this.id)});$.each(d,function(a){app.global_event.trigger(a+"-restore",[this])});b.reload();b.body.find(".action-header").hide()}})};
_t.deleteSelectedItems=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.trash"),function(){bm.ajax({url:app.baseUrl+"trash/deleteSelectedItems",data:{ids:a.collect("id"),types:a.collect("type")},success:function(){var d={};$.each(a,function(){(d[this.type.toLowerCase()]||(d[this.type.toLowerCase()]=[])).push(this.id)});$.each(d,function(a){app.global_event.trigger(a+"-delete",[this])});b.reload();b.body.find(".action-header").hide()}})},function(){})};
_t.onSelectedActionClick=function(a,b){switch(a){case "restore":this.restoreSelectedItems(b);break;case "delete":this.deleteSelectedItems(b)}};app.tabs.user=function(a){this.text=$.i18n.prop("operators");this.tip=$.i18n.prop("manage.operators");this.ui_class="operator";this.ajax_url=app.baseUrl+"user/loadAppView";app.tabs.user._super.constructor.apply(this,arguments)};app.ribbons.administration.push({text:$.i18n.prop("operator"),processor:app.tabs.user,ui_class:"operator"});app.tabs.user.inherit(app.SingleTableTab);
_u=app.tabs.user.prototype;_u.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("assign.roles"),ui_class:"manage-role",license:CONSTANTS.LICENSES.ACL},{text:$.i18n.prop("manage.permissions"),ui_class:"manage-permissions",action:"manage",license:CONSTANTS.LICENSES.ACL},{text:$.i18n.prop("remove"),ui_class:"remove"}];_u.advanceSearchUrl=app.baseUrl+"user/advanceFilter";_u.advanceSearchTitle=$.i18n.prop("operator");
(function(){function a(){var a=this;this.on_global("operator-restore",function(){a.reload()});this.body.find(".toolbar .create").on("click",function(){a.createUser()})}_u.init=function(){app.tabs.user._super.init.call(this);a.call(this)};app.global_event.on("after-ribbon-render",function(a,d){app.isPermitted("operator.view.list",{})?d.enable("operator"):d.disable("operator")})})();app.isProvisionActive||(_u.sortable={list:{1:"fullName",2:"email",3:"created",4:"updated"},sorted:"1",dir:"up"});
_u.onActionClick=function(a,b){switch(a){case "edit":this.editUser(b.id,b.name);break;case "manage":this.managePermissions(b.id,b.name);break;case "manage-role":this.manageRoles(b.id,b.name);break;case "remove":this.deleteUser(b.id,b.name)}};
_u.onSelectedActionClick=function(a,b){switch(a){case "delete":this.deleteSelectedUsers(b.collect("id"));break;case "status":this.changeStatus(b);break;case "manage_permission":this.managePermissions(b.collect("id"),$.i18n.prop("bulk.edit"));break;case "role_assign":this.bulkManageRoles(b,$.i18n.prop("bulk.edit"));break;case "api_access":this.apiAccess(b)}};
_u.onMenuOpen=function(a){var b=this.tabulator.menu;app.checkPermission(b,[{key:"operator.remove",class:"remove"},{key:"operator.assign.roles",class:"manage-role"},{key:"operator.edit",class:"edit"},{key:"operator.edit.permission",class:"manage-permissions"}]);var d=this.body.find("#session-owner-id").val();a=a.attr("data-id");d==a?b.find(".menu-item.delete").addClass("disabled"):b.find(".menu-item.delete").removeClass("disabled")};
_u.onActionMenuOpen=function(a){app.checkPermission(a,[{key:"operator.create",class:"create-user"}])};_u.viewUser=function(a){bm.viewPopup(app.baseUrl+"user/viewInfo",{id:a})};_u.managePermissions=function(a,b){bm.permissionPopup($.i18n.prop("manage.permissions"),b,{id:a,for:"operator"})};
_u.editUser=function(a,b){var d=this;this.renderCreatePanel(app.baseUrl+"user/editInfo",$.i18n.prop("edit.operator"),b,{id:a},{content_loaded:function(a){var b=$(this);b.find(".change-password .link").click(function(){var c=b.find(".change-password-panel"),d=b.find(".change-password");d.after(c.show());d.remove();c.find(".new-password").change(function(){c.find(".match-password").trigger("validate")});b.find("input[name='isChangePassword']").val("true");a.trigger("content-change",[c])})},success:function(){d.reload();
app.global_event.trigger("operator-update",[a])}})};_u.deleteUser=function(a,b){var d=this;bm.confirm($.i18n.prop("confirm.delete.operator",[b]),function(){bm.ajax({url:app.baseUrl+"user/delete",data:{id:a},success:function(){app.global_event.trigger("send-trash",["operator",a]);d.reload()}})},function(){})};
_u.deleteSelectedUsers=function(a,b){var d=this;bm.confirm($.i18n.prop("confirm.delete.operators"),function(){bm.ajax({url:app.baseUrl+"user/deleteSelected",data:{ids:a,emails:b},success:function(){d.reload();app.global_event.trigger("send-trash",["operator",a]);d.body.find(".action-header").hide()}})},function(){})};_u.manageRoles=function(a,b){bm.editPopup(app.baseUrl+"user/manageRoles",$.i18n.prop("manage.roles"),b,{id:a})};
_u.bulkManageRoles=function(a,b){bm.editPopup(app.baseUrl+"user/bulkManageRoles",$.i18n.prop("manage.roles"),b,{},{width:600,events:{content_loaded:function(){var b=$(this),c=a.collect("id");$.each(c,function(a,c){b.find(".edit-popup-form").append('<input type="hidden" name="id" value="'+c+'">')})}},success:function(){_self.reload()}})};_u.createUser=function(){var a=this;this.renderCreatePanel(app.baseUrl+"user/create",$.i18n.prop("create.operator"),"",{},{success:function(){a.reload()}})};
_u.changeStatus=function(a){var b=this;bm.editPopup(app.baseUrl+"user/loadStatusOption",$.i18n.prop("status"),null,{},{width:600,events:{content_loaded:function(){var b=$(this),c=a.collect("id");$.each(c,function(a,c){b.find(".edit-popup-form").append('<input type="hidden" name="id" value="'+c+'">')})}},success:function(){b.reload()}})};
_u.apiAccess=function(a){var b=this;bm.editPopup(app.baseUrl+"user/loadApiOption",$.i18n.prop("api.access"),null,{},{width:600,events:{content_loaded:function(){var b=$(this),c=a.collect("id");$.each(c,function(a,c){b.find(".edit-popup-form").append('<input type="hidden" name="id" value="'+c+'">')})}},success:function(){b.reload()}})};
app.tabs.zone=function(a){this.text=$.i18n.prop("zone");this.tip=$.i18n.prop("manage.zone");this.ui_class="zone";this.ajax_url=app.baseUrl+"zone/loadAppView";app.tabs.zone._super.constructor.apply(this,arguments)};app.ribbons.administration.push({text:$.i18n.prop("zone"),processor:app.tabs.zone,ui_class:"zone"});app.tabs.zone.inherit(app.SingleTableTab);var _z=app.tabs.zone.prototype;_z.advanceSearchUrl=app.baseUrl+"zone/advanceFilter";_z.advanceSearchTitle=$.i18n.prop("zone");
_z.advance_search_popup_width=450;_z.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("remove"),ui_class:"remove"}];_z.sortable={list:{1:"name"},sorted:"1",dir:"up"};(function(){function a(){var a=this;this.body.find(".toolbar .create").on("click",function(){a.createZone()})}_z.init=function(){app.tabs.zone._super.init.call(this);a.call(this)};app.global_event.on("after-ribbon-render",function(a,d){app.isPermitted("zone.view.list")?d.enable("zone"):d.disable("zone")})})();
_z.onActionClick=function(a,b){switch(a){case "edit":this.editZone(b.id,b.name);break;case "remove":app.tabs.zone.deleteZone(b.id,b.name,this)}};_z.onSelectedActionClick=function(a,b){switch(a){case "remove":this.deleteSelectedZone(b.collect("id"))}};_z.onMenuOpen=function(a,b){"true"==a.attr("entity-system-generated")?b.find(".menu-item.remove").addClass("disabled"):b.find(".menu-item.remove").removeClass("disabled")};
_z.createZone=function(){var a=this;this.renderCreatePanel(app.baseUrl+"zone/create",$.i18n.prop("create.zone"),"",{},{content_loaded:function(a){bm.countryChangeSelection(a.find("select[name=zone\\.country\\.id]"),!0,{isMultiple:"true",stateName:"zone.state.id"})},success:function(){a.reload()}})};app.tabs.zone.deleteZone=function(a,b,d,c){bm.remove("zone","Zone",$.i18n.prop("confirm.delete.zone",[b]),app.baseUrl+"zone/delete",a,{is_final:!0,success:function(){d?d.reload():c()}})};
_z.deleteSelectedZone=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.zone"),function(){bm.ajax({url:app.baseUrl+"zone/deleteSelected",data:{ids:a},success:function(){b.reload()}})},function(){})};_z.viewTaxShippingRuleAndPaymentGateway=function(a){bm.viewPopup(app.baseUrl+"zone/viewTaxShippingRuleAndPaymentGateway",{id:a},{})};
_z.editZone=function(a,b){var d=this;this.renderCreatePanel(app.baseUrl+"zone/edit",$.i18n.prop("edit.zone"),b,{id:a},{content_loaded:function(a){bm.countryChangeSelection(a.find("select[name=zone\\.country\\.id]"),!0,{isMultiple:"true",stateName:"zone.state.id"})},success:function(){d.reload()}})};_z.viewZone=function(a,b){bm.viewPopup(app.baseUrl+"zone/viewZone",{id:a},{width:450,clazz:"view-popup zone-view-popup"})};
app.tabs.album=function(a){this.text=$.i18n.prop("albums");this.tip=$.i18n.prop("manage.albums");this.ui_class="album";app.tabs.album._super.constructor.apply(this,arguments)};app.tabs.album.inherit(app.ExplorerPanelTab);var _a=app.tabs.album.prototype;
_a.initLeftPanel=function(a){var b=this;a=this.body.find(".left-panel");a.scrollbar({vertical:{offset:3}});bm.menu([{text:$.i18n.prop("upload.images"),ui_class:"upload-images upload",action:"uploadImages"},{text:$.i18n.prop("edit"),ui_class:"edit",action:"editAlbum"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"deleteAlbum"}],this.body.find(".left-panel .float-menu-navigator"),null,{open:function(a){a.parent().addClass("float-menu-opened")},hide:function(a){a.parent().removeClass("float-menu-opened")},
click:function(a,c){var d=[];c=c.closest(".album-thumb");d.id=c.attr("album-id");d.name=c.attr("album-name");b.onActionClick(null,a,d)}},"click",["center bottom","right+22 top+7"]);a.find(".album-thumb.selected").length||a.find(".album-thumb").first().addClass("selected");this.body.find(".album-thumb").click(function(){var a=$(this);a.is(".floating-menu")||(b.body.find(".album-thumb.selected").removeClass("selected"),b.selectedAlbum=a.attr("album-id"),a.closest(".album-thumb").addClass("selected"),
b.reloadRightPanel())});b.selectedAlbum=a.find(".album-thumb.selected").attr("album-id")};_a.onSwitchMenuClick=function(a){app.Tab.changeView(this,"album",a,app.tabs.album.ribbon_data.supers[a])};_a.menu_entries={albumImage:[{text:$.i18n.prop("open.with.editor"),ui_class:"edit",action:"editImage"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"deleteImage"},{text:$.i18n.prop("properties"),ui_class:"properties",action:"imageProperties"},{text:$.i18n.prop("rename"),ui_class:"rename",action:"renameImage"}]};
(function(){function a(){var a=this;this.on_global("album-restore",function(){a.reload()});this.on("close",function(){app.tabs.album.tab=null});this.body.find(".toolbar .create").on("click",function(){a.createAlbum()})}_a.init=function(){app.tabs.album._super.init.call(this);app.tabs.album.tab=this;a.call(this)}})();_a.action_menu_entries=[{text:$.i18n.prop("import.pdf"),ui_class:"import import-pdf",action:"import-pdf"}];
_a.switch_menu_entries=[{text:$.i18n.prop("list.view"),ui_class:"view-switch list",action:"list"}];_a.importPdf=function(){var a=this;bm.editPopup(app.baseUrl+"album/importPdf",$.i18n.prop("import.pdf"),"",{},{success:function(){a.reload()}})};_a.createAlbum=function(){this.renderCreatePanel(app.baseUrl+"album/create",$.i18n.prop("create.album"),null,{},{success:function(a){var b=a.id;a=a.name;app.tabs.album.tab&&app.tabs.album.tab.reload();app.tabs.album.uploadImages(b,a)}})};
_a.onActionMenuClick=function(a){switch(a){case "import-pdf":this.importPdf()}};
_a.onActionClick=function(a,b,d){switch(b){case "uploadImages":app.tabs.album.uploadImages(d.id,d.name);break;case "deleteAlbum":this.deleteAlbum(d.id,d.name);break;case "editAlbum":this.editAlbum(d.id,d.name);break;case "viewImage":this.viewImage(d.id,d.name);break;case "editImage":this.editImage(d.id,d.url);break;case "deleteImage":this.deleteImage(d.id,d.name);break;case "imageProperties":this.imageProperties(d.id,d.name);break;case "renameImage":this.renameImage(d.id,d.name)}};
app.tabs.album.uploadImages=function(a,b){a={id:a};var d=$.i18n.prop("upload.images");bm.editPopup(app.baseUrl+"album/uploadImages",d,b,a,{width:650,beforeSubmit:function(a){if(0==a.find("#album-image-previewer").children().length)return!1},success:function(){$(".edit-popup-mask.popup-mask").css("visibility","hidden");app.tabs.album.tab&&app.tabs.album.tab.reload()}})};_a.renameImage=function(a,b){var d=this,c=$.i18n.prop("rename");bm.editPopup(app.baseUrl+"album/renameImage",c,b,{id:a,name:b},{success:function(){d.reload()}})};
_a.deleteAlbum=function(a,b){var d=this;bm.remove("album",$.i18n.prop("album"),$.i18n.prop("confirm.delete.album",[b]),app.baseUrl+"album/delete",a,{success:function(){app.global_event.trigger("send-trash",["album",a]);d.reload();d.body.find("[name='selectedAlbum']").val().equals(a)&&d.reload()}})};_a.editAlbum=function(a,b){a={id:a};var d=$.i18n.prop("edit.album"),c=this;c.renderCreatePanel(app.baseUrl+"album/editAlbum",d,b,a,{success:function(){c.reload()}})};
_a.editImage=function(a,b){var d=this;Aviary.launchEditor(b,app.baseUrl+"album/updateImageContent?imageId="+a,function(){d.body.find("#album-image-"+a).clearCache();$('<img id="album-image-'+a+'" src="'+d.body.find("[name='originalImageSrc-"+a+"']").val()+'">').clearCache()})};_a.deleteImage=function(a,b,d){var c=this;bm.confirm($.i18n.prop("confirm.delete.image",[b]),function(){bm.ajax({url:app.baseUrl+"album/deleteImage",data:{id:a},success:function(){c.reload();"function"==typeof d&&d()}})},function(){})};
_a.imageProperties=function(a,b){var d=this,c=$.i18n.prop("properties");d.renderCreatePanel(app.baseUrl+"album/imageProperties",c,b,{id:a},{scrollable:!1,content_loaded:function(){var b=this;""==b.find("select.link-type").val()&&(b.find("#custom-link").hide(200),b.find("#link-target").hide(200));var c=b.find(".ref-selector-row");""==b.find("select.link-type").val()&&(c.hide(200),b.find("#link-target").hide(200));if(c.is(".product-selector"))c.find("select.category-selector").on("change",function(){d.bindProductSelector(c,
this.value)});b.find("select.link-type").change(function(){var a=$(this).closest(".form-row"),c=this.value;""==c?(b.find(".ref-selector-row").hide(200),b.find("#link-target").hide(200)):(bm.ajax({url:app.baseUrl+"album/loadReferenceSelectorBasedOnType",data:{linkType:c},dataType:"html",success:function(b){b=$(b);var c=a.next(".ref-selector-row");c.length?c.replaceWith(b):a.after(b);b.find("select.category-selector").on("change",function(){d.bindProductSelector(b,this.value)});b.updateUi()}}),b.find("#link-target").show(300))});
b.find("#bmui-tab-basic").scrollbar({vertical:{offset:-2}});app.global_event.trigger("album-image-property-loaded",[d,b,a])},success:function(){d.reload()},beforeSubmit:function(a){var b=!0;$(a).find(".ref-selector-row").valid()||(b=!1);app.global_event.trigger("before-album-image-property-submit",[d,b]);return b}})};
_a.bindProductSelector=function(a,b){bm.ajax({url:app.baseUrl+"productAdmin/loadProductSelector",data:{category:b},dataType:"html",success:function(b){a.find(".product-row").replaceWith(b);a.find(".product-row").updateUi()}})};app.tabs.album.explorer=function(){app.tabs.album.explorer._super.constructor.apply(this,arguments)};app.ribbons.web_content.push(app.tabs.album.ribbon_data={text:$.i18n.prop("album"),processor:app.tabs.album.explorer,ui_class:"album",supers:{explorer:"ExplorerPanelTab",list:"SingleTableTab"}});
_e=app.tabs.album.explorer.inherit(app.tabs.album);_e.resize_disabled=!0;_e.tree_disabled=!0;_e.left=350;_e.ajax_url=app.baseUrl+"album/loadAppView";_e.explorer_url=app.baseUrl+"album/explorerView";_e.advanceSearchUrl=app.baseUrl+"album/advanceFilter";_e.init=function(){var a=this;app.tabs.album.explorer._super.init.call(this);this.typeSelector=this.body.find("[name=albumType]").on("change",function(){a.reload()});this.initLeftPanel();this.reloadRightPanel()};
_e.beforeReloadRequest=function(a){app.tabs.album._super.beforeReloadRequest.call(this,a);a.id=this.selectedAlbum};
_e.reload=function(){var a=this,b=a.body.find(".left-panel .body");b.loader();bm.ajax({url:app.baseUrl+"album/leftPanel",data:{selected:a.selectedAlbum,isDisposable:"disposable"==a.typeSelector.val()},dataType:"html",response:function(){b.loader(!1)},success:function(d){d=$(d);var c=a.body.find(".item-group .count"),f=d.find(".album-thumb").length;c.text(f);(c=b.find(".selected").attr("album-id"))&&d.find(".album-thumb[album-id="+c+"]").addClass("selected");b.find(".album-thumb").remove();b.append(d.find(".album-thumb"));
b.updateUi();a.initLeftPanel(c);a.explorer.reload(!0)}})};_e.reloadRightPanel=function(){this.explorer.reload(!0)};app.tabs.album.list=function(){app.tabs.album.list._super.constructor.apply(this,arguments)};_l=app.tabs.album.list.inherit(app.tabs.album);_l.ajax_url=app.baseUrl+"album/listView";_l.switch_menu_entries=[{text:$.i18n.prop("explorer.view"),ui_class:"view-switch explorer",action:"explorer"}];_l.sortable={list:{4:"idx"},sorted:"4",dir:"up"};_l.menu_entries=_a.menu_entries.albumImage;
_l.init=function(){var a=this;app.tabs.album.list._super.init.call(this);this.albumSelector=this.body.find(".album-selector").on("change",function(){a.selectedAlbum=a.albumSelector.val();a.reload()});this.selectedAlbum=this.albumSelector.val();this.body.find(".toolbar .upload").on("click",function(){var b=a.albumSelector.val();b?app.tabs.album.uploadImages(b,a.albumSelector.find(":selected").text()):bm.notify($.i18n.prop("no.album.selected"),"alert")})};
_l.beforeReloadRequest=function(a){app.tabs.album.list._super.beforeReloadRequest.call(this,a);a.id=this.albumSelector.val()};_l.onActionClick=function(a,b){app.tabs.album.list._super.onActionClick.apply(this,["albumImage",a,b])};_l.afterCellEdit=function(a,b){var d=this;bm.ajax({url:app.baseUrl+"album/changeImageOrder",data:{id:a.attr("entity-id"),value:b},complete:function(){d.reload()}})};_l.onSelectedActionClick=function(a,b){switch(a){case "remove":this.deleteSelectedBrands(b.collect("id"))}};
_l.deleteSelectedBrands=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.images"),function(){bm.ajax({url:app.baseUrl+"album/deleteSelectedImage",data:{ids:a},success:function(){b.reload()}})},function(){})};VALIDATION_RULES.validateName={check:function(a){var b=/^\./,d=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;return/^[^\\/:\*\?"<>\|]+$/.test(a)&&!b.test(a)&&!d.test(a)&&0>a.indexOf("%")?!0:{msg_template:"Invalid file name!"}}};
app.tabs.assetLibrary=function(){this.constructor_args=arguments;this.text=$.i18n.prop("asset.library");this.tip=$.i18n.prop("manage.asset.library");this.ui_class="asset-library";this.ui_body_class="simple-tab";app.tabs.assetLibrary._super.constructor.apply(this,arguments)};app.tabs.assetLibrary.inherit(app.ExplorerPanelTab);_a=app.tabs.assetLibrary.prototype;_a.templatePath=app.fullURL+"template";_a.ajax_url=app.baseUrl+"assetLibrary/loadExplorerView";_a.explorer_url=app.baseUrl+"assetLibrary/explorerPanel";
_a.parent_key="path";app.ribbons.web_content.push(app.tabs.assetLibrary.ribbon_data={text:$.i18n.prop("asset.library"),processor:app.tabs.assetLibrary,ui_class:"asset-library"});
(function(){function a(){var a=this;a.body.find("select.select-repository").change(function(){a.root_node_name=$.i18n.prop("pub"==this.value?"public":"template");a.reload()});a.body.find(".header .directory-info").on("click",function(){var b=$(this);b.find(".address-edit").length||a.makeDirInfoEditable(b)});a.body.find(".right-panel .body").bind("dragover",function(a){a=a.target;$(a.parentNode).hasClass("folder")?$(a.parentNode).addClass("dragging-over"):$(this).addClass("dragging-over");return!1});
a.body.find(".right-panel .body").bind("dragleave",function(a){a=a.target;$(a.parentNode).hasClass("folder")?$(a.parentNode).removeClass("dragging-over"):$(this).removeClass("dragging-over")});a.body.find(".status-container .tool-icon.cancel-all").click(function(){a.body.find("tr.status-row").each(function(){var b=$(this);b.find(".diplomatic").length&&(a.cancelIndex.push(parseInt(b.find("input[name=index]").val())),b.find(".status").attr("class","status negative"))})});a.body.find(".status-container .tool-icon.clear-list").click(function(){a.body.find("tr.status-row").each(function(){var a=
$(this);a.find(".positive").length&&a.remove()})});a.body.find(".right-panel .body").bind("drop",function(b,c){b.preventDefault();if(b.originalEvent.dataTransfer){c=b.target;var d=a.currentPath;$(c.parentNode).hasClass("folder")&&(d=a.currentPath+"/"+$(c.parentNode).attr("content-name"));a.uploadFiles(b.originalEvent.dataTransfer.files,d);return!1}})}_a.init=function(){var b=this;app.tabs.assetLibrary._super.init.call(this);a.call(this);this.on_global("active-template-change",function(a,c){"template"==
b.root_node_name&&b.reload()});b.body.find(".upload").on("click",function(){b.showUploadPopup()});this.initializeFileTransfer()}})();
_a.showUploadPopup=function(a){var b=this;a="<form class='edit-popup-form asset-upload-popup' enctype='multipart/form-data'><div class='form-row mandatory'><label>"+$.i18n.prop("select.files")+"</label><input type='file' name='files' multiple='true' validation='drop-file-required' queue='asset-lib-file-upload-queue'><div id='asset-lib-file-upload-queue'></div></div></div><div class='form-row button-line'><button type='submit' class='submit-button'>"+$.i18n.prop("upload")+"</button><button type='button' class='cancel-button'>"+
$.i18n.prop("cancel")+"</button></form>";b.renderCreatePanel(void 0,$.i18n.prop("upload.file"),"",{},{content:a,toolbar_btn_text:$.i18n.prop("upload"),beforeSubmit:function(a,c,f){a=a.data("form-extra-data").collect("value");f.close();b.uploadFiles(a);return!1}})};
_a.uploadFiles=function(a,b){function d(){if(m<g){var p=function(){if(209715200<t.size)f.progressUpload(m-1,null,!1,$.i18n.prop("size.limit.exceeded",["200MB"])),d();else if(n){var a=new FileReader;a.onload=function(a){c(a,t)};a.readAsDataURL(t)}else f.progressUpload(m-1,null,!1),d()},t=a[m++];if(e.length&&e.contains(m-1))d();else if(l)p();else{var w=$("<div class='message'>"+$.i18n.prop("the.file.already.exists.want.overwrite",[t.name])+"</div>");bm.ajax({url:app.baseUrl+"remoteRepository/isFileExists",
data:{fileName:t.name,filePath:b},success:function(a){a.isExists?bm.confirm(w,[{clazz:"yes-for-all",text:"yes.for.all",handler:function(){n=l=!0;p()}},{clazz:"yes",text:"yes",handler:function(){n=!0;p()}},{clazz:"no-for-all",text:"no.for.all",handler:function(){l=!0;n=!1;p()}},{clazz:"no",text:"no",handler:function(){n=!1;p()}}]):p()}})}}else q.loader(!1),setTimeout(function(){f.reload()},500)}function c(a,c){a=a.target.result;var e=a.indexOf("base64")+7;a=a.slice(e,a.length);bm.ajax({url:app.baseUrl+
(b+"/"+c.name+"?fileSize="+c.size),type:"POST",method:"put",xhr:function(){var a=$.ajaxSettings.xhr();a.upload&&a.upload.addEventListener("progress",function(b){b.lengthComputable&&(b=Math.round(b.loaded/b.total*100),f.cancelIndex.length&&f.cancelIndex.contains(m-1)?a.abort():f.progressUpload(m-1,b))},!1);a.onabort=function(a){d()};return a},beforeSend:function(a){f.beforeUpload(m-1);a.setRequestHeader("base64",!0)},success:function(){f.progressUpload(m-1,null,!0);d()},error:function(){},data:a,cache:!1,
timeout:72E5,contentType:!1,processData:!1})}var f=this,g=a.length,m=0,l=!1,n=!0,q=f.body.find(".right-panel");b=b?b:f.currentPath;f.populateStatus(a,b);var e=f.cancelIndex;d()};_a.beforeUpload=function(a){this.pbar=new ProgressBar(this.statusContainer.find(".file"+a+" .td-progress-bar"),!0);this.pbar.render()};
_a.populateStatus=function(a,b){var d=this;d.cancelIndex=[];d.statusContainer||(d.statusContainer=d.body.find(".status-container"));d.statusContainer.find(".status-row").remove();$.each(a,function(a,f){var c=f.size,m="MB";1024>c?m="Byte":1048576>c?(c/=1024,m="KB"):c/=1048576;a=$("<tr class='status-row "+(0==a%2?"even":"odd")+" file"+a+"'><td><input type='hidden' name='index' value='"+a+"'>"+f.name+"</td><td>"+b+"</td><td class='td-progress-bar'></td><td class='status-column'><span class='status diplomatic' title="+
$.i18n.prop("pending")+"></span></td><td class='size'>"+c.toFixed(2)+" "+m+"</td><td class='actions-column'><span class='tool-icon remove' title="+$.i18n.prop("stop")+"></span></td></tr>");d.statusContainer.append(a);a.updateUi()});d.statusContainer.find(".status-row .tool-icon.remove").click(function(){var a=$(this),b=a.parents("tr.status-row"),g=b.find(".status-column .status");g.is(".diplomatic")?(d.cancelIndex.push(parseInt(b.find("input[name=index]").val())),b.find(".status").attr("class","status negative").tooltipster("content",
$.i18n.prop("status.failed")),a.tooltipster("content",$.i18n.prop("remove"))):g.is(".negative")&&b.remove()})};_a.cancelIndex=[];_a.progressUpload=function(a,b,d,c){a=this.statusContainer.find(".file"+a).find(".status");d?(this.pbar.complete(),a.attr("class","status positive").tooltipster("content",c?c:$.i18n.prop("status.successful"))):0==d?a.attr("class","status negative").tooltipster("content",c?c:$.i18n.prop("status.failed")):this.pbar.advance(b)};
_a.menu_entries={file:[{text:$.i18n.prop("rename"),ui_class:"rename",action:"rename"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"delete"},{text:$.i18n.prop("open.in.css.editor"),ui_class:"edit-css",action:"edit-css"},{text:$.i18n.prop("open.in.js.editor"),ui_class:"edit-js open-in-editor",action:"edit-js"},{text:$.i18n.prop("open.in.xml.editor"),ui_class:"edit-xml open-in-editor",action:"edit-xml"},{text:$.i18n.prop("revisions"),ui_class:"revision",action:"revision"},{text:$.i18n.prop("move"),
ui_class:"move",action:"move"},{text:$.i18n.prop("download"),ui_class:"download",action:"download"},{text:$.i18n.prop("extract"),ui_class:"extract",action:"extract"},{text:$.i18n.prop("get.link"),ui_class:"asset-library-get-link",action:"asset-library-get-link"}],folder:[{text:$.i18n.prop("new.directory"),ui_class:"new-directory",action:"new-directory"},{text:$.i18n.prop("rename"),ui_class:"rename",action:"rename"},{text:$.i18n.prop("move"),ui_class:"move",action:"move"},{text:$.i18n.prop("download"),
ui_class:"download",action:"download"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"delete"}],"grand-root":[{text:$.i18n.prop("new.directory"),ui_class:"new-directory",action:"new-directory"},{text:$.i18n.prop("refresh"),ui_class:"refresh",action:"refresh"}]};_a.convertToActualPath=function(a){var b=a.indexOf("/");return""+a.substring(0,b+1)+app.tenant+a.substring(b)};
_a.onMenuOpen=function(a,b){var d=this.explorer.menu[a],c=[];"folder"==a?(c=[{key:"asset_library.create.directory",class:"new-directory"},{key:"asset_library.rename.file.directory",class:"rename"},{key:"asset_library.remove.directory",class:"delete"}],d.hide("download"),d.hide("asset-library-get-link")):"file"==a&&(c=[{key:"asset_library.rename.file.directory",class:"rename"},{key:"asset_library.remove.file",class:"delete"}],"css"==b.clazz?d.show("edit-css"):d.hide("edit-css"),"js"==b.clazz?d.show("edit-js"):
d.hide("edit-js"),"xml"==b.clazz?d.show("edit-xml"):d.hide("edit-xml"),"zip"==b.clazz?d.show("extract"):d.hide("extract"),d.show("download"),d.show("asset-library-get-link"));app.checkPermission(d,c)};
_a.onActionClick=function(a,b,d,c){var f=this;switch(b){case "new-directory":f.createNewDirectory(d);break;case "delete":a=$.i18n.prop("confirm.remove",[a,d.name]);bm.confirm(a,function(){f.deleteDirectory(d)},function(){});break;case "rename":f.renameFile(d);break;case "edit-css":f.openCssEditor(d);break;case "edit-js":f.openJsEditor(d);break;case "edit-xml":f.openXmlEditor(d);break;case "refresh":f.reloadRemoteTree();break;case "download":f.download(c);break;case "revision":f.showRevision(d);break;
case "asset-library-get-link":bm.copy(""+app.siteBaseUrl+f.convertToActualPath(d.path))?bm.notify($.i18n.prop("get.link.success"),"success"):bm.notify($.i18n.prop("get.link.copy.error"),"error");break;case "move":f.move(c,d);break;case "extract":f.extract(d)}};app.tabs.assetLibrary.hasChild=function(a){a=document.getElementsByName("localfileaccess")[0].getFileList(a);a=eval("("+a+")");return a.folders.length||a.files.length?!0:!1};
app.tabs.assetLibrary.convertFiles=function(a,b){var d=[];a.folders.every(function(){var a={};a.path=this.path?this.path:this.name;a.name=this.name;a.parent=b;a.hasChild=app.tabs.assetLibrary.hasChild(a.path);a.type="folder";a.isLocal=!0;this.rootFolder&&(a.rootFolder=!0);d.push(a)});a.files.every(function(){var a={};a.path=this.path;a.name=this.name;a.parent=b;a.hasChild=!1;a.type="file";a.size=this.size;a.clazz=this.name.substring(this.name.lastIndexOf(".")+1);a.isLocal=!0;d.push(a)});return d};
_a.nodeFinder=function(a,b,d,c,f){var g=this,m=g.childNodeFinder(a,d);c++;1==c&&(d=d.split("\\")[0]);m&&(m.activate(!1),c<b.length&&(m.data.hasChild&&!m.childList?($(m).bind("afterPopulate.click",m,function(){$(m).unbind("afterPopulate.click",arguments.callee);g.nodeFinder(m,b,d+f+b[c],c,f)}),m.data.isLazy=!0,m.reloadChildren()):g.nodeFinder(m,b,d+f+b[c],c,f)))};_a.childNodeFinder=function(a,b){var d=null;$.each(a.childList,function(){if(b==this.data.path)return d=this,!1});return d};
_a.moveNodesInSameTree=function(a,b,d){var c=this,f=b+"/"+d;WebDAVClient.doPropFind(f,this,{onPopulate:function(){bm.notify($.i18n.prop("already.exists",[f]),"error")},onError:function(){WebDAVClient.doMove(a.path,f,{success:function(){c.reloadRemoteTree(f)},error:function(){}},a.parent)}})};
_a.openCssEditor=function(a){var b=bm.hash(a.path+"#"+a.name),d=app.Tab.getTab("tab-edit-css-"+b);d||(d=new app.tabs.cssEditor.advanceEditor({file:{path:a.path,name:a.name},id:"tab-edit-css-"+b}),d.render());d.setActive()};_a.openJsEditor=function(a){var b=bm.hash(a.path+"#"+a.name),d=app.Tab.getTab("tab-edit-script-"+b);d||(d=new app.tabs.scriptEditor({file:{path:a.path,name:a.name,mode:"javascript"},id:"tab-edit-script-"+b}),d.render());d.setActive()};
_a.openXmlEditor=function(a){var b=bm.hash(a.path+"#"+a.name),d=app.Tab.getTab("tab-edit-xml-"+b);d||(d=new app.tabs.xmlEditor.advanceEditor({file:{path:a.path,name:a.name},id:"tab-edit-xml-"+b}),d.render());d.setActive()};
_a.showRevision=function(a){bm.editPopup(app.baseUrl+"remoteRepository/showRevision",$.i18n.prop("revisions"),a.name,{path:a.path,name:a.name},{width:850,events:{content_loaded:function(b){var d=this.find("input[name='originalFilePath']").val();this.find(".tool-icon.replace").click(function(){var a=$(this).data("path");bm.ajax({url:app.baseUrl+"remoteRepository/replaceWithRevision",data:{filePath:a,originalFilePath:d},success:function(){b.close()}})});this.find(".tool-icon.clear-all").click(function(){bm.ajax({url:app.baseUrl+
"remoteRepository/clearAllRevisions",data:{filePath:d,name:a.name},success:function(){b.close()}})})}}})};
_a.createNewDirectory=function(a){var b=this,d=a.path;a.path||(d=b.body.find("select.select-repository").val());a="<form class='edit-popup-form create-new-directory'><div class='form-row mandatory'><label>"+$.i18n.prop("directory.name")+"</label><input type='text' class='directory-name' maxlength='255' validation='required maxlength[255] url_folder'></div></div><div class='button-line'><button type='submit' class='submit-button'>"+$.i18n.prop("create")+"</button>&nbsp &nbsp<button type='button' class='cancel-button'>"+
$.i18n.prop("cancel")+"</button></form>";bm.editPopup("",$.i18n.prop("create.new.directory"),"",{},{content:a,beforeSubmit:function(a,f,g){var c=a.find("input.directory-name").val();""!=c&&WebDAVClient.doPropFind(d+"/"+c,this,{onPopulate:function(){bm.notify($.i18n.prop("directory.with.same.name.already.exists"),"error")},onError:function(){var a=d+"/"+c;WebDAVClient.doCreateDirectory(a,this,{success:function(c){b.reloadRemoteTree(a)},error:function(a,b){bm.notify($.i18n.prop("directory.creation.not.allowed"),
"error")}})}});g.close();return!1}})};
_a.renameFile=function(a){var b=this,d="<form class='edit-popup-form create-new-directory'><div class='form-row mandatory'><label>"+$.i18n.prop("new.name")+"</label><input type='text' class='directory-name' maxlength='255' validation='required maxlength[255]' value='"+a.name+"'></div></div><div class='button-line'><button type='submit' class='submit-button'>"+$.i18n.prop("rename")+"</button><button type='button' class='cancel-button'>"+$.i18n.prop("cancel")+"</button></form>";bm.editPopup("",$.i18n.prop("rename"),
"",{},{content:d,beforeSubmit:function(c,d,g){c=c.find("input.directory-name").val();""!=c&&c!=a.name&&b.moveNodesInSameTree(a,a.parent,c);g.close();return!1}})};
_a.move=function(a,b){var d=this,c=d.body.find("select.select-repository");a="<form class='edit-popup-form create-new-directory'><div class='form-row mandatory'><label>"+$.i18n.prop("destination")+"</label><input type='text' name='destination' class='destination' validation='required'></div></div><div class='button-line'><button type='submit' class='submit-button'>"+$.i18n.prop("move")+"</button><button type='button' class='cancel-button'>"+$.i18n.prop("cancel")+"</button></form>";bm.editPopup("",
$.i18n.prop("move"),"",{},{content:a,beforeSubmit:function(a,g,m){a=a.find("input.destination").val().trim();a=c.val()+(a.startsWith("/")?"":"/")+("/"==a?"":a)+"/"+b.name;d.moveFile(b.path,a,function(){m.close();d.reload()},function(){});return!1}})};_a.extract=function(a){var b=this,d=bm.waitPopup();bm.ajax({url:app.baseUrl+"remoteRepository/extract",data:{filePath:a.path},success:function(){b.reload()},response:function(){d.close()},timeout:72E5})};
_a.deleteDirectory=function(a){var b=this;WebDAVClient.doDeletePath(a.path,{success:function(){b.reloadRemoteTree(a.path)},error:function(b){bm.notify($.i18n.prop("directory.creation.not.allowed",[a.type]),"error")}})};_a.download=function(a){bm.download(app.baseUrl+"remoteRepository/download?path="+a.parent(".grid-item").config("content","path"))};
_a.onLazyRead=function(a,b){var d=this;b=b||{};var c=$.isFunction(a)?this.body.find("select.select-repository").val():a.data.path;WebDAVClient.doPropFind(c,this,{onPopulate:function(c){c=c.folders;c.every(function(){this.hasChild=this.hasChildFolder});$.isFunction(a)?a.call(d,c):(a.addChild(c),$(a).trigger("afterPopulate"));b.done&&b.done()},onError:function(){$.isFunction(a)&&a.call(d,[]);b.fail&&b.fail()}})};_a.root_node_name=$.i18n.prop("public");
_a.beforeBuildTree=function(a){a.tree_root_data.name=this.root_node_name};_a.tree_node_type="folder";_a.tree_options={onLazyRead:_a.onLazyRead,auto_load_lazy_nodes:!1,grand_root_context:!0};_a.moveFile=function(a,b,d,c){bm.ajax({type:"MOVE",url:app.baseUrl+a,beforeSend:function(a){a.setRequestHeader("Destination",b)},success:d,error:c})};
_a.initializeFileTransfer=function(){function a(a){c.find(".file.selected, .folder.selected").removeClass("selected");a.addClass("selected")}var b=this,d=b.body.find(".left-panel .body"),c=b.body.find(".right-panel .body");this.currentPath||(this.currentPath=b.body.find("select.select-repository").val());c.find(".folder").dblclick(function(){function a(){var a=null;$.each(c.childList,function(){if(m==this.data.path)return a=this,!1});a&&a.activate(!1)}var c=d.tree("inst").getActiveNode(),m=b.currentPath+
"/"+$(this).data("name");c.data.isLazy&&!c.childList?($(c).bind("afterPopulate.click",function(){$(c).unbind("afterPopulate.click",arguments.callee);a()}),c.reloadChildren()):a()});c.find(".file, .folder").draggable({containment:b.body,helper:"clone",drop:{element:c.find(".folder"),intersect:25},append_on_drop:!1,start:function(){a($(this))}}).click(function(){a($(this))});c.find(".file, .folder").on("dragdrop",function(a,c){a=c.drag;var d=c.drop;d.is(".folder")&&(c=a.attr("content-path"),a=b.currentPath+
"/"+d.attr("content-name")+"/"+a.attr("content-name"),b.gridPanel.addClass("updating"),b.moveFile(c,a,function(){b.reload(!0)},function(){b.gridPanel.removeClass("updating")}))})};_a.beforeReloadRequest=function(a){app.tabs.assetLibrary._super.beforeReloadRequest.call(this,a);var b=this.body.find("select.select-repository").val();$.extend(a,{repository:b})};
_a.afterTableReload=function(){var a=this.body.find(".left-panel .body").tree("inst").getActiveNode();this.currentPath=this.body.find("select.select-repository").val();a&&a.data.path&&(this.currentPath=a.data.path);this.attachDirectoryInfo();this.initializeFileTransfer()};
_a.attachDirectoryInfo=function(){var a=this,b=a.currentPath.split("/"),d=a.body.find(".header .directory-info");d.html("<span class='folder-icon'></span>");var c=b.length;$.each(b,function(b,g){0==b?d.append("<span class='dir-name'>"+a.root_node_name+"</span>"):d.append("<span class='dir-name'>"+g+"</span>");b!=c-1&&d.append("<span class='right-arrow'></span>")})};
_a.makeDirInfoEditable=function(a){function b(){d.remoteNodeFinder(f.val());a.find(".dir-name").length||d.attachDirectoryInfo()}var d=this,c=d.currentPath;a.children(":not(.folder-icon)").remove();var f=$("<input type='text' class='address-edit' value=''>");a.append(f);c="pub"==c?"":c.substring(c.indexOf("/")+1,c.length);f.focus().val(c);f.on("focusout",function(){b()}).on("keypress",function(a){13==a.keyCode&&(a.preventDefault(),b())})};
_a.remoteNodeFinder=function(a){var b=this.body.find(".left-panel .body").tree("inst"),d=b.getRoot();a="pub/"+a;var c=a.charAt(a.length-1);if("/"==c||"\\"==c)a=a.substring(0,a.length-1);b.activeNode&&b.activeNode.data.path==a||(a=a.split("/"),""==a[0]&&d.activate(!1),this.nodeFinder(d,a,a[0]+"/"+a[1],1,"/"))};_a.onMoveTreeNode=function(a,b,d){"over"==d&&(this.moveNodesInSameTree(b.data,a.data.path,b.data.name),this.reload())};_a.reloadRemoteTree=function(){this.reload()};
app.tabs.autoPage=function(){this.text=$.i18n.prop("auto.pages");this.tip=$.i18n.prop("manage.auto.pages");this.ui_class="fixed-pages";this.ajax_url=app.baseUrl+"autoPage/loadAppView";app.tabs.autoPage._super.constructor.apply(this,arguments)};app.ribbons.web_content.push({text:$.i18n.prop("auto.gen.page"),processor:app.tabs.autoPage,ui_class:"fixed-page"});app.tabs.autoPage.inherit(app.SingleTableTab);_p=app.tabs.autoPage.prototype;
_p.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"fixed-page-edit edit",action:"edit"},{text:$.i18n.prop("edit.content"),ui_class:"content-edit edit",action:"edit-content"}];_p.onMenuOpen=function(a,b){a=a.attr("disabled-menu-entries");b.find(".menu-item.fixed-page-edit").removeClass("last-menu-item");b.find(".disabled").removeClass("disabled").show();a&&(a=a.split(" "),b.find(".menu-item.fixed-page-edit").addClass("last-menu-item"),b.find("."+a.join(", .")).addClass("disabled").hide())};
_p.onActionClick=function(a,b){switch(a){case "edit":this.editPage(b.id,b.name);break;case "edit-content":this.editContent(b.id,b.name)}};_p.editPage=function(a,b){var d=this;d.renderCreatePanel(app.baseUrl+"autoPage/edit",$.i18n.prop("edit.auto.gen.page"),b,{id:a},{success:function(){d.reload()},content_loaded:function(){bm.metaTagEditor(this.find("#bmui-tab-metatag"))}})};
_p.editContent=function(a,b){var d="tab-edit-auto-page-"+a,c=app.Tab.getTab(d);c||(c=new app.tabs.edit_content.product_page({id:d,containerId:a,containerName:b}),c.render());c.setActive()};_p.sortable={list:{0:"name",1:"title"},sorted:"0",dir:"up"};app.tabs.content=function(){this.constructor_args=arguments;this.text=$.i18n.prop("contents");this.tip=$.i18n.prop("manage.web.contents");this.ui_class="contents";app.tabs.content._super.constructor.apply(this,arguments)};_c=app.tabs.content.inherit(app.ExplorerPanelTab);
_c.switch_menu_entries=[{text:$.i18n.prop("article.list"),ui_class:"view-switch article-list",action:"article"},{text:$.i18n.prop("section.list"),ui_class:"view-switch section-list",action:"section"}];_c.create_menu_entries=[{text:$.i18n.prop("create.article"),ui_class:"create-article",action:"create-article"},{text:$.i18n.prop("create.section"),ui_class:"create-section",action:"create-section"}];
_c.action_menu_entries=[{text:$.i18n.prop("manage.section.owner.permissions"),ui_class:"manage-section-owner-permissions permission",action:"manage-section-owner-permissions",license:CONSTANTS.LICENSES.ACL},{text:$.i18n.prop("manage.article.owner.permissions"),ui_class:"manage-article-owner-permissions permission",action:"manage-article-owner-permissions",license:CONSTANTS.LICENSES.ACL}];
(function(){function a(){var a=this;this.body.find(".section-selector").change(function(){a.body.find(".search-form").trigger("submit")});this.on_global(["article-restore","news-update","content-update"],function(){a.reload()});this.on("close",function(){app.tabs.content.tab=null})}_c.init=function(){app.tabs.content._super.init.call(this);app.tabs.content.tab=this;a.call(this)};app.global_event.on("after-ribbon-render",function(a,d){d.find(".menu-item.content").length&&(app.isPermitted("section.view.list")&&
app.isPermitted("article.view.list")?d.enable("content"):d.disable("content"))})})();_c.onSwitchMenuClick=function(a){app.Tab.changeView(this,"content",a,"explorer"==a?"ExplorerPanelTab":"SingleTableTab")};_c.onActionMenuClick=function(a){switch(a){case "manage-section-owner-permissions":this.manageSectionOwnerPermissions();break;case "manage-article-owner-permissions":this.manageArticleOwnerPermissions()}};
_c.onCreateMenuClick=function(a){switch(a){case "create-article":this.createArticle();break;case "create-section":this.createSection()}};
_c.onMenuOpen=function(a,b){var d=[{key:"section.edit",class:"edit",isEntity:!0},{key:"section.remove",class:"delete",isEntity:!0},{key:"section.edit.permission",class:"manage-permission.section-permission",isEntity:!0}],c=[{key:"article.edit",class:"edit",isEntity:!0},{key:"article.create",class:"copy",isEntity:!0},{key:"article.remove",class:"delete",isEntity:!0},{key:"article.edit.permission",class:"manage-permission.article-permission",isEntity:!0}];if("section"==a){var f=this.explorer.menu[a];
var g=d}else"article"==a?(f=this.explorer.menu[a],g=c):(f=this.tabulator.menu,b=a.config("entity"),"section"==b.type?g=d:"article"==b.type&&(g=c));app.checkPermission(f,g,b)};_c.onActionMenuOpen=function(a){app.checkPermission(a,[{key:"section.create",class:"create-section"},{key:"article.create",class:"create-article"},{key:"section.edit.permission",class:"manage-section-owner-permissions"},{key:"article.edit.permission",class:"manage-article-owner-permissions"}])};
_c.beforeReloadRequest=function(a){app.tabs.content._super.beforeReloadRequest.call(this,a);var b=this.body.find(".section-selector");this.advanceSearchFilter&&b.chosen("val",a.section);$.extend(a,{section:b.val()})};
_c.onActionClick=function(a,b,d){3==arguments.length&&(d=b,b=a);switch(b){case "editArticle":this.editArticle(d.id,d.name);break;case "copyArticle":this.copyArticle(d.id,d.name);break;case "deleteArticle":this.deleteArticle(d.id,d.name);break;case "editSection":this.editSection(d.id,d.name);break;case "deleteSection":this.deleteSection(d.id,d.name);break;case "section-permission":this.manageSectionEntityPermission(d.id,d.name);break;case "article-permission":this.manageArticleEntityPermission(d.id,
d.name)}};_c.onSelectedActionClick=function(a,b){switch(a){case "copy":this.copySelectedArticles(b.collect("id"));break;case "remove":this.deleteSelectedArticle(b.collect("id"));break;case "removeSections":this.deleteSelectedSections(b.collect("id"))}};
_c.deleteSelectedSections=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.section"),function(){bm.ajax({url:app.baseUrl+"content/deleteSelectedSections",data:{ids:a},success:function(){b.reload();b.body.find(".action-header").hide()}})},function(){})};
_c.copySelectedArticles=function(a){var b=this;bm.confirm($.i18n.prop("confirm.copy.selected.article"),function(){bm.ajax({url:app.baseUrl+"content/copySelectedArticles",data:{ids:a},success:function(){b.reload(!0);b.body.find(".action-header").hide()}})},function(){})};
_c.deleteSelectedArticle=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.article"),function(){bm.ajax({url:app.baseUrl+"content/deleteSelectedArticles",data:{ids:a},success:function(){app.global_event.trigger("send-trash",["article",a]);app.global_event.trigger("article-delete",[a]);b.body.find(".action-header").hide();b.reload()}})},function(){})};
_c.manageSectionOwnerPermissions=function(){bm.permissionPopup($.i18n.prop("manage.owner.permissions"),$.i18n.prop("section"),{for:"owner",type:"section"})};_c.manageArticleOwnerPermissions=function(){bm.permissionPopup($.i18n.prop("manage.owner.permissions"),$.i18n.prop("article"),{for:"owner",type:"article"})};
_c.createArticle=_c.editArticle=function(a,b,d){var c={id:a},f=$.i18n.prop("edit.article");d=d?d:this;"undefined"==typeof a&&(c={},b="",f=$.i18n.prop("create.article"));d.renderCreatePanel(app.baseUrl+"content/editArticle",f,b,c,{width:920,success:function(){a?app.global_event.trigger("article-update",[a]):app.global_event.trigger("article-create")}})};app.tabs.content.editArticle=_c.editArticle;
_c.deleteArticle=function(a,b){var d=this;bm.remove("article",$.i18n.prop("article"),$.i18n.prop("confirm.delete.article",[b]),app.baseUrl+"content/deleteArticle",a,{success:function(){app.global_event.trigger("article-delete");d.reload(!0)}})};_c.copyArticle=function(a){var b=this;bm.ajax({url:app.baseUrl+"content/copyArticle",data:{id:a},success:function(){b.reload(!0)}})};app.tabs.content.viewArticle=function(a){bm.viewPopup(app.baseUrl+"content/viewArticle",{id:a},{width:600})};
_c.editSection=function(a,b){var d=this,c={id:a},f=$.i18n.prop("edit.section");"undefined"==typeof a&&(c={},b="",f=$.i18n.prop("create.section"));this.renderCreatePanel(app.baseUrl+"content/editSection",f,b,c,{success:function(){d.reload();a?app.global_event.trigger("section-update",[a]):app.global_event.trigger("section-create")}})};_c.createSection=_c.editSection;
_c.deleteSection=function(a,b){var d=this;bm.remove("section",$.i18n.prop("section"),$.i18n.prop("confirm.delete.section",[b]),app.baseUrl+"content/confirmDeleteSection",a,{success:function(){d.reload()}})};_c.manageSectionEntityPermission=function(a,b){bm.permissionPopup($.i18n.prop("manage.section.permissions"),b,{id:a,for:"entity",type:"section"})};_c.manageArticleEntityPermission=function(a,b){bm.permissionPopup($.i18n.prop("manage.article.permissions"),b,{id:a,for:"entity",type:"article"})};
app.tabs.content.article=function(){app.tabs.content.article._super.constructor.apply(this,arguments)};_a=app.tabs.content.article.inherit(app.tabs.content);(function(){var a=app.tabs.content.article._super;_a.init=function(){var b=this;this.body.find(".toolbar .create").on("click",function(){b.editArticle()});this.on_global(["article-create","article-update"],function(){b.reload()});a.init.apply(this,arguments)}})();
_a.beforeReloadRequest=function(a){app.tabs.content._super.beforeReloadRequest.call(this,a);var b=this.body.find(".section-selector");this.advanceSearchFilter?(b.parent().find("select").chosen("disable",!0),$.extend(a,{section:this.advanceSearchFilter.section})):(b.parent().find("select").chosen("disable",!1),$.extend(a,{section:b.val()}))};
_a.switch_menu_entries=[{text:$.i18n.prop("section.list"),ui_class:"view-switch section-list",action:"section"},{text:$.i18n.prop("explorer.view"),ui_class:"view-switch explorer",action:"explorer"}];_a.action_menu_entries=[{text:$.i18n.prop("manage.article.owner.permissions"),ui_class:"manage-article-owner-permissions manage-permission",action:"manage-article-owner-permissions",license:CONSTANTS.LICENSES.ACL}];
_a.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit",action:"editArticle"},{text:$.i18n.prop("copy"),ui_class:"copy",action:"copyArticle"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"deleteArticle"},{text:$.i18n.prop("permission"),ui_class:"manage-permission article-permission permission",action:"article-permission"}];_a.sortable={list:{1:"isPublished",2:"name",4:"created",5:"updated"},sorted:"2",dir:"up"};_a.ajax_url=app.baseUrl+"content/loadArticleView";
_a.advanceSearchUrl=app.baseUrl+"content/advanceFilter";_a.advanceSearchTitle=$.i18n.prop("article");app.tabs.content.section=function(){app.tabs.content.section._super.constructor.apply(this,arguments)};var _s=app.tabs.content.section.inherit(app.tabs.content);
(function(){var a=app.tabs.content.section._super;_s.init=function(){var b=this;this.body.find(".toolbar .create").on("click",function(){b.editSection()});this.on_global(["section-create","section-update"],function(){b.reload()});a.init.apply(this,arguments)}})();_s.switch_menu_entries=[{text:$.i18n.prop("article.list"),ui_class:"view-switch article-list",action:"article"},{text:$.i18n.prop("explorer.view"),ui_class:"view-switch explorer",action:"explorer"}];
_s.action_menu_entries=[{text:$.i18n.prop("manage.section.owner.permissions"),ui_class:"manage-section-owner-permissions manage-permission",action:"manage-section-owner-permissions",license:CONSTANTS.LICENSES.ACL}];_s.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit",action:"editSection"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"deleteSection"},{text:$.i18n.prop("permission"),ui_class:"manage-permission section-permission permission",action:"section-permission"}];
_s.sortable={list:{1:"name",2:"parent"},sorted:"1",dir:"up"};_s.ajax_url=app.baseUrl+"content/loadSectionView";app.tabs.content.explorer=function(){app.tabs.content.explorer._super.constructor.apply(this,arguments)};_e=app.tabs.content.explorer.inherit(app.tabs.content);_e.init=function(){var a=this;app.tabs.content.explorer._super.init.call(this);this.on_global(["article-update","article-create"],function(){a.reload()})};
app.ribbons.web_content.push(app.tabs.content.ribbon_data={text:$.i18n.prop("content"),ui_class:"content",processor:app.tabs.content.explorer,views:[{ui_class:"article",text:$.i18n.prop("article"),permission:"article.view.list"},{ui_class:"section",text:$.i18n.prop("section"),permission:"section.view.list"}],supers:{explorer:"ExplorerPanelTab",article:"SingleTableTab",section:"SingleTableTab"}});_e.ajax_url=app.baseUrl+"content/loadExplorerView";_e.explorer_url=app.baseUrl+"content/explorePanel";
_e.menu_entries={section:_s.menu_entries,article:_a.menu_entries};_e.tree_node_load_url=app.baseUrl+"content/sectionTree";_e.root_node_name=$.i18n.prop("root.section");_e.tree_node_type="section";_e.onMoveTreeNode=function(a,b,d,c){};
(function(){function a(){var a=this;this.body.find(".toolbar .create").on("click",function(){a.create()})}app.tabs.document=function(){this.constructor_args=arguments;this.text=$.i18n.prop("document");this.tip=$.i18n.prop("documents");this.ui_class="doc";this.ajax_url=app.baseUrl+"document/loadAppView";d.constructor.apply(this,arguments)};var b=app.tabs.document.inherit(app.SingleTableTab);var d=b.constructor._super;app.ribbons.web_content.push(app.tabs.document.ribbon_data={text:$.i18n.prop("document"),
ui_class:"doc",processor:app.tabs.document});b.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("copy"),ui_class:"copy"},{text:$.i18n.prop("set.as.active.document"),ui_class:"active"},{text:$.i18n.prop("remove"),ui_class:"delete"}];b.onActionClick=function(a,b){switch(a){case "edit":this.create(b.id);break;case "copy":this.copy(b.id);break;case "active":this.setActiveTemplate(b.id);break;case "delete":this.delete(b.id,b.name)}};b.init=function(){d.init.call(this);a.call(this)};
b.create=function(a){var b=app.Tab.getTab("tab-edit-create-document");b?(b.ajax_data={id:a},b.reload()):(b=new app.tabs.documentEditor({id:"tab-edit-create-document",ajax_data:{id:a}}),b.render());b.setActive()};b.copy=function(a){var b=this;bm.ajax({url:app.baseUrl+"document/copy",data:{id:a},success:function(){b.reload()}})};b.onSelectedActionClick=function(a,b){switch(a){case "remove":this.deleteSelected(b.collect("id"))}};b.delete=function(a,b){var c=this;bm.remove("document","Document",$.i18n.prop("confirm.delete.document",
[b]),app.baseUrl+"document/delete",a,{is_final:!0,success:function(){c.reload()}})};b.deleteSelected=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.document"),function(){bm.ajax({url:app.baseUrl+"document/deleteSelected",data:{ids:a},success:function(){b.reload()}})},function(){})};b.setActiveTemplate=function(a){var b=this;bm.ajax({url:app.baseUrl+"document/setActiveTemplate",data:{id:a},success:function(){b.reload()}})}})();
app.tabs.navigation=function(){this.text=$.i18n.prop("navigations");this.tip=$.i18n.prop("manage.navigations");this.ui_class="navigations";this.ajax_url=app.baseUrl+"navigation/loadAppView";app.tabs.navigation._super.constructor.apply(this,arguments)};app.ribbons.web_content.push({text:$.i18n.prop("navigation"),processor:app.tabs.navigation,ui_class:"navigation"});app.tabs.navigation.inherit(app.SingleTableTab);_m=app.tabs.navigation.prototype;_m.advanceSearchUrl=app.baseUrl+"navigation/advanceFilter";
_m.advanceSearchTitle=$.i18n.prop("navigation");_m.sortable={list:{1:"name"},sorted:"1",dir:"up"};_m.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"},{text:$.i18n.prop("remove"),ui_class:"remove",action:"remove"}];
_m.onSelectedActionClick=function(a,b){switch(a){case "remove":this.deleteSelectedNavigations(b.collect("id"));break;case "restricted":bm.editPopup(app.baseUrl+"navigation/loadRestrictedItemOption",$.i18n.prop("restricted.item"),null,{},{width:600,events:{content_loaded:function(){var a=$(this),c=b.collect("id");$.each(c,function(b,c){a.find(".edit-popup-form").append('<input type="hidden" name="id" value="'+c+'">')})}}})}};
(function(){function a(){var a=this;this.on_global("navigation-restore",function(){a.reload()});this.on("close",function(){app.tabs.navigation.tab=null});this.body.find(".toolbar .create").on("click",function(){a.createNavigation()});this.body.on("click",".item-action",function(){var b=$(this),c=b.attr("entity-id");b=b.attr("entity-name");a.editNavigationItems(c,b)})}_m.init=function(){app.tabs.navigation._super.init.call(this);app.tabs.navigation.tab=this;a.call(this)};app.global_event.on("after-ribbon-render",
function(a,d){app.isPermitted("navigation.view.list")?d.enable("navigation"):d.disable("navigation")})})();_m.onMenuOpen=function(a,b){b=this.tabulator.menu;app.checkPermission(b,[{key:"navigation.edit",class:"edit"},{key:"navigation.edit.items",class:"manage-navigation-item, .manage-item-image"},{key:"navigation.remove",class:"remove"}]);a.is("[is-default='true']")?b.find(".remove").addClass("disabled"):b.find(".remove").removeClass("disabled")};
_m.onActionMenuOpen=function(a){app.checkPermission(a,[{key:"navigation.create",class:"create-navigation"}])};_m.advanceSearchUrl=app.baseUrl+"navigation/advanceFilter";_m.advanceSearchTitle=$.i18n.prop("navigation");_m.onActionClick=function(a,b){switch(a){case "edit":this.createNavigation(b.id,b.name);break;case "remove":this.deleteNavigation(b.id,b.name)}};
_m.createNavigation=function(a,b){var d={id:a},c=$.i18n.prop("edit.navigation");"undefined"==typeof a&&(c=$.i18n.prop("create.navigation"),b="",d={});this.renderCreatePanel(app.baseUrl+"navigation/create",c,b,d,{success:function(){app.tabs.navigation.tab&&app.tabs.navigation.tab.reload()}})};
_m.editNavigationItems=function(a,b){if(app.Tab.getTab("navigation-item-image-editor-"+a))bm.notify($.i18n.prop("this.navigation.open.in.item.imageeditor.close.that.first"),"error");else{var d=app.Tab.getTab("tab-edit-navigation-"+a);d||(d=new app.tabs.navigationItem({navigation:{id:a,name:b},id:"tab-edit-navigation-"+a}),d.render());d.setActive()}};
_m.deleteNavigation=function(a,b){var d=this;bm.remove("navigation",$.i18n.prop("Navigation"),$.i18n.prop("confirm.delete.navigation",[b]),app.baseUrl+"navigation/delete",a,{success:function(){d.reload()}})};
_m.deleteSelectedNavigations=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.navigation"),function(){bm.ajax({url:app.baseUrl+"navigation/deleteSelected",data:{ids:a},success:function(){b.reload();app.global_event.trigger("send-trash",["navigation",a]);b.body.find(".action-header").hide()}})},function(){})};
app.tabs.navigationImage=function(){app.tabs.navigationImage._super.constructor.apply(this,arguments);$.extend(this,{text:$.i18n.prop("navigationitem.images"),name:this.navigation.name,tip:$.i18n.prop("manage.navigationitem.images"),ui_class:"navigation-item-image-editor",ui_body_class:"simple-tab",ajax_url:app.baseUrl+"navigation/loadNavigationImageEditor?id="+this.navigation.id,strict_layout:!1})};app.tabs.navigationImage.inherit(app.Tab);var _en=app.tabs.navigationImage.prototype;
(function(){_en.init=function(){app.tabs.navigationImage._super.init.call(this);this.header.find(".title").append(" - <span class='entity-name'></span>");this.header.find(".entity-name").text(this.navigation.name)}})();app.tabs.page=function(){this.text=$.i18n.prop("pages");this.tip=$.i18n.prop("manage.pages");this.ui_class="pages";this.ajax_url=app.baseUrl+"pageAdmin/loadAppView";app.tabs.page._super.constructor.apply(this,arguments)};
app.ribbons.web_content.push({text:$.i18n.prop("page"),processor:app.tabs.page,ui_class:"page"});app.tabs.page.inherit(app.SingleTableTab);_p=app.tabs.page.prototype;_p.advanceSearchUrl=app.baseUrl+"pageAdmin/advanceFilter";_p.advanceSearchTitle=$.i18n.prop("page");_p.action_menu_entries=[{text:$.i18n.prop("manage.owner.permissions"),ui_class:"manage-owner-permissions",action:"manage-owner-permissions",license:CONSTANTS.LICENSES.ACL}];
_p.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("edit.content"),ui_class:"edit-content edit",action:"edit-content"},{text:$.i18n.prop("view.in.site"),ui_class:"preview view",action:"view-in-website"},{text:$.i18n.prop("copy"),ui_class:"copy"},{text:$.i18n.prop("remove"),ui_class:"delete"},{text:$.i18n.prop("permission"),ui_class:"manage-permission page-permission",action:"permission"},{text:$.i18n.prop("set.landing.page"),ui_class:"set-landing-page page",action:"landing-page"}];
(function(){function a(){var a=this;this.on_global("operator-update",function(){a.reload()});this.on("close",function(){app.tabs.page.tab=null});this.on_global("page-restore",function(){a.reload()});this.body.find(".toolbar .create").on("click",function(){a.createPage()})}_p.init=function(){app.tabs.page._super.init.call(this);app.tabs.page.tab=this;a.call(this)};app.global_event.on("after-ribbon-render",function(a,d){app.isPermitted("page.view.list",{})?d.enable("page"):d.disable("page")})})();
_p.sortable={list:{1:"visibility",2:"name",3:"title",4:"created",5:"updated"},sorted:"2",dir:"up"};_p.afterTableReload=function(){this.body.find(".action-header").hide()};
_p.onActionClick=function(a,b){switch(a){case "edit":this.editPage(b.id,b.name);break;case "edit-content":this.editContent(b.id,b.name);break;case "view-in-website":this.viewInWebsite(b.url);break;case "delete":this.deletePage(b.id,b.name,b.url);break;case "landing-page":this.setLandingPage(b.id,b.url,b.name);break;case "copy":this.copyPage(b.id,b.name);break;case "permission":this.manageEntityPermission(b.id,b.name)}};_p.onActionMenuClick=function(a){switch(a){case "manage-owner-permissions":this.manageOwnerPermissions()}};
_p.viewInWebsite=function(a){a=app.siteBaseUrl+a+"?adminView=true";window.open(a,"_blank")};_p.onActionMenuOpen=function(a){app.checkPermission(a,[{key:"page.create",class:"create-page"},{key:"page.edit.permission",class:"manage-owner-permissions"}])};
_p.onMenuOpen=function(a){var b=this.tabulator.menu;a.is("tr.landing span")?(b.find(".set-landing-page").addClass("disabled"),b.find(".delete").addClass("disabled")):(b.find(".set-landing-page").removeClass("disabled"),b.find(".delete").removeClass("disabled"));a=a.config("entity");app.checkPermission(b,[{key:"page.remove",class:"delete",isEntity:!0},{key:"page.create",class:"copy"},{key:"page.edit.properties",class:"edit",isEntity:!0},{key:"page.edit.content",class:"edit-content",isEntity:!0},{key:"page.edit.permission",
class:"page-permission"}],a)};_p.onSelectedActionClick=function(a,b){switch(a){case "administrative_status":this.statusSelectedPage(b);break;case "copy":this.copySelectedPage(b.collect("id"));break;case "remove":this.deleteSelectedPage(b.collect("id"))}};app.tabs.page.viewPage=function(a){bm.viewPopup(app.baseUrl+"pageAdmin/view",{id:a})};
_p.manageCustomerRestriction=function(a,b){a.find("[name='isCustomerSelectorDirty']").length?bm.customerAndGroupSelectionPopup(a,{}):bm.customerAndGroupSelectionPopup(a,{url:app.baseUrl+"pageAdmin/listCustomerAndGroups",data:{id:b}})};
_p.editPage=function(a,b){var d=this,c={id:a},f=$.i18n.prop("edit.page");"undefined"==typeof a&&(f=$.i18n.prop("create.page"),b="",c={});this.renderCreatePanel(app.baseUrl+"pageAdmin/edit",f,b,c,{success:function(){d.editFormSuccess(a)},width:850,content_loaded:function(b){d.editContentLoaded(b,a)},beforeSubmit:function(a,b,c){return d.editFormBeforeSubmit(a)}})};
_p.editFormSuccess=function(a){a?app.global_event.trigger("page-update",[a]):app.global_event.trigger("page-create");app.tabs.page.tab&&app.tabs.page.tab.reload()};_p.editContentLoaded=function(a,b){var d=this;a.find("input[name='name']").on("change",function(){var b=a.find("input[name='title']");""==b.val()&&b.val($(this).val())});a.find(".tool-icon.choose-customer").on("click",function(){d.manageCustomerRestriction(a,b)});bm.metaTagEditor(a.find("#bmui-tab-metatag"))};
_p.editFormBeforeSubmit=function(a){var b=!0;"restricted"!=a.find("[name='visibility']").val()||"selected"!=a.find("[name=visibleTo]").radio("val")||a.find("input[name='customer'], input[name='customerGroup']").length||(bm.notify($.i18n.prop("no.customer.or.group.selected"),"error"),b=!1);return b};_p.createPage=_p.editPage;_p.manageOwnerPermissions=function(){bm.permissionPopup($.i18n.prop("manage.owner.permissions"),$.i18n.prop("page"),{for:"owner",type:"page"})};
_p.setLandingPage=function(a,b,d){var c=this;bm.ajax({url:app.baseUrl+"pageAdmin/setLandingPage",data:{url:b,name:d},success:function(){app.global_event.trigger("page-update",[a]);c.reload()}})};_p.deletePage=function(a,b){var d=this;bm.remove("page",$.i18n.prop("page"),$.i18n.prop("confirm.delete.page",[b]),app.baseUrl+"pageAdmin/delete",a,{success:function(){d.reload()}})};
_p.deleteSelectedPage=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.page"),function(){bm.ajax({url:app.baseUrl+"pageAdmin/deleteSelected",data:{ids:a},success:function(){b.reload();app.global_event.trigger("send-trash",["page",a]);b.body.find(".action-header").hide()}})},function(){})};
_p.statusSelectedPage=function(a){var b=this;bm.editPopup(app.baseUrl+"pageAdmin/loadStatusOption",$.i18n.prop("status"),null,{},{width:600,events:{content_loaded:function(){var b=$(this),c=a.collect("id");$.each(c,function(a,c){b.find(".edit-popup-form").append('<input type="hidden" name="id" value="'+c+'">')})}},success:function(){b.reload()}})};_p.copyPage=function(a,b){var d=this;bm.ajax({url:app.baseUrl+"pageAdmin/copy",data:{id:a},success:function(){d.reload()}})};
_p.copySelectedPage=function(a){var b=this;bm.confirm($.i18n.prop("confirm.copy.selected.page"),function(){bm.ajax({url:app.baseUrl+"pageAdmin/copySelected",data:{ids:a},success:function(){b.reload();b.body.find(".action-header").hide()}})},function(){})};_p.editContent=function(a,b){var d="tab-edit-page-"+a,c=app.Tab.getTab(d);c||(c=new app.tabs.edit_content.page({id:d,containerId:a,containerName:b,section:"body"}),c.render());c.setActive()};
_p.manageEntityPermission=function(a,b){bm.permissionPopup($.i18n.prop("manage.permissions"),b,{id:a,for:"entity",type:"page"})};app.tabs.layout=function(a){this.text=$.i18n.prop("layout");this.tip=$.i18n.prop("manage.layout");this.ui_class="layout";this.ajax_url=app.baseUrl+"layout/loadAppView";app.tabs.layout._super.constructor.apply(this,arguments)};app.ribbons.web_design.push({text:$.i18n.prop("layout"),processor:app.tabs.layout,ui_class:"layout"});app.tabs.layout.inherit(app.TwoPanelResizeable);
_l=app.tabs.layout.prototype;_l.resize_disabled=!0;_l.shim_required=!0;
(function(){_l.init=function(){app.tabs.layout._super.init.call(this);var a=this,b=a.body.find("[name='layoutType']");this.on_global("layout-update",function(b,d){parseInt($(a.body.find(".layout-thumb.selected")).attr("layout-id"))==d&&a.reload()});this.on_global("template-install",function(){a.reload()});b.on("change",function(){a.reload()});this.iframe=this.body.find("iframe");var d=this.body.find(".right-panel .body");this.iframe.on("load",function(){bm.maskIframe(a.iframe);d.loader(!1);a.iframe.contents().find("#webcommander-page > .iframe-mask").mousedown(function(){$(document).trigger("mousedown")})});
this.iframe.on("error",function(){d.loader(!1)});this.body.find(".left-panel").scrollbar({vertical:{offset:3}});this.body.find(".toolbar .create").click(function(){a.editLayoutName()});this.attachEvents.call(this)};_l.close=function(){app.tabs.layout._super.close.call(this)}})();_l.openContentEditor=function(a,b,d){var c="tab-edit-layout-"+a,f=app.Tab.getTab(c);f||(f=new app.tabs.edit_content.layout({id:c,containerId:a,containerName:b,initial_section:d}),f.render());f.setActive()};
_l.editLayoutName=function(a,b){function d(){if(m.validate()){var b=m.elm.val();bm.ajax({show_response_status:!1,url:g,data:a?{layoutId:a,newName:b}:{name:b},success:function(a){c.reload(a.id)},error:function(a,b,c){m.elm.focus();m.showError({msg_template:c.message,msg_params:[],rule:void 0})}})}else m.elm.focus()}var c=this,f=c.body.find(".left-panel .layout-thumb.new-layout");if(f.length)f.find(".layout-title").focus();else{b=$('<div layout-name="" layout-id="" class="layout-thumb blocklist-item new-layout fade-in-up"><input type="text" validation="required maxlength[100]" maxlength="100" class="layout-title full-width" value="'+
(b||"")+'"><span class="float-tooliconbar"><span class="tool-icon apply" title="'+$.i18n.prop("apply")+'"></span><span class="tool-icon discard" title="'+$.i18n.prop("discard")+'"></span></span></div>');var g=app.baseUrl+"layout/createLayout";a?(g=app.baseUrl+"layout/rename",c.body.find(".left-panel .body div[layout-id="+a+"]").replaceWith(b)):c.body.find(".left-panel > .body").prepend(b);var m=ValidationField.createDetachedField(b.find("input"),{error_position:"after"}),l=!1;b.find(".layout-title").focus().on("keyup.key_return",
function(){d()}).on("blur",function(){l||c.reload();l=!1});b.find(".tool-icon.apply").mousedown(function(){l=!0}).click(function(){d()})}};_l.setAsDefault=function(a,b){var d=this;bm.saveSiteConfig({general:{default_layout:a}},function(a){bm.notify($.i18n.prop("layout.set.as.default.success"),"success");d.reload()},function(){bm.notify($.i18n.prop("layout.set.as.default.failure"),"error")})};
_l.attachEvents=function(){var a=this,b=bm.menu([{text:$.i18n.prop("attached.pages"),ui_class:"attach-page attach",action:"attach-page"},{text:$.i18n.prop("copy"),ui_class:"copy"},{text:$.i18n.prop("edit.header.section"),ui_class:"edit edit-header",action:"content-edit-header"},{text:$.i18n.prop("edit.content.section"),ui_class:"edit edit-content",action:"content-edit-body"},{text:$.i18n.prop("edit.footer.section"),ui_class:"edit edit-footer",action:"content-edit-footer"},{text:$.i18n.prop("rename"),
ui_class:"rename"},{text:$.i18n.prop("set.as.default.layout"),ui_class:"edit set-as-default",action:"set-as-default"},{text:$.i18n.prop("remove"),ui_class:"delete"}],this.body.find(".left-panel .float-menu-navigator"),null,{open:function(a){a.parent().addClass("float-menu-opened");"true"==a.attr("is-default")?(b.disable("set-as-default"),b.disable("delete")):(b.enable("delete"),b.enable("set-as-default"))},hide:function(a){a.parent().removeClass("float-menu-opened")},click:function(b,c){var d=c.closest(".layout-thumb").attr("layout-id");
c=c.closest(".layout-thumb").attr("layout-name");switch(b){case "copy":a.body.loader();bm.ajax({url:app.baseUrl+"layout/copyLayout",data:{layoutId:d},response:function(){a.body.removeClass("updating");a.body.loader(!1)},success:function(){a.reload()}});break;case "delete":var g=$(a.body.find(".layout-thumb.selected")).attr("layout-id");bm.remove("layout","layout",$.i18n.prop("confirm.delete.layout",[c]),app.baseUrl+"layout/deleteLayout",d,{is_final:!0,start:function(){a.body.loader()},stop:function(){a.body.loader(!1);
g==d&&$(a.body.find(".layout-thumb")[0]).trigger("click")},success:function(){a.reload()}});break;case "attach-page":bm.viewPopup(app.baseUrl+"layout/viewAttachPages",{layoutId:d});break;case "rename":a.editLayoutName(d,c);break;case "set-as-default":a.setAsDefault(d,c);break;case "content-edit-header":a.openContentEditor(d,c,"header");break;case "content-edit-body":a.openContentEditor(d,c,"body");break;case "content-edit-footer":a.openContentEditor(d,c,"footer")}}},"click",["center bottom","right+22 top+7"]);
this.body.find(".layout-thumb").click(function(){var b=$(this);if(!b.is(".floating-menu")){a.body.find(".layout-thumb.selected").removeClass("selected");b.addClass("selected");var c=a.body.find(".right-panel .body");b=b.attr("layout-id");c.loader();var f=app.baseUrl+"layout/renderLayout?id="+b+"&viewMode=true";bm.ajax({url:app.baseUrl+"layout/isAdminLoggedIn",response:function(){c.loader(!1)},success:function(){a.iframe.attr("src",f)}})}})};
_l.reload=function(a,b){var d=this,c=this.body.find(".left-panel .body .selected").attr("layout-id"),f=this.body.find(".left-panel .body");f.loader();bm.ajax({url:app.baseUrl+"layout/loadLeftPanel",dataType:"html",data:{selected:a?a:c,new:a?!0:!1,layoutType:d.body.find("[name='layoutType']").val()},response:function(){f.loader(!1)},success:function(a){var c=$(a),g=d.body.find(".item-group .count");c=c.filter(".layout-thumb").length;g.text(c);f.find(".layout-thumb").remove();f.append(a);f.updateUi();
d.attachEvents();b||(f=d.body.find(".right-panel .body"),f.loader(),d.iframe[0].contentDocument.location.reload(!0))}})};app.tabs.template=function(a){this.text=$.i18n.prop("templates");this.tip=$.i18n.prop("manage.template");this.ui_class="template";this.ajax_url=app.baseUrl+"templateAdmin/loadAppView";app.tabs.layout._super.constructor.apply(this,arguments)};app.ribbons.web_design.push({text:$.i18n.prop("template"),processor:app.tabs.template,ui_class:"template"});app.tabs.template.inherit(app.TwoPanelResizeable);
_t=app.tabs.template.prototype;_t.resize_disabled=!0;_t.left=600;_t.left_boundary=[300,Number.MAX_VALUE];_t.right_boundary=[300,Number.MAX_VALUE];
(function(){function a(){function a(){c.paginator=c.body.find(".pagination").obj();c.paginator.onPageClick=d;f.find(".floating-mask").hide();f.find(".right-panel .body").scrollbar();f.find(".template-thumb .install").click(function(){var a=$(this).closest(".template-thumb"),b=a.attr("template-id"),d=a.find(".color.selected"),f="";d.length&&(f=d.attr("name").trim(),d=d.attr("color").trim(),f=f+"-"+d.substring(1));c.install(b,f,a.attr("template-name"))});f.find(".template-thumb .color-block").on("click",
function(){var a=$(this),b=a.attr("name"),c=a.attr("color");b=b+"-"+c.substring(1);c=a.closest(".template-thumb");var d=c.attr("live-url"),e=app.baseUrl+"templateAdmin/preview?liveURL="+encodeURIComponent(d)+"&color="+b;d=d.endsWith("/")?d:d+"/";c.find(".color-block.selected").removeClass("selected");a.addClass("selected");c.find("a.demo-link").attr("href",d+"app/demoTemplate?color="+b);c.find("a.preview-link").attr("href",e)})}function d(){var b=c.body.find(".right-panel");b.loader();var d=c.paginator,
f={max:d.getItemsPerPage(),offset:(d.currentPage-1)*d.itemsPerPage};g.each(function(){var a=$(this);f[a.attr("name")]=a.val()});bm.ajax({url:app.baseUrl+"templateAdmin/reloadTemplate",dataType:"html",data:f,response:function(){b.loader(!1)},success:function(d){d=$(d);b.find(".body").html(d.filter(".body").html());b.find(".footer").html(d.filter(".footer").html());b.updateUi();a.call(c)}})}var c=this,f=this.body,g=f.find("select.filter");g.on("change",function(){c.reload()});a.call(c)}_t.init=function(){app.tabs.template._super.init.call(this);
this.attachLeftPanelEvents();a.call(this)}})();_t.reload=function(){this.paginator.onPageClick(this.paginator.getCurrentPage())};
_t.attachLeftPanelEvents=function(){var a=this,b=this.body;b.find(".installed-colors .color").on("click",function(){var b=$(this),c=b.closest(".installed-colors");b.is(".selected")||a.changeColor(b.attr("name"),function(){c.find(".color.selected").removeClass("selected");b.addClass("selected")})});b.find("[name=templateContainerClass]").on("change",function(){a.changeTemplateContainerClass($(this).val())});b.find(".template-image.body").scrollbar()};
_t.reloadLeftPanel=function(){var a=this,b=this.body.find(".left-panel");b.loader();bm.ajax({url:app.baseUrl+"templateAdmin/leftPanel",dataType:"html",response:function(){b.loader(!1)},success:function(d){d=$(d);b.html(d.html());b.updateUi();a.attachLeftPanelEvents()}})};
_t.install=function(a,b,d){var c=this,f;bm.editPopup(app.baseUrl+"templateAdmin/installTemplatePopup",$.i18n.prop("confirm.install.template",[d]),null,{id:a,color:b},{width:620,clazz:"template-confirm",beforeSubmit:function(a,b,c){$.extend(b,{timeout:36E5});f=this;bm.mask(this,'<div class="bg-white"><div class="loader2"></div><div class="wait-message">'+$.i18n.prop("this.may.take.some.time")+"</div></div>")},success:function(){c.body.find(".template-image > img").clearCache(function(){c.reloadLeftPanel();
c.reload();app.global_event.trigger("template-install")})},error:function(){f.unmask()},complete:function(){f.unmask()}})};_t.changeColor=function(a,b){var d=this;this.maskLeftPanel();bm.ajax({url:app.baseUrl+"templateAdmin/changeColor",data:{color:a},success:function(){b()},complete:function(){d.maskLeftPanel(!1)}})};_t.changeTemplateContainerClass=function(a){var b=this;this.maskLeftPanel();bm.ajax({url:app.baseUrl+"templateAdmin/changeTemplateContainerClass",data:{templateContainerClass:a},complete:function(){b.maskLeftPanel(!1)}})};
_t.maskLeftPanel=function(a){var b=this.body.find(".left-panel");0==a?b.unmask():b.mask()};app.tabs.template.preview=function(a){a=$("<img src='"+(app.baseUrl+"templates/"+a+"/images/large.jpg")+"'>");var b=bm.viewPopup(void 0,void 0,{content:a,clazz:"view-popup template-preview"});a.on("load",function(){b.position()})};
app.tabs.brand=function(){this.text=$.i18n.prop("brands");this.tip=$.i18n.prop("manage.brands");this.ui_class="brands";this.ajax_url=app.baseUrl+"brandAdmin/loadAppView";app.tabs.brand._super.constructor.apply(this,arguments)};app.ribbons.web_commerce.push({text:$.i18n.prop("brands"),processor:app.tabs.brand,ui_class:"brand"});app.tabs.brand.inherit(app.SingleTableTab);var _b=app.tabs.brand.prototype;_b.advanceSearchUrl=app.baseUrl+"brandAdmin/advanceFilter";_b.advanceSearchTitle=$.i18n.prop("brand");
_b.sortable={list:{1:"name",3:"url"},sorted:"1",dir:"up"};_b.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"delete"}];_b.action_menu_entries=[{text:$.i18n.prop("create.brand"),ui_class:"create-brand",action:"create-brand"}];_b.onActionClick=function(a,b){switch(a){case "edit":this.editBrand(b.id,b.name);break;case "delete":this.deleteBrand(b.id,b.name)}};_b.onSelectedActionClick=function(a,b){switch(a){case "remove":this.deleteSelectedBrands(b.collect("id"))}};
(function(){function a(){var a=this;this.on_global("product-updated",function(b){a.reload()});this.on_global("brand-restore",function(){a.reload()});this.on("close",function(){app.tabs.brand.tab=null});app.global_event.on("default-image-update",function(){app.Tab.getTab("tab-brand").reload()});a.body.find(".toolbar .create").on("click",function(){a.createBrand()})}_b.init=function(){app.tabs.brand._super.init.call(this);app.tabs.brand.tab=this;a.call(this)};app.global_event.on("after-ribbon-render",
function(a,d){app.isPermitted("brand.view.list")?d.enable("brand"):d.disable("brand")})})();
_b.editBrand=function(a,b,d){var c={id:a},f=$.i18n.prop("edit.brand");"undefined"==typeof a&&(c={},b="",f=$.i18n.prop("create.brand"));d||(d=this);d.renderCreatePanel(app.baseUrl+"brandAdmin/edit",f,b,c,{success:function(){app.tabs.brand.tab&&app.tabs.brand.tab.reload();a?app.global_event.trigger("brand-update",[a]):app.global_event.trigger("brand-create")},content_loaded:function(b){app.tabs.brand.editContentLoaded(b,a)}})};
app.navigation_item_ref_create_func.brand=app.tabs.brand.editBrand=_b.createBrand=_b.editBrand;app.tabs.brand.editContentLoaded=function(a,b){bm.metaTagEditor(a.find("#bmui-tab-metatag"))};_b.deleteBrand=function(a,b){var d=this;bm.remove("brand","Brand",$.i18n.prop("confirm.delete.brand",[b]),app.baseUrl+"brandAdmin/delete",a,{success:function(){d.reload()}})};app.tabs.brand.viewProducts=function(a){bm.viewPopup(app.baseUrl+"brandAdmin/viewProducts",{id:a},{width:550})};
_b.deleteSelectedBrands=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.brand"),function(){bm.ajax({url:app.baseUrl+"brandAdmin/deleteSelected",data:{ids:a},success:function(){b.reload();app.global_event.trigger("send-trash",["page",a]);b.body.find(".action-header").hide()}})},function(){})};
app.tabs.currency=function(){this.text=$.i18n.prop("currencies");this.tip=$.i18n.prop("manage.currencies");this.ui_class="currencies";this.ajax_url=app.baseUrl+"currencyAdmin/loadAppView";app.tabs.currency._super.constructor.apply(this,arguments)};app.ribbons.web_commerce.push({text:$.i18n.prop("currency"),processor:app.tabs.currency,ui_class:"currency"});app.tabs.currency.inherit(app.SingleTableTab);_c=app.tabs.currency.prototype;_c.sortable={list:{1:"name",2:"code"},sorted:"1",dir:"up"};
_c.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"delete"},{text:$.i18n.prop("set.base.currency"),ui_class:"set-base-currency",action:"set-base-currency"}];
_c.onMenuOpen=function(a){a.is("tr.base-currency span")?(this.tabulator.menu.find(".menu-item.set-base-currency").addClass("disabled"),this.tabulator.menu.find(".menu-item.delete").addClass("disabled")):(this.tabulator.menu.find(".menu-item.set-base-currency").removeClass("disabled"),this.tabulator.menu.find(".menu-item.delete").removeClass("disabled"));a.is("tr.inactive span")&&this.tabulator.menu.find(".menu-item.set-base-currency").addClass("disabled")};
_c.onActionClick=function(a,b){switch(a){case "edit":this.editCurrency(b.id,b.name);break;case "delete":this.deleteCurrency(b.id,b.name);break;case "set-base-currency":this.setBaseCurrency(b.id,b.name)}};
(function(){function a(){function a(){d.reload()}var d=this;d.body.find(".toolbar .create").on("mousedown",function(){d.editCurrency()});this.on_global("currency-update",a);this.on_global("currency-create",a);this.on_global("currency-delete",a);this.on("close",function(){app.tabs.currency.tab=null})}_c.init=function(){app.tabs.currency._super.init.call(this);app.tabs.currency.tab=this;a.call(this)};app.global_event.on("after-ribbon-render",function(a,d){app.isPermitted("currency.view.list")?d.enable("currency"):
d.disable("currency")})})();_c.editCurrency=function(a,b){var d={id:a},c=a?$.i18n.prop("edit.currency"):$.i18n.prop("create.currency");this.renderCreatePanel(app.baseUrl+"currencyAdmin/edit",c,a?b:"",d,{success:function(){a?app.global_event.trigger("currency-update",[a]):app.global_event.trigger("currency-create")}})};
_c.deleteCurrency=function(a,b){bm.remove("currency","Currency",$.i18n.prop("confirm.delete.currency",[b]),app.baseUrl+"currencyAdmin/delete",a,{success:function(){app.global_event.trigger("currency-delete",[a])}})};_c.onSelectedActionClick=function(a,b){switch(a){case "remove":this.deleteSelectedCurrencies(b.collect("id"))}};
_c.deleteSelectedCurrencies=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.currencies"),function(){bm.ajax({url:app.baseUrl+"currencyAdmin/delete",data:{id:a},success:function(){app.global_event.trigger("currency-delete",a);b.body.find(".action-header").hide()}})},function(){})};_c.setBaseCurrency=function(a,b){bm.ajax({url:app.baseUrl+"currencyAdmin/setBaseCurrency",data:{id:a,name:b},success:function(){app.global_event.trigger("currency-update",[a])}})};
app.tabs.item=function(){this.constructor_args=arguments;this.text=$.i18n.prop("products");this.tip=$.i18n.prop("manage.products");this.ui_class="products";app.tabs.item._super.constructor.apply(this,arguments)};var _i=app.tabs.item.inherit(app.ExplorerPanelTab);_i.sortBtnEnable=!1;
(function(){function a(){var a=this;this.on_global(["product-restore","category-restore"],function(){a.reload()});this.filterList();this.body.on("click",".actions-column .move-controls span",function(){var b=$(this),c=b.closest("td").find(".action-navigator").attr("data-id");a.orderTarget=c;a.orderAction=b.attr("order-dir");a.reload();a.orderAction=a.orderTarget=null});this.on_global("default-image-update",function(){var b=a.body.find(".category .image img").attr("src");$('<img src="'+b+'">').clearCache(function(){(b=
a.body.find(".product .image img").attr("src"))?$('<img src="'+b+'">').clearCache(function(){app.Tab.getTab("tab-product").reload()}):app.Tab.getTab("tab-product").reload()})})}_i.init=function(){app.tabs.item._super.init.call(this);a.call(this)};app.global_event.on("after-ribbon-render",function(a,d){app.isPermitted("product.view.list")&&app.isPermitted("category.view.list")?d.enable("item"):d.disable("item")})})();
_i.filterList=function(){var a=this;this.body.find(".category-selector").change(function(){a instanceof app.tabs.item.product&&(""==$(this).val()?(a.tabulator.sortRemove("8"),a.sortBtnEnable=!1):(a.tabulator.sortAdd("8","idx"),a.sortBtnEnable=!0));a.body.find(".search-form").trigger("submit")});this.body.find(".type-selector").change(function(){a.body.find(".search-form").trigger("submit")})};_i.onSwitchMenuClick=function(a){app.Tab.changeView(this,"item",a,app.tabs.item.ribbon_data.supers[a])};
_i.afterCellEdit=function(a,b){var d=this;bm.ajax({url:app.baseUrl+(this instanceof app.tabs.item.product?"product":"category")+"Admin/changeOrder",data:{id:a.attr("entity-id"),value:b},complete:function(){d.reload()}})};_i.switch_menu_entries=[{text:$.i18n.prop("categories"),ui_class:"view-switch category",action:"category"},{text:$.i18n.prop("products"),ui_class:"view-switch product",action:"product"}];
_i.action_menu_entries=[{text:$.i18n.prop("import.product.and.category"),ui_class:"import",action:"import"},{text:$.i18n.prop("export.product.and.category"),ui_class:"export",action:"export"},{ui_class:"item-separator"},{text:$.i18n.prop("manage.product.owner.permissions"),ui_class:"manage-owner-permissions product-permissions",action:"manage-product-owner-permissions",license:CONSTANTS.LICENSES.ACL},{text:$.i18n.prop("manage.category.owner.permissions"),ui_class:"manage-owner-permissions category-permissions",
action:"manage-category-owner-permissions",license:CONSTANTS.LICENSES.ACL}];_i.create_menu_entries=[{text:$.i18n.prop("create.product"),ui_class:"create-product",action:"create-product"},{text:$.i18n.prop("create.category"),ui_class:"create-category",action:"create-category"},{text:$.i18n.prop("create.combined.product"),ui_class:"create-combined-product",action:"create-combined-product"}];
_i.onCreateMenuClick=function(a){switch(a){case "create-product":if(this instanceof app.tabs.item.explorer)var b=this.treePanel.find(".body").tree("inst").activeNode.data.id;this.createProduct(!1,b);break;case "create-category":this instanceof app.tabs.item.explorer&&(b=this.treePanel.find(".body").tree("inst").activeNode.data.id);this.createCategory(b);break;case "create-combined-product":this instanceof app.tabs.item.explorer&&(b=this.treePanel.find(".body").tree("inst").activeNode.data.id),this.createProduct(!0,
b)}};_i.onActionMenuClick=function(a,b){switch(a){case "save-order":this.saveOrder("product");break;case "import":this.initImportWindow();break;case "export":this.exportProductAndCategory();break;case "manage-product-owner-permissions":this.manageProductOwnerPermissions();break;case "manage-category-owner-permissions":this.manageCategoryOwnerPermissions()}};_i.saveOrder=function(a){var b=this;a+="Admin/saveCurrentOrder";var d=$.extend({},b.currentSort);bm.ajax({url:a,data:d,success:function(){b.reload()}})};
_i.actionMenuClick=function(a,b){switch(a){case "addProduct":this.createProduct(!1,b.id);break;case "addSubcategory":this.createCategory(b.id);break;case "editProduct":this.editProduct(b.id,b.name);break;case "copyProduct":this.copyProduct(b.id);break;case "viewInSiteProduct":window.open(app.siteBaseUrl+"product/"+b.url+"?adminView=true");break;case "deleteProduct":this.deleteProduct(b.id,b.name);break;case "editCategory":this.editCategory(b.id,b.name);break;case "viewInSiteCategory":window.open(app.siteBaseUrl+
"category/"+b.url+"?adminView=true");break;case "deleteCategory":this.deleteCategory(b.id,b.name);break;case "createCombined":this.createCombined(b.id,b.name);break;case "productPermission":this.manageProductEntityPermission(b.id,b.name);break;case "categoryPermission":this.manageCategoryEntityPermission(b.id,b.name)}};_i.onActionClick=function(){4==arguments.length?this.actionMenuClick(arguments[1],arguments[2]):this.actionMenuClick(arguments[0],arguments[1])};
_i.onMenuOpen=function(a,b){var d=[{key:"product.edit.properties",class:"edit",isEntity:!0},{key:"product.create",class:"copy-product"},{key:"product.remove",class:"delete",isEntity:!0},{key:"product.edit.permission",class:"manage-permission.product-permission",isEntity:!0}],c=[{key:"category.edit",class:"edit",isEntity:!0},{key:"category.create",class:"add-sub-category"},{key:"product.create",class:"add-product"},{key:"category.remove",class:"delete",isEntity:!0},{key:"category.edit.permission",
class:"manage-permission.category-permission",isEntity:!0}];if("product"==a||"combined"==a){var f=this.explorer.menu[a];var g=d}else"category"==a?(f=this.explorer.menu[a],g=c):(f=this.tabulator.menu,b=a.config("entity"),"product"==b.type?g=d:"category"==b.type&&(g=c));app.checkPermission(f,g,b)};
_i.checkPermissionForImportExport=function(a){app.isPermitted("product.import.excel",{})&&app.isPermitted("category.import.excel",{})?a.enable("import"):a.disable("import");app.isPermitted("product.export.excel",{})&&app.isPermitted("category.export.excel",{})?a.enable("export"):a.disable("export")};
_i.onActionMenuOpen=function(){var a=this.action_menu;this.sortBtnEnable?a.enable("save-order"):a.disable("save-order");app.checkPermission(a,[{key:"product.create",class:"create-product"},{key:"category.create",class:"create-category"},{key:"product.create",class:"create-combined-product"},{key:"category.edit.permission",class:"manage-owner-permissions.category-permissions"},{key:"product.edit.permission",class:"manage-owner-permissions.product-permissions"},{key:"product.view.list",class:"product, .combined"},
{key:"category.view.list",class:"category"}]);this.checkPermissionForImportExport(a)};_i.editProduct=function(a,b,d){d||(d=this);(new app.editProduct(d,{id:a,name:b})).init()};_i.editCategory=function(a,b,d){d||(d=this);(new app.editCategory(d,{id:a,name:b})).init()};app.tabs.item.editProduct=_i.editProduct;app.tabs.item.editCategory=_i.editCategory;
_i.createProduct=function(a,b){var d=this,c={property:"basic",target:"create",isCombined:a};b&&(c.categoryId=b);a=a?$.i18n.prop("create.combined.product"):$.i18n.prop("create.product");this.renderCreatePanel(app.baseUrl+"productAdmin/loadProductProperties",a,null,c,{width:930,success:function(a){app.global_event.trigger("product-create");d.editProduct(a.id,a.name)},content_loaded:function(){var a=this.find("form");this.find(".select-customer").on("click",function(){bm.customerAndGroupSelectionPopup(a,
{})});var b=bm.getUUID();this.find("#prodAvailFrom").attr("id",b);this.find("#prodAvailTo").attr("validation","skip@if{self::hidden} either_required["+b+","+$.i18n.prop("from")+" ,"+$.i18n.prop("to")+"]")}})};
_i.createCategory=function(a){var b={property:"basic",target:"create"};a&&(b.categoryId=a);this.renderCreatePanel(app.baseUrl+"categoryAdmin/loadCategoryProperties",$.i18n.prop("create.category"),null,b,{width:920,success:function(){a?app.global_event.trigger("category-update"):app.global_event.trigger("category-create")},content_loaded:function(){var a=this.find("form");this.find(".select-customer").on("click",function(){bm.customerAndGroupSelectionPopup(a,{})});var b=bm.getUUID();this.find("#catAvailFrom").attr("id",
b);this.find("#catAvailTo").attr("validation","skip@if{self::hidden} either_required["+b+","+$.i18n.prop("from")+" ,"+$.i18n.prop("to")+"]")}})};app.navigation_item_ref_create_func.category=_i.createCategory;app.navigation_item_ref_create_func.product=_i.createProduct;
_i.initImportWindow=function(){var a=this,b;this.renderCreatePanel(app.baseUrl+"itemImport/uploadFileView",$.i18n.prop("Import Product And Category"),"",void 0,{width:220,success:function(b){a.configImportedDataMap(b.html)},content_loaded:function(a,c){b=c;b.find("[name=itemImportFile]").on("change",function(){b.submit()})},beforeSubmit:function(a){a.loader()},error:function(){b.find(".single-file-without-preview").removeClass("file-added");b.loader(!1)}})};
_i.configImportedDataMap=function(a){this.renderCreatePanel(void 0,$.i18n.prop("Import Product And Category"),"",void 0,{width:495,draggable:!1,content_loaded:function(a){function b(a){m.val(a)}var c=a.find("[name=productImagePath]"),f=a.find("[name=productVideoPath]"),g=a.find("[name=categoryImagePath]"),m;c.on("focus",function(){m=c;bm.selectFromAssetLibrary($.i18n.prop("select.your.image.path"),b,void 0,{},!1)});f.on("focus",function(){m=f;bm.selectFromAssetLibrary($.i18n.prop("select.your.video.path"),
b,void 0,{},!1)});g.on("focus",function(){m=g;bm.selectFromAssetLibrary($.i18n.prop("select.your.image.path"),b,void 0,{},!1)});a.find(".product-work-sheet").change(function(){var b=a.find(".product-work-sheet").val();bm.ajax({url:app.baseUrl+"itemImport/productMappingFields",dataType:"html",data:{workSheetName:b},success:function(b){a.find("#product-mapping-wrap").replaceWith(b);a.find("#product-mapping-wrap").updateUi()}})});a.find(".category-work-sheet").change(function(){var b=a.find(".category-work-sheet").val();
bm.ajax({url:app.baseUrl+"itemImport/categoryMappingFields",dataType:"html",data:{workSheetName:b},success:function(b){a.find("#category-mapping-wrap").html(b).updateUi()}})})},success:function(a){a={token:a.token,name:a.name,detail_url:app.baseUrl+"itemImport/progressView",detail_status_url:app.baseUrl+"itemImport/progressStatus",detail_viewer:app.tabs.item.import_status_viewer};TaskManager.createTask(a);bm.taskPopup(app.baseUrl+"itemImport/progressView",a,{width:800,clazz:"task-popup item-import"})},
content:a})};
app.tabs.item.import_status_viewer={init:function(a){a=a.getDom();this.categoryProgressBar=new ProgressBar(a.find(".category-progress"));this.productProgressBar=new ProgressBar(a.find(".product-progress"));this.totalProgressBar=new ProgressBar(a.find(".total-progress"));this.categoryProgressBar.render();this.productProgressBar.render();this.totalProgressBar.render()},update:function(a,b){var d=a.getDom();this.categoryProgressBar.setPosition(b.categoryProgress);this.productProgressBar.setPosition(b.productProgress);this.totalProgressBar.setPosition(b.totalProgress);
d.find(".category-progress-count").text(b.categoryProgress+"%");d.find(".category-record-complete").text(b.categoryComplete);d.find(".category-record-total").text(b.totalCategoryRecord);d.find(".category-success-count").text(b.categorySuccessCount);d.find(".category-warning-count").text(b.categoryWarningCount);d.find(".category-error-count").text(b.categoryErrorCount);d.find(".product-progress-count").text(b.productProgress+"%");d.find(".product-record-complete").text(b.productComplete);d.find(".product-record-total").text(b.totalProductRecord);
d.find(".product-success-count").text(b.productSuccessCount);d.find(".product-warning-count").text(b.productWarningCount);d.find(".product-error-count").text(b.productErrorCount);d.find(".total-progress-count").text(b.totalProgress+"%");d.find(".total-record-complete").text(b.recordComplete);d.find(".total-record-total").text(b.totalRecord);d.find(".total-success-count").text(b.totalSuccessCount);d.find(".total-warning-count").text(b.totalWarningCount);d.find(".total-error-count").text(b.totalErrorCount);
"aborted"==b.status&&(d.find(".item-import-aborted").show(),d.find(".category-progress .progress-bar .completed").addClass(b.status),d.find(".product-progress .progress-bar .completed").addClass(b.status),d.find(".total-progress .progress-bar .completed").addClass(b.status));if(100==b.totalProgress){var c=app.Tab.getTab("tab-item");c&&c.reload();this.activeLogSummaryLink(d,b.token);d.find(".content").append('<div class="button-line"><button type="button" class="button close-button">'+$.i18n.prop("close")+
'</button> &nbsp; <a type="button" target="_blank" class="button download-button" href="'+app.baseUrl+"itemImport/download?token="+b.token+'">'+$.i18n.prop("download")+"</a></div>");d.find(".close-button").click(function(){a.close()})}},activeLogSummaryLink:function(a,b){var d=this;a.find(".total-success-count").addClass("link").click(function(){d.fetchLogSummary(a,b,"success")});a.find(".total-warning-count").addClass("link").click(function(){d.fetchLogSummary(a,b,"warning")});a.find(".total-error-count").addClass("link").click(function(){d.fetchLogSummary(a,
b,"error")})},fetchLogSummary:function(a,b,d){bm.ajax({url:app.baseUrl+"itemImport/"+d+"LogSummary",dataType:"html",data:{token:b},success:function(b){a.find(".log-summary").html(b).updateUi()}})}};
_i.exportProductAndCategory=function(){var a,b='<form class="item-export-download" style="display: none" action="'+app.baseUrl+'itemExport/download"> <input type="hidden" name="fileName"></form>';b=$(b);bm.editPopup(app.baseUrl+"itemExport/initExport",$.i18n.prop("export.product.and.category"),void 0,{},{width:430,events:{content_loaded:function(b){function c(a){return"checked"!=g.checkbox("state")&&"checked"!=m.checkbox("state")?(bm.notify($.i18n.prop("can.not.deselect.both"),"alert"),a.checkbox("state",
"checked"),!1):!0}a=this;var d=a.find(".bmui-tab"),g=a.find("[name='exportProduct']"),m=a.find("[name='exportCategory']");g.on("change",function(){var a=$(this);c(a)&&("checked"!=a.checkbox("state")?(d.tabify("activate","category"),d.tabify("disable","product")):d.tabify("enable","product"))});m.change(function(){var a=$(this);c(a)&&("checked"!=a.checkbox("state")?(d.tabify("activate","product"),d.tabify("disable","category")):d.tabify("enable","category"))})}},beforeSubmit:function(a,b,f){setTimeout(function(){f.close()},
5E3)}})};_i.manageProductOwnerPermissions=function(){bm.permissionPopup($.i18n.prop("manage.owner.permissions"),$.i18n.prop("product"),{for:"owner",type:"product"})};_i.manageCategoryOwnerPermissions=function(){bm.permissionPopup($.i18n.prop("manage.owner.permissions"),$.i18n.prop("category"),{for:"owner",type:"category"})};_i.createCombined=function(){app.tabs.item.createProduct(!0)};_i.createCollection=_i.createCombined;
_i.copyProduct=function(a){var b=this;bm.ajax({url:app.baseUrl+"productAdmin/copyProduct",data:{id:a},success:function(){app.global_event.trigger("product-create");b.reload(!0)}})};
_i.deleteProduct=function(a,b,d){var c=this;app.Tab.getTab("tab-edit-product-"+a)?bm.notify($.i18n.prop("product.opened.editor.try.again"),"error"):bm.remove("product",$.i18n.prop("product"),$.i18n.prop("confirm.delete.product",[b]),app.baseUrl+"productAdmin/deleteProduct",a,{success:function(){app.global_event.trigger("product-delete",[a]);c.reload(!0)}})};
_i.deleteSelectedProducts=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.product"),function(){bm.ajax({url:app.baseUrl+"productAdmin/deleteSelected",data:{ids:a},success:function(){b.reload();app.global_event.trigger("send-trash",["product",a]);b.body.find(".action-header").hide()}})},function(){})};_i.viewCategory=function(a){bm.viewPopup(app.baseUrl+"categoryAdmin/view",{id:a},{width:800})};
app.tabs.item.viewProduct=function(a){bm.viewPopup(app.baseUrl+"productAdmin/view",{id:a},{width:800})};_i.deleteCategory=function(a,b){var d=this;bm.remove("category",$.i18n.prop("category"),$.i18n.prop("confirm.delete.category",[b]),app.baseUrl+"categoryAdmin/deleteCategory",a,{success:function(){d.reload()}})};
_i.deleteSelectedCategories=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.category"),function(){bm.ajax({url:app.baseUrl+"categoryAdmin/deleteSelected",data:{ids:a},success:function(){b.reload();app.global_event.trigger("send-trash",["category",a]);b.body.find(".action-header").hide()}})},function(){})};
_i.bulkEdit=function(a){var b=app.Tab.getTab("tab-category-bulk-editor");b?bm.notify($.i18n.prop("category.bulk.editor.open.already"),"alert"):(b=new app.tabs.categoryBulkEditor({categoryIds:a,id:"tab-category-bulk-editor"}),b.render(),b.setActive())};_i.manageProductEntityPermission=function(a,b){bm.permissionPopup($.i18n.prop("manage.permissions"),b,{id:a,for:"entity",type:"product"})};
_i.manageCategoryEntityPermission=function(a,b){bm.permissionPopup($.i18n.prop("manage.permissions"),b,{id:a,for:"entity",type:"category"})};
_i.beforeReloadRequest=function(a){app.tabs.item._super.beforeReloadRequest.call(this,a);var b=this.body.find("select.category-selector"),d=this.body.find("select.type-selector");this.advanceSearchFilter&&(b.chosen("val",a.parent),d.chosen("val",a.productType));var c=this.orderTarget?{orderTarget:this.orderTarget,orderAction:this.orderAction}:{};$.extend(a,{parent:b.val(),productType:d.val()},c);a.sort&&(this.currentSort={sort:a.sort,dir:a.dir,parent:a.parent})};
_i.clearFilters=function(){this.body.find("select.category-selector").chosen("val","")};_i.afterTableReload=function(){var a=this.currentSort,b=this.body.find(".save-order");a?"idx"!=a.sort&&""!=a.parent?b.show():b.hide():b.hide();this.body.find(".tool-group.action-header").hide()};app.tabs.item.product=function(){app.tabs.item.product._super.constructor.apply(this,arguments)};app.tabs.item.product.inherit(app.tabs.item);_p=app.tabs.item.product.prototype;
(function(){function a(){var a=this;this.on_global(["product-create","product-delete","product-update","product-restore"],function(){a.reload(!0)});a.body.find(".toolbar .create").on("click",function(){a.createProduct()})}_p.init=function(){app.tabs.item.product._super.init.call(this);a.call(this)}})();_p.switch_menu_entries=[{text:$.i18n.prop("categories"),ui_class:"view-switch category",action:"category"},{text:$.i18n.prop("explorer.view"),ui_class:"view-switch explorer",action:"explorer"}];
_p.action_menu_entries=[{text:$.i18n.prop("save.ordering"),ui_class:"save save-order",action:"save-order"},{ui_class:"item-separator"},{text:$.i18n.prop("import.product.and.category"),ui_class:"import",action:"import"},{text:$.i18n.prop("export.product.and.category"),ui_class:"export",action:"export"},{ui_class:"item-separator"},{text:$.i18n.prop("manage.product.owner.permissions"),ui_class:"manage-owner-permissions product-permissions",action:"manage-product-owner-permissions",license:CONSTANTS.LICENSES.ACL}];
_p.ajax_url=app.baseUrl+"itemAdmin/loadProductView";_p.advanceSearchUrl=app.baseUrl+"itemAdmin/productAdvanceFilter";_p.advanceSearchTitle=$.i18n.prop("product");_p.sortable={list:{1:"name",2:"sku",3:"basePrice",4:"availableStock",5:"isAvailable",6:"created",7:"updated"},sorted:"2",dir:"up"};
_p.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit",action:"editProduct"},{text:$.i18n.prop("copy"),ui_class:"copy",action:"copyProduct"},{text:$.i18n.prop("view.in.site"),ui_class:"view-in-site",action:"viewInSiteProduct"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"deleteProduct"},{text:$.i18n.prop("permission"),ui_class:"manage-permission product-permission",action:"productPermission"}];
_p.onSelectedActionClick=function(a,b){switch(a){case "remove":this.deleteSelectedProducts(b.collect("id"));break;case "bulkEdit":this.bulkEdit(b.collect("id"))}};_p.bulkEdit=function(a){var b=app.Tab.getTab("tab-product-bulk-editor");b?bm.notify($.i18n.prop("product.bulk.editor.open.already"),"alert"):(b=new app.tabs.productBulkEditor({productIds:a,id:"tab-product-bulk-editor"}),b.render(),b.setActive())};app.tabs.item.category=function(){app.tabs.item.category._super.constructor.apply(this,arguments)};
app.tabs.item.category.inherit(app.tabs.item);_c=app.tabs.item.category.prototype;_c.ajax_url=app.baseUrl+"itemAdmin/loadCategoryView";_c.advanceSearchUrl=app.baseUrl+"itemAdmin/categoryAdvanceFilter";_c.advanceSearchTitle=$.i18n.prop("category");
(function(){function a(){var a=this;this.on_global(["category-create","category-update","category-delete"],function(){bm.updateCategorySelector(a.body.find(".category-selector"),"webcommerce.Category");a.reload()});this.body.find(".toolbar .create").on("click",function(){a.createCategory()})}_c.init=function(){app.tabs.item.category._super.init.call(this);a.call(this)}})();
_c.switch_menu_entries=[{text:$.i18n.prop("products"),ui_class:"view-switch product",action:"product"},{text:$.i18n.prop("explorer.view"),ui_class:"view-switch explorer",action:"explorer"}];
_c.action_menu_entries=[{text:$.i18n.prop("import.product.and.category"),ui_class:"import",action:"import"},{text:$.i18n.prop("export.product.and.category"),ui_class:"export",action:"export"},{ui_class:"item-separator"},{text:$.i18n.prop("manage.category.owner.permissions"),ui_class:"manage-owner-permissions category-permissions",action:"manage-category-owner-permissions",license:CONSTANTS.LICENSES.ACL}];
_c.sortable={list:{1:"availableFor",2:"name",3:"sku",5:"created",6:"updated",8:"idx"},sorted:"2",dir:"up"};
_c.menu_entries=[{text:$.i18n.prop("add.product"),ui_class:"add-product",action:"addProduct"},{text:$.i18n.prop("add.subcategory"),ui_class:"add-sub-category",action:"addSubcategory"},{text:$.i18n.prop("edit"),ui_class:"edit",action:"editCategory"},{text:$.i18n.prop("view.in.site"),ui_class:"view-in-site",action:"viewInSiteCategory"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"deleteCategory"},{text:$.i18n.prop("permission"),ui_class:"manage-permission category-permission",action:"categoryPermission"}];
_c.onSelectedActionClick=function(a,b){switch(a){case "remove":this.deleteSelectedCategories(b.collect("id"));break;case "bulkEdit":this.bulkEdit(b.collect("id"))}};app.tabs.item.explorer=function(){app.tabs.item.explorer._super.constructor.apply(this,arguments)};_e=app.tabs.item.explorer.inherit(app.tabs.item);
app.ribbons.web_commerce.push(app.tabs.item.ribbon_data={text:$.i18n.prop("products"),ui_class:"item",processor:app.tabs.item.explorer,views:[{ui_class:"category",text:$.i18n.prop("category"),permission:"category.view.list"},{ui_class:"product",text:$.i18n.prop("product"),permission:"product.view.list"}],supers:{explorer:"ExplorerPanelTab",category:"SingleTableTab",product:"SingleTableTab"}});_e.ajax_url=app.baseUrl+"itemAdmin/loadExplorerView";_e.explorer_url=app.baseUrl+"itemAdmin/explorePanel";
_e.menu_entries={category:_c.menu_entries,product:_p.menu_entries,combined:_p.menu_entries};_e.tree_node_load_url=app.baseUrl+"itemAdmin/categoryTree";_e.root_node_name=$.i18n.prop("root.category");_e.advanceSearchUrl=app.baseUrl+"itemAdmin/explorerAdvanceFilter";
(function(){function a(){var a=this;this.on_global("category-create product-create category-update product-update category-image-change product-image-change".split(" "),function(){a.reload()})}_e.init=function(){app.tabs.item.explorer._super.init.call(this);a.call(this)}})();
app.tabs.manufacturer=function(){this.text=$.i18n.prop("manufacturers");this.tip=$.i18n.prop("manage.manufacturers");this.ui_class="manufacturers";this.ajax_url=app.baseUrl+"manufacturerAdmin/loadAppView";app.tabs.manufacturer._super.constructor.apply(this,arguments)};app.ribbons.web_commerce.push({text:$.i18n.prop("manufacturers"),processor:app.tabs.manufacturer,ui_class:"manufacturer"});app.tabs.manufacturer.inherit(app.SingleTableTab);_m=app.tabs.manufacturer.prototype;
_m.advanceSearchUrl=app.baseUrl+"manufacturerAdmin/advanceFilter";_m.advanceSearchTitle=$.i18n.prop("manufacturer");_m.sortable={list:{1:"name",3:"url"},sorted:"1",dir:"up"};_m.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"delete"}];_m.onActionClick=function(a,b){switch(a){case "edit":this.editManufacturer(b.id,b.name);break;case "delete":this.deleteManufacturer(b.id,b.name)}};_m.onSelectedActionClick=function(a,b){switch(a){case "remove":this.deleteSelectedManufacturers(b.collect("id"))}};
(function(){function a(){var a=this;a.body.find(".toolbar .create").on("click",function(){a.createManufacturer()});this.on_global("product-update",function(){a.reload()});this.on_global("manufacturer-restore",function(){a.reload()});this.on("close",function(){app.tabs.manufacturer.tab=null});app.global_event.on("default-image-update",function(){app.Tab.getTab("tab-manufacturer").reload()})}_m.init=function(){app.tabs.manufacturer._super.init.call(this);app.tabs.manufacturer.tab=this;a.call(this)};
app.global_event.on("after-ribbon-render",function(a,d){app.isPermitted("manufacturer.view.list")?d.enable("manufacturer"):d.disable("manufacturer")})})();
_m.editManufacturer=function(a,b,d){var c={id:a},f=$.i18n.prop("edit.manufacturer");"undefined"==typeof a&&(c={},b="",f=$.i18n.prop("create.manufacturer"));d||(d=this);d.renderCreatePanel(app.baseUrl+"manufacturerAdmin/edit",f,b,c,{success:function(){app.tabs.manufacturer.tab&&app.tabs.manufacturer.tab.reload();a?app.global_event.trigger("manufacturer-update",[a]):app.global_event.trigger("manufacturer-create")},content_loaded:function(b){app.tabs.manufacturer.editContentLoaded(b,a)}})};
app.navigation_item_ref_create_func.manufacturer=app.tabs.manufacturer.editManufacturer=_m.createManufacturer=_m.editManufacturer;app.tabs.manufacturer.editContentLoaded=function(a,b){bm.metaTagEditor(a.find("#bmui-tab-metatag"))};app.tabs.manufacturer.viewProducts=function(a){bm.viewPopup(app.baseUrl+"manufacturerAdmin/viewProducts",{id:a},{width:500})};
_m.deleteManufacturer=function(a,b){var d=this;bm.remove("manufacturer","Manufacturer",$.i18n.prop("confirm.delete.manufacturer",[b]),app.baseUrl+"manufacturerAdmin/delete",a,{success:function(){d.reload()}})};
_m.deleteSelectedManufacturers=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.manufacturer"),function(){bm.ajax({url:app.baseUrl+"manufacturerAdmin/deleteSelected",data:{ids:a},success:function(){b.reload();app.global_event.trigger("send-trash",["manufacturer",a]);b.body.find(".action-header").hide()}})},function(){})};
app.tabs.newsletterView=function(){this.constructor_args=arguments;this.text=$.i18n.prop("newsletters");this.tip=$.i18n.prop("manage.newsletters");this.ui_class="newsletters";app.tabs.newsletterView._super.constructor.apply(this,arguments)};var _nv=app.tabs.newsletterView.inherit(app.SingleTableTab);(function(){_nv.init=function(){app.tabs.newsletterView._super.init.call(this)}})();_nv.onSwitchMenuClick=function(a){app.Tab.changeView(this,"newsletterView",a)};
app.tabs.newsletterView.newsletter=function(){app.tabs.newsletterView.newsletter._super.constructor.apply(this,arguments)};var _n=app.tabs.newsletterView.newsletter.inherit(app.tabs.newsletterView);
(function(){function a(){var a=this;this.body.find(".toolbar .create").on("mousedown",function(){a.createNewsletter()});this.on("close",function(){app.tabs.newsletterView.newsletter.tab=null})}_n.init=function(){app.tabs.newsletterView.newsletter._super.init.call(this);app.tabs.newsletterView.newsletter.tab=this;a.call(this)};app.global_event.on("after-ribbon-render",function(a,d){app.isPermitted("newsletter.view.list")?d.enable("newsletterView"):d.disable("newsletterView")})})();
app.ribbons.web_marketing.push({text:$.i18n.prop("newsletter"),processor:app.tabs.newsletterView.newsletter,ui_class:"newsletterView",views:[{ui_class:"newsletter",text:$.i18n.prop("newsletter")},{ui_class:"subscriber",text:$.i18n.prop("subscriber")},{ui_class:"unsubscriber",text:$.i18n.prop("unsubscriber")}]});_n.sortable={list:{1:"title"},sorted:"1",dir:"up"};
_n.switch_menu_entries=[{text:$.i18n.prop("subscriber.list"),ui_class:"view-switch subscriber list-view",action:"subscriber"},{text:$.i18n.prop("unsubscriber.list"),ui_class:"view-switch unsubscriber list-view",action:"unsubscriber"}];_n.action_menu_entries=[{text:$.i18n.prop("create.newsletter"),ui_class:"create-newsletter",action:"create.newsletter"}];
_n.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"delete"},{text:$.i18n.prop("send"),ui_class:"newsletterView",action:"send"}];_n.onActionClick=function(a,b){switch(a){case "edit":this.editNewsletter(b.id,b.name);break;case "delete":this.deleteNewsletter(b.id,b.name);break;case "send":this.sendNewsletter(b.id)}};
_n.onSelectedActionClick=function(a,b){switch(a){case "remove":this.deleteSelectedNewsletters(b.collect("id"));break;case "administrativeStatus":this.changeAdministrativeStatus(b);break;case "sendTo":this.sendNewsletter(b.collect("id"))}};_n.ajax_url=app.baseUrl+"newsletter/loadAppView";_n.advanceSearchUrl=app.baseUrl+"newsletter/advanceFilter";_n.advanceSearchTitle=$.i18n.prop("newsletter");
_n.editNewsletter=function(a,b){var d=this,c={id:a},f=$.i18n.prop("edit.newsletter");"undefined"==typeof a&&(c={},b="",f=a?$.i18n.prop("edit.newsletter"):$.i18n.prop("create.newsletter"));this.renderCreatePanel(app.baseUrl+"newsletter/edit",f,b,c,{width:710,success:function(){d.reload();a?app.global_event.trigger("newsletter-update",[a]):app.global_event.trigger("newsletter-create")},error:function(a){a.find(".save-and-send").removeAttr("disabled")},content_loaded:function(b){var c=$(this),d=b.find(".save-and-send");
b.on("lock",function(){d.attr("disabled","disabled")});b.on("unlock",function(){d.removeAttr("disabled")});c.find("input[name='receiver'], .add-receiver").on("click",function(){var b=$(this),d={url:app.baseUrl+"newsletter/receiverSelector"},e=$(this).closest(".form-row");if(b.data("isDirty")){var f={includeAllSubscriber:!1};"true"==c.find("input[name='includeAllSubscriber']").val()&&(f.includeAllSubscriber=!0);d.data=f}else d.data={newsletterId:a};bm.recipientSelectorPopup(e,d,function(a){var d="",
f=[];e.find("[name=includeAllSubscriber]").remove();1==a.find("input[name=includeAllSubscriber]").prop("checked")&&(e.append('<input type="hidden" name="includeAllSubscriber" value="true">'),d="SUBSCRIBER ");a.find("input[name='customer']").each(function(a,b){f.push($(b).val())});f.length&&(d=d+("CUSTOMER["+f.join(",")+"]")+" ");f=[];a.find("input[name='customerGroup']").each(function(a,b){f.push($(b).val())});f.length&&(d=d+("GROUP["+f.join(",")+"]")+" ");f=[];var g=a.find("input[name=recipientEmail]"),
l=a.find("input[name=recipientName]");g.each(function(a,b){f.push($(l[a]).val()+"<"+$(b).val()+">")});f.length&&(d=d+"EMAIL["+f.join(",")+"]");c.find("[name='receiver']").val(d).trigger("blur").trigger("validate");b.data("isDirty",!0)})});c.find(".save-and-send").click(function(){b.append("<input type='hidden' name='sendMail' value='true'/>");b.trigger("submit")})},beforeSubmit:function(a,b){a.find(".save-and-send").attr("disabled","disabled")}})};_n.createNewsletter=_n.editNewsletter;
_n.viewNewsletter=function(a,b){bm.viewPopup(app.baseUrl+"newsletter/view",{id:a},{width:600})};_n.deleteNewsletter=function(a,b){var d=this;bm.confirm($.i18n.prop("confirm.delete.newsletter",[bm.htmlEncode(b)]),function(){bm.ajax({url:app.baseUrl+"newsletter/delete",data:{id:a},success:function(){d.reload()}})},function(){})};
_n.deleteSelectedNewsletters=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.newsletter"),function(){bm.ajax({url:app.baseUrl+"newsletter/deleteSelected",data:{ids:a},success:function(){b.reload();b.body.find(".action-header").hide()}})},function(){})};_n.sendNewsletter=function(a){var b=this;bm.ajax({url:app.baseUrl+"newsletter/sendNewsletter",data:{id:a},success:function(){b.reload()}})};
_n.changeAdministrativeStatus=function(a){bm.editPopup(app.baseUrl+"newsletter/loadNewsletterStatusOption",$.i18n.prop("administrative.status"),null,{},{width:600,events:{content_loaded:function(){var b=$(this),d=a.collect("id");$.each(d,function(a,d){b.find(".edit-popup-form").append('<input type="hidden" name="id" value="'+d+'">')})}}})};app.tabs.newsletterView.subscriber=function(){app.tabs.newsletterView.subscriber._super.constructor.apply(this,arguments)};var _ns=app.tabs.newsletterView.subscriber.inherit(app.tabs.newsletterView);
(function(){_ns.init=function(){app.tabs.newsletterView.subscriber._super.init.call(this)}})();_ns.ajax_url=app.baseUrl+"newsletter/loadSubscriber";_ns.sortable={list:{1:"firstName",2:"email",3:"created"},sorted:"1",dir:"up"};_ns.switch_menu_entries=[{text:$.i18n.prop("newsletter.list"),ui_class:"view-switch newsletter list-view",action:"newsletter"},{text:$.i18n.prop("unsubscriber.list"),ui_class:"view-switch unsubscriber list-view",action:"unsubscriber"}];
_ns.menu_entries=[{text:$.i18n.prop("remove"),ui_class:"delete",action:"delete"}];_ns.onActionClick=function(a,b){switch(a){case "delete":this.delete(b.id,b.name)}};_ns.onSelectedActionClick=function(a,b){switch(a){case "remove":this.deleteSelected(b.collect("id"))}};_ns.advanceSearchUrl=app.baseUrl+"newsletter/advanceSubscriberFilter";_ns.advanceSearchTitle=$.i18n.prop("subscriber");
_ns.delete=function(a,b){var d=this;bm.remove("newsletterSubscriber","NewsletterSubscriber",$.i18n.prop("confirm.delete.subscriber",[b]),app.baseUrl+"newsletter/deleteSubscriber",a,{success:function(){d.reload()},is_final:!0})};_ns.deleteSelected=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.selected.subscriber"),function(){bm.ajax({url:app.baseUrl+"newsletter/deleteSelectedSubscriber",data:{ids:a},success:function(){b.reload()}})},function(){})};
app.tabs.newsletterView.unsubscriber=function(){app.tabs.newsletterView.unsubscriber._super.constructor.apply(this,arguments)};var _nu=app.tabs.newsletterView.unsubscriber.inherit(app.tabs.newsletterView);(function(){_nu.init=function(){app.tabs.newsletterView.unsubscriber._super.init.call(this)}})();_nu.ajax_url=app.baseUrl+"newsletter/loadUnsubscriber";_nu.sortable={list:{1:"s.firstName",2:"s.email",3:"subscribed",4:"unsubscribed"},sorted:"1",dir:"up"};
_nu.switch_menu_entries=[{text:$.i18n.prop("newsletter.list"),ui_class:"view-switch newsletter list-view",action:"newsletter"},{text:$.i18n.prop("subscriber.list"),ui_class:"view-switch subscriber list-view",action:"subscriber"}];_nu.menu_entries=[{text:$.i18n.prop("view.reason"),ui_class:"view view-reason",action:"view-reason"}];_nu.onActionClick=function(a,b){switch(a){case "view-reason":this.viewReason(b.id)}};_nu.advanceSearchUrl=app.baseUrl+"newsletter/advanceUnsubscriberFilter";
_nu.advanceSearchTitle=$.i18n.prop("unsubscriber");_nu.viewReason=function(a){bm.viewPopup(app.baseUrl+"newsletter/viewReason",{id:a},{width:650})};app.tabs.order=function(){this.text=$.i18n.prop("orders");this.tip=$.i18n.prop("manage.orders");this.ui_class="orders";this.ajax_url=app.baseUrl+"order/loadAppView";app.tabs.order._super.constructor.apply(this,arguments)};app.ribbons.web_commerce.push({text:$.i18n.prop("orders"),processor:app.tabs.order,ui_class:"order"});app.tabs.order.inherit(app.SingleTableTab);
_o=app.tabs.order.prototype;_o.sortable={list:{2:"id",4:"created",5:"total"},sorted:"1",dir:"down"};_o.action_menu_entries=[{text:$.i18n.prop("manage.owner.permissions"),ui_class:"manage-owner-permissions order-permissions",action:"manage-owner-permissions"},{text:$.i18n.prop("export"),ui_class:"export",action:"export"}];
_o.onActionMenuClick=function(a){switch(a){case "manage-owner-permissions":this.manageOwnerPermissions();break;case "export":window.open(app.baseUrl+"order/exportOrder"+(this.advanceSearchFilter?"?"+bm.buildQuery(this.advanceSearchFilter):""))}};_o.manageOwnerPermissions=function(){bm.permissionPopup($.i18n.prop("manage.owner.permissions"),$.i18n.prop("order"),{for:"owner",type:"order"})};_o.onActionMenuOpen=function(a){app.checkPermission(a,[{key:"order.edit.permission",class:"manage-owner-permissions"}])};
_o.menu_entries=[{text:$.i18n.prop("manage.shipment"),ui_class:"manage-shipment",action:"manage-shipment"},{text:$.i18n.prop("manage.payment"),ui_class:"manage-payment",action:"manage-payment"},{text:$.i18n.prop("comment.history"),ui_class:"comment-history"},{text:$.i18n.prop("print.order"),ui_class:"print-order"},{text:$.i18n.prop("print.picking.slip"),ui_class:"print-picking-slip"},{text:$.i18n.prop("print.invoice"),ui_class:"print-invoice"},{text:$.i18n.prop("complete.order"),ui_class:"complete-order"},
{text:$.i18n.prop("cancel.order"),ui_class:"cancel-order"}];
_o.onMenuOpen=function(a){var b=this.tabulator.menu;app.checkPermission(b,[{key:"order.view",class:"print-order",isEntity:!0},{key:"order.manage.shipment",class:"manage-shipment",isEntity:!0},{key:"order.manage.payment",class:"manage-payment",isEntity:!0},{key:"order.manage.order",class:"print-order, .complete-order, .cancel-order, .comment-history",isEntity:!0}],a.config("entity"));a.is(".completed")?b.find(".menu-item.complete-order").addClass("disabled"):b.find(".menu-item.complete-order").removeClass("disabled");
a.is(".cancelled")?b.find(".cancel-order, .manage-payment, .manage-shipment").hide():b.find(".cancel-order, .manage-payment, .manage-shipment").show()};
_o.onActionClick=function(a,b){switch(a){case "manage-shipment":this.manageShipment(b.id);break;case "manage-payment":this.managePayment(b.id);break;case "comment-history":this.commentHistory(b.id);break;case "print-order":this.printOrder(b.id,!1);break;case "print-picking-slip":this.printPickingSlip(b.id,!1);break;case "print-invoice":this.printInvoice(b.id,!1);break;case "complete-order":this.changeStatus(b.id,"complete");break;case "cancel-order":this.changeStatus(b.id,"cancel")}};
_o.onSelectedActionClick=function(a,b){switch(a){case "cancel":this.changeStatus(b.collect("id"),"cancel");break;case "sendInvoice":this.sendInvoice(b.collect("id"))}};
(function(){function a(){var a=this;this.body.find(".header .order-status").change(function(){a.body.find(".tool-group.search-form").trigger("submit")});this.on_global(["shipment-added","payment-added","payment-refunded"],function(){a.reload()});a.body.find(".toolbar .create").on("click",function(){a.createOrder()})}_o.init=function(){app.tabs.order._super.init.call(this);a.call(this);this.afterTableReload()}})();
_o.afterTableReload=function(){var a=this,b=a.body;bm.tableToggleRow(a.body);b.find(".edit-shipping-address").on("click",function(){a.changeOrderAddress(this.id,"shipping")});b.find(".edit-billing-address").on("click",function(){a.changeOrderAddress(this.id,"billing")})};_o.changeOrderStatus=function(a,b){var d=this;bm.ajax({url:app.baseUrl+"order/updateOrderStatus",data:{orderId:a,orderStatus:b},success:function(){app.global_event.trigger("order-status-change",[a,b]);d.reload()}})};
_o.changeOrderAddress=function(a,b){var d=this;bm.editPopup(app.baseUrl+"order/changeOrderAddress",$.i18n.prop("order.address.editor"),void 0,{orderId:a,addressType:b},{success:function(){d.reload()},events:{content_loaded:function(){bm.countryChange(this,{stateName:"state.id"});bm.initCityValidator(this.find("[name=postCode]"),null,"state.id")}}})};
_o.managePayment=function(a){var b=app.Tab.getTab("tab-manage-payment-of-order-"+a);b||(b=new app.tabs.managePayment({id:"tab-manage-payment-of-order-"+a,order:{id:a}}),b.render());b.setActive()};
_o.commentHistory=function(a){var b,d,c;bm.editPopup(app.baseUrl+"order/loadCommentView",$.i18n.prop("order.comment.history"),void 0,{orderId:a},{width:700,auto_close_on_success:!1,clazz:"order-comment-popup",events:{content_loaded:function(a,g){b=a=$(this);c=b.find(".comment-area");c.scrollTop(c[0].scrollHeight);d=a.find(".save-and-send");g.on("lock",function(){d.attr("disabled","disabled")});g.on("unlock",function(){d.removeAttr("disabled")});a.find(".save-and-send").click(function(){g.append("<input type='hidden' name='saveNsend' value='true'/>");
d.attr("disabled","disabled");g.trigger("submit")})}},success:function(a,g){"success"==g&&(d.removeAttr("disabled"),a=$("<div class='comment-row admin'><span class='name'>"+$.i18n.prop(a.storeName?a.storeName:$.i18n.prop("admin"))+" </span><span class='date-time-row'><span class='date-time'>"+a.date+"</span><span class='show-comment'>"+a.msg+"</span></span></div>"),b.find("input[name=saveNsend]").remove(),b.find("textarea[name=message]").val(""),c.append(a),c.animate({scrollTop:c[0].scrollHeight},
"slow"))},beforeSubmit:function(a,b,c){a.find(".save-and-send").attr("disabled","disabled")},error:function(){form.find(".save-and-send").removeAttr("disabled");d.removeAttr("disabled");b.find("input[name=saveNsend]").remove()}})};_o.changeStatus=function(a,b){var d=this;bm.confirm($.i18n.prop("confirm."+b+".order"),function(){bm.ajax({url:app.baseUrl+"order/changeStatus",data:{id:a,status:b},success:function(){app.global_event.trigger("order-status-change",[a,b]);d.reload()}})},function(){})};
_o.sendInvoice=function(a){bm.ajax({url:app.baseUrl+"order/sendInvoice",data:{orderId:a}})};_o.manageShipment=function(a){var b=app.Tab.getTab("tab-manage-shipment-of-order-"+a);b||(b=new app.tabs.manageShipment.shipmentInfo({id:"tab-manage-shipment-of-order-"+a,data:{order:{id:a}}}),b.render());b.setActive()};
_o.createPanelTemplate=$('<div class="embedded-edit-form-panel create-panel fade-in-up create-form-editor"><div class="header"><span class="header-title"></span><span class="toolbar toolbar-right"><div class="search-form tool-group customer-search-form" step="1"><input type="text" class="search-text customer-search-text" placeholder="'+$.i18n.prop("search")+'"><button type="button" class="icon-search customer-search-button" onclick="return false"></button></div><div class="search-form tool-group product-search-form" step="2"><input type="text" class="search-text product-search-text" placeholder="'+
$.i18n.prop("search")+'"><button type="button" class="icon-search product-search-button" onclick="return false"></button></div><span class="tool-group toolbar-btn create-customer create" step="1"><i></i>'+$.i18n.prop("create")+'</span><span class="tool-group toolbar-btn nextStep" step="1">'+$.i18n.prop("next")+'</span><span class="tool-group toolbar-btn previousStep" step="2">'+$.i18n.prop("previous")+'</span><span class="tool-group toolbar-btn nextStep" step="2">'+$.i18n.prop("next")+'</span><span class="tool-group toolbar-btn previousStep" step="3">'+
$.i18n.prop("previous")+'</span><span class="tool-group toolbar-btn save" step="3">'+$.i18n.prop("order.now")+'</span><span class="tool-group toolbar-btn cancel">'+$.i18n.prop("cancel")+'</span></span></div><div class="body"></div></div>');
_o.createOrder=function(a,b){a=a?a:$.i18n.prop("create.order");b=b?b:{};var d=this;this.renderCreatePanel(app.baseUrl+"order/create",a,void 0,b,{content_loaded:function(){d.orderCreator=new app.tabs.order.Creator(this,d)},width:850,success:function(){d.reload();app.global_event.trigger("order-create")},beforeSubmit:function(){if(1>d.orderCreator.addedProduct.length)return bm.notify($.i18n.prop("no.product.is.selected"),"alert"),!1}})};
_o.view=function(a){var b=bm.viewPopup(app.baseUrl+"order/view",{id:a},{width:800,clazz:"view-popup order-details-view"});b.on("content_loaded",function(){var d=b.getDom();d.find(".manage-payment").on("click",function(){_o.managePayment(a);b.close()});d.find(".manage-shipment").on("click",function(){_o.manageShipment(a);b.close()})})};
_o.printOrder=function(a,b){var d={id:a,view:b,type:"order"},c=b?"view.order":"print.order",f={width:770,height:window.innerHeight-window.innerHeight/100*20,scroll:!1,events:{content_loaded:function(a){var b=this,c=b.find(".printBody")[0].contentWindow;bm.onReady(c,"printMe",function(){b.find(".print-button").click(function(){c.focus();c.printMe()})});b.find(".content").css("height","80%");$(window).bind("resize."+g,function(){b.css("height",window.innerHeight-window.innerHeight/100*20)});a.on("close",
function(){$(window).unbind("resize."+g)})}}},g=bm.getUUID();bm.ajax({url:app.baseUrl+"layout/isAdminLoggedIn",success:function(){bm.ajax({url:app.baseUrl+"document/isDocumentActive",data:{type:"order"},success:function(){bm.editPopup(app.baseUrl+"document/getDocumentData",$.i18n.prop(c),name,d,f)},error:function(){f.content=$("<span class='print-order-image print-button'></span><iframe style='height: 100%; width: 100%; border: none; overflow: scroll' class='printBody' src='"+app.baseUrl+"order/print?id="+
a+"'></iframe>");bm.editPopup(void 0,$.i18n.prop(c),name,d,f)}})}})};
_o.printPickingSlip=function(a,b){var d={id:a,view:b,type:"picking_slip"},c=b?"view.order":"print.picking.slip",f=bm.getUUID();bm.ajax({url:app.baseUrl+"layout/isAdminLoggedIn",success:function(){bm.editPopup(app.baseUrl+"document/getDocumentData",$.i18n.prop(c),name,d,{width:770,height:window.innerHeight-window.innerHeight/100*20,scroll:!1,events:{content_loaded:function(a){var b=this,c=b.find(".printBody")[0].contentWindow;bm.onReady(c,"printMe",function(){b.find(".print-button").click(function(){c.focus();
c.printMe()})});b.find(".content").css("height","80%");$(window).bind("resize."+f,function(){b.css("height",window.innerHeight-window.innerHeight/100*20)});a.on("close",function(){$(window).unbind("resize."+f)})}}})}})};
_o.printInvoice=function(a,b){var d={id:a,view:b,type:"invoice"},c=b?"view.order":"print.invoice",f=bm.getUUID();bm.ajax({url:app.baseUrl+"layout/isAdminLoggedIn",success:function(){bm.editPopup(app.baseUrl+"document/getDocumentData",$.i18n.prop(c),name,d,{width:770,height:window.innerHeight-window.innerHeight/100*20,scroll:!1,events:{content_loaded:function(a){var b=this,c=b.find(".printBody")[0].contentWindow;bm.onReady(c,"printMe",function(){b.find(".print-button").click(function(){c.focus();c.printMe()})});
b.find(".content").css("height","80%");$(window).bind("resize."+f,function(){b.css("height",window.innerHeight-window.innerHeight/100*20)});a.on("close",function(){$(window).unbind("resize."+f)})}}})}})};_o.advanceSearchUrl=app.baseUrl+"order/filter";_o.advanceSearchTitle=$.i18n.prop("order");_o.beforeReloadRequest=function(a){app.tabs.order._super.beforeReloadRequest.call(this,a);var b=this.body.find(".header select.order-status");this.advanceSearchFilter?b.chosen("val",""):$.extend(a,{orderStatus:b.val()})};
app.tabs.paymentGateway=function(){this.text=$.i18n.prop("payment.gateways");this.tip=$.i18n.prop("manage.payment.gateway");this.ui_class="payment-gateways";this.ajax_url=app.baseUrl+"paymentGateway/loadAppView";app.tabs.paymentGateway._super.constructor.apply(this,arguments)};app.ribbons.web_commerce.push({text:$.i18n.prop("payment.gateways"),processor:app.tabs.paymentGateway,ui_class:"payment-gateway"});app.tabs.paymentGateway.inherit(app.SingleTableTab);var _pg=app.tabs.paymentGateway.prototype;
_pg.menu_entries=[{text:$.i18n.prop("config"),ui_class:"edit config",action:"edit"}];_pg.onActionClick=function(a,b){switch(a){case "edit":this.configPaymentGateway(b.id,b.name)}};_pg.onSelectedActionClick=function(a,b){switch(a){case "status":this.changeStatus(b)}};
_pg.changeStatus=function(a){var b=this;bm.editPopup(app.baseUrl+"paymentGateway/loadStatusOption",$.i18n.prop("status"),null,{},{width:600,events:{content_loaded:function(){var b=$(this),c=a.collect("id");$.each(c,function(a,c){b.find(".edit-popup-form").append('<input type="hidden" name="id" value="'+c+'">')})}},success:function(){b.reload()}})};
(function(){_pg.init=function(){app.tabs.paymentGateway._super.init.call(this);app.tabs.paymentGateway.tab=this};app.global_event.on("after-ribbon-render",function(a,b){app.isPermitted("payment_gateway.view.list")?b.enable("payment-gateway"):b.disable("payment-gateway")})})();
_pg.configPaymentGateway=function(a,b){var d={id:a},c=$.i18n.prop("payment.gateway.config"),f=this;this.renderCreatePanel(app.baseUrl+"paymentGateway/config",c,$.i18n.prop(b),d,{width:795,content_loaded:function(a){function c(a,b,c){bm.ajax({dataType:"html",url:app.baseUrl+"paymentGateway/paymentProcessorFields",data:{gateway:b},success:function(b){var d=a.find("#card-processor-fields");d.length||a.find("[name='metafield.CRD.creditCardProcessor']").closest(".form-row").after(d=$("<div id='card-processor-fields'></div>"));
b=$(b);d.html(b);d.updateUi();bm.autoToggle(d);d=c.obj(ValidationPanel);d.attach(b.find("[validation]"),d)}})}function d(a){var b=a.find("#surcharge-range-selector");a=a.find(".multi-conditions");a=bm.twoSideSelection(a,10,"item",!1,{view:!1,"column-sort":!1},["from","to","surcharge-amount"]);var c,d,e,f,g;a.initContent=function(a,l){d=a.find(".from");e=a.find(".to");f=a.find(".surcharge-amount");c=a;g=c.find(".addCondition");a.attachValidator();g.on("click",function(){if(a.valid()){var c=d.val(),
g=e.val(),m=f.val(),n=$.i18n.prop("from")+": "+c+"\n"+$.i18n.prop("to")+": "+g+"\n"+$.i18n.prop("surcharge.amount")+": "+m;c=[c,g,m];a.find("input").val("");"update"==a.attr("data-mode")?(l([n],c,$(this).data("row")),a.find(".cancel-button").triggerHandler("click")):l([n],c);b.trigger("change").trigger("validate")}})};var l=$("<button type='button' class='cancel-button'>"+$.i18n.prop("cancel")+"</button>");a.onEditClick=function(a,b,m,n){d.val(b.from);e.val(b.to);f.val(b["surcharge-amount"]);g.before(l);
g.before("&nbsp; ");l.on("click",function(){$(this).remove();g.text($.i18n.prop("add"));c.attr("data-mode","add");c.find("input").val("")});g.text($.i18n.prop("update")).data("row",n);c.attr("data-mode","update")};a.onDeleteClick=function(){var a=d.val(),b=e.val(),g=f.val();c.find(".cancel-button").triggerHandler("click");d.val(a);e.val(b);f.val(g)};a.onRemoveAll=function(){l.trigger("click")};a.triggerExternalInit()}var f=this;if("credit.card"==b){var g=f.find("[name='metafield.CRD.creditCardProcessor']").change(function(){c(f,
$(this).val(),a)}).val();g&&c(f,g,a)}g=f.find("select[name='zone.id']");bm.zoneSelector(f,g);g=f.find("#surchargeType");g.change(function(){var a=f.find("#surchargeType").val(),b=f.find(".surcharge"),c=f.find("#surcharge-range-selector");b.hide();c.hide();c.trigger("validate");b.find("input").trigger("validate");switch(a){case "flat_surcharge":b.show();break;case "surcharge_on_amount_range":c.show()}});g.trigger("change");f.find("#surcharge-range-selector").length&&d(f)},success:function(){f.reload();
a&&app.global_event.trigger("payment-gateway-update",[a])}})};
app.tabs.shipping=function(){this.selected=null;this.text=$.i18n.prop("shipping");this.tip=$.i18n.prop("manage.shipping");this.ui_class="shipping";app.tabs.shipping._super.constructor.apply(this,arguments);this.left_panel_url="shippingAdmin/loadLeftPanel";this.ajax_url=app.baseUrl+"shippingAdmin/loadAppView";this.right_panel_views={"default":{ajax_url:"shippingAdmin/explorerView"},rule_list:{ajax_url:"shippingAdmin/allRuleList",processor:app.tabs.shipping.ruleView},rate_list:{ajax_url:"shippingAdmin/allRateList",
processor:app.tabs.shipping.rateView}}};_s=app.tabs.shipping.inherit(app.TwoPanelExplorerTab);app.ribbons.web_commerce.push({text:$.i18n.prop("shipping"),ui_class:"shipping",processor:app.tabs.shipping,permission:"shipping.view.list"});_s.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"delete"}];_s.root_selector_menu_entries=[{ui_class:"edit",action:"edit"},{ui_class:"remove",action:"remove"}];
_s.onRootSelectorActionClick=function(a,b){switch(a){case "edit":this.createProfileForm(b.value,b.text);break;case "remove":this.deleteProfile(b.value,b.text)}};_s.deleteProfile=function(a,b){var d=this;bm.remove("taxProfile","TaxProfile",$.i18n.prop("confirm.delete.shipping.profile",[b]),app.baseUrl+"shippingAdmin/deleteShippingProfile",a,{success:function(){d.reload(!1)},is_final:!0})};
_s.onActionClick=function(a,b){switch(a){case "edit":this.createRuleForm(b.id,b.name);break;case "delete":this.detachRule(b.id,b.name)}};(function(){function a(){var a=this;this.body.find(".create-rule-top").on("click",function(){a.addRule()})}var b=app.tabs.shipping._super;_s.init=function(){b.init.call(this);a.call(this);this.initRightPanel()};_s.initLeftPanel=function(){b.initLeftPanel.apply(this,arguments);this.attachLeftPanel()}})();
_s.attachLeftPanel=function(){var a=this,b=a.body;a.profileId=null;a.shippingClass=null;a.initSortable();var d=b.find(".shipping-profile-selector");b.find(".create-profile").on("click",function(){a.createProfilePopup()});d.on("change",function(){a.profileId=d.val();a.current_right_panel_view="default";a.reload()});b.find(".navigation-button").click(function(){switch(this.jqObject.attr("item-type")){case "zone":ComponentManager.openTab(ComponentManager.getRibbonData(app.ribbons.administration,"zone"));
break;case "rule":a.changeRightPanelView("rule_list");break;case "rate":a.changeRightPanelView("rate_list")}});b.find(".class-filter-selector").on("change",function(){var b=$(this).val();a.profileId=d.val();a.shippingClass=b;a.current_right_panel_view="default";a.reload()})};
_s.initSortable=function(){var a=this.body,b=a.find(".shipping-profile-selector");a.find(".sortable-container").sortable({containment:"parent",sort:function(d){d=a.find(".explorer-items .explorer-item");var c="";$.each(d,function(a,b){c+=$(b).attr("entity-id")+","});bm.ajax({url:app.baseUrl+"shippingAdmin/sortRules",data:{id:b.val(),ruleIdList:c}})}})};
_s.initRightPanel=function(){app.tabs.shipping._super.initRightPanel.apply(this,arguments);if("default"===this.current_right_panel_view){var a=this,b=a.body;this.body.find(".create-rule-top").show();this.body.find(".create-rate-top").hide();var d=b.find(".rate-table"),c=b.find(".zone-table");b.find(".add-rate").on("click",function(){a.addRate($(this))});b.find(".add-zone").on("click",function(){a.addZone($(this))});a.rateTableEvent(d);a.zoneTableEvent(c)}};
_s.beforeLeftPanelReload=function(a){$.extend(a,{profileId:this.profileId,shippingClass:this.shippingClass});this.ruleId&&"default"==this.current_right_panel_view&&($.extend(a,{selected:this.ruleId}),this.ruleId=null)};_s.beforeRightPanelReload=function(a){$.extend(a,{profileId:this.profileId});this.shippingClass=this.profileId=null};
_s.createProfilePopup=function(){var a=this;bm.editPopup(app.baseUrl+"shippingAdmin/createProfilePopup",$.i18n.prop("add.new.profile"),null,null,{width:600,events:{content_loaded:function(){var a=$(this);a.find(".profile-option").on("click",function(){a.find(".profile-option.selected").removeClass("selected");$(this).addClass("selected")})}},beforeSubmit:function(b,d,c){b=b.find(".profile-option.selected").attr("type");c.close();"new"===b?a.createProfileForm():"copy"===b&&a.selectExistingProfile();
return!1}})};
_s.selectExistingProfile=function(){var a=this;bm.editPopup(app.baseUrl+"shippingAdmin/useExistingProfilePopup",$.i18n.prop("select.shipping.profile"),null,null,{width:600,events:{content_loaded:function(){var a=$(this);a.find(".profile-listing").first().addClass("selected");a.find(".profile-listing").on("click",function(){a.find(".profile-listing.selected").removeClass("selected");$(this).addClass("selected")})}},beforeSubmit:function(b,d,c){d=b.find(".profile-listing.selected").attr("entity-id");b=
b.find(".profile-copy-type").val();c.close();a.renameProfile(d,b);return!1}})};_s.renameProfile=function(a,b){var d=this;bm.editPopup(app.baseUrl+"shippingAdmin/renameProfile",$.i18n.prop("rename.profile"),null,{id:a,copyType:b},{width:600,success:function(a){d.profileId=a.id;d.current_right_panel_view="default";d.reload(!1)}})};
_s.createProfileForm=function(a,b){var d=this;d=this;bm.editPopup(app.baseUrl+"shippingAdmin/createProfileForm",$.i18n.prop(a?"edit.shipping.profile":"add.new.profile"),b,{id:a},{width:600,success:function(a){d.profileId=a.id;d.current_right_panel_view="default";d.reload()}})};_s.copyProfile=function(){var a=this;bm.editPopup(app.baseUrl+"shippingAdmin/createShippingProfileForm",$.i18n.prop("add.new.profile"),null,{},{width:600,success:function(){a.reload(!1)}})};
_s.renameAndAssignRule=function(a,b){var d=this;bm.editPopup(app.baseUrl+"shippingAdmin/renameRule",$.i18n.prop("rename.rule"),null,{id:a,profileId:b},{width:600,success:function(){d.reload()}})};
_s.addRule=function(){var a=this;bm.editPopup(app.baseUrl+"shippingAdmin/addRulePopup",$.i18n.prop("add.rule"),null,null,{width:600,events:{content_loaded:function(){var a=$(this);a.find(".rule-option").first().addClass("selected");a.find(".rule-option").on("click",function(){a.find(".rule-option.selected").removeClass("selected");$(this).addClass("selected")})}},beforeSubmit:function(b,d,c){b=b.find(".rule-option.selected").attr("type");c.close();"new"===b?a.createRuleForm():"copy"===b&&a.selectExistingRule();
return!1}})};_s.detachRule=function(a,b){var d=this,c=d.body.find(".shipping-profile-selector").val();bm.confirm($.i18n.prop("confirm.delete",[b]),function(){bm.ajax({url:app.baseUrl+"shippingAdmin/detachShippingRule",data:{ruleId:a,profileId:c},success:function(){d.profileId=c;d.reload()}})})};
_s.createRuleForm=function(a,b){var d=this,c=d.current_right_panel_view,f=d.body;b=b?b:$.i18n.prop("create.shipping.rule");var g=f.find(".shipping-profile-selector").val();bm.editPopup(app.baseUrl+"shippingAdmin/createShippingRuleForm",b,null,{profileId:"default"===c?g:null,ruleId:a},{width:600,success:function(){d.profileId=g;d.ruleId=a;d.reload()}})};
_s.selectExistingRule=function(){var a=this,b=a.body.find(".shipping-profile-selector").val();a.selectedRuleId=null;a.profileId=b;var d;bm.editPopup(app.baseUrl+"shippingAdmin/useExistingRulePopup",$.i18n.prop("select.rule"),null,{},{width:600,events:{content_loaded:function(){var b=$(this);d=new app.tabs.shipping.table(b,a,"shippingAdmin/useExistingRulePopup");d.init();d.beforeReloadRequest=function(a){var b=this.body.find("[name='shippingClass']").val(),c=this.body.find("[name='policyType']").val(),
d=this.body.find("input.search-text").val();$.extend(a,{shippingClass:b,policyType:c,searchText:d})}}},beforeSubmit:function(b,f,g){b=d.getSelectedEntities();b.length?(g.close(),g=b[0].id,a.selectedRuleId=g,a.selectedRule(g)):bm.notify($.i18n.prop("select.rule"),"alert");return!1}})};_s.selectedRule=function(a){var b=this;bm.editPopup(app.baseUrl+"shippingAdmin/selectedRule",$.i18n.prop("use.existing.rule"),null,{id:a},{width:600,beforeSubmit:function(a,c,f){f.close();b.ruleCopyType();return!1}})};
_s.ruleCopyType=function(){var a=this,b=a.body,d=a.current_right_panel_view;bm.editPopup(app.baseUrl+"shippingAdmin/ruleCopyType",$.i18n.prop("use.existing.rule"),null,{view:d},{width:600,events:{content_loaded:function(){var a=$(this);a.find(".copy-type").on("click",function(){a.find(".copy-type.selected").removeClass("selected");$(this).addClass("selected")})}},beforeSubmit:function(c,f,g){c=c.find(".copy-type.selected").attr("type");f="default"===d?b.find(".shipping-profile-selector").val():null;
g.close();"use"===c?bm.ajax({url:app.baseUrl+"shippingAdmin/assignRuleToProfile",data:{id:a.selectedRuleId,profileId:f},success:function(){a.reload()}}):a.renameAndAssignRule(a.selectedRuleId,f);return!1}})};
_s.rateTableEvent=function(a){var b=this;bm.menu([{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit-rate"},{text:$.i18n.prop("remove"),ui_class:"remove",action:"remove"}],a,".action-navigator",{click:function(d,c,f){c=c.config("entity");switch(d){case "edit-rate":d=a.find(".row.rate-row");d=d.length?d:f.closest("tr");b.editRate(c,d);break;case "remove":b.detachRate(c.rule_id,c.name)}}},"click")};
_s.rateSelectionFloatingPanelEvent=function(a,b){var d=this,c=d.body,f=a.el,g=c.find(".rate-table");f.find(".create-new-rate").on("click",function(){var f=g.find(".row.rate-row");f=f.length?f:g.find("tr.add-rate-row");d.editRate({"shipping-rule-id":b},f);c.find(".add-rate-row").addClass("hidden");a.close()})};_s.detachRate=function(a,b){var d=this;bm.confirm($.i18n.prop("confirm.delete.shipping.rate",[b]),function(){bm.ajax({url:app.baseUrl+"shippingAdmin/detachRate",data:{ruleId:a},success:function(){d.reload(!0)}})})};
_s.addRate=function(a){var b=this,d=b.body;d.find(".right-panel");var c=d.find(".rule-details").find("input.rule-id").val();bm.selectionFloatingPanel(a,app.baseUrl+"shippingAdmin/addRate",{},{width:400,clazz:"add-rate-popup shipping",events:{content_loaded:function(a){b.rateSelectionFloatingPanelEvent(a,c)}},onSelect:function(a){bm.ajax({url:app.baseUrl+"shippingAdmin/selectRate",data:{rateId:a.rate_id,ruleId:c},dataType:"html",success:function(a){b.reload(!0)}})}})};
_s.editRate=function(a,b){var d=this,c=d.body;c.find(".add-rate-form .cancel-button").trigger("click");c.find(".rule-details");c.loader();a=a?a:{};bm.ajax({url:app.baseUrl+"shippingAdmin/loadNewRate",dataType:"html",data:a,response:function(){c.loader(!1)},success:function(a){a=$(a);var c=a.find("form");c.find(".cancel-button").on("click",function(){b&&b.removeClass("hidden");$(this).closest(".new-rate-row").remove()});b?(b.addClass("hidden"),a.insertBefore(b)):a.insertAfter(d.body.find("table tr:last"));
c.form({ajax:!0,preSubmit:function(a){$.extend(a,{success:function(a){d.reload(!0)}})}});d.attachRateFormEvents(a)}})};
_s.addShippingConditionRow=function(a,b,d){function c(){l.find("input[name='from']").val(a.from);l.find("input[name='to']").val(a.to);l.find("input[name='shippingCost']").val(a.shippingCost);l.find("input[name='handlingCost']").val(a.handlingCost);l.find("input[name='packetWeight']").val(a.packetWeight);l.find("span.from .value").html(a.from);l.find("span.to .value").html(a.to);l.find("span.shippingCost .value").html(a.shippingCost);l.find("span.handlingCost .value").html(a.handlingCost);l.find("span.packetWeight .value").html(a.packetWeight);
f||l.find(".weight_only").hide();d?(d.replaceWith(l),g.find(".add-condition").removeClass("edit-mode").html("+ "+$.i18n.prop("add"))):l.insertBefore(g)}var f="sbw"==b.find("select.shipping-policy-type").val(),g=b.find(".shipping-condition-table .last-row"),m=b.find(".condition-row");if(0<m.length){var l=$(m[0]).clone();c()}else $.extend(a,{isWeight:f,rateId:b.find("input[name='id']").val(),bulkEdit:b.is(".rate-bulk-edit-form")}),bm.ajax({url:app.baseUrl+"shippingAdmin/conditionRowTemplate",data:a,
dataType:"html",success:function(a){l=$(a);c()}})};
_s.rateFromValidation=function(a){var b=a.find(".multi-conditions"),d=b.find(".shipping-condition-editor");var c=d.find("input.from");var f=d.find("input.to");var g=b.find(".additional-amount");d.attachValidator();a.find("select.shipping-policy-type").on("change",function(){var a=$(this);$.each([c,f,g],function(b,c){$.each(c,function(b,c){b=$(c);c="condition-validation";b.is(".additional-amount")&&(c="validation");"sbq"==a.val()?(b.attr("restrict","numeric"),b.addAttrProp(c,"number","digits"),b.addAttrProp(c,
"price","")):(b.attr("restrict","decimal"),b.addAttrProp(c,"digits","number"),b.addAttrProp(c,"price"))})});d.clearValidationMessage()})};
_s.attachRateFormEvents=function(a){var b=this,d=b.body;a=$(a);var c=a.find("form");0==c.length&&(c=a);var f=c.find(".multi-conditions"),g=f.find(".shipping-condition-editor"),m;var l=g.find("input.from");var n=g.find("input.to");var q=g.find(".shipping-cost");var e=g.find(".handling-cost");var p=g.find(".packet-weight");var t=g.find(".add-condition");f.find(".additional-amount");d.find(".add-rate-row").addClass("hidden");a.updateUi();b.rateFromValidation(c);t.on("click",function(){if(g.valid()){var a=
{from:l.val(),to:n.val(),shippingCost:q.val(),handlingCost:e.val(),packetWeight:p.val()};$(this).is(".edit-mode")?b.addShippingConditionRow(a,c,m):b.addShippingConditionRow(a,c);g.find(".last-row input").val("")}else{a=ValidationField.validateAs(q,q.attr("condition-validation"))||ValidationField.validateAs(e,q.attr("condition-validation"));var d=ValidationField.validateAs(p,q.attr("condition-validation"));a?bm.notify($.i18n.prop(a.msg_template,a.msg_params),"alert"):p.is(":visible")&&d&&bm.notify($.i18n.prop(d.msg_template,
d.msg_params),"alert")}});0<c.length&&bm.menu([{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"delete"}],g,".action-navigator",{hide:function(a){a.parent().removeClass("float-menu-opened")},click:function(a,b){switch(a){case "edit":m=b.parents("tr.condition-row");l.val(m.find("[name=from]").val());n.val(m.find("[name=to]").val());q.val(m.find("[name=shippingCost]").val());e.val(m.find("[name=handlingCost]").val());p.val(m.find("[name=packetWeight]").val());
t.addClass("edit-mode").html($.i18n.prop("update"));break;case "delete":b.parents(".condition-row").remove()}}},"click",["center bottom","right+22 top+7"])};_s.zoneTableEvent=function(a){var b=this;bm.menu([{text:$.i18n.prop("remove"),ui_class:"remove",action:"remove"}],a,".action-navigator",{click:function(a,c){c=c.config("entity");switch(a){case "remove":b.detachZone(c)}}},"click")};
_s.detachZone=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.zone",a.zone_name),function(){bm.ajax({url:app.baseUrl+"shippingAdmin/detachZone",data:a,success:function(){b.reload(!0)}})})};
_s.addZone=function(a){var b=this,d=b.body.find(".rule-details input.rule-id").val();bm.selectionFloatingPanel(a,app.baseUrl+"shippingAdmin/addZone",{ruleId:d},{width:350,clazz:"add-zone-popup shipping",events:{content_loaded:function(a){a.el.find(".create-zone").on("click",function(){ComponentManager.openTab(ComponentManager.getRibbonData(app.ribbons.administration,"zone"));a.close()})}},beforeReload:function(a){$.extend(a,{ruleId:d})},onSelect:function(a){bm.ajax({url:app.baseUrl+"shippingAdmin/selectZone",
data:{zoneId:a.id,ruleId:d},dataType:"html",success:function(a){b.reload(!0)}})}})};app.tabs.shipping.table=function(a,b,d){this.body=a;this.appTab=b;this.ajax_url=d};_t=app.tabs.shipping.table.inherit(app.SingleTableView);_t.init=function(){this.body.updateUi();app.tabs.shipping.table._super.init.call(this);this.bindFilterEvent()};_t.bindFilterEvent=function(){var a=this;a.body.find(".filter-select select").on("change",function(){a.reload()})};
_t.advanceFilter=function(a){var b=this;this.body.find(".advance-filter-btn").on("click",function(){b.advanceSearchFilter=b.advanceSearchFilter?b.advanceSearchFilter:{};$.extend(b.advanceSearchFilter,{ratePanel:a});bm.floatingPanel(this,app.baseUrl+"shippingAdmin/advanceFilterPanel",b.advanceSearchFilter,{width:350,height:null,clazz:"add-zone-popup shipping",position_collison:"none",events:{content_loaded:function(a){var c=a.el;c.updateUi();var d=c.find(".filter");c.find(".cancel-button").on("click",
function(){a.close()});d.on("click",function(){b.advanceSearchFilter=c.serializeObject();a.close();b.reload()})}}})})};app.tabs.shipping.ruleView=function(a,b,d){this.body=a;this.appTab=b;this.ajax_url=d;this.init();this.advanceFilter(!1)};var _rl=app.tabs.shipping.ruleView.inherit(app.tabs.shipping.table);_rl.advanceFilter=_t.advanceFilter;_rl.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("remove"),ui_class:"remove"}];
_rl.action_menu_entries=[{text:$.i18n.prop("import"),ui_class:"import"},{text:$.i18n.prop("export"),ui_class:"export"}];_rl.init=function(){app.tabs.shipping.ruleView._super.init.call(this);this.appTab.body.find(".create-rule-top").show();this.appTab.body.find(".create-rate-top").hide();this.bindImport()};_rl.onActionClick=function(a,b){switch(a){case "edit":this.createRuleForm(b.id,b.name);break;case "remove":this.deleteRule(b.id,b.name)}};_rl.createRuleForm=_s.createRuleForm;
_rl.deleteRule=function(a,b){var d=this;bm.remove("shippingPolicy",$.i18n.prop("shipping.rate"),$.i18n.prop("confirm.delete.shipping.rule",[b]),app.baseUrl+"shippingAdmin/deleteShippingRule",a,{is_final:!0,success:function(){d.profileId=d.appTab.body.find(".shipping-profile-selector").val();d.appTab.reload()}})};
_rl.bindImport=function(){var a=this;bm.menu(this.action_menu_entries,this.body,".action-menu",{click:function(b,d){switch(b){case "import":a.initImportWindow();break;case "export":a.exportRule()}}},"click",["center bottom","right+22 top+7"]);app.global_event.on("shipping_import_success",function(){a.reload()})};_rl.exportRule=function(){window.open(app.baseUrl+"shippingRuleImport/export")};
_rl.initImportWindow=function(){var a=this,b;this.appTab.renderCreatePanel(app.baseUrl+"shippingRuleImport/uploadFileView",$.i18n.prop("import.shipping.rule"),"",void 0,{width:220,success:function(b){a.configImportedDataMap(b.html)},content_loaded:function(a,c){b=c;b.find("[name=ruleImportFile]").on("change",function(){b.submit()})},beforeSubmit:function(a){a.loader()},error:function(){b.loader(!1)}})};
_rl.configImportedDataMap=function(a){var b=this;this.appTab.renderCreatePanel(void 0,$.i18n.prop("import.shipping.rule"),"",void 0,{width:495,draggable:!1,content_loaded:function(a){},success:function(a){app.tabs.setting.prototype.initTask.call(b,a.token,a.name,"shipping_import_success")},content:a})};app.tabs.shipping.rateView=function(a,b,d){this.body=a;this.appTab=b;this.ajax_url=d;this.init()};var _rt=app.tabs.shipping.rateView.inherit(app.tabs.shipping.table);
_rt.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("remove"),ui_class:"remove"}];_rt.init=function(){app.tabs.shipping.rateView._super.init.call(this);this.bindEvents();this.advanceFilter(!0)};_rt.bindEvents=function(){var a=this,b=this.body;this.appTab.body.find(".create-rule-top").hide();var d=this.appTab.body.find(".create-rate-top");b=b.find(".rate-bulk-edit");d.show();d.on("click",function(){a.editRate({})});b.on("click",function(){a.loadBulkEditForm()})};
_rt.loadBulkEditForm=function(){var a=this,b=this.body;this.appTab.body.find(".create-rate-top").hide();this.appTab.body.find(".rate-table .footer").hide();this.appTab.body.find(".filter-group").hide();var d=b.find(".bulk-edit-buttons");b.loader();var c=[];$.map(a.getSelectedEntities(),function(a){c.push(a.id)});bm.ajax({url:app.baseUrl+"shippingAdmin/rateBulkEditForm",data:{idList:c},dataType:"html",success:function(c){var f=b.find(".rate-data-list").hide();d.show();b.find(".rate-bulk-edit").closest(".tool-group").hide();
$(c).insertAfter(f);c=b.find(".rate-bulk-edit-form");a.bindBulkEvents(d,c)},response:function(){b.loader(!1)}})};_rt.bindBulkEvents=function(a,b){var d=this,c=d.appTab.body,f=a.find(".rate-bulk-save");a=a.find(".rate-bulk-cancel");$.each(b,function(a,b){bm.autoToggle($(b));d.appTab.attachRateFormEvents($(b));$(b).updateValidator()});f.on("click",function(){var a=!0;b.find("input:not(.last-row input)").toArray().every(function(b,c){if(!$(c).valid())return a=!1});a&&d.bulkSave()});a.on("click",function(){c.find(".navigation-button.rate-button").trigger("click")})};
_rt.bulkSave=function(){var a=[],b=this.body.find(".rate-bulk-edit-form"),d=!0,c=this.appTab;$.each(b,function(b,c){d&&0==$(c).find(".rate-condition-wrap .shipping-rate-selection").valid()&&(d=!1);d&&(b=$(c).serializeObject(),b=JSON.stringify(b),a.push(b))});d&&bm.ajax({url:app.baseUrl+"shippingAdmin/bulkRateSave",data:{rates:a},success:function(){c.body.find(".navigation-button.rate-button").trigger("click")}})};_rt.advanceFilter=_t.advanceFilter;
_rt.onActionClick=function(a,b,d){switch(a){case "edit":this.editRate(b,d.closest("tr"));break;case "remove":this.deleteRate(b.id,b.name)}};_rt.editRate=_s.editRate;_rt.addShippingConditionRow=_s.addShippingConditionRow;_rt.deleteRate=function(a,b){var d=this;bm.remove("shippingPolicy",$.i18n.prop("shipping.rate"),$.i18n.prop("confirm.delete.shipping.rate",[b]),app.baseUrl+"shippingAdmin/deleteShippingPolicy",a,{is_final:!0,success:function(){d.reload()}})};_rt.attachRateFormEvents=_s.attachRateFormEvents;
_rt.rateFromValidation=_s.rateFromValidation;
app.tabs.tax=function(){this.selected=null;this.text=$.i18n.prop("tax");this.tip=$.i18n.prop("manage.tax");this.ui_class="tax";app.tabs.tax._super.constructor.apply(this,arguments);this.left_panel_url="taxAdmin/loadLeftPanel";this.ajax_url=app.baseUrl+"taxAdmin/loadAppView";this.right_panel_views={"default":{processor:app.tabs.tax.rule_editor,ajax_url:"taxAdmin/explorerView"},rule_list:{ajax_url:"taxAdmin/ruleAppView",processor:app.tabs.tax.ruleView},code_list:{ajax_url:"taxAdmin/codeAppView",processor:app.tabs.tax.codeView}}};
_t=app.tabs.tax.inherit(app.TwoPanelExplorerTab);app.ribbons.web_commerce.push({text:$.i18n.prop("tax"),ui_class:"tax",processor:app.tabs.tax,permission:"tax.view.list"});app.global_event.on("after-ribbon-render",function(a,b){"manual"==app.taxConfigType?b.show("tax"):b.hide("tax")});_t.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"},{text:$.i18n.prop("remove"),ui_class:"delete",action:"delete"}];
_t.root_selector_menu_entries=[{ui_class:"edit",action:"edit"},{ui_class:"remove",action:"remove"}];_t.onActionClick=function(a,b){switch(a){case "edit":this.ruleInfoEdit(b.id,b.name);break;case "delete":this.detachRule(b)}};_t.onRootSelectorActionClick=function(a,b){switch(a){case "edit":this.profileInfoEdit(b.value,b.text);break;case "remove":this.deleteProfile(b.value,b.text)}};
(function(){var a=app.tabs.tax._super;_t.init=function(){a.init.call(this);var b=this;b.body.find(".create-rule-top").on("click",function(){b.addRule()});this.initRightPanel(b.body.find(".right-panel"))};_t.initLeftPanel=function(){a.initLeftPanel.apply(this,arguments);this.attachLeftPanel()}})();
_t.attachLeftPanel=function(){var a=this,b=a.body;a.profileId=null;var d=b.find("select.tax-profile-selector");d.on("change",function(){a.profileId=d.val();a.current_right_panel_view="default";a.reload()});b.find(".create-profile").on("click",function(){a.profileInfoEdit()});b.find(".navigation-button").click(function(){switch(this.jqObject.attr("item-type")){case "zone":ComponentManager.openTab(ComponentManager.getRibbonData(app.ribbons.administration,"zone"));break;case "rule":a.changeRightPanelView("rule_list");
break;case "code":a.changeRightPanelView("code_list")}})};_t.initRightPanel=function(){app.tabs.tax._super.initRightPanel.apply(this,arguments);"default"===this.current_right_panel_view&&(this.body.find(".create-rule-top").show(),this.body.find(".create-code-top").hide())};_t.beforeLeftPanelReload=function(a){$.extend(a,{profileId:this.profileId});this.ruleId&&"default"==this.current_right_panel_view&&($.extend(a,{selected:this.ruleId}),this.ruleId=null)};
_t.beforeRightPanelReload=function(a){$.extend(a,{profileId:this.profileId});this.profileId=null};_t.profileInfoEdit=function(a,b){var d=this;bm.editPopup(app.baseUrl+"taxAdmin/profileInfoEdit",$.i18n.prop(a?"edit.tax.profile":"create.tax.profile"),b,{id:a},{width:600,success:function(){d.current_right_panel_view="default";d.reload(!1)}})};
_t.deleteProfile=function(a,b){var d=this;bm.remove("taxProfile","TaxProfile",$.i18n.prop("confirm.delete.tax.profile",[b]),app.baseUrl+"taxAdmin/deleteProfile",a,{success:function(){d.reload(!1)},is_final:!0})};
_t.ruleInfoEdit=function(a,b){var d=this,c=d.current_right_panel_view,f=d.body;b=b?b:$.i18n.prop("create.tax.rule");var g=f.find(".tax-profile-selector").val();bm.editPopup(app.baseUrl+"taxAdmin/ruleInfoEdit",b,null,{profileId:"default"===c?g:null,ruleId:a},{width:600,success:function(){d.profileId=g;d.ruleId=a;d.reload()}})};
_t.addRule=function(){var a=this;bm.editPopup(app.baseUrl+"taxAdmin/addRulePopup",$.i18n.prop("add.rule"),null,null,{width:600,events:{content_loaded:function(){var a=$(this);a.find(".rule-option").first().addClass("selected");a.find(".rule-option").on("click",function(){a.find(".rule-option.selected").removeClass("selected");$(this).addClass("selected")})}},beforeSubmit:function(b,d,c){b=b.find(".rule-option.selected").attr("type");c.close();"new"===b?a.ruleInfoEdit():"copy"===b&&a.selectExistingRule();
return!1}})};
_t.selectExistingRule=function(){var a=this,b=a.body.find(".tax-profile-selector").val();a.selectedRuleId=null;a.profileId=b;var d;bm.editPopup(app.baseUrl+"taxAdmin/useExistingRulePopup",$.i18n.prop("select.rule"),null,{},{width:600,events:{content_loaded:function(){var b=$(this);d=new app.tabs.tax.ruleView(b,a,"taxAdmin/useExistingRulePopup");d.init()}},beforeSubmit:function(b,f,g){b=d.getSelectedEntities();b.length?(g.close(),g=b[0].id,a.selectedRuleId=g,a.selectedRule(g)):bm.notify($.i18n.prop("select.rule"),"alert");
return!1}})};_t.selectedRule=function(a){var b=this,d=b.body.find(".tax-profile-selector").val();bm.editPopup(app.baseUrl+"taxAdmin/selectedRule",$.i18n.prop("use.existing.rule"),null,{ruleId:a,profileId:d},{width:600,success:function(){b.reload()}})};
_t.detachRule=function(a){var b=this,d=b.body.find(".tax-profile-selector").val();bm.confirm($.i18n.prop("confirm.delete.tax.rule.dissociate.profile",[a.name]),function(){bm.ajax({url:app.baseUrl+"taxAdmin/detachRule",data:{id:d,ruleId:a.id},success:function(){b.reload()}})},function(){})};
app.tabs.tax.rule_editor=function(a,b){var d=this;d.parent=b;d.body=a;a.find(".add-code").on("click",function(){d.addCode($(this))});a.find(".add-zone").on("click",function(){d.addZone($(this))});b=a.find(".code-table");a=a.find(".zone-table");d.initCodeTable(b);d.initZoneTable(a)};_e=app.tabs.tax.rule_editor.prototype;
_e.initCodeTable=function(a){var b=this;bm.menu([{text:$.i18n.prop("remove"),ui_class:"remove",action:"remove"},{text:$.i18n.prop("edit"),ui_class:"edit",action:"edit"}],a,".action-navigator",{click:function(a,c){var d=c.config("entity");switch(a){case "remove":b.detachCode(d.rule_id,d.name);break;case "edit":a=c.closest("tr"),b.editCode(d,a)}}},"click")};
_e.addCode=function(a){var b=this,d=b.body;d.find(".right-panel");var c=d.find(".rule-details").find("input.rule-id").val();bm.selectionFloatingPanel(a,app.baseUrl+"taxAdmin/addCode",{},{width:400,clazz:"add-code-popup tax",events:{content_loaded:function(a){b.codeSelectionFloatingPanelEvent(a,c)}},onSelect:function(a){bm.ajax({url:app.baseUrl+"taxAdmin/selectCode",data:{codeId:a.id,ruleId:c},success:function(a){b.parent.reload(!0)}})}})};
_e.codeSelectionFloatingPanelEvent=function(a,b){var d=this,c=d.body,f=a.el,g=c.find(".code-table");f.find(".create-new-code").on("click",function(){var f=g.find(".row.rate-row");f=f.length?f:g.find("tr.add-code-row");d.editCode({"tax-rule-id":b},f);c.find(".add-code-row").addClass("hidden");a.close()})};
_e.editCode=function(a,b){var d=this,c=d.body;c.find(".add-code-form .cancel-button").trigger("click");c.find(".rule-details");c.loader();a=a?a:{};bm.ajax({url:app.baseUrl+"taxAdmin/editTaxCode",dataType:"html",data:a,response:function(){c.loader(!1)},success:function(a){a=$(a);var c=a.find("form");c.find(".cancel-button").on("click",function(){b&&b.removeClass("hidden");$(this).closest(".new-code-row").remove()});b?(b.addClass("hidden"),a.insertBefore(b)):a.insertAfter(d.body.find("table tr:last"));
c.form({ajax:!0,preSubmit:function(a){$.extend(a,{success:function(a){d.parent.reload(!0)}})}})}})};_e.detachCode=function(a,b){var d=this;bm.confirm($.i18n.prop("confirm.delete.tax.code",[b]),function(){bm.ajax({url:app.baseUrl+"taxAdmin/detachCode",data:{ruleId:a},success:function(){d.parent.reload(!0)}})})};
_e.initZoneTable=function(a){var b=this;bm.menu([{text:$.i18n.prop("remove"),ui_class:"remove",action:"remove"}],a,".action-navigator",{click:function(a,c){c=c.config("entity");switch(a){case "remove":b.detachZone(c)}}},"click")};
_e.addZone=function(a){var b=this,d=b.body.find(".rule-details input.rule-id").val();bm.selectionFloatingPanel(a,app.baseUrl+"taxAdmin/addZonePop",{ruleId:d},{width:350,clazz:"add-zone-popup tax",events:{content_loaded:function(a){a.el.find(".create-zone").on("click",function(){ComponentManager.openTab(ComponentManager.getRibbonData(app.ribbons.administration,"zone"));a.close()})}},beforeReload:function(a){$.extend(a,{ruleId:d})},onSelect:function(a){bm.ajax({url:app.baseUrl+"taxAdmin/selectZone",
data:{zoneId:a.id,ruleId:d},dataType:"html",success:function(a){b.parent.reload(!0)}})}})};_e.detachZone=function(a){var b=this;bm.confirm($.i18n.prop("confirm.delete.zone",[a.zone_name]),function(){bm.ajax({url:app.baseUrl+"taxAdmin/detachZone",data:a,success:function(){b.parent.reload(!0)}})})};app.tabs.tax.ruleView=function(a,b,d){this.body=a;this.appTab=b;this.ajax_url=d;this.init()};_rl=app.tabs.tax.ruleView.inherit(app.SingleTableView);
_rl.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("remove"),ui_class:"remove"}];_rl.init=function(){app.tabs.tax.ruleView._super.init.call(this);this.appTab.body.find(".create-rule-top").show();this.appTab.body.find(".create-code-top").hide()};_rl.onActionClick=function(a,b){switch(a){case "edit":this.edit(b.id,b.name);break;case "remove":this.delete(b.id,b.name)}};_rl.edit=_t.ruleInfoEdit;
_rl.delete=function(a,b){var d=this;bm.remove("taxRule",$.i18n.prop("tax.code"),$.i18n.prop("confirm.delete",[b]),app.baseUrl+"taxAdmin/deleteRule",a,{is_final:!0,success:function(){d.profileId=d.appTab.body.find(".tax-profile-selector").val();d.appTab.reload()}})};app.tabs.tax.codeView=function(a,b,d){this.body=a;this.parent=this.appTab=b;this.ajax_url=d;this.init()};var _cd=app.tabs.tax.codeView.inherit(app.SingleTableView);
_cd.menu_entries=[{text:$.i18n.prop("edit"),ui_class:"edit"},{text:$.i18n.prop("remove"),ui_class:"remove"}];_cd.init=function(){var a=this;app.tabs.tax.codeView._super.init.call(this);var b=this.appTab.body.find(".create-code-top");b.show();this.appTab.body.find(".create-rule-top").hide();b.on("click",function(){a.edit({})})};_cd.onActionClick=function(a,b,d){switch(a){case "edit":this.edit(b,d.closest("tr"));break;case "remove":this.delete(b.id,b.name)}};_cd.edit=_e.editCode;
_cd.delete=function(a,b){var d=this;bm.remove("taxCode",$.i18n.prop("tax.code"),$.i18n.prop("confirm.delete",[b]),app.baseUrl+"taxAdmin/deleteTaxCode",a,{is_final:!0,success:function(){d.profileId=d.appTab.body.find(".tax-profile-selector").val();d.appTab.reload()}})};
bm.onReady(app.tabs,"categoryBulkEditor",function(){var a,b;app.tabs.categoryBulkEditor.Advanced=function(c,d){a=c;b=d};var d=app.tabs.categoryBulkEditor.Advanced.prototype;d.reload=function(){this.tabulator.reload()};d.afterTableReload=function(){a.clearDirty()};d.init=function(){var c=this;b.body.find(".toolbar-item.reload").on("click",function(){c.reload()});app.global_event.on("category-bulk-updated-advanced",function(){c.reload()});this.tabulator=bm.table($(a.find(".category-bulk-edit-tab.advanced-table")),
{url:app.baseUrl+"categoryAdmin/loadCategoryBulkProperties",beforeReloadRequest:function(){c.beforeReloadRequest(this.param)},afterLoad:function(){a.tool.filter(".action-header:visible").hide();c.table.tscrollbar("content");c.afterTableReload&&c.afterTableReload()},selectableCellSelect:app.tabs.categoryBulkEditor.selectableCellSelect,afterCellSelect:app.tabs.categoryBulkEditor.afterCellSelect,afterCellEdit:app.tabs.categoryBulkEditor.afterCellEdit});c.beforeReloadRequest=function(a){$.extend(a,{property:"advanced",
ids:this.ids})};this.table=a.find(".body table")}});
bm.onReady(app.tabs,"categoryBulkEditor",function(){function a(a,b,c,d){a.find(b).on("click",function(){bm.customerAndGroupSelectionPopup(a,{customerField:c,groupField:d})})}var b,d;app.tabs.categoryBulkEditor.Basic=function(a,c){b=a;d=c};var c=app.tabs.categoryBulkEditor.Basic.prototype;c.reload=function(){this.tabulator.reload()};c.afterTableReload=function(){b.clearDirty();d.body.find(".bmui-tab-body-container").find(".bulkedit-parent-td-proxy").remove()};c.init=function(){var a=this;d.body.find(".toolbar-item.reload").on("click",
function(){a.reload()});app.global_event.on("category-bulk-updated-basic",function(){a.reload()});this.tabulator=bm.table(b.find(".category-bulk-edit-tab.basic-table"),{url:app.baseUrl+"categoryAdmin/loadCategoryBulkProperties",beforeReloadRequest:function(){a.beforeReloadRequest(this.param)},afterLoad:function(){b.tool.filter(".action-header:visible").hide();a.afterTableReload&&a.afterTableReload()},onload:function(){},selectableCellSelect:app.tabs.categoryBulkEditor.selectableCellSelect,afterCellSelect:app.tabs.categoryBulkEditor.afterCellSelect,
afterCellEdit:app.tabs.categoryBulkEditor.afterCellEdit});a.beforeReloadRequest=function(a){$.extend(a,{property:"basic",ids:this.ids})};this.table=b.find(".body table")};app.tabs.categoryBulkEditor.selectableCellSelect=function(a){var b;a.is(".is-available")?b=$("<select><option value='true'>"+$.i18n.prop("available")+"</option><option value='false'>"+$.i18n.prop("not.available")+"</option></select>"):a.is(".is-active")?b=$("<select><option value='true'>"+$.i18n.prop("active")+"</option><option value='false'>"+
$.i18n.prop("inactive")+"</option></select>"):a.is(".parent-category")?b=app.tabs.categoryBulkEditor.getDropDown("category","select.category"):a.is(".discount-profile")?b=app.tabs.categoryBulkEditor.getDropDown("discount","select.discount.profile"):a.is(".tax-profile")?b=app.tabs.categoryBulkEditor.getDropDown("tax","select.tax.profile"):a.is(".shipping-profile")?b=app.tabs.categoryBulkEditor.getDropDown("shipping","select.shipping.profile"):a.is(".disable-tracking")?b=$("<select><option value='true'>"+
$.i18n.prop("enable")+"</option><option value='false'>"+$.i18n.prop("disable")+"</option></select>"):a.is(".restricted-price")?b=$("<select><option value='none'>"+$.i18n.prop("nobody")+"</option><option value='except_customer'>"+$.i18n.prop("only.customers")+"</option><option value='except_selected'>"+$.i18n.prop("selected.customers.only")+"</option></select>").updateUi():a.is(".restricted-purchase")&&(b=$("<select><option value='none'>"+$.i18n.prop("nobody")+"</option><option value='except_customer'>"+
$.i18n.prop("only.customers")+"</option><option value='except_selected'>"+$.i18n.prop("selected.customers.only")+"</option></select>").updateUi());return b};app.tabs.categoryBulkEditor.afterCellSelect=function(b,c,m,l){b.find("input[type=hidden]").val(c);var f=b.find(".disp-value");f.html(c?m:c);if(b.is(".is-available"))b.is(".custom-select")&&app.tabs.categoryBulkEditor.changeAvailability(b,c,m),b.find(".status").removeClass(d.status[l]).addClass(d.status[c]).refreshTooltip(m);else if(b.is(".is-active"))b.is(".custom-select")&&
app.tabs.categoryBulkEditor.changeAadministrativeStatus(b,c,m),b.find(".status").removeClass(d.status[l]).addClass(d.status[c]).refreshTooltip(m);else if(b.is(".product-condition"))b.is(".custom-select")&&app.tabs.categoryBulkEditor.changeCustomSelect(b,"product-condition",c,m),b.find(".status").removeClass(d.status[l]).addClass(d.status[c]).refreshTooltip(m);else if(b.is(".disable-tracking"))b.is(".custom-select")&&app.tabs.categoryBulkEditor.changeTracking(b,c,m),b.find(".status").removeClass(d.status[l]).addClass(d.status[c]).refreshTooltip(m);
else if(b.is(".on-sale")){b.find(".is-on-sale");var g=b.find(".sale-price");if("true"==c){var e=function(){var a=g.val();a?(g.hide(),f.html(parseFloat(a).toFixed(2)).show()):(app.tabs.categoryBulkEditor.errorHighlight(g),bm.notify($.i18n.prop("this.field.is.required"),"error"))};f.hide();g.show();g[g.attr("restrict")]();g[0].focus();g.on("focusout",function(){e()}).on("keydown",function(a){13!=a.keyCode&&27!=a.keyCode||e()})}else g.hide()}else b.is(".custom-select.discount-profile")?app.tabs.categoryBulkEditor.changeCustomSelect(b,
"discount-profile",c,m):b.is(".custom-select.tax-profile")?app.tabs.categoryBulkEditor.changeCustomSelect(b,"tax-profile",c,m):b.is(".custom-select.shipping-profile")?app.tabs.categoryBulkEditor.changeCustomSelect(b,"shipping-profile",c,m):b.is(".custom-select.restricted-price")||b.is(".restricted-price")?(b.is(".custom-select.restricted-price")&&app.tabs.categoryBulkEditor.changeCustomSelect(b,"restricted-price",c,m),"except_selected"==c?b.find(".restrict-price-except-select-customer").show():b.find(".restrict-price-except-select-customer").hide(),
a(b,".restrict-price-except-select-customer","restrictPriceExceptCustomer","restrictPriceExceptCustomerGroup")):b.is(".custom-select.restricted-purchase")&&(app.tabs.categoryBulkEditor.changeCustomSelect(b,"restricted-purchase",c,m),"except_selected"==c?b.find(".restrict-purchase-except-select-customer").show():b.find(".restrict-purchase-except-select-customer").hide(),a(b,".restrict-purchase-except-select-customer","restrictPurchaseExceptCustomer","restrictPurchaseExceptCustomerGroup"));null!=c&&
d.activePanel().setDirty()};app.tabs.categoryBulkEditor.changeTracking=function(a,b,c){if(b){var f="true"==b?"false":b;a.parents("tbody").find("td.disable-tracking").each(function(){var a=$(this);a.find("input[type=hidden]").val(b);a.find(".value").html(b);a.find(".status").removeClass(d.status[f]).addClass(d.status[b]).refreshTooltip(c)})}};app.tabs.categoryBulkEditor.changeCustomSelect=function(a,b,c,d){c="false"==c?"":c;a.parents("tbody").find("td."+b).each(function(){var a=$(this);a.find("input[type=hidden]").val(c);
a.find(".value").html(c);a.find(".disp-value").html(c?d:c)})};app.tabs.categoryBulkEditor.changeAvailability=function(a,b,c){if(b){var f="true"==b?"false":b;a.parents("tbody").find("td.is-available").each(function(){var a=$(this);a.find("input[type=hidden]").val(b);a.find(".value").html(b);a.find(".status").removeClass(d.status[f]).addClass(d.status[b]).refreshTooltip(c)})}};app.tabs.categoryBulkEditor.changeAadministrativeStatus=function(a,b,c){if(b){var f="true"==b?"false":b;a.parents("tbody").find("td.is-active").each(function(){var a=
$(this);a.find("input[type=hidden]").val(b);a.find(".value").html(b);a.find(".status").removeClass(d.status[f]).addClass(d.status[b]).refreshTooltip(c)})}};app.tabs.categoryBulkEditor.afterCellEdit=function(a,b,c){c=a.find(".td-full-width");var d=c.attr("validation");if(a.is(".editable")&&d){if(d=ValidationField.validateAs(c,d))return bm.notify($.i18n.prop(d.msg_template,d.msg_params),"error"),app.tabs.categoryBulkEditor.errorHighlight(c),!1;if(d=a.attr("unique")){var f=!0;a.parents("tbody").find("td."+
d).each(function(){$(this).find("input[type=hidden]").val().trim()==b.trim()&&(f=!1)});if(!f)return bm.notify($.i18n.prop("for.already.exists",[b,$.i18n.prop(d)]),"error"),app.tabs.categoryBulkEditor.errorHighlight(c),!1}}a.is(".custom-edit")&&(a.find(".value").hide(),b&&(c="0",a.is(".base-price")?c="base-price":a.is(".min-order-quantity")?c="min-order-quantity":a.is(".custom-edit")&&a.attr("extra-attr")&&(c=a.attr("extra-attr")),app.tabs.categoryBulkEditor.changeAllValues(a,c,b)));a.is(".editable.name")?
app.tabs.categoryBulkEditor.changeAllNameHeading(a,"name",b):a.is(".editable.heading")&&app.tabs.categoryBulkEditor.changeAllNameHeading(a,"heading",b);a.find("input[type=hidden]").val(b)};app.tabs.categoryBulkEditor.changeAllNameHeading=function(a,b,c){a=a.find("input[name$="+b+"]").attr("name");d.allPanel().find("input[name='"+a+"']").parent("td").each(function(){var a=$(this);a.find(".value").html(c);a.find("input[type=hidden]").val(c)})};app.tabs.categoryBulkEditor.changeAllValues=function(a,
b,c){a.parents("tbody").find("td."+b).each(function(){var a=$(this);a.find("input[type=hidden]").val(c);a.find(".value").html(c)})};app.tabs.categoryBulkEditor.errorHighlight=function(a){var b=d.activePanel().find(".submit-button");b.attr("disabled",!0);a.addClass("error-highlight");setTimeout(function(){a.removeClass("error-highlight");b.removeAttr("disabled")},1E3)};app.tabs.categoryBulkEditor.getDropDown=function(a,b){a=d.activePanel().find("input[name="+a+"]").val();a=$.parseJSON(a);var c=$("<select><option value=''>"+
$.i18n.prop(b?b:"select")+"</option></select>");$.each(a,function(a,b){c.append("<option value='"+b.id+"'>"+b.name+"</option>")});return c};app.tabs.categoryBulkEditor.attachParentDropDown=function(){function a(a){b.table.find("td.parent").each(function(){function c(){l.position({my:"left top",at:"left top",of:f,collision:"none",within:b.table});l.width(f.outerWidth(),!0);l.height(f.outerHeight(),!0)}var f=$(this),e=a.filter("."+f.attr("parent")),g=d.body.find("#bmui-tab-basic table.content"),l=$("<div class='bulkedit-parent-td-proxy chosen-wrapper' style='position: absolute'></div>").appendTo(g);
l.append(e);c();d.body.find(".bmui-tab-body-container").on("scroll",function(){l.height(f.outerHeight(),!0)});e.chosen();e=l.find(".chosen-choices");e.scrollbar();e.css({"max-height":f.outerHeight()});f.parents("tr").on("heightChange",function(){c()})})}var b=d.tab_objs.basic,c;c?a(c):bm.ajax({url:app.baseUrl+"categoryAdmin/loadCategoryBulkProperties",dataType:"html",data:{ids:b.ids,property:"parent-dom"},success:function(b){c=$(b);a(c)}})}});
app.tabs.categoryBulkEditor=function(){app.tabs.categoryBulkEditor._super.constructor.apply(this,arguments);this.text=$.i18n.prop("category.bulk.edit");this.tip=$.i18n.prop("category.bulk.edit");this.ui_class="category-bulk-editor edit";this.ids=JSON.stringify(this.categoryIds);this.ajax_url=app.baseUrl+"categoryAdmin/loadCategoryBulkEditor?ids="+this.ids;this.tab_objs={}};var _be=app.tabs.categoryBulkEditor.inherit(app.MultiTab);
_be.init=function(){this.body.find(".bmui-tab");app.tabs.categoryBulkEditor._super.init.apply(this,arguments)};_be.changeTabUrl=function(a,b){this.body.find(".bmui-tab").tabify("reload",a,b)};
_be.onContentLoad=function(a){var b=a.index,d=app.tabs.categoryBulkEditor[b.capitalize()];if(d){d=new d(a.panel,this);this.tab_objs[b]=d;d.ids=this.ids;d.init();var c=a.panel.find(".bulk-editor-form");c.find(".submit-button").on("click",function(){var a=c.serializeObject();bm.ajax({url:c.attr("action"),data:a,success:function(a){app.global_event.trigger("category-update");app.global_event.trigger("category-bulk-updated-"+b)},error:function(a,b,c){bm.notify(c.message,"error")}})})}};
_be.close=function(a){$("body").find(".bulkedit-parent-td-proxy").remove();app.tabs.categoryBulkEditor._super.close.call(this)};
_be.save=function(a){var b=this,d={};$.each(b.panels,function(a,b){b.isDirty&&(d[a]=b)});var c=1,f=Object.keys(d).length,g=!1;f||b.close(!0);bm.iterate(d,function(d,l){l=l.toString();var m=this;m.trigger("before-editor-close",a);var q=m.find(".bulk-editor-form"),e=q.serializeObject();bm.ajax({url:q.attr("action"),data:e,success:function(){app.global_event.trigger("category-update",[b.ids]);m.clearDirty();!b.isDirty()&&a?a():d.next();g&&b.close(!0)},error:function(){b.setActiveTab(l);d.next()},invalid:function(){b.setActiveTab(l);
m.find("form").valid("position");d.next()}});c==f&&(g=!0);c++})};_be.activePanel=function(){var a;$.each(this.panels,function(b,d){d.is(":visible")&&(a=d)});return a};_be.allPanel=function(){return this.body.find(".bmui-tab-panel")};_be.status={true:"positive",false:"negative"};app.editCategory=function(a,b){this.itemTab=a;this.category=b;app.editCategory._super.constructor.call(this,arguments)};
(function(){function a(a,b,d,m){a.find(b).on("click",function(){bm.customerAndGroupSelectionPopup(a,{customerField:d,groupField:m})})}var b=app.editCategory.inherit(app.MultiTab),d=app.editCategory._super;b.changeHeader=!1;b.init=function(){var a=this;a.itemTab.renderCreatePanel(app.baseUrl+"categoryAdmin/loadCategoryEditor",$.i18n.prop("edit.category"),a.category.name,{id:a.category.id},{createPanelTemplate:$('<div class="embedded-edit-form-panel create-panel fade-in-up"><div class="header"><span class="header-title"></span><span class="toolbar toolbar-right"><span class="tool-group toolbar-btn save save-all">'+
$.i18n.prop("save.all")+'</span><span class="tool-group toolbar-btn cancel">'+$.i18n.prop("cancel")+'</span></span></div><div class="body"></div></div>'),ajax:{show_success_status:!1},submit_n_cancle:!1,content_loaded:function(b){a.body=this;a.header=this.find(".header");d.init.apply(a,arguments)}})};app.editCategory.tabInitFuncs={productSettings:function(b){b=b.find("form");a(b,".restrict-price-except-select-customer","restrictPriceExceptCustomer","restrictPriceExceptCustomerGroup");a(b,".restrict-purchase-except-select-customer",
"restrictPurchaseExceptCustomer","restrictPurchaseExceptCustomerGroup")},basic:function(a){var b=this.category,c=a.find("form");a.find(".select-customer").on("click",function(){var a=$(this);if(c.find("[name='isCustomerSelectorDirty']").length)bm.customerAndGroupSelectionPopup(c,{}).on("close",function(b,c){c||a.trigger("change")});else bm.customerAndGroupSelectionPopup(c,{url:app.baseUrl+"categoryAdmin/customerSelectionPopup?id="+b.id}).on("close",function(b,c){c||a.trigger("change")})});var d=bm.getUUID();
a.find("#catAvailFrom").attr("id",d);a.find("#catAvailTo").attr("validation","skip@if{self::hidden} either_required["+d+","+$.i18n.prop("from")+" ,"+$.i18n.prop("to")+"]")},metatags:function(a){bm.metaTagEditor(a)},link:function(a){bm.initProductSelection(a,"linked",{"column-sort":!1})}};b.save=function(a){var b=this;bm.iterate(this.panels,function(c,d){var f=this;f.isDirty?f.find("form").form("submit",{success:function(){f.clearDirty();b.isDirty()?c.next():a&&a()},error:function(){b.setActiveTab(d);
c.next()},invalid:function(){b.setActiveTab(d);b.find("form").valid("position");c.next()}}):c.next()})};b.onContentLoad=function(a){var b=this;a.panel.find("form").form({ajax:{success:function(){app.global_event.trigger("category-update",[b.category.id]);a.panel.clearDirty()}}});"function"==typeof app.editCategory.tabInitFuncs[a.index]&&app.editCategory.tabInitFuncs[a.index].call(this,a.panel)}})();
bm.onReady(app.tabs,"customerBulkEditor",function(){function a(){var a=this,b=a.table.find("td.togglable.custom-toggle"),d=b.find(".fake-link"),f=b.find(".toggle-block");b=f.find("input[type='checkbox']");var q=f.find(".reset-status");d.on("click",function(){$(this).hide();f.show()});b.on("change",function(){var b=$(this),c=a.table.find("td.togglable.customer-status"),d=$("<input type='hidden' name='status' class='hidden-status'/>"),g=f.find("input[name=status]");g.length?b.is(":checked")?g.val("A"):
g.val("I"):(b.is(":checked")?d.val("A"):d.val("I"),f.append(d));c.each(function(){var a=$(this);b.is(":checked")?a.find("input[type='checkbox']").prop("checked",!0):a.find("input[type='checkbox']").prop("checked",!1)})});q.on("click",function(){c.body.find(".toolbar-item.reload").trigger("click")})}function b(){function a(a){var c=ValidationField.validateAs(a,a.attr("validation"));return c?(bm.notify($.i18n.prop(c.msg_template,c.msg_params),"alert"),b(a),!1):!0}function b(a){t.attr("disabled",!0);
a.addClass("error-highlight");setTimeout(function(){a.removeClass("error-highlight");t.removeAttr("disabled")},1E3)}var d=this,f=d.table.find("td.change-all.store-credit"),q=f.find(".fake-link"),e=f.find(".store-credit-block"),p=e.find("input[name=deltaAmount]"),t=e.find(".apply-button");f=e.find(".reset-store-credit");var w=e.find(".note"),y=p.attr("restrict");if(y)p[y]();q.on("click",function(){$(this).hide();e.show()});p.on("focusout",function(){if(0==a(p))return!1});w.on("click",function(){var a=
e.find("input[name=noteText]").val(),b=$("<form class='edit-popup-form'><div class='form-row'><label>"+$.i18n.prop("note")+"</label><textarea name='noteText' validation='maxlength[500]'></textarea></div><div class='button-line'><button type='submit' class='submit-button'>"+$.i18n.prop("done")+"</button><button type='button' class='cancel-button'> "+$.i18n.prop("cancel")+"</button> &nbsp; &nbsp;</div></form>"),c=b.find("textarea[name=noteText]");a?c.val(a):"";bm.editPopup(void 0,$.i18n.prop("add.store.credit.note"),
void 0,void 0,{content:b,events:{content_loaded:function(){c.focus()}},beforeSubmit:function(a,b,d){d.close();a=c.val();b=$("<input type='hidden' name='noteText' value=''>");b.val(a);d=e.find("input[name=noteText]");d.length?d.val(a):e.append(b);return!1}})});t.on("click",function(){$(this);var b=$(this).parent(),c=b.find(".action").val(),e=b.find("input[name=deltaAmount]").val();if(0==a(p))return!1;d.table.find("td.store-credit").not(".change-all").each(function(){var a=$(this).find(".value"),b=
a.text().replace(",","");"true"==c?b=parseFloat(b)+parseFloat(e):(b=parseFloat(b)-parseFloat(e),0>b?b=0:"");a.text(b)});b.hide();q.show()});f.on("click",function(){c.body.find(".toolbar-item.reload").trigger("click")})}var d,c;app.tabs.customerBulkEditor.Basic=function(a,b){d=a;c=b};var f=app.tabs.customerBulkEditor.Basic.prototype;f.reload=function(){this.tabulator.reload()};f.afterTableReload=function(){d.clearDirty();c.body.find(".bmui-tab-body-container").find(".bulkedit-parent-td-proxy").remove()};
f.init=function(){var c=this;app.global_event.on("customer-bulk-updated-basic",function(){c.reload()});this.tabulator=bm.table(d.find(".customer-bulk-edit-tab.basic-table"),{url:app.baseUrl+"customerAdmin/loadCustomerBulkProperties",beforeReloadRequest:function(){c.beforeReloadRequest(this.param)},afterLoad:function(){d.tool.filter(".action-header:visible").hide();c.afterTableReload&&c.afterTableReload()},onload:function(){}});c.beforeReloadRequest=function(a){$.extend(a,{property:"basic",ids:this.ids})};
this.table=d.find(".body table");a.call(this);b.call(this)};app.tabs.customerBulkEditor.errorHighlight=function(a){var b=c.activePanel().find(".submit-button");b.attr("disabled",!0);a.addClass("error-highlight");setTimeout(function(){a.removeClass("error-highlight");b.removeAttr("disabled")},1E3)}});
app.tabs.customerBulkEditor=function(){app.tabs.customerBulkEditor._super.constructor.apply(this,arguments);this.text=$.i18n.prop("customer.bulk.edit");this.tip=$.i18n.prop("customer.bulk.edit");this.ui_class="customer-bulk-editor edit";this.ids=JSON.stringify(this.customerIds);this.ajax_url=app.baseUrl+"customerAdmin/loadCustomerBulkEditor?ids="+this.ids;this.tab_objs={}};_be=app.tabs.customerBulkEditor.inherit(app.MultiTab);
_be.init=function(){this.body.find(".bmui-tab");app.tabs.customerBulkEditor._super.init.apply(this,arguments)};_be.changeTabUrl=function(a,b){this.body.find(".bmui-tab").tabify("reload",a,b)};
_be.onContentLoad=function(a){var b=this,d=a.index,c=app.tabs.customerBulkEditor[d.capitalize()];if(c){c=new c(a.panel,this);b.tab_objs[d]=c;c.ids=b.ids;c.init();var f=a.panel.find(".bulk-editor-form");f.find(".submit-button").on("click",function(){var a=f.serializeObject();bm.ajax({url:f.attr("action"),data:a,success:function(a){app.global_event.trigger("customer-update");b.panels[d].reload();b.clearDirty()},error:function(a,b,c){bm.notify(c.message,"error")}})})}};
_be.close=function(a){$("body").find(".bulkedit-parent-td-proxy").remove();app.tabs.customerBulkEditor._super.close.call(this)};
_be.save=function(a){var b=this,d={};$.each(b.panels,function(a,b){b.isDirty&&(d[a]=b)});var c=1,f=Object.keys(d).length,g=!1;f||b.close(!0);bm.iterate(d,function(d,l){l=l.toString();var m=this;m.trigger("before-editor-close",a);var q=m.find(".bulk-editor-form"),e=q.serializeObject();bm.ajax({url:q.attr("action"),data:e,success:function(){app.global_event.trigger("customer-update",[b.ids]);m.clearDirty();!b.isDirty()&&a?a():d.next();g&&b.close(!0)},error:function(){b.setActiveTab(l);d.next()},invalid:function(){b.setActiveTab(l);
m.find("form").valid("position");d.next()}});c==f&&(g=!0);c++})};_be.activePanel=function(){var a;$.each(this.panels,function(b,d){d.is(":visible")&&(a=d)});return a};_be.allPanel=function(){return this.body.find(".bmui-tab-panel")};
(function(){var a=function(a){app.Tab.call(this,a);this.constructor_args=arguments;this.text=$.i18n.prop("document.designer");this.tip=$.i18n.prop("document.designer");this.ui_class="doc-designer basic-panel";this.ajax_url="document/editDocument"};$jscomp.inherits(a,app.Tab);a.prototype.init=function(){app.Tab.prototype.init.call(this)};a.prototype.reinit=function(){app.Tab.prototype.reinit.call(this);this.attachEvents()};a.prototype.attachEvents=function(){var a=this;a.ajax_data&&a.ajax_data.id?
a.documentId=a.ajax_data.id:delete a.documentId;a.documentSizes={letter:[215.9,279.4],legal:[215.9,355.6],ledger:[279.4,431.8],a0:[841,1189],a1:[594,841],a2:[420,594],a3:[297,420],a4:[210,297]};a.itemTemplate="<div class='filler-row each-component' style='position: absolute'><span class='remove'></span></div>";var d=bm.floatingPopup(a.body.find(".create-new.floating-popup"),{clazz:"create-new-document"});a.body.find(".sample-layouts-container").on("click",".layout",function(){var b=$(this).data().id,
d=$(this).data().type;a.ajax_data=$.extend(a.ajax_data,{id:b,layoutUsed:!0,type:d});a.documentId=b;a.editLayout()});d.find(".action-item").click(function(){var b=this.jqObject.data();a.ajax_data=$.extend(a.ajax_data,{type:b.action});a.editLayout()});a.documentId&&a.editLayout();a.body.find(".sample-layouts-container .body").scrollbar()};a.prototype.editLayout=function(){var a=this,d=this,c=this.body.find(".app-tab-content-container");this.body.loader();c.fill({data:d.ajax_data,controller:"document",
action:"renderEditor",response:function(){a.body.loader(!1)},success:function(){function b(a){var b;p.every(function(c){var d=a.top-c.pos.top;0<d&&(!b||b.dist>d)&&(b={dist:d,row:c})});return b}function g(a,b){var c=a.prev().length?a.prev().tag("rowData").pos:null;a.css("margin-top",b.top-(c?c.top+c.height:0)-q.css("padding-top"))}function m(a){var c=a.pposition(),d=l(c),e=!d;if(e){var f=b(c);d={elm:"<div class='filler-row'></div>".jqObject};f?f.row.elm.after(d.elm):q.prepend(d.elm);g(d.elm,c);p.push(d)}d.elm.append(a.addClass("sorted"));
if(e){d.pos=d.elm.pposition(null,!0);d.elm.tag("rowData",d);var m=d.elm.css("margin-top").toNumber()+d.pos.height;d.elm.nextAll().each(function(){this.jqObject.css("margin-top","-="+m)})}}function l(a){return p.find(function(b){return bm.isOverAxis(a.top,b.pos.top,b.pos.height)})}function n(){w.each(function(){var a=this.jqObject;m(a);if(a.is(".area")){var b=q;q=a;var c=p;p=[];var d=w;w=a.tag("children");n();p=c;q=b;w=d}})}var q=c.find(".editing-area");c.replaceClass("layout-panel","editor-panel");
var e=c.find(".document-details-from"),p=[],t=$();c.find(".document-component.area").each(function(){var a=$(),b=this.jqObject,d=b.pposition(null,!0);c.find(".document-component").not(b).each(function(){var b=this.jqObject,c=b.pposition();bm.isOverAxis(c.top,d.top,d.height)&&bm.isOverAxis(c.left,d.left,d.width)&&(a=a.add(b))});b.tag("children",a);t=t.add(a)});var w=c.find(".document-component").not(t);n();var y=q.attr("style");y=(new CssParser(y?"#document-root{"+y+"}":"#document-root{}")).parse().getRule("#document-root");
$.each(y.attributes,function(a,b){if(b.key.startsWith("padding")){if("padding"==b.key){var c,f,g;if(1==b.value.split(" ").length)var l=c=f=g=b.value.split(" ")[0];else 2==b.value.split(" ").length?(l=f=b.value.split(" ")[0],c=g=b.value.split(" ")[1]):3==b.value.split(" ").length?(l=b.value.split(" ")[0],c=g=b.value.split(" ")[1],f=b.value.split(" ")[2]):4==b.value.split(" ").length&&(l=b.value.split(" ")[0],c=b.value.split(" ")[1],f=b.value.split(" ")[2],g=b.value.split(" ")[3]);e.find("input[name='padding-top']").val(l.split("mm")[0]);
e.find("input[name='padding-bottom']").val(f.split("mm")[0]);e.find("input[name='padding-left']").val(g.split("mm")[0]);e.find("input[name='padding-right']").val(c.split("mm")[0])}e.find("[name='"+b.key+"']").val(b.value.split("mm")[0])}else if("height"==b.key){var m=b.value.split("mm")[0];$.each(d.documentSizes,function(a,b){b[1]==m&&e.find("select[name=paperSize]").val(a).trigger("chosen:updated")})}else"font-size"==b.key?e.find("select[name=fontSize]").val(b.value.split("px")[0]).trigger("chosen:updated"):
"font-family"==b.key&&(a=b.value.split(",")[0],a=a.split('"'),1<a.length&&(a=a[1]),e.find("select[name=fontFamily]").val(a).trigger("chosen:updated"))});a.attachEditorEvents(c);d.clearDirty()}})};a.prototype.attachEditorEvents=function(a){var b=this;b.bindToolBar();a.find(".document-details-from").form({ajax:!0,validation_config:{validate_on_call_only:!0}});a.find(".document-details-from").on("change",function(a){var c=a.target.jqObject;if(c.valid()){var d=c.attr("name");b.changeDetails(d,c.val(),
a)}});a.find(".left-tab-container").each(function(){this.jqObject.scrollbar()});a.find(".editor-main-panel").scrollbar();a.on("click",".component-config .close-config",function(){b.removeComponentConfig();b.body.find(".editing-area .filler-row").removeClass("selected")});a.on("change",".component-config",function(a){var c=this.jqObject;a.target.jqObject.is("input.inline-edit-input")||(a=c.serializeObject(),c=c.find("input[name=image]"),b.updateTemplateCache(b.body.find(".editing-area .filler-row.selected"),
a,c))});a.on("click",".add-column",function(){var a=this.jqObject.prev("table").find("tbody");a.sortable("destroy");var d=a.find("tr:first").find("select").clone();d.attr("name","value-#LABEL#");d.removeAttr("disabled");d.prop("selectedIndex",0);d='<tr class="'+b.ajax_data.type+'-column"><td class="name"><span class="inline-editable" data-editable-validation="required maxlength[100]">#LABEL#</span><input class="column-name" type="hidden" name="column-#LABEL#" value="#LABEL#"></td><td class="value">'+
d.prop("outerHTML")+'</td><td class="action"><span class="remove remove-column"></span></td></tr>';var g="New Column "+a.find("tr").length;d=d.replaceAll("#LABEL#",g).jqObject;a.append(d);a.sortable({axis:"y",placeholder:!0,stop:function(){a.closest(".component-config").trigger("change")}});d.updateUi();b.bindInlineEditable(d.find(".inline-editable"));d.trigger("change")});a.on("click",".component-config .remove-column",function(){var a=this.jqObject.parents("table");this.jqObject.parents("tr").remove();
a.trigger("change")});a.on("click",".component-config .multi-button .button",function(){b.alignComponent(this.jqObject.data("action"))});this.attachComponent();this.bindDragDrop();this.bindMacroSearchEvents()};a.prototype.alignComponent=function(a){var b=this.body.find(".editing-area"),c=b.find(".filler-row.selected");switch(a){case "send-back":b.prepend(c);break;case "back":c.prev().before(c);break;case "front":c.next().after(c);break;case "bring-front":b.append(c)}};a.prototype.bindToolBar=function(){var a=
this,d=a.body.find(".document-details-from"),c=a.body.find(".toolbar.toolbar-right"),f=a.body.find(".toolbar-template");c.html(f.html());f.remove();c.find(".document-details-from-submit").on("click",function(){d.valid()&&a.save()});c.find(".toolbar-btn.reset").click(function(){bm.confirm($.i18n.prop("unsaved.content.will.reset.are.you.sure"),function(){a.reload()},function(){})});c.find(".toolbar-btn.cancel").on("click",function(){a.isDirty()?bm.confirm($.i18n.prop("there.unsaved.content.wanna.save"),
function(){a.save(function(){a.ajax_data=void 0;a.reload()})},function(){a.ajax_data=void 0;a.reload()}):(a.ajax_data=void 0,a.reload())});c.find(".toolbar-btn.preview").click(function(){var b=a.body.find(".document-details-from").find("#paperSize").val();b={position:"relative",height:a.documentSizes[b][1]+"mm"};var c=a.body.find(".editing-area").clone();c.css(b);c.find(".editable").each(function(a,b){b.jqObject.removeAttr("contenteditable")});bm.editPopup(void 0,$.i18n.prop("preview"),void 0,void 0,
{content:c})})};a.prototype.bindInlineEditable=function(a){a.editable().on("inlinechange",function(){var a=this.jqObject;a.next(".column-name").val(a.text()).trigger("change")})};a.prototype.attachComponent=function(){var a=this,d=a.body.find(".editing-area");a.documentId&&a.decodeDocument(d);var c=a.body.find(".left-detail-panel").tabify("inst");d.on("click",".filler-row",function(b){if(!b.target.jqObject.is(".remove")){var f=this.jqObject;b=a.getTemplateCache(f);a.body.loader();bm.ajax({url:app.baseUrl+
"document/componentConfig",data:b,dataType:"html",response:function(){a.body.loader(!1)},success:function(b){b=b.jqObject;d.find(".filler-row").removeClass("selected");f.addClass("selected").focus();a.removeComponentConfig();a.body.find("#bmui-tab-doc-designer-left-tab-component-list").append(b);b.updateUi();b.find("tbody").sortable({axis:"y",placeholder:!0,stop:function(){b.trigger("change")}});a.bindInlineEditable(b.find(".inline-editable"));var g=f.find("img.value");g.length&&(b.find("#doc-image-preview").attr("src",
g.attr("src")),g.attr("src")&&b.find(".dropzone-wrapper").addClass("file-added"));a.bindColorPicker(b);c.activate("doc-designer-left-tab-component-list");b.find(".config-body").scrollbar();bm.autoToggle(b)}})}}).blur(function(){});d.on("click",".filler-row .remove",function(){this.jqObject.parents(".filler-row").remove();a.removeComponentConfig();a.setDirty()})};a.prototype.decodeDocument=function(a){var b=this,c=a.find(".filler-row");a=a.find(".components");a.css("position","absolute");c.css("position",
"absolute");c.filter(".full-width-component").each(function(){var a=this.jqObject;a.css("left",a.data("left"));a.css("top",a.data("top"));var b=a.find(".value").clone();a.html(b)});a.each(function(){var a=this.jqObject;a.css("top").pxToVal();var b=a.find(".filler-row");b.each(function(){var a=this.jqObject;a.css("left",a.data("left"));a.css("top",a.data("top"))});a.replaceWith(b)});c.prepend('<span class="remove"></span>');b.rebindDragResize(c);c.each(function(){var a=this.jqObject;a.is(".data_table")?
b.bindDataTableEvents(a):a.is(".text")&&(a.find(".editable")[0].contentEditable=!0)})};a.prototype.removeComponentConfig=function(){var a=this.body.find(".component-config");a.find(".color-picker").spectrum("destroy");a.remove()};a.prototype.bindColorPicker=function(a){a.find(".color-picker").spectrum({preferredFormat:"hex",allowEmpty:!0,showInput:!0,showInitial:!0,showButtons:!1,clickoutFiresChange:!0,change:function(a){var b=this.jqObject;b.prev(".value").text(a?a.toHexString():"transparent");b.val(a?
a.toHexString():"transparent");b.trigger("change")}})};a.prototype.changeDetails=function(a,d){var b=this.body.find(".document-details-from"),f=this.body.find(".editing-area");switch(a){case "paperSize":a=this.documentSizes[d];f.css({width:a[0]+"mm",height:a[1]+"mm"});break;case "fontFamily":a=b.find("#fontSize").val();f.css({font:a+"px '"+d+"', sans-serif"});break;case "fontSize":a=b.find("#fontFamily").val();f.css({font:d+"px '"+a+"', sans-serif"});break;default:a.startsWith("padding")&&(b={},b[a]=
d+"mm",f.css(b))}this.setDirty()};a.prototype.save=function(a){var b=this,c=this.body.find(".app-tab-content-container").find(".document-details-from");c={name:c.find("input[name=name]").val(),description:c.find("[name=description]").val()};$.extend(c,{id:b.documentId,content:b.encodeDocument()});b.documentId||(c.type=b.ajax_data.type);b.ajax_data.layoutUsed&&(c.type=b.ajax_data.type,c.layoutUsed=b.ajax_data.layoutUsed);this.body.loader();bm.ajax({url:app.baseUrl+"document/save",data:c,response:function(){b.body.loader(!1)},
success:function(c){delete b.ajax_data.layoutUsed;b.ajax_data=c.id;b.documentId=c.id;b.reload();var d=app.Tab.getTab("tab-doc");d&&d.reload();a&&a.apply(this,arguments)}})};a.prototype.encodeDocument=function(){var a=this,d=a.body.find(".editing-area"),c=d.css("padding-top").pxToVal(),f=d.css("padding-left").pxToVal(),g=a.body.find(".editing-area"),m=a.sortByPosition(g.find(".filler-row")),l=m.filter(".full-width-component"),n=g.clone().empty();if(l.length){var q=m.not(".full-width-component");l.each(function(){var b=
this.jqObject,g=b.css("top").pxToVal(),m=$('<div class="components" style="position: relative;"></div>'),w=m.clone();q.each(function(){var a=this.jqObject,c=a.css("top").pxToVal(),d=a.clone();c<g?(m.append(d),q=q.not(a),d.data("original",a),d.attr("data-left",a.css("left")),d.attr("data-top",a.css("top"))):b.nat==l.last().nat&&(w.append(d),q=q.not(a),d.data("original",a),d.attr("data-left",a.css("left")),d.attr("data-top",a.css("top")))});if(m.children().length){n.append(m);var y=m.prev(".full-width-component"),
A=d.find(".full-width-component[data-uuid="+y.data("uuid")+"]"),x=c;y.length&&(x=y.css("top").pxToVal()+A.outerHeight(!0));m.find(".filler-row").each(function(){var a=this.jqObject;a.css("top",a.css("top").pxToVal()-x);a.css("left",a.css("left").pxToVal()-f)});m.css("height",c+a.getOuterHeightByInnerPosition(m.find(".filler-row")))}y=b.clone();y.attr("data-left",y.css("left"));y.attr("data-top",y.css("top"));A=y.find(".row");A.data("each")&&(A.before("%each:"+A.data("each")+"%"),A.after("%each%"));
y.css({position:"relative",left:"auto",top:"auto"});n.append(y);if(w.children().length){n.append(w);A=d.find(".full-width-component[data-uuid="+b.data("uuid")+"]");var z=b.css("top").pxToVal()+A.outerHeight(!0);w.find(".filler-row").each(function(){var a=this.jqObject;a.css("top",a.css("top").pxToVal()-z);a.css("left",a.css("left").pxToVal()-f)});w.css("height",c+a.getOuterHeightByInnerPosition(w.find(".filler-row")))}})}else m.length&&(g='<div class="components" style="position: relative;"></div>'.jqObject,
m.each(function(){var a=this.jqObject;a.css("top",a.css("top").pxToVal())}),g.append(m),n.html(g));n.find(".editable").removeAttr("contenteditable");m=n.find(".filler-row");m.removeClass("selected bmui-resizable bmui-draggable");m.find(".remove").remove();m.find(".bmui-resize-handle").remove();return n.prop("outerHTML")};a.prototype.getOuterHeightByInnerPosition=function(a){var b=$();a.each(function(){b=b.add(this.jqObject.data("original"))});b=this.sortByPosition(b);a=b.first().css("top").pxToVal();
var c=this.sortByBottom(b).first(),f=c.css("top").pxToVal();c=c.outerHeight(!0);return f-a+c};a.prototype.sortByBottom=function(a){a=a.toArray();a=a.sort(function(a,b){a=a.jqObject.pposition().bottom;b=b.jqObject.pposition().bottom;return a-b});return a.jqObject};a.prototype.sortByPosition=function(a){a=a.toArray();a=a.sort(function(a,b){a=a.jqObject.css("top").pxToVal();b=b.jqObject.css("top").pxToVal();return a-b});return a.jqObject};a.prototype.bindDragDrop=function(){var a=this,d=a.body.find(".editing-area"),
c=a.body.find(".component-body").find(".component-item"),f=parseFloat(d.css("padding-top").split("px")[0]),g=parseFloat(d.css("padding-left").split("px")[0]),m=parseFloat(d.css("padding-bottom").split("px")[0]),l=parseFloat(d.css("padding-right").split("px")[0]);c.draggable({append_on_drop:!1,helper:"clone",drop:d,skip:".bmui-resize-handle",containment:{top:f,right:l,bottom:m,left:g},stop:function(b){b=b.elm;var c=a.body.find(".editing-area"),d=a.collectTemplate(b);c.append(d);a.setTemplatePosition(b,
d);a.rebindDragResize(d);d.trigger("click")}})};a.prototype.setTemplatePosition=function(a,d){var b=this.body.find(".editing-area");d=d||a;var f=b.offset(),g=a.offset(),m=a.offset(),l=f.left+b.outerWidth(!1),n=f.top+b.outerHeight(!1),q=g.left+d.outerWidth(!0),e=g.top+d.outerHeight(!0),p=parseFloat(b.css("padding-top").split("px")[0]),t=parseFloat(b.css("padding-left").split("px")[0]),w=parseFloat(b.css("padding-bottom").split("px")[0]),y=parseFloat(b.css("padding-right").split("px")[0]);g.left>f.left+
t&&q<l-y?m.left=g.left-f.left:(g.left<f.left+t&&(m.left=t),q>l-y&&(m.left=b.width()+t-d.outerWidth(!0)));g.top>f.top+p&&e<n-w?m.top=g.top-f.top:(g.top<f.top+p&&(m.top=p),e>n-w&&(m.top=b.height()+w-d.outerHeight(!0)));a.is(".full-width-component")&&(m.left=t,d.css({width:"calc(100% - "+2*t+"px)"}));d.css(m);this.setDirty();return m};a.prototype.rebindDragResize=function(a){var b=this,c=b.body.find(".editing-area");a.resizable({containment:"parent",stop:function(){b.setDirty();var c=a.find("img.value");
c.length&&(c.css("width",a.width()),c.css("height",a.height()))}});a.draggable({drop:c,containment:"offset",disable_text_selection:!1,skip:".bmui-resize-handle",stop:function(a){b.setTemplatePosition(a.elm)}})};a.prototype.collectTemplate=function(a){var b=$(this.itemTemplate).attr("data-uuid",bm.getUUID()),c=a.data(),f=c.type,g=this.body.find(".editing-area");parseInt(g.css("padding-left").split("px")[0]);b.attr("data-type",f);b.data("type",f);b.addClass(f);b.css({"min-width":"50px"});b.find(".value").text(a.find(".title").text());
switch(f){case "area":b.append("<div class='value' style='width: 640px; height: 150px; background-color: rgb(238, 238, 238)'></div>");break;case "line":b.css({width:"200px"});b.append("<div class='value' style='border-top: 1px;border-top-width: 1px;border-top-style: solid'></div>");break;case "text":b.css({width:"120px"});b.append('<div class="value editable">Text</div>');b.dblclick(function(){b.find(".editable")[0].contentEditable=!0});break;case "invoice_table":this.populateInvoiceTable(b);break;
case "order_table":this.populateOrderTable(b);break;case "delivery_docket_table":this.populateDeliveryDocketTable(b);break;case "picking_slip_table":this.populatePickingSlipTable(b);break;case "data_table":this.populateDataTable(b);this.bindDataTableEvents(b);break;case "image":b.append('<img class="value" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxMUUzOTkyQURDOUVFNDExQTgyNThFMzNGNjA1M0Q3NSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo0N0Y3RjRFQzlFRTcxMUU0OUZGOEMyQzM1NDFDQzBCQyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo0N0Y3RjRFQjlFRTcxMUU0OUZGOEMyQzM1NDFDQzBCQyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyRTM5OTJBREM5RUU0MTFBODI1OEUzM0Y2MDUzRDc1IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjExRTM5OTJBREM5RUU0MTFBODI1OEUzM0Y2MDUzRDc1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+9/GMdwAAB79JREFUeNrsnVlTFFcYhg+4gSKyTAAFxSWWGo2mVEyZXKTKq1T+Uq6T/JHkJ5jKlVW5SCwX3AggIjsow86IoCyS87Zzxp6mZwEaGZjnqTo69uDM9Omnv+87p4fTJfF43FiO2/aLbT/ZVmsA1s+kbX/a9rNtQyVWrEb7oNW2evoGIkCR6nqp/eM3pIIIkUu/KmIphNXQHxAh06VIBVtAdSl9AFsBYgFiAWIBYgEgFiAWIBYAYgFiAWIBIBYgFiAWAGIBYgFiASAWIBYgFgBiAWIBYgEgFiAWIBYAYgFiAWIBIBYgFiAWAGIBYgFiASAWIBYgFgBiAWIBYgGsj73FtsNLy8tmaWlpW977YHk5Yu1WhoaHzYve3m157x9v3UKs3cyhgwfNtStXPtv7JRIJ86S9nVS46wvL0tLPmpbev39P8Q6bE2hmdtasrKxQvKNDNHTbuq13YMCsrq6afXv3mm8uXTK1NcV7xz4iVgaW1xF1pmdmTE9/vyeVG3k+7egwHz58QCz4hNJZ2zqKbYkVZHFx0bydn0cs+MSr0VETn5gwvTYK5UNZWdmabSUlJebA/v2IBR9R+no9NvaxburrM5NTUzn/T0NdnTlcUZG2rbmpyewvYrEo3gOMT06mZuZVM6lW+q6lxZQdOJB1+uLbq1fN8KtXZn5hwdRUVZmG+npGhZCeBoO10pO2NnPDiiOBMnakHQmePHGCDiQVrkWRShFrTTGfSJjn3d10EGJtjFFbW2WaIhgcGVkTzRyJN2/oPMTKzMjr11mfb+/qMm/m5lL/Xl5eNo9tmrzX2mrmi3hqAbGyoKJbKS8bulQjkSSUBPv34UMTHx83KzbK/dfZSSdSvIcU7TmilV/AB48fmzkbofzXBKdmZ82QTZfHGxvpTCKWT6x4PO+fnbU1VdiF5q6XL827IvwmA2JlQJdkFIk2i64vtpMSESsVrTKM9jbC+NRUpK+HWDsUTS+MJi/hRIXmvDSxilhFzNjEhPc1lyhZXFoynS9eMCosZvQVZX0pb6uiYbbLQIi1i6k8fNhrQCoEIlZholnzv+7c4egjVnQcbWgwRyorOfKIFS3lZWVeA2osQCwAxALEAsQCQCxALEAsAMQCxALEAsQCQCxALEAsgIjZ1u9j/X33burxmeZm03TsWNrzbZ2dZiq5vue5M2e8lfMc+o3j0XjcDIyMpLZVVlSYo/X1aT+XCS2S1jMw4D1ubGgwX5465a3d8DSw9uj3LS3e2ld+tHbDPw8epG27cvGiqQp8gXDu7VvT+uxZ1n30v6Z+Dc19JrFvzx5zoqkpa79kQou/fX3hAhFrcHjY69x8kAD3Hj1Kk0ok5uZMV0+P1/FRMRGyVGS+v4c4EVhra3p2NvTnJOB9uz9+qcTSyoq3zS1EQsTaAOpERZFcq+IpUnU8f57698Vz50yspsbr+M7ubu9MVusfHIxkhT2toByMgBIhH4Ii6XPpcwYjYEdXl7f/ormxMfW5XWTSCdM/NORF1SDZoiA1VhJFoFyLakg+dxDUqbHkIv06WGdPn057rSjO8qnp6bTX0WOtqJwLyZdIrqWllJYpAir6LST3WancfzJcOHs29XhsfJzifTNInFwH2lF15Ejac1qAVrVFtjSWL5XJVZAlsX/dLP9j/3uFRTqH6qSw7cHo90VtbXo6sSeLTh41vcZOSocFI5YKaDEyOpo11Sz4IlowpQj/L0ps5kDotZ1cc75V/JwYlYHlt4P41zJVKnVRKywCZkNpzrWw/aXGykHMnq3qdInTZ+uj7RzR+COI0plWj3EpyqUkPZepGJcsLg1KQAlxzJ44Ss8uAroUvtl1I1TcB4v+7R4RFpRY4vTJk946nypYcy3buNVIDpdqJYOiqNa/cvWdngtbYTk4aqxOvkaFL8Ip6sVy3MDJPxWTbUqDiJVP1LKdrbNNYvXZs3A7Q7+W5q44dMiLOIo+ksGlLW3Tc5luAexP5U4ovxCKem6Et2+T+1ioo8KCS9paw9MNscMotwW6q7O8Ax24Y8TCu3dZa7D1ooijz+K/Y0WwyA5GOv+oURE4bGpFEVmyZbrjxQ83b3p/a35rYQcuP1lwo0J1dn0slvH5murqjCMsTVX4Z6Rjm7hfoDuYsaREksttcykyrPDON4XPJD+n/wZPmVLrTqQgrxVmm9hU2HcjLBWtbkpBB7nbdxNxTTRGEbGU8sp9UUWPtc1FniD+2XZN3iryuHbt8uVP6TAZ1TRidK/vTYTagYtf0p02416wqdDNR2n6YSRkLU8999X586lremGpRnValPe1qbMR1F0+qssSTdfMswUKbSepIp+aajFtu2yL8md2f7RN7xO8VOWmY8IK97BRYSGMDAv22w3+yBSWLnW3rebAmuoqqnWxOuoOjflqqliW+kqjQRfF3DRDmKTBVK6T5aqNZirEg/usfdRoMOxyTiFTEo/HVw1AsUQsQCwAxALEAsQCQCxALEAsAMQCxALEAkAsQCxALADEAsQCxAJALEAsQCxALLoAEAsQCxALALEAsQCxABALEAsQCwCxALEAsQAQCxALEAsAsQCxALEAEAsQCxALIAKxpugGiJhpiXWbfoCIua2bNOn+a/dtq6c/IALitl1XxNKdF1ts+10hjH6BjaY/2/6w7YZtw/8LMADsuV+f/9GuvQAAAABJRU5ErkJggg=="/>');
break;case "macro":b.append('<div class="value">%'+c.macro+"%</div>");b.attr("data-macro",c.macro);break;default:b.append('<div class="value"></div>')}b.attr("config",JSON.stringify({type:f}));return b};a.prototype.updateTemplateCache=function(a,d,c){var b=a.data("type");d=$.extend({type:b},d);var g={};d.width&&(g.width=d.width);d.height&&(g.height=d.height);d.borderSize&&(g["border-width"]=d.borderSize);d.borderStyle&&(g["border-style"]=d.borderStyle);d.borderColor&&(g["border-color"]=d.borderColor);
d.backgroundColor&&(g["background-color"]=d.backgroundColor);d.lineStyle&&(g["border-top-style"]=d.lineStyle);d.borderTopWidth&&(g["border-top-width"]=d.borderTopWidth+"px");d.lineColor&&(g.color=d.lineColor);var m=JSON.parse(a.attr("config")).orientation;a.attr("config",JSON.stringify(d));switch(b){case "image":c&&c.length&&c.nat.files.length&&(b=new FileReader,b.addEventListener("load",function(b){a.find("img").attr("src",b.target.result)}),b.readAsDataURL(c.nat.files[0]));a.find("img").css(g);
break;case "invoice_table":this.updateInvoiceTable(a,d);break;case "order_table":this.updateOrderTable(a,d);break;case "delivery_docket_table":this.updateDeliveryDocketTable(a,d);break;case "picking_slip_table":this.updatePickingSlipTable(a,d);break;case "data_table":this.updateDataTable(a,d);break;case "text":case "macro":this.updateText(a,d);break;case "line":this.updateLine(a,d,g,m);break;default:a.find(".value").css(g)}this.setDirty();return d};a.prototype.updateLine=function(a,d,c,f){if("vertical"==
d.orientation){c.height="inherit";c["border-top-width"]="";c["border-top-style"]="";d.lineStyle&&(c["border-left-style"]=d.lineStyle);d.borderTopWidth&&(c["border-left-width"]=d.borderTopWidth+"px");d=a.css("width");var b=a.css("height"),m=a.css("min-height"),l=a.css("min-width");"vertical"!=f&&a.css({"min-height":l,"min-width":m,height:d,width:b})}else"horizontal"==d.orientation&&(c.height="",c["border-left-width"]="",c["border-left-style"]="",d.lineStyle&&(c["border-top-style"]=d.lineStyle),d.borderTopWidth&&
(c["border-top-width"]=d.borderTopWidth+"px"),d=a.css("width"),b=a.css("height"),m=a.css("min-height"),l=a.css("min-width"),void 0!=f&&"horizontal"!=f&&a.css({"min-height":l,"min-width":m,height:d,width:b}));a.find(".value").css(c)};a.prototype.updateText=function(a,d){a=a.find(".value");d.fontSize&&a.css("font-size",d.fontSize+"px");d.bold?a.css("font-weight","bold"):a.css("font-weight","normal");d.italic?a.css("font-style","italic"):a.css("font-style","normal");d.underline?a.css("text-decoration",
"underline"):a.css("text-decoration","none");d.fontFamily?a.css("font-family",d.fontFamily):a.css("font-family","inherit");d.align&&a.css("text-align",d.align);d.color&&a.css("color",d.color);d.backgroundColor&&a.css("background-color",d.backgroundColor);d.link?(a.find("a").length&&a.html(a.find("a").html()),a.html('<a href="'+d.linkUrl+'" target="_blank">'+a.html()+"</a>")):a.find("a").length&&a.html(a.find("a").html())};a.prototype.getTemplateCache=function(a){var b=a.attr("config");b=JSON.parse(b||
"{}");return b=$.extend({value:a.data("macro"),componentType:a.data("type")},b)};a.prototype.updateInvoiceTable=function(a,d){a=a.find("table");var b=[],f=[];$.each(d,function(a,c){a.startsWith("column-")?b.push(c):a.startsWith("value-")&&f.push(c)});if(b.length){var g=this.populateInvoiceTableRow(b,f);a.find("tbody").html(g)}d.rowBorder&&a.find("tr").css("border",d.rowBorder+"px");d.columnBorder&&a.find("td").css("border-width",d.columnBorder);d.borderStyle&&a.find("tr, td").css("border-style",d.borderStyle);
d.borderColor&&a.find("tr, td").css("border-color",d.borderColor);d.headerBackground&&a.find(".header").css("background-color",d.headerBackground);d.rowBackground&&a.find(".row").css("background-color",d.rowBackground)};a.prototype.populateInvoiceTableRow=function(a,d){var b=this,f=[];f.push('<tr class="header" style="background-color: #3997D6">');a.forEach(function(a){f.push(b.getTableHeader(a))});f.push("</tr>");f.push('<tr class="row" data-each="order_details.items:item:index">');d.forEach(function(a){f.push(b.getTableRow(a))});
f.push("</tr>");return f.join("")};a.prototype.getTableHeader=function(a){return'<th style="padding:5px; background-color: transparent;  border-left: 1px solid #3997D6; border-right: 1px solid #3997D6; border-top: 1px solid #3997D6; color: #FFFFFF; text-align:center; font-family:Arial, Helvetica, sans-serif; font-size:13px; line-height:22px;">'+a+"</th>"};a.prototype.getTableRow=function(a){return'<td style="padding:5px; border:1px #e6e6e6 solid; text-align:center;font-family:Arial, Helvetica, sans-serif; font-size:13px; line-height:22px;">'+
a+"</td>"};a.prototype.populateInvoiceTable=function(a){a.addClass("full-width-component");var b=['<table class="value" style="border-collapse:collapse;width:100%;" border="0" cellspacing="0" cellpadding="0">'],c=this.populateInvoiceTableRow("Name;Unit Price;Ordered Quantity;Discount;Tax;Price".split(";"),'%if:item.url%<a href="%item.url%">%if% %item.product_name% %if:item.variations%(%item.variations%)%if%%if:item.url%</a>%if%;%currency_symbol%%item.price%;%item.quantity%;%item.tax%;%item.total_with_tax_with_discount%;%currency_symbol%%item.total_with_tax_with_discount%'.split(";"));
b.push(c);b.push("</table>");a.append(b.join(""));return a};a.prototype.populateOrderTable=function(a){a.addClass("full-width-component");var b=['<table class="value" style="border-collapse:collapse;width:100%;" border="0" cellspacing="0" cellpadding="0">'],c=this.populateOrderTableRow("Name;Unit Price;Ordered Quantity;Discount;Tax;Price".split(";"),'%if:item.url%<a href="%item.url%">%if% %item.product_name% %if:item.variations%(%item.variations%)%if%%if:item.url%</a>%if%;%currency_symbol%%item.price%;%item.quantity%;%item.tax%;%item.total_with_tax_with_discount%;%currency_symbol%%item.total_with_tax_with_discount%'.split(";"));
b.push(c);b.push("</table>");a.append(b.join(""));return a};a.prototype.populateOrderTableRow=function(a,d){var b=this,f=[];f.push('<tr class="header" style="background-color: #3997D6">');a.forEach(function(a){f.push(b.getTableHeader(a))});f.push("</tr>");f.push('<tr class="row" data-each="order_details.items:item:index">');d.forEach(function(a){f.push(b.getTableRow(a))});f.push("</tr>");return f.join("")};a.prototype.updateOrderTable=function(a,d){a=a.find("table");var b=[],f=[];$.each(d,function(a,
c){a.startsWith("column-")?b.push(c):a.startsWith("value-")&&f.push(c)});if(b.length){var g=this.populateOrderTableRow(b,f);a.find("tbody").html(g)}d.rowBorder&&a.find("tr").css("border",d.rowBorder+"px");d.columnBorder&&a.find("td").css("border-width",d.columnBorder);d.borderStyle&&a.find("tr, td").css("border-style",d.borderStyle);d.borderColor&&a.find("tr, td").css("border-color",d.borderColor);d.headerBackground&&a.find(".header").css("background-color",d.headerBackground);d.rowBackground&&a.find(".row").css("background-color",
d.rowBackground)};a.prototype.populateDeliveryDocketTable=function(a){a.addClass("full-width-component");var b=['<table class="value" style="border-collapse:collapse;width:100%;" border="0" cellspacing="0" cellpadding="0">'],c=this.populateDeliveryDocketTableRow(["Product Name","SKU","Ordered Quantity","Back Ordered","Quantity Shipped"],['%if:item.url%<a href="%item.url%">%if% %item.product_name% %if:item.variations%(%item.variations%)%if%%if:item.url%</a>%if%',"%item.sku%","%item.quantity%","%item.back_ordered%",
"%item.quantity_shipped%"]);b.push(c);b.push("</table>");a.append(b.join(""));return a};a.prototype.populateDeliveryDocketTableRow=function(a,d){var b=this,f=[];f.push('<tr class="header" style="background-color: #3997D6">');a.forEach(function(a){f.push(b.getTableHeader(a))});f.push("</tr>");f.push('<tr class="row" data-each="order_details.items:item:index">');d.forEach(function(a){f.push(b.getTableRow(a))});f.push("</tr>");return f.join("")};a.prototype.updateDeliveryDocketTable=function(a,d){a=
a.find("table");var b=[],f=[];$.each(d,function(a,c){a.startsWith("column-")?b.push(c):a.startsWith("value-")&&f.push(c)});if(b.length){var g=this.populateDeliveryDocketTableRow(b,f);a.find("tbody").html(g)}d.rowBorder&&a.find("tr").css("border",d.rowBorder+"px");d.columnBorder&&a.find("td").css("border-width",d.columnBorder);d.borderStyle&&a.find("tr, td").css("border-style",d.borderStyle);d.borderColor&&a.find("tr, td").css("border-color",d.borderColor);d.headerBackground&&a.find(".header").css("background-color",
d.headerBackground);d.rowBackground&&a.find(".row").css("background-color",d.rowBackground)};a.prototype.populatePickingSlipTable=function(a){a.addClass("full-width-component");var b=['<table class="value" style="border-collapse:collapse;width:100%;" border="0" cellspacing="0" cellpadding="0">'],c=this.populatePickingSlipTableRow("Product Name;sku;Ordered Quantity;Back Ordered;Pick Task;Quantity Picked".split(";"),'%if:item.url%<a href="%item.url%">%if% %item.product_name% %if:item.variations%(%item.variations%)%if%%if:item.url%</a>%if%,%item.sku%,%item.quantity%,%item.back_ordered%,%item.pick_task%,<span style="border: 1px #000 solid;height: 20px;width: 20px;display: inline-block;"></span>'.split(","));
b.push(c);b.push("</table>");a.append(b.join(""));return a};a.prototype.populatePickingSlipTableRow=function(a,d){var b=this,f=[];f.push('<tr class="header" style="background-color: #3997D6">');a.forEach(function(a){f.push(b.getTableHeader(a))});f.push("</tr>");f.push('<tr class="row" data-each="order_details.items:item:index">');d.forEach(function(a){f.push(b.getTableRow(a))});f.push("</tr>");return f.join("")};a.prototype.updatePickingSlipTable=function(a,d){a=a.find("table");var b=[],f=[];$.each(d,
function(a,c){a.startsWith("column-")?b.push(c):a.startsWith("value-")&&f.push(c)});if(b.length){var g=this.populatePickingSlipTableRow(b,f);a.find("tbody").html(g)}d.rowBorder&&a.find("tr").css("border",d.rowBorder+"px");d.columnBorder&&a.find("td").css("border-width",d.columnBorder);d.borderStyle&&a.find("tr, td").css("border-style",d.borderStyle);d.borderColor&&a.find("tr, td").css("border-color",d.borderColor);d.headerBackground&&a.find(".header").css("background-color",d.headerBackground);d.rowBackground&&
a.find(".row").css("background-color",d.rowBackground)};a.prototype.populateDataTable=function(a){a.css("width","640px");var b=['<table class="value" cellpadding="10" style="border-collapse: collapse;width: inherit;table-layout: fixed;" border="0" cellspacing="0" cellpadding="0">'],c=this.populateDataTableRow([],[],{rows:3,columns:3});b.push(c);b.push("</table>");a.append(b.join(""));return a};a.prototype.populateDataTableRow=function(a,d,c){var b=[];b.push('<tr class="header">');for(var g=0;g<c.columns;g++)b.push('<th class="editable" style="background-color: transparent">'+
(a[g]||"column"+g)+"</th>");b.push("</tr>");for(a=0;a<c.rows;a++){b.push('<tr class="data-row">');g=d[a]||[];for(var m=0;m<c.columns;m++)b.push('<td class="editable">'+(g[m]||"")+"</td>");b.push("</tr>")}return b.join("")};a.prototype.bindDataTableEvents=function(a){a.find(".value .header th,.data-row td").dblclick(function(){var b=$(this);a.find(".value .header th,.data-row td").each(function(a,b){b.jqObject.removeAttr("contenteditable")});b[0].contentEditable=!0;var c=b.closest(".filler-row.each-component.data_table.selected"),
f=JSON.parse(c.attr("config"));f.cellEditing=!0;f.cellTextAlign=b.css("text-align");f.cellBackground=b.css("background-color");f.cellFontColor=b.css("color");f.cellFontFamily=b.css("font-family");f.cellFontSize=b.css("font-size").split("p")[0];c.attr("config",JSON.stringify(f))}).blur(function(){var a=$(this).closest(".filler-row.each-component.data_table.selected"),b=JSON.parse(a.attr("config"));b.cellEditing=!1;a.attr("config",JSON.stringify(b))})};a.prototype.changeDataTable=function(a,d,c,f){a.find(".value");
if(eval(d.rows)+1>c){for(var b=0;b<eval(d.rows)+1-c;b++){var m=[];m.push('<tr class="data-row">');for(var l=0;l<d.columns;l++)m.push('<td class="editable"></td>');m.push("</tr>");a.find(".value").find("tbody").append(m.join(""))}d.columns>f?a.find(".value").find("tr").each(function(){for(var a=0;a<d.columns-f;a++)$(this).is(".header")?$(this).append('<th class="editable">Column</th>'):$(this).append('<td class="editable"></td>')}):a.find(".value tr").find("td:gt("+(d.columns-1)+"),th:gt("+(d.columns-
1)+")").each(function(){$(this).remove()})}else a.find(".value").find("tr:gt("+d.rows+")").each(function(){$(this).remove()}),d.columns>f?a.find(".value").find("tr").each(function(){for(var a=0;a<d.columns-f;a++)$(this).is(".header")?$(this).append('<th class="editable">Column</th>'):$(this).append('<td class="editable"></td>')}):a.find(".value tr").find("td:gt("+(d.columns-1)+"),th:gt("+(d.columns-1)+")").each(function(){$(this).remove()})};a.prototype.updateDataTable=function(a,d){var b=a.find("table");
!d.rows&&(d.rows=3);!d.columns&&(d.columns=3);var f=b.find("tr").length,g=b.find("tr")[0].jqObject.find("th").length;d.rows==f-1&&d.columns==g||this.changeDataTable(a,d,f,g);d.rowBorder&&b.find("tr").css("border",d.rowBorder+"px");d.columnBorder&&(b.find("td, th").css("border-left",d.columnBorder+"px"),b.find("td, th").css("border-right",d.columnBorder+"px"),b.find("td, th").css("border-top","0px"),b.find("td, th").css("border-bottom","0px"));d.borderStyle&&b.find("tr, td, th").css("border-style",
d.borderStyle);d.borderColor&&b.find("tr, td, th").css("border-color",d.borderColor);d.headerBackground&&b.find(".header").css("background-color",d.headerBackground);d.rowBackground&&b.find(".data-row").css("background-color",d.rowBackground);b=b.find(".header th[contenteditable=true],.data-row td[contenteditable=true]");b.length&&(d.cellTextAlign&&b.css("text-align",d.cellTextAlign),d.cellBackground&&b.css("background-color",d.cellBackground),d.cellFontColor&&b.css("color",d.cellFontColor),d.cellFontFamily?
b.css("font-family",d.cellFontFamily):b.css("font-family","inherit"),d.cellFontSize&&b.css("font-size",d.cellFontSize+"px"));this.bindDataTableEvents(a)};a.prototype.bindMacroSearchEvents=function(){var a=this;a.body.find(".editing-area").on("keypress",".filler-row.each-component.selected .value.editable, .value .editable",function(b){var c=$(this);b=b.keyCode?b.keyCode:b.which;var d="undefined"!=typeof document.selection&&"Control"!=document.selection.type&&!0,g="undefined"!=typeof window.getSelection&&
!0,m=function(a){var b=0;if(g){b=window.getSelection().getRangeAt(0);var c=b.cloneRange();c.selectNodeContents(a);c.setEnd(b.endContainer,b.endOffset);b=c.toString().length}else d&&(b=document.selection.createRange(),c=document.body.createTextRange(),c.moveToElementText(a),c.setEndPoint("EndToEnd",b),b=c.text.length);return b}(c[0]),l=c.text();"true"==c.attr("contenteditable")&&37==b&&bm.floatingPanel(c,app.baseUrl+"document/loadMacroList",{type:a.ajax_data.type,id:a.ajax_data.id},{clazz:"document-macro-search-popup",
masking:!1,position_collison:"none",events:{content_loaded:function(a){var b=a.el,d=b.find(".search-form"),f=b.find(".macro-dropdown-wrapper");d.form({preSubmit:function(){return!1}});d.find(".search-text").focus();bm.instantSearch(b.find(".macro-dropdown-wrapper"),d,".each-macro",".searchable-text");b.find(".macro-wrapper").scrollbar({vertical:{offset:15}});f.on("click",".each-macro",function(){var b=$(this).find(".macro-value").text();c.text(l.substring(0,m)+b+l.substring(m));a.close()});b.updateUi()}}})})};
app.tabs.documentEditor=a})();app.tabs.edit_content=function(a){this.text=$.i18n.prop("edit.content");this.tip=this.name=a.containerName;this.ui_body_class=this.ui_class="content-editor edit-tab";this.removedWidgets=[];this.cachedWidgets={};this.cachedDock={};this.newDocks=[];this.modifiedDocks=[];this.removedDock=[];this.removedHeader=[];this.removedFooter=[];this.supportedWidgetSelector="."+this.widgetClass;app.tabs.edit_content._super.constructor.apply(this,arguments)};app.tabs.edit_content.inherit(app.Tab);
_e=app.tabs.edit_content.prototype;_e.widgetClass="widget";_e.contentSaveUrl="widget/saveContents";_e.widgetConfigUrl=app.baseUrl+"widget/edit";_e.editJsUrl=app.baseUrl+"widget/editJs";_e.editContainerJsUrl;_e.gridSelector=".grid-block";_e.enableRevert=!1;_e.editableBlockSelector=_e.gridSelector+", .widget-container:not(:has(.grid-block))";_e.sortable_page_content=!1;_e.modifyFavoriteWidgetUrl=app.baseUrl+"app/modifyFavoriteWidget";
_e.init=function(){app.tabs.edit_content._super.init.apply(this,arguments);var a=this;a.mask();this.iframe=this.body.find("iframe");this.leafGridBlockSelectorInContentMode=".widget-container:not(:has(>.grid-block, >.page-content)), .grid-block:not(:has(>.grid-block, >.page-content))";this.sectionHeight=a.body.find("input.height").ichange(1E3,function(b,d){var c=a.activeSection;b=a.getSectionHeight(c);c=a.setSectionHeight(c,d);d!=c&&this.isilent(c);b!=c&&(a.selectedWidget&&a.getWidgetObject(a.selectedWidget).positionReferenceLine(),
a.setDirty("section_height",b,c))});this.sectionWidth=a.body.find("input.width").ichange(1E3,function(b,d){var c=a.activeSection;b=a.getSectionWidth(c);c=a.setSectionWidth(c,d);d!=c&&this.isilent(c);b!=c&&(a.selectedWidget&&a.getWidgetObject(a.selectedWidget).positionReferenceLine(),a.setDirty("section_width",b,c))});this.widgetXoffset=a.body.find("input.x-offset").stepper("disable");this.widgetYoffset=a.body.find("input.y-offset").stepper("disable");this.widgetHeight=a.body.find("input.widget-height").stepper("disable");
this.widgetWidth=a.body.find("input.widget-width").stepper("disable");this.body.find(".widget-block-panel").scrollbar();this.body.find(".spinner:not('.x-offset, .y-offset')").numeric();this.body.find(".spinner.x-offset, .spinner.y-offset").signed_numeric();this.iframe.on("sure-load",$.proxy(this.afterLoad,this));this.leftbar_tab=this.body.find(".left-bar").tabify({activate:function(b){"setting"==b.newIndex&&(b=a.settingBlock.find(".leftbar-accordion").accordion("current"),b.is(".page-props")?a.updatePageProperties():
b.is(".widget-mode")?a.updateWidgetConfig():b.is(".dock-css")&&a.editDockCss())}});this.isResponsive=this.iframe.parent().is(".responsive");this.initSidebar();this.attachEvent();this.initWidgetDimensionSpinners()};
_e.action_menu_entries=[{text:$.i18n.prop("revert"),ui_class:"revert",action:"revert"},{ui_class:"item-separator"},{text:$.i18n.prop("clear.all.widgets"),ui_class:"clear-all",action:"clear-all"},{text:$.i18n.prop("copy.header"),ui_class:"copy copy-header",action:"copy-header"},{text:$.i18n.prop("copy.footer"),ui_class:"copy copy-footer",action:"copy-footer"}];
_e.onActionMenuOpen=function(){var a=this.action_menu;this.enableRevert?a.enable("revert"):a.disable("revert");this.activeSection.is(".header")?a.show("copy-header"):a.hide("copy-header");this.activeSection.is(".footer")?a.show("copy-footer"):a.hide("copy-footer")};_e.onActionMenuClick=function(a){switch(a){case "revert":this.revert();break;case "clear-all":this.removeAllWidgets(this.activeSection);break;case "copy-header":this.renderCopiedSection("header");break;case "copy-footer":this.renderCopiedSection("footer")}};
_e.getSectionHeight=function(a){a.hasClass("dockable")?(a=a.attr("id").substring(5),a=this.getCssValue(this.cachedDock[a].css,"#dock-"+a,"height")):a=this.getCssValue(this.css,"."+a.attr("section")+" > .widget-container","height");return parseFloat(a,10)};
_e.getSectionWidth=function(a){a.hasClass("dockable")?(a=a.attr("id").substring(5),a=this.getCssValue(this.cachedDock[a].css,"#dock-"+a,"width")):a=this.getCssValue(this.css,"."+a.attr("section")+" > .widget-container","width");return"auto"==a?"":parseFloat(a,10)};
_e.setSectionHeight=function(a,b){var d=this.getSectionMinHeight(a);d&&+b<d&&(b=d);a.hasClass("dockable")?(a=a.attr("id").substring(5),this.updateCss(this.cachedDock[a].css,a,"#dock-"+a,{height:b+"px"})):this.updateCss(this.css,null,"."+a.attr("section")+" > .widget-container",{height:b+"px"});return b};
_e.setSectionWidth=function(a,b){if(b){var d=a.is(".body")?this.getGridMinResizable(a.find("> .widget-container")):this.getSectionMinWidth(a);d=Math.max(800,d);+b<d&&(b=d);a.is(".dockable")?(d=a.attr("id").substring(5),this.updateCss(this.cachedDock[d].css,d,"#dock-"+d,{width:b+"px"})):(this.updateCss(this.css,null,"."+a.attr("section")+" > .widget-container",{width:b+"px"}),a.is(".body")&&this.updateCss(this.css,null,".body > .body-section > .widget-container",{width:b+"px"}))}else b="auto",a.hasClass("dockable")?
(d=a.attr("id").substring(5),this.updateCss(this.cachedDock[d].css,d,"#dock-"+d,{width:b})):(this.updateCss(this.css,null,"."+a.attr("section")+" > .widget-container",{width:b}),a.is(".body")&&this.updateCss(this.css,null,".body > .body-section > .widget-container",{width:b}));!a.is(".body")&&this.selectedWidget&&(a=this.getWidgetObject(this.selectedWidget),a.positionReferenceLine(),this.setDimensionSpinnerValues(a));return"auto"==b?"":b};
_e.assignColorToGroups=function(a){(a||this.activeSection.find(".widget-group")).each(function(){var a=Math.floor(210*Math.random()+20),d=Math.floor(210*Math.random()+20),c=Math.floor(210*Math.random()+20);$(this).find(".widget-overlay").css("border-color","rgba("+a+","+d+","+c+",1)")})};_e.detachSoratableElementEvents=function(a){a.off("sortsort").off("click")};
_e.attachSoratableElementEvents=function(a,b){var d=this;b.on("sort:sort",function(a,b){d.setDirty("widget_relocate",$.extend(b.obj.sort_old_state,{widget:b.elm}),{parent:b.elm.parent(),index:b.elm.parent().children("."+d.widgetClass).index(b.elm),widget:b.elm})}).on("click",function(){d.selectGrid($(this))});this.sortable_page_content||a.find(".page-content").parent().click(function(){d.selectGrid($(this))})};
_e.selectGrid=function(a,b){this.deselectGrid();a.find("> .editable-area-overlay, >.page-content").addClass("selected");this.settingBlock.find(".layout-operators .tool-icon").removeClass("disabled");a.is(".widget-container")?this.settingBlock.find(".layout-operators .h-f-c").addClass("disabled"):a.is(".v-split")&&this.settingBlock.find(".layout-operators .h-f-v").addClass("disabled");a.is(".page-content > .v-split-container > .v-split")&&this.settingBlock.find(".layout-operators .fluid-v-split").removeClass("disabled");
!1!==b&&(a=a.is(".page-content")?".page-content":a.is(".widget-container")?a.parent().is(".page-content")?".page-content > .widget-container":a.parent().is(".body-section")?"#"+a.parent().attr("id")+" > .widget-container":"> .widget-container":"#"+a.attr("id"),this.settingBlock.find(".body-grids-selector select").chosen("val",a))};_e.clearEditableOverlay=function(){this.activeSection.find(".editable-area-overlay").remove()};_e.setEditableOverlay=function(a){(a||this.activeSection).find(this.leafGridBlockSelectorInContentMode).append("<div class='editable-area-overlay'></div>")};
_e.editableWidgetsInSection=function(a){return a.find("."+this.widgetClass)};
_e.initializeSectionForEditing=function(a){var b=this;this.updateSectionDimensionSpinners();this.populateWidgetSelector();this.setEditableOverlay();var d=this.editableWidgetsInSection(a);this.createWidgetOverlay(d);a.on("click",".widget-overlay",function(a){if(a.target==this){var c=$(this).parent();if(!b.selectedWidget||b.selectedWidget[0]!=c[0]){if(b.multiSelectedWidget){if(b.multiSelectedWidget.filter(c).length){a.ctrlKey?b.unselectMultiWidget(c):(b.activeSection.find(".multi-selection-master-widget").removeClass("multi-selection-master-widget"),
c.find("> .multi-selection-overlay").addClass("multi-selection-master-widget"));return}if(a.ctrlKey){b.selectMultiWidget(c);return}}b.selectWidget(c)}}}).on("click",".widget-overlay .remove",function(){var a=$(this).closest("."+b.widgetClass);b.removeWidget(b.activeSection,a.attr("id").substring(3))});a.is(".body")?(a.find(".body-section").append("<div class='body-section-overlay'></div>"),this.settingBlock.find(".tool-icon.add-section").removeClass("disabled"),a.on("click",".body-section",function(){b.selectBodySection($(this))}),
this.initializeBodySectionSortResize(a),this.settingBlock.find(".layout-mode-header, .layout-mode").xshow(),this.populateGridBlockSelector(),this.populateBodySectionSelector()):(a.on("click",".widget-bounding-box",function(a){var c=$(this),d=c.closest("."+b.widgetClass),m=d.children(".widget-overlay"),l=b.getWidgetObject(d),n=m.find(".widget-bounding-box.selected");if(!c.is(".selected")||1!=n.length){var q=d.position(),e=d.outerHeight(!0),p=d.outerWidth(!0),t=$(l.elm[0].offsetParent).innerWidth(),
w=$(l.elm[0].offsetParent).innerHeight();m={left:"auto",top:"auto",right:"auto",bottom:"auto",width:l.style.width,height:l.style.height};var y=!1;a.ctrlKey&&(y=!0,l.isLeftTop()&&c.hasClass("top-right")?m.left=l.style.left:l.isRightTop()&&c.hasClass("top-left")?m.right=l.style.right:l.isLeftBottom()&&c.hasClass("bottom-right")?m.left=l.style.left:l.isRightBottom()&&c.hasClass("bottom-left")?m.right=l.style.right:y=!1);y?m.width="auto":("auto"==m.width&&(m.width=d.width()+"px"),n.removeClass("selected"));
c.addClass("selected");c.hasClass("top-left")?(m.left=q.left+"px",m.top=q.top+"px"):c.hasClass("top-right")?(m.top=q.top+"px",m.right=t-q.left-p+"px"):c.hasClass("bottom-right")?(m.right=t-q.left-p+"px",m.bottom=w-q.top-e+"px"):c.hasClass("bottom-left")&&(m.left=q.left+"px",m.bottom=w-q.top-e+"px");a=l.style;if(l.percentage){n=l.elm.parent().innerWidth();q=l.elm.parent().innerHeight();if(c.hasClass("top-left")||c.hasClass("bottom-left"))m.left=parseFloat(m.left)/n*100+"%";if(c.hasClass("top-right")||
c.hasClass("bottom-right"))m.right=parseFloat(m.right)/n*100+"%";if(c.hasClass("top-left")||c.hasClass("top-right"))m.top=parseFloat(m.top)/q*100+"%";if(c.hasClass("bottom-right")||c.hasClass("bottom-left"))m.bottom=parseFloat(m.bottom)/q*100+"%"}l.applyStyle(m);b.setDirty("widget_reposition",{widget:d,style:a},{widget:d,style:m},d)}}),this.body.find(".widget-item").draggable("dropTarget",{area:this.iframe,element:a.find(".widget-container:first"),offset:this.iframe.offset(),intersect:62}).on("drag:drop",
function(a,d){a=d.drop.height();var c=150<a?150:100<a?100:50,f=d.drag.attr("widget-type");f=b.getNewDroppedWidget(f);var l=f.elm;d.drag.replaceWith(l);var n=d.position.left+(b.iframeWindow.scrollX||b.iframeWindow.pageXOffset),q=d.position.top+(b.iframeWindow.scrollY||b.iframeWindow.pageYOffset);0>n&&(n=0);0>q&&(q=0);n+c>d.drop.width()&&(n-=n+c-d.drop.width());q+c>a&&(q-=q+c-a);f.style={width:c+"px",height:c+"px",top:q+"px",left:n+"px",right:"auto",bottom:"auto"};b.updateCss(f.css,f.uuid,"#wi-"+f.uuid,
f.style,void 0,void 0,!0);b.cachedWidgets[f.uuid]=f;b.onNewWidgetDrop(l)}),this.assignColorToGroups(),a.is(".dockable")&&a.find(".dock-mask").mousedown(function(){b.unselectWidget()}))};
_e.selectBodySection=function(a,b){a.find(".body-section-overlay.selected").length||(this.activeSection.find(".body-section-overlay.selected").removeClass("selected"),a.find(".body-section-overlay").addClass("selected"),this.settingBlock.find(".tool-icon.remove-section, .tool-icon.move-section-up, .tool-icon.move-section-down, .body-section-fluid-fixed-toggle").removeClass("disabled"),b||this.settingBlock.find(".body-sections-selector select").chosen("val",a.attr("id")))};
_e.initializeBodySectionSortResize=function(a){var b=this,d=a.find(this.leafGridBlockSelectorInContentMode);this.grid_sortable=new bm.Sortable(d,{shim:!0,handle:"."+this.widgetClass,sortable_on_drop:!1,helper:function(a){a=a.attr("widget-type");return b.iframeWindow.$(b.body.find(".widget-item[widget-type='"+a+"']").clone()[0])},start:function(a){a.obj.sort_old_state={parent:a.elm.parent(),index:a.elm.parent().children("."+b.widgetClass).index(a.elm)}}});this.attachSoratableElementEvents(a,d);this.body.find(".widget-item").draggable("sortElement",
this.grid_sortable,this.iframe.offset(),this.iframe).on("drag:sort",function(a,d){a=d.sort.attr("widget-type");a=b.getNewDroppedWidget(a);var c=a.elm;d.sort.replaceWith(c);b.cachedWidgets[a.uuid]=a;b.onNewWidgetDrop(c);b.grid_sortable.addHandle(c)});this.addGridResize(a.find(this.editableBlockSelector))};
_e.addGridResize=function(a){var b=this,d;a.filter(".no-fixed-left").resizable({direction:["r"],reverse:function(a){return a.siblings(".grid-block")},resize:function(a){a.elm.siblings(".grid-block").addBack().find(".editable-area-overlay, .page-content").each(function(){var a=$(this).innerWidth();$(this).find(".width-info").text((a/d*100).toFixed(2))})},stop:function(a){var c=a.elm.parent().width(),d=a.elm.attr("id").substring(6),f=a.elm.width()/c*100,e=a.elm.siblings(".grid-block"),g=e.attr("id").substring(6),
m=e.width()/c*100;c=function(){b.updateCss(b.css,null,"#spltr-"+d,{width:f+"%"});b.updateCss(b.css,null,"#spltr-"+g,{width:m+"%"})};b.setDirty({redo:c,undo:this.undo_op});c();delete this.undo_op;a.elm.css({width:""});a.elm.siblings().css({width:""});a.elm.siblings(".grid-block").addBack().find(".width-info").remove()},start:function(a){var c=a.elm.parent().width();a.obj.limit=[b.getGridMinResizable(a.elm),c-b.getGridMinResizable(a.elm.siblings(".grid-block"))];var f=a.elm.attr("id").substring(6),
g=b.getCssValue(b.css,"#spltr-"+f,"width"),e=a.elm.siblings().attr("id").substring(6),m=b.getCssValue(b.css,"#spltr-"+e,"width");this.undo_op=function(){b.updateCss(b.css,null,"#spltr-"+f,{width:g});b.updateCss(b.css,null,"#spltr-"+e,{width:m})};d=a.elm.parent().width();a.elm.siblings(".grid-block").addBack().find(".editable-area-overlay, .page-content").each(function(){$(this).append("<span class='width-info'></span>")})},prestart:function(a){var b=a.elm.css("width");a.elm.css("width",b);var c=a.elm.parent().width();
a.elm.siblings(".grid-block").css("width",c-parseFloat(b))}});var c=function(a){this.undo_width=a.elm.width();var c=a.elm.parent().width();a.obj.limit[0]=b.getGridMinResizable(a.elm);a.obj.limit[1]=c-b.getGridMinResizable(a.elm.siblings(".grid-block"));a.elm.siblings(".grid-block").addBack().find(".editable-area-overlay, .page-content").each(function(){$(this).append("<span class='width-info'></span>")})},f=function(a){var b=a.dims.width;a.elm.css({"max-width":b+"px",flex:"0 0 "+b+"px"});a.elm.siblings(".grid-block").addBack().find(".editable-area-overlay, .page-content").each(function(){$(this).find(".width-info").text($(this).parent().outerWidth())})},
g=function(a){var c=a.elm,d=c.attr("id").substring(6),f=c.width(),e=function(){var a=f;"border-box"==c.css("box-sizing")&&(a-=c.leftRib(!1)+c.rightRib(!1));b.updateCss(b.css,null,"#spltr-"+d,{width:a+"px","max-width":a+"px",flex:"0 0 "+a+"px"})},g=this.undo_width;b.setDirty({redo:e,undo:function(){var a=g;"border-box"==c.css("box-sizing")&&(a-=c.leftRib(!1)+c.rightRib(!1));b.updateCss(b.css,null,"#spltr-"+d,{width:a+"px","max-width":a+"px",flex:"0 0 "+a+"px"})}});e();delete this.undo_width;c.css({width:"",
maxWidth:"",flex:""});a.elm.siblings(".grid-block").addBack().find(".width-info").remove()};a.filter(".l-fixed-left").resizable({direction:["r"],resize:f,start:c,stop:g,limit:[100,void 0]});a.filter(".r-fixed-right").resizable({direction:["l"],resize:f,start:c,stop:g,limit:[100,void 0]})};
_e.attachGlobalEvents=function(){var a=this;this.pageBody.find(".iframe-mask, .section-overlay").mousedown(function(){a.unselectWidget()});this.pageBody.find("[section]").mousedown(function(b){$(b.target).is(".editable-area-overlay")&&a.unselectWidget()});$(this.iframeWindow.document).on("keyup."+this.id+".ctrl_z",function(a){$(document).trigger(a)}).on("keyup."+this.id+".ctrl_y",function(){$(document).trigger(ev)})};
_e.afterLoad=function(){var a=this.initial_section||"header";this.iframeContent=this.iframe.contents();this.iframeWindow=this.iframe[0].contentWindow;this.iframeMask=$("<div class='iframe-mask editor-with-solid-grid'></div>");this.pageBody=this.iframeContent.find("body");this.reload_performed||this.body.find(".widget-item").draggable({helper:"clone",shim:!0});this.pageBody.append("<div class='bounding-box-line-x'></div><div class='bounding-box-line-y'></div><div class='bounding-box-line-x-2'></div><div class='bounding-box-line-y-2'></div>");
this.pageBody.append(this.iframeMask);this.loadCsss();if(this.activeSectionSelector.length){var b=this.activeSectionSelector[0].options,d=this.pageBody.find(".dockable");d.each(function(){var c=$(this).attr("id").substring(5);b[b.length]=new Option("Dock - "+c,c,!1,a==c)});d.length&&this.activeSectionSelector.chosen("update");this.activeSectionSelector.chosen("val",a)}this.initEditor&&this.initEditor();this.changeActiveSection(a,!0);this.isResponsive&&this.resolutionChange(this.settingBlock.find(".change-resolution select").val());
this.unmask();this.appendSectionOverlays();this.attachGlobalEvents()};_e.appendSectionOverlays=function(){this.pageBody.find(".header, .footer, .body").append("<div class='section-overlay'></div>")};_e.getSectionMinWidth=function(a){var b=this;a=a.find("."+b.widgetClass).filter(":visible");var d=0;$.each(a,function(){var a=b.getWidgetObject($(this));a=b.findMinimumWidth(a);d<a&&(d=a)});return d};
_e.findMinimumWidth=function(a){var b=a.getPos(),d=a.elm.outerWidth(!0);return a.isLeft()?a.isRight()?+b.right+ +b.left+50:+b.left+d:+b.right+d};_e.getSectionMinHeight=function(a){var b=this;a=a.find("."+b.widgetClass).filter(":visible");var d=0;$.each(a,function(){var a=$(this),f=b.getWidgetObject(a),g=f.getPos();a=a.outerHeight(!0);f=f.isTop()?g.top+a:g.bottom+a;d<f&&(d=f)});return d||(a.length?60:0)};
_e.addCommonOverlays=function(){this.pageBody.find("> .header").append("<div class='section-overlay'></div>");this.pageBody.find("> .body").append("<div class='section-overlay'></div>");this.pageBody.find("> .footer").append("<div class='section-overlay'></div>")};_e.loadCsss;
_e.deActiveSection=function(a){a.off();a.removeClass("active-section");this.unselectWidget();a.find(".widget-overlay, .editable-area-overlay, .body-section-overlay, .bmui-resize-handle").remove();a.is(".dockable")&&(a.hide(),this.settingBlock.find(".leftbar-accordion").accordion("current").is(".dock-css")&&(this.selectedWidget?this.settingBlock.find(".leftbar-accordion").accordion("expand","widget-mode-header"):this.settingBlock.find(".leftbar-accordion").accordion("expand","page-props-header")),
this.settingBlock.find(".dock-css-header").hide());a.hasClass("body")?(this.deselectBodySection(),this.settingBlock.find(".tool-icon.add-section").addClass("disabled"),this._destroyBodySortResize(a),this.deselectGrid(),a.find(".page-content").off(),this.settingBlock.find(".leftbar-accordion").accordion("current").is(".layout-mode")&&this.settingBlock.find(".leftbar-accordion").accordion("expand",0),this.settingBlock.find(".layout-mode-header, .layout-mode").hide()):(this.body.find(".widget-item").draggable("dropTarget",
void 0).off("dragdrop"),this.destroyMultiSelection())};
_e._destroyBodySortResize=function(a){this.body.find(".widget-item").draggable("sortElement",void 0).off("dragsort");var b=a.find(this.leafGridBlockSelectorInContentMode).off();a.find(".widget-container").off();this.grid_sortable.destroy();b.filter(".l-fixed-left").__proto__.hasOwnProperty("destroy")&&b.filter(".l-fixed-left").resizable("destroy");b.filter(".no-fixed-left").__proto__.hasOwnProperty("destroy")&&b.filter(".no-fixed-left").resizable("destroy");b.filter(".r-fixed-right").__proto__.hasOwnProperty("destroy")&&
b.filter(".r-fixed-right").resizable("destroy")};_e.deselectBodySection=function(){this.activeSection.find(".body-section-overlay.selected").removeClass("selected");this.settingBlock.find(".tool-icon.remove-section").addClass("disabled");this.settingBlock.find(".tool-icon.move-section-up").addClass("disabled");this.settingBlock.find(".tool-icon.move-section-down").addClass("disabled");this.settingBlock.find(".body-sections-selector select").chosen("val","");this.settingBlock.find(".tool-icon.body-section-fluid-fixed-toggle").addClass("disabled")};
_e.changeActiveSection=function(a,b,d){if(a instanceof String||"string"==typeof a)a=this.pageBody.find(6<a.length?"> #dock-"+a:"> ."+a).addClass("active-section");if(this.activeSection){if(this.activeSection[0]==a[0]&&!d)return;this.deActiveSection(this.activeSection)}d=this.activeSection;var c=this.settingBlock.find(".tool-icon.remove-dock");this.activeSection=a;a.is(".dockable")?(a.show(),c.removeClass("disabled"),this.cachedDock[a]||this.cacheDock(a.attr("id").substring(5)),this.settingBlock.find(".dock-css-header").show(),
this.editDockCss(!0)):c.addClass("disabled");this.activeSection.scrollHere();this.activeSection.addClass("active-section");this.initializeSectionForEditing(this.activeSection);this.activeSection.hasClass("body")?this.sectionHeight.length&&this.sectionHeight.stepper("disable")[0].isilent(""):(this.initWidgetMultiSelection(),this.sectionHeight.stepper("enable"));if(this.onSectionChange)this.onSectionChange(d,a);b||(a=a.is(".dockable")?a.attr("id").substring(5):a.attr("section"),this.activeSectionSelector.chosen("val",
a))};
_e.updatePageProperties=function(a){var b=this.settingBlock.find(".page-props .active-prop-view-container");b.empty();if("widget"!=this.leftbar_tab.tabify("getActive")&&this.settingBlock.find(".leftbar-accordion").accordion("current").is(".page-props")&&(!a||this.settingBlock.active_page_config_tab==a)){var d=this;this.settingBlock.active_page_config_tab||(this.settingBlock.active_page_config_tab="css",this.settingBlock.find(".page-props .tablike-button.css").addClass("active"));switch(this.settingBlock.active_page_config_tab){case "css":this.isResponsive&&(a=
'<div class="sidebar-group page-css-operators">',this.activeMedia&&(a+='<span class="tool-icon copy-other-media" title="'+$.i18n.prop("copy.all.from.other.media")+'"></span>'),a+='<span class="tool-icon remove remove-media" title="'+$.i18n.prop("remove.media")+'"></span></div>',b.append(a));this._handleCssMediaTools(d,b);d.editCss(b,d,"",void 0,[".body > .body-section > .widget-container",".body > .widget-container",".header > .widget-container, .footer > .widget-container"]);break;case "js":bm.ajax({url:d.editContainerJsUrl,
data:{containerId:d.containerId,containerJs:d.js},dataType:"html",success:function(a){a=$(a);b.append(a);a.find("textarea").change(function(){var a=this.value;d.setDirty("js",{js:d.js},{js:a});d.js=a})}})}}};
_e.updateWidgetConfig=function(a,b,d){var c=this,f=this.settingBlock.find(".widget-prop-configure .active-prop-view-container");if(this.selectedWidget){f.empty();if("widget"==this.leftbar_tab.tabify("getActive")){if(!d)return;this.leftbar_tab.tabify("activate","setting",!0)}if(!this.settingBlock.find(".leftbar-accordion").accordion("current").is(".widget-mode")){if(!d)return;this.settingBlock.find(".leftbar-accordion").accordion("expand","widget-mode-header")}if(b){if(this.settingBlock.active_config_tab!=
b)return;this.settingBlock.active_config_tab=b}else this.settingBlock.active_config_tab||(this.settingBlock.active_config_tab=b="basic",this.settingBlock.find(".widget-prop-configure .tablike-button.basic").addClass("active"));a||(a=this.selectedWidget.attr("id").substring(3));switch(this.settingBlock.active_config_tab){case "basic":var g=c.selectedWidget;a=g.attr("id").substring(3);var m=c.getWidgetObject(g),l=g.attr("widget-id");b={};l&&(b.widgetId=l);if(d=g.data("data-cache"))b.cache=d;var n=g.attr("widget-type"),
q="true"==g.attr("external-widget");q&&(b.isTemplateWidget=q,b.type=n,b.uuid=a);(l||d)&&bm.ajax({controller:"widget",action:app.widget[n]&&app.widget[n].no_config?"bareShortConfig":n+"ShortConfig",data:b,dataType:"html",success:function(a){a=$(a);f.append(a).updateUi();var b=a.filter(".widget-specific-config");bm.autoToggle(b).attachValidator().find("input:checkbox[name][uncheck-value]").pairuncheck();f.find(".advance-config-btn input").click(function(){c.advanceConfigureWidget()});f.find(".title-input input").change(function(){m.afterConfigChange();
var b=g.find(">.widget-title");b.length?this.value||b.remove():b=$('<div class="widget-title"></div>').prependTo(g);b.text(this.value);(b=g.data("data-cache"))||(b=a.filter(".widget-cache").val());var d=JSON.parse(b);d.title=this.value;g.data("data-cache",d=JSON.stringify(d));c.setDirty("widget_update",{widget:g,cache:b,obj:m},{widget:g,cache:d,obj:m},g);c.selectedWidget||f.empty()});f.find(".clazz-input input").change(function(){m.afterConfigChange();var b=this.value;g.attr("class","widget widget-"+
n+" "+b.trim());var d=g.data("data-cache");d||(d=a.filter(".widget-cache").val());var e=JSON.parse(d);e.clazz=b;g.data("data-cache",e=JSON.stringify(e));c.setDirty("widget_update",{widget:g,cache:d,obj:m},{widget:g,cache:e,obj:m},g);c.selectedWidget||f.empty()});f.find(".widget-specific-config").change(function(d){m.afterConfigChange();if(!(d.ignore||d.originalEvent&&d.originalEvent.ignore)&&b.valid()){var e=$(this).serializeObject();(d=g.data("data-cache"))||(d=a.filter(".widget-cache").val());var f=
app.widget[n];f||(f=app.widget.base);e=f.prototype.updateCacheForShortConfig(d,e,null,null,$(this),c);g.data("data-cache",e);c.setDirty("widget_update",{widget:g,cache:d,obj:m},{widget:g,cache:e,obj:m},g);m.render({widgetId:l,cache:e,type:n})}});app.widget[n]&&app.widget[n].initShortConfig&&app.widget[n].initShortConfig(f,g,c);c.selectedWidget||f.empty()},error:function(a,b,c){f.append(c)}});break;case "css":c.editWidgetCss(c.getWidgetObject(c.selectedWidget));break;case "js":var e=c.cachedWidgets[a];
b={js:e.js,type:c.selectedWidget.attr("widget-type"),uuid:a,overwrite:"undefined"!=typeof e.js};bm.ajax({url:c.editJsUrl,data:b,dataType:"html",success:function(a){a=$(a);f.append(a);a.find("textarea").change(function(){e.setJs(this.value);c.selectedWidget||f.empty()})}})}}};
_e._splitGrid=function(a,b,d,c,f,g,m){function l(){n.find(".editable-area-overlay.selected, .page-content.selected").length&&e.deselectGrid();e.clearEditableOverlay();e._destroyBodySortResize(q)}var n=this.activeSection.find(".editable-area-overlay.selected, .page-content.selected").parent(),q=this.activeSection,e=this,p=n.attr("class"),t=l.blend(function(){n.attr("class",p)}),w=l.blend(function(){n.addClass(a)}),y=n.children().not(".bmui-resize-handle, .editable-area-overlay"),A={},x={};if(g){b=
bm.getUUID();var z=$("<div class='grid-block "+d+"' id='spltr-"+b+"'></div>");w=w.blend(function(){n.after(z)});t=t.blend(function(){z.remove()})}else{g=bm.getUUID();var D=bm.getUUID();z=$("<div class='"+b+" grid-block' id='spltr-"+g+"'></div><div class='"+d+" grid-block' id='spltr-"+D+"'></div>");var B="#spltr-"+(c?D:g);var G="#spltr-"+(c?g:D);f||(m?(A.width="50%",x.width="50%"):(A.width="150px",A["max-width"]="150px",A.flex="0 0 150px"),t=t.blend(function(){e.removeRule(e.css,null,B,!0);e.removeRule(e.css,
null,G,!0)}),w=w.blend(function(){e.updateCss(e.css,null,B,A,void 0,void 0,!0);e.updateCss(e.css,null,G,x,void 0,void 0,!0)}));w=w.blend(function(){z.eq(c?0:1).html(y);n.html(z)});t=t.blend(function(){n.html(y);z.remove()})}d=function(){e.populateGridBlockSelector();e.initializeBodySectionSortResize(q);e.setEditableOverlay()};t=t.blend(d);w=w.blend(d);w();e.splitterDropped&&e.splitterDropped(n);this.setDirty({undo:t,redo:w})};
_e._attachSectionToolEvents=function(){var a=this;this.settingBlock.find(".tool-icon.add-section").click(function(){function b(){a.populateBodySectionSelector()}if(!$(this).is(".disabled")){var d=a.pageBody.find(".body > .body-section"),c=$("<div class='body-section'><div class='widget-container'></div><div class='body-section-overlay'></div></div>");a.setEditableOverlay(c);if(d.length){var f=d.filter(":has(.body-section-overlay.selected)");f.length||(f=d.last());var g=c;d={redo:function(){g.attr("id",
"bs-"+bm.getUUID());f.after(g);g.find("> .body-section-overlay.selected").removeClass("selected");g.find(".editable-area-overlay.selected, .page-content.selected").removeClass("selected");a.attachSoratableElementEvents(a.activeSection,g.find("> .widget-container"));a.grid_sortable.addElement(g.find("> .widget-container"))},undo:function(){a.detachSoratableElementEvents(g.find("> .widget-container"));g.detach()}}}else g=$("<div class='body-section'></div>"),g.attr("id","bs-"+bm.getUUID()),c.attr("id",
"bs-"+bm.getUUID()),d={redo:function(){g=a.pageBody.find(".body > .widget-container").wrap(g).parent();g.append("<div class='body-section-overlay'></div>");g.after(c);a.grid_sortable.addElement(c.find("> .widget-container"));a.attachSoratableElementEvents(c,c.find("> .widget-container"))},undo:function(){g.find(".body-section-overlay").remove();g.find("> .widget-container").unwrap();c.remove()}};d.redo=d.redo.blend(b);d.undo=d.undo.blend(b);a.setDirty(d);d.redo();c.scrollHere()}});this.settingBlock.find(".tool-icon.remove-section").click(function(){function b(){d.has("> .body-section-overlay.selected").length&&
a.deselectBodySection();d.find(".editable-area-overlay.selected, .page-content.selected").length&&a.deselectGrid();if(1==d.siblings(".body-section").length){c=d.siblings(".body-section");var b=c.find(".widget-container");c.after(b);c.remove()}d.remove();a.populateBodySectionSelector()}if(!$(this).is(".disabled")){var d=a.pageBody.find(".body > .body-section:has('> .body-section-overlay.selected')"),c,f=d.index();d.find(".page-content").length?bm.notify($.i18n.prop("section.with.page.content.not.remove"),
"alert"):(a.deselectBodySection(),a.removeAllWidgets(d,{old:function(){var b=a.pageBody.find(".body");0==f?b.prepend(d):b.find("> :eq("+(f-1)+")").after(d);c&&(b=d.siblings(".widget-container"),b.before(c),c.append(b));a.populateBodySectionSelector()},new:b}),b())}});this.settingBlock.find(".tool-icon.move-section-up").click(function(){if(!$(this).is(".disabled")){var b=a.pageBody.find(".body > .body-section:has('> .body-section-overlay.selected')");if(0!=b.prev().length){var d={redo:function(){b.prev().before(b)},
undo:function(){b.next().after(b)}};d.redo();a.setDirty(d);b.scrollHere()}}});this.settingBlock.find(".tool-icon.body-section-fluid-fixed-toggle").click(function(){if(!$(this).is(".disabled")){var b="#"+a.activeSection.find(".body-section:has(>.selected)").attr("id")+" > .widget-container",d=a.activeMedia,c=a.getCssValue(a.css,b,"width",d),f={redo:function(){"auto"==c?a.updateCss(a.css,null,b,void 0,["width"],d):a.updateCss(a.css,null,b,{width:"auto"},void 0,d)},undo:function(){"auto"==c?a.updateCss(a.css,
null,b,{width:"auto"},void 0,d):a.updateCss(a.css,null,b,void 0,["width"],d)}};f.redo();a.setDirty(f)}});this.settingBlock.find(".tool-icon.move-section-down").click(function(){if(!$(this).is(".disabled")){var b=a.pageBody.find(".body > .body-section:has('> .body-section-overlay.selected')");if(0!=b.next().length){var d={redo:function(){b.next().after(b)},undo:function(){b.prev().before(b)}};d.redo();a.setDirty(d);b.scrollHere()}}})};
_e.deselectGrid=function(){this.activeSection.find(".editable-area-overlay.selected, .page-content.selected").removeClass("selected");this.settingBlock.find(".layout-operators .tool-icon").addClass("disabled");this.settingBlock.find(".body-grids-selector select").chosen("val","");this.settingBlock.find(".layout-operators .fluid-v-split").addClass("disabled")};
(function(){function a(a){return/^(\d+)?-(\d+)?$/.test(a)?(a=a.split("-"),""==a[0]?"(max-width: "+a[1]+"px)":""==a[1]?"(min-width: "+a[0]+"px)":"(min-width: "+a[0]+"px) and (max-width: "+a[1]+"px)"):""+a}function b(b,c,f,g,m,l,n,q,e){function d(){t.remove();$(document).off(".editor-responsive-hide")}n||(n=this.getWidgetObject(this.selectedWidget));n=n.css.getMedias();var t=$("<div class='floating-css-panel'><div class='sidebar-group-body'>\r\n            <select class=\"hidden-res-selector\" "+(f?
'multiple="multiple"':"")+'></select>\r\n            </div><div class=\'sidebar-group-body\'>\r\n            <input type="button" class="apply-button" value=\''+$.i18n.prop("apply")+"'>\r\n            </div></div>");$(c).after(t);c=n.collect("definition");var w=[],y=t.find(".hidden-res-selector");if(l)w=c,this.activeMedia&&g&&w.remove(this.activeMedia);else{g=this.settingBlock.find(".change-resolution select option"+(m?":not(:first-child)":"")).clone();var A=Array.prototype.collect.call(g,"value").collect(function(){return a(this)});
c.every(function(){A.contains(""+this)||w.push(""+this)});y.append(g)}w.every(function(){var a=new Option(this,this);y.append(a);a.setAttribute("title",this)});t.position({my:q?q[0]:"left top",at:q?q[1]:"right top",of:b,collision:e?e:"flip"});$(document).on("mousedown.editor-responsive-hide",function(a){t.has(a.target).length||d()});t.hide=d;return t}_e.attachLayoutToolEvents=function(){function d(a,b,c,d){a?g.updateCss(g.css,null,c,{display:"none"},void 0,d):g.updateCss(g.css,null,c,void 0,["display"],
d);var e="#"+b.siblings(".grid-block").attr("id");b.is(".no-fixed-left, .no-fixed-right")?a?g.updateCss(g.css,null,e,{display:"block",width:"auto"},void 0,d):(a=100-parseFloat(g.getCssValue(g.css,c,"width",d)),g.updateCss(g.css,null,e,{width:a+"%"},["display"],d)):b.is(".l-fixed-right, .r-fixed-left")&&(a?g.updateCss(g.css,null,e,{width:"auto","max-width":"unset",flex:"1 1 0px"},void 0,d):g.updateCss(g.css,null,e,{width:"150px","max-width":"150px",flex:"0 0 150px"},void 0,d))}function c(a,b,c,d){var e=
"#"+b.siblings(".grid-block").attr("id");if(b.is(".r-fixed-left, .l-fixed-right")){var f=c;c=e;e=f}a?b.is(".no-fixed-left, .no-fixed-right")?(g.updateCss(g.css,null,c,{width:"50%"},void 0,d),g.updateCss(g.css,null,e,{width:"50%"},void 0,d)):(a=b.parent(),b=a.attr("id"),b||(b="container-"+bm.getUUID(),a.attr("id",b)),g.updateCss(g.css,null,"#"+b,void 0,["display"],d),(e=g.getCssValue(g.css,"#"+b,"display",""))&&(a.is(".no-fixed-left, .no-fixed-right")?"inline-flex"!=e&&g.updateCss(g.css,null,"#"+b,
{display:"inline-flex"},void 0,d):"flex"!=e&&g.updateCss(g.css,null,"#"+b,{display:"flex"},void 0,d)),a=g.getCssValue(g.css,c,"flex",d),a=a.split(" ")[2],g.updateCss(g.css,null,c,{width:a,"max-width":a,flex:"0 0 "+a},void 0,d)):b.is(".no-fixed-left, .no-fixed-right")?(g.updateCss(g.css,null,c,{width:"100%"},void 0,d),g.updateCss(g.css,null,e,{width:"100%"},void 0,d)):(a=b.parent(),b=a.attr("id"),b||(b="container-"+bm.getUUID(),a.attr("id",b)),g.updateCss(g.css,null,"#"+b,{display:a.is(".no-fixed-left, .no-fixed-right")?
"inline-block":"block"},void 0,d),g.updateCss(g.css,null,c,{width:"auto","max-width":"unset"},void 0,d))}function f(a,b,c){if(a.is(".no-fixed-right, .no-fixed-left"))return a=g.getCssValue(g.css,b,"width",c),"100%"==a;if(a.is(".l-fixed-left, .r-fixed-right"))return a=g.getCssValue(g.css,b,"width",c),"auto"==a;if(a.is(".r-fixed-left, .l-fixed-right"))return a=g.getCssValue(g.css,"#"+a.siblings(".grid-block").attr("id"),"width",c),"auto"==a}var g=this;this.settingBlock.find(".tool-icon.l-fixed-layout").click(function(){g._splitGrid("l-fixed-container",
"l-fixed-left","l-fixed-right",0)});this.settingBlock.find(".tool-icon.r-fixed-layout").click(function(){g._splitGrid("r-fixed-container","r-fixed-left","r-fixed-right",1)});this.settingBlock.find(".v-split-layout").click(function(){var a=g.activeSection.find(".editable-area-overlay.selected, .page-content.selected").parent();g._splitGrid("v-split-container","v-split","v-split",1,!0,a.hasClass("v-split"))});this.settingBlock.find(".tool-icon.fluid-splitted-layout").click(function(){g._splitGrid("no-fixed-container",
"no-fixed-left","no-fixed-right",1,!1,!1,!0)});this.settingBlock.find(".tool-icon.merge-left").click(function(){var a=g.activeSection.find(".editable-area-overlay.selected, .page-content.selected").parent();(a=g.getMergableGrids(a,"left"))&&g.mergeTwoBlocks(a[0],a[1])});this.settingBlock.find(".tool-icon.merge-right").click(function(){var a=g.activeSection.find(".editable-area-overlay.selected, .page-content.selected").parent();(a=g.getMergableGrids(a,"right"))&&g.mergeTwoBlocks(a[0],a[1])});this.settingBlock.find(".layout-operators .tool-icon.show-hide").click(function(){var a=
g.activeSection.find(".editable-area-overlay.selected, .page-content.selected").parent(),b="#"+a.attr("id"),c=g.getCssValue(g.css,b,"display")||"initial",f=g.css.toString();d("initial"==c,a,b);g.setDirty("css_change",{css:f,obj:g},{css:g.css.toString(),obj:g})});this.settingBlock.find(".layout-operators .tool-icon.hide-in-resolutions").click(function(c){var f=[],m=g.activeSection.find(".editable-area-overlay.selected, .page-content.selected").parent(),q="#"+m.attr("id"),e=g.css.getAttribute(q,"display");
"none"==e&&f.push($.i18n.prop("global"));g.css.getMedias().every(function(){e=this.getAttribute(".responsive "+q,"display");"none"==e&&f.push(this.definition)});var p=b.call(g,c,$(this),!0,!1,!1,!1,g,["right+70 top+17","left bottom"],"none");c=p.find("select");c.find("option").each(function(){var b=this.value||$.i18n.prop("global");f.contains(a(b))&&(this.selected=!0)});c.chosen({});var t=[];c.on("selection_removed",function(a,b){w.contains(b)?w.remove(b):t.push(b)});var w=[];c.on("selection_added",
function(a,b){t.contains(b)?t.remove(b):w.push(b)});p.find("input.apply-button").click(function(){p.hide();if(t.length||w.length){var b=g.css.toString();t.every(function(){var b=a(this);d(!1,m,q,b)});w.every(function(){var b=a(this);d(!0,m,q,b)});g.setDirty("css_change",{css:b,obj:g},{css:g.css.toString(),obj:g})}})});this.settingBlock.find(".layout-operators .tool-icon.switch-width").click(function(){var a=g.activeSection.find(".editable-area-overlay.selected, .page-content.selected").parent(),b=
"#"+a.attr("id"),d=f(a,b),q=g.css.toString();c(d,a,b);g.setDirty("css_change",{css:q,obj:g},{css:g.css.toString(),obj:g})});this.settingBlock.find(".layout-operators .tool-icon.fluid-in-resolutions").click(function(d){var l=[],m=g.activeSection.find(".editable-area-overlay.selected, .page-content.selected").parent(),q="#"+m.attr("id"),e=f(m,q,"");e&&l.push($.i18n.prop("global"));g.css.getMedias().every(function(){(e=f(m,q,this.definition))&&l.push(this.definition)});var p=b.call(g,d,$(this),!0,!1,
!1,!1,g,["right+100 top+17","left bottom"],"none");d=p.find("select");d.find("option").each(function(){var b=this.value||$.i18n.prop("global");l.contains(a(b))&&(this.selected=!0)});d.chosen({});var t=[];d.on("selection_removed",function(a,b){w.contains(b)?w.remove(b):t.push(b)});var w=[];d.on("selection_added",function(a,b){t.contains(b)?t.remove(b):w.push(b)});p.find("input.apply-button").click(function(){p.hide();if(t.length||w.length){var b=g.css.toString();t.every(function(){var b=a(this);c(!0,
m,q,b)});w.every(function(){var b=a(this);c(!1,m,q,b)});g.setDirty("css_change",{css:b,obj:g},{css:g.css.toString(),obj:g})}})});this.settingBlock.find(".layout-operators .fluid-v-split").click(function(a){if(!$(this).is(".disabled")){var b="#"+g.activeSection.find(".v-split:has(>.editable-area-overlay.selected)").attr("id"),c=g.activeMedia,d=g.getCssValue(g.css,b,"width",c);a={redo:function(){"auto"==d?g.updateCss(g.css,null,b,void 0,["width"],c):g.updateCss(g.css,null,b,{width:"auto"},void 0,c)},
undo:function(){"auto"==d?g.updateCss(g.css,null,b,{width:"auto"},void 0,c):g.updateCss(g.css,null,b,void 0,["width"],c)}};a.redo();g.setDirty(a)}})};_e._handleCssMediaTools=function(d,c,f){var g=this;c.find(".tool-icon.remove-media").click(function(c){var l=b.call(g,c,$(this),!1,!1,!0,!0,d),m=l.find("select");m.chosen({});l.find("input.apply-button").click(function(){var b=m.chosen("val");if(b){l.hide();var c=d.css.toString();b=a(b);d.css.removeMedia(b);g.persistCss(f,d.css);b=function(){d instanceof
app.tabs.edit_content.Widget&&(d.updateMemoryStyle(),d.positionReferenceLine())};g.setDirty("css_change",{css:c,uuid:f,obj:d,handler:b},{css:d.css.toString(),uuid:f,obj:d,handler:b},d.elm);b()}})});c.find(".tool-icon.copy-other-media").click(function(c){var l=b.call(g,c,$(this),!1,!0,!0,!0,d),m=l.find("select");m.chosen({});l.find("input.apply-button").click(function(){var b=m.chosen("val");if(g.activeMedia&&b&&g.activeMedia!=b){l.hide();var c=d.css.toString();b=a(b);b=d.css.getMedia(b);var n=d.css.getMedia(g.activeMedia);
n||(n=d.css.addMedia(g.activeMedia));n.merge(b);g.persistCss(f,d.css);b=function(){d instanceof app.tabs.edit_content.Widget&&(d.updateMemoryStyle(),d.positionReferenceLine())};g.setDirty("css_change",{css:c,uuid:f,obj:d,handler:b},{css:d.css.toString(),uuid:f,obj:d,handler:b},d.elm);b()}})})};_e.handleCssEditorTools=function(d){var c=this,f=this.selectedWidget,g=f.attr("id").substring(3),m=this.getWidgetObject(f);d.find(".tool-icon.show-hide").click(function(){var a=c.getCssValue(m.css,"#wi-"+g,
"display")||"block",b=m.css.toString();"block"==a?c.updateCss(m.css,g,"#wi-"+g,{display:"none"}):(c.updateCss(m.css,g,"#wi-"+g,void 0,["display"]),m.elm.is(":hidden")&&c.updateCss(m.css,g,"#wi-"+g,{display:"block"}));a=function(){m.positionReferenceLine()};c.setDirty("css_change",{css:b,uuid:g,obj:m,handler:a},{css:m.css.toString(),uuid:g,obj:m,handler:a},f);a()});d.find(".tool-icon.hide-in-resolutions").click(function(d){var l=[],q="#wi-"+g,e=m.css.getAttribute(q,"display");"none"==e&&l.push($.i18n.prop("global"));
m.css.getMedias().every(function(){e=this.getAttribute(".responsive "+q,"display");"none"==e&&l.push(this.definition)});var p=b.call(c,d,$(this),!0,!1,!1,!1,m);d=p.find("select");d.find("option").each(function(){var b=this.value||$.i18n.prop("global");l.contains(a(b))&&(this.selected=!0)});d.chosen({});var t=[];d.on("selection_removed",function(a,b){w.contains(b)?w.remove(b):t.push(b)});var w=[];d.on("selection_added",function(a,b){t.contains(b)?t.remove(b):w.push(b)});p.find("input.apply-button").click(function(){p.hide();
if(t.length||w.length){var b=m.css.toString();t.every(function(){var b=a(this);c.updateCss(m.css,g,"#wi-"+g,void 0,["display"],b);m.elm.is(":hidden")&&c.updateCss(m.css,g,"#wi-"+g,{display:"block"},void 0,b)});w.every(function(){var b=a(this);c.updateCss(m.css,g,"#wi-"+g,{display:"none"},void 0,b)});var d=function(){m instanceof app.tabs.edit_content.Widget&&(m.updateMemoryStyle(),m.positionReferenceLine())};c.setDirty("css_change",{css:b,uuid:g,obj:m,handler:d},{css:m.css.toString(),uuid:g,obj:m,
handler:d},f);d()}})});this._handleCssMediaTools(m,d,g)}})();
_e.mergeTwoBlocks=function(a,b){function d(){q.find(".editable-area-overlay.selected, .page-content.selected").length&&f.deselectGrid();f.clearEditableOverlay();f._destroyBodySortResize(q)}function c(){f.populateGridBlockSelector();f.initializeBodySectionSortResize(q);f.setEditableOverlay()}var f=this,g=a.parent(),m,l,n,q=this.activeSection;a.is(".l-fixed-left")?m="l-fixed-container":a.is(".no-fixed-left")?m="no-fixed-container":a.is(".r-fixed-left")?m="r-fixed-container":1==a.siblings(".v-split").length&&
(m="v-split-container");var e=a.attr("class"),p=b.attr("class");e.split(" ").every(function(){if(this.endsWith("-container"))return l=this,!1});p.split(" ").every(function(){if(this.endsWith("-container"))return n=this,!1});var t,w,y=a.attr("id"),A=b.attr("id"),x=[];e={redo:d.blend(function(){t=a.children();w=b.children();m&&g.removeClass(m);(l||n)&&g.addClass(l||n);if(a.is(".v-split")&&1<a.siblings(".v-split").length)a.append(w),b.remove(),a.addClass(n);else{g.html(t).append(w);var c=f.removeRule(f.css,
null,"#"+y,!0);c&&x.pushAll(c)}(c=f.removeRule(f.css,null,"#"+A,!0))&&x.pushAll(c)}).blend(c),undo:d.blend(function(){m&&g.addClass(m);(l||n)&&g.removeClass(l||n);a.parent().length?(a.after(b),b.append(w),a.removeClass(n)):(a.append(t),b.append(w),g.html(a).append(b));x&&(x.every(function(){this[0].addRule(this[1])}),f.persistCss(null,f.css))}).blend(c)};e.redo();this.setDirty(e)};
_e.initSidebar=function(){var a=this;this.settingBlock=this.body.find(".setting-block-panel");this.widgetSelector=this.body.find("select.active-widget-selector");this.widgetSelector.obj(Chosen).disable_search=!0;this.settingBlock.find(".leftbar-accordion").accordion({expand:function(b,c){c.is(".page-props")?a.updatePageProperties():c.is(".page-props")?a.updateWidgetConfig():c.is(".dpck-css")&&a.editDockCss()}});var b=this.settingBlock.find(".remove-dock");a.body.find(".block-chooser .splitter");a.activeSectionSelector=
this.settingBlock.find("select.active-section-selector").change(function(){var b=$(this).val();a.changeActiveSection(b,!0)}).chosen({disable_search:!0});a.activeSectionSelector.chosen({disable_search:!0});this.widgetSelector.change(function(){if(""==this.value)a.unselectWidget();else{var b=a.activeSection.find("#"+this.value);a.selectWidget(b,{widget_selector_update:!1});b.scrollHere()}});this.settingBlock.find("select.active-widget-ref-unit-selector").change(function(){var b=a.selectedWidget,c=a.getWidgetObject(b),
f=$.extend({},c.style),g=c.elm.parent(),m=g.innerWidth();g=g.innerHeight();"%"==this.value?(c.isLeft()&&(c.style.left=parseFloat(c.style.left)/m*100+"%"),c.isRight()&&(c.style.right=parseFloat(c.style.right)/m*100+"%"),c.isTop()&&(c.style.top=parseFloat(c.style.top)/g*100+"%"),c.isBottom()&&(c.style.bottom=parseFloat(c.style.bottom)/g*100+"%")):(c.isLeft()&&(c.style.left=parseFloat(c.style.left)/100*m+"px"),c.isRight()&&(c.style.right=parseFloat(c.style.right)/100*m+"px"),c.isTop()&&(c.style.top=
parseFloat(c.style.top)/100*g+"px"),c.isBottom()&&(c.style.bottom=parseFloat(c.style.bottom)/100*g+"px"));m=$.extend({},c.style);var l=this.value;c.percentage="%"==l;c.applyStyle(m);a.setDirty("widget_reposition",{widget:b,style:f,handler:function(){a.settingBlock.find(".widget-ref-unit-selector select").chosen("val","%"==l?"px":"%")}},{widget:b,style:m,handler:function(){a.settingBlock.find(".widget-ref-unit-selector select").chosen("val",l)}},b)});this.settingBlock.find(".add-dock").click(function(){a.addDock()});
b.click(function(){$(this).is(".disabled")||a.removeDock()});this.isResponsive&&this.settingBlock.find(".change-resolution select").change(function(){a.resolutionChange(this.value)});this.settingBlock.find(".tool-icon.remove-widget").click(function(){if(!$(this).is(".disabled")){var b;a.selectedWidget.attr("id")&&(b=a.selectedWidget.attr("id").substring(3));a.removeWidget(a.activeSection,b)}});this.settingBlock.find(".widget-prop-configure .tablike-button").click(function(){$(this).is(".active")||
($(this).addClass("active").siblings(".active").removeClass("active"),$(this).is(".basic")?a.settingBlock.active_config_tab="basic":$(this).is(".css")?a.settingBlock.active_config_tab="css":a.settingBlock.active_config_tab="js",a.updateWidgetConfig())});this.settingBlock.find(".page-props .tablike-button").click(function(){$(this).is(".active")||($(this).addClass("active").siblings(".active").removeClass("active"),$(this).is(".css")?a.settingBlock.active_page_config_tab="css":a.settingBlock.active_page_config_tab=
"js",a.updatePageProperties())});this.settingBlock.find(".accordion-item").scrollbar({reduce_margin_from_offset:!1});this.body.find(".widget-block-panel .widget-item .favorite-mark").on("click",function(){var b=$(this),c=b.parent(".widget-item");a.modifyFavoriteWidget(c,b.is(".active")?"remove":"add")});bm.instantSearch(this.body.find("#bmui-tab-widget"),this.body.find("#bmui-tab-widget .search-form"),".widget-item",".title");this._attachSectionToolEvents();this.attachLayoutToolEvents()};
_e.modifyFavoriteWidget=function(a,b){var d=this;bm.ajax({url:d.modifyFavoriteWidgetUrl,data:{widgetType:a.attr("widget-type"),operation:b}});a.fadeOut(500,function(){"add"==b?(a.find(".favorite-mark").addClass("active"),d.body.find("#bmui-tab-widget .widget-separator.other").before(a)):(a.find(".favorite-mark").removeClass("active"),d.body.find("#bmui-tab-widget").append(a));a.fadeIn(500)})};
_e.updateSectionDimensionSpinners=function(){var a=this.activeSection.attr("section");"body"==a?(a=this.getCssValue(this.css,".body > .widget-container","width"),this.sectionWidth.length&&(this.sectionWidth[0].isilent("auto"!=a&&a?parseFloat(a):""),this.sectionHeight.stepper("disable")[0].isilent(""))):"header"==a||"footer"==a?(a=this.getCssValue(this.css,"."+a+" > .widget-container",["width","height"]),this.sectionWidth.length&&(this.sectionWidth[0].isilent(a&&"auto"!=a.width&&a.width?parseFloat(a.width):
""),this.sectionHeight.stepper("enable")[0].isilent(a?parseFloat(a.height):""))):this.activeSection.is(".dockable")&&(a=this.getCssValue(this.cachedDock[a].css,"#dock-"+a,["width","height"]),this.sectionWidth.length&&(this.sectionWidth[0].isilent(a&&"auto"!=a.width&&a.width?parseFloat(a.width):""),this.sectionHeight.stepper("enable")[0].isilent(a?parseFloat(a.height):"")))};
_e.populateGridBlockSelector=function(){var a=this,b=this.settingBlock.find(".body-grids-selector select");b.find("option").remove();b.append(new Option($.i18n.prop("select.grid.block"),"",!0,!0));this.activeSection.find(this.editableBlockSelector).each(function(){var a=$(this);if(a.is(".page-content")){a=".page-content";var c=$.i18n.prop("widget.container")}else a.is(".widget-container")?(a=a.parent().is(".page-content")?".page-content > .widget-container":(a=a.parent().attr("id"))?"#"+a+" > .widget-container":
"> .widget-container",c=$.i18n.prop("widget.container")):(a="#"+a.attr("id"),c=a.substring(7));b.append(new Option(c,a))});b.chosen("destroy");b.chosen({disable_search:!0});b.off(".editor").on("change.editor",function(){var b=this.value;b?a.selectGrid(a.activeSection.find(b),!1):a.deselectGrid()})};
_e.populateBodySectionSelector=function(){var a=this,b=this.settingBlock.find(".body-sections-selector select");b.find("option").remove();b.append(new Option($.i18n.prop("select.body.section"),"",!0,!0));this.activeSection.find(".body-section").each(function(){var a=$(this).attr("id"),c=a.substring(3);b.append(new Option(c,a))});b.chosen("destroy");b.chosen({disable_search:!0});b.off(".editor").on("change.editor",function(){var b=this.value;b?a.selectBodySection(a.activeSection.find("#"+b),!0):a.deselectBodySection()})};
_e.populateWidgetSelector=function(){this.widgetSelector.find("option").remove();var a=this.activeSection.find(this.supportedWidgetSelector).not("."+this.widgetClass+" ."+this.widgetClass),b=[];b.push("<option value=''>"+$.i18n.prop("active.section.widgets")+"</option>");$.each(a,function(){var a=$(this),c=a.attr("widget-type");a=a.attr("id");b.push("<option value='"+a+"'> "+c+"-"+a.substring(3)+" </option>")});for(a=0;a<b.length;a++)this.widgetSelector.append($(b[a]));this.widgetSelector.trigger("chosen:updated")};
_e.getBodyContent=function(){return this.pageBody.find(".body").clone()};_e.getWidgetTag=function(a,b){return"<wi:widget uuid ='"+a+"' type='"+b+"'/>"};
_e.getSavedData=function(){var a=this,b=function(b){var c=[];b.each(function(){var b=$(this).attr("id").substring(3),d=a.cachedWidgets[b];b={uuid:d.uuid,type:d.type,cache:d.elm.data("data-cache"),copied:!0,css:d.css.toString(),templateServerUuid:d.templateServerUuid,groupId:d.group};void 0!=d.js&&(b.js=d.js);d=d.elm.closest(".dockable");d.length&&(b.dockUUID=d.attr("id").substring(5));c.push(b)});return c},d={};["header","body","footer","dockable"].every(function(){d[this]=b(a.pageBody.find("."+this+
" [new-widget]"))});var c=[];a.newDocks.every(function(){c.push({uuid:this.uuid,css:this.css.toString()})});a.modifiedDocks.every(function(){var b=a.cachedDock[this],d=b.elm.attr("dock-id");a.removedDock.contains(d)||c.push({uuid:b.uuid,css:b.css.toString(),dockId:d})});var f={};this.pageBody.find("[modified-widget]").each(function(){var b=$(this).attr("id").substring(3),c=a.cachedWidgets[b],d=c.css;f[b]={uuid:b,type:c.type,cache:c.elm.data("data-cache"),css:d.toString(),js:c.js,groupId:c.group}});
var g=this.css.toString(),m=this.js,l=[];this.removedWidgets.every(function(a,b){b instanceof Array?l.pushAll(b):l.push(b)});g={modified:JSON.stringify(f),removed:JSON.stringify(l),removedDock:JSON.stringify(a.removedDock),docks:JSON.stringify(c),containerId:this.containerId,containerType:this.containerType,containerCss:g,layoutId:a.layout_id,added_in_header:JSON.stringify(d.header),added_in_footer:JSON.stringify(d.footer),added_in_body:JSON.stringify(d.body),added_in_dock:JSON.stringify(d.dockable)};
var n=this.getBodyContent();n.find("*").each(function(){var b=$(this);b.removeAttr("style").removeClass("bmui-draggable bmui-resizable");b.filter(".widget-overlay, .section-overlay, .editable-area-overlay, .body-section-overlay, .bmui-resize-handle").replaceWith("");b.hasClass("page-content")&&b.replaceWith("<wi:widget type='page'/>");if(b.hasClass(a.widgetClass)){var c=b.attr("widget-type"),d=b.attr("id");d=d?d.substring(3):null;b.replaceWith(a.getWidgetTag(d,c))}});g.bodyContent=n.length?n.html().trim():
"";void 0!=m&&(g.containerJs=m);return g};
_e.save=function(a){var b=this,d=["header","body","footer"].contains(this.section)?this.section:"dockable";if(this.pageBody.find("."+d+" [external-widget=true]").length)return bm.notify($.i18n.prop("you.have.unconfigured.widget"),"error"),!1;d=b.getSavedData();b.mask();bm.ajax({url:app.baseUrl+b.contentSaveUrl,data:d,response:function(){b.unmask()},success:function(c){b.clearDirty();b.clearSavedData(c);b.activeSection.find(".widget").removeAttr("cloned");a&&a();b.unselectWidget()}})};
_e.revert=function(a){var b=this;this.pageBody.loader();var d=this.iframe.attr("src");d=bm.path(d);this.reload_performed=!0;this.iframe.one("sure-load",function(){b.clearDirty();a&&a()});this.iframe.attr("src",d.full())};
_e.attachEvent=function(){function a(a,c){if(c.doer&&c.doer.section)var d=c.doer.section;else c.previous.section&&(d=c.previous.section);d&&d[0]!=b.activeSection[0]&&b.changeActiveSection(d)}var b=this;this.body.find(".toolbar .save").click(function(){$(this).hasClass("disabled")||b.save()});var d=this.body.find(".toolbar .undo"),c=this.body.find(".toolbar .redo");this.undo_redo=UndoRedoFactory.createManager(d,c,{changeState:function(a,c,d){switch(a){case "section_height":b.setSectionHeight(b.activeSection,
c);b.sectionHeight[0].isilent(c);break;case "section_width":b.setSectionWidth(b.activeSection,c);b.sectionWidth[0].isilent(c);break;case "js":b.js=c.js;b.updatePageProperties("js");break;case "widget_relocate":$.isArray(c)||(c=[c],c.handler=c[0].handler,d=[d],d.handler=d[0].handler);c.revery(function(a,c){a=d[c];c=this.widget.attr("id").substring(3);this.cache&&(b.cachedWidgets[c]=this.cache);if(void 0!=this.index)if(0<this.index){var e=this.index;a.parent&&this.parent&&a.parent[0]==this.parent[0]&&
e>a.index&&e++;this.parent.find(">."+b.widgetClass+":eq("+(e-1)+")").after(this.widget)}else this.parent.prepend(this.widget);else this.widget.detach();b.selectedWidget&&b.selectedWidget[0]==this.widget[0]&&b.unselectWidget();if(!a.parent||!this.parent){e=b.cachedWidgets[c];e=e.templateServerUuid?e.templateServerUuid:e.elm.is("[external-widget=true]")?c:null;if(!this.widget.is("[new-widget]")||e)a.parent?b.removedWidgets.push({uuid:c,section:b.activeSection.attr("section"),templateServerUuid:e}):
b.removedWidgets.pop();b.populateWidgetSelector()}});break;case "widget_js":c.obj.js=c.js;break;case "widget_reposition":b.getWidgetObject(c.widget).applyStyle(c.style);break;case "widget_update":a=c.widget.attr("widget-type");var f={cache:c.cache,type:a,widgetId:c.widget.attr("widget-id")};f.cache||f.widgetId?b.getWidgetObject(c.widget).render(f):b.getWidgetObject(c.widget).updateContent(b.getEmptyWidgetDom(a));break;case "css_change":c.obj.css=(new CssParser(c.css)).parse(),b.persistCss(c.uuid,
c.obj.css),c.obj instanceof app.tabs.edit_content?b.updatePageProperties("css"):c.obj instanceof app.tabs.edit_content.Widget?b.updateWidgetConfig(c.uuid,"css"):b.editDockCss()}c.handler&&c.handler(d)}});c.intercept("redo",a).on("redo",function(){b.isDirty()||b.setDirty();b.selectedWidget&&b.updateWidgetConfig()});d.intercept("undo",a).on("undo_bottom_reached",function(){b.clearDirty(!0)}).on("undo",function(){b.selectedWidget&&b.updateWidgetConfig()});this.body.find(".toolbar .align").click(function(){var a=
$(this);if(!a.is(".disabled")){var c=a.is(".align-left")?"left":a.is(".align-right")?"right":a.is(".align-top")?"top":"bottom";var d="left"==c||"top"==c?!0:!1,l=b.multiSelectedWidget.find("> .multi-selection-master-widget").closest("."+b.widgetClass);if(!l.length){var n=Number.MAX_VALUE*(d?1:-1);b.multiSelectedWidget.each(function(){var a=$(this),b=a.rect();if(d?b[c]<n:b[c]>n)n=b[c],l=a})}var q=b.getWidgetObject(l).getPos();a=b.multiSelectedWidget.not(l);var e=l.closest(".widget-container"),p=e.innerWidth(),
t=e.innerHeight();if(!l.parent().is(e)){var w=l.parent(),y=w.pposition();q.left+=y.left+w.leftRib(!0,!0,!1);q.top+=y.top+w.topRib(!0,!0,!1);q.right+=y.right+w.rightRib(!0,!0,!1);q.bottom+=y.bottom+w.bottomRib(!0,!0,!1)}a.each(function(){var a=$(this),d=b.getWidgetObject(a),f=0,g=0,l=0,m=0,n=a.parent(),w=p,y=t;if(!n.is(e)){m=a.parent();var fa=m.pposition(void 0,!0);w=fa.width;y=fa.height;f=fa.left+m.leftRib(!0,!0,!1);g=fa.top+m.topRib(!0,!0,!1);l=fa.right+m.rightRib(!0,!0,!1);m=fa.bottom+m.bottomRib(!0,
!0,!1)}"left"==c?(y=q.left-f,d.isLeft()||(y=w-y-a.outerWidth(!0)),d.percentage&&(a=n.innerWidth(),y=y/a*100),d.setX(y)):"right"==c?(y=q.right-l,d.isLeft()&&(y=w-y-a.outerWidth(!0)),d.percentage&&(a=n.innerWidth(),y=y/a*100),d.setX(y)):("top"==c?(w=q.top-g,d.isBottom()&&(w=y-w-a.outerHeight(!0))):(w=q.bottom-m,d.isTop()&&(w=y-w-a.outerHeight(!0))),d.percentage&&(a=n.innerHeight(),w=w/a*100),d.setY(w))})}});this.body.find(".toolbar .engroup").click(this.groupWidgets.bind(this));this.body.find(".toolbar .ungroup").click(this.ungroupWidgets.bind(this));
this.on("active",function(){this.undo_redo.activateHotkey()}).on("deActive",function(){this.undo_redo.deactivateHotkey()}).on("close",function(){this.undo_redo.destroy();b.iframeWindow&&$(b.iframeWindow.document).off("."+b.id)})};
_e.groupWidgets=function(){var a=this,b=bm.getUUID(),d=$("<div class='widget-group'></div>").attr("id","group-"+b),c=this.activeSection.find("> .widget-container"),f=function(){c.append(d)},g=function(){d.remove()},m=c.offset();m={left:-1*m.left,top:-1*m.top};var l=Number.MAX_VALUE,n=Number.MAX_VALUE,q=0,e=0,p=this.multiSelectedWidget;if(p){p.each(function(){var a=$(this).rect(m);a.left<l&&(l=a.left);a.top<n&&(n=a.top);a.right>q&&(q=a.right);a.bottom>e&&(e=a.bottom)});var t={left:l+"px",top:n+"px",
width:q-l+"px",height:e-n+"px"};f=f.blend(function(){d.append(p);a.updateCss(a.css,void 0,"#group-"+b,t)});g=g.intercept(function(){a.removeRule(a.css,void 0,"#group-"+b)});var w={},y={};this.multiSelectedWidget.each(function(){var b=$(this),c=a.getWidgetObject(b).style;w[b.attr("id")]=$.extend({},c);y[b.attr("id")]=b.rect()});f();var A=d.rect();this.multiSelectedWidget.each(function(){var e=$(this),l=a.getWidgetObject(e),m=l.style,n=l.group,p=w[e.attr("id")],q=y[e.attr("id")],t=e.find(".widget-overlay")[0].style.borderLeftColor,
fa=e.parent().innerWidth(),da=e.parent().innerHeight();if(l.isLeft()){var M=q.left-A.left-d.leftRib(!0,!0,!1);m.left=l.percentage?M/fa*100+"%":M+"px"}l.isRight()&&(M=q.right-A.right-d.rightRib(!0,!0,!1),m.right=l.percentage?M/fa*100+"%":M+"px");l.isTop()&&(fa=q.top-A.top-d.topRib(!0,!0,!1),m.top=l.percentage?fa/da*100+"%":fa+"px");l.isBottom()&&(q=q.bottom-A.bottom-d.bottomRib(!0,!0,!1),m.bottom=l.percentage?q/da*100+"%":q+"px");var V=function(a,b,c){l.applyStyle(a);l.group=b;e.find(".widget-overlay")[0].style.borderColor=
c};f=f.blend(function(){V(m,b,x)});g=g.intercept(function(){V(p,n,t);var a=c;n&&(a=c.find("> #group-"+n));a.append(e)});V(m,b,x)});this.setDirty({undo:g,redo:f},void 0,void 0,p);this.assignColorToGroups(d);var x=p.eq(0).find(".widget-overlay")[0].style.borderLeftColor;this.body.find(".toolbar .multiselection .toolbar-item.ungroup").removeClass("disabled")}};
_e.ungroupWidgets=function(){var a=function(){},b=function(){},d=this,c=this.activeSection.find("> .widget-container");this.multiSelectedWidget&&(this.multiSelectedWidget.each(function(){var f=$(this);if(!f.parent().is(".widget-container")){var g=d.getWidgetObject(f),m=g.style,l=g.group,n=$.extend({},m),q=f.parent(),e=g.getPos(),p=f.find(".widget-overlay").css("border-left-color"),t=q.pposition();t.left+=q.leftRib(!0,!0,!1);t.top+=q.topRib(!0,!0,!1);t.right+=q.rightRib(!0,!0,!1);t.bottom+=q.bottomRib(!0,
!0,!1);g.isLeft()&&(m.left=t.left+e.left+"px");g.isRight()&&(m.right=t.right+e.right+"px");g.isTop()&&(m.top=t.top+e.top+"px");g.isBottom()&&(m.bottom=t.bottom+e.bottom+"px");var w=$.extend({},m);g.percentage&&(t=f.closest(".widget-container"),e=t.innerWidth(),t=t.innerHeight(),g.isLeft()&&(w.left=parseFloat(w.left)/e*100+"%"),g.isTop()&&(w.top=parseFloat(w.top)/t*100+"%"),g.isRight()&&(w.right=parseFloat(w.right)/e*100+"%"),g.isBottom()&&(w.bottom=parseFloat(w.bottom)/t*100+"%"));b=b.blend(function(){g.applyStyle(w);
g.group=void 0;c.append(f);f.find(".widget-overlay").css("border-color","")});a=a.intercept(function(){g.applyStyle(n);g.group=l;q.append(f);f.find(".widget-overlay").css("border-color",p)});g.applyStyle(m);g.group=void 0}}),b(),this.setDirty({undo:a,redo:b},void 0,void 0,this.multiSelectedWidget),this.body.find(".toolbar .multiselection .toolbar-item.ungroup").addClass("disabled"))};
_e.removeAllWidgets=function(a,b){var d=this,c=a.find("."+d.widgetClass),f=[],g,m;$.each(c,function(){var b=d.getWidgetObject($(this)).uuid;b=d.removeWidget(a,b,!0);f.push(b);g=g?g.blend(b.handler):b.handler;m=m?m.blend(b.handler):b.handler});c=f.collect(function(){return{widget:this.widget}});b&&(f.handler=b.old,c.handler=b.new);g&&(f.handler=f.handler?f.handler.blend(g):g);m&&(c.handler=c.handler?c.handler.blend(m):m);d.setDirty("widget_relocate",f,c)};
_e.clearSavedData=function(a){var b=this;this.pageBody.find("[modified-widget]").removeData("data-cache").removeAttr("modified-widget");a.newWidgets&&$.each(a.newWidgets,function(){b.pageBody.find("#wi-"+this.uuid).removeData("data-cache").removeAttr("new-widget").attr("widget-id",this.id)});b.containerId=a.containerId;b.removedWidgets=[];a.newDocks&&$.each(a.newDocks,function(){b.pageBody.find("#dock-"+this.uuid).attr("dock-id",this.id)});b.newDocks=[];b.modifiedDocks=[];b.removedDock=[];b.removedHeader=
[];b.removedFooter=[]};_e.mask=function(){this.body.loader()};_e.unmask=function(){this.body.loader(!1)};_e.onNewWidgetDrop=function(a,b){var d=this;this.populateWidgetSelector();this.setDirty("widget_relocate",{widget:a,parent:$("<div></div>"),index:0,handler:b},{widget:a,parent:a.parent(),index:a.parent().find(">."+this.widgetClass).index(a),handler:b},a);b=a.attr("widget-type");this.getWidgetObject(a).render({type:b,uuid:a.attr("id").substring(3)},function(){d.selectWidget(a)})};
_e.getEmptyWidgetDom=function(a){return"<div class='"+this.widgetClass+" widget-"+a+"' cached-widget new-widget widget-type='"+a+"'> "+$.i18n.prop(a.minusCase())+" "+$.i18n.prop("widget")+" </div>"};
_e.initWidgetMultiSelection=function(){var a=this,b=this.pageBody[0].setCapture,d=!1,c,f,g,m=this.activeSection.find(".editable-area-overlay"),l,n=!1,q=function(e){if(d){b&&e.target.setCapture();a.mouse_capture_id=1;n=!0;var m=e.pageX-c;e=e.pageY-f;g.css(l={left:0>m?c+m:c,top:0>e?f+e:f,width:m*(0>m?-1:1),height:e*(0>e?-1:1)})}},e=function(c){bm.enableTextSelection(this.ownerDocument);d=!1;if(n){a.ignore_ev_timestamp=c.timeStamp;var f=g.rect();g.remove();if(l){b?c.target.releaseCapture():(a.iframe[0].contentWindow.document.removeEventListener("mouseup",
e,!0),a.iframe[0].contentWindow.document.removeEventListener("mousemove",q,!0));delete a.mouse_capture_id;n=!1;c=a.activeSection.find(a.supportedWidgetSelector).not("."+a.widgetClass+" ."+a.widgetClass);for(var m=[],p=0;p<c.length;p++){var A=$(c[p]);if(A.is(":visible")){var x=A.rect();80<=bm.intersect(f,x)&&m.push(A)}}m.length&&(1==m.length?a.selectWidget(m[0]):a.selectMultiWidget(m));l=null}}};m.on("mousedown.multiselection",function(l){bm.disableTextSelection(this.ownerDocument);$(this).one("mouseup.prevent_selection",
function(){bm.enableTextSelection(this.ownerDocument)});d=!0;c=l.pageX;f=l.pageY;g=$("<div class='dragged-over-zone'></div>").appendTo(a.pageBody).css({left:c,top:f});b||(a.iframe[0].contentWindow.document.addEventListener("mouseup",e,!0),a.iframe[0].contentWindow.document.addEventListener("mousemove",q,!0))});if(b)m.off("mousemove.multiselection").on("mousemove.multiselection",q).off("mouseup.multiselection").on("mouseup.multiselection",e)};_e.destroyMultiSelection=function(){this.pageBody.find(".editable-area-overlay").off(".multiselection")};
_e.getNewDroppedWidget=function(a){var b=bm.getUUID(),d=$(this.getEmptyWidgetDom(a));d.attr("id","wi-"+b);d.attr("widget-type",a);return new app.tabs.edit_content.Widget(this,{uuid:b,elm:d,type:a,css:new CssParser("")})};_e.getCssRule=function(a,b){var d;this.activeMedia?(d=a.getRule(this.activeMedia,".responsive "+b))||(d=a.getRule(b)):d=a.getRule(b);return d};
_e.getCssValue=function(a,b,d,c){function f(a){var b=g[0].getAttribute(a);return b||2!=g.length?b:g[1].getAttribute(a)}var g=[];(c=void 0!=c?c:this.activeMedia)&&(c=a.getRule(c,".responsive "+b))&&g.push(c);(c=a.getRule(b))&&g.push(c);if(g.length){if($.isArray(d)){var m={};d.collect(function(){m[""+this]=f(this)});return m}return f(d)}return null};
_e.addRule=function(a,b){var d=[];if(this.isResponsive){if(this.activeMedia){var c=a.getMedia(this.activeMedia);c||(c=a.addMedia(this.activeMedia));d.push({media:c,rule:".responsive "+b})}c=a.getRule(b);this.activeMedia&&c||d.push({media:a,rule:b})}else d.push({media:a,rule:b});d.every(function(){this.media.addRule(this.rule)})};
_e.removeRule=function(a,b,d,c){var f=[];c?(f.push(a),c=a.getMedias(),c.length&&f.pushAll(c)):this.activeMedia?(c=a.getMedia(this.activeMedia))&&f.push(c):f.push(a);var g=[];f.every(function(){var a=this.removeRule(d);a&&g.push([this,a])});this.persistCss(b,a);return g};_e.persistCss=function(a,b){var d=this.iframeContent.find("head "+(a?"#style-store-"+a:"#stored-css"));d.length||(d=$("<style id='style-store-"+a+"'></style>"),this.iframeContent.find("head").append(d));d.text(b.toString())};
_e.updateCss=function(a,b,d,c,f,g,m){var l=[],n=[];if(g=void 0!=g?g:this.activeMedia){var q=a.getMedia(g);q||(q=a.addMedia(g));l.push({media:q,rule:".responsive "+d});m&&l.push({media:a,rule:d})}else l.push({media:a,rule:d});l.every(function(){var a=this.media.getRule(this.rule);a||(a=this.media.addRule(this.rule));n.push(a)});c&&n.every(function(){this.setAttribute(c)});f&&n.every(function(){this.removeAttribute(f)});this.persistCss(b,a)};
_e.getMergableGrids=function(a,b){function d(a,b){return(a.children(".widget").length?0==b.children(".grid-block, .page-content").length:0==a.children(".grid-block, .page-content").length)||(b.children(".widget").length?0==a.children(".grid-block, .page-content").length:0==b.children(".grid-block, .page-content").length)}if("left"==b){var c=function(a){if(a.is(".no-fixed-left, .l-fixed-left, .r-fixed-left"))return a=a.parent(),c(a);if(!a.is(".page-content, .widget-container")&&a.is(".no-fixed-right, .l-fixed-right, .r-fixed-right")){var b=
a.prev();if(d(a,b))return[b,a]}};if(!a.is(".no-fixed-left, .v-split:first-child"))if(a.is(".no-fixed-tight, .l-fixed-right, .r-fixed-right, .v-split")){if(b=a.prev(),d(a,b))return[b,a]}else return c(a)}else{var f=function(a){if(a.is(".no-fixed-right, .l-fixed-right, .r-fixed-right"))return a=a.parent(),f(a);if(!a.is(".page-content, .widget-container")&&a.is(".no-fixed-left, .l-fixed-left, .r-fixed-left")){var b=a.prev();if(d(a,b))return[a,b]}};if(!a.is(".no-fixed-right, .v-split:last-child"))if(a.is(".no-fixed-left, .l-fixed-left, .r-fixed-left, .v-split")){if(b=
a.next(),d(a,b))return[a,b]}else return f(a)}};
_e.getGridMinResizable=function(a){var b=a.leftRib(!1)+a.rightRib(!1);if(a.hasClass("v-split-container")){a=a.children();for(var d=0,c=0;c<a.length;c++){var f=this.getGridMinResizable(a.eq(c));d<f&&(d=f)}a=d}else if(a.is(".l-fixed-container, .r-fixed-container")){d=a.children(".l-fixed-left, .r-fixed-right");c=this.getCssValue(this.css,"#"+d.attr("id"),"display");if("block"==this.getCssValue(this.css,"#"+a.attr("id"),"display"))return b="none"!=c?this.getGridMinResizable(d,!0):0,a=this.getGridMinResizable(a.children(".l-fixed-right, .r-fixed-left"),
!0),b+a;d="none"!=c?this.getCssValue(this.css,"#"+d.attr("id"),"flex"):"0 0 0";a=parseFloat(d.split(" ")[2])+this.getGridMinResizable(a.children(".l-fixed-right, .r-fixed-left"))}else a=100;return b+a};
_e.unselectMultiWidget=function(a){if(a&&(this.multiSelectedWidget=this.multiSelectedWidget.not(a),a.find("> .multi-selection-overlay").remove(),this.multiSelectedWidget.length)){this.multiSelectedWidget.parent().is(".widget-group")||this.body.find(".toolbar .multiselection .toolbar-item.ungroup").addClass("disabled");return}this.body.find(".toolbar .multiselection .toolbar-item").addClass("disabled");this.multiSelectedWidget.find("> .multi-selection-overlay").remove();delete this.multiSelectedWidget};
_e.unselectWidget=function(a){if(this.selectedWidget||this.multiSelectedWidget)this.multiSelectedWidget?this.unselectMultiWidget():(this.selectedWidget.find(".widget-overlay").removeClass("selected"),this.pageBody.find(".bounding-box-line-x, .bounding-box-line-y, .bounding-box-line-x-2, .bounding-box-line-y-2").hide(),this.widgetXoffset.stepper("disable"),this.widgetYoffset.stepper("disable"),this.widgetHeight.stepper("disable"),this.widgetWidth.stepper("disable"),this.selectedWidget=void 0,this.widgetSelector.chosen("val",
""),this.settingBlock.find(".tool-icon.remove-widget").addClass("disabled"),this.enableWidgetDimensionSpinners(!1),a&&a.next_select_pending||this.leftbar_tab.tabify("activate","widget"),this.activeSection.is(".body")||this.settingBlock.find(".widget-ref-unit-selector").hide(),this.updateWidgetConfig())};
_e.triggerWidgetConfigChange=function(){var a=this.settingBlock.find(".widget-prop-configure .active-prop-view-container");a.find(".title-input input").trigger("change");a.find(".clazz-input input").trigger("change");a.find(".widget-specific-config").trigger("change");a=a.find("textarea");if(a.length){var b=this.selectedWidget.attr("id").substring(3);(b=this.cachedWidgets[b])&&b.setJs(a.value)}};
_e.getWidgetObject=function(a){var b=a.attr("id").substring(3);if(a.is("[cached-widget]"))var d=this.cachedWidgets[b];else d=this.iframeContent.find("#style-store-"+b),d=new CssParser(d.length?d[0].innerHTML:""),d.parse(),d=new app.tabs.edit_content.Widget(this,{uuid:b,elm:a,type:a.attr("widget-type"),style:null,css:d}),d.updateMemoryStyle(),this.cachedWidgets[b]=d,a.attr("cached-widget",!0),a.parent().is(".widget-group")&&(d.group=a.parent().attr("id").substring(6));return d};
_e.createWidgetOverlay=function(a){var b=this;a.append("<div class='widget-overlay' tabindex='0'><div class='widget-toolbar'><span class='tool-icon remove'></span></div></div>");var d=a.find(".widget-overlay");this.selectedWidget&&this.selectedWidget[0]==a[0]&&d.addClass("selected");if(!this.activeSection.hasClass("body")){d.append('<div class="widget-bounding-box top-left" title="'+$.i18n.prop("bind.widget.position.relative.top.left")+'"></div><div class="widget-bounding-box top-right" title="'+
$.i18n.prop("bind.widget.position.relative.top.right")+'"></div><div class="widget-bounding-box bottom-right" title="'+$.i18n.prop("bind.widget.position.relative.bottom.right")+'"></div><div class="widget-bounding-box bottom-left" title="'+$.i18n.prop("bind.widget.position.relative.bottom.left")+'"></div>');d.bind("keydown.key_up",function(){setTimeout(function(){var a=b.getWidgetObject(b.selectedWidget),c=b.widgetYoffset.val();a=+c+1*(a.isTop()?-1:1);b.widgetYoffset[0].isilent(a).triggerHandler("ichange",
[a,c])},2);return!1}).bind("keydown.key_down",function(){setTimeout(function(){var a=b.getWidgetObject(b.selectedWidget),c=b.widgetYoffset.val();a=+c+1*(a.isTop()?1:-1);b.widgetYoffset[0].isilent(a).triggerHandler("ichange",[a,c])},2);return!1}).bind("keydown.key_left",function(){setTimeout(function(){var a=b.getWidgetObject(b.selectedWidget),c=b.widgetXoffset.val();a=+c+1*(a.isLeft()?-1:1);b.widgetXoffset[0].isilent(a).triggerHandler("ichange",[a,c])},2);return!1}).bind("keydown.key_right",function(){setTimeout(function(){var a=
b.getWidgetObject(b.selectedWidget),c=b.widgetXoffset.val();a=+c+1*(a.isLeft()?1:-1);b.widgetXoffset[0].isilent(a).triggerHandler("ichange",[a,c])},2);return!1});var c={shim:!0,proxy:function(a){return b.iframeWindow.$(a.closest("."+b.widgetClass)[0])},start:function(a){a=a.elm.closest("."+b.widgetClass);a=b.getWidgetObject(a);this.temp.start_style=$.extend({},a.style)},stop:function(a){a=a.elm.closest("."+b.widgetClass);var c=b.getWidgetObject(a);if(c.percentage){var d=c.style,f=c.elm.parent().innerWidth(),
n=c.elm.parent().innerHeight();c.isLeft()&&(d.left=parseFloat(d.left)/f*100+"%");c.isRight()&&(d.right=parseFloat(d.right)/f*100+"%");c.isTop()&&(d.top=parseFloat(d.top)/n*100+"%");c.isBottom()&&(d.bottom=parseFloat(d.bottom)/n*100+"%")}c.applyStyle(c.style);b.setDirty("widget_reposition",{widget:a,style:this.temp.start_style},{widget:a,style:$.extend({},c.style)},a);a.css({left:"",right:"",top:"",bottom:"",width:"",height:""});c.positionReferenceLine();b.setDimensionSpinnerValues(c)},doing:function(a){a=
a.elm.closest("."+b.widgetClass);var c=b.getWidgetObject(a),d=c.style;c.isLeft()&&(d.left=a.css("left"));c.isRight()&&(d.right=a.css("right"));c.isTop()&&(d.top=a.css("top"));c.isBottom()&&(d.bottom=a.css("bottom"));"auto"!=d.width&&(d.width=a.css("width"));d.height=a.css("height");c.positionReferenceLine();b.setDimensionSpinnerValues(c)}};d.draggable($.extend(c,{cancel:".widget-toolbar, .widget-bounding-box, .bmui-resize-handle",move:c.doing,containment:function(a){if(a.hasparent(".widget-container"))return[0,
0,0,0];a=a.parent().pposition();return[-1*a.left,-1*a.right,-1*a.top,-1*a.bottom]}})).resizable($.extend(c,{resize:c.doing,limit:[50,void 0,25,void 0],containment:function(a,b){if(a.hasparent(".widget-container"))return[0,0];a=a.parent().pposition();return"x"==b?[-1*a.left,-1*a.right]:[-1*a.top,-1*a.bottom]}}));this.selectedWidget&&this.selectedWidget[0]==a[0]&&this.getWidgetObject(this.selectedWidget).highlightReferenceSelection()}};
_e.selectMultiWidget=function(a){var b=$();a.every(function(){$(this).append("<div class='multi-selection-overlay'></div>");b=b.add(this)});this.multiSelectedWidget?(this.multiSelectedWidget=this.multiSelectedWidget.add(a),a.parent().is(".widget-group")&&this.body.find(".toolbar .multiselection .toolbar-item.ungroup").removeClass("disabled")):(this.multiSelectedWidget=b,this.body.find(".toolbar .multiselection .toolbar-item").removeClass("disabled"),this.multiSelectedWidget.parent().is(".widget-group")||
this.body.find(".toolbar .multiselection .toolbar-item.ungroup").addClass("disabled"))};
_e.selectWidget=function(a,b){if(!this.selectedWidget||this.selectedWidget[0]!=a[0]){this.unselectWidget({next_select_pending:!0});this.selectedWidget=a;this.selectedWidget.find("> .widget-overlay").addClass("selected");var d=a.attr("id");d&&(d=d.substring(3));this.settingBlock.find(".tool-icon.remove-widget").removeClass("disabled");b&&void 0!=b.widget_selector_update&&!b.widget_selector_update||this.widgetSelector.chosen("val","wi-"+d);if(this.activeSection.hasClass("body"))a.attr("id")&&!a.is("[cached-widget]")&&
(b=this.iframeContent.find("#style-store-"+d),b=new CssParser(b.length?b[0].innerHTML:"#style-store-"+d+"{}"),b.parse(),b=new app.tabs.edit_content.Widget(this,{uuid:d,elm:a,type:a.attr("widget-type"),style:null,css:b}),this.cachedWidgets[d]=b,a.attr("cached-widget",!0));else{this.enableWidgetDimensionSpinners(!0);b=this.getWidgetObject(a);if(!b)return;this.settingBlock.find(".widget-ref-unit-selector").show();a=b.percentage?"%":"px";this.settingBlock.find(".widget-ref-unit-selector select").chosen("val",
a);b.positionReferenceLine();this.setDimensionSpinnerValues(b);b.highlightReferenceSelection()}this.updateWidgetConfig(d,void 0,!0)}};
_e.setDimensionSpinnerValues=function(a){var b=a.elm,d=a.getPos();if(a.percentage){var c=$(b[0].offsetParent).innerWidth(),f=$(b[0].offsetParent).innerHeight();d.left=d.left/c*100;d.top=d.top/f*100;d.right=d.right/c*100;d.bottom=d.bottom/f*100}this.widgetWidth[0].isilent(b.outerWidth(!0));this.widgetHeight[0].isilent(b.outerHeight(!0));b=a.isLeft()?d.left:d.right;a=a.isTop()?d.top:d.bottom;this.widgetXoffset[0].isilent(Math.round(b));this.widgetYoffset[0].isilent(Math.round(a))};
_e.enableWidgetDimensionSpinners=function(a){this.widgetXoffset.stepper(a?"enable":"disable");this.widgetYoffset.stepper(a?"enable":"disable");this.widgetHeight.stepper(a?"enable":"disable");this.widgetWidth.stepper(a?"enable":"disable")};
_e.initWidgetDimensionSpinners=function(){var a=this;this.widgetXoffset.ichange(600,function(b,d,c){d=+d;isNaN(d)?this.isilent(c):a.getWidgetObject(a.selectedWidget).setX(d)});this.widgetYoffset.ichange(600,function(b,d,c){d=+d;isNaN(d)?this.isilent(c||""):a.getWidgetObject(a.selectedWidget).setY(d)});this.widgetHeight.ichange(600,function(b,d,c){d=+d;isNaN(d)?this.isilent(c||""):a.getWidgetObject(a.selectedWidget)._setWH(d,25,"top","bottom","height","Top","Bottom","Height")});this.widgetWidth.ichange(600,
function(b,d,c){d=+d;isNaN(d)?this.isilent(c||""):a.getWidgetObject(a.selectedWidget)._setWH(d,50,"left","right","width","Left","Right","Width")})};
_e.advanceConfigureWidget=function(){var a=this,b=this.selectedWidget,d=this.selectedWidget.attr("id").substring(3),c=b.attr("widget-type"),f=this.widgetConfigUrl+c.camelCase(),g=b.attr("widget-id");var m={};g&&(m.widgetId=g);var l=b.data("data-cache");l&&(m.cache=l);var n=b.attr("widget-type"),q="true"==b.attr("external-widget");q&&(m.isTemplateWidget=q,m.type=n,m.uuid=d);var e;n={status:!0};app.global_event.trigger("before-render-"+c+"-widget-config",[n,this]);!1!==n.status&&a.renderCreatePanel(f,
$.i18n.prop("configure.widget"),$.i18n.prop(c.minusCase()),m,{ajax:{show_success_status:!1},auto_clear_dirty:!1,success:function(c){var f=a.getWidgetObject(b);f.afterConfigChange();f.updateContent(c.html,c.serialized);a.setDirty("widget_update",{widget:b,cache:l,obj:e},{widget:b,cache:c.serialized,obj:e},b);a.updateWidgetConfig(d)},beforeSubmit:function(b,f){var m=l?JSON.parse(l):null;$.extend(f,{widgetId:g,widgetType:c,uuid:d,containerId:a.containerId,containerType:a.containerType,params:e.getParams()});
m&&(f.clazz=m.clazz);if("function"==typeof e.beforeSubmit&&!1===e.beforeSubmit(b,f))return!1},clazz:"widget-edit widget-"+c.minusCase()+"-config",content_loaded:function(d,f){e=new app.widget[c]({content:this,widget:b,popup:f,editor:a});e.init(d)}})};
_e.editWidgetCss=function(a){var b=this.settingBlock.find(".widget-mode.accordion-item .active-prop-view-container");b.append('<div class="sidebar-group widget-css-operators">'+(this.activeMedia?'<span class="tool-icon copy-other-media" title="'+$.i18n.prop("copy.all.from.other.media")+'"></span>':"")+(this.isResponsive?'<span class="tool-icon remove remove-media" title="'+$.i18n.prop("remove.media")+'"></span><span class="tool-icon hide-in-resolutions" title="'+$.i18n.prop("hidden.in.resolutions")+
'"></span>':"")+'<span class="tool-icon show-hide" title="'+$.i18n.prop("show.hide.toggle")+'"></span>\r\n        </div>');this.handleCssEditorTools(b);this.editCss(b,a,"<base>","#wi-"+a.uuid)};
_e.editCss=function(a,b,d,c,f){var g=this,m="position display left right top bottom height width flex max-width".split(" "),l=[c,".responsive "+c];f&&l.pushAll(f);f=$("<div class='sidebar-group'><div class='sidebar-group-label'>"+$.i18n.prop("rules")+"</div><div class='sidebar-group-body'><select class='rule sidebar-input single-action' name='rule'></select> <span class='tool-icon remove remove-rule'></span></div></div>");var n=a.append(f).find("select.rule").chosen({disable_search:!0}),q=this.activeMedia?
b.css.getMedia(this.activeMedia):b.css,e=this.activeMedia?".responsive "+c:c;q&&q.rulesets.length?$.each(q.rulesets,function(){if("media"!=this.type){var a=this.selectors.collect(function(){return this.replace(e,d)}).join(", ");n.chosen("add",{value:this.selectors.join(", "),text:a})}}):n.chosen("add",{value:e,text:d});var p=n.siblings(".remove-rule");f.append("<div class='sidebar-group-body'><input type='text' placeholder='"+$.i18n.prop("add.new.rule")+"' name='new-rule' class='sidebar-input single-action new-rule'> <span class='add tool-icon add-rule'></span></div>");
p.click(function(){if(!$(this).is(".disabled")){var a=n.val(),c=b.css.toString();g.removeRule(b.css,b.uuid,a.split(", "));1==n[0].options.length&&n.chosen("add",{value:e,text:d});n.chosen("remove",a).trigger("change");g.setDirty("css_change",{css:c,uuid:b.uuid,obj:b},{css:b.css.toString(),uuid:b.uuid,obj:b},b.elm)}});var t=a.find("input[name='new-rule']");a.find(".add-rule").click(function(){var a=t.val();if(""!=a){var e=[];n.find("option").each(function(){e.push(this.value)});t.val("");var f=a.contains(",")?
a.split(", ").collect(function(){return(g.activeMedia?".responsive ":"")+c+" "+this.trim()}):(g.activeMedia?".responsive ":"")+c+" "+a.trim();var l=$.isArray(f)?f.join(", "):f;if(e.contains(l))n.select("val",l).trigger("change");else{var m=b.css.toString();g.addRule(b.css,f);n.chosen("add",{value:l,text:a.split(", ").collect(function(){return d+" "+this.trim()}).join(", "),selected:!0}).trigger("change");g.setDirty("css_change",{css:m,uuid:b.uuid,obj:b},{css:b.css.toString(),uuid:b.uuid,obj:b},b.elm)}}});
t.on("keyup.key_return",function(){a.find(".add-rule").trigger("click")});f=$("<div class='sidebar-group'><div class='sidebar-group-label'>"+$.i18n.prop("attributes")+"</div><div class='attribute sidebar-group-body'><table></table></div></div>");a.append(f);var w=f.find("table");n.change(function(){l.contains(this.value)?p.addClass("disabled"):p.removeClass("disabled");w.empty();var a=g.activeMedia?b.css.getMedia(g.activeMedia):b.css;if(a){var c=this.value.split(", ");if(a=a.getRule(c))for(a=a.attributes,
c=0;c<a.length;c++)m.contains(a[c].key)||w.append("<tr class='attribute'><td> "+a[c].key+": "+a[c].value+"; </td><td class='remove'><span class='tool-icon remove' attr-name = '"+a[c].key+"'></span></td></tr>")}}).trigger("change");w.delegate("span.remove","click ",function(){var a=$(this),c=n.val(),d=a.attr("attr-name"),e=b.css.toString();g.updateCss(b.css,b.uuid,c.split(", ").collect(function(){return g.activeMedia?this.substring(12):this}),null,d);a.closest("tr").remove();0==w.find("tr").length&&
w.empty();g.setDirty("css_change",{css:e,uuid:b.uuid,obj:b},{css:b.css.toString(),uuid:b.uuid,obj:b},b.elm)});f.append("<div class='sidebar-group-body'><input type='text' placeholder='"+$.i18n.prop("add.new.attribute")+"' name='new-attribute' class='sidebar-input single-action new-attribute'> <span class='add tool-icon add-attribute'></div>");var y=a.find("input[name='new-attribute']");a.find(".add-attribute").click(function(){var a=y.val().match(/([^:]+):([^;]+);?/);if(a){y.val("");var c=a[1].trim(),
d=a[2].trim();if(m.contains(c))bm.notify($.i18n.prop("specified.attribute.restricted"),"error");else{a=n.val();var e={};e[c]=d;var f=b.css.toString();g.updateCss(b.css,b.uuid,a.split(", ").collect(function(){return g.activeMedia?this.substring(12):""+this}),e);var l=!1;w.find("tr.attribute span.remove").each(function(){if($(this).attr("attr-name")==c)return $(this).parent().siblings().text(c+": "+d+";"),l=!0,!1});l||w.append("<tr class='attribute'><td> "+c+": "+d+"; </td><td class='remove'><span class='tool-icon remove' attr-name = '"+
c+"'></td></tr>");g.setDirty("css_change",{css:f,uuid:b.uuid,obj:b},{css:b.css.toString(),uuid:b.uuid,obj:b},b.elm)}}});y.on("keyup.key_return",function(){a.find(".add-attribute").trigger("click")})};
_e.removeWidget=function(a,b,d){var c=this,f={},g=this.cachedWidgets[b],m=this.pageBody.find("#wi-"+b);this.selectedWidget&&this.selectedWidget[0]==m[0]&&this.unselectWidget();if(g){f.cache=this.cachedWidgets[b];var l=g.templateServerUuid?g.templateServerUuid:g.elm.is("[external-widget=true]")?b:null;if(!g.elm.is("[new-widget]")||l)this.removedWidgets.push({uuid:b,section:a.attr("section"),templateServerUuid:l}),f.removeCacheIndex=this.removedWidgets.length}f.index=m.parent().find("> ."+this.widgetClass).index(m);
f.parent=m.parent();m.detach();b=function(){a[0]==c.activeSection[0]&&c.populateWidgetSelector()};b();f.handler=b;f.widget=m;if(d)return f;d=[f,{widget:f.widget,handler:b}];this.setDirty("widget_relocate",d[0],d[1]);return d};
_e.setDirty=function(a,b,d,c){var f=this;0<arguments.length&&(b&&d?(b.section=this.activeSection,d.section=this.activeSection):a.section=this.activeSection,this.undo_redo.push(a,b,d),c&&c.each(function(){var a=$(this);a.is("."+f.widgetClass)?a.is("[new-widget]")||a.attr("modified-widget",!0):(a=c.attr("id").substring(5),c.attr("dock-id")&&!f.modifiedDocks.contains(a)&&f.modifiedDocks.push(a))}));this.enableRevert=!0;this.body.find(".toolbar .save").removeClass("disabled");app.tabs.edit_content._super.setDirty.call(this)};
_e.clearDirty=function(a){a||this.undo_redo.reset();app.tabs.edit_content._super.clearDirty.call(this);this.enableRevert=!1;this.body.find(".toolbar .save").addClass("disabled")};
_e.addDock=function(){var a=this,b=bm.getUUID(),d={};d.uuid=b;var c=new CssParser;d.css=c;var f=d.elm=$("<div class='dockable' cached-dock new-dock section='"+b+"' id='dock-"+b+"'><div class='widget-container'></div><div class='dock-mask'></div></div>");a.updateCss(c,b,"#dock-"+d.uuid,{top:"0px",left:"0px",right:"0px",bottom:"auto",width:"auto",height:"200px"},void 0,void 0,!0);a.updateCss(c,b,"#dock-"+d.uuid+" > .widget-container",{height:"100%"},void 0,void 0,!0);var g=a.activeSectionSelector.chosen("val");
c={undo:function(){a.activeSectionSelector.chosen("val",g).chosen("remove",b).trigger("change");f.detach();a.newDocks.pop()},redo:function(){a.pageBody.append(f);a.cacheDock(b,d);a.newDocks.push(d);a.activeSectionSelector.chosen("add",{value:b,text:"Dock - "+b,selected:!0}).trigger("change")}};a.setDirty(c);c.redo()};
_e.editDockCss=function(a){var b=this.settingBlock.find(".dock-css.accordion-item .dock-css-view-container").empty();if(this.activeSection.is(".dockable")){if("widget"==this.leftbar_tab.tabify("getActive")){if(!a)return;this.leftbar_tab.tabify("activate","setting")}if(!this.settingBlock.find(".leftbar-accordion").accordion("current").is(".dock-css")){if(!a)return;this.settingBlock.find(".leftbar-accordion").accordion("expand","dock-css-header")}var d=this,c=this.activeSection.attr("id").substring(5),
f=this.cachedDock[c],g=f.css;a=this.getCssRule(g,"#dock-"+f.uuid);var m=this.getCssRule(g,"#dock-"+f.uuid+" > .widget-container");m=$("<div class='edit-dock-css'><div class='sidebar-group'><div class='sidebar-group-label'>"+$.i18n.prop("position")+"</div><div class='sidebar-group-body'><select class='sidebar-input' name='position'><option value='fixed' selected>"+$.i18n.prop("fixed")+"</option><option value='absolute'>"+$.i18n.prop("absolute")+"</option></select></div></div><div class='sidebar-group'><div class='sidebar-group-label'>"+
$.i18n.prop("left")+"</div><div class='sidebar-group-body'><input type='text' class='sidebar-input' name='left' value='"+(a.getAttribute("left")||"0")+"'></div></div><div class='sidebar-group'><div class='sidebar-group-label'>"+$.i18n.prop("top")+"</div><div class='sidebar-group-body'><input type='text' class='sidebar-input' name='top' value='"+(a.getAttribute("top")||"0")+"'></div></div><div class='sidebar-group'><div class='sidebar-group-label'>"+$.i18n.prop("right")+"</div><input type='text' class='sidebar-input' name='right' value='"+
(a.getAttribute("right")||0)+"'></div></div><div class='sidebar-group'><div class='sidebar-group-label'>"+$.i18n.prop("bottom")+"</div><div class='sidebar-group-body'><input type='text' class='sidebar-input' name='bottom' value='"+(a.getAttribute("bottom")||"auto")+"'></div></div><div class='sidebar-group'><div class='sidebar-group-label'>"+$.i18n.prop("widget.placeholder.width")+"</div><div class='sidebar-group-body'><input type='text' class='sidebar-input container' name='width' value='"+(m&&m.getAttribute("width")||
"100%")+"'></div></div><div class='sidebar-group'><div class='sidebar-group-label'>"+$.i18n.prop("widget.placeholder.height")+"</div><div class='sidebar-group-body'><input type='text' class='sidebar-input container' name='height' value='"+(m&&m.getAttribute("height")||"100%")+"'></div></div></div>");m.find("select[name='position']").val(a.getAttribute("position")).chosen({disable_search:!0}).change(function(){var a=g.toString();d.updateCss(g,c,"#dock-"+f.uuid,{position:this.value});d.setDirty("css_change",
{css:a,uuid:f.uuid,obj:f},{css:f.css.toString(),uuid:f.uuid,obj:f},f.elm)});m.find("input").change(function(){var a="#dock-"+f.uuid;$(this).is(".container")&&(a+=" > .widget-container");var b={};b[this.name]=this.value;var m=g.toString();d.updateCss(g,c,a,b);d.setDirty("css_change",{css:m,uuid:f.uuid,obj:f},{css:f.css.toString(),uuid:f.uuid,obj:f},f.elm)});b.append(m);a="#dock-"+f.uuid;this.isResponsive&&(m='<div class="sidebar-group dock-css-operators">',this.activeMedia&&(m+='<span class="tool-icon copy-other-media" title="'+
$.i18n.prop("copy.all.from.other.media")+'"></span>'),m+='<span class="tool-icon remove remove-media" title="'+$.i18n.prop("remove.media")+'"></span></div>',b.append(m));this._handleCssMediaTools(f,b,f.uuid);d.editCss(b,f,"<dock>",a,[a+" > .widget-container",".responsive "+a+" > .widget-container"])}};
_e.cacheDock=function(a,b){b||(b=this.iframeContent.find("#style-store-"+a),b=new CssParser(b[0].innerHTML),b.parse(),b={uuid:a,style:null,css:b,elm:this.pageBody.find("#dock-"+a)});return this.cachedDock[a]=b};_e.getDockElement=function(a){a.attr("dock-id");a=a.attr("id").substring(5);return this.cachedDock[a]?this.cachedDock[a]:this.cacheDock(a)};
_e.removeDock=function(){var a=this,b=a.activeSection;if(b.is(".dockable")){var d=b.attr("id").substring(5),c=b.attr("dock-id"),f={undo:function(){c&&a.removedDock.pop();a.pageBody.append(b);a.activeSectionSelector.chosen("add",{value:d,text:"Dock - "+d,selected:!0}).trigger("change")},redo:function(){c&&a.removedDock.push(c);b.detach();a.activeSectionSelector.chosen("remove",d).trigger("change")}};f.redo();this.activeSectionSelector.chosen("remove",d).chosen("val","body").trigger("change");a.setDirty(f)}};
_e.resolutionChange=function(a){var b=this,d="";a?(a=a.split("-"),""==a[1]?(d="(min-width: "+a[0]+"px)",b.iframe.css({"min-width":a[0]+"px",width:""})):(d=a[1],b.iframe.css({"min-width":"",width:d+"px"}),d="(max-width: "+d+"px)",a[0]&&(d="(min-width: "+a[0]+"px) and "+d))):b.iframe.css({"min-width":"",width:""});this.activeMedia=d;var c=[];this.activeSectionSelector.find("option").each(function(){"body"!=this.value&&("header"==this.value||"footer"==this.value?c.push("."+this.value):c.push("#"+this.value))});
for(d=0;d<c.length;d++)a=b.pageBody.find(c[d]+" ."+b.widgetClass),$.each(a,function(){var a=$(this);a.is("[cached-widget]")&&(a=a.attr("id").substring(3),b.cachedWidgets[a].updateMemoryStyle())});this.updateSectionDimensionSpinners();this.activeSection.is(".dockable")&&this.editDockCss();this.selectedWidget&&(d=this.getWidgetObject(this.selectedWidget),d.updateMemoryStyle(),this.updateWidgetConfig(this.selectedWidget.attr("id").substring(3),"css"),this.activeSection.is(".body")||(d.positionReferenceLine(),
d.highlightReferenceSelection(),this.setDimensionSpinnerValues(d),this.settingBlock.find(".widget-ref-unit-selector select").chosen("val",d.percentage?"%":"px")));this.updatePageProperties("css")};_e.getWidgetRenderAjaxIOptions=function(a){return a};
_e.renderCopiedSection=function(a){var b=this,d,c;b.renderCreatePanel(app.baseUrl+"layout/layoutSelectionView",$.i18n.prop("clone."+a),void 0,{id:b.containerId,section:a},{createPanelTemplate:$('<div class="embedded-edit-form-panel create-panel fade-in-up"><div class="header"><span class="header-title"></span><span class="toolbar toolbar-right"><span class="tool-group toolbar-btn save">'+$.i18n.prop("update")+'</span><span class="tool-group toolbar-btn cancel">'+$.i18n.prop("cancel")+'</span></span></div><div class="body"></div></div>'),
auto_close_on_success:!1,auto_clear_dirty:!1,content_loaded:function(a,b){c=b;d=a.find(".layout-list");d.find(".layout-thumb").on("click",function(){var a=$(this);a.is(".selected")||a.addClass("selected").siblings().removeClass("selected")})},beforeSubmit:function(a,b){a=d.find(".selected");if(a.length)b.id=a.attr("layout-id");else return bm.notify($.i18n.prop("select.a.layout.first"),"alert"),!1},success:function(d){bm.confirm($.i18n.prop("confirm.clone."+a,[d.name]),function(){d.section=$(d.section);
d.type=a;d.section.find(".widget").each(function(){var a=$(this);a.attr("id").substring(3);a.attr("cloned","true")});c.close();b.copySection(d)},function(){})}})};
_e.copySection=function(a){var b=this,d=$(a.section),c=(new CssParser(b.css.toString())).parse(),f=(new CssParser(a.css)).parse(),g=b["removed"+a.type.capitalize()],m={undo:function(){var d=b.activeSection.find(".widget-container"),f=g.pop();d.detach();b.activeSection.prepend(f);b.activeSection=f.parent();b.updateSection(a.type,c);b.removedWidgets.pop()},redo:function(){var c=b.activeSection.find(".widget-container");c.detach();b.activeSection.prepend(d);b.activeSection=d.parent();b.attachSection(a);
g.push(c);b.updateSection(a.type,f,a.wiCss);if(g[0][0]==c[0]){var m=[];c.find(".widget").each(function(){var a=$(this).attr("id").substring(3),c=b.cachedWidgets[a];c=c?c.templateServerUuid?c.templateServerUuid:c.elm.is("[external-widget=true]")?a:null:null;m.push({uuid:a,section:b.activeSection.attr("section"),templateServerUuid:c})});b.removedWidgets.push(m)}}};m.redo();b.setDirty(m)};
_e.attachSection=function(a){this.loadCsss();this.initEditor&&this.initEditor();this.changeActiveSection(a.type,!0,!0);this.isResponsive&&this.resolutionChange(this.settingBlock.find(".change-resolution select").val());this.activeSection.find(".widget").attr("new-widget","true").each(function(){var b=$(this);b.data("data-cache",a.wiCache[b.attr("id").substring(3)])})};
_e.updateSection=function(a,b,d){var c=this;c.updateSectionCss(b,"."+a+" > .widget-container",a);c.updateSectionDimensionSpinners();d&&c.activeSection.find(".widget").each(function(){var a=$(this),b=a.attr("id").substring(3);c.persistCss(b,(new CssParser(d[b])).parse());c.getWidgetObject(a)})};
_e.updateSectionCss=function(a,b,d){var c=this;c.css.removeRule(b);c.css.removeMediaRules(b);$.each(a.getMedias(),function(a,b){$.each(b.rulesets,function(a,f){$.each(f.selectors,function(a,g){if(g&&(g.startsWith("."+d)||g.startsWith(".responsive ."+d))){(a=c.css.getMedia(b.definition))?(c.css.removeMedia(a),a=c.css.addMedia(b.definition,a.rulesets)):a=c.css.addMedia(b.definition);var e=a.getRule(g);e&&a.removeRule(e);e=a.addRule(g);var l={};$.each(f.attributes,function(a,b){l[b.key]=b.value});e.setAttribute(l)}})})});
c.css.setAttribute(b,"height",a.getAttribute(b,"height"));c.css.setAttribute(b,"width",a.getAttribute(b,"width"));c.persistCss(void 0,c.css)};app.tabs.edit_content.Widget=function(a,b){this.editor=a;$.extend(this,b);this.type=this.elm.attr("widget-type")};_w=app.tabs.edit_content.Widget.prototype;
_w.render=function(a,b){var d=this;bm.ajax(this.editor.getWidgetRenderAjaxIOptions({show_success_status:!1,controller:"widget",action:"renderWidget",data:a,success:function(a){d.updateContent(a.html,a.serialized);b&&b()}}))};
_w.updateContent=function(a,b){a=$(a);a.find("script").remove();this.elm.html(a.html());b?this.elm.data("data-cache",b):this.elm.removeData("data-cache");this.editor.createWidgetOverlay(this.elm);app.widget[this.type]&&"function"==typeof app.widget[this.type].prototype.afterContentChange&&app.widget[this.type].prototype.afterContentChange(this,b)};
_w.getPos=function(){var a=this.elm.position(),b=$(this.elm[0].offsetParent);a.right=b.innerWidth()-a.left-this.elm.outerWidth(!0);a.bottom=b.innerHeight()-a.top-this.elm.outerHeight(!0);return a};
_w.updateMemoryStyle=function(){var a=this.editor.isResponsive?this.editor.activeMedia?(a=this.css.getMedia(this.editor.activeMedia))?a.getRule(".responsive #wi-"+this.uuid):this.css.getRule("#wi-"+this.uuid):this.css.getRule("#wi-"+this.uuid):this.css.getRule("#wi-"+this.uuid);a&&(this.style={left:a.getAttribute("left"),right:a.getAttribute("right"),top:a.getAttribute("top"),bottom:a.getAttribute("bottom"),width:a.getAttribute("width"),height:a.getAttribute("height")},this.percentage=this.style[this.isLeft()?
"left":"right"]?this.style[this.isLeft()?"left":"right"].contains("%"):!1)};
_w.positionReferenceLine=function(){function a(a,c){m=g[a];l=g[c];b.css({width:m+q[a]});d.css({height:l+q[c]});var e=n.of[a+"Rib"](!0,!1,!1),f=n.of[c+"Rib"](!0,!1,!1);n.my=("left"==a?"right ":"left ")+("top"==c?"bottom ":"top ");n.at=(0<e?a+("left"==a?"-":"+")+e:a+("left"==a?"+":"-")+-1*e)+" "+(0<f?c+("top"==c?"-":"+")+f:c+("top"==c?"+":"-")+-1*f);b.show().position(n);d.show().position(n)}var b=this.editor.pageBody.find(".bounding-box-line-x").hide(),d=this.editor.pageBody.find(".bounding-box-line-y").hide(),
c=this.editor.pageBody.find(".bounding-box-line-x-2").hide(),f=this.editor.pageBody.find(".bounding-box-line-y-2").hide();if(this.elm.is(":visible")){var g=this.getPos(),m,l,n={of:this.elm,collision:"none"},q={left:0,right:0,top:0,bottom:0},e=this.elm.parent();if(!e.is(".widget-container")){var p=e.pposition();q.left=p.left+e.leftRib(!0,!0,!1);q.top=p.top+e.topRib(!0,!0,!1);q.right=p.right+e.rightRib(!0,!0,!1);q.bottom=p.bottom+e.bottomRib(!0,!0,!1)}this.isLeftTop()?(a("left","top"),this.isRight()&&
(b=c,d=f,a("right","top"))):this.isRightTop()?a("right","top"):this.isRightBottom()?(a("right","bottom"),this.isLeft()&&(b=c,d=f,a("left","bottom"))):a("left","bottom")}};
_w.highlightReferenceSelection=function(){var a=this.elm.find(".widget-overlay"),b=a.find(".widget-bounding-box.top-left").removeClass("selected"),d=a.find(".widget-bounding-box.top-right").removeClass("selected"),c=a.find(".widget-bounding-box.bottom-right").removeClass("selected");a=a.find(".widget-bounding-box.bottom-left").removeClass("selected");this.isLeftTop()?(b.addClass("selected"),this.isRight()&&d.addClass("selected")):this.isRightTop()?d.addClass("selected"):this.isLeftBottom()?(a.addClass("selected"),
this.isRight()&&c.addClass("selected")):c.addClass("selected")};_w.isLeftTop=function(){return/(-?\d+(\.\d+)?(px|%)){2}/.test(this.style.left+this.style.top)};_w.isRight=function(){return/-?\d+(\.\d+)?(px|%)/.test(this.style.right)};_w.isLeft=function(){return/-?\d+(\.\d+)?(px|%)/.test(this.style.left)};_w.isTop=function(){return/-?\d+(\.\d+)?(px|%)/.test(this.style.top)};_w.isBottom=function(){return/-?\d+(\.\d+)?(px|%)/.test(this.style.bottom)};
_w.isRightTop=function(){return/(-?\d+(\.\d+)?(px|%)){2}/.test(this.style.right+this.style.top)};_w.isLeftBottom=function(){return/(-?\d+(\.\d+)?(px|%)){2}/.test(this.style.left+this.style.bottom)};_w.isRightBottom=function(){return/(-?\d+(\.\d+)?(px|%)){2}/.test(this.style.right+this.style.bottom)};_w.pushStyle=function(){this.editor.updateCss(this.css,this.uuid,"#wi-"+this.uuid,this.style)};
_w.applyStyle=function(a){this.style=a;this.pushStyle();this.editor.selectedWidget&&this.editor.selectedWidget[0]==this.elm[0]&&(this.positionReferenceLine(),this.editor.setDimensionSpinnerValues(this),this.highlightReferenceSelection())};_w.setJs=function(a){var b=this.js;this.js=a;this.editor.setDirty("widget_js",{obj:this,js:b},{obj:this,js:a},this.elm)};
_w._setXY=function(a,b,d,c,f,g){var m=this.elm["outer"+b](!0);b=this.elm.parent()["inner"+b]();m=[0,b-m];if(!this.elm.parent().is(".widget-container")){var l=this.elm.parent(),n=l.pposition();this["is"+f]()?(m[0]=-1*(n[d]+l[d+"Rib"](!0,!0,!1)),m[1]+=n[c]+l[c+"Rib"](!0,!0,!1)):(m[0]=-1*(n[c]+l[c+"Rib"](!0,!0,!1)),m[1]+=n[d]+l[d+"Rib"](!0,!0,!1))}l=a;this.percentage&&(l=a/100*b);n=!1;l<m[0]&&(l=m[0],n=!0);l>m[1]&&(l=m[1],n=!0);n&&(a=this.percentage?l/b*100:l);b=$.extend({},this.style);this["is"+f]()?
(this["is"+g]()&&(f=parseFloat(this.style[d]),f=a-f,this.style[c]=parseFloat(this.style[c])-f+(this.percentage?"%":"px")),this.style[d]=a+(this.percentage?"%":"px")):this["is"+g]()&&(this.style[c]=a+(this.percentage?"%":"px"));this.applyStyle(this.style);this.editor.setDirty("widget_reposition",{widget:this.elm,style:b},{widget:this.elm,style:$.extend({},this.style)},this.elm);return a};
_w._setWH=function(a,b,d,c,f,g,m,l){var n=this.elm.parent()["inner"+l]();b=[b,n,0];if(!this.elm.parent().is(".widget-container")){var q=this.elm.parent();b[1]=q.parent()["inner"+l]()}a<b[0]?a=b[0]:a>b[1]&&(a=b[1]);l=$.extend({},this.style);if(this["is"+m]()){if(!this.elm.parent().is(".widget-container")){q=this.elm.parent();var e=q.pposition();b[2]-=e[c]+q[c+"Rib"](!0,!0,!1)}var p=parseFloat(this.style[c]);this.percentage&&(p=p/100*n);q=p-a+this.elm[f]();q<b[2]&&(q=b[2]);this.percentage&&(q=q/n*100);
this.style[c]=q+(this.percentage?"%":"px")}this["is"+g]()&&(p=parseFloat(this.style[d]),this.percentage&&(p=p/100*n),c=p,this.elm.parent().is(".widget-container")||(q=this.elm.parent(),e=q.pposition(),c-=e[d]+q[d+"Rib"](!0,!0,!1)),c+a>b[1]&&(c=p-c-a+b[1],this.percentage&&(c=c/100*n),this.style[d]=c+(this.percentage?"%":"px")));this["is"+m]()&&this["is"+g]()||(this.style[f]=a+"px");this.applyStyle(this.style);this.editor.setDirty("widget_reposition",{widget:this.elm,style:l},{widget:this.elm,style:$.extend({},
this.style)},this.elm);return this.elm.outerWidth(!0)};_w.setX=function(a){return this._setXY(a,"Width","left","right","Left","Right")};_w.setY=function(a){return this._setXY(a,"Height","top","bottom","Top","Bottom")};
_w.afterConfigChange=function(){if("true"==this.elm.attr("external-widget")){var a=bm.getUUID(),b=this.uuid;this.templateServerUuid=b;var d=this.editor.iframeContent.find("#style-store-"+b).attr("id","style-store-"+a);b=d.text().replaceAll(b,a);d.text(b);this.uuid=a;this.css=b;this.elm.attr("id","wi-"+a);this.elm.removeAttr("external-widget");this.elm.removeAttr("modified-widget");this.elm.attr("new-widget","true");this.elm.attr("widget-id","");this.editor.cachedWidgets[a]=this}return this.uuid};
app.tabs.cssEditor=function(){app.tabs.cssEditor._super.constructor.apply(this,arguments);this.constructor_args=arguments;this.text=$.i18n.prop("edit.css");this.tip=$.i18n.prop(this.file.name);this.ui_class="edit-css edit-tab";this.ui_body_class="simple-tab";this.strict_layout=!1;this.name=this.file.name};_e=app.tabs.cssEditor.inherit(app.Tab);_e.cssContent="";
_e.onSwitchMenuClick=function(a){"advanceEditor"==a?this.cssContent=this.parser.toString(1):(this.cssContent=this.cmEditor.getValue(),$(window).unbind("resize."+this.id));this.constructor_args[0].cssContent=this.cssContent;app.Tab.changeView(this,"cssEditor",a)};_e.setDirty=function(){this.body.find(".toolbar-item.save").removeClass("disabled");app.tabs.cssEditor._super.setDirty.call(this)};_e.clearDirty=function(){this.body.find(".toolbar-item.save").addClass("disabled");app.tabs.cssEditor._super.clearDirty.call(this)};
_e.save=function(a){var b=this;if(!b.body.find(".toolbar-item.save.disabled").length){var d=b.cmEditor?b.cmEditor.getValue():b.parser.toString(1);bm.ajax({url:app.baseUrl+b.file.path,method:"put",data:d,success:function(){b.clearDirty();a&&a()}})}};app.tabs.cssEditor.simpleEditor=function(a){this.file=a.file;this.id=a.id;app.tabs.cssEditor.simpleEditor._super.constructor.apply(this,arguments)};_s=app.tabs.cssEditor.simpleEditor.inherit(app.tabs.cssEditor);
(function(){function a(){var a=this;this.body.find(".toolbar-item.save").click(function(){a.save()})}function b(a){this.parser=new CssParser(a);this.parser.parse();this.simpleCss=new app.tabs.simpleCss(this,this.parser);this.simpleCss.init()}_s.init=function(){app.tabs.cssEditor.simpleEditor._super.init.call(this);var d=this;this.cssContent?b.call(this,this.cssContent):bm.ajax({type:"get",controller:"remoteRepository",action:"download",data:{path:d.file.path},dataType:"text",show_response_status:!1,
success:function(a){b.call(d,a)}});a.call(this)}})();_s.ajax_url=app.baseUrl+"assetLibrary/loadCssEditor";_s.switch_menu_entries=[{text:$.i18n.prop("switch.advance.mode"),ui_class:"view-switch editor-advance-mode",action:"advanceEditor"}];app.tabs.cssEditor.advanceEditor=function(a){this.file=a.file;this.id=a.id;app.tabs.cssEditor.advanceEditor._super.constructor.apply(this,arguments)};_a=app.tabs.cssEditor.advanceEditor.inherit(app.tabs.cssEditor);
(function(){function a(){var a=this,d=a.cmEditor;a.bindEditorEvent();a.body.find(".toolbar form").form({preSubmit:function(){var b=$(this).find("input:text");a.searchText(b.val());return!1}});a.body.find(".toolbar-item.next").click(function(){CodeMirror.commands.findNext(d);return!1});a.body.find(".toolbar-item.previous").click(function(){CodeMirror.commands.findPrev(d);return!1});a.body.find(".toolbar-item.save").click(function(){a.save()});$(a.body.find(".cssEditorBody .CodeMirror")[0]).bind("keydown",
function(b){if(b.ctrlKey||b.metaKey)switch(String.fromCharCode(b.which).toLowerCase()){case "s":b.preventDefault(),a.save()}if(b.ctrlKey&&b.altKey)switch(String.fromCharCode(b.which).toLowerCase()){case "l":b.preventDefault();a.reFormatSelection();break;case "g":b.preventDefault(),a.initGoToPopup()}});a.body.find(".toolbar-item.undo").click(function(){if($(this).hasClass("disabled"))return this;a.cmEditor.undo()});a.body.find(".toolbar-item.redo").click(function(){if($(this).hasClass("disabled"))return this;
a.cmEditor.redo()})}_a.init=function(){var b=this;app.tabs.cssEditor.advanceEditor._super.init.call(this);bm.ajax({type:"get",controller:"remoteRepository",action:"download",data:{path:b.file.path},dataType:"text",show_response_status:!1,success:function(d){b.loadEditor(d);a.call(b)}})}})();_a.ajax_url=app.baseUrl+"assetLibrary/loadCodeEditor";_a.switch_menu_entries=[{text:$.i18n.prop("switch.simple.mode"),ui_class:"view-switch editor-simple-mode",action:"simpleEditor"}];
_a.loadEditor=function(a){var b=this,d=b.body.find(".cssEditorBody .code-area");d.val(a);this.cmEditor=d.cssCodeEditor();b.resizeEditor();$(window).bind("resize."+b.id,function(){b.resizeEditor()});b.on("close",function(){$(window).unbind("resize."+b.id)})};_a.resizeEditor=function(){this.cmEditor.setSize(null,this.body.height()-this.body.find(".header").height());this.cmEditor.refresh()};
_a.bindEditorEvent=function(){var a=this,b=a.cmEditor;if(b)b.on("change",function(b){var c=b.historySize();app.tabs.cssEditor.cssContent=b.getValue();0<c.undo?(a.setDirty(),a.body.find(".toolbar-item.undo").removeClass("disabled")):(a.clearDirty(),a.body.find(".toolbar-item.undo").addClass("disabled"));0<c.redo?a.body.find(".toolbar-item.redo").removeClass("disabled"):a.body.find(".toolbar-item.redo").addClass("disabled")})};
_a.jumpToLine=function(a){var b=this.cmEditor;a&&!isNaN(Number(a))&&(a=Number(a)-1,b.setCursor(a,0),b.setSelection({line:a,ch:0},{line:a+1,ch:0}),b.focus())};
_a.initGoToPopup=function(){var a=this,b=$("<form class='edit-popup-form'><div class='form-row mandatory'><label>"+$.i18n.prop("line.no")+"</label><input type='text' name='lineNo' value='0' validation='digits'></div><div class='button-line'><button type='button' class='cancel-button'> "+$.i18n.prop("cancel")+"</button> &nbsp; &nbsp;<button type='submit' class='submit-button'>"+$.i18n.prop("enter")+"</button></div></form>"),d=b.find("input:text");bm.editPopup(void 0,$.i18n.prop("go.to.line"),void 0,
void 0,{content:b,events:{content_loaded:function(){var a=this;d.focus();a.find(".cancel-button").click(function(){a.close()})}},beforeSubmit:function(b,f,g){g.close();a.jumpToLine(d.val());return!1}})};_a.reFormatSelection=function(){for(var a=this.cmEditor,b=a.getCursor(!0).line,d=a.getCursor(!1).line;b<=d;b++)a.indentLine(b)};_a.searchText=function(a){var b=this.cmEditor;CodeMirror.commands.clearSearch(b);CodeMirror.commands.findAll(b,a,!1)};
app.tabs.scriptEditor=function(){app.tabs.scriptEditor._super.constructor.apply(this,arguments);this.constructor_args=arguments;var a=this.file.mode;this.text=$.i18n.prop("edit."+a);this.tip=$.i18n.prop(this.file.name);this.ui_class="edit-"+a+" edit-tab";this.ui_body_class="simple-tab";this.name=this.file.name;this.mode=a;this.ajax_url=app.baseUrl+"assetLibrary/loadScriptEditor?mode="+a};var _se=app.tabs.scriptEditor.inherit(app.Tab);
(function(){function a(){var a=this,d=a.cmEditor;a.bindEditorEvent();a.body.find(".toolbar form").form({preSubmit:function(){var b=$(this).find("input:text");a.searchText(b.val());return!1}});a.body.find(".toolbar-item.next").click(function(){CodeMirror.commands.findNext(d);return!1});a.body.find(".toolbar-item.previous").click(function(){CodeMirror.commands.findPrev(d);return!1});a.body.find(".toolbar-item.save").click(function(){a.save()});$(a.body.find(".scriptEditorBody .CodeMirror")[0]).bind("keydown",
function(b){if(b.ctrlKey||b.metaKey)switch(String.fromCharCode(b.which).toLowerCase()){case "s":b.preventDefault(),a.save()}if(b.ctrlKey&&b.altKey)switch(String.fromCharCode(b.which).toLowerCase()){case "l":b.preventDefault();a.reFormatSelection();break;case "g":b.preventDefault(),a.initGoToPopup()}});a.body.find(".toolbar-item.undo").click(function(){if($(this).hasClass("disabled"))return this;a.cmEditor.undo()});a.body.find(".toolbar-item.redo").click(function(){if($(this).hasClass("disabled"))return this;
a.cmEditor.redo()})}_se.init=function(){var b=this;app.tabs.scriptEditor._super.init.call(b);bm.ajax({type:"get",url:app.baseUrl+(b.file.loadUrl?b.file.loadUrl:"remoteRepository/download"),data:{path:b.file.path},dataType:"text",show_response_status:!1,success:function(d){b.loadEditor(d);a.call(b)}})}})();_se.onSwitchMenuClick=function(a){$(window).unbind("resize."+this.name);this.switchHandler(a)};
_se.loadEditor=function(a){var b=this,d=b.body.find(".scriptEditorBody .code-area");d.val(a);b.cmEditor=CodeMirror.fromTextArea(d[0],{lineNumbers:!0,extraKeys:{"Ctrl-Space":"autocomplete"},mode:b.mode,theme:"eclipse",highlightSelectionMatches:{showToken:/\w/},showCursorWhenSelecting:!0,matchBrackets:!0,autoCloseBrackets:!0});b.resizeEditor();$(window).bind("resize."+b.name,function(){b.resizeEditor()});b.on("close",function(){$(window).unbind("resize."+b.name)})};
_se.resizeEditor=function(){this.cmEditor.setSize(null,this.body.height()-this.body.find(".header").height());this.cmEditor.refresh()};_se.bindEditorEvent=function(){var a=this,b=a.cmEditor;if(b)b.on("change",function(b){b=b.historySize();0<b.undo?(a.setDirty(),a.body.find(".toolbar-item.undo").removeClass("disabled")):(a.clearDirty(),a.body.find(".toolbar-item.undo").addClass("disabled"));0<b.redo?a.body.find(".toolbar-item.redo").removeClass("disabled"):a.body.find(".toolbar-item.redo").addClass("disabled")})};
_se.jumpToLine=function(a){var b=this.cmEditor;a&&!isNaN(Number(a))&&(a=Number(a)-1,b.setCursor(a,0),b.setSelection({line:a,ch:0},{line:a+1,ch:0}),b.focus())};
_se.initGoToPopup=function(){var a=this,b=$("<form class='edit-popup-form'><div class='form-row mandatory'><label>"+$.i18n.prop("line.no")+"</label><input type='text' name='lineNo' value='0' validation='digits'></div><div class='button-line'><button type='button' class='cancel-button'> "+$.i18n.prop("cancel")+"</button> &nbsp; &nbsp;<button type='submit' class='submit-button'>"+$.i18n.prop("enter")+"</button></div></form>"),d=b.find("input[name=lineNo]");bm.editPopup(void 0,$.i18n.prop("go.to.line"),
void 0,void 0,{content:b,events:{content_loaded:function(){var a=this;d.focus();a.find(".cancel-button").click(function(){a.close()})}},beforeSubmit:function(b,f,g){g.close();a.jumpToLine(d.val());return!1}})};_se.reFormatSelection=function(){for(var a=this.cmEditor,b=a.getCursor(!0).line,d=a.getCursor(!1).line;b<=d;b++)a.indentLine(b)};_se.searchText=function(a){var b=this.cmEditor;CodeMirror.commands.clearSearch(b);CodeMirror.commands.findAll(b,a,!1)};
_se.setDirty=function(){this.body.find(".toolbar-item.save").removeClass("disabled");app.tabs.scriptEditor._super.setDirty.call(this)};_se.clearDirty=function(){this.body.find(".toolbar-item.save").addClass("disabled");app.tabs.scriptEditor._super.clearDirty.call(this)};
_se.save=function(a){var b=this;b.body.find(".toolbar-item.save.disabled").length||bm.ajax({url:app.baseUrl+(b.file.saveUrl?b.file.saveUrl:b.file.path),method:b.file.method?b.file.method:"put",data:b.file.saveUrl?{data:b.cmEditor.getValue()}:b.cmEditor.getValue(),success:function(){b.clearDirty();a&&a()}})};
app.tabs.xmlEditor=function(){app.tabs.xmlEditor._super.constructor.apply(this,arguments);this.constructor_args=arguments;this.text=$.i18n.prop(this.file.name);this.tip=$.i18n.prop(this.text);this.ui_class="edit-xml edit-tab";this.ui_body_class="simple-tab";this.strict_layout=!1;this.name=this.file.name;this.readOnly=this.file.readOnly?this.file.readOnly:!1};var _xe=app.tabs.xmlEditor.inherit(app.Tab);(function(){_xe.init=function(){app.tabs.xmlEditor._super.init.call(this)}})();_xe.xmlContent="";
_xe.onSwitchMenuClick=function(a){if("simpleEditor"==a)try{var b=this.xmlEditor.getXmlAsString();0<b.indexOf("?>")&&(b=b.substr(0,b.indexOf("?>")+2)+"\n"+b.substr(b.indexOf("?>")+2,b.length));this.xmlContent=b}catch(d){this.xmlContent=this.xml,bm.notify($.i18n.prop("invalid.xml.document"),"error")}else this.xmlContent=(b=this.cmEditor.getValue())?b:'<?xml version="1.0" encoding="UTF-8"?><root></root>',$(window).unbind("resize."+this.id);this.constructor_args[0].xmlContent=this.xmlContent;app.Tab.changeView(this,
"xmlEditor",a)};_xe.setDirty=function(){this.body.find(".toolbar-item.save").removeClass("disabled");app.tabs.xmlEditor._super.setDirty.call(this)};_xe.clearDirty=function(){this.body.find(".toolbar-item.save").addClass("disabled");app.tabs.xmlEditor._super.clearDirty.call(this)};
_xe.save=function(a){var b=this;if(!b.body.find(".toolbar-item.save.disabled").length){var d=b.cmEditor?b.cmEditor.getValue():b.xmlEditor.getXmlAsString();bm.ajax({url:app.baseUrl+b.file.path,method:"put",data:d,success:function(){b.clearDirty();a&&a()}})}};app.tabs.xmlEditor.advanceEditor=function(a){this.file=a.file;this.id=a.id;app.tabs.xmlEditor.advanceEditor._super.constructor.apply(this,arguments)};var _ae=app.tabs.xmlEditor.advanceEditor.inherit(app.tabs.xmlEditor);
(function(){function a(){var a=this;this.body.find(".toolbar-item.save").click(function(){a.save()})}function b(a){this.xml=a?a:'<?xml version="1.0" encoding="UTF-8"?><root></root>';this.initAdvanceEditor()}_ae.init=function(){app.tabs.xmlEditor.advanceEditor._super.init.call(this);var d=this;this.xmlContent?b.call(this,this.xmlContent):bm.ajax({type:"get",controller:"remoteRepository",action:"download",data:{path:d.file.path},dataType:"text",show_response_status:!1,success:function(a){b.call(d,a)}});
a.call(this)}})();_ae.ajax_url=app.baseUrl+"assetLibrary/loadAdvanceXmlEditor";_ae.switch_menu_entries=[{text:$.i18n.prop("switch.simple.mode"),ui_class:"view-switch editor-simple-mode",action:"simpleEditor"}];_ae.initAdvanceEditor=function(){var a=this;a.xmlEditor=new xmlEditor;var b=a.body.find(".advanceEditorBody #xml");a.xmlEditor.loadXmlFromString(a.xml,b,function(){b.show();b.find("#actionButtons").show();a.xmlEditor.renderTree();a.xmlEditor.on("contentChanged",function(){a.setDirty()})})};
app.tabs.xmlEditor.simpleEditor=function(){app.tabs.xmlEditor.simpleEditor._super.constructor.apply(this,arguments)};_se=app.tabs.xmlEditor.simpleEditor.inherit(app.tabs.xmlEditor);
(function(){function a(){var a=this,d=a.cmEditor;a.bindEditorEvent();a.body.find(".toolbar form").form({preSubmit:function(){var b=$(this).find("input:text");a.searchText(b.val());return!1}});a.body.find(".toolbar-item.next").click(function(){CodeMirror.commands.findNext(d);return!1});a.body.find(".toolbar-item.previous").click(function(){CodeMirror.commands.findPrev(d);return!1});a.body.find(".toolbar-item.save").click(function(){a.save()});$(a.body.find(".simpleEditorBody .CodeMirror")[0]).bind("keydown",
function(b){if(b.ctrlKey||b.metaKey)switch(String.fromCharCode(b.which).toLowerCase()){case "s":b.preventDefault(),a.save()}if(b.ctrlKey&&b.altKey)switch(String.fromCharCode(b.which).toLowerCase()){case "l":b.preventDefault();a.reFormatSelection();break;case "g":b.preventDefault(),a.initGoToPopup()}});a.body.find(".toolbar-item.undo").click(function(){if($(this).hasClass("disabled"))return this;a.cmEditor.undo()});a.body.find(".toolbar-item.redo").click(function(){if($(this).hasClass("disabled"))return this;
a.cmEditor.redo()})}_se.init=function(){app.tabs.xmlEditor.simpleEditor._super.init.call(this);this.loadEditor();a.call(this)}})();_se.ajax_url=app.baseUrl+"assetLibrary/loadSimpleXmlEditor";_se.switch_menu_entries=[{text:$.i18n.prop("switch.advance.mode"),ui_class:"view-switch editor-advance-mode",action:"advanceEditor"}];
_se.loadEditor=function(){var a=this,b=this.xmlContent,d=a.body.find(".simpleEditorBody .code-area");d.val(b);this.cmEditor=CodeMirror.fromTextArea(d[0],{lineNumbers:!0,extraKeys:{"Ctrl-Space":"autocomplete"},mode:"xml",theme:"eclipse",highlightSelectionMatches:{showToken:/\w/},showCursorWhenSelecting:!0,matchBrackets:!0,autoCloseBrackets:!0,readOnly:a.readOnly});a.resizeEditor();$(window).bind("resize."+a.id,function(){a.resizeEditor()});a.on("close",function(){$(window).unbind("resize."+a.id)})};
_se.resizeEditor=function(){this.cmEditor.setSize(null,this.body.height()-this.body.find(".header").height()-25);this.cmEditor.refresh()};
_se.bindEditorEvent=function(){var a=this,b=a.cmEditor;if(b)b.on("change",function(b){var c=b.historySize();app.tabs.xmlEditor.xmlContent=b.getValue();0<c.undo?(a.setDirty(),a.body.find(".toolbar-item.undo").removeClass("disabled")):(a.clearDirty(),a.body.find(".toolbar-item.undo").addClass("disabled"));0<c.redo?a.body.find(".toolbar-item.redo").removeClass("disabled"):a.body.find(".toolbar-item.redo").addClass("disabled")})};
_se.jumpToLine=function(a){var b=this.cmEditor;a&&!isNaN(Number(a))&&(a=Number(a)-1,b.setCursor(a,0),b.setSelection({line:a,ch:0},{line:a+1,ch:0}),b.focus())};
_se.initGoToPopup=function(){var a=this,b=$("<form class='edit-popup-form'><div class='form-row mandatory'><label>"+$.i18n.prop("line.no")+"</label><input type='text' name='lineNo' value='0' validation='digits'></div><div class='button-line'><button type='button' class='cancel-button'> "+$.i18n.prop("cancel")+"</button> &nbsp; &nbsp;<button type='submit' class='submit-button'>"+$.i18n.prop("enter")+"</button></div></form>"),d=b.find("input:text");bm.editPopup(void 0,$.i18n.prop("go.to.line"),void 0,
void 0,{content:b,events:{content_loaded:function(){var a=this;d.focus();a.find(".cancel-button").click(function(){a.close()})}},beforeSubmit:function(b,f,g){g.close();a.jumpToLine(d.val());return!1}})};_se.reFormatSelection=function(){for(var a=this.cmEditor,b=a.getCursor(!0).line,d=a.getCursor(!1).line;b<=d;b++)a.indentLine(b)};_se.searchText=function(a){var b=this.cmEditor;CodeMirror.commands.clearSearch(b);CodeMirror.commands.findAll(b,a,!1)};
bm.onReady(app.tabs,"edit_content",function(){function a(a){var b=a.pageBody.find(".page-content"),c=b.parent(),d=this.closest(".grid-block, .widget-container"),l={undo:function(){c.append(b);d.append(c.find(">.editable-area-overlay"));var f=c.add(d).filter(":has(.selected)");f.length&&a.selectGrid(f);a.grid_sortable.addElement(d);a.grid_sortable.removeElement(c)},redo:function(){d.append(b);c.append(d.find(">.editable-area-overlay"));var f=c.add(d).filter(":has(.selected)");f.length&&a.selectGrid(f);
a.grid_sortable.addElement(c);a.grid_sortable.removeElement(d)}};l.redo();a.setDirty(l)}app.tabs.edit_content.layout=function(a){a.containerType="layout";this.ajax_url=app.baseUrl+"layout/editLayout?id="+a.containerId;d.constructor.apply(this,arguments)};var b=app.tabs.edit_content.layout.inherit(app.tabs.edit_content),d=app.tabs.edit_content.layout._super;b.editContainerJsUrl=app.baseUrl+"layout/editJs";b.loadCsss=function(){if(this.containerId){var a=this.iframeContent.find("#stored-css");this.css=
(new CssParser(a[0].innerHTML)).parse()}else this.css=(new CssParser(".body > .widget-container {width: 1000px;} .header > .widget-container {width: 1000px; height: 200px;} .footer > .widget-container {width: 1000px; height: 200px;}")).parse(),this.iframeContent.find("head").append("<style id='stored-css'>"+this.css.toString()+"</style>")};b.save=function(a){var b=this,c=function(){app.global_event.trigger("layout-update",[b.containerId])};a=a?c.blend(a):c;return d.save.call(this,a)};b.setEditableOverlay=
function(b){var c=this;d.setEditableOverlay.apply(this,arguments);b=b||this.activeSection;if(this.activeSection.is(".body")){var g=$("<span class='set-content-block'></span>").text($.i18n.prop("make.page.content.placeholder"));b.find("div:has(>.editable-area-overlay):not(:has(>.grid-block, >.page-content, >.widget)) .editable-area-overlay").append(g.click(function(){a.call($(this),c)}))}};b.onNewWidgetDrop=function(a,b){if(this.activeSection.is(".body")&&!a.siblings("."+this.widgetClass).length){var c=
function(){this[0].parent.parent().length?l.detach():f.append(l)},f=a.siblings(".editable-area-overlay"),l=f.find(".set-content-block");l.detach();b=b?b.blend(c):c}d.onNewWidgetDrop.call(this,a,b)};b.initializeSectionForEditing=function(a){var b=this;d.initializeSectionForEditing.call(this,a);a.is(".body")&&a.find(".editable-area-overlay, .page-content").mousedown(function(){b.unselectWidget()})};b.removeWidget=function(b,f,g){var c=this.activeSection.find("#wi-"+f),l=c.siblings(".editable-area-overlay");
c=0==c.siblings("."+this.widgetClass).length;b=d.removeWidget.call(this,b,f,g);if(this.activeSection.is(".body")&&c){f=function(){this[0].parent?n.detach():l.append(n)};var n=$("<span class='set-content-block'></span>").text($.i18n.prop("make.page.content.placeholder"));n.click(a.bind(n,this));l.append(n);$.isArray(b)&&(b[0].handler=b[0].handler.blend(f),b[1].handler=b[1].handler.blend(f))}return b}});
app.tabs.managePayment=function(){app.tabs.managePayment._super.constructor.apply(this,arguments);$.extend(this,{text:$.i18n.prop("manage.payment"),name:$.i18n.prop("order.hash.number",this.order.id),tip:$.i18n.prop("order.hash.number",this.order.id),ui_class:"edit-payment edit-tab",ui_body_class:"manage-payment-info",ajax_url:app.baseUrl+"order/managePayment?orderId="+this.order.id})};app.tabs.managePayment.table=function(a,b,d){this.body=a;this.appTab=b;this.ajax_url=d};_t=app.tabs.managePayment.table.inherit(app.SingleTableView);
_t.init=function(){this.body.updateUi();app.tabs.managePayment.table._super.init.call(this);this.tableEvent(this.body.find(".log-table"))};_t.tableEvent=function(a){var b=this;bm.menu(b.menus,a,".action-navigator",{click:function(a,c){c=c.config("entity");switch(a){case "pay":b.pay(c.id,c.orderid);break;case "refund":b.refund(c.id)}},open:b.onOpen},"click")};_t.menus=[{text:$.i18n.prop("pay"),ui_class:"pay",action:"pay"},{text:$.i18n.prop("refund"),ui_class:"refund",action:"refund"}];
_t.onOpen=function(a){var b=$(this);a.is("tr.success span")?(b.find(".menu-item.pay").addClass("disabled"),b.find(".menu-item.refund").removeClass("disabled")):(b.find(".menu-item.pay").removeClass("disabled"),b.find(".menu-item.refund").addClass("disabled"))};
_t.refund=function(a){var b=this;bm.confirm($.i18n.prop("this.payment.will.be.marked.as.refunded"),function(){bm.ajax({url:app.baseUrl+"order/refundPayment",data:{id:a},success:function(a){1==a.reAdjustInventory&&bm.confirm($.i18n.prop("do.you.want.adjust.inventory"),function(){bm.ajax({url:app.baseUrl+"order/reAdjustInventory",data:{orderId:a.orderId,paymentId:a.paymentId},success:function(){}})},function(){});b.appTab.reload();app.global_event.trigger("payment-refunded")}})},function(){})};app.tabs.managePayment.inherit(app.Tab);
var _mp=app.tabs.managePayment.prototype;
(function(){_mp.init=function(){app.tabs.managePayment._super.init.call(this)};_mp.reinit=function(){this.bindDetailsTable();app.tabs.managePayment._super.reinit.apply(this,arguments)};_mp.bindDetailsTable=function(){(new app.tabs.managePayment.table(this.body.find(".payment-log"),this,app.baseUrl+"order/managePayment?orderId="+this.order.id)).init()};_mp.action_menu_entries=[{text:$.i18n.prop("add.payment"),ui_class:"add-payment",action:"add-payment"},{text:$.i18n.prop("send.invoice"),ui_class:"send-invoice",
action:"send-invoice"}];_mp.onActionMenuClick=function(a){switch(a){case "add-payment":this.pay(null,this.order.id);break;case "send-invoice":bm.ajax({url:app.baseUrl+"order/sendInvoice",data:{orderId:this.order.id}})}};_mp.onActionMenuOpen=function(a){app.checkPermission(a,[{key:"order.manage.order",class:"send-invoice"}])};_t.pay=_mp.pay=function(a,b){var d=this;bm.editPopup(app.baseUrl+"order/makePayment",$.i18n.prop("make.payment"),"",{id:a,orderId:b},{widget:850,success:function(){a?d.appTab.reload():
d.reload();app.global_event.trigger("payment-added")}})}})();
app.tabs.manageShipment=function(){app.tabs.manageShipment._super.constructor.apply(this,arguments);this.constructor_args=arguments;this.text=$.i18n.prop("manage.shipment");this.name=$.i18n.prop("order.hash.number",this.data.order.id);this.tip=$.i18n.prop("order.hash.number",this.data.order.id);this.ui_class="manage-shipment edit-tab";this.ui_body_class="manage-shipment-info";$.extend(this,{orderId:this.data.order.id,ajax_url:this.ajax_url+"?orderId="+this.data.order.id})};_ms=app.tabs.manageShipment.inherit(app.Tab);
(function(){_ms.init=function(){app.tabs.manageShipment._super.init.call(this)}})();app.tabs.manageShipment.shipmentInfo=function(){$.extend(arguments,{type:"shipmentInfo"});app.tabs.manageShipment.shipmentInfo._super.constructor.apply(this,arguments)};var _msi=app.tabs.manageShipment.shipmentInfo.inherit(app.tabs.manageShipment);
(function(){function a(){var a=this,d=a.body;d.find(".edit-ship").on("click",function(){a.addShipment($(this).attr("data-shipping-id"),a.orderId)});d.find(".show-edit-history").on("click",function(){var a={shipmentId:$(this).attr("data-shipping-id")};bm.editPopup(app.baseUrl+"order/showShipmentHistory",$.i18n.prop("shipment.history"),null,a,{width:600,events:{content_loaded:function(){var a=$(this);a.find("[name='changeLabel']").on("change",function(){var b=$(this).val();a.loader();bm.ajax({url:app.baseUrl+
"order/reloadShipmentHistory",data:{uuid:b},dataType:"html",response:function(){a.loader(!1)},success:function(b){a.find(".history-table").replaceWith(b)}})})}}})})}_msi.init=function(){app.tabs.manageShipment.shipmentInfo._super.init.call(this)};_msi.reinit=function(){app.tabs.manageShipment.shipmentInfo._super.reinit.call(this);a.call(this)}})();_msi.switch_menu_entries=[{text:$.i18n.prop("shipment.details.list"),ui_class:"view-switch shipment-details list",action:"shipmentDetails"}];
_msi.action_menu_entries=[{text:$.i18n.prop("add.shipment"),ui_class:"add-shipment",action:"add-shipment"},{text:$.i18n.prop("send.invoice"),ui_class:"send-invoice",action:"send-invoice"},{text:$.i18n.prop("print.shipping.label"),ui_class:"shipping-level",action:"shipping-level"},{text:$.i18n.prop("print.delivery.docket"),ui_class:"delivery-docket",action:"delivery-docket"}];
_msi.onActionMenuClick=function(a){switch(a){case "add-shipment":this.addShipment(null,this.orderId);break;case "send-invoice":bm.ajax({url:app.baseUrl+"order/sendInvoice",data:{orderId:this.orderId}});break;case "shipping-level":this.printShippingLevel(this.orderId,!1);break;case "delivery-docket":this.printDeliveryDocket(this.orderId,!1)}};
_msi.addShipment=function(a,b){var d=this;bm.editPopup(app.baseUrl+"order/addShipment",$.i18n.prop("add.shipment"),"",{shippingId:a,orderId:b},{width:850,success:function(){d.reload();app.global_event.trigger("shipment-added")}})};
_msi.printShippingLevel=function(a,b){var d={id:a,view:b,type:"shipping"},c=bm.getUUID();bm.ajax({url:app.baseUrl+"layout/isAdminLoggedIn",success:function(){bm.editPopup(app.baseUrl+"document/getDocumentData",$.i18n.prop("print.shipping.level"),name,d,{width:770,height:window.innerHeight-window.innerHeight/100*20,scroll:!1,events:{content_loaded:function(a){var b=this,d=b.find(".printBody")[0].contentWindow;bm.onReady(d,"printMe",function(){b.find(".print-button").click(function(){d.focus();d.printMe()})});
b.find(".content").css("height","80%");$(window).bind("resize."+c,function(){b.css("height",window.innerHeight-window.innerHeight/100*20)});a.on("close",function(){$(window).unbind("resize."+c)})}}})}})};
_msi.printDeliveryDocket=function(a,b){var d={id:a,view:b,type:"delivery_docket"},c=bm.getUUID();bm.ajax({url:app.baseUrl+"layout/isAdminLoggedIn",success:function(){bm.editPopup(app.baseUrl+"document/getDocumentData",$.i18n.prop("print.delivery.docket"),name,d,{width:770,height:window.innerHeight-window.innerHeight/100*20,scroll:!1,events:{content_loaded:function(a){var b=this,d=b.find(".printBody")[0].contentWindow;bm.onReady(d,"printMe",function(){b.find(".print-button").click(function(){d.focus();
d.printMe()})});b.find(".content").css("height","80%");$(window).bind("resize."+c,function(){b.css("height",window.innerHeight-window.innerHeight/100*20)});a.on("close",function(){$(window).unbind("resize."+c)})}}})}})};_msi.ajax_url=app.baseUrl+"order/shipmentInformation";
app.tabs.navigationItem=function(){app.tabs.navigationItem._super.constructor.apply(this,arguments);$.extend(this,{text:$.i18n.prop("edit.navigation"),name:this.navigation.name,tip:$.i18n.prop("edit.navigation")+" - "+this.navigation.name,ui_class:"edit-navigation edit",ui_body_class:"simple-tab",ajax_url:app.baseUrl+"navigation/loadNavigationEditor?id="+this.navigation.id,strict_layout:!1})};app.tabs.navigationItem.inherit(app.ExplorerPanelTab);_en=app.tabs.navigationItem.prototype;
_en.imageMap={};_en.resize_disabled=!0;_en.tree_disabled=!0;_en.left=400;_en.crateFuncSpecificEvent=null;
(function(){function a(){var a=this;a.body.find(".bmui-stl-entry").length?a.menuStatus.autoPopulate=!1:a.menuStatus.autoPopulate=!0;this.body.find(".toolbar .save").click(function(){a.save(function(b,c){var d=new FormData;a.body.find("[update_cache]").removeAttr("update_cache");$.each(b,function(b,c){var f=a.imageMap[b]?a.imageMap[b]:[];delete a.imageMap[b];d.append("id",c);d.append("item-images",f[0]);d.append("imageData",f[1]?!0:!1);a.body.find("[item_id='"+b+"']").attr("item_id",c);a.body.find("[parent='"+
b+"']").attr("parent",c)});$.each(c,function(a){d.append("removedId",a)});$.each(a.imageMap,function(a,b){var c=b;d.append("id",a);b?(c=b[0]&&b[0].type?c[0]:null,d.append("item-images",c),d.append("imageData",b[1]?!0:!1)):(d.append("item-images",null),d.append("imageData",!1))});bm.ajax({url:"navigation/updateItemImage",data:d,processData:!1,contentType:!1});a.body.find(".removed-repository").empty()})});this.body.find(".right-panel").scrollbar({vertical:{offset:3}});this.body.find(".scroll-item-wrapper").on("click",
".edit",function(b){a.createNavigationItem($(b.target).closest(".bmui-stl-entry"))});this.body.find(".scroll-item-wrapper").on("click",".remove",function(b){b=$(b.target).closest(".bmui-stl-entry");var c=a.body.find(".removed-repository"),d=+b.attr("item_id");0<d&&(delete a.imageMap[d],c.append("<input value='"+d+"'>"));b.siblings(".bmui-stl-sub-container").find(".bmui-stl-entry").each(function(){d=+$(this).attr("item_id");0<d&&(delete a.imageMap[d],c.append("<input value='"+d+"'>"))});b.closest(".bmui-stl-entry-container").remove();
0==a.body.find(".bmui-stl-entry").length&&(a.menuStatus.autoPopulate=!0);a.setDirty()})}_en.init=function(){var b=this;b.createNavigationItem();app.tabs.navigationItem._super.init.call(this);this.body.find(".scroll-item-wrapper").sortableTreeList({change:function(a){a.item.attr("parent",a.parent.attr("item_id")||"");b.setDirty()}});this.clearDirty();a.call(this)}})();
_en.action_menu_entries=[{text:$.i18n.prop("auto.populate.navigation"),ui_class:"auto-populate-navigation",action:"auto-populate-navigation"},{ui_class:"item-separator"},{text:$.i18n.prop("revert"),ui_class:"revert",action:"revert"}];_en.menuStatus={autoPopulate:!0,revert:!0};
_en.onActionMenuOpen=function(a){this.menuStatus.autoPopulate?(this.action_menu.show("auto-populate-navigation"),this.action_menu.show("item-separator")):(this.action_menu.hide("auto-populate-navigation"),this.action_menu.hide("item-separator"));this.menuStatus.revert?this.action_menu.enable("revert"):this.action_menu.disable("revert")};_en.onActionMenuClick=function(a){switch(a){case "auto-populate-navigation":this.autoPopulateNavigation();break;case "revert":this.reloadEditor()}};
_en.offCrateFuncSpecificEvent=function(){this.crateFuncSpecificEvent&&this.off_global(this.crateFuncSpecificEvent)};
_en.createNavigationItem=function(a){this.offCrateFuncSpecificEvent();var b={},d=this;a&&(b.cache=a.attr("update_cache"),b.id=a.attr("item_id"),b.parent=a.attr("parent"));var c=d.serializeNames(d.body);b.parents=JSON.stringify(d.getItemsForSelections(c,b));b.title=b.id||b.cache?$.i18n.prop("edit.item"):$.i18n.prop("add.a.new.item");bm.ajax({url:app.baseUrl+"navigation/createNavigation",dataType:"html",data:b,success:function(c){c=$(c);var f=d.body.find(".navigation-item-form");f.length?f.replaceWith(c):
d.body.find(".left-panel").append(c);f=d.body.find(".navigation-item-form");if(c=d.imageMap[b.id])f.find("[name=item-image]").attr("remove-support","true"),f.find("#navigation-logo-preview").attr("src",c[1]);f.find(".cancel-button").on("click",function(){d.createNavigationItem()});f.find("[name=item-image]").on("file-remove",function(){f.find("#navigation-logo-preview").attr("src",null)});var m=f.find("#itemType");m.change(function(){var a=this;d.offCrateFuncSpecificEvent();var b=$(a).closest(".form-row");
setTimeout(function(){a.options[0].value||$(a).chosen("remove",a.options)},50);var c=this.value;bm.ajax({url:app.baseUrl+"navigation/loadReferenceSelectorBasedOnType",data:{type:c},dataType:"html",success:function(a){var e=b.next(".ref-selector-row");e.length?e.replaceWith(a):b.after(a);b.next(".ref-selector-row").updateUi();b.next(".ref-selector-row").find(".create-new").on("click",function(){d.offCrateFuncSpecificEvent();app.navigation_item_ref_create_func[c].call(d);var a=c+"-create";d.one_global(a,
function(){d.crateFuncSpecificEvent=null;m.trigger("change")});d.crateFuncSpecificEvent=a});f.updateValidator()}})});d.body.find(".left-panel").scrollbar({vertical:{offset:3}});f.updateUi();f.form({ajax:{beforeSubmit:function(c,g){var l=c[4].value,e={};$.each(c,function(a,b){"item-image"!=b.name&&(e[b.name]=b.value)});var m=e.itemType;if(!e.itemRef)return bm.notify($.i18n.prop("no."+m.dotCase()+".is.selected"),"alert"),c=f.data("formInst"),c.submitButton.text(c.submitButton[0].orgText),c.submitButton.removeAttr("disabled",
"disabled"),!1;e.parent=l;l=d.body.find(".scroll-item-wrapper");m=a;g=g.find("#navigation-logo-preview").attr("src");if(a){var n=l.sortableTreeList("getParent",a).attr("item_id")||"0";d.imageMap[b.id]=0>b.id?c[5].value.type?[c[5].value,g]:g&&d.imageMap[b.id]?d.imageMap[b.id]:null:c[5].value.type?[c[5].value,g]:g?[null,g]:null}else{m=$('<div class="bmui-stl-entry"><div class="table-actions action-column"><span class="tool-icon edit" title="'+$.i18n.prop("edit")+'"></span><span class="tool-icon remove" title="'+
$.i18n.prop("delete")+'"></span></div><div class="name-column"></div></div>');var w=d.body.find(".freeFirstNegativeId");var y=w.val();w.val(+y+1);w=-1*y;m.attr("item_id",""+w);d.imageMap[w]=c[5].value.type?[c[5].value,g]:null}e.item_id=w;m.attr("update_cache",JSON.stringify(e));m.find(".name-column").text(e.label);if(n!==e.parent){m.attr("parent",e.parent);var A;e.parent&&l.sortableTreeList("each",function(a){if(a.attr("item_id")==e.parent)return A=a,!1});m.parent().length?l.sortableTreeList("setParent",
m,A):l.sortableTreeList("addHandle",m,A)}d.setDirty();d.menuStatus.autoPopulate=!1;m.updateUi();d.createNavigationItem();return!1}}})}})};_en.serialize=function(a){var b=[];a.find(".bmui-stl-entry").each(function(a){var c=$(this),d=c.attr("update_cache");b.push({id:c.attr("item_id"),parent:c.attr("parent"),placement:a,update_cache:d?JSON.parse(d):void 0})});return b};
_en.serializeNames=function(a){var b=[];a.find(".bmui-stl-entry").each(function(){var a=$(this);b.push({id:a.attr("item_id"),parentId:a.attr("parent"),title:a.find(".name-column").text().trim()})});return b};
_en.getItemsForSelections=function(a,b){function d(a,b){a.every(function(){this.depth=b;m.push(this);d(this.children,b+1)})}var c=[],f={};f.name=$.i18n.prop("none");f.id=0;f.depth=1;f.children=[];f.expand=[];c.push(f);if(b.id)var g=b.id;a.every(function(){var a={name:this.title,id:this.id,children:[]};c[this.id]=a;this.parentId?this.parentId!=g&&this.id!=g&&c[this.parentId].children.push(a):this.id!=g&&c[0].children.push(a)});var m=[];m.push(c[0]);d(c[0].children,1);return m};
_en.autoPopulateNavigation=function(){var a=this;bm.editPopup("navigation/autoPopulate",$.i18n.prop("populate.navigation"),"",{},{events:{content_loaded:function(b){this.find(".auto-populate-option").click(function(){var d=$(this).attr("item-type");a.autoPopulate(d);b.close()})}}})};
_en.autoPopulate=function(a){var b=this,d=[];b.body.find(".removed-repository").children().each(function(){d.push(this.value)});bm.ajax({url:app.baseUrl+"navigation/autoPopulateWithItems",dataType:"html",data:{id:b.navigation.id,type:a,removedItems:d},success:function(a){b.body.html(a);b.init();b.setDirty()}})};
_en.save=function(a){if(this.isDirty()){var b=this,d=b.serialize(this.body),c=[];b.body.find(".removed-repository").children().each(function(){c.push(this.value)});d={navigationId:this.body.find("#navigationId").val(),updatedJSON:JSON.stringify(d)};c.length&&(d.removedItems=c);bm.ajax({url:app.baseUrl+"navigation/saveNavigationItems",data:d,success:function(d){b.clearDirty();a&&a(d.newIdMaps,c);b.reloadEditor();app.tabs.navigation.tab.reload()},complete:function(){}})}};
_en.setDirty=function(){this.body.find(".toolbar .save").removeClass("disabled");this.menuStatus.revert=!0;app.tabs.navigationItem._super.setDirty.call(this)};_en.clearDirty=function(){this.body.find(".toolbar .save").addClass("disabled");this.menuStatus.revert=!1;app.tabs.navigationItem._super.clearDirty.call(this)};_en.reloadEditor=function(){var a=this;this.imageMap={};bm.ajax({url:this.ajax_url,dataType:"html",success:function(b){a.body.html(b);a.init()}})};
bm.onReady(app.tabs,"order",function(){var a,b;app.tabs.order.Creator=function(a,d){var c=this;this.popupElement=a;this.parentTab=d;this.addressData={};b=0;this.step=1;this.maxStep=3;c.addedProduct=[];this.popupElement.find(".selected-products .tr").each(function(){var a=$(this);c.addedProduct.push(a.find(".pId").val());b++;var d=a.find(".stock");c.bindAddedProduct(a,d.config("spin"))});a.find(".select-product-view").hide();d=a.find(".select-customer-for-order");var f=this.customerTable=bm.table(d,
{url:app.baseUrl+"order/loadCustomer",beforeReloadRequest:function(){c.beforeReloadRequestCustomerTable(this.param)},afterLoad:function(){c.newCustomer=null;c.attachTableEvent()}});a.find(".customer-search-button").on("click",function(){f.reload()});a.find(".customer-search-form").form({preSubmit:function(){f.reload();return!1}});d=a.find(".select-product-for-order");var l=bm.table(d,{url:app.baseUrl+"order/loadProduct",beforeReloadRequest:function(){c.beforeReloadProductTable(this.param)},afterLoad:function(){c.attachProductTableEvent()}});
a.find(".product-search-button").on("click",function(){l.reload()});a.find(".product-search-form").form({preSubmit:function(){l.reload();return!1}}).hide();c.attachPopupEvent();c.attachProductTableEvent();app.global_event.trigger("create-order-loader",[a])};var d=app.tabs.order.Creator.prototype;d.goToNextStep=function(a){if(1>a||a>this.maxStep)return!1;var b=this.popupElement;b.find("[step]").hide();b.find("[step="+a+"]").show();this.step=a;b.find(".body").scrollTop(0);return!0};d.attachPopupEvent=
function(){var c=this,d=this.popupElement;a=d.find("input[name=customerId]");var g=d.find(".nextStep"),m=d.find(".previousStep"),l=d.find(".toolbar-btn.create-customer");g.on("click",function(){if(1==c.step){if(!a.val())return bm.notify($.i18n.prop("no.customer.selected"),"alert"),!1}else if(2==c.step&&1>c.addedProduct.length)return bm.notify($.i18n.prop("no.product.is.selected"),"alert"),!1;return c.goToNextStep(c.step+1)});c.goToNextStep(1);m.on("click",function(){c.goToNextStep(c.step-1)});d.find(".modify-billing-shipping-address").on("click",
function(){c.changeBillingShippingAddress()});l.on("click",function(){app.tabs.customer.customers.prototype.createCustomer.call(c.parentTab,{success:function(a){c.newCustomer=a.id;c.customerTable.reload()},createPanelTemplate:app.Tab.prototype.createPanelTemplate.clone()})});d.find(".remove-all").on("click",function(){d.find(".selected-products").find(".tr").remove();c.addedProduct=[];b=0;c.setSelectedMark()});c.attachTableEvent()};d.changeBillingShippingAddress=function(){var b=this,d=this.popupElement,
g={customerId:a.val()};Object.keys(b.addressData).length&&(g.billingAddress=b.addressData.billingAddress,g.shippingAddress=b.addressData.shippingAddress);var m=bm.editPopup(app.baseUrl+"order/changeAddressView",$.i18n.prop("change.address"),name,g,{width:780,events:{content_loaded:function(){var a=this.find("form .edit-billing-address"),b=this.find("form .edit-shipping-address");bm.countryChange(this.find("form .edit-billing-address"),{inputClass:"medium"});bm.countryChange(this.find("form .edit-shipping-address"),
{inputClass:"medium"});bm.initCityValidator(a.find("[name=postCode]"),"countryId","stateId",a);bm.initCityValidator(b.find("[name=postCode]"),"countryId","stateId",b)}},beforeSubmit:function(a,c,f){this.find("form .edit-billing-address");a=d.find("form.order-create");var e={},g={};this.find(".edit-billing-address input, .edit-billing-address select").each(function(){var a=$(this);e[a.attr("name")]=a.val()});this.find(".edit-shipping-address input, .edit-shipping-address select").each(function(){var a=
$(this);g[a.attr("name")]=a.val()});a.find("input[name=billingAddress]").remove();a.find("input[name=shippingAddress]").remove();b.addressData={billingAddress:JSON.stringify(e),shippingAddress:JSON.stringify(g)};a.append("<input type='hidden' name='billingAddress' value='"+b.addressData.billingAddress+"'><br><input type='hidden' name='shippingAddress' value='"+b.addressData.shippingAddress+"'>");m.close();return!1}})};d.attachTableEvent=function(){var b=this,d=this.popupElement;d.find(".customer-row").on("click",
function(){var c=$(this);c.is(".selected")||(b.addressData={},d.find("form input[name=billingAddress]").remove(),d.find("form input[name=shippingAddress]").remove());d.find(".customer-row.selected").removeClass("selected");c.addClass("selected");a.val($(this).find("input[name=id]").val())})};d.setSelectedMark=function(){var a=this.popupElement,b=a.find(".selected-products").find(".table-body");a.find(".product-row").each(function(){var a=$(this);0<b.find(".pId[value='"+a.attr("product-id")+"']").length?
a.addClass("selected"):a.removeClass("selected")})};d.attachProductTableEvent=function(){var a=this;this.popupElement.find(".product-row").on("click",function(){a.addToAddedList($(this))});this.popupElement.find(".add-product.link").click(function(){a.popupElement.find(".cancel").trigger("click");ComponentManager.openTab(ComponentManager.getRibbonData(app.ribbons.web_commerce,"item"));app.tabs.item()});app.global_event.on("delete-customer",function(b,c){c="number"==typeof c?[c]:c;a.popupElement.find(".customer-row  input[name=id]").each(function(){var a=
$(this);c.contains(+a.val())&&a.parents(".customer-row ").remove()})});a.setSelectedMark()};d.addToAddedList=function(c){function d(d){if(-1<d.pos)bm.notify($.i18n.prop("product.already.added"),"alert");else{var f=$.extend({productId:d.id,quantity:d.quantity,customerId:a.val(),included:d.included,"config.options":d.options},c.closest(".order-create").serializeObject());bm.ajax({url:app.baseUrl+"order/validateQuantity",data:f,success:function(a){a='<input class="pPrice" type="hidden" name="products.product_'+
b+'.price" value="'+d.price+'"/>';var e='<input class="quantity tiny" type="text" name="products.product_'+b+'.quantity" value="'+d.quantity+'"/>',f="";d.options&&$.each(d.options,function(a,c){f+="<input type='hidden' name='products.product_"+b+".config.options' value='"+c+"'>"});var l=d.attrs?d.attrs:{},n='<tr class="tr" data-attrs="'+l+'"> <input class="pId" type="hidden" value="'+d.id+'" name="products.product_'+b+'.id" />'+(1==d.combinedConf.iscombined?'<input class="included" type="hidden" name="products.product_'+
b+".included\" value='"+d.included+"'>":"")+'<td class="product-name">'+d.name+"</td><td>"+d.sku+'</td><td class="editable price" restrict="decimal" validation="price required">'+a+'<span class="value">'+d.price+'</span></td><td class="stock">'+d.stock+'</td><td class="quantity" restrict="numeric">'+e+'</td><td><span class="tool-icon remove"></span></td>'+(f?f:"")+"</tr>";n=$(n);$.each(l,function(a,c){n.append("<input type='hidden' name='products.product_"+b+"."+a+"' value='"+c+"'>")});m.find("tr.no-order-found").remove();
m.find(".selected-products").find(".table-body").append(n);c.addClass("selected");g.addedProduct.push(d.id);b++;g.bindAddedProduct(n,d.spinConfig?d.spinConfig:{})}})}}var g=this,m=g.popupElement,l={tr:c};l.id=c.attr("product-id");$.each(g.addedProduct,function(a,b){""+this==l.id&&(l.pos=0)});l.return=!1;l.name=c.find(".pName").html();l.sku=c.find(".sku").html();l.price=c.find(".pPrice").html();l.stock=c.find(".stock").html();l.quantity=c.find(".stock").attr("value");l.included=c.find(".stock").config("included");
l.included=l.included?JSON.stringify(l.included):"";l.combinedConf=c.find(".stock").config("combined");l.spinConfig=c.find(".stock").config("spin");app.global_event.trigger("on-backend-order-create",[l,m,d]);l.return||d(l)};d.bindAddedProduct=function(a,b){var c=this,d=a.find(".editable:not(.quantity)");a.find("td.quantity input").stepper(b);bm.makeTableCellEditable(d,function(a,b){var c=a.find("input[type=hidden]");if(a.is(".quantity")){if(parseInt(a.siblings("td.stock").text())<b){a.find(".value").text(c.val());
bm.notify($.i18n.prop("out.of.stock"),"alert");return}}else if(a.is(".price")){var d=a.attr("validation"),f=a.find(".td-full-width");if(a=ValidationField.validateAs(f,d))return bm.notify($.i18n.prop(a.msg_template,a.msg_params),"alert"),f.addClass("error-highlight"),setTimeout(function(){f.removeClass("error-highlight")},1E3),!1}c.val(b)});a.find(".remove").on("click",function(){var a=$(this).parent().parent(),b=a.find(".pId").val();b=c.addedProduct.indexOf(b);c.addedProduct.splice(b,1);a.remove();
c.setSelectedMark()})};d.updateProductPrice=function(b,d){Object.keys(this.addressData).length&&(d.billingAddress=this.addressData.billingAddress);d.customerId=a.val();var c=b.find(".current-price .currency-symbol"),f=b.find(".current-price .price-amount"),l=b.find(".title .emphasized");bm.ajax({controller:"order",action:"priceAndUnavailableMsg",data:d,success:function(a){var b=a.productName,d=a.price.toFixed(2);c.text(a.currency);f.text(d);l.text(b)},error:function(a,b,d){l.text("");c.text("");f.text(d.message?
d.message:$.i18n.prop("not.available"))}})};d.beforeReloadRequestCustomerTable=function(b){var c=this.popupElement.find(".customer-search-text").val();c={id:a.val(),newCustomer:this.newCustomer,searchText:c};$.extend(b,c)};d.beforeReloadProductTable=function(a){var b={searchText:this.popupElement.find(".product-search-text").val()};$.extend(a,b)}});
bm.onReady(app.tabs,"edit_content",function(){app.tabs.edit_content.page=function(a){a.containerType=a.containerType||"page";this.ajax_url=app.baseUrl+"pageAdmin/editPageContent?id="+a.containerId;this.initial_section="body";b.constructor.apply(this,arguments)};var a=app.tabs.edit_content.page.inherit(app.tabs.edit_content),b=app.tabs.edit_content.page._super;a.editContainerJsUrl=app.baseUrl+"pageAdmin/editJs";a.initEditor=function(){this.body.find(".toolbar-item.view-site").on("click",function(){var a=
app.siteBaseUrl+$(this).attr("url")+"?adminView=true";window.open(a,"_blank")});if(this.has_layout){this.layout_name&&(this.status_block=this.status_block||StatusBarManager.allocate(this.id+"-layout-name","attached-layout-name"),this.status_block.set($.i18n.prop("attached.layout.name")+" - <span class='layout-name-info'>"+bm.htmlEncode(this.layout_name)+"</span>"));this.pageBody.addClass("edit-page-with-layout");var a=this.pageBody.find(".body[section] .page-content");if(a.length)for(a=a.parent();!a.is(".body");)a.siblings().append('<div class="noneditable-area-overlay"></div>'),
a=a.parent();this.sectionHeight.stepper("disable");this.sectionWidth.stepper("disable");this.supportedWidgetSelector=".page-content ."+this.widgetClass;this.gridSelector=".page-content .grid-block";this.editableBlockSelector=this.gridSelector+", .page-content .widget-container:not(:has(>.grid-block)), .page-content:not(:has(>.grid-block, >.widget-container))";this.sortable_page_content=!0;this.settingBlock.find(".body-sections-selector, .section-tools").hide()}this.on("deActive",function(){this.status_block&&
this.status_block.hide()})};a.loadCsss=function(){var a=this.isResponsive?".header > .widget-container {height: 200px;} .footer > .widget-container {height: 200px;}":".body > .widget-container {width: 1000px;} .header > .widget-container {width: 1000px; height: 200px;} .footer > .widget-container {width: 1000px; height: 200px;}";var b=this.pageBody.find(".layout-id");b.length?(this.has_layout=!0,this.layout_id=b.val(),this.layout_name=this.pageBody.find(".layout-name").val(),this.leafGridBlockSelectorInContentMode=
".page-content:not(:has(>.grid-block, >div>.grid-block, >.widget-container)), .page-content .grid-block:not(:has(>.grid-block)), .page-content .widget-container:not(:has(>.grid-block))"):(this.has_layout=!1,this.leafGridBlockSelectorInContentMode=".widget-container:not(:has(>.grid-block)), .grid-block:not(:has(>.grid-block))");b=this.iframeContent.find("#stored-css");b=b.length?b[0].innerHTML:"";""!=b||this.has_layout||(this.have_to_add_default_css=!1,b=a,this.iframeContent.find("head #stored-css").text(b),
0==this.pageBody.find(".body > .widget-container").length&&this.pageBody.find(".body").prepend("<div class='widget-container'></div>"));this.have_to_add_default_css&&(b+=a,this.iframeContent.find("head #stored-css").text(b),this.have_to_add_default_css=!1);this.css=new CssParser(b);this.css.parse();this.post_attach_initialization&&(this.css.removeRule(".header .widget-container"),this.css.removeRule(".body .widget-container"),this.css.removeRule(".footer .widget-container"),this.iframeContent.find("head #stored-css").text(this.css.toString()),
this.pageBody.find(".page-content > .widget-container").removeClass("widget-container"));this.post_detach_initialization&&(a=this.pageBody.find(".body > div"),a.not(".widget-container").length&&a.addClass("widget-container"))};a.close=function(){!1!==b.close.apply(this,arguments)&&this.status_block&&this.status_block.remove()};a.setActive=function(){!1!==b.setActive.apply(this,arguments)&&this.status_block&&this.status_block.show()};a.initSectionMasks=function(){b.initSectionMasks.apply(this,arguments);
this.has_layout&&this.pageBody.find(".header .section-overlay, .footer .section-overlay").addClass("disabled")};a.getBodyContent=function(){return this.has_layout?this.pageBody.find(".page-content").clone():this.pageBody.find(".body").clone()};a.setDirty=function(){this.body.find(".detach-layout, .attach-layout").addClass("disabled");b.setDirty.apply(this,arguments)};a.clearDirty=function(){this.body.find(".attach-layout").removeClass("disabled");this.has_layout&&this.body.find(".detach-layout").removeClass("disabled");
b.clearDirty.apply(this,arguments);this.post_detach_initialization=this.post_attach_initialization=!1};a.onSectionChange=function(a,b){this.has_layout?7>b.length?(this.sectionHeight.stepper("disable"),this.sectionWidth.stepper("disable")):(this.sectionWidth.stepper("enable"),this.sectionHeight.stepper("enable")):this.sectionWidth.stepper("enable")};a.splitterDropped=function(a){var b=a.children();a.is(".page-content.l-fixed-container, .page-content.r-fixed-container, .page-content.v-split-container")&&
(a.is(".l-fixed-container")?a.append('<div class="l-fixed-container"></div>'):a.is(".r-fixed-container")?a.append('<div class="r-fixed-container"></div>'):a.append('<div class="v-split-container"></div>'),a.removeClass("l-fixed-container r-fixed-container v-split-container"),a.find("> .l-fixed-container, > .r-fixed-container, > .v-split-container").append(b))};a.editableWidgetsInSection=function(a){return this.has_layout?a.find(".page-content ."+this.widgetClass):b.editableWidgetsInSection.apply(this,
arguments)}});
bm.onReady(app.tabs,"productBulkEditor",function(){var a,b;app.tabs.productBulkEditor.Advanced=function(c,d){a=c;b=d};var d=app.tabs.productBulkEditor.Advanced.prototype;d.reload=function(){this.tabulator.reload()};d.afterTableReload=function(){a.clearDirty()};d.init=function(){var c=this;b.body.find(".toolbar-item.reload").on("click",function(){c.reload()});app.global_event.on("product-bulk-updated-advanced",function(){c.reload()});this.tabulator=bm.table($(a.find(".product-bulk-edit-tab.advanced-table")),{url:app.baseUrl+
"productAdmin/loadProductBulkProperties",beforeReloadRequest:function(){c.beforeReloadRequest(this.param)},afterLoad:function(){a.tool.filter(".action-header:visible").hide();c.table.tscrollbar("content");c.afterTableReload&&c.afterTableReload()},selectableCellSelect:app.tabs.productBulkEditor.selectableCellSelect,afterCellSelect:app.tabs.productBulkEditor.afterCellSelect,afterCellEdit:app.tabs.productBulkEditor.afterCellEdit});c.beforeReloadRequest=function(a){$.extend(a,{property:"advanced",ids:this.ids})};
this.table=a.find(".body table")}});
bm.onReady(app.tabs,"productBulkEditor",function(){function a(a,b,c,d){a.find(b).on("click",function(){bm.customerAndGroupSelectionPopup(a,{customerField:c,groupField:d})})}var b,d;app.tabs.productBulkEditor.Basic=function(a,c){b=a;d=c};var c=app.tabs.productBulkEditor.Basic.prototype;c.reload=function(){this.tabulator.reload()};c.afterTableReload=function(){b.clearDirty();d.body.find(".bmui-tab-body-container").find(".bulkedit-parent-td-proxy").remove()};c.init=function(){var a=this;d.body.find(".toolbar-item.reload").on("click",
function(){a.reload()});app.global_event.on("product-bulk-updated-basic",function(){a.reload()});this.tabulator=bm.table(b.find(".product-bulk-edit-tab.basic-table"),{url:app.baseUrl+"productAdmin/loadProductBulkProperties",beforeReloadRequest:function(){a.beforeReloadRequest(this.param)},afterLoad:function(){b.tool.filter(".action-header:visible").hide();a.afterTableReload&&a.afterTableReload()},onload:function(){},selectableCellSelect:app.tabs.productBulkEditor.selectableCellSelect,afterCellSelect:app.tabs.productBulkEditor.afterCellSelect,
afterCellEdit:app.tabs.productBulkEditor.afterCellEdit});a.beforeReloadRequest=function(a){$.extend(a,{property:"basic",ids:this.ids})};this.table=b.find(".body table")};app.tabs.productBulkEditor.selectableCellSelect=function(a){var b;a.is(".is-available")?b=$("<select><option value='true'>"+$.i18n.prop("available")+"</option><option value='false'>"+$.i18n.prop("not.available")+"</option></select>"):a.is(".is-active")?b=$("<select><option value='true'>"+$.i18n.prop("active")+"</option><option value='false'>"+
$.i18n.prop("inactive")+"</option></select>"):a.is(".product-condition")?b=$("<select><option value='new'>"+$.i18n.prop("new")+"</option><option value='used'>"+$.i18n.prop("used")+"</option><option value='refurbished'>"+$.i18n.prop("refurbished")+"</option></select>"):a.is(".brand")?b=app.tabs.productBulkEditor.getDropDown("brand","select.brand"):a.is(".manufacturer")?b=app.tabs.productBulkEditor.getDropDown("manufacturer","select.manufacturer"):a.is(".discount-profile")?b=app.tabs.productBulkEditor.getDropDown("discount",
"select.discount.profile"):a.is(".tax-profile")?b=app.tabs.productBulkEditor.getDropDown("tax","select.tax.profile"):a.is(".shipping-profile")?b=app.tabs.productBulkEditor.getDropDown("shipping","select.shipping.profile"):a.is(".on-sale")?b=$("<select><option value='true'>"+$.i18n.prop("on.sale")+"</option><option value='false'>"+$.i18n.prop("no")+"</option></select>"):a.is(".disable-tracking")?b=$("<select><option value='true'>"+$.i18n.prop("enable")+"</option><option value='false'>"+$.i18n.prop("disable")+
"</option></select>"):a.is(".restricted-price")?b=$("<select><option value='none'>"+$.i18n.prop("nobody")+"</option><option value='except_customer'>"+$.i18n.prop("only.customers")+"</option><option value='except_selected'>"+$.i18n.prop("selected.customers.only")+"</option></select>").updateUi():a.is(".restricted-purchase")&&(b=$("<select><option value='none'>"+$.i18n.prop("nobody")+"</option><option value='except_customer'>"+$.i18n.prop("only.customers")+"</option><option value='except_selected'>"+
$.i18n.prop("selected.customers.only")+"</option></select>").updateUi());return b};app.tabs.productBulkEditor.afterCellSelect=function(b,c,m,l){b.find("input[type=hidden]").val(c);var f=b.find(".disp-value");f.html(c?m:c);if(b.is(".is-available"))b.is(".custom-select")&&app.tabs.productBulkEditor.changeAvailability(b,c,m),b.find(".status").removeClass(d.status[l]).addClass(d.status[c]).refreshTooltip(m);else if(b.is(".is-active"))b.is(".custom-select")&&app.tabs.productBulkEditor.changeAadministrativeStatus(b,
c,m),b.find(".status").removeClass(d.status[l]).addClass(d.status[c]).refreshTooltip(m);else if(b.is(".product-condition"))b.is(".custom-select")&&app.tabs.productBulkEditor.changeCustomSelect(b,"product-condition",c,m),b.find(".status").removeClass(d.status[l]).addClass(d.status[c]).refreshTooltip(m);else if(b.is(".disable-tracking"))b.is(".custom-select")&&app.tabs.productBulkEditor.changeTracking(b,c,m),b.find(".status").removeClass(d.status[l]).addClass(d.status[c]).refreshTooltip(m);else if(b.is(".on-sale")){b.find(".is-on-sale");
var g=b.find(".sale-price");if("true"==c){var e=function(){var a=g.val();a?(g.hide(),f.html(parseFloat(a).toFixed(2)).show()):(app.tabs.productBulkEditor.errorHighlight(g),bm.notify($.i18n.prop("this.field.is.required"),"error"))};f.hide();g.show();g[g.attr("restrict")]();g[0].focus();g.on("focusout",function(){e()}).on("keydown",function(a){13!=a.keyCode&&27!=a.keyCode||e()})}else g.hide()}else b.is(".custom-select.discount-profile")?app.tabs.productBulkEditor.changeCustomSelect(b,"discount-profile",
c,m):b.is(".custom-select.tax-profile")?app.tabs.productBulkEditor.changeCustomSelect(b,"tax-profile",c,m):b.is(".custom-select.shipping-profile")?app.tabs.productBulkEditor.changeCustomSelect(b,"shipping-profile",c,m):b.is(".custom-select.restricted-price")||b.is(".restricted-price")?(b.is(".custom-select.restricted-price")&&app.tabs.productBulkEditor.changeCustomSelect(b,"restricted-price",c,m),"except_selected"==c?b.find(".restrict-price-except-select-customer").show():b.find(".restrict-price-except-select-customer").hide(),
a(b,".restrict-price-except-select-customer","restrictPriceExceptCustomer","restrictPriceExceptCustomerGroup")):b.is(".custom-select.restricted-purchase")&&(app.tabs.productBulkEditor.changeCustomSelect(b,"restricted-purchase",c,m),"except_selected"==c?b.find(".restrict-purchase-except-select-customer").show():b.find(".restrict-purchase-except-select-customer").hide(),a(b,".restrict-purchase-except-select-customer","restrictPurchaseExceptCustomer","restrictPurchaseExceptCustomerGroup"));null!=c&&
d.activePanel().setDirty()};app.tabs.productBulkEditor.changeTracking=function(a,b,c){if(b){var f="true"==b?"false":b;a.parents("tbody").find("td.disable-tracking").each(function(){var a=$(this);a.find("input[type=hidden]").val(b);a.find(".value").html(b);a.find(".status").removeClass(d.status[f]).addClass(d.status[b]).refreshTooltip(c)})}};app.tabs.productBulkEditor.changeCustomSelect=function(a,b,c,d){c="false"==c?"":c;a.parents("tbody").find("td."+b).each(function(){var a=$(this);a.find("input[type=hidden]").val(c);
a.find(".value").html(c);a.find(".disp-value").html(c?d:c)})};app.tabs.productBulkEditor.changeAvailability=function(a,b,c){if(b){var f="true"==b?"false":b;a.parents("tbody").find("td.is-available").each(function(){var a=$(this);a.find("input[type=hidden]").val(b);a.find(".value").html(b);a.find(".status").removeClass(d.status[f]).addClass(d.status[b]).refreshTooltip(c)})}};app.tabs.productBulkEditor.changeAadministrativeStatus=function(a,b,c){if(b){var f="true"==b?"false":b;a.parents("tbody").find("td.is-active").each(function(){var a=
$(this);a.find("input[type=hidden]").val(b);a.find(".value").html(b);a.find(".status").removeClass(d.status[f]).addClass(d.status[b]).refreshTooltip(c)})}};app.tabs.productBulkEditor.afterCellEdit=function(a,b,c){c=a.find(".td-full-width");var d=c.attr("validation");if(a.is(".editable")&&d){if(d=ValidationField.validateAs(c,d))return bm.notify($.i18n.prop(d.msg_template,d.msg_params),"error"),app.tabs.productBulkEditor.errorHighlight(c),!1;if(d=a.attr("unique")){var f=!0;a.parents("tbody").find("td."+
d).each(function(){$(this).find("input[type=hidden]").val().trim()==b.trim()&&(f=!1)});if(!f)return bm.notify($.i18n.prop("for.already.exists",[b,$.i18n.prop(d)]),"error"),app.tabs.productBulkEditor.errorHighlight(c),!1}}a.is(".custom-edit")&&(a.find(".value").hide(),b&&(c="0",a.is(".base-price")?c="base-price":a.is(".min-order-quantity")?c="min-order-quantity":a.is(".custom-edit")&&a.attr("extra-attr")&&(c=a.attr("extra-attr")),app.tabs.productBulkEditor.changeAllValues(a,c,b)));a.is(".editable.name")?
app.tabs.productBulkEditor.changeAllNameHeading(a,"name",b):a.is(".editable.heading")&&app.tabs.productBulkEditor.changeAllNameHeading(a,"heading",b);a.find("input[type=hidden]").val(b)};app.tabs.productBulkEditor.changeAllNameHeading=function(a,b,c){a=a.find("input[name$="+b+"]").attr("name");d.allPanel().find("input[name='"+a+"']").parent("td").each(function(){var a=$(this);a.find(".value").html(c);a.find("input[type=hidden]").val(c)})};app.tabs.productBulkEditor.changeAllValues=function(a,b,c){a.parents("tbody").find("td."+
b).each(function(){var a=$(this);a.find("input[type=hidden]").val(c);a.find(".value").html(c)})};app.tabs.productBulkEditor.errorHighlight=function(a){var b=d.activePanel().find(".submit-button");b.attr("disabled",!0);a.addClass("error-highlight");setTimeout(function(){a.removeClass("error-highlight");b.removeAttr("disabled")},1E3)};app.tabs.productBulkEditor.getDropDown=function(a,b){a=d.activePanel().find("input[name="+a+"]").val();a=$.parseJSON(a);var c=$("<select><option value=''>"+$.i18n.prop(b?
b:"select")+"</option></select>");$.each(a,function(a,b){c.append("<option value='"+b.id+"'>"+b.name+"</option>")});return c};app.tabs.productBulkEditor.attachParentDropDown=function(){function a(a){b.table.find("td.parent").each(function(){function c(){l.position({my:"left top",at:"left top",of:f,collision:"none",within:b.table});l.width(f.outerWidth(),!0);l.height(f.outerHeight(),!0)}var f=$(this),e=a.filter("."+f.attr("parent")),g=d.body.find("#bmui-tab-basic table.content"),l=$("<div class='bulkedit-parent-td-proxy chosen-wrapper' style='position: absolute'></div>").appendTo(g);
l.append(e);c();d.body.find(".bmui-tab-body-container").on("scroll",function(){l.height(f.outerHeight(),!0)});e.chosen();e=l.find(".chosen-choices");e.scrollbar();e.css({"max-height":f.outerHeight()});f.parents("tr").on("heightChange",function(){c()})})}var b=d.tab_objs.basic,c;c?a(c):bm.ajax({url:app.baseUrl+"productAdmin/loadProductBulkProperties",dataType:"html",data:{ids:b.ids,property:"parent-dom"},success:function(b){c=$(b);a(c)}})}});
app.tabs.productBulkEditor=function(){app.tabs.productBulkEditor._super.constructor.apply(this,arguments);this.text=$.i18n.prop("product.bulk.edit");this.tip=$.i18n.prop("product.bulk.edit");this.ui_class="product-bulk-editor edit";this.ids=JSON.stringify(this.productIds);this.ajax_url=app.baseUrl+"productAdmin/loadProductBulkEditor?ids="+this.ids;this.tab_objs={}};_be=app.tabs.productBulkEditor.inherit(app.MultiTab);
_be.init=function(){this.body.find(".bmui-tab");app.tabs.productBulkEditor._super.init.apply(this,arguments)};_be.changeTabUrl=function(a,b){this.body.find(".bmui-tab").tabify("reload",a,b)};
_be.onContentLoad=function(a){var b=a.index,d=app.tabs.productBulkEditor[b.capitalize()];if(d){d=new d(a.panel,this);this.tab_objs[b]=d;d.ids=this.ids;d.init();var c=a.panel.find(".bulk-editor-form");c.find(".submit-button").on("click",function(){var a=c.serializeObject();bm.ajax({url:c.attr("action"),data:a,success:function(a){app.global_event.trigger("product-update");app.global_event.trigger("product-bulk-updated-"+b)},error:function(a,b,c){bm.notify(c.message,"error")}})})}};
_be.close=function(a){$("body").find(".bulkedit-parent-td-proxy").remove();app.tabs.productBulkEditor._super.close.call(this)};
_be.save=function(a){var b=this,d={};$.each(b.panels,function(a,b){b.isDirty&&(d[a]=b)});var c=1,f=Object.keys(d).length,g=!1;f||b.close(!0);bm.iterate(d,function(d,l){l=l.toString();var m=this;m.trigger("before-editor-close",a);var q=m.find(".bulk-editor-form"),e=q.serializeObject();bm.ajax({url:q.attr("action"),data:e,success:function(){app.global_event.trigger("product-update",[b.ids]);m.clearDirty();!b.isDirty()&&a?a():d.next();g&&b.close(!0)},error:function(){b.setActiveTab(l);d.next()},invalid:function(){b.setActiveTab(l);
m.find("form").valid("position");d.next()}});c==f&&(g=!0);c++})};_be.activePanel=function(){var a;$.each(this.panels,function(b,d){d.is(":visible")&&(a=d)});return a};_be.allPanel=function(){return this.body.find(".bmui-tab-panel")};_be.status={true:"positive",false:"negative"};
bm.onReady(app.tabs,"productBulkEditor",function(){var a,b;app.tabs.productBulkEditor.PriceStock=function(c,d){a=c;b=d};var d=app.tabs.productBulkEditor.PriceStock.prototype;d.reload=function(){this.tabulator.reload()};d.afterTableReload=function(){a.clearDirty();this.attachEvent()};d.attachEvent=function(){var b=this;a.find(".change-all.on-sale .fake-link").on("click",function(){b.changeAllOnSale($(this))})};d.init=function(){var c=this;b.body.find(".toolbar-item.reload").on("click",function(){c.reload()});
app.global_event.on("product-bulk-updated-priceStock",function(){c.reload()});this.tabulator=bm.table($(a.find(".product-bulk-edit-tab.price-stock-table")),{url:app.baseUrl+"productAdmin/loadProductBulkProperties",beforeReloadRequest:function(){c.beforeReloadRequest(this.param)},afterLoad:function(){a.tool.filter(".action-header:visible").hide();c.table.tscrollbar("content");c.afterTableReload&&c.afterTableReload()},selectableCellSelect:app.tabs.productBulkEditor.selectableCellSelect,afterCellSelect:app.tabs.productBulkEditor.afterCellSelect,
afterCellEdit:app.tabs.productBulkEditor.afterCellEdit});c.beforeReloadRequest=function(a){$.extend(a,{property:"price-stock",ids:this.ids})};this.table=a.find(".body table");c.attachEvent()};d.changeAllOnSale=function(b){var c=this,d=c.saleFormData||{};bm.editPopup(app.baseUrl+"productAdmin/loadChangeAllOnSale",$.i18n.prop("change.all.on.sale"),void 0,d,{beforeSubmit:function(b,f,g){d=c.saleFormData=b.serializeObject();var l=d.isOnSale,e=d.salePrice;c.table.find(".data-row .on-sale").each(function(){var a=
$(this),b=a.find(".disp-value");a.find("input[type=hidden]").val(l);a.find(".value").html(l);"true"==l?(a.find(".sale-price").val(parseFloat(e).toFixed(2)),b.removeClass("false").addClass("true").html(e)):b.removeClass("true").addClass("false").html($.i18n.prop("no"))});g.close();a.setDirty();return!1}})}});
bm.onReady(app.tabs,"productBulkEditor",function(){var a,b;app.tabs.productBulkEditor.Webtool=function(c,d){a=c;b=d};var d=app.tabs.productBulkEditor.Webtool.prototype;d.reload=function(){this.tabulator.reload()};d.afterTableReload=function(){a.clearDirty()};d.init=function(){var c=this;b.body.find(".toolbar-item.reload").on("click",function(){c.reload()});app.global_event.on("product-bulk-updated-webtool",function(){c.reload()});this.tabulator=bm.table($(a.find(".product-bulk-edit-tab.webtool-table")),
{url:app.baseUrl+"productAdmin/loadProductBulkProperties",beforeReloadRequest:function(){c.beforeReloadRequest(this.param)},afterLoad:function(){a.tool.filter(".action-header:visible").hide();c.table.tscrollbar("content");c.afterTableReload&&c.afterTableReload()},selectableCellSelect:app.tabs.productBulkEditor.selectableCellSelect,afterCellSelect:app.tabs.productBulkEditor.afterCellSelect,afterCellEdit:app.tabs.productBulkEditor.afterCellEdit});c.beforeReloadRequest=function(a){$.extend(a,{property:"webtool",
ids:this.ids})};this.table=a.find(".body table")}});
bm.onReady(app.tabs,"edit_content",function(){bm.onReady(app.tabs.edit_content,"page",function(){app.tabs.edit_content.product_page=function(a){a.containerType="product-page";b.constructor.apply(this,arguments);this.ajax_url=app.baseUrl+"productAdmin/editProductPage?id="+a.containerId};var a=app.tabs.edit_content.product_page.inherit(app.tabs.edit_content.page),b=app.tabs.edit_content.product_page._super;a.widgetClass="product-widget";a.contentSaveUrl="productWidget/save";a.modifyFavoriteWidgetUrl=
app.baseUrl+"app/modifyFavoriteProductWidget";a.getWidgetTag=function(a,b){return"<wi:productwidget type='"+b+"'/>"};a.populateWidgetSelector=function(){this.widgetSelector.find("option").remove();var a=this.activeSection.find(this.supportedWidgetSelector).not("."+this.widgetClass+" ."+this.widgetClass),b=[];b.push("<option value=''>"+$.i18n.prop("active.section.widgets")+"</option>");$.each(a,function(){var a=$(this),c=a.attr("widget-type"),d=a.attr("id");d||(d="wi-"+bm.getUUID(),a.attr("id",d));
b.push("<option value='"+d+"'> "+c+"-"+d.substring(3)+" </option>")});for(a=0;a<b.length;a++)this.widgetSelector.append($(b[a]));this.widgetSelector.trigger("chosen:updated")};a.getEmptyWidgetDom=function(a){return"<div class='"+this.widgetClass+" widget-"+a+"' widget-type='"+a+"'> "+$.i18n.prop(a.minusCase())+" "+$.i18n.prop("widget")+" </div>"};a.updateSidebar=function(a,b){};a.getWidgetRenderAjaxIOptions=function(a){a.controller="productWidget";return a}})});
app.editProduct=function(a,b){this.itemTab=a;this.product=b;app.editProduct._super.constructor.call(this,arguments)};
(function(){function a(){var a=this;this.on_global(["tax-profile-create","tax-profile-update","tax-profile-delete"],function(){a.tabs["price-quantity"]&&bm.updateDomainSelector(a.tabs["price-quantity"].find("select[name='taxProfile']"),"webcommerce.TaxProfile")});this.on_global(["brand-create","brand-update","brand-delete"],function(){a.tabs.basic&&bm.updateDomainSelector(a.tabs.basic.find("select[name='brand']"),"webcommerce.Brand")});this.on_global(["manufacturer-create","manufacturer-update","manufacturer-delete"],
function(){a.tabs.basic&&bm.updateDomainSelector(a.tabs.basic.find("select[name='manufacturer']"),"webcommerce.Manufacturer")});this.on_global(["category-create","category-update","category-delete"],function(){bm.updateCategorySelector(a.body.find(".category-selector"),"webcommerce.Category")})}function b(a,b,c,d){a.find(b).on("click",function(){bm.customerAndGroupSelectionPopup(a,{customerField:c,groupField:d})})}var d=app.editProduct.inherit(app.MultiTab),c=app.editProduct._super;d.changeHeader=
!1;d.init=function(){var b=this;b.itemTab.renderCreatePanel(app.baseUrl+"productAdmin/loadProductEditor",$.i18n.prop("edit.product"),b.product.name,{id:b.product.id},{createPanelTemplate:$('<div class="embedded-edit-form-panel create-panel fade-in-up"><div class="header"><span class="header-title"></span><span class="toolbar toolbar-right"><span class="tool-group toolbar-btn save save-all">'+$.i18n.prop("save.all")+'</span><span class="tool-group toolbar-btn cancel">'+$.i18n.prop("cancel")+'</span></span></div><div class="body"></div></div>'),
ajax:{show_success_status:!1},submit_n_cancle:!1,scrollable:!1,content_loaded:function(d){b.body=this;b.header=this.find(".header");c.init.apply(b,arguments);a.call(b)}})};app.editProduct.tabInitFunctions={basic:function(a){var c=a.find("form");b(c,".select-customer","customer","customerGroup");c=bm.getUUID();a.find("#prodAvailFrom").attr("id",c);a.find("#prodAvailTo").attr("validation","skip@if{self::hidden} either_required["+c+","+$.i18n.prop("from")+" ,"+$.i18n.prop("to")+"]")},advanced:function(a){bm.metaTagEditor(a)},
combined:function(a){var b=a.find("select.product-combined-select"),c=a.find(".sort-panel");b.on("change",function(){c.empty();var a=b.val();$.each(a,function(a,d){a=b.find("[value='"+d+"']").text();d=$("<div class='form-row'><label>"+a+"</label><input type='hidden' name='products' value='"+d+"'><input type='text' name='alias'></div> ");c.append(d)})});c.sortable()},"price-quantity":function(a){var c=a.find("form");b(c,".restrict-price-except-select-customer","restrictPriceExceptCustomer","restrictPriceExceptCustomerGroup");
b(c,".restrict-purchase-except-select-customer","restrictPurchaseExceptCustomer","restrictPurchaseExceptCustomerGroup");a.find(".view-inventory-history").on("click",function(){var a=$(this).attr("product-id"),b=app.baseUrl+"productAdmin/inventoryHistory",c=$.i18n.prop("inventory.history");bm.editPopup(b,c,"",{id:a},{width:850,success:function(){},events:{content_loaded:function(){var c=$(this),d=function(){var e=c.find(".pagination").obj();e&&(e.onPageClick=function(e){bm.ajax({url:b,data:{id:a,offset:5*
(e-1)},dataType:"html",success:function(a){c.find(".content").html($(a)).updateUi();d()}})})};d()}}})})},"image-video":function(a,b){var c=this;a.save=function(d){a.reload=function(){};var f=a.find("form.edit-popup-form"),g=f.length;bm.iterate(f,function(e,f){function l(){f+1==g?(b.clearDirty(),d()):e.next()}var m=$(this);m.is(".submitting")?l():m.form("submit",{ajax:{show_success_status:!1},success:l,error:function(){c.setActiveTab("image-video")},invalid:function(){c.setActiveTab("image-video");
a.find("form").valid("position")}})})};a.find("form.edit-popup-form").each(function(){var c=$(this);c.is(".image-form")?app.editProduct.tabInitFunctions.image.call(this,c,b):c.is(".video-form")?app.editProduct.tabInitFunctions.video.call(this,c):c.is(".downloadable-spec-form")&&app.editProduct.tabInitFunctions.downloadableSpec.call(this,c,a)})},image:function(a,b,c){function d(a){var b=a.attr("data-id");$("<input type='hidden' name='remove-images' value='"+b+"'>").appendTo(a.closest("form"));a.trigger("change").remove();
e.scrollbar("update")}function f(a){var d={};d.cache=a.attr("update_cache");d.id=a.attr("data-id");$.each($(".product-image-wrapper").find("input[name='altText']"),function(){$(this).attr("img-id")==d.id&&(d.altText=$(this).val())});bm.editPopup(app.baseUrl+(c?c:"productAdmin/editImage"),$.i18n.prop("edit.alternative.text"),"",d,{width:450,beforeSubmit:function(a,c,e){a=a.serializeArray();var f={};$.each(a,function(a,b){f[b.name]=b.value});$.each($(".product-image-wrapper").find("input[name='altText']"),
function(){$(this).attr("img-id")==d.id&&$(this).remove()});$.each($(".product-image-wrapper").find("input[name='altTextId']"),function(){this.value.equals(d.id)&&$(this).remove()});a=$('<input type="hidden" img-id='+f.id+' name="altText" value="'+f.altText+'"><input type="hidden" name="altTextId" value="'+f.id+'">');$(".product-image-wrapper").append(a);e.close();b.setDirty();return!1}})}var g=[{text:$.i18n.prop("alt.text"),ui_class:"edit",action:"altText"},{text:$.i18n.prop("remove"),ui_class:"delete",
action:"remove"}],e=a.find(".product-image-container");bm.menu(g,a,".float-menu-navigator",function(a,b){b=b.parent();switch(a){case "remove":d(b);break;case "altText":f(b)}},"click",["left top+1","right+20 top+5"]);e.find(".remove").on("click",function(){var a=$(this).closest(".image-thumb");d(a)});e=e.find(".one-line-scroll-content").scrollbar({show_vertical:!1,show_horizontal:!0,use_bar:!1,visible_on:"auto",horizontal:{handle:{left:e.find(".left-scroller"),right:e.find(".right-scroller")}}});e.hover(function(){e.scrollbar("update")});
$(window).on("resize."+this.id,function(){e.scrollbar("update")});e.sortable({axis:"x",placeholder:!0,handle:".image-thumb",stop:function(){e.trigger("change")},sort:function(){b.setDirty()}})},video:function(a){$.i18n.prop("remove");var b=a.find(".product-video-container");b=b.find(".one-line-scroll-content").scrollbar({show_vertical:!1,show_horizontal:!0,use_bar:!1,visible_on:"auto",horizontal:{handle:{left:b.find(".left-scroller"),right:b.find(".right-scroller")}}});$(window).on("resize."+this.id,
function(){b.scrollbar("update")});b.find(".remove").on("click",function(){var a=$(this).closest(".image-thumb"),c=a.attr("data-id");$("<input type='hidden' name='remove-videos' value='"+c+"'>").appendTo(a.closest("form"));a.trigger("change").remove();b.scrollbar("update")})},downloadableSpec:function(a,b){function c(c){c.find(".tool-icon.remove").click(function(){$("<input type='hidden' name='remove_spec' value='true'>").appendTo(a);c.children().remove();c.css("display","none");b.setDirty()})}var d=
a.find(".spec-file-block");a.find("input[type=file]").on("file-add",function(b,f){d=a.find(".spec-file-block");b=f.name;f='<div class="spec-file-block"><span class="file #EXTENTION#"><span class="tree-icon"></span></span><span class="name">#FILENAME#</span><span class="tool-icon remove" file-name="#FILENAME#"></span></div>';b.length&&(b=b.split("."),f=f.replaceAll("#EXTENTION#",b[b.length-1]),d.replaceWith(f.replaceAll("#FILENAME#",b.join("."))),a.find("input[name=remove_spec]").remove(),c(a.find(".spec-file-block")))});
c(d)},relatedProducts:function(a){bm.initProductSelection(a,"related")},includedProducts:function(a){var b=bm.initProductSelection(a,"included"),c=a.find("input[name=isFixed]").val(),d=a.find("input[name=isDownloadable]").val(),f=b.beforeLoadTableContent;b.beforeLoadTableContent=function(a){f(a);a.notCombined=!0;a.isDownloadable=d};b.onNewSelection=function(a){var b=a.find("td").first(),f='<div class="form-row"><label>'+$.i18n.prop("label")+'</label><input type="text" class="medium" name="label" value="'+
b.text()+'"></div>',g='<div class="form-row"><label>'+$.i18n.prop("quantity")+'</label> <input type="text" name="quantity" class="tiny spinner" min="1" value="1" validation="number" restric="numeric"></div>',l='<div class="form-row"><label>'+$.i18n.prop("price")+'</label> <input type="text" validation="number" name="price" restrict="decimal"></div>';b.text("");b.append(f);"true"!=d&&b.append(g);"true"!=c&&(l=$(l),a.find("td").first().append(l),a.find("input[name=price]").decimal(),a.find("input[name=quantity]").numeric());
a.updateUi()};b.resetRightPanel=function(a,b,c){var d=a.find("td.actions-column");b.each(function(){var a=$(this);d.find("input[value="+a.attr("item")+"]").parent().length||a.parent().remove()});c&&c()}},productFile:function(a){function b(b){b.find(".tool-icon.remove").click(function(){$("<input type='hidden' name='fileRemoved' value='true'>").appendTo(a.find("form"));b.children().remove();a.setDirty()})}app.global_event.on("product-update",function(){a.reload()});var c=a.find(".product-file-block");
a.find("input[type=file]").on("change",function(){var d=$(this).val().split("/").pop().split("\\").pop();if(d.length){var f=d.split(".");d='<div class="product-file-block"><span class="file #EXTENTION#"><span class="tree-icon"></span></span><span class="name">#FILENAME#</span><span class="tool-icon remove" file-name="#FILENAME#"></span></div>'.replaceAll("#EXTENTION#",f[f.length-1]).replaceAll("#FILENAME#",d);d=$(d);b(d);c.replaceWith(d);c=d;a.find("input[name=fileRemoved]").remove()}});b(c)}};d.onContentLoad=
function(a,b){var c=this;a.panel.find("form").form({ajax:{success:function(){app.global_event.trigger("product-update",[c.product.id]);if("price-quantity"==a.index||"image-video"==a.index)"image-video"==a.index&&app.global_event.trigger("product-image-video-update",[c.product.id]),a.panel.reload();a.panel.clearDirty()}}});if("function"==typeof app.editProduct.tabInitFunctions[a.index]&&(app.editProduct.tabInitFunctions[a.index].call(this,a.panel,b),"price-quantity"==a.index))this.on_global("variation-status-update",
function(){a.panel.reload()})}})();app.tabs.simpleCss=function(a,b){this.tab=a;this.parser=b};_s=app.tabs.simpleCss.prototype;var mask=$("<div class='layout-mask'></div>");
(function(){function a(){var a=this;this.rulePanel.find(".button-add-new-rule").click(function(){var b=a.rulePanel.find(".input-add-new-rule"),c=b.val();b.val("");""!=c&&(b=c.split(","),b=void 0==a.selectedMedia?a.parser.addRule(b,[]):a.selectedMedia.addRule(b,[]),a.ruleList.find(".selected").removeClass("selected"),c=a.buildRuleItem(b),c.addClass("selected"),a.ruleList.append(c),a.selectedRule=b,a.buildAttributes([]),a.tab.setDirty())});this.mediaPanel.find(".button-add-new-media").click(function(){var b=
a.mediaPanel.find(".add-new-media [name='max-width']"),c=a.mediaPanel.find(".add-new-media [name='min-width']"),f=b.val(),g=c.val();b.val("");c.val("");if(!f&&!g)return!1;b=a.buildMediaDefinition(f,g);b=a.parser.addMedia(b,[]);c=a.mediaList.find(".media").length;c=a.buildMediaItem(b,c);a.mediaList.append(c);c.updateUi();a.selectedMedia=b;a.mediaList.find(".selected").removeClass("selected");c.addClass("selected");a.buildRules([]);a.tab.setDirty()});this.tab.body.find(".button-add-new-attribute").click(function(){if(void 0==
a.selectedRule)bm.notify($.i18n.prop("no.rule.selected"),"error");else{var b=a.tab.body.find(".input-add-new-attribute").val();""!=b&&(a.tab.body.find(".input-add-new-attribute").val(""),b=a.getAttributeObject(b),0==Object.keys(b).length?bm.notify($.i18n.prop("attribute.entry.not.in.format"),"error"):(a.selectedRule.addAttribute(b.key,b.value),a.buildAttributes(a.selectedRule.attributes),a.tab.setDirty()))}});this.tab.body.find(".attribute-panel").on("tab:activate",function(b,c){void 0!=a.selectedRule&&
("text"==c.newIndex?(a.attrTextArea.val(""),a.setAttributeText(a.selectedRule.attributes)):(b=a.attrTextArea.val(),b=a.getAttributeObjects(b),a.selectedRule.attributes=b,a.buildAttributes(b)))});this.tab.body.find(".input-add-new-rule, .input-add-new-attribute, [name=min-width], [name=max-width]").on("keydown",function(a){if(13==a.keyCode)return $(this).siblings(".add-new-entry").trigger("click"),!1});this.attrTextArea.on("change",function(){var b=a.attrTextArea.val();b=a.getAttributeObjects(b);a.selectedRule.attributes=
b;a.tab.setDirty()})}_s.init=function(){var b=this;this.mediaPanel=this.tab.body.find(".media-panel");this.rulePanel=this.tab.body.find(".rule-panel");this.mediaList=this.tab.body.find(".medias").sortable({containment:"parent",tolerance:"intersect",items:"div:not(.global)",change:function(a,c){b.move(b.parser.rulesets,c,"media")}});this.ruleList=this.tab.body.find(".rules").sortable({containment:"parent",tolerance:"intersect",stop:function(a,c){b.move(void 0==b.selectedMedia?b.parser.rulesets:b.selectedMedia.rulesets,
c,"rule")}});this.attrList=this.tab.body.find(".attribute-list");this.attrList.sortable({containment:"parent",tolerance:"intersect",stop:function(a,c){b.move(b.selectedRule.attributes,c,"attr")}}).scrollbar();this.attrTextArea=this.tab.body.find(".attr-panel-text .attr-text");this.mediaPanel.find("input[name='max-width'], input[name='min-width']").decimal();this.buildMedias();a.call(this);this.tab.body.find(".css-entry-list").scrollbar()}})();
_s.buildGlobal=function(){var a=this,b=$('<div class="media css-entry even global"><span class="label">&lt;'+$.i18n.prop("no.selector")+"&gt;</span>");b.bind("click",function(d){a.getRulesForMedia(void 0,a.getRuleForGlobal());b.addClass("selected")});this.selectedMedia=void 0;this.mediaList.append(b);b.addClass("selected");this.buildRules(a.getRuleForGlobal())};
_s.buildMedias=function(){this.mediaList.empty().scrollbar();this.buildGlobal();for(var a=this.parser.rulesets,b=1,d=0;d<a.length;d++)if("media"==a[d].type){var c=this.buildMediaItem(a[d],b);this.mediaList.append(c);b++}};
_s.buildMediaItem=function(a){var b=this,d='<div class="media css-entry"><span class="label">'+a.definition+"</span><span class='editor-buttons'>";a.definition.match(/(max|min)-width/)&&(d+="<span class='edit-media-item tool-icon edit' title='"+$.i18n.prop("edit")+"'></span>",d+="<span style='display: none;' class='update-media-item tool-icon update' title='"+$.i18n.prop("update")+"'></span>");d+="<span class='remove-media-item tool-icon remove' title='"+$.i18n.prop("remove")+"'></span></span></div>";
var c=$(d);c.data("media",a);c.bind("click",function(d){d=$(d.target);d.is(".remove-media-item")?b.removeMedia(c,a):d.is(".edit-media-item")?b.editMedia(c,a,d):d.is(".update-media-item")?b.updateMedia(c,a,d):(b.getRulesForMedia(a,a.rulesets),c.addClass("selected"))});return c};
_s.buildRuleItem=function(a){var b=this,d=$('<div class="rule css-entry"><span class="label">'+a.selectors.join(",")+"</span><span class='editor-buttons'><span class='add-rule-item tool-icon edit' title='"+$.i18n.prop("edit")+"'></span><span class='remove-rule-item tool-icon remove' title='"+$.i18n.prop("remove")+"'></span></span></div>"),c=d.find(".label");d.data("rule",a);d.bind("click",function(f){f=$(f.target);f.is(".add-rule-item")?b.editRule(c,f,a):f.is(".remove-rule-item")?b.removeRule(c,a):
b.getAttributesForRule(d,a)});d.updateUi();return d};_s.buildRules=function(a){this.ruleList.empty().scrollbar();this.attrList.empty().scrollbar();this.attrTextArea.val("");this.selectedRule=void 0;for(var b=0;b<a.length;b++)if("rule"==a[b].type){var d=this.buildRuleItem(a[b],b);0==b&&(this.selectedRule=a[b],d.addClass("selected"),this.buildAttributes(a[b].attributes));this.ruleList.append(d)}};
_s.getRuleForGlobal=function(){for(var a=[],b=0;b<this.parser.rulesets.length;b++)"rule"==this.parser.rulesets[b].type&&a.push(this.parser.rulesets[b]);return a};
_s.buildAttributeItem=function(a,b){var d=this,c=$('<div class="attr css-entry"><span class="label"><span class="attr-key">'+a.key+'</span><span class="colon"> : </span><span class="attr-value">'+a.value+"</span></span><span class='editor-buttons'><span class='edit-attr-item tool-icon edit' title='"+$.i18n.prop("edit")+"'></span><span class='remove-attr-item tool-icon remove' title='"+$.i18n.prop("remove")+"'></span></span></div>");c.data("attr",a);c.bind("click",function(b){b=$(b.target);b.is(".edit-attr-item")?
d.editAttribute(c,b):b.is(".remove-attr-item")&&d.removeAttribute(c,a)});return c};_s.buildAttributes=function(a){this.attrTextArea.val("");this.attrList.empty().scrollbar();this.setAttributeText(a);for(var b=0;b<a.length;){var d=this.buildAttributeItem(a[b],b);b++;this.attrList.append(d)}};_s.getRulesForMedia=function(a,b){this.selectedMedia!=a&&(this.mediaPanel.find(".media.selected").removeClass("selected"),this.selectedMedia=a,this.buildRules(b))};
_s.getAttributesForRule=function(a,b){this.attrTextArea.trigger("change");a.hasClass("selected")||(this.ruleList.find(".selected").removeClass("selected"),this.selectedRule=b,a.addClass("selected"),this.buildAttributes(b.attributes))};
_s.editAttribute=function(a,b){var d=a.find(".attr-key"),c=a.find(".attr-value"),f=a.data("attr");b.hasClass("edit")?(b.removeClass("edit").addClass("update"),a.find(".label, .remove-attr-item").hide(),a.prepend("<input type='text' class='input-add-attr-item'' value='"+f.key+" : "+f.value+"'>")):(b.removeClass("update").addClass("edit"),b=a.find(".input-add-attr-item").val(),a.find(".input-add-attr-item").remove(),a.find(".label, .remove-attr-item").show(),a=this.getAttributeObject(b),f.key=a.key,
f.value=a.value,d.html(f.key),c.html(f.value),this.tab.setDirty())};_s.removeAttribute=function(a,b){var d=this.selectedRule.attributes;b=d.indexOf(b);d.splice(b,1);a.remove();this.tab.setDirty()};_s.setAttributeText=function(a){for(var b,d=0;d<a.length;){var c=a[d].key+" : "+a[d].value+";";b=""==this.attrTextArea.val()?c:"\n"+c;this.attrTextArea.val(function(a,c){return c+b});d++}};
_s.getAttributeObjects=function(a){var b=[];a.replace(/([^:]+)?:([^;]+);/g,function(a,c,f){b.push({key:c.trim(),value:f.trim()})});return b};_s.getAttributeObject=function(a){var b={};a.replace(/([^:]+)?:([^;]+)/,function(a,c,f){b.key=c.trim();b.value=f.trim()});return b};_s.moveAttr=function(a,b){var d=this.selectedRule.attributes,c=d.indexOf(a),f=d.length-1;b&&(f=d.indexOf(b)-1);d.splice(c,1);d.splice(f,0,a)};
_s.editRule=function(a,b,d){var c=a.parent(),f=c.find(".remove-rule-item");b.hasClass("edit")?(b.removeClass("edit").addClass("update"),b=d.selectors.join(","),a.hide(),f.hide(),c.prepend("<input type='text' class='input-add-rule-item'' value='"+b+"'>")):(b.removeClass("update").addClass("edit"),b=c.find(".input-add-rule-item").val(),d.selectors=b.split(","),c.find(".input-add-rule-item").remove(),a.show().html(b.toString()),f.show(),this.tab.setDirty())};
_s.removeRule=function(a,b){if(void 0==this.selectedMedia){this.parser.removeRule(b);var d=this.parser.rulesets}else this.selectedMedia.removeRule(b),d=this.selectedMedia.rulesets;a.parent().remove();this.selectedRule==b&&this.buildRules(d);this.tab.setDirty()};_s.move=function(a,b,d){var c=b.item,f=c[0].nextSibling,g=a.length-1;f&&(g=a.indexOf($(f).data(d)));b.offset.top>b.originalPosition.top&&f&&--g;b=$(c).data(d);d=a.indexOf(b);a.splice(d,1);a.splice(g,0,b)};
_s.removeMedia=function(a,b){a.remove();this.parser.removeMedia(b);a.hasClass("selected")&&(this.ruleList.empty().scrollbar(),this.attrList.empty().scrollbar(),this.buildMedias());this.tab.setDirty()};
_s.editMedia=function(a,b,d){b=a.find(".label, .remove-media-item, .edit-media-item");d=a.find(".update-media-item");b.hide();d.show();a.append("<span class='edit-media-inputs'><label>"+$.i18n.prop("min.width")+" </label><input type='text' name='min-width'>&nbsp;&nbsp;&nbsp;&nbsp;<label>"+$.i18n.prop("max.width")+" </label><input type='text' name='max-width'></span>");a.find("input[name='max-width'], input[name='min-width']").decimal()};
_s.updateMedia=function(a,b,d){d=a.find(".label, .remove-media-item, .edit-media-item");var c=a.find(".update-media-item");d.show();c.hide();d=a.find("input[name='max-width']");c=a.find("input[name='min-width']");var f=d.val(),g=c.val();d.val("");c.val("");a.find(".edit-media-inputs").remove();if(!f&&!g)return!1;d=this.buildMediaDefinition(f,g);b.definition=d;a.find(".label").html(d);this.tab.setDirty()};
_s.buildMediaDefinition=function(a,b){var d=new StringWriter;b?(d.plus("(min-width: "+b+"px)"),a&&d.plus(" and (max-width: "+a+"px)")):d.plus("(max-width: "+a+"px)");return d.toString()};app.widget.article=function(a){app.widget.article._super.constructor.apply(this,arguments)};_p=app.widget.article.inherit(app.widget.base);
_p.init=function(a){app.widget.article._super.init.call(this);this.content.find(".create-article").click(function(){app.tabs.content.editArticle()});var b=bm.initArticleSelection(this.content,"article",{tab:this.editor,edit:!0}),d=bm.getUUID();app.global_event.on("article-create."+d+" article-update."+d+" article-delete."+d,function(){b.reload()});a.on("close",function(){app.global_event.off("."+d)})};app.widget.cart=function(a){app.widget.cart._super.constructor.apply(this,arguments)};_c=app.widget.cart.inherit(app.widget.base);
_c.init=function(){app.widget.cart._super.init.call(this)};app.widget.category=function(a){app.widget.category._super.constructor.apply(this,arguments)};_c=app.widget.category.inherit(app.widget.base);
_c.init=function(a){app.widget.category._super.init.call(this);var b=bm.initCategorySelection(this.content,"category",{tab:this.editor,edit:!0}),d=bm.getUUID();app.global_event.on("category-create."+d+" category-update."+d+" category-delete."+d,function(){b.reload()});a.on("close",function(){app.global_event.off("."+d)})};
_c.afterContentChange=function(a){a=a.editor.iframeWindow.$(a.elm).find("paginator").paginator();a.showPages=a.showPages=800<window.innerWidth?app.config.number_block_in_paginator_count:app.config.number_block_in_paginator_count_800};app.widget.currency=function(a){app.widget.html._super.constructor.apply(this,arguments)};app.widget.currency.config_width=595;_c=app.widget.currency.inherit(app.widget.base);_c.init=function(){app.widget.currency._super.init.call(this)};
app.widget.gallery=function(a){app.widget.gallery._super.constructor.apply(this,arguments)};app.widget.gallery.config_width=715;_g=app.widget.gallery.inherit(app.widget.base);
_g.init=function(){app.widget.gallery._super.init.call(this);var a=this.content;a.find("[step]:not([step=1])").hide();a.find("button.previous-button").on("click",function(){var b=$(this).attr("previous");a.find("[step]").hide();a.find("[step="+b+"]").show()});a.find(".toolbar-btn.save").addClass("disabled").hide();this.attachFirstViewEvents();this.attachSecondViewEvents();this.attachThirdViewEvents()};
_g.attachFirstViewEvents=function(){var a=this,b=this.content,d=this.content.find(".gallery-widget-first-view"),c=this.content.find(".gallery-widget-second-view");d.form({disable_on_submit:!1,preSubmit:function(){var f=b.find("[name=galleryContentType]:checked").val();if(c.find(".gallery-content-config."+f).length)d.hide(),c.show();else return d.loader(),c.find(".gallery-content-config").remove(),bm.ajax({url:app.baseUrl+"galleryWidget/loadContentConfig",dataType:"html",data:{contentType:f,widgetId:a.widget.attr("widget-id"),
data:a.widget.data("data-cache")},success:function(b){b=$(b);c.prepend(b);b.updateUi();bm.autoToggle(b);a.afterContentConfigRender(f,b);d.loader(!1);d.hide();c.show()}}),!1}})};
_g.attachSecondViewEvents=function(){var a=this,b=this.content,d=this.content.find(".gallery-widget-second-view"),c=b.find(".gallery-widget-third-view"),f=b.find("[name='gallery']");d.form({preSubmit:function(){var g=b.find("[name=galleryContentType]:checked").val();!1!==a.beforePassSecondView(d)&&(d.loader(),bm.ajax({url:app.baseUrl+"galleryWidget/loadSupportedGallery",dataType:"html",data:{contentType:g,widgetId:a.widget.attr("widget-id"),data:a.widget.data("data-cache")},success:function(a){c.find(".gallery-types-container").html(a);
c.find(".gallery-item").click(function(){var a=$(this);a.addClass("selected").siblings().removeClass("selected");f.val(a.attr("gallery-name"))});d.hide();c.show();b.find("[name='gallery']").val(c.find(".gallery-item.selected").attr("gallery-name"));d.loader(!1)}}));return!1}})};
_g.attachThirdViewEvents=function(){var a=this,b=this.content,d=b.find(".toolbar-btn.save"),c,f=b.find("[name='gallery']");b.find(".gallery-widget-third-view").form({preSubmit:function(){if(c=f.val()){var g=b.find(".gallery-widget-third-view"),m=b.find(".gallery-widget-last-view"),l=m.find(".gallery-config-view");g.addClass("updating").loader();l.length&&l.find("[slider='"+c+"']").length?(g.hide(),m.show(),d.removeClass("disabled").show()):(l.remove(),bm.ajax({url:app.baseUrl+"widget/loadConfigForSlider",
dataType:"html",data:{gallery:c,widgetId:a.widget.attr("widget-id"),data:a.widget.data("data-cache")},success:function(c){m.html(c);d.removeClass("disabled").show();l=m.find(".gallery-config-view");l.updateUi();l.closest("form").form("append",l).form("set_submit",l.find("[type='submit']"));var f=l.find(".manual-advance-row");l.find("[name=controlNav], [name=directionNav]").on("change",function(){b.find("[name=controlNav]").val().bool()||b.find("[name=directionNav]").val().bool()?f.show():f.hide()});
l.find("[name=controlNav]").trigger("change");b.find(".previous").click(function(){l.remove();g.show();b.find(".body").scrollTop(0);d.addClass("disabled").hide()});b.find(".cancel-button").click(function(){a.popup.close()});g.removeClass("updating").loader(!1);g.hide();m.show()}}))}else bm.notify($.i18n.prop("no.gallery.selected"),"warning");return!1}})};
_g.afterContentConfigRender=function(a,b){"product"==a?bm.initProductSelection(b,"product",{edit:!0,tab:this.editor}):"category"==a?bm.initCategorySelection(b,"category",{edit:!0,tab:this.editor}):"brand"==a?bm.initBrandSelection(b,"brand",{edit:!0,tab:this.editor}):"manufacturer"==a?bm.initManufacturerSelection(b,"manufacturer",{edit:!0,tab:this.editor}):"article"==a&&bm.initArticleSelection(b,"article",{edit:!0,tab:this.editor})};
_g.afterContentChange=function(a,b,d){"string"==typeof b&&(b=JSON.parse(b),d=JSON.parse(b.params));if("nivoSlider"==d.gallery){d.directionNav||(d=JSON.parse(a.elm.find(".config-value-cache").val()));var c=a.editor.iframeWindow.$;bm.onReady(c.prototype,"nivoSlider",{ready:function(){var b,g;bm.ajax({dataType:"html",url:app.baseUrl+"app/siteMessage",data:{code:d.prevText},success:function(f){g=f;bm.ajax({dataType:"html",url:app.baseUrl+"app/siteMessage",data:{code:d.nextText},success:function(f){b=
f;c(a.elm).find(".gallery").nivoSlider({manualAdvance:d.directionNav.bool()||d.controlNav.bool()?d.manualAdvance.bool():!1,controlNav:d.controlNav.bool(),directionNav:d.directionNav.bool(),controlNavThumbs:d.controlNavThumbs.bool(),pauseOnHover:d.pauseOnHover.bool(),animSpeed:+d.animSpeed,effect:d.effect,prevText:g,nextText:b,slice:20,pauseTime:d.config_width})}})}})},not:function(){var b=a.editor.iframeWindow.$("head");b.append("<script src='"+app.systemResourceUrl+"galleries/nivoSlider/jquery.nivo.slider.pack.js' type='text/javascript'>\x3c/script>");
b.append('<link rel="stylesheet" type="text/css" href="'+app.systemResourceUrl+'galleries/nivoSlider/nivo-slider.css">')}})}};_g.beforePassSecondView=function(a,b){switch(b){case "album":return a.find("[name=album]").val()?!0:!1}};
_g.updateCacheForShortConfig=function(a,b){a=JSON.parse(a);if(a.params){var d=JSON.parse(a.params);$.extend(d,b)}else d=b;a.widgetContent&&0!=a.widgetContent.length||(a.widgetContent[0]={widget:{sid:a.sid},type:"album"});a.widgetContent[0].contentId=+d.album;delete d.album;a.params=JSON.stringify(d);return JSON.stringify(a)};app.widget.html=function(a){app.widget.html._super.constructor.apply(this,arguments)};app.widget.html.config_width=662;_c=app.widget.html.inherit(app.widget.base);
_c.init=function(){app.widget.html._super.init.call(this);var a=this.content;a.find("input:file").on("file-add",function(b,d){FileReader&&(b=new FileReader,b.onload=function(b){a.find("textarea").val(b.target.result)},b.readAsText(d))})};app.widget.image=function(a){app.widget.image._super.constructor.apply(this,arguments)};_p=app.widget.image.inherit(app.widget.base);
_p.init=function(){function a(a){var c=b.find("[name='"+a+"_url']").val(),d=b.find("#widget-image-preview");if("local"==a){a=b.find("[name='localImage']");var g;a.val()&&(g=window.FileReader?a[0].files[0]:b.data("form-extra-data").find("this.name=='localImage'").value);g&&window.FileReader&&(a=new FileReader,a.onload=function(a){d.attr("src",a.target.result)},a.readAsDataURL(g))}else d.attr("src",c).show()}app.widget.image._super.init.call(this);var b=this.content;b.find("[name='localImage']").on("change",
function(){var d=b.find(".local-image-upload");d.is(":checked")||d.radio("check").trigger("change",[!1]);a("local")});b.find("[name='direct_url']").ichange(function(){a("direct");var d=b.find(".direct-upload");d.is(":checked")||d.radio("check").trigger("change",[!1])});b.find(".select-from-asset-library").on("click",function(){var d=b.find(".asset-library-upload");d.is(":checked")||d.radio("check").trigger("change",[!1]);bm.selectFromAssetLibrary($.i18n.prop("select.your.image"),function(c){b.find("input[name='asset_library_url']").val(c);
a("asset_library")})});b.find(".asset-library-upload, .local-image-upload, .direct-upload").change(function(b,c){!1!==c&&a($(this).val())})};app.widget.login=function(a){app.widget.login._super.constructor.apply(this,arguments)};app.widget.login.inherit(app.widget.base);app.widget.navigation=function(a){app.widget.navigation._super.constructor.apply(this,arguments)};app.widget.navigation.config_width=500;_w=app.widget.navigation.inherit(app.widget.base);
_w.updateCacheForShortConfig=function(a,b){return app.widget.navigation._super.updateCacheForShortConfig.call(this,a,b,"navigation","navigation")};app.widget.news=function(a){app.widget.news._super.constructor.apply(this,arguments)};_n=app.widget.news.inherit(app.widget.base);app.widget.news.config_width=440;
app.widget.news.initShortConfig=function(a){a.find("[name='transition_speed']").slider({from:5,to:30,definition:"s",step:1});a.find("[name='transition_speed']").parent().on("click",".jslider-pointer:not(.jslider-pointer-to)",function(){$(this).closest(".widget-specific-config").trigger("change")})};
_n.afterContentChange=function(a){var b=a.editor.iframeWindow.$;bm.onReady(b.prototype,"newsticker",{ready:function(){b(a.elm).find(".news-list").newsticker()},not:function(){b("head").append('<script src="'+app.systemResourceUrl+"plugins/news/js/ui-widgets/newsticker.js\" type='text/javascript'>\x3c/script>")}})};app.widget.newsletter=function(a){app.widget.newsletter._super.constructor.apply(this,arguments)};app.widget.newsletter.inherit(app.widget.base);
app.widget.product=function(a){app.widget.product._super.constructor.apply(this,arguments)};_p=app.widget.product.inherit(app.widget.base);_p.init=function(a){app.widget.product._super.init.call(this);var b=bm.initProductSelection(this.content,"product",{tab:this.editor,edit:!0}),d=bm.getUUID();app.global_event.on("product-create."+d+" product-update."+d+" product-delete."+d,function(){b.reload()});a.on("close",function(){app.global_event.off("."+d)})};
_p.afterContentChange=function(a){a=a.editor.iframeWindow.$(a.elm).find("paginator").paginator();a.showPages=a.showPages=800<window.innerWidth?app.config.number_block_in_paginator_count:app.config.number_block_in_paginator_count_800};$(function(){app.global_event.on("before-render-product-widget-config",function(a,b,d){a=d.settingBlock.find(".widget-specific-config select.filter-by");a.length&&"none"!=a.val()&&(bm.notify($.i18n.prop("set.filter.by.none.for.config"),"alert"),b.status=!1)})});
app.widget.search=function(a){app.widget.search._super.constructor.apply(this,arguments)};app.widget.search.inherit(app.widget.base);app.widget.socialMediaLike=function(a){app.widget.socialMediaLike._super.constructor.apply(this,arguments)};app.widget.socialMediaLike.config_width=400;_s=app.widget.socialMediaLike.inherit(app.widget.base);
_s.updateCacheForShortConfig=function(a,b){a=JSON.parse(a);if(a.params){var d=JSON.parse(a.params);$.extend(d,b)}else d=b;b.socialMediaConfig||delete d.socialMediaConfig;a.params=JSON.stringify(d);return JSON.stringify(a)};app.widget.socialMediaLink=function(a){app.widget.socialMediaLink._super.constructor.apply(this,arguments)};_l=app.widget.socialMediaLink.inherit(app.widget.base);
_l.updateCacheForShortConfig=function(a,b){a=JSON.parse(a);if(a.params){var d=JSON.parse(a.params);$.extend(d,b)}else d=b;$.isArray(d.socialProfileName)||(d.socialProfileName=[d.socialProfileName],d.socialProfileLink=[d.socialProfileLink]);var c={};d.socialProfileName.every(function(a,b){d.socialProfileLink[a]&&(c[b]=d.socialProfileLink[a])});d.socialMediaConfig=c;delete d.socialProfileName;delete d.socialProfileLink;a.params=JSON.stringify(d);return JSON.stringify(a)};
app.widget.socialMediaShare=function(a){app.widget.socialMediaShare._super.constructor.apply(this,arguments)};_s=app.widget.socialMediaShare.inherit(app.widget.base);_s.afterContentChange=function(a){bm.onReady(a.editor.iframeWindow,"addthis",{ready:function(){a.elm.find(".social-media-share a").length&&a.editor.iframeWindow.addthis.toolbox("#"+a.elm.attr("id"))},not:function(){a.editor.iframeWindow.$("head").append('<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js">\x3c/script>')}})};
