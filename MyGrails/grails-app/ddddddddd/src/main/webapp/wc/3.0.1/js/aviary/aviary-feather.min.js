(function(e,t,a){var n=/\s+/,i=e.Events={on:function(e,t,a){var i,r,o;if(!t)return this;e=e.split(n),i=this._callbacks||(this._callbacks={});while(r=e.shift())o=i[r]||(i[r]=[]),o.push(t,a);return this},off:function(e,t,a){var i,r,o,s;if(!(r=this._callbacks))return this;if(!(e||t||a))return delete this._callbacks,this;e=e?e.split(n):_.keys(r);while(i=e.shift()){if(!(o=r[i])||!t&&!a){delete r[i];continue}for(s=o.length-2;s>=0;s-=2)t&&o[s]!==t||a&&o[s+1]!==a||o.splice(s,2)}return this},trigger:function(e){var t,a,i,r,o,s,l,c;if(!(a=this._callbacks))return this;c=[],e=e.split(n);for(r=1,o=arguments.length;r<o;r++)c[r-1]=arguments[r];while(t=e.shift()){if(l=a.all)l=l.slice();if(i=a[t])i=i.slice();if(i)for(r=0,o=i.length;r<o;r+=2)i[r].apply(i[r+1]||this,c);if(l){s=[t].concat(c);for(r=0,o=l.length;r<o;r+=2)l[r].apply(l[r+1]||this,s)}}return this}}})(window["AV"]||(window["AV"]={}),window,document);typeof AV=="undefined"&&(AV={}),AV.JSON={},function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var a,n,i,r,o=gap,s,l=t[e];l&&typeof l=="object"&&typeof l.toJSON=="function"&&(l=l.toJSON(e)),typeof rep=="function"&&(l=rep.call(t,e,l));switch(typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";gap+=indent,s=[];if(Object.prototype.toString.apply(l)==="[object Array]"){r=l.length;for(a=0;a<r;a+=1)s[a]=str(a,l)||"null";return i=s.length===0?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+o+"]":"["+s.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){r=rep.length;for(a=0;a<r;a+=1)n=rep[a],typeof n=="string"&&(i=str(n,l),i&&s.push(quote(n)+(gap?": ":":")+i))}else for(n in l)Object.hasOwnProperty.call(l,n)&&(i=str(n,l),i&&s.push(quote(n)+(gap?": ":":")+i));return i=s.length===0?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+o+"}":"{"+s.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof AV.JSON.stringify!="function"&&(AV.JSON.stringify=function(e,t,a){var n;gap="",indent="";if(typeof a=="number")for(n=0;n<a;n+=1)indent+=" ";else typeof a=="string"&&(indent=a);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("AV.JSON.stringify")}),typeof AV.JSON.parse!="function"&&(AV.JSON.parse=function(text,reviver){function walk(e,t){var a,n,i=e[t];if(i&&typeof i=="object")for(a in i)Object.hasOwnProperty.call(i,a)&&(n=walk(i,a),n!==undefined?i[a]=n:delete i[a]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("AV.JSON.parse")})}();(function(e){e.build={version:"3.0.1.210",bundled:false,MINIMUM_FLASH_PLAYER_VERSION:"10.2.0",feather_baseURL:"http://feather.aviary.com/3.0.1.210/",feather_baseURL_SSL:"https://dme0ih8comzn4.cloudfront.net/3.0.1.210/",feather_stickerURL:"http://feather.aviary.com/stickers/",feather_stickerURL_SSL:"https://dme0ih8comzn4.cloudfront.net/stickers/",imgrecvBase:"http://featherservices.aviary.com/",imgrecvBase_SSL:"https://featherservices.aviary.com/",featherTargetAnnounce:"http://featherservices.aviary.com/feather_target_announce_v3.html",featherTargetAnnounce_SSL:"https://featherservices.aviary.com/feather_target_announce_v3.html",imgrecvServer:"http://featherservices.aviary.com/FeatherReceiver.aspx",imgrecvServer_SSL:"https://featherservices.aviary.com/FeatherReceiver.aspx",jsonp_imgserver:"http://featherservices.aviary.com/imgjsonpserver.aspx",jsonp_imgserver_SSL:"https://featherservices.aviary.com/imgjsonpserver.aspx",proxyServer:"http://featherservices.aviary.com/proxy.aspx",proxyServer_SSL:"https://featherservices.aviary.com/proxy.aspx",asyncImgrecvBase:"http://api.aviary.com/",asyncImgrecvBase_SSL:"https://api.aviary.com/",partnerAssetURL:"http://api.aviary.com/getassets",partnerAssetURL_SSL:"https://api.aviary.com/getassets",asyncFeatherTargetAnnounce:"http://api.aviary.com/feather_target_announce_v3.html",asyncFeatherTargetAnnounce_SSL:"https://api.aviary.com/feather_target_announce_v3.html",asyncImgrecvCreateJob:"http://api.aviary.com/createjob",asyncImgrecvCreateJob_SSL:"https://api.aviary.com/createjob",asyncImgrecvGetJobStatus:"http://api.aviary.com/getjobstatus",asyncImgrecvGetJobStatus_SSL:"https://api.aviary.com/getjobstatus",googleTracker:"UA-84575-16",inAppPurchaseFrameURL:"http://purchases.viary.com/gateway.aspx?p=flickr",filterServer:"http://featherservices.aviary.com/moa.ashx",filterServer_SSL:"https://featherservices.aviary.com/moa.ashx",featherFilterAnnounce:"http://featherservices.aviary.com/feather_filter_announce.html",featherFilterAnnounce_SSL:"https://featherservices.aviary.com/feather_filter_announce.html"}})(AV=window["AV"]||{});if(typeof AV=="undefined"){AV={}}AV.validLanguages={en:true,zh_hant:true,nl:true,fr:true,de:true,it:true,ja:true,ko:true,pl:true,pt_br:true,ru:true,es:true,android:true,bg:true,zh_hans:true,cs:true,da:true,fi:true,el:true,he:true,hu:true,id:true,no:true,pt:true,sk:true,sv:true,tr:true,vi:true,lv:true,lt:true,ca:true,sl:true};(function(e,t,a){e.util={getX:function(e){var t=0;while(e!=null){t+=e.offsetLeft;e=e.offsetParent}return t},getY:function(e){var t=0;while(e!=null){t+=e.offsetTop;e=e.offsetParent}return t},getTouch:function(e){var t;if(e.originalEvent){e=e.originalEvent}if(e.changedTouches&&e.changedTouches.length==1){t=e.changedTouches[0]}else if(e.touches&&e.touches.length==1){t=e.touches[0]}else{t=false}return t},getScaledDims:function(e,t,a,n){n=n||a;var i=e;var r=t;var o=e/t;if(e>a||t>n){if(e-a>o*(t-n)){i=a;r=a*t/e+.5|0}else{i=n*o+.5|0;r=n}}return{width:i,height:r}},nextFrame:function(e){setTimeout(e,1)},getDomain:function(e,t){var a,n,i,r,o,s,l;if(e.substr(0,7)=="http://"){a=7}else if(e.substr(0,8)=="https://"){a=8}else if(e.substr(0,6)=="ftp://"){a=6}else{a=0}i=e.indexOf("/",a);if(i==-1){i=e.length}if(t){n=a}else{s=e;l=e.lastIndexOf(":");if(l>a){s=e.substring(a,l)}else{s=e.substring(a,i)}if(s.match(/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/)){n=a}else{r=e.lastIndexOf(".",i);o=e.lastIndexOf(".",r-1);if(o==-1){n=a}else{n=o+1}}}return e.substring(n,i)},extend:function(){var e,t,a,n,i,r,o=arguments[0]||{},s=1,l=arguments.length,c=false;if(typeof o==="boolean"){c=o;o=arguments[1]||{};s=2}if(typeof o!=="object"&&!jQuery.isFunction(o)){o={}}if(l===s){o=this;--s}for(;s<l;s++){if((e=arguments[s])!=null){for(t in e){a=o[t];n=e[t];if(o===n){continue}if(c&&n&&(jQuery.isPlainObject(n)||(i=jQuery.isArray(n)))){if(i){i=false;r=a&&jQuery.isArray(a)?a:[]}else{r=a&&jQuery.isPlainObject(a)?a:{}}o[t]=jQuery.extend(c,r,n)}else if(n!==undefined){o[t]=n}}}}return o},findItemByKeyValueFromArray:function(e,t,a){var n,i=a.length,r;for(n=0;n<a.length;n++){if(a[n]&&a[n][e]&&a[n][e]===t){r=a[n];break}}return r},loadFile:function(){var e;var t;var n=0;var i,r;var o=function(e,t){if(t){function a(e){if(this.readyState==4||this.readyState=="complete"||this.readyState=="loaded"){t(e)}}if(navigator.appName=="Microsoft Internet Explorer"){e.onreadystatechange=a}else{e.onload=t}}};e=o;return function(o,s,l){var c;if(s=="js"){c=a.createElement("script");c.setAttribute("type","text/javascript");e(c,l);c.setAttribute("src",o)}else if(s=="css"){if(a.createStyleSheet){a.createStyleSheet(o,n++)}else{c=a.createElement("link");c.setAttribute("rel","stylesheet");c.setAttribute("type","text/css");c.setAttribute("href",o)}}else if(s=="img"){c=a.createElement("img");e(c,l);c.setAttribute("src",o)}if(c){t=t||a.getElementsByTagName("head")[0];if(s=="js"){t.appendChild(c)}else if(s=="css"){i=i||a.createDocumentFragment();i.appendChild(c);t.insertBefore(c,r)}}return c}}(),getImageElem:function(e){if(typeof e=="string"){return a.getElementById(e)}if(e.length){return e[0]}return e},getImageId:function(e){if(typeof e=="string"){return e}return e.id},imgOnLoad:function(e,t){var a=avpw$(e);a.load(t);if(a[0].complete==true||a[0].readyState==4||a[0].readyState=="complete"||a[0].readyState=="loaded"){a.trigger("load")}},color_is_white:function(e){e=e.toLowerCase();return e=="#fff"||e=="#ffffff"||e=="white"||e=="rgb(255,255,255)"||e=="rgb(255, 255, 255)"},color_is_light:function(t){var a,n,i,r,o;a=n=i=0;o=e.util.color_to_array(t);a=o[0];n=o[1];i=o[2];r=.2*a+.7*n+.1*i;return r>127.5},color_expand:function(e){var t,a,n;if(e.length==4){t=e.charAt(1);a=e.charAt(2);n=e.charAt(3);e="#"+t+t+a+a+n+n}return e},color_to_array:function(t){var a,n,i;if(t.charAt(0)=="#"){t=e.util.color_expand(t);a=parseInt(t.substr(1,2),16);n=parseInt(t.substr(3,2),16);i=parseInt(t.substr(5,2),16)}else if(t.charAt(0).toLowerCase()=="r"){t=e.util.rgb_to_color(t);a=parseInt(t.substr(1,2),16);n=parseInt(t.substr(3,2),16);i=parseInt(t.substr(5,2),16)}t=[a,n,i,1];return t},array_to_color:function(t){var a=e.util.array_to_rgb(t);a=e.util.rgb_to_color(a);return a},array_to_rgb:function(e){var t="rgb(0,0,0)";if(e.join){if(e.length>3){e=e.slice(0,3)}t="rgb("+e.join(",")+")"}return t},color_to_rgb:function(t){t=e.util.color_to_array(t);t=e.util.array_to_rgb(t);return t},rgb_to_color:function(e){var t;var a=/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/;var n,i,r;var o=e.match(a);if(o){n=parseInt(o[1]).toString(16);if(n.length==1){n="0"+n}i=parseInt(o[2]).toString(16);if(i.length==1){i="0"+i}r=parseInt(o[3]).toString(16);if(r.length==1){r="0"+r}return"#"+n+i+r}return e},color_to_int:function(t){t=e.util.color_expand(t);t=e.util.rgb_to_color(t);return parseInt(t.substr(1),16)},loadImagesSync:function(t,a){var n=0;var i=t.length;for(var r=0;r<i;r++){var o=t[r].img;var s=t[r].src;o.onload=function(){n++;if(a&&n==t.length){e.util.nextFrame(a)}};o.src=s}},getApiVersion:function(e){return e&&e.apiVersion?parseInt(e.apiVersion,10):1},getUserFriendlyToolName:function(e){var t={overlay:"Stickers",drawing:"Draw",textwithfont:"Text",colorsplash:"Splash",tiltshift:"Tilt Shift"};var a="";if(e){a=t[e]||e.substr(0,1).toUpperCase()+e.substr(1)}return a},addFontToPage:function(t,a){if(!t){if(a){a()}}var n=t.value;if(t.system){if(a){a(t)}}else if(e.WebFont){var i={loading:function(){if(e.controlsWidgetInstance){e.controlsWidgetInstance.showWaitThrobber(true)}},active:function(){if(e.controlsWidgetInstance){e.controlsWidgetInstance.showWaitThrobber(false)}if(a){a(t)}},inactive:function(){if(e.controlsWidgetInstance){e.controlsWidgetInstance.showWaitThrobber(false)}e.errorNotify("UNSUPPORTED_FONT",[n]);if(a){a()}}};if(t.custom){i.custom={families:[n],urls:[t.url]};i.active=function(){if(e.controlsWidgetInstance){e.controlsWidgetInstance.showWaitThrobber(false)}if(a){e.util.nextFrame(function(){a(t)},500)}}}else{i.google={families:[n]}}e.WebFont.load(i)}}}})(window["AV"]||(window["AV"]={}),window,document);if(typeof AV==="undefined"){AV={}}AV.FlashAPI=function(){var e="avpw_canvas_swf";var t=null;var a=function(){var e=function(e,t,a){var n=document.createElement("param");n.setAttribute("name",t);n.setAttribute("value",a);e.appendChild(n)};var t=function(t,a,n){var i=document.getElementById(n);if(i){if(typeof t.id=="undefined"){t.id=n}if(AV.msie){var r="";for(var o in t){if(t[o]!=Object.prototype[o]){if(o.toLowerCase()=="data"){a.movie=t[o]}else if(o.toLowerCase()=="styleclass"){r+=' class="'+t[o]+'"'}else if(o.toLowerCase()!="classid"){r+=" "+o+'="'+t[o]+'"'}}}var s="";for(var l in a){if(a[l]!=Object.prototype[l]){s+='<param name="'+l+'" value="'+a[l]+'" />'}}i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+r+">"+s+"</object>";if(typeof objIdArr=="undefined"){objIdArr=[]}objIdArr[objIdArr.length]=t.id}else{var c=document.createElement("object");c.setAttribute("type","application/x-shockwave-flash");for(var u in t){if(t[u]!=Object.prototype[u]){if(u.toLowerCase()=="styleclass"){c.setAttribute("class",t[u])}else if(u.toLowerCase()!="classid"){c.setAttribute(u,t[u])}}}for(var f in a){if(a[f]!=Object.prototype[f]&&f.toLowerCase()!="movie"){e(c,f,a[f])}}i.parentNode.replaceChild(c,i)}}};var a=function(e,a,n,i,r,o,s,l,c,u){n+="";i+="";var f={};if(c&&typeof c==="object"){for(var d in c){f[d]=c[d]}}f.data=e;f.width=n;f.height=i;var h={};if(l&&typeof l==="object"){for(var p in l){h[p]=l[p]}}if(s&&typeof s==="object"){for(var g in s){if(typeof h.flashvars!="undefined"){h.flashvars+="&"+g+"="+s[g]}else{h.flashvars=g+"="+s[g]}}}t(f,h,a)};return function(e,t,n,i,r){r=r||{};var o={};o.quality="high";o.bgcolor="#808080";o.allowscriptaccess="always";o.allowfullscreen="true";var s={};s.id=e;s.name=e;if(AV.msie&&AV.msie<9){s.align="center"}a(t,e+"_replace",n||"100%",i||"100%","10.0.32","",r,o,s)}}();var n=function(){};n.prototype=function(){return{getPlugins:function(){return[]},createCanvas:function(){if(this.initsize){a(e,AV.build["feather_baseURL"]+"canvas.swf",this.initsize.width,this.initsize.height)}else{a(e,AV.build["feather_baseURL"]+"canvas.swf")}},_onComponentLoaded:function(t){switch(t){case"canvas":var a=document.getElementById(e);AV.FlashAPI._onCanvasLoaded(a);break;case"controls":break}},_onComponentReady:function(e){var t=AV.paintWidgetInstance;if(e==="canvas"){if(t.canvasReadyCallback){t.canvasReadyCallback.resolve()}}}}}();var i=function(){var e=[];var t=function(){for(var t=0;t<256;t++){e[t]=String.fromCharCode(t)}e[0]=String.fromCharCode(1)+String.fromCharCode(1);e[1]=String.fromCharCode(1)+String.fromCharCode(2)};var a=function(t){var a="";for(var n=0;n<t.length;n+=4){a+=e[t[n+3]];a+=e[t[n]];a+=e[t[n+1]];a+=e[t[n+2]]}return a};var n=function(e,t,a){var n=[];var i;var r=0;var o=0;var s=[0,0,1];while(o<e.length){n[r++]=(i=e.charCodeAt(o++))!=1?i:s[e.charCodeAt(o++)]}return n};var i={};i.init=t;i.shutdown=function(){e=[]};i.decode=n;i.encode=a;return i}();return function(){var e=null;var a=null;var r=null;var o=false;var s=false;return{mapToFlashToolName:function(e){switch(e){case"rotate":return"rotate90"}return e},mapFromFlashToolName:function(e){switch(e){case"rotate90":return"rotate"}return e},customBridge:function(e){var t=function(){};t.prototype=new n;t.prototype.constructor=n;for(var a in e){t.prototype[a]=e[a]}return t},activate:function(e){this.bridge=e||new n;this.goldenEggCallback=null},setHiresSize:function(e,t){if(this.canvas){this.canvas.setHiresSize(e,t)}},hiresSizeChanged:function(e,t){if(AV.paintWidgetInstance&&AV.paintWidgetInstance.actions){AV.paintWidgetInstance.actions.setDims(e,t)}},startEditing:function(e){this.canvas=null;this.active_target=e;this.bridge.createCanvas()},restartEditing:function(e){this.active_target=e;this._setupEditing()},close:function(){},runGoldenEgg:function(e,t,a,n){this.goldenEggCallback=n;this.canvas.renderGoldenEgg(e,t,a)},doCrop:function(){this.canvas.executeCrop()},activatePlugin:function(e){this.canvas.activatePlugin(e)},deactivatePlugin:function(e){this.canvas.deactivatePlugin(e)},changeProperty:function(e,t){this.canvas.changeProperty(e,t)},applyPreviewFromPlugin:function(e){this.canvas.applyPreviewFromPlugin(e)},commitChangesFromPlugin:function(e){this.canvas.commitChangesFromPlugin(e)},discardChangesFromPlugin:function(e){this.canvas.discardChangesFromPlugin(e)},resizeCanvas:function(e,t){var a=this.canvas;a.width=e+"px";a.height=t+"px";if(AV.paintWidgetInstance){AV.paintWidgetInstance.setDimensions(e,t)}},hideCanvas:function(){if(this.canvas){this.canvas.style.visibility="hidden"}},showCanvas:function(){if(this.canvas){this.canvas.style.visibility="visible"}},executePlugin:function(){this.canvas.executePlugin()},renderPreview:function(e,t){this.canvas.renderPreview(e,t)},getDynamicPropertyDefaultValue:function(e){return this.canvas.getDynamicPropertyDefaultValue(e)},syncProperty:function(e,t){},syncPreview:function(e){},setCanvasDataArray:function(e,t,a){if(AV.canvasDataReceiver){AV.canvasDataReceiver.apply(this,[e,t,a])}},setThumb:function(e,t){},getHistory:function(){return this.canvas.getHistory()},getHiResStickerUrl:function(e){if(AV.paintWidgetInstance&&AV.paintWidgetInstance.overlayRegistry){return AV.paintWidgetInstance.overlayRegistry.getHiRes(e)}else{return null}},getImageData:function(e,a){if(a&&typeof a==="function"){t=a}this.canvas.commit({})},getMaxSize:function(){var e=AV.launchData["maxEditSize"]||AV.launchData["maxSize"];return e},getMaxBitmapSize:function(){return AV.launchData["maxSize"]},_cropSelectionStarted:function(e,t,a){},_onPreviewRendered:function(e,t){},_onPluginLoaded:function(e,t){var a=AV.paintWidgetInstance;if(a.moduleLoadedCallback&&a.moduleLoadedCallback[e]){a.moduleLoadedCallback[e].resolve()}},_onImageLoaded:function(e,t){if(AV.paintWidgetLauncher_Flash_stage2){AV.paintWidgetLauncher_Flash_stage2(e,t)}},_onGoldenEggComplete:function(){if(this.goldenEggCallback){this.goldenEggCallback()}},_onCanvasLoaded:function(e){this.canvas=e;this._setupEditing(AV.launchData.url||null)},_onGetImageDataComplete:function(e){if(t){t.apply(this,[e]);t=null}},_setupEditing:function(e){var t=this.bridge.getPlugins();e=e||this.active_target.src;this.canvas.setup(e,AV.build["proxyServer"],t)},_canUndo:function(){return o},_onUndo:function(){this.canvas.undo()},_canRedo:function(){return s},_onRedo:function(){this.canvas.redo()},_onHistoryChange:function(e,t){o=e;s=t;if(AV.controlsWidgetInstance){AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[e,t])}},setCheckpoint:function(e){this.canvas.setCheckpoint(e)},isACheckpoint:function(e){return this.canvas.isACheckpoint(e)},undoToCheckpoint:function(){this.canvas.undoToCheckpoint()},redoToCheckpoint:function(){return this.canvas.redoToCheckpoint()},truncateActionList:function(){this.canvas.truncateActionList()},_onError:function(e,t){if(e==="BAD_IMAGE"){AV.paintWidgetCloser(true);if(AV.launchData["url"]){e="BAD_URL"}}AV.errorNotify(e,t)},init:function(e){function t(){if(!e){return new n}if(e["plugins"]){var t=[];var a=e.plugins;for(var i=0;i<a.length;++i){var r=AV.FlashAPI.mapToFlashToolName(a[i]);var o=AV.toolDefaults[a[i]];if(o&&o.files){t.push({id:r,presets:o.presetsFlash,files:o.files})}}if(t.length>0){e.getPlugins=function(){return t}}delete e["plugins"]}var s=function(){};s.prototype=new n;s.prototype.constructor=n;for(var l in e){s.prototype[l]=e[l]}return new s}AV.FlashAPI.activate(t());i.init()},pibeca:i}}()}();(function(e,t,a){e["AV"]=e["AV"]||{};var n=e["AV"];n.ImageSizeTracker=function(e){var t=this;t.setImageScaledIndicator=function(){n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"updateImageScaledIndicator")};t.setOrigSize=function(e,a,i){var r,o;if(e.hiresWidth&&e.hiresHeight){r=parseInt(e.hiresWidth,10);o=parseInt(e.hiresHeight,10)}else if(e.hiresUrl){r=a.width;o=a.height}else if(e.displayImageSize){r=i.width;o=i.height}else{return null}n.paintWidgetInstance.actions.setOrigSize(r,o);t.setImageScaledIndicator();return{width:r,height:o}};t.isDisplayingImageSize=function(e){return e.hiresWidth||e.hiresHeight||e.displayImageSize};t.isUsingHiResDimensions=function(e){return e.hiresWidth||e.hiresHeight||e.displayImageSize&&e.hiresUrl}};return e})(this,typeof window!=="undefined"?window:{},typeof document!=="undefined"?document:{});(function(e,t,a){e["AV"]=e["AV"]||{};var n=e["AV"];var i=n.Events;n.ToolManager=function(e){var r=null;var o=function(t){var a,i,r=e.activeTools,o=false;if(r){i=r.length;for(a=0;a<i;a++){if(r[a]===t){o=true;break}}}if(!o){n.errorNotify("UNSUPPORTED_TOOL",[t])}return o};var s=function(t,a,n){return e.objectNotify("tool",t,a,n)};var l=function(e){if(e!=null){avpw$(".avpw_controlpanel").each(function(){avpw$(this).hide()});avpw$("#avpw_controlpanel_"+e).show()}};var c=function(){var a;var o=function(o){s(r,"panelWillClose");s(o,"panelWillOpen");i.trigger("canvas:activate",e.panelMode2WidgetMode(o));l(o);s(o,"resetUI");t.setTimeout(function(e){return function(){s(e,"panelDidClose");r=o;s(o,"panelDidOpen");a=false}}(r),200);r=o;e.layoutNotify(n.launchData["openType"],"disableZoomMode")};return function(e){if(!a){a=true;o(e)}}}();var u=function(t){if(e.paintWidget&&e.paintWidget.busy){return}e.layoutNotify(n.launchData["openType"],"showView",["editpanel"]);c(t);n.controlsWidgetInstance.onEggWaitThrobber.stop();if(n.launchData["openType"]=="mobile"){var i;var r=a.getElementById("avpw_main_"+t);if(r){i=r.getAttribute("data-header");if(i){a.getElementById("avpw_control_toolname").innerHTML=i}}}n.usageTracker.addUsage(t)};var f=function(){i.on("tool:open",p);i.on("tool:close",h);i.on("tool:init",g);i.on("tool:shutdown",y);i.on("tool:commit",v);i.on("tool:cancel",m);i.on("tool:undo",W);i.on("tool:redo",S)};var d=function(){i.off("tool:open",p);i.off("tool:close",h);i.off("tool:init",g);i.off("tool:shutdown",y);i.off("tool:commit",v);i.off("tool:cancel",m);i.off("tool:undo",W);i.off("tool:redo",S)};var h=function(){e.layoutNotify(n.launchData["openType"],"showView",["main"]);c(null)};var p=function(t,a){t=n.publicName2PanelMode(t);if(o(t)){if(e.paintWidget&&!e.paintWidget.moduleLoaded(t,u)){if(a){e.onEggWaitThrobber.stop();e.onEggWaitThrobber.spin(avpw$(a).children(".avpw_icon_waiter")[0])}}}i.trigger("usage:tool",t,"opened");i.trigger("usage:firstclick",t)};var g=function(t){s(t,"init",[e])};var v=function(){var e,t=r;if(t){e=s(r,"commit");if(e!==false){i.trigger("usage:tool",t,"applied",e!==true?e:"");i.trigger("tool:commitDone")}}};var m=function(){s(r,"cancel");i.trigger("usage:tool",r,"canceled")};var y=function(e){s(e,"shutdown")};var w=function(){if(e.paintWidget.busy){return false}if(s(r,"onUndo")===false){return false}e.paintWidget.actions.undo();s(r,"onUndoComplete");return false};var b=function(){if(e.paintWidget.busy){return false}if(s(r,"onUndo",[{global:true}])===false){return false}e.paintWidget.actions.undoToCheckpoint();s(r,"onUndoComplete",[{global:true}]);return false};var _=function(){if(e.paintWidget.busy){return false}if(s(r,"onRedo")===false){return false}e.paintWidget.actions.redo();s(r,"onRedoComplete");return false};var I=function(){if(e.paintWidget.busy){return false}if(s(r,"onRedo",[{global:true}])===false){return false}var t=e.paintWidget.actions.redoToCheckpoint();if(t){s(r,"onRedoComplete",[{global:true}])}return t};var W=function(){i.trigger("usage:tool","undo","applied",r||"");if(e.paintWidget.actions.isACheckpoint()){b()}else{w()}};var S=function(){i.trigger("usage:tool","redo","applied",r||"");if(!I()){_()}};var T=this;T.init=f;T.shutdown=d;T.notify=s;T.getActiveTool=function(){return r};f();return T};return e})(this,typeof window!=="undefined"?window:{},typeof document!=="undefined"?document:{});(function(e,t,a){e.AssetManager=function(a,n){"use strict";var i={EFFECT:"effect",STICKER:"sticker",IMAGEBORDER:"imageborder",PERMISSION:"permission",FONTPACK:"fontpack"};var r={};var o;var s=function(){if(!t.avpw_purchase_frame){avpw$("#avpw_messaging").append(e.template[e.launchData.layout].inAppPurchaseFrame({src:e.build["inAppPurchaseFrameURL"]}))}};var l=function(t){var a=t.resourceUrl;if(a){if(a.indexOf("http")===-1){a=e.build["feather_baseURL"]+a}t.resourceUrl=a}};var c=function(t){for(var a=0;a<o.length;a++){for(var n=0;n<t.length;n++){if(t[n].assetId===o[a].assetId){o[a].purchased=true;e.util.extend(o[a],t[n]);l(o[a])}}}};var u=function(e){var t=[];if(e){e=i[e];for(var a=0;a<o.length;a++){if(o[a].assetType===e){t.push(o[a])}}}else{t=o.slice(0)}return t};var f=function(t,a){if(!o){if(!r["getPartnerAssets"]){r["getPartnerAssets"]=[];m.authenticate()}r["getPartnerAssets"].push(function(n){if(n&&n.assets){o=n.assets}else{e.errorNotify("ERROR_AUTHENTICATING");p()}e.util.nextFrame(function(){if(o){for(var e=0;e<o.length;e++){l(o[e])}if(a)a.apply(this,[u(t)])}})})}else{if(a)a.apply(this,[u(t)])}};var d=function(e,a){t.setTimeout(function(){try{t.avpw_purchase_frame.postMessage("getAssets","*");r["getAssets"]=a;return true}catch(e){return false}},2e3)};var h=function(e,a){if(!o){d(e,function(t){o=t;for(var n=0;n<o.length;n++){l(o[n])}v(e,a)});return false}try{t.avpw_purchase_frame.postMessage("getPurchasedAssets","*");r["getPurchasedAssets"]=function(t){c(t);if(a)a.apply(this,[u(e)])};return true}catch(n){return false}};var p=function(t,a){o=[{needsPurchase:false,assetId:"default_effects",assetType:"effect",displayName:"Default",resourceUrl:"js/proclist_default_effects.js"},{needsPurchase:false,assetId:"original_effects",assetType:"effect",displayName:"Original",resourceUrl:"js/proclist_original_effects.js"},{needsPurchase:false,assetId:"original_stickers",assetType:"sticker",displayName:"Original",resourceUrl:"js/stickers_original_stickers.js"},{needsPurchase:false,assetId:"borders",assetType:"imageborder",displayName:"Default Image Borders",resourceUrl:"js/borders_original.js"}];if(a){e.util.nextFrame(function(){for(var e=0;e<o.length;e++){l(o[e])}a.apply(this,[u(t)])})}return true};var g=function(e){var t,a,n;if(e.messageName){n=r[e.messageName];if(n){if(typeof n==="function"){n.apply(this,[e.data])}else{a=n.length;for(t=0;t<a;t++){n[t].apply(this,[e.data])}}n=null}}};var v=a?f:n?h:p;var m=this;m.getAssets=v;m.getById=function(e){for(var t=0;t<o.length;t++){if(o[t].assetId===e){return o[t]}}};m.showAssetPurchaseView=function(a,n){var i={messageName:"showAssetPurchaseView",assetId:a};i=e.JSON.stringify(i);try{t.avpw_purchase_frame.postMessage(i,"*");r["showAssetPurchaseView"]=function(){m.showAssetPurchasePopup(a,n)};return true}catch(o){return false}};m.showAssetPurchasePopup=function(t,a){avpw$("#avpw_purchase_frame").show();e.controlsWidgetInstance.messager.show("avpw_purchase_pack",true);avpw$("#avpw_purchase_pack_close").bind("click",m.hideAssetPurchasePopup);r["getPurchasedAssets"]=function(e){c(e);var n=m.getById(t);if(a&&typeof a==="function"&&n){a.apply(this,[n])}m.hideAssetPurchasePopup()}};m.hideAssetPurchasePopup=function(){r["getPurchasedAssets"]=null;avpw$("#avpw_purchase_frame").hide();e.controlsWidgetInstance.messager.hide("avpw_purchase_pack");avpw$("#avpw_purchase_pack_close").unbind("click",m.hideAssetPurchasePopup)};m.authenticate=function(){var t=function(e){var t={messageName:"getPartnerAssets",data:e};g(t)};return function(){return e.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_auth_form",action:e.build["partnerAssetURL"],method:"POST",dataType:"json",announcer:e.build["asyncFeatherTargetAnnounce"],origin:e.build["asyncImgrecvBase"],keyValues:{apikey:e.launchData.apiKey,timestamp:e.launchData.timestamp,signature:e.launchData.signature,salt:e.launchData.salt,encryptionmethod:e.launchData.encryptionMethod},callback:t})}}();m.types=i;if(n){s()}return m}})(window["AV"]||(window["AV"]={}),window,document);(function(e,t,a){e.ServerMessaging=function(n){var i=[];var r=function(t,a){var n,r;var o=true;var s=i.shift();if(s){if(a&&s.origin){o=a===e.util.getDomain(s.origin)}if(s.id){n=avpw$("#"+s.id);r=n.attr("target");avpw$("#"+r).unbind("load");avpw$("#"+s.id+"_target_holder").empty();n.remove()}if(o&&s.callback){if(s.dataType&&s.dataType==="json"){if(typeof t==="string"){try{t=e.JSON.parse(t)}catch(l){}}}s.callback.call(this,t)}}if(i.length>0){h()}};var o=function(t,a,n,i,r){return avpw$.ajax({url:t,type:a,data:n,dataType:i,error:function(){e.errorNotify("ERROR_SAVING",[e.build["imgrecvServer"]])},success:r})};var s=function(e,t,n,i,r){var o=avpw$("<form></form>").attr({id:e,action:t,target:n,method:i||"POST"}).css({display:"none"});var s=a.createDocumentFragment();for(var l in r){if(r.hasOwnProperty(l)){s.appendChild(avpw$("<input></input>").attr({name:l,value:r[l],type:"hidden"})[0])}}o.html(s);o.appendTo("#avpw_holder");return o};var l=function(e,t,a){if(!a){a=""}if(!t){t=e}return['<iframe width="1" height="1" ','style="position:absolute;left:-9999px;" ','id="'+e+'" name="'+t+'" src="'+a+'">',"</iframe>"].join("")};var c=function(e,t,a){if(!e){return null}var n=e+"_target_holder";var i=Math.floor(Math.random()*4294967295).toString(16);var r="avpw_form_target_"+i;var o=avpw$("#"+n);if(o&&o.length){}else{o=avpw$('<div id="'+n+'"></div>').css({position:"absolute",top:0,left:0}).appendTo("#avpw_holder")}o.html(l(r));if(t){avpw$("#"+r).load(function(){f(r,e,t)})}else{avpw$("#"+r).load(a)}return r};var u=function(e,t,a,n,i,r,o){var l=c(e,r,o);t+="?responsecontenttypeheader="+escape("text/html");var u=s(e,t,l,a,i);u.submit();return u};var f=function(a,n,i){var o=n+"_announcer";var s;if(t.postMessage){if(t[o]){t[o].postMessage("avpw_load:"+a,"*")}else{s=avpw$(l(o,o,i));s.load(function(){e.util.nextFrame(function(){t[o].postMessage("avpw_load:"+a,"*")})});avpw$("#avpw_holder").append(s)}}else{var c=function(){avpw$(u).unbind().remove()};var u;var f=n+"_observer";var d=f;var h=0;var p=function(){var t;try{if(u.contentWindow.location=="about:blank"){return}}catch(a){}if(h===2){t=u.contentWindow.name;if(t){h=3;if(t!==d&&t.substr&&t.substr(0,5)=="avpw:"){t=t.substr(5);r(t)}else{e.errorNotify("ERROR_SAVING",[e.build["imgrecvServer"]]);r()}c()}}if(h===1){h=2;u.contentWindow.location=""}if(!h){h=1}};u=avpw$(l(f,d,i+"#"+a))[0];avpw$(u).load(p);avpw$(u).appendTo("#avpw_holder")}};var d=function(t){var a=t.data;var n=e.util.getDomain(t.origin);if(a.substr&&a.substr(0,5)=="avpw:"){a=a.substr(5);r(a,n)}};var h=function(){var e=i[0];if(e){u(e.id,e.action,e.method,e.origin,e.keyValues,e.announcer)}};var p=function(e){if(e.announcer){i.push(e);if(i.length===1){h()}}else{u(e.id,e.action,e.method,e.origin,e.keyValues,e.announcer,e.callback)}};var g=function(t){var a=t.transport||"xhr";var n;if(a==="xhr"&&avpw$.support.cors&&(!e.firefox||e.firefox>=4)){n=o(t.action,t.method,t.keyValues,t.dataType,t.callback);if(!n){p(t)}}else{p(t)}};var v=function(){if(t.addEventListener){t.addEventListener("message",d,false)}else if(t.attachEvent){t.attachEvent("onmessage",d)}};var m=this;m.shutdown=function(){if(t.removeEventListener){t.removeEventListener("message",d,false)}else if(t.detachEvent){t.detachEvent("onmessage",d)}i=[]};m.sendMessage=g;v();return m}})(window["AV"]||(window["AV"]={}),window,document);(function(e,t,a){e["AV"]=e["AV"]||{};var n=e["AV"];var i=n.Events;n.usageTracker=function(){var e=null;var a={};var r=0;var o=[];var s=0;var l;var c=-1;var u=1;var f=false;var d={};var h=function(){if(n.controlsWidgetInstance){d.submit("close")}};var p=function(){};var g=function(e,t,a){};var v=function(e,t,a){};var m=function(e){d.submit("firstclick",e);i.off("usage:firstclick")};d.setup=function(){avpw$(t).bind("unload",h);i.on("usage:submit",d.submit,d);i.on("usage:tool",g,d);i.on("usage:firstclick",m,d);i.on("usage:interact",v)};d.shutdown=function(){avpw$(t).unbind("unload",h);i.off("usage:submit",d.submit);i.off("usage:tool",g);i.off("usage:firstclick",m);i.off("usage:interact",v)};d.clear=function(){e=null;a={};r=0;o=[];s=0;c=-1};d.getUUID=function(){if(e){return e}return e=Math.floor(Math.random()*4294967295).toString(16)+Math.floor(Math.random()*4294967295).toString(16)};d.addUsage=function(e,t){if(!t){t=1}if(a[e]===undefined){a[e]=t}else{a[e]+=t}r+=t};d.setPageCount=function(e){var t;s=e;o=new Array(e);for(t=0;t<e;t++){o[t]=0}};d.addPageHit=function(e){if(e!==l){o[e]++}l=e};d.submit=function(e,t){var a=null;
var i="";var r;var o;p.call(this);if(e==="launch"){}else{}if(n.controlsWidgetInstance){}};return d}();n.getActiveTools=function(e){var t=n.featherUseFlash?n.flashSupportedTools:n.defaultTools;var a=e;if(!a||a==="all"||a==="All"||a==="ALL"||a===""){a=t}if(typeof a==="string"){a=e.split(",")}var i=[];var r;var o={};var s;for(s=0;s<t.length;s++){r=t[s];o[r]=true}for(s=0;s<a.length;s++){r=n.publicName2PanelMode(a[s]);if(r in o){i.push(r)}}return i};n.paintWidgetGetPopupEmbedDiv=function(e){var t=avpw$("#avpw_canvas_embed_popup");if(e){var n=avpw$(e);var i;var r,o;var s=["top","left","bottom","right","margin-top","margin-right","margin-bottom","margin-left","border-top","border-right","border-bottom","border-left","padding-top","padding-right","padding-bottom","padding-left"];var l={position:"relative"};for(r=0;r<s.length;r++){o=s[r];l[o]=n.css(o)}i=avpw$(e).css("display");if(i==""||i=="inline"){i="inline-block"}l["display"]=i;if(t.length==0){t=a.createElement("div");t.id="avpw_canvas_embed_popup"}avpw$(t).hide().css(l).insertBefore(e)}return t};n.paintWidgetLauncher=function(e,t){if(n.paintWidgetInstance){return}n.usageTracker.clear();if(n.featherUseFlash){return n.paintWidgetLauncher_Flash(e,t)}else{return n.paintWidgetLauncher_HTML(e,t)}};n.paintWidgetLauncher_Flash=function(e,r){var o=n.launchData.launchDelay;var s=n.util.getImageElem(e);var l=s.src;var c;var u;var f,d,h,p;var g,v;var m;var y;var w;y=n.getActiveTools(n.launchData.tools);w=new n.AssetManager(n.launchData.isPremiumPartner,n.launchData.allowInAppPurchase);n.controlsWidgetInstance=new n.ControlsWidget(null,e,y,w,new n.ServerMessaging);if(r){n.controlsWidgetInstance.origURL=r}else{n.controlsWidgetInstance.origURL=avpw$(s).attr("src")}avpw$(".avpw_isa_previewcanvas").hide();u=n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"getEmbedElement",[s]);avpw$(u).show();m="js/featherpaint_flash.js";c=a.createElement("img");avpw$(c).css({display:"block",visibility:"hidden",position:"absolute"}).attr("src",r?r:s.src);function b(){avpw$(c).unbind("load",b);if(n.msie&&n.msie==7){avpw$("#avpw_controls").css("visibility","hidden");avpw$("#avpw_controls").show()}n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"placeControls_Flash",[n.util.getApiVersion(n.launchData)>1?n.launchData.appendTo:undefined]);n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"enableControls");f=n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"getScaledImageDims_Flash",[c]);d=f.width;h=f.height;p=d>h?d:h;n.launchData["maxEditSize"]=p;n.paintWidgetInstance=new n.PaintWidget(d,h,new n.Actions,new n.ModeManager,new n.FilterManager,new n.OverlayRegistry,new n.ImageBorderManager);n.paintWidgetInstance.setOrigSize(d,h);var a=n.template[n.launchData.layout].flashCanvasBox({id:"avpw_canvas_swf_replace"});avpw$(u).append(a);n.controlsWidgetInstance.initAllTools.call(n.controlsWidgetInstance);var l={initsize:f,plugins:y,action:{origUrl_:r?r:s.src,sessionID_:n.usageTracker.getUUID(),referrerUrl_:t.location.href,url:n.build["imgrecvServer"],name:"file"}};n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"hideOriginalImage",[s]);n.util.nextFrame(function(){n.controlsWidgetInstance.setupScrollPanels()});if(n.msie&&n.msie==7){avpw$("#avpw_controls").hide();avpw$("#avpw_controls").css("visibility","visible")}avpw$("#avpw_controls").fadeIn(o);if(n.launchData.noCloseButton){avpw$("#avpw_control_cancel_pane").css("display","none")}var g=e;setTimeout(function(){n.FlashAPI.init(l);n.FlashAPI.startEditing(e);n.controlsWidgetInstance.initWithPaintWidget(n.paintWidgetInstance);i.trigger("tool:close");n.controlsWidgetInstance.loaderPhase=1},o)}function _(){n.util.imgOnLoad(c,b);avpw$(c).attr("src",r?r:l)}if(n.build.bundled){_()}else{n.util.loadFile(n.build["feather_baseURL"]+m,"js",_)}};n.paintWidgetLauncher_Flash_stage2=function(e,t){n.controlsWidgetInstance.loaderPhase=2;n.controlsWidgetInstance.imageSizeTracker.setOrigSize(n.launchData,{width:e,height:t},{width:n.paintWidgetInstance.width,height:n.paintWidgetInstance.height});n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"launchStage2_Flash");n.controlsWidgetInstance.showWaitThrobber(false);avpw$(n.controlsWidgetInstance.onEggWaitThrobber).hide();i.trigger("usage:submit","launch");n.fireLaunchComplete()};n.paintWidgetLauncher_HTML=function(e,t){var i=n.launchData.launchDelay;var r=n.util.getImageElem(e);var o;var s;var l;var c;var u;var f;u=n.getActiveTools(n.launchData.tools);if(n.isRelaunched&&typeof r["avpw_prevURL"]!="undefined"){t=r["avpw_prevURL"]}f=new n.AssetManager(n.launchData.isPremiumPartner,n.launchData.allowInAppPurchase);n.controlsWidgetInstance=new n.ControlsWidget(null,e,u,f,new n.ServerMessaging);if(t){n.controlsWidgetInstance.origURL=t}else{n.controlsWidgetInstance.origURL=avpw$(r).attr("src")}n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"placeControls",[n.util.getApiVersion(n.launchData)>1?n.launchData.appendTo:undefined]);n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"enableControls");avpw$("#avpw_controls").fadeIn(i);n.util.nextFrame(function(){if(n.launchData["openType"]=="mobile"){n.setPageWidth(avpw$("#avpw_controls").width())}n.controlsWidgetInstance.setupScrollPanels()});if(n.launchData.noCloseButton){avpw$("#avpw_control_cancel_pane").css("display","none")}if(r&&r.nodeName.toLowerCase()==="canvas"){n.mockLauncher(r);return}l="js/featherpaint.js";s=n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"getEmbedElement",[r]);o=a.createElement("img");o.id="avpw_temp_loading_image";n.tempLoadingImageSrc=o.src;avpw$(o).load(function(){c=n.controlsWidgetInstance.getScaledDims(avpw$(r).width(),avpw$(r).height());o.width=c.width;o.height=c.height;n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"getScaledImageDims",[o]);avpw$(o).unbind();o.style.display="block";avpw$(s).append(o);n.controlsWidgetInstance.showWaitThrobber(true);n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"hideOriginalImage",[r]);avpw$(s).show();n.util.nextFrame(function(){if(n.build.bundled){n.paintWidgetLauncher_stage2(e,t)}else{n.util.loadFile(n.build["feather_baseURL"]+l,"js",function(a){n.paintWidgetLauncher_stage2(e,t)})}})}).error(function(){n.paintWidgetCloser(true);n.errorNotify("BAD_IMAGE",[t])});o.src=r.src;return false};n.mockLauncher=function(e){var t=n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"getEmbedElement",[e]);n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"getScaledImageDims",[e]);avpw$(e).detach();avpw$(t).append(e);avpw$(t).show();n.controlsWidgetInstance.showWaitThrobber(true);n.util.nextFrame(function(){var e=function(){};n.controlsWidgetInstance.initAllTools=function(){for(var e in this.activeTools){var t=this.activeTools[e];if(this.tool.hasOwnProperty(t)){i.trigger("tool:init",t)}}};n.controlsWidgetInstance.initWithPaintWidget=function(e){this.paintWidget=e;this.initAllTools();this.bindControls();this.paintWidget.showWaitThrobber=this.showWaitThrobber.AV_bindInst(this)};n.controlsWidgetInstance.loaderPhase=1;n.paintWidgetInstance={moduleLoaded:function(e,t){return t.call(this)},setMode:e,setCurrentLayerByName:e,shutdown:e,actions:{setCheckpoint:e}};n.controlsWidgetInstance.initWithPaintWidget(n.paintWidgetInstance);n.controlsWidgetInstance.showWaitThrobber(false);n.controlsWidgetInstance.loaderPhase=2;n.fireLaunchComplete()})};n.paintWidgetLauncher_stage2=function(e,t){var a=n.util.getImageElem(e);var r;var o;var s;var l=function(e){if(!n.controlsWidgetInstance||!n.paintWidgetInstance){return}r=new Image;avpw$(r).load(function(e){if(!n.controlsWidgetInstance||!n.paintWidgetInstance){return}o=n.controlsWidgetInstance.getScaledDims(r.width,r.height);n.controlsWidgetInstance.imageSizeTracker.setOrigSize(n.launchData,r,o);r.width=o.width;r.height=o.height;n.paintWidgetInstance.setDimensions(o.width,o.height);if(!n.paintWidgetInstance.setBackground(r)){n.paintWidgetCloser(true);n.errorNotify("IMAGE_NOT_CLEAN",[t]);return false}n.paintWidgetInstance.setOrigSize(o.width,o.height);if(a.src!==t){n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"scaleCanvas")}avpw$(n.paintWidgetInstance.canvas).insertBefore("#avpw_temp_loading_image");c.remove();n.tempLoadingImageSrc=t;n.controlsWidgetInstance.showWaitThrobber(false);n.controlsWidgetInstance.loaderPhase=2;if(n.launchData["actionListJSON"]){n.paintWidgetInstance.actions.importJSON(n.launchData["actionListJSON"],n.fireLaunchComplete)}}).attr("src",e)};o=n.controlsWidgetInstance.getScaledDims(avpw$(a).width(),avpw$(a).height());n.controlsWidgetInstance.loaderPhase=1;n.paintWidgetInstance=new n.PaintWidget(o.width,o.height,new n.Actions,new n.ModeManager,new n.FilterManager,new n.OverlayRegistry,new n.ImageBorderManager);n.controlsWidgetInstance.canvasUI=new n.PaintUI(n.paintWidgetInstance.canvas,n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"getEmbedElement"));n.controlsWidgetInstance.initWithPaintWidget(n.paintWidgetInstance);n.paintWidgetInstance.setOrigSize(o.width,o.height);n.controlsWidgetInstance.imageSizeTracker.setOrigSize(n.launchData,a,o);var c=avpw$("#avpw_temp_loading_image");n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"scaleCanvas");l(t);i.trigger("usage:submit","launch");if(!n.launchData["actionListJSON"]){n.fireLaunchComplete()}return false};n.fireLaunchComplete=function(){var e=n.launchData.initTool;if(e){n.util.nextFrame(function(){i.trigger("tool:open",e)})}if(typeof n.launchData.onReady==="function"){n.launchData.onReady()}};n.paintWidgetShutdown=function(){var e;i.trigger("usage:submit","close");if(n.paintWidgetInstance){n.paintWidgetInstance.shutdown()}if(n.controlsWidgetInstance){if(n.controlsWidgetInstance.serverMessaging){n.controlsWidgetInstance.serverMessaging.shutdown();n.controlsWidgetInstance.serverMessaging=null}n.controlsWidgetInstance.shutdown()}if(n.featherUseFlash){n.FlashAPI.close()}avpw$("#avpw_controls").hide();n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"onShutdown");if(typeof n.launchData.onClose==="function"){n.launchData.onClose(n.paintWidgetInstance.dirty)}n.paintWidgetInstance=null;n.controlsWidgetInstance=null;n.tempLoadingImageSrc=null};n.paintWidgetCloser=function(e){var t=n.launchData.closeDelay;n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"onClose",[e]);if(e||t===0){avpw$("#avpw_controls").hide();n.paintWidgetShutdown()}else{avpw$("#avpw_controls").fadeOut(t,function(){if(n.paintWidgetInstance){n.paintWidgetShutdown()}})}};n.controlsWidget_saveResponder=function(e,t,a){var r;if(typeof e==="function"){r=e.apply(n.launchData,[n.util.getImageId(n.controlsWidgetInstance.paintImgIdElem),t,a])}if(n.controlsWidgetInstance){var o=n.util.getImageElem(n.controlsWidgetInstance.paintImgIdElem);o.avpw_prevURL=t;i.trigger("tool:close");if(r){n.controlsWidgetInstance.messager.show("avpw_aviary_beensaved",true)}n.controlsWidgetInstance.paintWidget.dirty=false;n.controlsWidgetInstance.saving=false}};n.controlsWidget_onImageSaved=function(e,t){n.controlsWidget_saveResponder(n.launchData.onSave,e,t)};n.controlsWidget_onHiResImageSaved=function(e){n.controlsWidget_saveResponder(n.launchData.onSaveHiRes,e)};n.ControlsWidget=function(e,t,a,r,o){this.maxWidth=parseInt(n.launchData.maxSize);this.maxHeight=this.maxWidth;this.saving=false;this.origURL=null;this.activeTools=a;this.quitCount=0;n.usageTracker.setup();this.paintImgIdElem=t;i.on("layout:resize",this.setupScrollPanels,this);this.layoutNotify(n.launchData["openType"],"showView",["main"]);if(e){this.initWithPaintWidget(e)}var s={className:"avpw_canvas_spinner",lines:12,length:6,width:2,radius:6,color:"#fff",speed:.5,trail:70};var l={className:"avpw_tool_spinner",lines:12,length:6,width:2,radius:6,color:"#fff",speed:.5,trail:70};if(n.launchData["openType"]!="mobile"){l.color="#555";l.length=4}this.waitThrobber=new n.Spinner(s);this.onEggWaitThrobber=new n.Spinner(l);this.toolManager=new n.ToolManager(this);this.assetManager=r;this.serverMessaging=o};n.ControlsWidget.prototype.tool={};n.ControlsWidget.prototype.layout={};n.ControlsWidget.prototype.layoutNotify=function(e,t,a){return this.objectNotify("layout",e,t,a)};n.ControlsWidget.prototype.objectNotify=function(e,t,a,n){if(typeof this[e][t]=="object"){var i=this[e][t];if(typeof i[a]=="function"){var r=i[a];if(!n){n=[]}return r.apply(i,n)}}return true};n.ControlsWidget.prototype.shutdown=function(){if(this.canvasUI){this.canvasUI.shutdown()}if(this.messager){this.messager.hide()}i.off("layout:resize",this.setupScrollPanels);this.shutdownAllTools();this.unbindControls();if(this.toolsPager){this.toolsPager.shutdown();this.toolsPager=null}if(this.paintWidget){this.paintWidget.showWaitThrobber=null}n.usageTracker.shutdown();this.waitThrobber.stop();this.onEggWaitThrobber.stop();this.waitThrobber=null;this.onEggWaitThrobber=null;this.showPanel(null);this.toolManager.shutdown();this.toolManager=null};n.ControlsWidget.prototype.initAllTools=function(){n.paintWidgetInstance.filterManager.loadPack("tools");for(var e in this.activeTools){var t=this.activeTools[e];if(this.tool.hasOwnProperty(t)){n.paintWidgetInstance.moduleLoaded(t,function(e){i.trigger("tool:init",e)}.AV_bindInst(this))}}};n.ControlsWidget.prototype.shutdownAllTools=function(){for(var e in this.activeTools){var t=this.activeTools[e];i.trigger("tool:shutdown",t)}};n.ControlsWidget.prototype.bindControls=function(){};n.ControlsWidget.prototype.unbindControls=function(){};n.ControlsWidget.prototype.initWithPaintWidget=function(e){this.paintWidget=e;this.imageSizeTracker=new n.ImageSizeTracker(e.actions);if(!n.featherUseFlash){this.initAllTools()}this.bindControls();this.paintWidget.showWaitThrobber=this.showWaitThrobber.AV_bindInst(this)};n.ControlsWidget.prototype.showWaitThrobber=function(e,a){var i=300;var r=this;if(e){var o=this.layoutNotify(n.launchData["openType"],"getEmbedElement");if(o.is(":visible")){this.waitThrobber.spin(o[0]);avpw$(this.waitThrobber).fadeIn(i)}}else{avpw$(r.waitThrobber.el).fadeOut(i,r.waitThrobber.stop)}if(a){t.setTimeout(a,5)}};n.publicName2PanelMode=function(e){if(e==="stickers"){e="overlay"}if(e==="draw"){e="drawing"}if(e==="text"&&!n.featherUseFlash){e="textwithfont"}return e};n.ControlsWidget.prototype.panelMode2WidgetMode=function(e){switch(e){case"rotate":return"rotate90";break;case"greeneye":return"redeye";break;case"pinch":return"bulge";break}return e};n.ControlsWidget.prototype.setupScrollPanels=function(){if(!this.activeTools||!this.activeTools.length){return}var e,t;var a=this;var r=5;var o,s={},l=this.layoutNotify(n.launchData["openType"],"getDims").TOOLS_BROWSER_WIDTH;var c=function(){a.toolsPager=new n.Pager(u)};var u={itemCount:this.activeTools.length,itemsPerPage:this.layoutNotify(n.launchData["openType"],"getToolsPerPage"),pageWidth:l,leftArrow:avpw$("#avpw_lftArrow"),rightArrow:avpw$("#avpw_rghtArrow"),itemBuilder:function(i){e=a.activeTools[i];t=n.util.getUserFriendlyToolName(e);t=n.getLocalizedString(t);return n.template[n.launchData.layout].eggIcon({optionName:e,capOptionName:t})},pageTemplate:n.template[n.launchData.layout].genericScrollPanel,pipTemplate:n.template[n.launchData.layout].scrollPanelPip,lastPageTemplate:o,lastPageContents:s,pageContainer:avpw$("#avpw_control_main_scrolling_region"),pipContainer:avpw$("#avpw_tools_pager ul"),onPageChange:function(e){n.usageTracker.addPageHit(e)}};c();avpw$("#avpw_control_main_scrolling_region").css("width",a.toolsPager.getPageCount()*l+"px");this.assetManager.getAssets("PERMISSION",function(e){var t=true;if(e){for(var r=0;r<e.length;r++){if(e[r]&&e[r].assetId==="whitelabel"){t=false;break}}}if(t){avpw$("#avpw_powered_branding").html(n.template[n.launchData.layout].poweredByFooterLogo).click(function(){i.trigger("modal:show","avpw_aviary_aviaryfeedback",false,false)});a.toolsPager.shutdown();c();avpw$("#avpw_control_main_scrolling_region").css("width",a.toolsPager.getPageCount()*l+"px");a.toolsPager.changePage()}});n.usageTracker.setPageCount(a.toolsPager.getPageCount());a.toolsPager.changePage()};n.ControlsWidget.prototype.messager=function(){var e={};var a;var r;var o;var s=1e3;var l={show:function(i,o,l){a=a||avpw$("#avpw_messaging");r=r||avpw$("#avpw_messaging_inner");var c=e[i]||(e[i]=avpw$("#"+i));r.append(c);a.fadeIn(150);if(o){a.data("needsConfirmation",true);n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"disableControls")}else{a.data("needsConfirmation",false);if(!l){t.setTimeout(this.hide,s)}}},hide:function(i,r){a=a||avpw$("#avpw_messaging");o=o||avpw$("#avpw_messages");if(i){var s=e[i];if(s){o.append(s)}}else{avpw$.each(e,function(e,t){o.append(t)})}if(a.data("needsConfirmation")){t.setTimeout(function(){if(r){r()}},400);if(n.controlsWidgetInstance){n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"enableControls")}}else{a.hide();if(r){r()}}},addMessage:function(e){o=o||avpw$("#avpw_messages");if(e){o[0].innerHTML+=e}}};i.on("modal:show",l.show);i.on("modal:hide",l.hide);return l}();n.ControlsWidget.prototype.orientationChanged=function(e){};n.ControlsWidget.prototype.windowResized=function(){var e=null;return function(a){t.clearTimeout(e);e=t.setTimeout(function(){i.trigger("layout:resize");e=null},500)}}();n.ControlsWidget.prototype.Slider=function(e){var t=false;var a=function(a,n){if(!t&&e.onstart){e.onstart.apply(this,[a,n])}};var n=function(a,n){if(!t&&e.onchange){e.onchange.apply(this,[a,n])}};var i=function(a,n){if(!t&&e.onslide){e.onslide.apply(this,[a,n])}};var r=avpw$(e.element).slider({range:"min",max:e.max,min:e.min,value:e.defaultValue||e.max/2,delay:e.delay});this.getValue=function(){return r.slider("value")};this.setValue=function(e){return r.slider("value",e)};this.reset=function(a){t=true;this.setValue(e.defaultValue);t=false};this.addListeners=function(){r.bind("slidestart",a).bind("slidechange",n).bind("slide",i)};this.removeListeners=function(){r.unbind("slidestart").unbind("slide").unbind("slidechange")};this.shutdown=function(){r.slider("destroy")};return this};n.ControlsWidget.prototype._drawUICircle=function(e,t,a,i,r){if(n.featherUseFlash){return}else{this._drawUICircle_HTML(e,t,a,i,r)}};n.ControlsWidget.prototype._drawUICircle_HTML=function(e,t,a,i,r){var o=avpw$(e)[0];var s=o.getContext("2d");var l;s.clearRect(0,0,o.width,o.height);if(r&&i!=="transparent"){this._drawUIGrid(s,o.width,o.height)}s.globalCompositeOperation="source-over";if(a!=null){if(r&&(a=="transparent"||n.util.color_is_white(a)||i==null)){s.strokeStyle="#444"}else{s.strokeStyle=a}l=3}else{s.strokeStyle="rgba(0,0,0,0)";l=1}s.lineWidth=l;s.beginPath();s.arc(o.width/2,o.height/2,t,0,2*Math.PI,true);s.stroke();s.closePath();if(i!=null){s.save();s.clip();if(r&&i=="transparent"){this._drawUIGrid(s,o.width,o.height)}else{s.fillStyle=i;s.fillRect(0,0,o.width,o.height)}s.restore()}};n.ControlsWidget.prototype._drawUIGrid=function(e,t,a,n){var i,r;if(!n){n=5}for(r=0;r<a+n;r+=n){for(i=0;i<a+n;i+=n){if((i+r&1)==1){e.fillStyle="#fff"}else{e.fillStyle="#ddd"}e.fillRect(i,r,n,n)}}};n.ControlsWidget.prototype.showPanel=function(e){if(e!=null){avpw$(".avpw_controlpanel").each(function(){avpw$(this).hide()});avpw$("#avpw_controlpanel_"+e).show()}};n.ControlsWidget.prototype.save=function(){var e=null;var a=true;var r=1e3;var o=function(){return{apikey:n.launchData.apiKey,timestamp:n.launchData.timestamp,signature:n.launchData.signature,salt:n.launchData.salt,encryptionmethod:n.launchData.encryptionMethod}};var s=function(e,t,a){var i=n.controlsWidgetInstance;i.layoutNotify(n.launchData["openType"],"enableControls",[true]);i.paintWidget.showWaitThrobber(false);if(e){var r=avpw$(n.util.getImageElem(i.paintImgIdElem));r.avpw_prevURL=e;n.controlsWidget_onImageSaved(e,t)}else{n.errorNotify("ERROR_SAVING",[n.build["imgrecvServer"],a]);n.controlsWidgetInstance.saving=false}};var l=function(e,t){var a=n.controlsWidgetInstance;a.layoutNotify(n.launchData["openType"],"enableControls",[true]);a.paintWidget.showWaitThrobber(false);if(e){var i=avpw$(n.util.getImageElem(a.paintImgIdElem));i.avpw_prevURL=e;n.controlsWidget_onHiResImageSaved(e)}else{n.errorNotify("ERROR_SAVING",[n.build["asyncImgrecvBase"],t]);n.controlsWidgetInstance.saving=false}};var c=function(e){var t,a,n,i,r="";if(typeof e==="string"){t=e.split("---FEATHER-POSTMESSAGE---");a=t[0];n=t[1]}else{i=avpw$(e).find("error");if(i.length>0){r=i.text()}else{var o=avpw$(e).find("url");if(o){a=o.text();a=a.replace(/^\s+|\s+$/g,"")}var l=avpw$(e).find("hiresurl");if(l){n=l.text();n=n.replace(/^\s+|\s+$/g,"")}}}s(a,n,r)};var u=function(){var e=this;e.paintWidget.exportImage(null,function(t){var a,i;var r=t.indexOf(";",0);var s=t.indexOf(",",r);a=t.slice(5,r);i=t.slice(s+1);t="";n.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_save_form",action:n.build["imgrecvServer"],method:"POST",announcer:n.build["featherTargetAnnounce"],origin:n.build["imgrecvBase"],keyValues:n.util.extend(o(),{file:i,postdata:n.launchData.postData,posturl:n.launchData.postUrl,sessionid:n.usageTracker.getUUID(),actionlist:e.paintWidget.actions.exportJSON(true),origurl:e.origURL,hiresurl:n.launchData.hiresUrl,contenttype:n.launchData.fileFormat,jpgquality:n.launchData.jpgQuality,debug:n.launchData.debug,asyncsave:n.launchData.asyncSave,usecustomfileexpiration:n.launchData.useCustomFileExpiration,encodedas:"base64text"}),callback:c})})};var f=function(){var i=n.util.extend(o(),{actionlist:this.paintWidget.actions.exportJSON(true),origurl:n.launchData.hiresUrl,fileformat:n.launchData.fileFormat,notificationmethod:"GET",backgroundcolor:"0xffffffff",jpgquality:n.launchData.jpgQuality});var s=function(n){if(!n||n&&n.JobStatusCode==="JobFailed"){l(null);t.clearInterval(e)}else{if(n&&n.JobStatusCode==="JobCompleted"){t.clearInterval(e);l(n.JobStatus)}}a=true};var c=function(i){var c;if(i&&i.JobId){c=i.JobId;e=t.setInterval(function(){if(a){n.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_save_form",action:n.build["asyncImgrecvGetJobStatus"],method:"POST",dataType:"json",announcer:n.build["asyncFeatherTargetAnnounce"],origin:n.build["asyncImgrecvBase"],keyValues:n.util.extend(o(),{jobid:c}),callback:s})}a=false},r)}else{l(null)}};n.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_save_form",action:n.build["asyncImgrecvCreateJob"],method:"POST",dataType:"json",announcer:n.build["asyncFeatherTargetAnnounce"],origin:n.build["asyncImgrecvBase"],keyValues:i,callback:c})};var d=function(e,t,a){var i=this;i.paintWidget.exportImage(a,function(a){var i=n.controlsWidgetInstance;i.saving=false;i.layoutNotify(n.launchData["openType"],"enableControls",[true]);i.paintWidget.showWaitThrobber(false);if(e&&typeof e==="function"){if(t){t=e(a)===false?false:true}else{e(a)}}if(t){n.util.nextFrame(function(){n.controlsWidget_onImageSaved(i.origURL)})}})};var h=function(e,t,a,i){var r=!n.featherUseFlash;if(r){this.layoutNotify(n.launchData["openType"],"disableControls")}this.paintWidget.showWaitThrobber(r,function(){switch(e){case"saveHiRes":f.call(o);break;case"getImageData":d.call(o,t,a,i);break;default:u.call(o);break}});var o=this;return false};return function(e,t,a,r){if(n.controlsWidgetInstance.loaderPhase<2){return false}if(this.saving){return false}i.trigger("tool:commit");i.trigger("tool:close");this.saving=true;n.prevActionList=this.paintWidget.actions.exportJSON(true);if(n.launchData.postData&&typeof n.launchData.postData!=="string"){n.launchData.postData=n.JSON.stringify(n.launchData.postData)}return h.apply(this,[e,t,a,r])}}();n.ControlsWidget.prototype.onSaveButtonClicked=function(e){i.trigger("usage:submit","saveclicked");if(typeof n.launchData.onSaveButtonClicked==="function"){var t=n.launchData.onSaveButtonClicked.apply(n.launchData,[n.util.getImageId(n.controlsWidgetInstance.paintImgIdElem)]);if(t===false){return false}}return n.controlsWidgetInstance.save()};n.ControlsWidget.prototype.showAreYouSure=function(){this.messager.show("avpw_aviary_quitareyousure",true)};n.ControlsWidget.prototype.cancel=function(e){this.quitCount++;var t=this.quitCount>0&&this.paintWidget&&this.paintWidget.dirty;if(typeof n.launchData.onCloseButtonClicked==="function"){var a=n.launchData.onCloseButtonClicked.apply(n.launchData,[t]);if(a===false){return false}}if(t){this.showAreYouSure()}else{n.paintWidgetCloser()}return false};n.ControlsWidget.prototype.getScaledDims=function(e,t){return n.util.getScaledDims(e,t,this.maxWidth,this.maxHeight)};n.TransformStyle=function(e){var t=this;var a=e||"";t.set=function(e){if(a){for(var t in e){var n=t+"\\([^\\)]*";var i=new RegExp(n);var r=false;var o=function(a,n,i){r=true;return t+"("+e[t]};a=a.replace(i,o);if(!r){a+=" "+t+"("+e[t]+")"}}}else{for(var t in e){a+=" "+t+"("+e[t]+")"}}};t.serialize=function(){return a};return t};return e})(this,typeof window!=="undefined"?window:{},typeof document!=="undefined"?document:{});(function(e,t,a){e.errorNotify=function(t,a){var n={BAD_IMAGE:{code:1,message:"There was a problem loading your image provided to the `image` config key. Either it's not actually an image file or it doesn't really exist."},UNSUPPORTED:{code:2,message:"It looks like you're using a browser that doesn't support the HTML canvas element (and also doesn't have Flash installed either). Please try accessing this page through a modern browser like Chrome, Firefox, Safari, or Internet Explorer (version 9 or higher). Your internets will thank you."},BAD_URL:{code:3,message:"There was a problem loading your image provided by URI to the `url` config key. It is not reachable by the public (and our service at "+(e.featherUseFlash?e.build["proxyServer"]:e.build["imgrecvBase"])+")"},UNSUPPORTED_TOOL:{code:4,message:"So sorry, but this tool is not available because it is not part of the set chosen with the `tools` config key. It's alternatively possible that your browser does not support this specific tool."},IMAGE_NOT_CLEAN:{code:5,message:"Uh oh! We can't edit this image because the editor wasn't set up correctly to load external files via their address. You must either provide images from the same domain as the web page with the editor OR pass the external image address via the `url` config key in order for Aviary to be able to get permission from the browser to open it for editing. Sorry for the inconvenience!"},UNSUPPORTED_FONT:{code:6,message:"So sorry, but this font looks to be unsupported by your browser or platform"},ERROR_SAVING:{code:7,message:"There was a problem saving your photo. Please try again."},NO_APIKEY:{code:8,message:"apiKey is required and not provided. See http://www.aviary.com/web-documentation#constructor-config-apikey."},ERROR_AUTHENTICATING:{code:9,message:"There was a problem retrieving access to content from our server. Please ensure all authentication keys are present or do not attempt premium partner authentication."},ERROR_BAD_THEME:{code:10,message:"Selected theme does not exist. Please use 'dark', 'light' or 'minimum' or see aviary.com/web for more info."}};var i=function(e){};var r=n[t];var o=r["message"];if(typeof e.launchData.onError==="function"){r["args"]=a;o=e.launchData.onError(r)||o}if(o){i(o)}return o}})(window["AV"]||(window["AV"]={}),window,document);(function(e,t,a){e["AV"]=e["AV"]||{};var n=e["AV"];var i=n.Events;e["Aviary"]=n;n.feather_loaded=false;n.feather_loading=false;n.build=n.build||{version:"",imgrecvServer:"imgrecvserver",flashGatewayServer:"",imgrecvBase:"",inAppPurchaseFrameURL:"",imgtrackServer:"imgtrackserver",filterServer:"",jsonp_imgserver:"",featherTargetAnnounce:"feather_target_announce_v3.html",proxyServer:"",feather_baseURL:"",feather_stickerURL:"",googleTracker:"",MINIMUM_FLASH_PLAYER_VERSION:"10.2.0"};n.defaultTools=["enhance","effects","frames","overlay","crop","resize","orientation","focus","brightness","contrast","saturation","warmth","sharpness","colorsplash","drawing","textwithfont","redeye","whiten","blemish"];n.flashSupportedTools=["enhance","effects","overlay","crop","resize","orientation","brightness","contrast","saturation","sharpness","drawing","text","redeye","blemish"];var r={};r.image=null;r.apiKey=undefined;r.apiVersion=1;r.appendTo=null;r.language="en";r.theme=null;r.minimumStyling=false;r.maxSize=800;r.noCloseButton=false;r.launchDelay=300;r.closeDelay=300;r.tools=undefined;r.initTool="";r.cropPresets=["Original","Custom",["Square","1:1"],"3:2","3:5","4:3","4:5","4:6","5:7","8:10","16:9"];r.cropPresetDefault="Custom";r.cropPresetsStrict=false;r.url=null;r.postUrl=undefined;r.postData=null;r.fileFormat="";r.jpgQuality=100;r.displayImageSize=false;r.hiresMaxSize=1e4;r.hiresWidth=null;r.hiresHeight=null;r.onLoad=undefined;r.onReady=undefined;r.onSaveButtonClicked=undefined;r.onSave=undefined;r.onSaveHiRes=undefined;r.onClose=undefined;r.onError=undefined;r.signature=null;r.timestamp=null;r.hiresUrl=undefined;r.useCustomFileExpiration=false;r.allowInAppPurchase=false;r.forceFlash=false;r.forceSupport=false;r.poweredByURL="http://www.aviary.com";r.giveFeedbackURL="http://www.aviary.com/feature-requests";r.getWidgetURL="http://www.aviary.com";r.debug=false;r.asyncSave=true;n.baseConfig=r;(function(e){var t=function(e){return{language:e["Feather_Language"],forceFlash:e["Feather_ForceFlash"],forceSupport:e["AV_Feather_ForceSupport"],onLoad:e["Feather_OnLoad"],onReady:e["Feather_OnLaunchComplete"],onClose:e["Feather_OnClose"],onSave:e["Feather_OnSave"],noCloseButton:e["Feather_NoCloseButton"],maxSize:e["Feather_MaxSize"]||e["Feather_MaxDisplaySize"],tools:e["Feather_EditOptions"],cropPresets:e["Feather_CropSizes"],resizePresets:e["Feather_ResizeSizes"],apiKey:e["Feather_APIKey"],hiresUrl:e["Feather_HiResURL"],postUrl:e["Feather_PostURL"],fileFormat:e["Feather_FileFormat"]||e["Feather_ContentType"],jpgQuality:e["Feather_FileQuality"],signature:e["Feather_Signature"],timestamp:e["Feather_Timestamp"]}};n.baseConfig=n.util.extend(n.baseConfig,t(e));if("https:"==e.location.protocol||"chrome-extension:"==e.location.protocol){var a,i,r;for(var o in n.build){i=o.split("_SSL");if(i.length===2&&n.build[o]){a=i[0];n.build[a]=n.build[o]}}}if(e["Feather_Theme"]||e["Feather_OpenType"]||e["Feather_APIKey"]){n.util.nextFrame(function(){var a=new n.Feather(n.baseConfig);e.aviaryeditor=function(i,r,o,s){n.launchData=n.util.extend(n.baseConfig,t(e));var l=n.util.extend(n.launchData,{image:i,url:r,postData:o,appendTo:s});a.launch(l)};e.aviaryeditor_close=a.close;e.aviaryeditor_relaunch=a.relaunch;e.aviaryeditor_activatetool=a.activateTool;e.aviarynewimage=a.replaceImage})}})(t);n.getLocalizedString=function(e){try{var t=n.lang[n.launchData["language"]][e];if(t===undefined)t=e;return t}catch(a){}return e};Function.prototype.AV_bindInst=function(e){var t=this;return function(){return t.apply(e,arguments)}};n.injectControls=function(){var e,t;if(n.launchData["openType"]=="popup"){e="";t=n.template[n.launchData.layout].saveBlock()}else{e=n.template[n.launchData.layout].saveBlock();t=""}if(n.criticalLayoutStyles&&!n.feather_loaded){var i=a.createElement("style");i.type="text/css";var r=a.createTextNode(n.criticalLayoutStyles);if(i.styleSheet){i.styleSheet.cssText=r.nodeValue}else{i.appendChild(r)}var o=a.getElementsByTagName("head")[0];o.appendChild(i)}var s=n.template[n.launchData.layout].controls({internalSaveBlock:e,externalSaveBlock:t});var l=a.createElement("div");l.id="avpw_holder";var c="";if(n.featherUseFlash){c="avpw_flash "}if(n.msie){c+="avpw_ie"+n.msie}if(c){l.className=c}var u=a.getElementsByTagName("body");if(u){u=u[0]}if(!u){u=a.documentElement}u.appendChild(l);l.innerHTML=s};n.Feather=function(e){var r=this;var o=function(){n.injectControls();n.util.nextFrame(n.loadStageFinal)};var s=function(){if(typeof avpw$!=="undefined"){avpw$(a).ready(o)}else{o()}};if(e){e.openType="aviary";e.layout="desktop"}e=e||{};n.launchData=n.util.extend(n.baseConfig,e);var l=function(){var e,t;function a(e){var t=n.build["feather_baseURL"]+"css/"+e;n.util.loadFile(t+".css","css")}n.featherUseFlash=!n.featherHtmlOk()&&n.featherFlashOk();n.launchData["language"]=n.launchData["language"].toLowerCase();if(!n.feather_loaded&&!n.feather_loading){n.feather_loading=true;
e=n.launchData["language"]||"en";t="js/feathercontrols_desktop";if(n.validLanguages&&n.validLanguages[e]){t+="_"+e+".js"}else{t+="_en.js"}if(n.launchData["minimumStyling"]){a("feather_core")}else{a("feather_theme_aviary")}n.util.loadFile(n.build["feather_baseURL"]+"images/aviary_atlas.png","img");if(n.build.bundled){s()}else{n.util.loadFile(n.build["feather_baseURL"]+t,"js",s)}}};var c=function(){var e,t;function a(e){var t=n.build["feather_baseURL"]+"css/"+e;n.util.loadFile(t+".css","css")}n.featherUseFlash=!n.featherHtmlOk()&&n.featherFlashOk();n.launchData["language"]=n.launchData["language"].toLowerCase();if(!n.feather_loaded&&!n.feather_loading){n.feather_loading=true;e=n.launchData["language"]||"en";t="js/feathercontrols_desktop";if(n.validLanguages&&n.validLanguages[e]){t+="_"+e+".js"}else{t+="_en.js"}if(!n.launchData["theme"]&&n.launchData["minimumStyling"]){n.launchData["theme"]="minimum"}if(n.launchData["theme"]=="minimum"){n.launchData["minimumStyling"]=true}if(!n.launchData["theme"]){n.launchData["theme"]="dark"}switch(n.launchData["theme"]){case"dark":case"light":case"minimum":break;default:n.errorNotify("ERROR_BAD_THEME");break}var i;if(n.launchData["minimumStyling"])i="feather_core_";else i="feather_theme_aviary_";i+=n.launchData["theme"];a(i);if(n.build.bundled){s()}else{n.util.loadFile(n.build["feather_baseURL"]+t,"js",s)}}};var u=n.util.getApiVersion(n.launchData);if(u===2){n.build["feather_baseURL"]=t.location.protocol+"//feather.aviary.com/2.6.2.182/";n.build["feather_baseURL_SSL"]=t.location.protocol+"//dme0ih8comzn4.cloudfront.net/2.6.2.182/";if("https:"==t.location.protocol||"chrome-extension:"==t.location.protocol){var f,d,h;for(var p in n.build){d=p.split("_SSL");if(d.length===2&&n.build[p]){f=d[0];n.build[f]=n.build[p]}}}l()}else{c()}var g=function(){if(n.paintWidgetInstance){return false}else{var e=n.util.getImageElem(n.launchData.image);n.paintWidgetLauncher(e,n.launchData.url)}};r.launch=function(e){if(!n.feather_loaded){return false}var t=a.getElementById("avpw_holder");if(!t){n.injectControls()}if(n.paintWidgetInstance){if(t){return false}else{r.close(true)}}if(e&&e.language){delete e.language}n.launchData=e?n.util.extend(n.launchData,e):n.launchData;if(!n.launchData.image){n.errorNotify("BAD_IMAGE");return false}n.launchData.image=n.util.getImageElem(n.launchData.image);if(n.featherUseFlash){g()}else{if(!n.featherSupported()){if(n.errorNotify("UNSUPPORTED")){n.controlsWidgetInstance=new n.ControlsWidget;n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"placeControls",[n.util.getApiVersion(n.launchData)>1?n.launchData.appendTo:undefined]);n.controlsWidgetInstance.bindControls();a.getElementById("avpw_controls").style.display="block";n.controlsWidgetInstance.messager.show("avpw_aviary_unsupported",true)}return true}n.util.nextFrame(g)}return true};r.showWaitIndicator=function(){if(n.controlsWidgetInstance&&n.controlsWidgetInstance.showWaitThrobber){n.controlsWidgetInstance.showWaitThrobber(true);return true}else{return false}};r.hideWaitIndicator=function(){if(n.controlsWidgetInstance&&n.controlsWidgetInstance.showWaitThrobber){n.controlsWidgetInstance.showWaitThrobber(false);return true}else{return false}};r.getImageDimensions=function(){var e=null;if(n.paintWidgetInstance){e=n.paintWidgetInstance.getScaledSize();if(!(n.launchData["hiresWidth"]&&n.launchData["hiresHeight"])){delete e.hiresWidth;delete e.hiresHeight}}return e};r.save=function(){if(!n.paintWidgetInstance){return false}return n.controlsWidgetInstance.save()};r.saveHiRes=function(){if(!n.paintWidgetInstance){return false}return n.controlsWidgetInstance.save("saveHiRes")};r.getImageData=function(e,t,a){if(!n.paintWidgetInstance){return false}return n.controlsWidgetInstance.save("getImageData",e,t,a)};r.close=function(e){if(!n.paintWidgetInstance){return false}n.paintWidgetCloser(e)};r.relaunch=function(){i.trigger("usage:interact","api","relaunch");n.isRelaunched=true;if(n.launchData){r.launch(n.launchData)}else{return false}};r.activateTool=function(e){i.trigger("tool:open",e,n.controlsWidgetInstance)};r.replaceImage=function(e){i.trigger("usage:interact","api","replaceImage");if(n.launchData){r.close(true);n.util.nextFrame(function(){n.launchData.url=e;r.launch(n.launchData)})}else{return false}};r.updateConfig=function(e,t){if(n.launchData){if(e&&typeof e==="object"){for(var a in e){if(e.hasOwnProperty(a)){n.launchData[a]=e[a]}}}else if(e&&typeof e==="string"){n.launchData[e]=t}else{return false}}else{return false}};r.getIsDirty=function(){return n.paintWidgetInstance?n.paintWidgetInstance.dirty:false};r.getActionList=function(){if(n.paintWidgetInstance){i.trigger("tool:commit");return n.paintWidgetInstance.actions.exportJSON(true)}else{return undefined}};r.disableControls=function(){n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"disableControls")};r.enableControls=function(){n.controlsWidgetInstance.layoutNotify(n.launchData["openType"],"enableControls")};r.on=function(e,t){if(i&&e&&t&&typeof t==="function"){i.on(e,t)}};r.off=function(e,t){if(i&&e&&t&&typeof t==="function"){i.off(e,t)}};return r};n.loadStageFinal=function(){n.feather_loaded=true;if(typeof n.launchData["onLoad"]==="function"){n.launchData["onLoad"]()}};n.featherSupported=function(){return n.featherHtmlOk()||n.featherFlashOk()||n.launchData["forceSupport"]};n.featherFlashOk=function(){if(n.launchData["forceFlash"]){return true}return avpw_swfobject&&avpw_swfobject.hasFlashPlayerVersion(n.build.MINIMUM_FLASH_PLAYER_VERSION)};n.featherHtmlOk=function(){if(n.launchData["forceFlash"]){return false}var e=!!a.createElement("canvas").getContext;var i=typeof t.postMessage==="function";return e&&i};n.getFlashMovie=function(e){var n=t[e]||a[e];return n};n.msie=function(){var e,t=3,n=a.createElement("div"),i=n.getElementsByTagName("i");while(n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",i[0]){}return t>4?t:e}();n.firefox=function(){var e;if(t.navigator.product==="Gecko"){e=navigator.userAgent.split("Firefox/")[1];e=parseInt(e,10)}return e}();n.PAGE_WIDTH=360;n.setPageWidth=function(e){n.PAGE_WIDTH=e};return e})(this,typeof window!=="undefined"?window:{},typeof document!=="undefined"?document:{});(function(e,t,a){e.support=function(e){var t=e.navigator.userAgent;var n=e.screen.width;var i=e.screen.height;var r={0:/Android/i,1:/webOS/i,2:/iPhone/i,3:/iPod/i,4:/BlackBerry/i,5:/iPad/i};var o;var s=0;var l=0;var c=0;var u=0;for(var f in r){if(t.match(r[f])){s=1;o=parseInt(f)}}if(t.match(/AppleWebKit/i)){l=1}if(o===0){c=1}if(c===1){var d=t.match(/Android [0-9].[0-9]/).toString();if(d){u=parseFloat(d.split("Android ")[1])}}var h={};h.isAppleWebkit=function(){return l===1};h.isMobileWebkit=function(){return l===1&&n&&(n<=480||u>0&&u<=2.3)};h.isIPhoneOrIPod=function(){return o===2||o===3};h.isAndroid=function(){return c===1};h.getAndroidVersion=function(){return u};h.getVendorProperty=function(){var e={};var t=function(e,t){var a=["webkit","ms","Moz","O"];var n,i,r=e.style;if(r[t]!==undefined)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(i=0;i<a.length;i++){n=a[i]+t;if(r[n]!==undefined)return n}};return function(n){return e[n]||(e[n]=t(a.createElement("div"),n))}}();return h}(t)})(window["AV"]||(window["AV"]={}),window,document);var FEATHER_EDITOR;var FEATHER_CONFIGS={apiKey:"ivi35oh8nmumnuhp",apiVersion:3,theme:"dark",tools:"all",appendTo:"",maxSize:1e3,language:browser.lang,onSaveButtonClicked:function(){var e=this;FEATHER_EDITOR.getImageData(function(t){var a=t.substring(22);var n=new FormData;n.append("url",e.url);n.append("image",a);n.append("type","png");bm.ajax({contentType:false,processData:false,cache:false,url:FEATHER_EDITOR.saveUrl,type:"post",data:n,beforeSend:function(e){e.setRequestHeader("base64_encoded","true")},success:function(){FEATHER_EDITOR.close();if(FEATHER_EDITOR.afterSave){FEATHER_EDITOR.afterSave(t)}}})});return false},onSave:function(e,t){},onClose:function(){return false},onError:function(e){}};Aviary.launchEditor=function(e,t,a){function n(){FEATHER_EDITOR.launch({image:$("<img src='"+e+"'>")[0],url:e})}if(AV.feather_loaded){FEATHER_EDITOR=new Aviary.Feather(FEATHER_CONFIGS);n()}else{$(document.body).loader();FEATHER_EDITOR=new Aviary.Feather($.extend({onLoad:function(){$(document.body).loader(false);n()}},FEATHER_CONFIGS))}FEATHER_EDITOR.saveUrl=t||e;FEATHER_EDITOR.afterSave=a;return false};